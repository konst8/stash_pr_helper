;/* module-key = 'com.atlassian.stash.stash-web-plugin:time', location = '/static/widget/date/time.soy' */
// This file was automatically generated from time.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.date.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.date == 'undefined') {
    stash.widget.date = {};
}

stash.widget.date.shortAge = function(opt_data, opt_ignored) {
    return '' + stash.widget.date.time({
        date: opt_data.date,
        title: opt_data.title,
        extraClasses: opt_data.extraClasses,
        type: 'shortAge'
    });
}
;
if (goog.DEBUG) {
    stash.widget.date.shortAge.soyTemplateName = 'stash.widget.date.shortAge';
}

stash.widget.date.short = function(opt_data, opt_ignored) {
    return '' + stash.widget.date.time({
        date: opt_data.date,
        title: opt_data.title,
        extraClasses: opt_data.extraClasses,
        type: 'short'
    });
}
;
if (goog.DEBUG) {
    stash.widget.date.short.soyTemplateName = 'stash.widget.date.short';
}

stash.widget.date.time = function(opt_data, opt_ignored) {
    return '' + ((opt_data.date) ? '<time title="' + soy.$$escapeHtml(opt_data.title ? opt_data.title : require('util/time').format(opt_data.date, 'full')) + '" datetime="' + soy.$$escapeHtml(require('util/time').format(opt_data.date, 'timestamp')) + '"' + ((opt_data.extraClasses) ? ' class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"' : '') + '>' + soy.$$escapeHtml(require('util/time').format(opt_data.date, opt_data.type)) + '</time>' : '<time' + ((opt_data.extraClasses) ? ' class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"' : '') + '>' + soy.$$escapeHtml("Unknown Date") + '</time>');
}
;
if (goog.DEBUG) {
    stash.widget.date.time.soyTemplateName = 'stash.widget.date.time';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:time', location = '/static/widget/date/deprecated-time.soy' */
// This file was automatically generated from deprecated-time.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace widget.date.
 */

if (typeof widget == 'undefined') {
    var widget = {};
}
if (typeof widget.date == 'undefined') {
    widget.date = {};
}

widget.date.shortAge = function(opt_data, opt_ignored) {
    return '' + widget.date.time({
        date: opt_data.date,
        title: opt_data.title,
        extraClasses: opt_data.extraClasses,
        type: 'shortAge'
    });
}
;
if (goog.DEBUG) {
    widget.date.shortAge.soyTemplateName = 'widget.date.shortAge';
}

widget.date.short = function(opt_data, opt_ignored) {
    return '' + widget.date.time({
        date: opt_data.date,
        title: opt_data.title,
        extraClasses: opt_data.extraClasses,
        type: 'short'
    });
}
;
if (goog.DEBUG) {
    widget.date.short.soyTemplateName = 'widget.date.short';
}

widget.date.time = function(opt_data, opt_ignored) {
    return '' + ((opt_data.date) ? '<time title="' + soy.$$escapeHtml(opt_data.title ? opt_data.title : require('util/time').format(opt_data.date, 'full')) + '" datetime="' + soy.$$escapeHtml(require('util/time').format(opt_data.date, 'timestamp')) + '" class="deprecated' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '">' + soy.$$escapeHtml(require('util/time').format(opt_data.date, opt_data.type)) + '</time>' : '<time class="deprecated' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '">' + soy.$$escapeHtml("Unknown Date") + '</time>');
}
;
if (goog.DEBUG) {
    widget.date.time.soyTemplateName = 'widget.date.time';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:focus-message', location = '/static/widget/focus-message/focus-message.soy' */
// This file was automatically generated from focus-message.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.focusMessage.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.focusMessage == 'undefined') {
    stash.widget.focusMessage = {};
}

stash.widget.focusMessage.message = function(opt_data, opt_ignored) {
    return '<div class="focus-message' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.iconClass) ? '<div class="focus-message-icon aui-icon' + ((opt_data.iconClass) ? ' ' + soy.$$escapeHtml(opt_data.iconClass) : '') + '">' + soy.$$escapeHtml(opt_data.accessibilityText ? opt_data.accessibilityText : '') + '</div>' : '') + '<h2>' + soy.$$escapeHtml(opt_data.title) + '</h2>' + ((opt_data.text) ? '<p>' + soy.$$escapeHtml(opt_data.text) + '</p>' : '') + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.widget.focusMessage.message.soyTemplateName = 'stash.widget.focusMessage.message';
}

stash.widget.focusMessage.error = function(opt_data, opt_ignored) {
    return '' + stash.widget.focusMessage.message({
        title: opt_data.title,
        text: opt_data.text,
        content: opt_data.content,
        extraClasses: opt_data.extraClasses,
        iconClass: 'icon-skull'
    });
}
;
if (goog.DEBUG) {
    stash.widget.focusMessage.error.soyTemplateName = 'stash.widget.focusMessage.error';
}
;;/* module-key = 'com.atlassian.stash.stash-build-integration:build-status-common-resources', location = '/static/common/build-status-common.soy' */
// This file was automatically generated from build-status-common.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.build.status.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.build == 'undefined') {
    stash.build = {};
}
if (typeof stash.build.status == 'undefined') {
    stash.build.status = {};
}

stash.build.status.summaryIcon = function(opt_data, opt_ignored) {
    return '' + ((opt_data.stats.failed > 0) ? stash.build.status.failedBuildIcon({
        clickable: true,
        title: '' + stash.build.status.title(opt_data)
    }) : (opt_data.stats.inProgress > 0) ? stash.build.status.inProgressBuildIcon({
        clickable: true,
        title: '' + stash.build.status.title(opt_data)
    }) : (opt_data.stats.successful > 0) ? stash.build.status.successfulBuildIcon({
        clickable: true,
        title: '' + stash.build.status.title(opt_data)
    }) : '');
}
;
if (goog.DEBUG) {
    stash.build.status.summaryIcon.soyTemplateName = 'stash.build.status.summaryIcon';
}

stash.build.status.title = function(opt_data, opt_ignored) {
    return '' + ((opt_data.stats.failed >= 1) ? soy.$$escapeHtml(AJS.format("{0} {0,choice,1#build|1\x3cbuilds} failed", opt_data.stats.failed)) : (opt_data.stats.inProgress >= 1) ? soy.$$escapeHtml(AJS.format("{0} {0,choice,1#build|1\x3cbuilds} in progress", opt_data.stats.inProgress)) : (opt_data.stats.successful >= 1) ? soy.$$escapeHtml(AJS.format("{0} {0,choice,1#build|1\x3cbuilds} passed", opt_data.stats.successful)) : '');
}
;
if (goog.DEBUG) {
    stash.build.status.title.soyTemplateName = 'stash.build.status.title';
}

stash.build.status.dialogList = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.statuses.length == 0) {
        output += stash.widget.focusMessage.message({
            title: "None found",
            text: "There are no build results available for this changeset."
        });
    } else {
        output += '<ul class="build-status-list">';
        var statusList38 = opt_data.statuses;
        var statusListLen38 = statusList38.length;
        for (var statusIndex38 = 0; statusIndex38 < statusListLen38; statusIndex38++) {
            var statusData38 = statusList38[statusIndex38];
            output += '<li>';
            switch (statusData38.state) {
            case 'SUCCESSFUL':
                output += stash.build.status.successfulBuildIcon({
                    content: "Build successful",
                    title: "Build successful"
                });
                break;
            case 'FAILED':
                output += stash.build.status.failedBuildIcon({
                    content: "Build failed",
                    title: "Build failed"
                });
                break;
            case 'INPROGRESS':
                output += stash.build.status.inProgressBuildIcon({
                    content: "Build in progress",
                    title: "Build in progress"
                });
                break;
            }
            output += '<div class="summary"><span class="name"><a href="' + soy.$$escapeHtml(statusData38.url) + '" target="_blank" title="' + stash.build.status.buildName({
                status: statusData38
            }) + '">' + stash.build.status.buildName({
                status: statusData38
            }) + '</a></span>' + stash.widget.date.shortAge({
                date: statusData38.dateAdded,
                extraClasses: 'date-added'
            }) + '</div>' + stash.build.status.buildDescription({
                status: statusData38
            }) + '</li>';
        }
        output += '</ul>';
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.build.status.dialogList.soyTemplateName = 'stash.build.status.dialogList';
}

stash.build.status.buildLabel = function(opt_data, opt_ignored) {
    var output = '';
    switch (opt_data.status) {
    case 'FAILED':
        output += soy.$$escapeHtml(AJS.format("{0,choice,1#build|1\x3cbuilds} failed", opt_data.count));
        break;
    case 'INPROGRESS':
        output += soy.$$escapeHtml(AJS.format("{0,choice,1#build|1\x3cbuilds} in progress", opt_data.count));
        break;
    case 'SUCCESSFUL':
        output += soy.$$escapeHtml(AJS.format("{0,choice,1#build|1\x3cbuilds}", opt_data.count));
        break;
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.build.status.buildLabel.soyTemplateName = 'stash.build.status.buildLabel';
}

stash.build.status.successfulBuildIcon = function(opt_data, opt_ignored) {
    return '' + stash.build.status.buildIcon(soy.$$augmentMap(opt_data, {
        iconClasses: 'aui-iconfont-approve successful-build-icon'
    }));
}
;
if (goog.DEBUG) {
    stash.build.status.successfulBuildIcon.soyTemplateName = 'stash.build.status.successfulBuildIcon';
}

stash.build.status.failedBuildIcon = function(opt_data, opt_ignored) {
    return '' + stash.build.status.buildIcon(soy.$$augmentMap(opt_data, {
        iconClasses: 'aui-iconfont-error failed-build-icon'
    }));
}
;
if (goog.DEBUG) {
    stash.build.status.failedBuildIcon.soyTemplateName = 'stash.build.status.failedBuildIcon';
}

stash.build.status.inProgressBuildIcon = function(opt_data, opt_ignored) {
    return '' + stash.build.status.buildIcon(soy.$$augmentMap(opt_data, {
        iconClasses: 'aui-iconfont-time inprogress-build-icon'
    }));
}
;
if (goog.DEBUG) {
    stash.build.status.inProgressBuildIcon.soyTemplateName = 'stash.build.status.inProgressBuildIcon';
}

stash.build.status.buildIcon = function(opt_data, opt_ignored) {
    return '<' + soy.$$filterNoAutoescape(opt_data.clickable ? 'a href="#"' : 'span') + ' class="aui-icon aui-icon-small build-icon ' + soy.$$escapeHtml(opt_data.iconClasses) + '"' + ((opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '') + '>' + ((opt_data.content) ? soy.$$escapeHtml(opt_data.content) : '') + '</' + soy.$$filterNoAutoescape(opt_data.clickable ? 'a' : 'span') + '>';
}
;
if (goog.DEBUG) {
    stash.build.status.buildIcon.soyTemplateName = 'stash.build.status.buildIcon';
}

stash.build.status.buildName = function(opt_data, opt_ignored) {
    return '' + soy.$$escapeHtml(opt_data.status.name ? opt_data.status.name : opt_data.status.key);
}
;
if (goog.DEBUG) {
    stash.build.status.buildName.soyTemplateName = 'stash.build.status.buildName';
}

stash.build.status.buildDescription = function(opt_data, opt_ignored) {
    return '<div class="description" title="' + soy.$$escapeHtml(opt_data.status.description ? opt_data.status.description : '') + '">' + soy.$$escapeHtml(opt_data.status.description ? opt_data.status.description : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.build.status.buildDescription.soyTemplateName = 'stash.build.status.buildDescription';
}

stash.build.status.placeholder = function(opt_data, opt_ignored) {
    return '<div id="build-status-placeholder" class="hidden"></div>';
}
;
if (goog.DEBUG) {
    stash.build.status.placeholder.soyTemplateName = 'stash.build.status.placeholder';
}

stash.build.status.stats = function(opt_data, opt_ignored) {
    return '' + stash.build.status.statsPanel({
        stats: opt_data.stats,
        build: opt_data.stats.results && opt_data.stats.results.length == 1 ? opt_data.stats.results[0] : null
    });
}
;
if (goog.DEBUG) {
    stash.build.status.stats.soyTemplateName = 'stash.build.status.stats';
}

stash.build.status.statsPanel = function(opt_data, opt_ignored) {
    return '' + ((opt_data.stats.failed > 0) ? stash.build.status.summary({
        build: opt_data.build,
        buildIconContent: '' + stash.build.status.failedBuildIcon({
            clickable: true
        }),
        count: opt_data.stats.failed,
        status: 'FAILED'
    }) : (opt_data.stats.inProgress > 0) ? stash.build.status.summary({
        build: opt_data.build,
        buildIconContent: '' + stash.build.status.inProgressBuildIcon({
            clickable: true
        }),
        count: opt_data.stats.inProgress,
        status: 'INPROGRESS'
    }) : (opt_data.stats.successful > 0) ? stash.build.status.summary({
        build: opt_data.build,
        buildIconContent: '' + stash.build.status.successfulBuildIcon({
            clickable: true
        }),
        count: opt_data.stats.successful,
        status: 'SUCCESSFUL'
    }) : '');
}
;
if (goog.DEBUG) {
    stash.build.status.statsPanel.soyTemplateName = 'stash.build.status.statsPanel';
}

stash.build.status.summary = function(opt_data, opt_ignored) {
    return '' + stash.widget.summaryPanel.relatedEntitiesWebPanel({
        iconClass: 'aui-icon-small aui-iconfont-build',
        iconText: "Build status",
        iconTooltip: "Builds",
        linkHref: opt_data.build ? opt_data.build.url : null,
        linkExtraAttributes: opt_data.build ? 'data-single-build=true' : null,
        linkText: '' + stash.build.status.buildLabel(opt_data),
        count: opt_data.count,
        extraClasses: 'build-status-summary',
        extraContent: '' + soy.$$filterNoAutoescape(opt_data.buildIconContent)
    });
}
;
if (goog.DEBUG) {
    stash.build.status.summary.soyTemplateName = 'stash.build.status.summary';
}
;;/* module-key = 'com.atlassian.stash.stash-build-integration:build-status-common-resources', location = '/static/common/build-status-dialog.js' */
define("build/status/dialog", ["aui", "jquery", "util/ajax", "util/dom-event"], function(j, d, i, b) {
    var k = "build-status-dialog"
      , e = "build-status-dialog-panel";
    function n() {
        this._instance = null;
        this._xhr = null
    }
    n.prototype.bindTo = function(p, s, q, r) {
        var o = this;
        d(p).on(q, s, function(t) {
            if (!b.openInSameTab(t) && !!d(this).data("single-build")) {
                return
            }
            t.preventDefault();
            o.showFor(r(d(this)))
        })
    }
    ;
    n.prototype.showFor = function(o) {
        if (this._instance) {
            this._instance.remove()
        }
        var p = d('<div class="spinner"></div>');
        this._instance = l(this, p);
        this._instance.show();
        p.show().spin("large");
        h(this, o).always(function() {
            p.spinStop().remove()
        })
    }
    ;
    function c(o) {
        if (o._instance) {
            o._instance.hide()
        }
    }
    function m(o) {
        if (o._xhr) {
            o._xhr.abort()
        }
    }
    function l(o, p) {
        var q = new j.Dialog({
            closeOnOutsideClick: true,
            id: k,
            height: 240,
            width: 600,
            keypressListener: function(r) {
                if (r.keyCode === j.keyCode.ESCAPE) {
                    c(o)
                }
            }
        }).addHeader("Builds").addPanel("", p, e).addLink("Close", function() {
            c(o)
        });
        d(document).one("hideLayer", function() {
            f(o)
        });
        return q
    }
    function h(p, o) {
        p._xhr = i.rest({
            url: g(o)
        }).fail(function() {
            c(p)
        }).done(function(q) {
            a(p, stash.build.status.dialogList({
                statuses: q.values
            }))
        }).always(function() {
            p._xhr = null
        });
        return p._xhr
    }
    function g(o) {
        return j.contextPath() + "/rest/build-status/latest/commits/" + encodeURIComponent(o)
    }
    function f(o) {
        m(o);
        if (o._instance) {
            o._instance.remove();
            o._instance = null
        }
    }
    function a(o, p) {
        o._instance.getCurrentPanel().html(p);
        o._instance.updateHeight()
    }
    return n
});
;;/* module-key = 'com.atlassian.stash.stash-build-integration:build-status-common-resources', location = '/static/common/build-status-common.js' */
define("build/status/build-status", ["aui", "build/status/dialog", "jquery", "util/ajax", "exports"], function(d, a, h, g, c) {
    var e = new a();
    var b = false;
    function f(i) {
        return d.contextPath() + "/rest/build-status/latest/commits/stats/" + encodeURIComponent(i)
    }
    c.fetchContext = function(i) {
        c.queryBuildStatusAndDecorate(i, "#build-status-placeholder", ".build-status-summary a", stash.build.status.stats)
    }
    ;
    c.queryBuildStatusAndDecorate = function(j, m, n, k, o) {
        var i = j.csid
          , l = j.includeUnique;
        g.rest({
            url: f(i),
            data: {
                includeUnique: !!l
            },
            statusCode: {
                "*": function() {
                    return false
                }
            }
        }).done(function(q) {
            var p = h(m);
            if (q.failed || q.inProgress || q.successful) {
                b = true;
                p.replaceWith(k({
                    stats: q
                }));
                e.bindTo(n, "", "click", function() {
                    return i
                });
                if (o) {
                    o(p)
                }
            } else {
                p.remove()
            }
        });
        return j
    }
    ;
    c.showDialogIfHasBuildStatus = function(i) {
        if (b) {
            e.showFor(i)
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-build-integration:build-status-commit-list', location = '/static/commit-list/build-status-commit-list.js' */
define("build/status/commit-list", ["aui", "build/status/dialog", "jquery", "util/ajax", "util/events", "model/page-state"], function(l, o, d, j, n, k) {
    var a = ".build-status-commit-list-col"
      , f = ".commits-table thead .build-status-commit-list-col"
      , m = ".build-icon"
      , c = new o()
      , i = "changesetid"
      , h = "data-" + i;
    function g() {
        return l.contextPath() + "/rest/build-status/latest/commits/stats"
    }
    function e(r, q) {
        var p = false;
        q.each(function() {
            var s = d(this)
              , v = s.find(a)
              , t = s.data(i)
              , u = r[t];
            if (u) {
                v.html(stash.build.status.summaryIcon({
                    stats: u
                })).find(m).tooltip({
                    gravity: "ne",
                    html: false
                });
                p = true
            }
        });
        if (p) {
            d(f).show()
        }
    }
    function b(p) {
        return p.map(function() {
            return d(this).data(i)
        }).toArray()
    }
    c.bindTo(d(document), ".build-status-commit-list-col .build-icon", "click", function(p) {
        return d(p).closest("[" + h + "]").data(i)
    });
    n.on("stash.widget.commitsTable.contentAdded", function(q) {
        if (!k.getCurrentUser()) {
            return
        }
        var p = q.values;
        j.rest({
            url: g(),
            type: "POST",
            data: b(p),
            statusCode: {
                "*": function() {
                    return false
                }
            }
        }).done(function(r) {
            e(r, p)
        })
    })
});
require("build/status/commit-list");
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:expanding-textarea', location = '/static/bower/ExpandingTextareas/expanding.js' */
(function(A) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], A)
    } else {
        A(jQuery)
    }
}(function(E) {
    E.expandingTextarea = E.extend({
        autoInitialize: true,
        initialSelector: "textarea.expanding",
        opts: {
            resize: function() {}
        }
    }, E.expandingTextarea || {});
    var D = ["lineHeight", "textDecoration", "letterSpacing", "fontSize", "fontFamily", "fontStyle", "fontWeight", "textTransform", "textAlign", "direction", "wordSpacing", "fontSizeAdjust", "wordWrap", "word-break", "borderLeftWidth", "borderRightWidth", "borderTopWidth", "borderBottomWidth", "paddingLeft", "paddingRight", "paddingTop", "paddingBottom", "marginLeft", "marginRight", "marginTop", "marginBottom", "boxSizing", "webkitBoxSizing", "mozBoxSizing", "msBoxSizing"];
    var C = {
        position: "absolute",
        height: "100%",
        resize: "none"
    };
    var F = {
        visibility: "hidden",
        border: "0 solid",
        whiteSpace: "pre-wrap"
    };
    var B = {
        position: "relative"
    };
    function A() {
        E(this).closest(".expandingText").find("div").text(this.value.replace(/\r\n/g, "\n") + " ");
        E(this).trigger("resize.expanding")
    }
    E.fn.expandingTextarea = function(H) {
        var G = E.extend({}, E.expandingTextarea.opts, H);
        if (H === "resize") {
            return this.trigger("input.expanding")
        }
        if (H === "destroy") {
            this.filter(".expanding-init").each(function() {
                var J = E(this).removeClass("expanding-init");
                var I = J.closest(".expandingText");
                I.before(J).remove();
                J.attr("style", J.data("expanding-styles") || "").removeData("expanding-styles")
            });
            return this
        }
        this.filter("textarea").not(".expanding-init").addClass("expanding-init").each(function() {
            var J = E(this);
            J.wrap("<div class='expandingText'></div>");
            J.after("<pre class='textareaClone'><div></div></pre>");
            var I = J.parent().css(B);
            var K = I.find("pre").css(F);
            J.data("expanding-styles", J.attr("style"));
            J.css(C);
            E.each(D, function(L, M) {
                var N = J.css(M);
                if (K.css(M) !== N) {
                    K.css(M, N)
                }
            });
            J.bind("input.expanding propertychange.expanding keyup.expanding", A);
            A.apply(this);
            if (G.resize) {
                J.bind("resize.expanding", G.resize)
            }
        });
        return this
    }
    ;
    E(function() {
        if (E.expandingTextarea.autoInitialize) {
            E(E.expandingTextarea.initialSelector).expandingTextarea()
        }
    })
}));
;;/* module-key = 'com.atlassian.auiplugin:aui-experimental-data-handlers', location = 'js/experimental-autocomplete/progressive-data-set.js' */
AJS.ProgressiveDataSet = Backbone.Collection.extend({
    initialize: function(b, a) {
        a || (a = {});
        a.matcher && (this.matcher = a.matcher);
        a.model && (this.model = a.model);
        this._idAttribute = (new this.model).idAttribute;
        this._maxResults = a.maxResults || 5;
        this._queryData = a.queryData || {};
        this._queryParamKey = a.queryParamKey || "q";
        this._queryEndpoint = a.queryEndpoint || "";
        this.value = null;
        this.queryCache = {};
        this.activeQueryCount = 0;
        _.bindAll(this, "query", "respond")
    },
    url: function() {
        return this._queryEndpoint
    },
    query: function(b) {
        var a, c;
        this.value = b;
        c = this.getFilteredResults(b);
        this.respond(b, c);
        b && (this._queryEndpoint && !this.hasQueryCache(b) && this.shouldGetMoreResults(c)) && (a = this.fetch(b),
        this.activeQueryCount++,
        this.trigger("activity", {
            activity: !0
        }),
        a.always(_.bind(function() {
            this.activeQueryCount--;
            this.trigger("activity", {
                activity: !!this.activeQueryCount
            })
        }, this)),
        a.done(_.bind(function(a, c, e) {
            this.addQueryCache(b, a, e)
        }, this)),
        a.done(_.bind(function() {
            b = this.value;
            c = this.getFilteredResults(b);
            this.respond(b, c)
        }, this)))
    },
    getQueryData: function(b) {
        var a = _.isFunction(this._queryData) ? this._queryData(b) : this._queryData
          , a = _.extend({}, a);
        a[this._queryParamKey] = b;
        return a
    },
    fetch: function(b) {
        b = {
            add: !0,
            update: !0,
            remove: !1,
            data: this.getQueryData(b)
        };
        return Backbone.Collection.prototype.fetch.call(this, b)
    },
    respond: function(b, a) {
        this.trigger("respond", {
            query: b,
            results: a
        });
        return a
    },
    matcher: function() {},
    getFilteredResults: function(b) {
        var a = [];
        if (!b)
            return a;
        a = this.filter(function(a) {
            return !!this.matcher(a, b)
        }, this);
        this._maxResults && (a = _.first(a, this._maxResults));
        return a
    },
    addQueryCache: function(b, a, c) {
        var d = this.queryCache
          , a = this.parse(a, c);
        d[b] = _.pluck(a, this._idAttribute)
    },
    hasQueryCache: function(b) {
        return this.queryCache.hasOwnProperty(b)
    },
    findQueryCache: function(b) {
        return this.queryCache[b]
    },
    shouldGetMoreResults: function(b) {
        return b.length < this._maxResults
    },
    setMaxResults: function(b) {
        this._maxResults = b;
        this.value && this.respond(this.value, this.getFilteredResults(this.value))
    }
});
"function" === typeof window.define && define("experimental-autocomplete/progressive-data-set", [], function() {
    return window.AJS.ProgressiveDataSet
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:ajs-progressive-dataset', location = '/static/lib/AJS.progressive-dataset-AMD.js' */
define("aui/progressive-dataset", ["aui"], function(A) {
    return A.ProgressiveDataSet
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:person-model', location = '/static/model/person.js' */
define("model/person", ["backbone-brace"], function(A) {
    return A.Model.extend({
        namedAttributes: {
            emailAddress: "string",
            name: "string"
        },
        idAttribute: "name",
        initialize: function() {
            if (this.namedAttributes.id == null) {
                this.setId(this.attributes[this.idAttribute])
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:stash-user-model', location = '/static/model/stash-user.js' */
define("model/stash-user", ["model/person"], function(B) {
    var A = B.extend({
        namedAttributes: {
            active: "boolean",
            avatarUrl: "string",
            displayName: "string",
            id: "number",
            isAdmin: "boolean",
            link: Object,
            links: Object,
            type: "string",
            slug: "string"
        }
    });
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:autocomplete-dialog', location = '/static/widget/autocomplete-dialog/autocomplete-dialog.js' */
define("widget/autocomplete-dialog", ["backbone", "jquery", "lodash"], function(C, B, A) {
    return C.View.extend({
        className: "aui-dropdown2 aui-style-default aui-dropdown2-tailed",
        initialize: function() {
            var D = parseInt(this.options.minZIndex, 10);
            if (D) {
                this.$el.css("z-index", D + 1)
            }
            B(document.body).append(this.el);
            if (this.options.anchor) {
                this.updateAnchorPosition(this.options.anchor)
            }
            this.template = this.options.template || B.noop;
            this.highlighter = this.options.highlighter;
            this.collection = this.collection || new C.Collection();
            this.collection.bind("reset", this.render, this);
            this.render()
        },
        events: {
            "click li.result": "onClickItem"
        },
        render: function() {
            var F = this.collection.toJSON()
              , G = this.collection.query
              , E = this.collection.indexOf(this.selectedResult);
            var D = B(this.template({
                query: G,
                results: F,
                activeItemIndex: (E >= 0) ? E : 0
            }));
            if (G && F.length && A.isFunction(this.highlighter)) {
                D = this.highlighter(D, G)
            }
            this.$el.html(D);
            if (this.$spinner) {
                this.$spinner.appendTo(this.$("ul"))
            }
            return this
        },
        toggleSpinner: function(D) {
            if (D) {
                if (!this.$spinner) {
                    this.$spinner = B("<li/>").addClass("spinContainer").appendTo(this.$("ul")).spin("small")
                }
            } else {
                this.$spinner && this.$spinner.spinStop().remove();
                this.$spinner = null
            }
        },
        moveSelectionUp: function() {
            this.moveSelection(this.DIRECTION_UP)
        },
        moveSelectionDown: function() {
            this.moveSelection(this.DIRECTION_DOWN)
        },
        moveSelection: function(G) {
            var H = this.$("li");
            if (H.length <= 1) {
                return
            }
            var F = H.filter(".active")
              , D = B.inArray(F.get(0), H)
              , E = "active";
            if ((G === this.DIRECTION_DOWN) ? (D < H.length - 1) : (D > 0)) {
                D = D + G;
                H.removeClass(E).eq(D).addClass(E);
                this.selectedResult = this.collection.at(D)
            }
        },
        getSelectedItemIndex: function() {
            return this.$("li.active").index()
        },
        onClickItem: function(D) {
            this.trigger("itemSelected", this.$(D.currentTarget).index())
        },
        anchorOptions: {
            dropdownTailBufferLeft: 25,
            dropdownTailBufferRight: 35,
            viewportWidth: B(window).width(),
            bufferTop: 2
        },
        updateAnchorPosition: function(D) {
            if (this.anchorOptions.viewportWidth - D.left > this.$el.outerWidth()) {
                this.$el.css({
                    top: D.top + this.anchorOptions.bufferTop,
                    left: D.left - this.anchorOptions.dropdownTailBufferLeft
                }).attr("data-dropdown2-alignment", "left")
            } else {
                this.$el.css({
                    top: D.top + this.anchorOptions.bufferTop,
                    left: D.left - this.$el.outerWidth() + this.anchorOptions.dropdownTailBufferRight
                }).attr("data-dropdown2-alignment", "right")
            }
        },
        DIRECTION_UP: -1,
        DIRECTION_DOWN: 1
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:user-link', location = '/static/widget/user/user-link.soy' */
// This file was automatically generated from user-link.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.userLink = function(opt_data, opt_ignored) {
    var output = '';
    var displayName__soy3 = opt_data.user.displayName || opt_data.user.name;
    output += (opt_data.href || opt_data.user.type == 'NORMAL' && opt_data.user.slug && !!(require('model/page-state').getCurrentUser())) ? '<a href="' + soy.$$escapeHtml(opt_data.href ? opt_data.href : require('stash/api/util/navbuilder').user(opt_data.user.slug).build()) + '" ' + ((opt_data.extraClasses) ? 'class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"' : '') + ((!opt_data.skipTitle) ? 'title="' + soy.$$escapeHtml(displayName__soy3) + '"' : '') + '>' + soy.$$escapeHtml(soy.$$truncate(displayName__soy3, 100, true)) + '</a>' : '<span' + ((opt_data.extraClasses) ? ' class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"' : '') + ((!opt_data.skipTitle) ? ' title="' + soy.$$escapeHtml(displayName__soy3) + '"' : '') + '>' + soy.$$escapeHtml(soy.$$truncate(displayName__soy3, 100, true)) + '</span>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.userLink.soyTemplateName = 'stash.widget.userLink';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:avatar', location = '/static/widget/avatar/avatar.soy' */
// This file was automatically generated from avatar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.avatar = function(opt_data, opt_ignored) {
    return '' + aui.avatar.avatar({
        size: opt_data.size,
        avatarImageUrl: require('stash/api/util/navbuilder')._avatarUrl(opt_data.person, ({
            XSMALL: 32,
            SMALL: 48,
            MEDIUM: 64,
            LARGE: 96,
            XLARGE: 128,
            XXLARGE: 192,
            XXXLARGE: 256
        })[opt_data.size.toUpperCase()]).build(),
        accessibilityText: opt_data.person.displayName || opt_data.person.name,
        title: opt_data.tooltip,
        badgeContent: opt_data.badgeContent,
        extraClasses: 'user-avatar' + (opt_data.hideBadge ? ' badge-hidden' : '') + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        imageClasses: opt_data.imageClasses,
        extraAttributes: {
            'data-username': opt_data.person.name
        },
        id: opt_data.id
    });
}
;
if (goog.DEBUG) {
    stash.widget.avatar.soyTemplateName = 'stash.widget.avatar';
}

stash.widget.avatarWithName = function(opt_data, opt_ignored) {
    var output = '';
    var personName__soy14 = opt_data.person.displayName || opt_data.person.name;
    output += '<div class="avatar-with-name' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '" title="' + soy.$$escapeHtml(personName__soy14) + '">' + stash.widget.avatar({
        size: opt_data.size,
        person: opt_data.person,
        imageClasses: opt_data.imageClasses,
        extraClasses: opt_data.avatarClasses,
        badgeContent: opt_data.badgeContent,
        hideBadge: opt_data.hideBadge,
        id: opt_data.id
    }) + ((opt_data.link) ? stash.widget.userLink({
        user: opt_data.person,
        href: opt_data.href,
        extraClasses: opt_data.linkExtraClasses,
        skipTitle: true
    }) : soy.$$escapeHtml(personName__soy14)) + '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.avatarWithName.soyTemplateName = 'stash.widget.avatarWithName';
}

stash.widget.avatarWithNameAndEmail = function(opt_data, opt_ignored) {
    return stash.widget.avatarWithName(opt_data) + '<span class="email-address" title="' + soy.$$escapeHtml(opt_data.person.emailAddress) + '">' + soy.$$escapeHtml(opt_data.person.emailAddress) + '</span>';
}
;
if (goog.DEBUG) {
    stash.widget.avatarWithNameAndEmail.soyTemplateName = 'stash.widget.avatarWithNameAndEmail';
}

stash.widget.avatarSizeInPx = function(opt_data, opt_ignored) {
    return '' + soy.$$escapeHtml(({
        XSMALL: 32,
        SMALL: 48,
        MEDIUM: 64,
        LARGE: 96,
        XLARGE: 128,
        XXLARGE: 192,
        XXXLARGE: 256
    })[opt_data.size.toUpperCase()]) + ((opt_data.showPx) ? 'px' : '');
}
;
if (goog.DEBUG) {
    stash.widget.avatarSizeInPx.soyTemplateName = 'stash.widget.avatarSizeInPx';
}

stash.widget.avatarWithBadge = function(opt_data, opt_ignored) {
    return '' + stash.widget.avatar({
        size: opt_data.size,
        person: opt_data.person,
        tooltip: opt_data.tooltip,
        imageClasses: opt_data.imageClasses,
        extraClasses: opt_data.extraClasses,
        id: opt_data.id,
        hideBadge: opt_data.hideBadge,
        badgeContent: '<span class="badge' + soy.$$escapeHtml(opt_data.badgeClasses ? ' ' + opt_data.badgeClasses : '') + '">' + soy.$$escapeHtml(opt_data.badgeText) + '</span>'
    });
}
;
if (goog.DEBUG) {
    stash.widget.avatarWithBadge.soyTemplateName = 'stash.widget.avatarWithBadge';
}

stash.widget.avatarWithNameAndBadge = function(opt_data, opt_ignored) {
    return '' + stash.widget.avatarWithName({
        size: opt_data.size,
        person: opt_data.person,
        extraClasses: opt_data.extraClasses,
        avatarClasses: opt_data.avatarClasses,
        imageClasses: opt_data.imageClasses,
        id: opt_data.id,
        hideBadge: opt_data.hideBadge,
        badgeContent: '<span class="badge' + soy.$$escapeHtml(opt_data.badgeClasses ? ' ' + opt_data.badgeClasses : '') + '">' + soy.$$escapeHtml(opt_data.badgeText) + '</span>'
    });
}
;
if (goog.DEBUG) {
    stash.widget.avatarWithNameAndBadge.soyTemplateName = 'stash.widget.avatarWithNameAndBadge';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:avatar', location = '/static/widget/avatar/group-avatar.soy' */
// This file was automatically generated from group-avatar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.groupAvatar = function(opt_data, opt_ignored) {
    return '<span class="aui-avatar aui-avatar-' + soy.$$escapeHtml(opt_data.size) + ' group-avatar' + soy.$$escapeHtml(opt_data.extraClasses ? ' ' + opt_data.extraClasses : '') + '" data-groupname="' + soy.$$escapeHtml(opt_data.name) + '"></span>';
}
;
if (goog.DEBUG) {
    stash.widget.groupAvatar.soyTemplateName = 'stash.widget.groupAvatar';
}

stash.widget.groupAvatarWithName = function(opt_data, opt_ignored) {
    return '<span title="' + soy.$$escapeHtml(opt_data.name) + '"' + ((opt_data.extraClasses) ? ' class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"' : '') + '><span class="aui-avatar aui-avatar-' + soy.$$escapeHtml(opt_data.size) + ' group-avatar' + soy.$$escapeHtml(opt_data.avatarClasses ? ' ' + opt_data.avatarClasses : '') + '" data-groupname="' + soy.$$escapeHtml(opt_data.name) + '"></span>' + soy.$$escapeHtml(opt_data.name) + '</span>';
}
;
if (goog.DEBUG) {
    stash.widget.groupAvatarWithName.soyTemplateName = 'stash.widget.groupAvatarWithName';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:textarea-caret-position', location = '/static/bower/textarea-caret-position/index.js' */
define("textarea-caret-position", function() {
    var B = ["direction", "boxSizing", "width", "height", "overflowX", "overflowY", "borderTopWidth", "borderRightWidth", "borderBottomWidth", "borderLeftWidth", "paddingTop", "paddingRight", "paddingBottom", "paddingLeft", "fontStyle", "fontVariant", "fontWeight", "fontStretch", "fontSize", "fontSizeAdjust", "lineHeight", "fontFamily", "textAlign", "textTransform", "textIndent", "textDecoration", "letterSpacing", "wordSpacing"];
    var C = !(window.mozInnerScreenX == null);
    var A = function(F, D, E) {
        var K = document.createElement("div");
        K.id = "input-textarea-caret-position-mirror-div";
        document.body.appendChild(K);
        var H = K.style;
        var I = window.getComputedStyle ? getComputedStyle(F) : F.currentStyle;
        H.whiteSpace = "pre-wrap";
        if (F.nodeName !== "INPUT") {
            H.wordWrap = "break-word"
        }
        H.position = "absolute";
        H.visibility = "hidden";
        B.forEach(function(L) {
            H[L] = I[L]
        });
        if (C) {
            H.width = parseInt(I.width) - 2 + "px";
            if (F.scrollHeight > parseInt(I.height)) {
                H.overflowY = "scroll"
            }
        } else {
            H.overflow = "hidden"
        }
        K.textContent = F.value.substring(0, D);
        if (F.nodeName === "INPUT") {
            K.textContent = K.textContent.replace(/\s/g, "\u00a0")
        }
        var G = document.createElement("span");
        G.textContent = F.value.substring(D) || ".";
        K.appendChild(G);
        var J = {
            top: G.offsetTop + parseInt(I.borderTopWidth),
            left: G.offsetLeft + parseInt(I.borderLeftWidth)
        };
        document.body.removeChild(K);
        return J
    };
    if (typeof Package !== "undefined") {
        getCaretCoordinates = A
    } else {
        if (typeof module !== "undefined" && module.exports) {
            module.exports = A
        } else {
            return A
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:xregexp', location = '/static/bower/xregexp/src/xregexp.js' */
/*
 * XRegExp 3.0.0-pre
 * <http://xregexp.com/>
 * Steven Levithan ï¿½ 2007-2012 MIT License
 */
var XRegExp = (function(I) {
    var L = "xregexp", U, J = {
        astral: false,
        natives: false
    }, a = {
        exec: RegExp.prototype.exec,
        test: RegExp.prototype.test,
        match: String.prototype.match,
        replace: String.prototype.replace,
        split: String.prototype.split
    }, F = {}, S = {}, B = {}, R = [], C = "default", O = "class", g = {
        "default": /\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\d*|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|\(\?[:=!]|[?*+]\?|{\d+(?:,\d*)?}\??|[\s\S]/,
        "class": /\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\dA-Fa-f]{2}|u[\dA-Fa-f]{4}|c[A-Za-z]|[\s\S])|[\s\S]/
    }, f = /\$(?:{([\w$]+)}|(\d\d?|[\s\S]))/g, b = a.exec.call(/()??/, "")[1] === I, N = RegExp.prototype.sticky !== I, e = {
        g: true,
        i: true,
        m: true,
        y: N
    }, Z = {}.toString, T;
    function d(j, h, i) {
        var k;
        if (i) {
            if (j.__proto__) {
                j.__proto__ = U.prototype
            } else {
                for (k in U.prototype) {
                    j[k] = U.prototype[k]
                }
            }
        }
        j[L] = {
            captureNames: h
        };
        return j
    }
    function M(h) {
        return a.replace.call(h, /([\s\S])(?=[\s\S]*\1)/g, "")
    }
    function Y(j, i) {
        if (!U.isRegExp(j)) {
            throw new TypeError("Type RegExp expected")
        }
        var h = a.exec.call(/\/([a-z]*)$/i, String(j))[1];
        i = i || {};
        if (i.add) {
            h = M(h + i.add)
        }
        if (i.remove) {
            h = a.replace.call(h, new RegExp("[" + i.remove + "]+","g"), "")
        }
        j = d(new RegExp(j.source,h), K(j) ? j[L].captureNames.slice(0) : null, i.addProto);
        return j
    }
    function V() {
        return {
            captureNames: null
        }
    }
    function K(h) {
        return !!(h[L] && h[L].captureNames)
    }
    function A(l, k) {
        if (Array.prototype.indexOf) {
            return l.indexOf(k)
        }
        var h = l.length, j;
        for (j = 0; j < h; ++j) {
            if (l[j] === k) {
                return j
            }
        }
        return -1
    }
    function G(i, h) {
        return Z.call(i) === "[object " + h + "]"
    }
    function X(i, j, h) {
        return a.test.call(h.indexOf("x") > -1 ? /^(?:\s+|#.*|\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/ : /^(?:\(\?#[^)]*\))*(?:[?*+]|{\d+(?:,\d*)?})/, i.slice(j))
    }
    function E(k, h) {
        var j;
        if (M(h) !== h) {
            throw new SyntaxError("Invalid duplicate regex flag " + h)
        }
        k = a.replace.call(k, /^\(\?([\w$]+)\)/, function(l, i) {
            if (a.test.call(/[gy]/, i)) {
                throw new SyntaxError("Cannot use flag g or y in mode modifier " + l)
            }
            h = M(h + i);
            return ""
        });
        for (j = 0; j < h.length; ++j) {
            if (!e[h.charAt(j)]) {
                throw new SyntaxError("Unknown regex flag " + h.charAt(j))
            }
        }
        return {
            pattern: k,
            flags: h
        }
    }
    function P(h) {
        h = h || {};
        if (G(h, "String")) {
            h = U.forEach(h, /[^\s,]+/, function(i) {
                this[i] = true
            }, {})
        }
        return h
    }
    function H(h) {
        if (!/^[\w$]$/.test(h)) {
            throw new Error("Flag must be a single character A-Za-z0-9_$")
        }
        e[h] = true
    }
    function D(m, j, n, p, h) {
        var k = R.length, q = null, l, o;
        while (k--) {
            o = R[k];
            if ((o.scope === p || o.scope === "all") && (!o.flag || j.indexOf(o.flag) > -1)) {
                l = U.exec(m, o.regex, n, "sticky");
                if (l) {
                    q = {
                        matchLength: l[0].length,
                        output: o.handler.call(h, l, p, j),
                        reparse: o.reparse
                    };
                    break
                }
            }
        }
        return q
    }
    function Q(h) {
        U.cache.flush("patterns");
        J.astral = h
    }
    function c(h) {
        RegExp.prototype.exec = (h ? F : a).exec;
        RegExp.prototype.test = (h ? F : a).test;
        String.prototype.match = (h ? F : a).match;
        String.prototype.replace = (h ? F : a).replace;
        String.prototype.split = (h ? F : a).split;
        J.natives = h
    }
    function W(h) {
        if (h == null) {
            throw new TypeError("Cannot convert null or undefined to object")
        }
        return h
    }
    U = function(l, j) {
        var h = {
            hasNamedCapture: false,
            captureNames: []
        }, o = C, i = "", m = 0, p, k, n;
        if (U.isRegExp(l)) {
            if (j !== I) {
                throw new TypeError("Cannot supply flags when copying a RegExp")
            }
            return Y(l, {
                addProto: true
            })
        }
        l = l === I ? "" : String(l);
        j = j === I ? "" : String(j);
        n = l + "***" + j;
        if (!B[n]) {
            p = E(l, j);
            l = p.pattern;
            j = p.flags;
            while (m < l.length) {
                do {
                    p = D(l, j, m, o, h);
                    if (p && p.reparse) {
                        l = l.slice(0, m) + p.output + l.slice(m + p.matchLength)
                    }
                } while (p && p.reparse);if (p) {
                    i += p.output;
                    m += (p.matchLength || 1)
                } else {
                    k = U.exec(l, g[o], m, "sticky")[0];
                    i += k;
                    m += k.length;
                    if (k === "[" && o === C) {
                        o = O
                    } else {
                        if (k === "]" && o === O) {
                            o = C
                        }
                    }
                }
            }
            B[n] = {
                pattern: a.replace.call(i, /\(\?:\)(?=\(\?:\))|^\(\?:\)|\(\?:\)$/g, ""),
                flags: a.replace.call(j, /[^gimy]+/g, ""),
                captures: h.hasNamedCapture ? h.captureNames : null
            }
        }
        n = B[n];
        return d(new RegExp(n.pattern,n.flags), n.captures, true)
    }
    ;
    U.prototype = new RegExp;
    U.version = "3.0.0-pre";
    U.addToken = function(m, l, j) {
        j = j || {};
        var h = j.optionalFlags, k;
        if (j.flag) {
            H(j.flag)
        }
        if (h) {
            h = a.split.call(h, "");
            for (k = 0; k < h.length; ++k) {
                H(h[k])
            }
        }
        R.push({
            regex: Y(m, {
                add: "g" + (N ? "y" : "")
            }),
            handler: l,
            scope: j.scope || C,
            flag: j.flag,
            reparse: j.reparse
        });
        U.cache.flush("patterns")
    }
    ;
    U.cache = function(j, h) {
        var i = j + "***" + (h || "");
        return S[i] || (S[i] = U(j, h))
    }
    ;
    U.cache.flush = function(h) {
        if (h === "patterns") {
            B = {}
        } else {
            S = {}
        }
    }
    ;
    U.escape = function(h) {
        return a.replace.call(W(h), /[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&")
    }
    ;
    U.exec = function(m, k, n, l) {
        var j = "g", i, h;
        if (N && (l || (k.sticky && l !== false))) {
            j += "y"
        }
        k[L] = k[L] || V();
        h = k[L][j] || (k[L][j] = Y(k, {
            add: j,
            remove: l === false ? "y" : ""
        }));
        h.lastIndex = n = n || 0;
        i = F.exec.call(h, m);
        if (l && i && i.index !== n) {
            i = null
        }
        if (k.global) {
            k.lastIndex = i ? h.lastIndex : 0
        }
        return i
    }
    ;
    U.forEach = function(m, l, o, k) {
        var n = 0, j = -1, h;
        while ((h = U.exec(m, l, n)) ) {
            o.call(k, h, ++j, m, l);
            n = h.index + (h[0].length || 1)
        }
        return k
    }
    ;
    U.globalize = function(h) {
        return Y(h, {
            add: "g",
            addProto: true
        })
    }
    ;
    U.install = function(h) {
        h = P(h);
        if (!J.astral && h.astral) {
            Q(true)
        }
        if (!J.natives && h.natives) {
            c(true)
        }
    }
    ;
    U.isInstalled = function(h) {
        return !!(J[h])
    }
    ;
    U.isRegExp = function(h) {
        return Z.call(h) === "[object RegExp]"
    }
    ;
    U.match = function(n, m, k) {
        var l = (m.global && k !== "one") || k === "all", j = (l ? "g" : "") + (m.sticky ? "y" : ""), h, i;
        m[L] = m[L] || V();
        i = m[L][j || "noGY"] || (m[L][j || "noGY"] = Y(m, {
            add: j,
            remove: k === "one" ? "g" : ""
        }));
        h = a.match.call(W(n), i);
        if (m.global) {
            m.lastIndex = ((k === "one" && h) ? (h.index + h[0].length) : 0)
        }
        return l ? (h || []) : (h && h[0])
    }
    ;
    U.matchChain = function(i, h) {
        return ( function j(k, p) {
            var n = h[p].regex ? h[p] : {
                regex: h[p]
            }, o = [], l = function(q) {
                if (n.backref) {
                    if (!(q.hasOwnProperty(n.backref) || +n.backref < q.length)) {
                        throw new ReferenceError("Backreference to undefined group: " + n.backref)
                    }
                    o.push(q[n.backref] || "")
                } else {
                    o.push(q[0])
                }
            }, m;
            for (m = 0; m < k.length; ++m) {
                U.forEach(k[m], n.regex, l)
            }
            return ((p === h.length - 1) || !o.length) ? o : j(o, p + 1)
        }([i], 0))
    }
    ;
    U.replace = function(k, p, i, n) {
        var l = U.isRegExp(p), h = (p.global && n !== "one") || n === "all", j = (h ? "g" : "") + (p.sticky ? "y" : ""), m = p, o;
        if (l) {
            p[L] = p[L] || V();
            m = p[L][j || "noGY"] || (p[L][j || "noGY"] = Y(p, {
                add: j,
                remove: n === "one" ? "g" : ""
            }))
        } else {
            if (h) {
                m = new RegExp(U.escape(String(p)),"g")
            }
        }
        o = F.replace.call(W(k), m, i);
        if (l && p.global) {
            p.lastIndex = 0
        }
        return o
    }
    ;
    U.replaceEach = function(l, j) {
        var h, k;
        for (h = 0; h < j.length; ++h) {
            k = j[h];
            l = U.replace(l, k[0], k[1], k[2])
        }
        return l
    }
    ;
    U.split = function(j, i, h) {
        return F.split.call(W(j), i, h)
    }
    ;
    U.test = function(j, h, k, i) {
        return !!U.exec(j, h, k, i)
    }
    ;
    U.uninstall = function(h) {
        h = P(h);
        if (J.astral && h.astral) {
            Q(false)
        }
        if (J.natives && h.natives) {
            c(false)
        }
    }
    ;
    U.union = function(h, k) {
        var l = /(\()(?!\?)|\\([1-9]\d*)|\\[\s\S]|\[(?:[^\\\]]|\\[\s\S])*]/g, j = [], n = 0, p, q, o, r = function(s, t, u) {
            var i = q[n - p];
            if (t) {
                ++n;
                if (i) {
                    return "(?<" + i + ">"
                }
            } else {
                if (u) {
                    return "\\" + (+u + p)
                }
            }
            return s
        }, m;
        if (!(G(h, "Array") && h.length)) {
            throw new TypeError("Must provide a nonempty array of patterns to merge")
        }
        for (m = 0; m < h.length; ++m) {
            o = h[m];
            if (U.isRegExp(o)) {
                p = n;
                q = (o[L] && o[L].captureNames) || [];
                j.push(a.replace.call(U(o.source).source, l, r))
            } else {
                j.push(U.escape(o))
            }
        }
        return U(j.join("|"), k)
    }
    ;
    F.exec = function(n) {
        var h = this.lastIndex, l = a.exec.apply(this, arguments), k, j, m;
        if (l) {
            if (!b && l.length > 1 && A(l, "") > -1) {
                j = Y(this, {
                    remove: "g"
                });
                a.replace.call(String(n).slice(l.index), j, function() {
                    var o = arguments.length, p;
                    for (p = 1; p < o - 2; ++p) {
                        if (arguments[p] === I) {
                            l[p] = I
                        }
                    }
                })
            }
            if (this[L] && this[L].captureNames) {
                for (m = 1; m < l.length; ++m) {
                    k = this[L].captureNames[m - 1];
                    if (k) {
                        l[k] = l[m]
                    }
                }
            }
            if (this.global && !l[0].length && (this.lastIndex > l.index)) {
                this.lastIndex = l.index
            }
        }
        if (!this.global) {
            this.lastIndex = h
        }
        return l
    }
    ;
    F.test = function(h) {
        return !!F.exec.call(this, h)
    }
    ;
    F.match = function(i) {
        var h;
        if (!U.isRegExp(i)) {
            i = new RegExp(i)
        } else {
            if (i.global) {
                h = a.match.apply(this, arguments);
                i.lastIndex = 0;
                return h
            }
        }
        return F.exec.call(i, W(this))
    }
    ;
    F.replace = function(k, l) {
        var m = U.isRegExp(k), i, j, h;
        if (m) {
            if (k[L]) {
                j = k[L].captureNames
            }
            i = k.lastIndex
        } else {
            k += ""
        }
        if (G(l, "Function")) {
            h = a.replace.call(String(this), k, function() {
                var n = arguments, o;
                if (j) {
                    n[0] = new String(n[0]);
                    for (o = 0; o < j.length; ++o) {
                        if (j[o]) {
                            n[0][j[o]] = n[o + 1]
                        }
                    }
                }
                if (m && k.global) {
                    k.lastIndex = n[n.length - 2] + n[0].length
                }
                return l.apply(I, n)
            })
        } else {
            h = a.replace.call(this == null ? this : String(this), k, function() {
                var n = arguments;
                return a.replace.call(String(l), f, function(p, o, r) {
                    var q;
                    if (o) {
                        q = +o;
                        if (q <= n.length - 3) {
                            return n[q] || ""
                        }
                        q = j ? A(j, o) : -1;
                        if (q < 0) {
                            throw new SyntaxError("Backreference to undefined group " + p)
                        }
                        return n[q + 1] || ""
                    }
                    if (r === "$") {
                        return "$"
                    }
                    if (r === "&" || +r === 0) {
                        return n[0]
                    }
                    if (r === "`") {
                        return n[n.length - 1].slice(0, n[n.length - 2])
                    }
                    if (r === "'") {
                        return n[n.length - 1].slice(n[n.length - 2] + n[0].length)
                    }
                    r = +r;
                    if (!isNaN(r)) {
                        if (r > n.length - 3) {
                            throw new SyntaxError("Backreference to undefined group " + p)
                        }
                        return n[r] || ""
                    }
                    throw new SyntaxError("Invalid token " + p)
                })
            })
        }
        if (m) {
            if (k.global) {
                k.lastIndex = 0
            } else {
                k.lastIndex = i
            }
        }
        return h
    }
    ;
    F.split = function(l, i) {
        if (!U.isRegExp(l)) {
            return a.split.apply(this, arguments)
        }
        var n = String(this), k = [], h = l.lastIndex, m = 0, j;
        i = (i === I ? -1 : i) >>> 0;
        U.forEach(n, l, function(o) {
            if ((o.index + o[0].length) > m) {
                k.push(n.slice(m, o.index));
                if (o.length > 1 && o.index < n.length) {
                    Array.prototype.push.apply(k, o.slice(1))
                }
                j = o[0].length;
                m = o.index + j
            }
        });
        if (m === n.length) {
            if (!a.test.call(l, "") || j) {
                k.push("")
            }
        } else {
            k.push(n.slice(m))
        }
        l.lastIndex = h;
        return k.length > i ? k.slice(0, i) : k
    }
    ;
    T = U.addToken;
    T(/\\([ABCE-RTUVXYZaeg-mopqyz]|c(?![A-Za-z])|u(?![\dA-Fa-f]{4})|x(?![\dA-Fa-f]{2}))/, function(h, i) {
        if (h[1] === "B" && i === C) {
            return h[0]
        }
        throw new SyntaxError("Invalid escape " + h[0])
    }, {
        scope: "all"
    });
    T(/\[(\^?)]/, function(h) {
        return h[1] ? "[\\s\\S]" : "\\b\\B"
    });
    T(/\(\?#[^)]*\)/, function(i, j, h) {
        return X(i.input, i.index + i[0].length, h) ? "" : "(?:)"
    });
    T(/\s+|#.*/, function(i, j, h) {
        return X(i.input, i.index + i[0].length, h) ? "" : "(?:)"
    }, {
        flag: "x"
    });
    T(/\./, function() {
        return "[\\s\\S]"
    }, {
        flag: "s"
    });
    T(/\\k<([\w$]+)>/, function(i) {
        var h = isNaN(i[1]) ? (A(this.captureNames, i[1]) + 1) : +i[1]
          , j = i.index + i[0].length;
        if (!h || h > this.captureNames.length) {
            throw new SyntaxError("Backreference to undefined group " + i[0])
        }
        return "\\" + h + (j === i.input.length || isNaN(i.input.charAt(j)) ? "" : "(?:)")
    });
    T(/\\(\d+)/, function(h, i) {
        if (!(i === C && /^[1-9]/.test(h[1]) && +h[1] <= this.captureNames.length) && h[1] !== "0") {
            throw new SyntaxError("Cannot use octal escape or backreference to undefined group " + h[0])
        }
        return h[0]
    }, {
        scope: "all"
    });
    T(/\(\?P?<([\w$]+)>/, function(h) {
        if (!isNaN(h[1])) {
            throw new SyntaxError("Cannot use integer as capture name " + h[0])
        }
        if (h[1] === "length" || h[1] === "__proto__") {
            throw new SyntaxError("Cannot use reserved word as capture name " + h[0])
        }
        if (A(this.captureNames, h[1]) > -1) {
            throw new SyntaxError("Cannot use same name for multiple groups " + h[0])
        }
        this.captureNames.push(h[1]);
        this.hasNamedCapture = true;
        return "("
    });
    T(/\((?!\?)/, function(i, j, h) {
        if (h.indexOf("n") > -1) {
            return "(?:"
        }
        this.captureNames.push(null);
        return "("
    }, {
        optionalFlags: "n"
    });
    return U
}());
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:xregexp', location = '/static/lib/xregexp/xregexp-AMD.js' */
define("xregexp", [], function() {
    return XRegExp
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:xregexp', location = '/static/bower/xregexp/src/addons/unicode/unicode-base.js' */
/*
 * XRegExp Unicode Base 3.0.0-pre
 * <http://xregexp.com/>
 * Steven Levithan ï¿½ 2008-2012 MIT License
 * Uses Unicode 6.2.0 <http://unicode.org/>
 * Unicode data generated by Mathias Bynens <http://mathiasbynens.be/>
 */
(function(H) {
    var A = {};
    function F(L) {
        return L.replace(/[- _]+/g, "").toLowerCase()
    }
    function I(L) {
        while (L.length < 4) {
            L = "0" + L
        }
        return L
    }
    function D(L) {
        return parseInt(L, 16)
    }
    function C(L) {
        return parseInt(L, 10).toString(16)
    }
    function J(M) {
        var L = /^\\[xu](.+)/.exec(M);
        return L ? D(L[1]) : M.charCodeAt(M.charAt(0) === "\\" ? 1 : 0)
    }
    function B(M) {
        var L = "", N = -1, O;
        H.forEach(M, /(\\x..|\\u....|\\?[\s\S])(?:-(\\x..|\\u....|\\?[\s\S]))?/, function(P) {
            O = J(P[1]);
            if (O > (N + 1)) {
                L += "\\u" + I(C(N + 1));
                if (O > (N + 2)) {
                    L += "-\\u" + I(C(O - 1))
                }
            }
            N = J(P[2] || P[1])
        });
        if (N < 65535) {
            L += "\\u" + I(C(N + 1));
            if (N < 65534) {
                L += "-\\uFFFF"
            }
        }
        return L
    }
    function E(L) {
        var M = "b!";
        return A[L][M] || (A[L][M] = B(A[L].bmp))
    }
    function G(L, M) {
        var O = A[L]
          , N = "";
        if (O.bmp && !O.isBmpLast) {
            N = "[" + O.bmp + "]" + (O.astral ? "|" : "")
        }
        if (O.astral) {
            N += O.astral
        }
        if (O.isBmpLast && O.bmp) {
            N += (O.astral ? "|" : "") + "[" + O.bmp + "]"
        }
        return M ? "(?:(?!" + N + ")(?:[\uD800-\uDBFF][\uDC00-\uDFFF]|[\0-\uFFFF]))" : "(?:" + N + ")"
    }
    function K(L, M) {
        var N = M ? "a!" : "a=";
        return A[L][N] || (A[L][N] = G(L, M))
    }
    H.addToken(/\\([pP])(?:{(\^?)([^}]*)}|([A-Za-z]))/, function(S, W, O) {
        var U = "Invalid double negation "
          , P = "Unknown Unicode token "
          , M = "Unicode token missing data "
          , N = "Astral mode required for Unicode token "
          , L = "Astral mode does not support Unicode tokens within character classes"
          , T = S[1] === "P" || !!S[2]
          , R = O.indexOf("A") > -1 || H.isInstalled("astral")
          , Q = F(S[4] || S[3])
          , V = A[Q];
        if (S[1] === "P" && S[2]) {
            throw new SyntaxError(U + S[0])
        }
        if (!A.hasOwnProperty(Q)) {
            throw new SyntaxError(P + S[0])
        }
        if (V.inverseOf) {
            Q = F(V.inverseOf);
            if (!A.hasOwnProperty(Q)) {
                throw new ReferenceError(M + S[0] + " -> " + V.inverseOf)
            }
            V = A[Q];
            T = !T
        }
        if (!(V.bmp || R)) {
            throw new SyntaxError(N + S[0])
        }
        if (R) {
            if (W === "class") {
                throw new SyntaxError(L)
            }
            return K(Q, T)
        }
        return W === "class" ? (T ? E(Q) : V.bmp) : (T ? "[^" : "[") + V.bmp + "]"
    }, {
        scope: "all",
        optionalFlags: "A"
    });
    H.addUnicodeData = function(P) {
        var L = "Unicode token requires name", O = "Unicode token has no character data ", N, M;
        for (M = 0; M < P.length; ++M) {
            N = P[M];
            if (!N.name) {
                throw new Error(L)
            }
            if (!(N.inverseOf || N.bmp || N.astral)) {
                throw new Error(O + N.name)
            }
            A[F(N.name)] = N;
            if (N.alias) {
                A[F(N.alias)] = N
            }
        }
        H.cache.flush("patterns")
    }
    ;
    H.addUnicodeData([{
        name: "L",
        alias: "Letter",
        bmp: "A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",
        astral: "\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72]|\uD801[\uDC00-\uDC9D]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1E\uDF30-\uDF40\uDF42-\uDF49\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD81A[\uDC00-\uDE38]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD83-\uDDB2\uDDC1-\uDDC4]|\uD86E[\uDC00-\uDC1D]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD803[\uDC00-\uDC48]|\uD80D[\uDC00-\uDC2E]|\uD805[\uDE80-\uDEAA]|\uD87E[\uDC00-\uDE1D]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD82C[\uDC00\uDC01]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD808[\uDC00-\uDF6E]"
    }])
}(XRegExp));
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:xregexp', location = '/static/bower/xregexp/src/addons/unicode/unicode-categories.js' */
/*
 * XRegExp Unicode Categories 3.0.0-pre
 * <http://xregexp.com/>
 * Steven Levithan ï¿½ 2010-2012 MIT License
 * Uses Unicode 6.2.0 <http://unicode.org/>
 * Unicode data generated by Mathias Bynens <http://mathiasbynens.be/>
 */
(function(A) {
    if (!A.addUnicodeData) {
        throw new ReferenceError("Unicode Base must be loaded before Unicode Categories")
    }
    A.addUnicodeData([{
        name: "C",
        alias: "Other",
        isBmpLast: true,
        bmp: "\0-\x1F\x7F-\x9F\xAD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF",
        astral: "\uD808[\uDF6F-\uDFFF]|\uD809[\uDC63-\uDC6F\uDC74-\uDFFF]|\uD804[\uDC4E-\uDC51\uDC70-\uDC7F\uDCBD\uDCC2-\uDCCF\uDCE9-\uDCEF\uDCFA-\uDCFF\uDD35\uDD44-\uDD7F\uDDC9-\uDDCF\uDDDA-\uDFFF]|\uD802[\uDC06\uDC07\uDC09\uDC36\uDC39-\uDC3B\uDC3D\uDC3E\uDC56\uDC60-\uDCFF\uDD1C-\uDD1E\uDD3A-\uDD3E\uDD40-\uDD7F\uDDB8-\uDDBD\uDDC0-\uDDFF\uDE04\uDE07-\uDE0B\uDE14\uDE18\uDE34-\uDE37\uDE3B-\uDE3E\uDE48-\uDE4F\uDE59-\uDE5F\uDE80-\uDEFF\uDF36-\uDF38\uDF56\uDF57\uDF73-\uDF77\uDF80-\uDFFF]|\uD86D[\uDF35-\uDF3F]|\uD81B[\uDC00-\uDEFF\uDF45-\uDF4F\uDF7F-\uDF8E\uDFA0-\uDFFF]|\uD86E[\uDC1E-\uDFFF]|\uD800[\uDC0C\uDC27\uDC3B\uDC3E\uDC4E\uDC4F\uDC5E-\uDC7F\uDCFB-\uDCFF\uDD03-\uDD06\uDD34-\uDD36\uDD8B-\uDD8F\uDD9C-\uDDCF\uDDFE-\uDE7F\uDE9D-\uDE9F\uDED1-\uDEFF\uDF1F\uDF24-\uDF2F\uDF4B-\uDF7F\uDF9E\uDFC4-\uDFC7\uDFD6-\uDFFF]|\uD869[\uDED7-\uDEFF]|\uD83B[\uDC00-\uDDFF\uDE04\uDE20\uDE23\uDE25\uDE26\uDE28\uDE33\uDE38\uDE3A\uDE3C-\uDE41\uDE43-\uDE46\uDE48\uDE4A\uDE4C\uDE50\uDE53\uDE55\uDE56\uDE58\uDE5A\uDE5C\uDE5E\uDE60\uDE63\uDE65\uDE66\uDE6B\uDE73\uDE78\uDE7D\uDE7F\uDE8A\uDE9C-\uDEA0\uDEA4\uDEAA\uDEBC-\uDEEF\uDEF2-\uDFFF]|\uD87E[\uDE1E-\uDFFF]|\uDB40[\uDC00-\uDCFF\uDDF0-\uDFFF]|\uD803[\uDC49-\uDE5F\uDE7F-\uDFFF]|\uD80D[\uDC2F-\uDFFF]|[\uD806\uD807\uD80A\uD80B\uD80E-\uD819\uD81C-\uD82B\uD82D-\uD833\uD836-\uD83A\uD83E\uD83F\uD86F-\uD87D\uD87F-\uDB3F\uDB41-\uDBFF][\uDC00-\uDFFF]|\uD83D[\uDC3F\uDC41\uDCF8\uDCFD-\uDCFF\uDD3E\uDD3F\uDD44-\uDD4F\uDD68-\uDDFA\uDE41-\uDE44\uDE50-\uDE7F\uDEC6-\uDEFF\uDF74-\uDFFF]|\uD83C[\uDC2C-\uDC2F\uDC94-\uDC9F\uDCAF\uDCB0\uDCBF\uDCC0\uDCD0\uDCE0-\uDCFF\uDD0B-\uDD0F\uDD2F\uDD6C-\uDD6F\uDD9B-\uDDE5\uDE03-\uDE0F\uDE3B-\uDE3F\uDE49-\uDE4F\uDE52-\uDEFF\uDF21-\uDF2F\uDF36\uDF7D-\uDF7F\uDF94-\uDF9F\uDFC5\uDFCB-\uDFDF\uDFF1-\uDFFF]|\uD835[\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]|\uD81A[\uDE39-\uDFFF]|\uD834[\uDCF6-\uDCFF\uDD27\uDD28\uDD73-\uDD7A\uDDDE-\uDDFF\uDE46-\uDEFF\uDF57-\uDF5F\uDF72-\uDFFF]|\uD801[\uDC9E\uDC9F\uDCAA-\uDFFF]|\uD805[\uDC00-\uDE7F\uDEB8-\uDEBF\uDECA-\uDFFF]|\uD82C[\uDC02-\uDFFF]"
    }, {
        name: "Cc",
        alias: "Control",
        bmp: "\0-\x1F\x7F-\x9F"
    }, {
        name: "Cf",
        alias: "Format",
        bmp: "\xAD\u0600-\u0604\u06DD\u070F\u200B-\u200F\u202A-\u202E\u2060-\u2064\u206A-\u206F\uFEFF\uFFF9-\uFFFB",
        astral: "\uDB40[\uDC01\uDC20-\uDC7F]|\uD834[\uDD73-\uDD7A]|\uD804\uDCBD"
    }, {
        name: "Cn",
        alias: "Unassigned",
        bmp: "\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u05FF\u0605\u061C\u061D\u070E\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u2065-\u2069\u2072\u2073\u208F\u209D-\u209F\u20BB-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uD7FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD\uFEFE\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFF8\uFFFE\uFFFF",
        astral: "\uD808[\uDF6F-\uDFFF]|\uDB40[\uDC00\uDC02-\uDC1F\uDC80-\uDCFF\uDDF0-\uDFFF]|\uD834[\uDCF6-\uDCFF\uDD27\uDD28\uDDDE-\uDDFF\uDE46-\uDEFF\uDF57-\uDF5F\uDF72-\uDFFF]|\uD802[\uDC06\uDC07\uDC09\uDC36\uDC39-\uDC3B\uDC3D\uDC3E\uDC56\uDC60-\uDCFF\uDD1C-\uDD1E\uDD3A-\uDD3E\uDD40-\uDD7F\uDDB8-\uDDBD\uDDC0-\uDDFF\uDE04\uDE07-\uDE0B\uDE14\uDE18\uDE34-\uDE37\uDE3B-\uDE3E\uDE48-\uDE4F\uDE59-\uDE5F\uDE80-\uDEFF\uDF36-\uDF38\uDF56\uDF57\uDF73-\uDF77\uDF80-\uDFFF]|\uD86D[\uDF35-\uDF3F]|\uD81B[\uDC00-\uDEFF\uDF45-\uDF4F\uDF7F-\uDF8E\uDFA0-\uDFFF]|\uD809[\uDC63-\uDC6F\uDC74-\uDFFF]|\uD800[\uDC0C\uDC27\uDC3B\uDC3E\uDC4E\uDC4F\uDC5E-\uDC7F\uDCFB-\uDCFF\uDD03-\uDD06\uDD34-\uDD36\uDD8B-\uDD8F\uDD9C-\uDDCF\uDDFE-\uDE7F\uDE9D-\uDE9F\uDED1-\uDEFF\uDF1F\uDF24-\uDF2F\uDF4B-\uDF7F\uDF9E\uDFC4-\uDFC7\uDFD6-\uDFFF]|\uD869[\uDED7-\uDEFF]|\uD804[\uDC4E-\uDC51\uDC70-\uDC7F\uDCC2-\uDCCF\uDCE9-\uDCEF\uDCFA-\uDCFF\uDD35\uDD44-\uDD7F\uDDC9-\uDDCF\uDDDA-\uDFFF]|\uD83B[\uDC00-\uDDFF\uDE04\uDE20\uDE23\uDE25\uDE26\uDE28\uDE33\uDE38\uDE3A\uDE3C-\uDE41\uDE43-\uDE46\uDE48\uDE4A\uDE4C\uDE50\uDE53\uDE55\uDE56\uDE58\uDE5A\uDE5C\uDE5E\uDE60\uDE63\uDE65\uDE66\uDE6B\uDE73\uDE78\uDE7D\uDE7F\uDE8A\uDE9C-\uDEA0\uDEA4\uDEAA\uDEBC-\uDEEF\uDEF2-\uDFFF]|[\uDBBF\uDBFF][\uDFFE\uDFFF]|\uD87E[\uDE1E-\uDFFF]|\uD803[\uDC49-\uDE5F\uDE7F-\uDFFF]|\uD80D[\uDC2F-\uDFFF]|[\uD806\uD807\uD80A\uD80B\uD80E-\uD819\uD81C-\uD82B\uD82D-\uD833\uD836-\uD83A\uD83E\uD83F\uD86F-\uD87D\uD87F-\uDB3F\uDB41-\uDB7F][\uDC00-\uDFFF]|\uD83D[\uDC3F\uDC41\uDCF8\uDCFD-\uDCFF\uDD3E\uDD3F\uDD44-\uDD4F\uDD68-\uDDFA\uDE41-\uDE44\uDE50-\uDE7F\uDEC6-\uDEFF\uDF74-\uDFFF]|\uD86E[\uDC1E-\uDFFF]|\uD83C[\uDC2C-\uDC2F\uDC94-\uDC9F\uDCAF\uDCB0\uDCBF\uDCC0\uDCD0\uDCE0-\uDCFF\uDD0B-\uDD0F\uDD2F\uDD6C-\uDD6F\uDD9B-\uDDE5\uDE03-\uDE0F\uDE3B-\uDE3F\uDE49-\uDE4F\uDE52-\uDEFF\uDF21-\uDF2F\uDF36\uDF7D-\uDF7F\uDF94-\uDF9F\uDFC5\uDFCB-\uDFDF\uDFF1-\uDFFF]|\uD835[\uDC55\uDC9D\uDCA0\uDCA1\uDCA3\uDCA4\uDCA7\uDCA8\uDCAD\uDCBA\uDCBC\uDCC4\uDD06\uDD0B\uDD0C\uDD15\uDD1D\uDD3A\uDD3F\uDD45\uDD47-\uDD49\uDD51\uDEA6\uDEA7\uDFCC\uDFCD]|\uD81A[\uDE39-\uDFFF]|\uD801[\uDC9E\uDC9F\uDCAA-\uDFFF]|\uD805[\uDC00-\uDE7F\uDEB8-\uDEBF\uDECA-\uDFFF]|\uD82C[\uDC02-\uDFFF]"
    }, {
        name: "Co",
        alias: "Private_Use",
        bmp: "\uE000-\uF8FF",
        astral: "[\uDB80-\uDBBE\uDBC0-\uDBFE][\uDC00-\uDFFF]|[\uDBBF\uDBFF][\uDC00-\uDFFD]"
    }, {
        name: "Cs",
        alias: "Surrogate",
        bmp: "\uD800-\uDFFF"
    }, {
        name: "Ll",
        alias: "Lowercase_Letter",
        bmp: "a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A",
        astral: "\uD835[\uDC1A-\uDC33\uDC4E-\uDC54\uDC56-\uDC67\uDC82-\uDC9B\uDCB6-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDCCF\uDCEA-\uDD03\uDD1E-\uDD37\uDD52-\uDD6B\uDD86-\uDD9F\uDDBA-\uDDD3\uDDEE-\uDE07\uDE22-\uDE3B\uDE56-\uDE6F\uDE8A-\uDEA5\uDEC2-\uDEDA\uDEDC-\uDEE1\uDEFC-\uDF14\uDF16-\uDF1B\uDF36-\uDF4E\uDF50-\uDF55\uDF70-\uDF88\uDF8A-\uDF8F\uDFAA-\uDFC2\uDFC4-\uDFC9\uDFCB]|\uD801[\uDC28-\uDC4F]"
    }, {
        name: "Lm",
        alias: "Modifier_Letter",
        bmp: "\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5\u06E6\u07F4\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA717-\uA71F\uA770\uA788\uA7F8\uA7F9\uA9CF\uAA70\uAADD\uAAF3\uAAF4\uFF70\uFF9E\uFF9F",
        astral: "\uD81B[\uDF93-\uDF9F]"
    }, {
        name: "Lo",
        alias: "Other_Letter",
        bmp: "\xAA\xBA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E45\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A\uA62B\uA66E\uA6A0-\uA6E5\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",
        astral: "\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1E\uDF30-\uDF40\uDF42-\uDF49\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD81A[\uDC00-\uDE38]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD83-\uDDB2\uDDC1-\uDDC4]|\uD86E[\uDC00-\uDC1D]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD803[\uDC00-\uDC48]|\uD80D[\uDC00-\uDC2E]|\uD805[\uDE80-\uDEAA]|\uD87E[\uDC00-\uDE1D]|\uD81B[\uDF00-\uDF44\uDF50]|\uD801[\uDC50-\uDC9D]|\uD82C[\uDC00\uDC01]|[\uD80C\uD840-\uD868\uD86A-\uD86C][\uDC00-\uDFFF]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD808[\uDC00-\uDF6E]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]"
    }, {
        name: "Lt",
        alias: "Titlecase_Letter",
        bmp: "\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC"
    }, {
        name: "Lu",
        alias: "Uppercase_Letter",
        bmp: "A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A",
        astral: "\uD835[\uDC00-\uDC19\uDC34-\uDC4D\uDC68-\uDC81\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB5\uDCD0-\uDCE9\uDD04\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD38\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD6C-\uDD85\uDDA0-\uDDB9\uDDD4-\uDDED\uDE08-\uDE21\uDE3C-\uDE55\uDE70-\uDE89\uDEA8-\uDEC0\uDEE2-\uDEFA\uDF1C-\uDF34\uDF56-\uDF6E\uDF90-\uDFA8\uDFCA]|\uD801[\uDC00-\uDC27]"
    }, {
        name: "M",
        alias: "Mark",
        bmp: "\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D02\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26",
        astral: "\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F]|\uD81B[\uDF51-\uDF7E\uDF8F-\uDF92]|\uD804[\uDC00-\uDC02\uDC38-\uDC46\uDC80-\uDC82\uDCB0-\uDCBA\uDD00-\uDD02\uDD27-\uDD34\uDD80-\uDD82\uDDB3-\uDDC0]|\uD805[\uDEAB-\uDEB7]|\uD800\uDDFD|\uDB40[\uDD00-\uDDEF]"
    }, {
        name: "Mc",
        alias: "Spacing_Mark",
        bmp: "\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E\u094F\u0982\u0983\u09BE-\u09C0\u09C7\u09C8\u09CB\u09CC\u09D7\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB\u0ACC\u0B02\u0B03\u0B3E\u0B40\u0B47\u0B48\u0B4B\u0B4C\u0B57\u0BBE\u0BBF\u0BC1\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD7\u0C01-\u0C03\u0C41-\u0C44\u0C82\u0C83\u0CBE\u0CC0-\u0CC4\u0CC7\u0CC8\u0CCA\u0CCB\u0CD5\u0CD6\u0D02\u0D03\u0D3E-\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D57\u0D82\u0D83\u0DCF-\u0DD1\u0DD8-\u0DDF\u0DF2\u0DF3\u0F3E\u0F3F\u0F7F\u102B\u102C\u1031\u1038\u103B\u103C\u1056\u1057\u1062-\u1064\u1067-\u106D\u1083\u1084\u1087-\u108C\u108F\u109A-\u109C\u17B6\u17BE-\u17C5\u17C7\u17C8\u1923-\u1926\u1929-\u192B\u1930\u1931\u1933-\u1938\u19B0-\u19C0\u19C8\u19C9\u1A19-\u1A1B\u1A55\u1A57\u1A61\u1A63\u1A64\u1A6D-\u1A72\u1B04\u1B35\u1B3B\u1B3D-\u1B41\u1B43\u1B44\u1B82\u1BA1\u1BA6\u1BA7\u1BAA\u1BAC\u1BAD\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2\u1BF3\u1C24-\u1C2B\u1C34\u1C35\u1CE1\u1CF2\u1CF3\u302E\u302F\uA823\uA824\uA827\uA880\uA881\uA8B4-\uA8C3\uA952\uA953\uA983\uA9B4\uA9B5\uA9BA\uA9BB\uA9BD-\uA9C0\uAA2F\uAA30\uAA33\uAA34\uAA4D\uAA7B\uAAEB\uAAEE\uAAEF\uAAF5\uABE3\uABE4\uABE6\uABE7\uABE9\uABEA\uABEC",
        astral: "\uD834[\uDD65\uDD66\uDD6D-\uDD72]|\uD804[\uDC00\uDC02\uDC82\uDCB0-\uDCB2\uDCB7\uDCB8\uDD2C\uDD82\uDDB3-\uDDB5\uDDBF\uDDC0]|\uD805[\uDEAC\uDEAE\uDEAF\uDEB6]|\uD81B[\uDF51-\uDF7E]"
    }, {
        name: "Me",
        alias: "Enclosing_Mark",
        bmp: "\u0488\u0489\u20DD-\u20E0\u20E2-\u20E4\uA670-\uA672"
    }, {
        name: "Mn",
        alias: "Nonspacing_Mark",
        bmp: "\u0300-\u036F\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2\u09E3\u0A01\u0A02\u0A3C\u0A41\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7\u0AC8\u0ACD\u0AE2\u0AE3\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62\u0B63\u0B82\u0BC0\u0BCD\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0CBC\u0CBF\u0CC6\u0CCC\u0CCD\u0CE2\u0CE3\u0D41-\u0D44\u0D4D\u0D62\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039\u103A\u103D\u103E\u1058\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193B\u1A17\u1A18\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80\u1B81\u1BA2-\u1BA5\u1BA8\u1BA9\u1BAB\u1BE6\u1BE8\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u3099\u309A\uA66F\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA825\uA826\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uAA29-\uAA2E\uAA31\uAA32\uAA35\uAA36\uAA43\uAA4C\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEC\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26",
        astral: "\uD802[\uDE01-\uDE03\uDE05\uDE06\uDE0C-\uDE0F\uDE38-\uDE3A\uDE3F]|\uD834[\uDD67-\uDD69\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD81B[\uDF8F-\uDF92]|\uD805[\uDEAB\uDEAD\uDEB0-\uDEB5\uDEB7]|\uD804[\uDC01\uDC38-\uDC46\uDC80\uDC81\uDCB3-\uDCB6\uDCB9\uDCBA\uDD00-\uDD02\uDD27-\uDD2B\uDD2D-\uDD34\uDD80\uDD81\uDDB6-\uDDBE]|\uD800\uDDFD|\uDB40[\uDD00-\uDDEF]"
    }, {
        name: "N",
        alias: "Number",
        bmp: "0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D66-\u0D75\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19",
        astral: "\uD802[\uDC58-\uDC5F\uDD16-\uDD1B\uDE40-\uDE47\uDE7D\uDE7E\uDF58-\uDF5F\uDF78-\uDF7F]|\uD801[\uDCA0-\uDCA9]|\uD809[\uDC00-\uDC62]|\uD835[\uDFCE-\uDFFF]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD834[\uDF60-\uDF71]|\uD803[\uDE60-\uDE7E]|\uD83C[\uDD00-\uDD0A]|\uD805[\uDEC0-\uDEC9]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9]"
    }, {
        name: "Nd",
        alias: "Decimal_Number",
        bmp: "0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19",
        astral: "\uD804[\uDC66-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9]|\uD805[\uDEC0-\uDEC9]|\uD801[\uDCA0-\uDCA9]|\uD835[\uDFCE-\uDFFF]"
    }, {
        name: "Nl",
        alias: "Letter_Number",
        bmp: "\u16EE-\u16F0\u2160-\u2182\u2185-\u2188\u3007\u3021-\u3029\u3038-\u303A\uA6E6-\uA6EF",
        astral: "\uD800[\uDD40-\uDD74\uDF41\uDF4A\uDFD1-\uDFD5]|\uD809[\uDC00-\uDC62]"
    }, {
        name: "No",
        alias: "Other_Number",
        bmp: "\xB2\xB3\xB9\xBC-\xBE\u09F4-\u09F9\u0B72-\u0B77\u0BF0-\u0BF2\u0C78-\u0C7E\u0D70-\u0D75\u0F2A-\u0F33\u1369-\u137C\u17F0-\u17F9\u19DA\u2070\u2074-\u2079\u2080-\u2089\u2150-\u215F\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA830-\uA835",
        astral: "\uD802[\uDC58-\uDC5F\uDD16-\uDD1B\uDE40-\uDE47\uDE7D\uDE7E\uDF58-\uDF5F\uDF78-\uDF7F]|\uD834[\uDF60-\uDF71]|\uD803[\uDE60-\uDE7E]|\uD800[\uDD07-\uDD33\uDD75-\uDD78\uDD8A\uDF20-\uDF23]|\uD83C[\uDD00-\uDD0A]|\uD804[\uDC52-\uDC65]"
    }, {
        name: "P",
        alias: "Punctuation",
        bmp: "\x21-\x23\x25-\\x2A\x2C-\x2F\x3A\x3B\\x3F\x40\\x5B-\\x5D\x5F\\x7B\x7D\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65",
        astral: "\uD809[\uDC70-\uDC73]|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDF39-\uDF3F]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDDC5-\uDDC8]"
    }, {
        name: "Pc",
        alias: "Connector_Punctuation",
        bmp: "\x5F\u203F\u2040\u2054\uFE33\uFE34\uFE4D-\uFE4F\uFF3F"
    }, {
        name: "Pd",
        alias: "Dash_Punctuation",
        bmp: "\\x2D\u058A\u05BE\u1400\u1806\u2010-\u2015\u2E17\u2E1A\u2E3A\u2E3B\u301C\u3030\u30A0\uFE31\uFE32\uFE58\uFE63\uFF0D"
    }, {
        name: "Pe",
        alias: "Close_Punctuation",
        bmp: "\\x29\\x5D\x7D\u0F3B\u0F3D\u169C\u2046\u207E\u208E\u232A\u2769\u276B\u276D\u276F\u2771\u2773\u2775\u27C6\u27E7\u27E9\u27EB\u27ED\u27EF\u2984\u2986\u2988\u298A\u298C\u298E\u2990\u2992\u2994\u2996\u2998\u29D9\u29DB\u29FD\u2E23\u2E25\u2E27\u2E29\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B\u301E\u301F\uFD3F\uFE18\uFE36\uFE38\uFE3A\uFE3C\uFE3E\uFE40\uFE42\uFE44\uFE48\uFE5A\uFE5C\uFE5E\uFF09\uFF3D\uFF5D\uFF60\uFF63"
    }, {
        name: "Pf",
        alias: "Final_Punctuation",
        bmp: "\xBB\u2019\u201D\u203A\u2E03\u2E05\u2E0A\u2E0D\u2E1D\u2E21"
    }, {
        name: "Pi",
        alias: "Initial_Punctuation",
        bmp: "\xAB\u2018\u201B\u201C\u201F\u2039\u2E02\u2E04\u2E09\u2E0C\u2E1C\u2E20"
    }, {
        name: "Po",
        alias: "Other_Punctuation",
        bmp: "\x21-\x23\x25-\x27\\x2A\x2C\\x2E\x2F\x3A\x3B\\x3F\x40\\x5C\xA1\xA7\xB6\xB7\xBF\u037E\u0387\u055A-\u055F\u0589\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u166D\u166E\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u1805\u1807-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2016\u2017\u2020-\u2027\u2030-\u2038\u203B-\u203E\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205E\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E06-\u2E08\u2E0B\u2E0E-\u2E16\u2E18\u2E19\u2E1B\u2E1E\u2E1F\u2E2A-\u2E2E\u2E30-\u2E39\u3001-\u3003\u303D\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFE10-\uFE16\uFE19\uFE30\uFE45\uFE46\uFE49-\uFE4C\uFE50-\uFE52\uFE54-\uFE57\uFE5F-\uFE61\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF07\uFF0A\uFF0C\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3C\uFF61\uFF64\uFF65",
        astral: "\uD809[\uDC70-\uDC73]|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDF39-\uDF3F]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDDC5-\uDDC8]"
    }, {
        name: "Ps",
        alias: "Open_Punctuation",
        bmp: "\\x28\\x5B\\x7B\u0F3A\u0F3C\u169B\u201A\u201E\u2045\u207D\u208D\u2329\u2768\u276A\u276C\u276E\u2770\u2772\u2774\u27C5\u27E6\u27E8\u27EA\u27EC\u27EE\u2983\u2985\u2987\u2989\u298B\u298D\u298F\u2991\u2993\u2995\u2997\u29D8\u29DA\u29FC\u2E22\u2E24\u2E26\u2E28\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A\u301D\uFD3E\uFE17\uFE35\uFE37\uFE39\uFE3B\uFE3D\uFE3F\uFE41\uFE43\uFE47\uFE59\uFE5B\uFE5D\uFF08\uFF3B\uFF5B\uFF5F\uFF62"
    }, {
        name: "S",
        alias: "Symbol",
        bmp: "\\x24\\x2B\x3C-\x3E\\x5E\x60\\x7C\x7E\xA2-\xA6\xA8\xA9\xAC\xAE-\xB1\xB4\xB8\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u03F6\u0482\u058F\u0606-\u0608\u060B\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u09F2\u09F3\u09FA\u09FB\u0AF1\u0B70\u0BF3-\u0BFA\u0C7F\u0D79\u0E3F\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u17DB\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2044\u2052\u207A-\u207C\u208A-\u208C\u20A0-\u20BA\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u2140-\u2144\u214A-\u214D\u214F\u2190-\u2328\u232B-\u23F3\u2400-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u26FF\u2701-\u2767\u2794-\u27C4\u27C7-\u27E5\u27F0-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2B4C\u2B50-\u2B59\u2CE5-\u2CEA\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u309B\u309C\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u32FE\u3300-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA700-\uA716\uA720\uA721\uA789\uA78A\uA828-\uA82B\uA836-\uA839\uAA77-\uAA79\uFB29\uFBB2-\uFBC1\uFDFC\uFDFD\uFE62\uFE64-\uFE66\uFE69\uFF04\uFF0B\uFF1C-\uFF1E\uFF3E\uFF40\uFF5C\uFF5E\uFFE0-\uFFE6\uFFE8-\uFFEE\uFFFC\uFFFD",
        astral: "\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCF7\uDCF9-\uDCFC\uDD00-\uDD3D\uDD40-\uDD43\uDD50-\uDD67\uDDFB-\uDE40\uDE45-\uDE4F\uDE80-\uDEC5\uDF00-\uDF73]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBE\uDCC1-\uDCCF\uDCD1-\uDCDF\uDD10-\uDD2E\uDD30-\uDD6B\uDD70-\uDD9A\uDDE6-\uDE02\uDE10-\uDE3A\uDE40-\uDE48\uDE50\uDE51\uDF00-\uDF20\uDF30-\uDF35\uDF37-\uDF7C\uDF80-\uDF93\uDFA0-\uDFC4\uDFC6-\uDFCA\uDFE0-\uDFF0]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDDD\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD90-\uDD9B\uDDD0-\uDDFC]|\uD83B[\uDEF0\uDEF1]"
    }, {
        name: "Sc",
        alias: "Currency_Symbol",
        bmp: "\\x24\xA2-\xA5\u058F\u060B\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BA\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6"
    }, {
        name: "Sk",
        alias: "Modifier_Symbol",
        bmp: "\\x5E\x60\xA8\xAF\xB4\xB8\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u0384\u0385\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u309B\u309C\uA700-\uA716\uA720\uA721\uA789\uA78A\uFBB2-\uFBC1\uFF3E\uFF40\uFFE3"
    }, {
        name: "Sm",
        alias: "Math_Symbol",
        bmp: "\\x2B\x3C-\x3E\\x7C\x7E\xAC\xB1\xD7\xF7\u03F6\u0606-\u0608\u2044\u2052\u207A-\u207C\u208A-\u208C\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u27C0-\u27C4\u27C7-\u27E5\u27F0-\u27FF\u2900-\u2982\u2999-\u29D7\u29DC-\u29FB\u29FE-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\uFB29\uFE62\uFE64-\uFE66\uFF0B\uFF1C-\uFF1E\uFF5C\uFF5E\uFFE2\uFFE9-\uFFEC",
        astral: "\uD83B[\uDEF0\uDEF1]|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]"
    }, {
        name: "So",
        alias: "Other_Symbol",
        bmp: "\xA6\xA9\xAE\xB0\u0482\u060E\u060F\u06DE\u06E9\u06FD\u06FE\u07F6\u09FA\u0B70\u0BF3-\u0BF8\u0BFA\u0C7F\u0D79\u0F01-\u0F03\u0F13\u0F15-\u0F17\u0F1A-\u0F1F\u0F34\u0F36\u0F38\u0FBE-\u0FC5\u0FC7-\u0FCC\u0FCE\u0FCF\u0FD5-\u0FD8\u109E\u109F\u1390-\u1399\u1940\u19DE-\u19FF\u1B61-\u1B6A\u1B74-\u1B7C\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116\u2117\u211E-\u2123\u2125\u2127\u2129\u212E\u213A\u213B\u214A\u214C\u214D\u214F\u2195-\u2199\u219C-\u219F\u21A1\u21A2\u21A4\u21A5\u21A7-\u21AD\u21AF-\u21CD\u21D0\u21D1\u21D3\u21D5-\u21F3\u2300-\u2307\u230C-\u231F\u2322-\u2328\u232B-\u237B\u237D-\u239A\u23B4-\u23DB\u23E2-\u23F3\u2400-\u2426\u2440-\u244A\u249C-\u24E9\u2500-\u25B6\u25B8-\u25C0\u25C2-\u25F7\u2600-\u266E\u2670-\u26FF\u2701-\u2767\u2794-\u27BF\u2800-\u28FF\u2B00-\u2B2F\u2B45\u2B46\u2B50-\u2B59\u2CE5-\u2CEA\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3004\u3012\u3013\u3020\u3036\u3037\u303E\u303F\u3190\u3191\u3196-\u319F\u31C0-\u31E3\u3200-\u321E\u322A-\u3247\u3250\u3260-\u327F\u328A-\u32B0\u32C0-\u32FE\u3300-\u33FF\u4DC0-\u4DFF\uA490-\uA4C6\uA828-\uA82B\uA836\uA837\uA839\uAA77-\uAA79\uFDFD\uFFE4\uFFE8\uFFED\uFFEE\uFFFC\uFFFD",
        astral: "\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCF7\uDCF9-\uDCFC\uDD00-\uDD3D\uDD40-\uDD43\uDD50-\uDD67\uDDFB-\uDE40\uDE45-\uDE4F\uDE80-\uDEC5\uDF00-\uDF73]|\uD834[\uDC00-\uDCF5\uDD00-\uDD26\uDD29-\uDD64\uDD6A-\uDD6C\uDD83\uDD84\uDD8C-\uDDA9\uDDAE-\uDDDD\uDE00-\uDE41\uDE45\uDF00-\uDF56]|\uD83C[\uDC00-\uDC2B\uDC30-\uDC93\uDCA0-\uDCAE\uDCB1-\uDCBE\uDCC1-\uDCCF\uDCD1-\uDCDF\uDD10-\uDD2E\uDD30-\uDD6B\uDD70-\uDD9A\uDDE6-\uDE02\uDE10-\uDE3A\uDE40-\uDE48\uDE50\uDE51\uDF00-\uDF20\uDF30-\uDF35\uDF37-\uDF7C\uDF80-\uDF93\uDFA0-\uDFC4\uDFC6-\uDFCA\uDFE0-\uDFF0]|\uD800[\uDD37-\uDD3F\uDD79-\uDD89\uDD90-\uDD9B\uDDD0-\uDDFC]"
    }, {
        name: "Z",
        alias: "Separator",
        bmp: "\x20\xA0\u1680\u180E\u2000-\u200A\u2028\u2029\u202F\u205F\u3000"
    }, {
        name: "Zl",
        alias: "Line_Separator",
        bmp: "\u2028"
    }, {
        name: "Zp",
        alias: "Paragraph_Separator",
        bmp: "\u2029"
    }, {
        name: "Zs",
        alias: "Space_Separator",
        bmp: "\x20\xA0\u1680\u180E\u2000-\u200A\u202F\u205F\u3000"
    }])
}(XRegExp));
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:rangy-inputs', location = '/static/lib/rangy-inputs.js' */
(function(C) {
    var L = "undefined";
    var D, G, Q, F, B;
    var N, I, M, P;
    function J(S, U) {
        var T = typeof S[U];
        return T === "function" || (!!(T == "object" && S[U])) || T == "unknown"
    }
    function K(S, T) {
        return typeof (S[T]) != L
    }
    function E(S, T) {
        return !!(typeof (S[T]) == "object" && S[T])
    }
    function H(S) {
        if (window.console && window.console.log) {
            window.console.log("TextInputs module for Rangy not supported in your browser. Reason: " + S)
        }
    }
    function O(T, U, S) {
        if (U < 0) {
            U += T.value.length
        }
        if (typeof S == L) {
            S = U
        }
        if (S < 0) {
            S += T.value.length
        }
        return {
            start: U,
            end: S
        }
    }
    function A(T, U, S) {
        return {
            start: U,
            end: S,
            length: S - U,
            text: T.value.slice(U, S)
        }
    }
    function R() {
        return E(document, "body") ? document.body : document.getElementsByTagName("body")[0]
    }
    C(document).ready(function() {
        var T = document.createElement("textarea");
        R().appendChild(T);
        if (K(T, "selectionStart") && K(T, "selectionEnd")) {
            D = function(W) {
                var X = W.selectionStart
                  , V = W.selectionEnd;
                return A(W, X, V)
            }
            ;
            G = function(X, V, W) {
                var Y = O(X, V, W);
                X.selectionStart = Y.start;
                X.selectionEnd = Y.end
            }
            ;
            P = function(W, V) {
                if (V) {
                    W.selectionEnd = W.selectionStart
                } else {
                    W.selectionStart = W.selectionEnd
                }
            }
        } else {
            if (J(T, "createTextRange") && E(document, "selection") && J(document.selection, "createRange")) {
                D = function(Z) {
                    var c = 0, X = 0, b, W, V, a;
                    var Y = document.selection.createRange();
                    if (Y && Y.parentElement() == Z) {
                        b = Z.value.replace(/\r\n/g, "\n");
                        V = b.length;
                        W = Z.createTextRange();
                        W.moveToBookmark(Y.getBookmark());
                        a = Z.createTextRange();
                        a.collapse(false);
                        if (W.compareEndPoints("StartToEnd", a) > -1) {
                            c = X = V
                        } else {
                            c = -W.moveStart("character", -V);
                            c += b.slice(0, c).split("\n").length - 1;
                            if (W.compareEndPoints("EndToEnd", a) > -1) {
                                X = V
                            } else {
                                X = -W.moveEnd("character", -V);
                                X += b.slice(0, X).split("\n").length - 1
                            }
                        }
                    }
                    return A(Z, c, X)
                }
                ;
                var U = function(V, W) {
                    return W - (V.value.slice(0, W).split("\r\n").length - 1)
                };
                G = function(Z, V, Y) {
                    var a = O(Z, V, Y);
                    var X = Z.createTextRange();
                    var W = U(Z, a.start);
                    X.collapse(true);
                    if (a.start == a.end) {
                        X.move("character", W)
                    } else {
                        X.moveEnd("character", U(Z, a.end));
                        X.moveStart("character", W)
                    }
                    X.select()
                }
                ;
                P = function(X, W) {
                    var V = document.selection.createRange();
                    V.collapse(W);
                    V.select()
                }
            } else {
                R().removeChild(T);
                H("No means of finding text input caret position");
                return
            }
        }
        R().removeChild(T);
        F = function(W, Z, V, X) {
            var Y;
            if (Z != V) {
                Y = W.value;
                W.value = Y.slice(0, Z) + Y.slice(V)
            }
            if (X) {
                G(W, Z, Z)
            }
        }
        ;
        Q = function(V) {
            var W = D(V);
            F(V, W.start, W.end, true)
        }
        ;
        M = function(V) {
            var W = D(V), X;
            if (W.start != W.end) {
                X = V.value;
                V.value = X.slice(0, W.start) + X.slice(W.end)
            }
            G(V, W.start, W.start);
            return W.text
        }
        ;
        B = function(W, Z, V, X) {
            var Y = W.value, a;
            W.value = Y.slice(0, V) + Z + Y.slice(V);
            if (X) {
                a = V + Z.length;
                G(W, a, a)
            }
        }
        ;
        N = function(V, Y) {
            var W = D(V)
              , X = V.value;
            V.value = X.slice(0, W.start) + Y + X.slice(W.end);
            var Z = W.start + Y.length;
            G(V, Z, Z)
        }
        ;
        I = function(V, Y, b) {
            var X = D(V)
              , a = V.value;
            V.value = a.slice(0, X.start) + Y + X.text + b + a.slice(X.end);
            var Z = X.start + Y.length;
            var W = Z + X.length;
            G(V, Z, W)
        }
        ;
        function S(V, W) {
            return function() {
                var Z = this.jquery ? this[0] : this;
                var a = Z.nodeName.toLowerCase();
                if (Z.nodeType == 1 && (a == "textarea" || (a == "input" && Z.type == "text"))) {
                    var Y = [Z].concat(Array.prototype.slice.call(arguments));
                    var X = V.apply(this, Y);
                    if (!W) {
                        return X
                    }
                }
                if (W) {
                    return this
                }
            }
        }
        C.fn.extend({
            getSelection: S(D, false),
            setSelection: S(G, true),
            collapseSelection: S(P, true),
            deleteSelectedText: S(Q, true),
            deleteText: S(F, true),
            extractSelectedText: S(M, false),
            insertText: S(B, true),
            replaceSelectedText: S(N, true),
            surroundSelectedText: S(I, true)
        })
    })
})(jQuery);
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:mentionable-textarea', location = '/static/widget/mentionable-textarea/mentionable-textarea.soy' */
// This file was automatically generated from mentionable-textarea.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.mentionableTextarea.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.mentionableTextarea == 'undefined') {
    stash.widget.mentionableTextarea = {};
}

stash.widget.mentionableTextarea.dialog = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    var output = '<ul>';
    if (opt_data.results && opt_data.results.length) {
        var resultList6 = opt_data.results;
        var resultListLen6 = resultList6.length;
        for (var resultIndex6 = 0; resultIndex6 < resultListLen6; resultIndex6++) {
            var resultData6 = resultList6[resultIndex6];
            output += stash.widget.mentionableTextarea.result({
                result: resultData6,
                isActive: opt_data.activeItemIndex ? resultIndex6 == opt_data.activeItemIndex : resultIndex6 == 0
            });
        }
    } else {
        output += (opt_data.query) ? '<li class="no-results"><span>' + soy.$$escapeHtml("No matching users found") + '</span></li>' : '<li class="mentions-help"><span>' + soy.$$escapeHtml("Start typing to search for people") + '</span></li>';
    }
    output += '</ul>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.mentionableTextarea.dialog.soyTemplateName = 'stash.widget.mentionableTextarea.dialog';
}

stash.widget.mentionableTextarea.result = function(opt_data, opt_ignored) {
    return '<li class="result ' + soy.$$escapeHtml(opt_data.isActive ? 'active' : '') + '">' + stash.widget.avatarWithNameAndEmail({
        size: 'small',
        person: opt_data.result
    }) + '</li>';
}
;
if (goog.DEBUG) {
    stash.widget.mentionableTextarea.result.soyTemplateName = 'stash.widget.mentionableTextarea.result';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:mentionable-textarea', location = '/static/widget/mentionable-textarea/mentionable-textarea.js' */
define("widget/mentionable-textarea", ["aui", "aui/progressive-dataset", "backbone", "jquery", "lodash", "textarea-caret-position", "xregexp", "stash/api/util/navbuilder", "util/events", "util/function", "model/page-state", "model/stash-user", "widget/autocomplete-dialog"], function(I, M, K, C, L, J, F, A, O, G, H, E, N) {
    function B() {
        this.init.apply(this, arguments)
    }
    B.defaults = {
        $container: C(document.body),
        selector: "textarea",
        dialogId: "mention-autocomplete-dialog"
    };
    B.prototype.init = function(P) {
        if (this.options) {
            this.reset()
        }
        this.options = C.extend({}, B.defaults, P);
        L.bindAll(this, "onKeyDown", "onKeyPress", "onPaste", "onDocumentClick", "updateDialogAnchorPosition", "updateResults", "onActivity", "selectItem", "highlightMatches");
        var Q = [];
        if (H.getPullRequest()) {
            Q = L.map([H.getPullRequest().getAuthor()].concat(H.getPullRequest().getReviewers().models, H.getPullRequest().getParticipants().models), function(R) {
                return R.getUser()
            })
        } else {
            if (H.getCommitParticipants && H.getCommitParticipants()) {
                Q = H.getCommitParticipants().pluck("user")
            }
        }
        this.dataSource = D(Q, this.matcher);
        this.dataSource.on("respond", this.updateResults);
        this.dataSource.on("activity", this.onActivity);
        this.isMentioningSelector = L.map(this.options.selector.split(","), function(R) {
            return C.trim(R) + ".isMentioning"
        }).join(", ");
        this.options.$container.on("keypress", this.options.selector, this.onKeyPress);
        this.options.$container.on("keydown", this.isMentioningSelector, this.onKeyDown);
        this.options.$container.on("paste", this.isMentioningSelector, this.onPaste)
    }
    ;
    B.prototype.onKeyDown = function(P) {
        if (!this.dialog) {
            return
        }
        switch (P.which) {
        case I.keyCode.ENTER:
        case I.keyCode.TAB:
            this.selectHighlightedItem();
            P.preventDefault();
            break;
        case I.keyCode.UP:
            this.dialog.moveSelectionUp();
            P.preventDefault();
            break;
        case I.keyCode.DOWN:
            this.dialog.moveSelectionDown();
            P.preventDefault();
            break;
        case I.keyCode.ESCAPE:
            this.endAutocomplete();
            P.preventDefault();
            P.stopPropagation();
            break;
        case I.keyCode.BACKSPACE:
        case I.keyCode.DELETE:
            this.onKeyPress(P);
            break
        }
    }
    ;
    B.prototype.onKeyPress = function(P) {
        if (P.which) {
            L.defer(L.bind(function(Q) {
                var R = C(Q.target);
                if (!R.hasClass("isMentioning")) {
                    if (String.fromCharCode(Q.which) === "@") {
                        this.beginAutocomplete(R)
                    }
                } else {
                    this.updateAutocomplete()
                }
            }, this), P)
        }
    }
    ;
    B.prototype.onPaste = function() {
        L.defer(L.bind(this.updateAutocomplete, this))
    }
    ;
    B.prototype.onDocumentClick = function(S) {
        var R = S.target;
        var P = [];
        this.$textarea && P.push(this.$textarea);
        this.dialog && P.push(this.dialog.$el);
        var Q = L.any(P, function(T) {
            return T.is(R) || C.contains(T[0], R)
        });
        if (!Q) {
            this.endAutocomplete()
        }
    }
    ;
    B.prototype.beginAutocomplete = function(Q) {
        var P = Q.getSelection().start - 1;
        if (P > 0 && /^\w$/.test(Q.val().substr(P - 1, 1))) {
            return
        }
        this.$textarea = Q;
        this.$textarea.addClass("isMentioning");
        this.mentionTriggerPos = P;
        this.resultsCollection = new K.Collection();
        this.dialog = new N({
            id: this.options.dialogId,
            collection: this.resultsCollection,
            minZIndex: this.options.$container.zIndex(),
            anchor: this.getCaretDocumentCoordinates(this.$textarea),
            template: stash.widget.mentionableTextarea.dialog,
            highlighter: this.highlightMatches
        });
        this.dialog.on("itemSelected", this.selectItem);
        O.on("window.resize.debounced", this.updateDialogAnchorPosition);
        C(document).on("click focusin mousedown", this.onDocumentClick);
        this.updateAutocomplete()
    }
    ;
    B.prototype.updateAutocomplete = function() {
        if (!this.$textarea) {
            return
        }
        this.currentCaretPos = this.$textarea.getSelection().start;
        var P = this.$textarea.val().substring(this.mentionTriggerPos, this.currentCaretPos);
        if (!P || P.indexOf("@") !== 0 || P.indexOf("\n") !== -1) {
            this.endAutocomplete()
        } else {
            P = P.substr(1);
            this.dataSource.query(P)
        }
    }
    ;
    B.prototype.updateDialogAnchorPosition = function() {
        L.defer(L.bind(function() {
            if (this.dialog && this.$textarea) {
                this.dialog.updateAnchorPosition(this.getCaretDocumentCoordinates(this.$textarea))
            }
        }, this))
    }
    ;
    B.prototype.updateResults = function(P) {
        if (this.resultsCollection) {
            this.resultsCollection.query = P.query;
            this.resultsCollection.reset(P.results)
        }
    }
    ;
    B.prototype.onActivity = function(P) {
        this.dialog && this.dialog.toggleSpinner(P.activity)
    }
    ;
    B.prototype.endAutocomplete = function() {
        if (this.$textarea) {
            this.$textarea.removeClass("isMentioning");
            this.$textarea = null
        }
        this.mentionTriggerPos = undefined;
        this.currentCaretPos = undefined;
        if (this.dialog) {
            this.dialog.off("itemSelected", this.selectItem);
            this.dialog.remove();
            this.dialog = null
        }
        this.resultsCollection = null;
        O.off("window.resize.debounced", this.updateDialogAnchorPosition);
        C(document).off("click focusin mousedown", this.onDocumentClick)
    }
    ;
    B.prototype.selectHighlightedItem = function() {
        this.selectItem(this.dialog.getSelectedItemIndex())
    }
    ;
    B.prototype.selectItem = function(R) {
        var Q = this.resultsCollection.at(R);
        if (Q) {
            var P = this.escapeUsername(Q.getName())
              , V = this.$textarea.val()
              , U = V.substring(0, this.mentionTriggerPos + 1)
              , T = V.substring(this.currentCaretPos, V.length)
              , S = U.length + P.length + 1;
            if (T.charAt(0) !== " ") {
                T = " " + T
            }
            this.$textarea.val(U + P + T);
            this.$textarea.setSelection(S, S)
        }
        this.endAutocomplete()
    }
    ;
    B.prototype.matcher = function(Q, R) {
        if (H.getCurrentUser() && Q.getName() === H.getCurrentUser().getName()) {
            return false
        }
        var P = F.cache("(\\b|^|[^\\p{L}\\p{N}])" + F.escape(R), "i")
          , S = [Q.getName(), Q.getEmailAddress(), Q.getDisplayName()];
        return L.any(S, function(T) {
            return !!(T && P.test(T))
        })
    }
    ;
    B.prototype.getMatchParts = function(S, R) {
        var Q = F.cache("(^|.*?(\\b|\\())(" + F.escape(R) + ")(.*)", "i")
          , P = {
            text: S
        };
        if (S.toLowerCase().indexOf(R.toLowerCase()) > -1) {
            S.replace(Q, function(U, W, V, T, X) {
                P = {
                    prefix: W,
                    match: T,
                    suffix: X
                }
            })
        }
        return P
    }
    ;
    B.prototype.highlightMatches = function(P, R) {
        var Q = this;
        P.find(".avatar-with-name, .email-address").each(function() {
            var S = C(this).contents().filter(function() {
                return this.nodeType === Node.TEXT_NODE
            })
              , T = L.reduce(Q.getMatchParts(S.text(), R), function(U, V, W) {
                return U + ((W === "match") ? "<b>" + I.escapeHtml(V) + "</b>" : I.escapeHtml(V))
            }, "");
            S.replaceWith(T)
        });
        return P
    }
    ;
    B.prototype.getCaretDocumentCoordinates = function(S) {
        var P = S.offset();
        var R = J(S[0], S[0].selectionStart);
        var Q = parseInt(S.css("font-size"), 10);
        R.top += (P.top + Q);
        R.left += P.left;
        return R
    }
    ;
    B.prototype.escapeUsername = function(P) {
        if (/^\w*$/.test(P)) {
            return P
        } else {
            return '"' + P.replace(/"/g, '\\"') + '"'
        }
    }
    ;
    B.prototype.reset = function() {
        this.destroy();
        delete this.options;
        delete this.dataSource;
        delete this.$textarea;
        delete this.dialog;
        delete this.resultsCollection;
        delete this.mentionTriggerPos;
        delete this.currentCaretPos
    }
    ;
    B.prototype.destroy = function() {
        if (this.dialog) {
            this.dialog.off("itemSelected", this.selectItem);
            this.dialog.remove()
        }
        this.dataSource.off("respond", this.updateResults);
        this.dataSource.off("activity", this.onActivity);
        this.options.$container.off("keypress", this.options.selector, this.onKeyPress);
        this.options.$container.off("keydown", this.isMentioningSelector, this.onKeyDown);
        this.options.$container.off("paste", this.isMentioningSelector, this.onPaste);
        O.off("window.resize.debounced", this.updateDialogAnchorPosition);
        C(document).off("click focusin mousedown", this.onDocumentClick)
    }
    ;
    var D = L.once(function(Q, P) {
        var R = new M(Q,{
            queryEndpoint: A.rest().users().build(),
            queryParamKey: "filter",
            queryData: {
                avatarSize: stash.widget.avatarSizeInPx({
                    size: "small"
                }),
                permission: "LICENSED_USER"
            },
            maxResults: 5,
            model: E,
            matcher: P
        });
        R.parse = G.dot("values");
        R.getFilteredResults = function(T) {
            var S = this.filter(function(U) {
                return ( !!this.matcher(U, T))
            }, this);
            if (this._maxResults) {
                S = L.take(S, this._maxResults)
            }
            return S
        }
        ;
        return R
    });
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-raw', location = '/static/bower/CodeMirror/lib/codemirror.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        module.exports = A()
    } else {
        if (typeof define == "function" && define.amd) {
            return define([], A)
        } else {
            this.CodeMirror = A()
        }
    }
})(function() {
    var CN = /gecko\/\d/i.test(navigator.userAgent);
    var Ee = /MSIE \d/.test(navigator.userAgent);
    var Bh = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);
    var De = Ee || Bh;
    var K = De && (Ee ? document.documentMode || 6 : Bh[1]);
    var Cx = /WebKit\//.test(navigator.userAgent);
    var Dh = Cx && /Qt\/\d+\.\d+/.test(navigator.userAgent);
    var C9 = /Chrome\//.test(navigator.userAgent);
    var Dw = /Opera\//.test(navigator.userAgent);
    var AZ = /Apple Computer/.test(navigator.vendor);
    var A7 = /KHTML\//.test(navigator.userAgent);
    var C4 = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent);
    var FP = /PhantomJS/.test(navigator.userAgent);
    var Ev = /AppleWebKit/.test(navigator.userAgent) && /Mobile\/\w+/.test(navigator.userAgent);
    var EA = Ev || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);
    var B5 = Ev || /Mac/.test(navigator.platform);
    var Al = /win/i.test(navigator.platform);
    var Au = Dw && navigator.userAgent.match(/Version\/(\d*\.\d*)/);
    if (Au) {
        Au = Number(Au[1])
    }
    if (Au && Au >= 15) {
        Dw = false;
        Cx = true
    }
    var Bo = B5 && (Dh || Dw && (Au == null || Au < 12.11));
    var Fy = CN || (De && K >= 9);
    var F1 = false
      , A3 = false;
    function i(F6, F7) {
        if (!(this instanceof i)) {
            return new i(F6,F7)
        }
        this.options = F7 = F7 ? Aj(F7) : {};
        Aj(Ex, F7, false);
        CC(F7);
        var GB = F7.value;
        if (typeof GB == "string") {
            GB = new AR(GB,F7.mode)
        }
        this.doc = GB;
        var GA = this.display = new Ec(F6,GB);
        GA.wrapper.CodeMirror = this;
        D6(this);
        Cl(this);
        if (F7.lineWrapping) {
            this.display.wrapper.className += " CodeMirror-wrap"
        }
        if (F7.autofocus && !EA) {
            ET(this)
        }
        Aa(this);
        this.state = {
            keyMaps: [],
            overlays: [],
            modeGen: 0,
            overwrite: false,
            focused: false,
            suppressEdits: false,
            pasteIncoming: false,
            cutIncoming: false,
            draggingText: false,
            highlight: new F5(),
            keySeq: null
        };
        if (De && K < 11) {
            setTimeout(CU(FJ, this, true), 20)
        }
        Fk(this);
        BF();
        Cf(this);
        this.curOp.forceUpdate = true;
        D5(this, GB);
        if ((F7.autofocus && !EA) || Di() == GA.input) {
            setTimeout(CU(CZ, this), 20)
        } else {
            Ar(this)
        }
        for (var F9 in BB) {
            if (BB.hasOwnProperty(F9)) {
                BB[F9](this, F7[F9], CA)
            }
        }
        Dz(this);
        for (var F8 = 0; F8 < A4.length; ++F8) {
            A4[F8](this)
        }
        AL(this);
        if (Cx && F7.lineWrapping && getComputedStyle(GA.lineDiv).textRendering == "optimizelegibility") {
            GA.lineDiv.style.textRendering = "auto"
        }
    }
    function Ec(F6, F8) {
        var F9 = this;
        var F7 = F9.input = Fr("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none");
        if (Cx) {
            F7.style.width = "1000px"
        } else {
            F7.setAttribute("wrap", "off")
        }
        if (Ev) {
            F7.style.border = "1px solid black"
        }
        F7.setAttribute("autocorrect", "off");
        F7.setAttribute("autocapitalize", "off");
        F7.setAttribute("spellcheck", "false");
        F9.inputDiv = Fr("div", [F7], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
        F9.scrollbarFiller = Fr("div", null, "CodeMirror-scrollbar-filler");
        F9.scrollbarFiller.setAttribute("not-content", "true");
        F9.gutterFiller = Fr("div", null, "CodeMirror-gutter-filler");
        F9.gutterFiller.setAttribute("not-content", "true");
        F9.lineDiv = Fr("div", null, "CodeMirror-code");
        F9.selectionDiv = Fr("div", null, null, "position: relative; z-index: 1");
        F9.cursorDiv = Fr("div", null, "CodeMirror-cursors");
        F9.measure = Fr("div", null, "CodeMirror-measure");
        F9.lineMeasure = Fr("div", null, "CodeMirror-measure");
        F9.lineSpace = Fr("div", [F9.measure, F9.lineMeasure, F9.selectionDiv, F9.cursorDiv, F9.lineDiv], null, "position: relative; outline: none");
        F9.mover = Fr("div", [Fr("div", [F9.lineSpace], "CodeMirror-lines")], null, "position: relative");
        F9.sizer = Fr("div", [F9.mover], "CodeMirror-sizer");
        F9.sizerWidth = null;
        F9.heightForcer = Fr("div", null, null, "position: absolute; height: " + Dd + "px; width: 1px;");
        F9.gutters = Fr("div", null, "CodeMirror-gutters");
        F9.lineGutter = null;
        F9.scroller = Fr("div", [F9.sizer, F9.heightForcer, F9.gutters], "CodeMirror-scroll");
        F9.scroller.setAttribute("tabIndex", "-1");
        F9.wrapper = Fr("div", [F9.inputDiv, F9.scrollbarFiller, F9.gutterFiller, F9.scroller], "CodeMirror");
        if (De && K < 8) {
            F9.gutters.style.zIndex = -1;
            F9.scroller.style.paddingRight = 0
        }
        if (Ev) {
            F7.style.width = "0px"
        }
        if (!Cx) {
            F9.scroller.draggable = true
        }
        if (A7) {
            F9.inputDiv.style.height = "1px";
            F9.inputDiv.style.position = "absolute"
        }
        if (F6) {
            if (F6.appendChild) {
                F6.appendChild(F9.wrapper)
            } else {
                F6(F9.wrapper)
            }
        }
        F9.viewFrom = F9.viewTo = F8.first;
        F9.reportedViewFrom = F9.reportedViewTo = F8.first;
        F9.view = [];
        F9.renderedView = null;
        F9.externalMeasured = null;
        F9.viewOffset = 0;
        F9.lastWrapHeight = F9.lastWrapWidth = 0;
        F9.updateLineNumbers = null;
        F9.nativeBarWidth = F9.barHeight = F9.barWidth = 0;
        F9.scrollbarsClipped = false;
        F9.lineNumWidth = F9.lineNumInnerWidth = F9.lineNumChars = null;
        F9.prevInput = "";
        F9.alignWidgets = false;
        F9.pollingFast = false;
        F9.poll = new F5();
        F9.cachedCharWidth = F9.cachedTextHeight = F9.cachedPaddingH = null;
        F9.inaccurateSelection = false;
        F9.maxLine = null;
        F9.maxLineLength = 0;
        F9.maxLineChanged = false;
        F9.wheelDX = F9.wheelDY = F9.wheelStartX = F9.wheelStartY = null;
        F9.shift = false;
        F9.selForContextMenu = null
    }
    function BP(F6) {
        F6.doc.mode = i.getMode(F6.options, F6.doc.modeOption);
        EF(F6)
    }
    function EF(F6) {
        F6.doc.iter(function(F7) {
            if (F7.stateAfter) {
                F7.stateAfter = null
            }
            if (F7.styles) {
                F7.styles = null
            }
        });
        F6.doc.frontier = F6.doc.first;
        D9(F6, 100);
        F6.state.modeGen++;
        if (F6.curOp) {
            AG(F6)
        }
    }
    function Ea(F6) {
        if (F6.options.lineWrapping) {
            FV(F6.display.wrapper, "CodeMirror-wrap");
            F6.display.sizer.style.minWidth = "";
            F6.display.sizerWidth = null
        } else {
            F(F6.display.wrapper, "CodeMirror-wrap");
            G(F6)
        }
        y(F6);
        AG(F6);
        AJ(F6);
        setTimeout(function() {
            Es(F6)
        }, 100)
    }
    function BA(F6) {
        var F8 = At(F6.display)
          , F7 = F6.options.lineWrapping;
        var F9 = F7 && Math.max(5, F6.display.scroller.clientWidth / DX(F6.display) - 3);
        return function(GB) {
            if (FR(F6.doc, GB)) {
                return 0
            }
            var GA = 0;
            if (GB.widgets) {
                for (var GC = 0; GC < GB.widgets.length; GC++) {
                    if (GB.widgets[GC].height) {
                        GA += GB.widgets[GC].height
                    }
                }
            }
            if (F7) {
                return GA + (Math.ceil(GB.text.length / F9) || 1) * F8
            } else {
                return GA + F8
            }
        }
    }
    function y(F6) {
        var F8 = F6.doc
          , F7 = BA(F6);
        F8.iter(function(F9) {
            var GA = F7(F9);
            if (GA != F9.height) {
                Fu(F9, GA)
            }
        })
    }
    function Cl(F6) {
        F6.display.wrapper.className = F6.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") + F6.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
        AJ(F6)
    }
    function DQ(F6) {
        D6(F6);
        AG(F6);
        setTimeout(function() {
            EY(F6)
        }, 20)
    }
    function D6(F6) {
        var F7 = F6.display.gutters
          , GB = F6.options.gutters;
        Dv(F7);
        for (var F8 = 0; F8 < GB.length; ++F8) {
            var F9 = GB[F8];
            var GA = F7.appendChild(Fr("div", null, "CodeMirror-gutter " + F9));
            if (F9 == "CodeMirror-linenumbers") {
                F6.display.lineGutter = GA;
                GA.style.width = (F6.display.lineNumWidth || 1) + "px"
            }
        }
        F7.style.display = F8 ? "" : "none";
        C1(F6)
    }
    function C1(F6) {
        var F7 = F6.display.gutters.offsetWidth;
        F6.display.sizer.style.marginLeft = F7 + "px"
    }
    function EH(F8) {
        if (F8.height == 0) {
            return 0
        }
        var F7 = F8.text.length, F6, GA = F8;
        while (F6 = Ei(GA)) {
            var F9 = F6.find(0, true);
            GA = F9.from.line;
            F7 += F9.from.ch - F9.to.ch
        }
        GA = F8;
        while (F6 = EP(GA)) {
            var F9 = F6.find(0, true);
            F7 -= GA.text.length - F9.from.ch;
            GA = F9.to.line;
            F7 += GA.text.length - F9.to.ch
        }
        return F7
    }
    function G(F6) {
        var F8 = F6.display
          , F7 = F6.doc;
        F8.maxLine = E9(F7, F7.first);
        F8.maxLineLength = EH(F8.maxLine);
        F8.maxLineChanged = true;
        F7.iter(function(GA) {
            var F9 = EH(GA);
            if (F9 > F8.maxLineLength) {
                F8.maxLineLength = F9;
                F8.maxLine = GA
            }
        })
    }
    function CC(F6) {
        var F7 = DE(F6.gutters, "CodeMirror-linenumbers");
        if (F7 == -1 && F6.lineNumbers) {
            F6.gutters = F6.gutters.concat(["CodeMirror-linenumbers"])
        } else {
            if (F7 > -1 && !F6.lineNumbers) {
                F6.gutters = F6.gutters.slice(0);
                F6.gutters.splice(F7, 1)
            }
        }
    }
    function DU(F6) {
        var F9 = F6.display
          , F8 = F9.gutters.offsetWidth;
        var F7 = Math.round(F6.doc.height + Bg(F6.display));
        return {
            clientHeight: F9.scroller.clientHeight,
            viewHeight: F9.wrapper.clientHeight,
            scrollWidth: F9.scroller.scrollWidth,
            clientWidth: F9.scroller.clientWidth,
            viewWidth: F9.wrapper.clientWidth,
            barLeft: F6.options.fixedGutter ? F8 : 0,
            docHeight: F7,
            scrollHeight: F7 + Cq(F6) + F9.barHeight,
            nativeBarWidth: F9.nativeBarWidth,
            gutterWidth: F8
        }
    }
    function DG(F8, F7, F6) {
        this.cm = F6;
        var F9 = this.vert = Fr("div", [Fr("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
        var GA = this.horiz = Fr("div", [Fr("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
        F8(F9);
        F8(GA);
        Bv(F9, "scroll", function() {
            if (F9.clientHeight) {
                F7(F9.scrollTop, "vertical")
            }
        });
        Bv(GA, "scroll", function() {
            if (GA.clientWidth) {
                F7(GA.scrollLeft, "horizontal")
            }
        });
        this.checkedOverlay = false;
        if (De && K < 8) {
            this.horiz.style.minHeight = this.vert.style.minWidth = "18px"
        }
    }
    DG.prototype = Aj({
        update: function(F9) {
            var GA = F9.scrollWidth > F9.clientWidth + 1;
            var F8 = F9.scrollHeight > F9.clientHeight + 1;
            var GB = F9.nativeBarWidth;
            if (F8) {
                this.vert.style.display = "block";
                this.vert.style.bottom = GA ? GB + "px" : "0";
                var F7 = F9.viewHeight - (GA ? GB : 0);
                this.vert.firstChild.style.height = Math.max(0, F9.scrollHeight - F9.clientHeight + F7) + "px"
            } else {
                this.vert.style.display = "";
                this.vert.firstChild.style.height = "0"
            }
            if (GA) {
                this.horiz.style.display = "block";
                this.horiz.style.right = F8 ? GB + "px" : "0";
                this.horiz.style.left = F9.barLeft + "px";
                var F6 = F9.viewWidth - F9.barLeft - (F8 ? GB : 0);
                this.horiz.firstChild.style.width = (F9.scrollWidth - F9.clientWidth + F6) + "px"
            } else {
                this.horiz.style.display = "";
                this.horiz.firstChild.style.width = "0"
            }
            if (!this.checkedOverlay && F9.clientHeight > 0) {
                if (GB == 0) {
                    this.overlayHack()
                }
                this.checkedOverlay = true
            }
            return {
                right: F8 ? GB : 0,
                bottom: GA ? GB : 0
            }
        },
        setScrollLeft: function(F6) {
            if (this.horiz.scrollLeft != F6) {
                this.horiz.scrollLeft = F6
            }
        },
        setScrollTop: function(F6) {
            if (this.vert.scrollTop != F6) {
                this.vert.scrollTop = F6
            }
        },
        overlayHack: function() {
            var F6 = B5 && !C4 ? "12px" : "18px";
            this.horiz.style.minHeight = this.vert.style.minWidth = F6;
            var F7 = this;
            var F8 = function(F9) {
                if (m(F9) != F7.vert && m(F9) != F7.horiz) {
                    Cz(F7.cm, EN)(F9)
                }
            };
            Bv(this.vert, "mousedown", F8);
            Bv(this.horiz, "mousedown", F8)
        },
        clear: function() {
            var F6 = this.horiz.parentNode;
            F6.removeChild(this.horiz);
            F6.removeChild(this.vert)
        }
    }, DG.prototype);
    function Ey() {}
    Ey.prototype = Aj({
        update: function() {
            return {
                bottom: 0,
                right: 0
            }
        },
        setScrollLeft: function() {},
        setScrollTop: function() {},
        clear: function() {}
    }, Ey.prototype);
    i.scrollbarModel = {
        "native": DG,
        "null": Ey
    };
    function Aa(F6) {
        if (F6.display.scrollbars) {
            F6.display.scrollbars.clear();
            if (F6.display.scrollbars.addClass) {
                F(F6.display.wrapper, F6.display.scrollbars.addClass)
            }
        }
        F6.display.scrollbars = new i.scrollbarModel[F6.options.scrollbarStyle](function(F7) {
            F6.display.wrapper.insertBefore(F7, F6.display.scrollbarFiller);
            Bv(F7, "mousedown", function() {
                if (F6.state.focused) {
                    setTimeout(CU(ET, F6), 0)
                }
            });
            F7.setAttribute("not-content", "true")
        }
        ,function(F8, F7) {
            if (F7 == "horizontal") {
                Bc(F6, F8)
            } else {
                o(F6, F8)
            }
        }
        ,F6);
        if (F6.display.scrollbars.addClass) {
            FV(F6.display.wrapper, F6.display.scrollbars.addClass)
        }
    }
    function Es(F8, GA) {
        if (!GA) {
            GA = DU(F8)
        }
        var F7 = F8.display.barWidth
          , F6 = F8.display.barHeight;
        Aq(F8, GA);
        for (var F9 = 0; F9 < 4 && F7 != F8.display.barWidth || F6 != F8.display.barHeight; F9++) {
            if (F7 != F8.display.barWidth && F8.options.lineWrapping) {
                A5(F8)
            }
            Aq(F8, DU(F8));
            F7 = F8.display.barWidth;
            F6 = F8.display.barHeight
        }
    }
    function Aq(F6, F7) {
        var F9 = F6.display;
        var F8 = F9.scrollbars.update(F7);
        F9.sizer.style.paddingRight = (F9.barWidth = F8.right) + "px";
        F9.sizer.style.paddingBottom = (F9.barHeight = F8.bottom) + "px";
        if (F8.right && F8.bottom) {
            F9.scrollbarFiller.style.display = "block";
            F9.scrollbarFiller.style.height = F8.bottom + "px";
            F9.scrollbarFiller.style.width = F8.right + "px"
        } else {
            F9.scrollbarFiller.style.display = ""
        }
        if (F8.bottom && F6.options.coverGutterNextToScrollbar && F6.options.fixedGutter) {
            F9.gutterFiller.style.display = "block";
            F9.gutterFiller.style.height = F8.bottom + "px";
            F9.gutterFiller.style.width = F7.gutterWidth + "px"
        } else {
            F9.gutterFiller.style.display = ""
        }
    }
    function B4(F9, GD, F8) {
        var GA = F8 && F8.top != null ? Math.max(0, F8.top) : F9.scroller.scrollTop;
        GA = Math.floor(GA - E2(F9));
        var F6 = F8 && F8.bottom != null ? F8.bottom : GA + F9.wrapper.clientHeight;
        var GB = Be(GD, GA)
          , GC = Be(GD, F6);
        if (F8 && F8.ensure) {
            var F7 = F8.ensure.from.line
              , GE = F8.ensure.to.line;
            if (F7 < GB) {
                GB = F7;
                GC = Be(GD, Bk(E9(GD, F7)) + F9.wrapper.clientHeight)
            } else {
                if (Math.min(GE, GD.lastLine()) >= GC) {
                    GB = Be(GD, Bk(E9(GD, GE)) - F9.wrapper.clientHeight);
                    GC = GE
                }
            }
        }
        return {
            from: GB,
            to: Math.max(GC, GB + 1)
        }
    }
    function EY(GE) {
        var GC = GE.display
          , GD = GC.view;
        if (!GC.alignWidgets && (!GC.gutters.firstChild || !GE.options.fixedGutter)) {
            return
        }
        var GA = Dr(GC) - GC.scroller.scrollLeft + GE.doc.scrollLeft;
        var F6 = GC.gutters.offsetWidth
          , F7 = GA + "px";
        for (var F9 = 0; F9 < GD.length; F9++) {
            if (!GD[F9].hidden) {
                if (GE.options.fixedGutter && GD[F9].gutter) {
                    GD[F9].gutter.style.left = F7
                }
                var GB = GD[F9].alignable;
                if (GB) {
                    for (var F8 = 0; F8 < GB.length; F8++) {
                        GB[F8].style.left = F7
                    }
                }
            }
        }
        if (GE.options.fixedGutter) {
            GC.gutters.style.left = (GA + F6) + "px"
        }
    }
    function Dz(F6) {
        if (!F6.options.lineNumbers) {
            return false
        }
        var GB = F6.doc
          , F7 = EM(F6.options, GB.first + GB.size - 1)
          , GA = F6.display;
        if (F7.length != GA.lineNumChars) {
            var GC = GA.measure.appendChild(Fr("div", [Fr("div", F7)], "CodeMirror-linenumber CodeMirror-gutter-elt"));
            var F8 = GC.firstChild.offsetWidth
              , F9 = GC.offsetWidth - F8;
            GA.lineGutter.style.width = "";
            GA.lineNumInnerWidth = Math.max(F8, GA.lineGutter.offsetWidth - F9);
            GA.lineNumWidth = GA.lineNumInnerWidth + F9;
            GA.lineNumChars = GA.lineNumInnerWidth ? F7.length : -1;
            GA.lineGutter.style.width = GA.lineNumWidth + "px";
            C1(F6);
            return true
        }
        return false
    }
    function EM(F6, F7) {
        return String(F6.lineNumberFormatter(F7 + F6.firstLineNumber))
    }
    function Dr(F6) {
        return F6.scroller.getBoundingClientRect().left - F6.sizer.getBoundingClientRect().left
    }
    function Af(F7, F6, F8) {
        var F9 = F7.display;
        this.viewport = F6;
        this.visible = B4(F9, F7.doc, F6);
        this.editorIsHidden = !F9.wrapper.offsetWidth;
        this.wrapperHeight = F9.wrapper.clientHeight;
        this.wrapperWidth = F9.wrapper.clientWidth;
        this.oldDisplayWidth = DH(F7);
        this.force = F8;
        this.dims = E7(F7)
    }
    function k(F6) {
        var F7 = F6.display;
        if (!F7.scrollbarsClipped && F7.scroller.offsetWidth) {
            F7.nativeBarWidth = F7.scroller.offsetWidth - F7.scroller.clientWidth;
            F7.heightForcer.style.height = Cq(F6) + "px";
            F7.sizer.style.marginBottom = -F7.nativeBarWidth + "px";
            F7.sizer.style.borderRightWidth = Cq(F6) + "px";
            F7.scrollbarsClipped = true
        }
    }
    function c(GF, F9) {
        var GA = GF.display
          , GE = GF.doc;
        if (F9.editorIsHidden) {
            EQ(GF);
            return false
        }
        if (!F9.force && F9.visible.from >= GA.viewFrom && F9.visible.to <= GA.viewTo && (GA.updateLineNumbers == null || GA.updateLineNumbers >= GA.viewTo) && GA.renderedView == GA.view && C8(GF) == 0) {
            return false
        }
        if (Dz(GF)) {
            EQ(GF);
            F9.dims = E7(GF)
        }
        var F8 = GE.first + GE.size;
        var GC = Math.max(F9.visible.from - GF.options.viewportMargin, GE.first);
        var GD = Math.min(F8, F9.visible.to + GF.options.viewportMargin);
        if (GA.viewFrom < GC && GC - GA.viewFrom < 20) {
            GC = Math.max(GE.first, GA.viewFrom)
        }
        if (GA.viewTo > GD && GA.viewTo - GD < 20) {
            GD = Math.min(F8, GA.viewTo)
        }
        if (A3) {
            GC = As(GF.doc, GC);
            GD = Dx(GF.doc, GD)
        }
        var F7 = GC != GA.viewFrom || GD != GA.viewTo || GA.lastWrapHeight != F9.wrapperHeight || GA.lastWrapWidth != F9.wrapperWidth;
        Co(GF, GC, GD);
        GA.viewOffset = Bk(E9(GF.doc, GA.viewFrom));
        GF.display.mover.style.top = GA.viewOffset + "px";
        var F6 = C8(GF);
        if (!F7 && F6 == 0 && !F9.force && GA.renderedView == GA.view && (GA.updateLineNumbers == null || GA.updateLineNumbers >= GA.viewTo)) {
            return false
        }
        var GB = Di();
        if (F6 > 4) {
            GA.lineDiv.style.display = "none"
        }
        CL(GF, GA.updateLineNumbers, F9.dims);
        if (F6 > 4) {
            GA.lineDiv.style.display = ""
        }
        GA.renderedView = GA.view;
        if (GB && Di() != GB && GB.offsetHeight) {
            GB.focus()
        }
        Dv(GA.cursorDiv);
        Dv(GA.selectionDiv);
        GA.gutters.style.height = 0;
        if (F7) {
            GA.lastWrapHeight = F9.wrapperHeight;
            GA.lastWrapWidth = F9.wrapperWidth;
            D9(GF, 400)
        }
        GA.updateLineNumbers = null;
        return true
    }
    function CI(F7, GB) {
        var F9 = GB.force
          , F6 = GB.viewport;
        for (var GA = true; ; GA = false) {
            if (GA && F7.options.lineWrapping && GB.oldDisplayWidth != DH(F7)) {
                F9 = true
            } else {
                F9 = false;
                if (F6 && F6.top != null) {
                    F6 = {
                        top: Math.min(F7.doc.height + Bg(F7.display) - Cs(F7), F6.top)
                    }
                }
                GB.visible = B4(F7.display, F7.doc, F6);
                if (GB.visible.from >= F7.display.viewFrom && GB.visible.to <= F7.display.viewTo) {
                    break
                }
            }
            if (!c(F7, GB)) {
                break
            }
            A5(F7);
            var F8 = DU(F7);
            Ba(F7);
            DT(F7, F8);
            Es(F7, F8)
        }
        AD(F7, "update", F7);
        if (F7.display.viewFrom != F7.display.reportedViewFrom || F7.display.viewTo != F7.display.reportedViewTo) {
            AD(F7, "viewportChange", F7, F7.display.viewFrom, F7.display.viewTo);
            F7.display.reportedViewFrom = F7.display.viewFrom;
            F7.display.reportedViewTo = F7.display.viewTo
        }
    }
    function Dn(F7, F6) {
        var F9 = new Af(F7,F6);
        if (c(F7, F9)) {
            A5(F7);
            CI(F7, F9);
            var F8 = DU(F7);
            Ba(F7);
            DT(F7, F8);
            Es(F7, F8)
        }
    }
    function DT(F6, F7) {
        F6.display.sizer.style.minHeight = F7.docHeight + "px";
        var F8 = F7.docHeight + F6.display.barHeight;
        F6.display.heightForcer.style.top = F8 + "px";
        F6.display.gutters.style.height = Math.max(F8 + Cq(F6), F7.clientHeight) + "px"
    }
    function A5(GD) {
        var GB = GD.display;
        var F7 = GB.lineDiv.offsetTop;
        for (var F8 = 0; F8 < GB.view.length; F8++) {
            var GE = GB.view[F8], GF;
            if (GE.hidden) {
                continue
            }
            if (De && K < 8) {
                var GA = GE.node.offsetTop + GE.node.offsetHeight;
                GF = GA - F7;
                F7 = GA
            } else {
                var F9 = GE.node.getBoundingClientRect();
                GF = F9.bottom - F9.top
            }
            var GC = GE.line.height - GF;
            if (GF < 2) {
                GF = At(GB)
            }
            if (GC > 0.001 || GC < -0.001) {
                Fu(GE.line, GF);
                B9(GE.line);
                if (GE.rest) {
                    for (var F6 = 0; F6 < GE.rest.length; F6++) {
                        B9(GE.rest[F6])
                    }
                }
            }
        }
    }
    function B9(F6) {
        if (F6.widgets) {
            for (var F7 = 0; F7 < F6.widgets.length; ++F7) {
                F6.widgets[F7].height = F6.widgets[F7].node.offsetHeight
            }
        }
    }
    function E7(F6) {
        var GB = F6.display
          , F9 = {}
          , F8 = {};
        var GA = GB.gutters.clientLeft;
        for (var GC = GB.gutters.firstChild, F7 = 0; GC; GC = GC.nextSibling,
        ++F7) {
            F9[F6.options.gutters[F7]] = GC.offsetLeft + GC.clientLeft + GA;
            F8[F6.options.gutters[F7]] = GC.clientWidth
        }
        return {
            fixedPos: Dr(GB),
            gutterTotalWidth: GB.gutters.offsetWidth,
            gutterLeft: F9,
            gutterWidth: F8,
            wrapperWidth: GB.wrapper.clientWidth
        }
    }
    function CL(GH, F8, GG) {
        var GD = GH.display
          , GJ = GH.options.lineNumbers;
        var F6 = GD.lineDiv
          , GI = F6.firstChild;
        function GC(GL) {
            var GK = GL.nextSibling;
            if (Cx && B5 && GH.display.currentWheelTarget == GL) {
                GL.style.display = "none"
            } else {
                GL.parentNode.removeChild(GL)
            }
            return GK
        }
        var GE = GD.view
          , GB = GD.viewFrom;
        for (var F9 = 0; F9 < GE.length; F9++) {
            var GA = GE[F9];
            if (GA.hidden) {} else {
                if (!GA.node) {
                    var F7 = Ac(GH, GA, GB, GG);
                    F6.insertBefore(F7, GI)
                } else {
                    while (GI != GA.node) {
                        GI = GC(GI)
                    }
                    var GF = GJ && F8 != null && F8 <= GB && GA.lineNumber;
                    if (GA.changes) {
                        if (DE(GA.changes, "gutter") > -1) {
                            GF = false
                        }
                        AA(GH, GA, GB, GG)
                    }
                    if (GF) {
                        Dv(GA.lineNumber);
                        GA.lineNumber.appendChild(document.createTextNode(EM(GH.options, GB)))
                    }
                    GI = GA.node.nextSibling
                }
            }
            GB += GA.size
        }
        while (GI) {
            GI = GC(GI)
        }
    }
    function AA(F6, F8, GA, GB) {
        for (var F7 = 0; F7 < F8.changes.length; F7++) {
            var F9 = F8.changes[F7];
            if (F9 == "text") {
                FF(F6, F8)
            } else {
                if (F9 == "gutter") {
                    DC(F6, F8, GA, GB)
                } else {
                    if (F9 == "class") {
                        Da(F8)
                    } else {
                        if (F9 == "widget") {
                            AN(F8, GB)
                        }
                    }
                }
            }
        }
        F8.changes = null
    }
    function Fd(F6) {
        if (F6.node == F6.text) {
            F6.node = Fr("div", null, null, "position: relative");
            if (F6.text.parentNode) {
                F6.text.parentNode.replaceChild(F6.node, F6.text)
            }
            F6.node.appendChild(F6.text);
            if (De && K < 8) {
                F6.node.style.zIndex = 2
            }
        }
        return F6.node
    }
    function EO(F7) {
        var F6 = F7.bgClass ? F7.bgClass + " " + (F7.line.bgClass || "") : F7.line.bgClass;
        if (F6) {
            F6 += " CodeMirror-linebackground"
        }
        if (F7.background) {
            if (F6) {
                F7.background.className = F6
            } else {
                F7.background.parentNode.removeChild(F7.background);
                F7.background = null
            }
        } else {
            if (F6) {
                var F8 = Fd(F7);
                F7.background = F8.insertBefore(Fr("div", null, F6), F8.firstChild)
            }
        }
    }
    function Dp(F6, F7) {
        var F8 = F6.display.externalMeasured;
        if (F8 && F8.line == F7.line) {
            F6.display.externalMeasured = null;
            F7.measure = F8.measure;
            return F8.built
        }
        return El(F6, F7)
    }
    function FF(F6, F9) {
        var F7 = F9.text.className;
        var F8 = Dp(F6, F9);
        if (F9.text == F9.node) {
            F9.node = F8.pre
        }
        F9.text.parentNode.replaceChild(F8.pre, F9.text);
        F9.text = F8.pre;
        if (F8.bgClass != F9.bgClass || F8.textClass != F9.textClass) {
            F9.bgClass = F8.bgClass;
            F9.textClass = F8.textClass;
            Da(F9)
        } else {
            if (F7) {
                F9.text.className = F7
            }
        }
    }
    function Da(F7) {
        EO(F7);
        if (F7.line.wrapClass) {
            Fd(F7).className = F7.line.wrapClass
        } else {
            if (F7.node != F7.text) {
                F7.node.className = ""
            }
        }
        var F6 = F7.textClass ? F7.textClass + " " + (F7.line.textClass || "") : F7.line.textClass;
        F7.text.className = F6 || ""
    }
    function DC(GE, GC, GB, GD) {
        if (GC.gutter) {
            GC.node.removeChild(GC.gutter);
            GC.gutter = null
        }
        var F9 = GC.line.gutterMarkers;
        if (GE.options.lineNumbers || F9) {
            var F7 = Fd(GC);
            var GA = GC.gutter = F7.insertBefore(Fr("div", null, "CodeMirror-gutter-wrapper", "left: " + (GE.options.fixedGutter ? GD.fixedPos : -GD.gutterTotalWidth) + "px; width: " + GD.gutterTotalWidth + "px"), GC.text);
            if (GC.line.gutterClass) {
                GA.className += " " + GC.line.gutterClass
            }
            if (GE.options.lineNumbers && (!F9 || !F9["CodeMirror-linenumbers"])) {
                GC.lineNumber = GA.appendChild(Fr("div", EM(GE.options, GB), "CodeMirror-linenumber CodeMirror-gutter-elt", "left: " + GD.gutterLeft["CodeMirror-linenumbers"] + "px; width: " + GE.display.lineNumInnerWidth + "px"))
            }
            if (F9) {
                for (var F8 = 0; F8 < GE.options.gutters.length; ++F8) {
                    var F6 = GE.options.gutters[F8]
                      , GF = F9.hasOwnProperty(F6) && F9[F6];
                    if (GF) {
                        GA.appendChild(Fr("div", [GF], "CodeMirror-gutter-elt", "left: " + GD.gutterLeft[F6] + "px; width: " + GD.gutterWidth[F6] + "px"))
                    }
                }
            }
        }
    }
    function AN(F6, F9) {
        if (F6.alignable) {
            F6.alignable = null
        }
        for (var F8 = F6.node.firstChild, F7; F8; F8 = F7) {
            var F7 = F8.nextSibling;
            if (F8.className == "CodeMirror-linewidget") {
                F6.node.removeChild(F8)
            }
        }
        FO(F6, F9)
    }
    function Ac(F6, F8, F9, GA) {
        var F7 = Dp(F6, F8);
        F8.text = F8.node = F7.pre;
        if (F7.bgClass) {
            F8.bgClass = F7.bgClass
        }
        if (F7.textClass) {
            F8.textClass = F7.textClass
        }
        Da(F8);
        DC(F6, F8, F9, GA);
        FO(F8, GA);
        return F8.node
    }
    function FO(F7, F8) {
        Fw(F7.line, F7, F8, true);
        if (F7.rest) {
            for (var F6 = 0; F6 < F7.rest.length; F6++) {
                Fw(F7.rest[F6], F7, F8, false)
            }
        }
    }
    function Fw(GE, GB, GD, F9) {
        if (!GE.widgets) {
            return
        }
        var F6 = Fd(GB);
        for (var F8 = 0, GC = GE.widgets; F8 < GC.length; ++F8) {
            var GA = GC[F8]
              , F7 = Fr("div", [GA.node], "CodeMirror-linewidget");
            if (!GA.handleMouseEvents) {
                F7.setAttribute("cm-ignore-events", "true")
            }
            Bd(GA, F7, GB, GD);
            if (F9 && GA.above) {
                F6.insertBefore(F7, GB.gutter || GB.text)
            } else {
                F6.appendChild(F7)
            }
            AD(GA, "redraw")
        }
    }
    function Bd(F9, F8, F6, GA) {
        if (F9.noHScroll) {
            (F6.alignable || (F6.alignable = [])).push(F8);
            var F7 = GA.wrapperWidth;
            F8.style.left = GA.fixedPos + "px";
            if (!F9.coverGutter) {
                F7 -= GA.gutterTotalWidth;
                F8.style.paddingLeft = GA.gutterTotalWidth + "px"
            }
            F8.style.width = F7 + "px"
        }
        if (F9.coverGutter) {
            F8.style.zIndex = 5;
            F8.style.position = "relative";
            if (!F9.noHScroll) {
                F8.style.marginLeft = -GA.gutterTotalWidth + "px"
            }
        }
    }
    var x = i.Pos = function(F6, F7) {
        if (!(this instanceof x)) {
            return new x(F6,F7)
        }
        this.line = F6;
        this.ch = F7
    }
    ;
    var CD = i.cmpPos = function(F7, F6) {
        return F7.line - F6.line || F7.ch - F6.ch
    }
    ;
    function CH(F6) {
        return x(F6.line, F6.ch)
    }
    function BV(F7, F6) {
        return CD(F7, F6) < 0 ? F6 : F7
    }
    function AQ(F7, F6) {
        return CD(F7, F6) < 0 ? F7 : F6
    }
    function Fs(F6, F7) {
        this.ranges = F6;
        this.primIndex = F7
    }
    Fs.prototype = {
        primary: function() {
            return this.ranges[this.primIndex]
        },
        equals: function(F6) {
            if (F6 == this) {
                return true
            }
            if (F6.primIndex != this.primIndex || F6.ranges.length != this.ranges.length) {
                return false
            }
            for (var F8 = 0; F8 < this.ranges.length; F8++) {
                var F7 = this.ranges[F8]
                  , F9 = F6.ranges[F8];
                if (CD(F7.anchor, F9.anchor) != 0 || CD(F7.head, F9.head) != 0) {
                    return false
                }
            }
            return true
        },
        deepCopy: function() {
            for (var F6 = [], F7 = 0; F7 < this.ranges.length; F7++) {
                F6[F7] = new Ds(CH(this.ranges[F7].anchor),CH(this.ranges[F7].head))
            }
            return new Fs(F6,this.primIndex)
        },
        somethingSelected: function() {
            for (var F6 = 0; F6 < this.ranges.length; F6++) {
                if (!this.ranges[F6].empty()) {
                    return true
                }
            }
            return false
        },
        contains: function(F9, F6) {
            if (!F6) {
                F6 = F9
            }
            for (var F8 = 0; F8 < this.ranges.length; F8++) {
                var F7 = this.ranges[F8];
                if (CD(F6, F7.from()) >= 0 && CD(F9, F7.to()) <= 0) {
                    return F8
                }
            }
            return -1
        }
    };
    function Ds(F6, F7) {
        this.anchor = F6;
        this.head = F7
    }
    Ds.prototype = {
        from: function() {
            return AQ(this.anchor, this.head)
        },
        to: function() {
            return BV(this.anchor, this.head)
        },
        empty: function() {
            return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch
        }
    };
    function CV(F6, GD) {
        var F8 = F6[GD];
        F6.sort(function(GG, GF) {
            return CD(GG.from(), GF.from())
        });
        GD = DE(F6, F8);
        for (var GA = 1; GA < F6.length; GA++) {
            var GE = F6[GA]
              , F7 = F6[GA - 1];
            if (CD(F7.to(), GE.from()) >= 0) {
                var GB = AQ(F7.from(), GE.from())
                  , GC = BV(F7.to(), GE.to());
                var F9 = F7.empty() ? GE.from() == GE.head : F7.from() == F7.head;
                if (GA <= GD) {
                    --GD
                }
                F6.splice(--GA, 2, new Ds(F9 ? GC : GB,F9 ? GB : GC))
            }
        }
        return new Fs(F6,GD)
    }
    function Em(F6, F7) {
        return new Fs([new Ds(F6,F7 || F6)],0)
    }
    function C2(F6, F7) {
        return Math.max(F6.first, Math.min(F7, F6.first + F6.size - 1))
    }
    function Fe(F7, F8) {
        if (F8.line < F7.first) {
            return x(F7.first, 0)
        }
        var F6 = F7.first + F7.size - 1;
        if (F8.line > F6) {
            return x(F6, E9(F7, F6).text.length)
        }
        return FN(F8, E9(F7, F8.line).text.length)
    }
    function FN(F8, F7) {
        var F6 = F8.ch;
        if (F6 == null || F6 > F7) {
            return x(F8.line, F7)
        } else {
            if (F6 < 0) {
                return x(F8.line, 0)
            } else {
                return F8
            }
        }
    }
    function B7(F7, F6) {
        return F6 >= F7.first && F6 < F7.first + F7.size
    }
    function Dt(F8, F9) {
        for (var F6 = [], F7 = 0; F7 < F9.length; F7++) {
            F6[F7] = Fe(F8, F9[F7])
        }
        return F6
    }
    function FQ(GB, F7, GA, F6) {
        if (GB.cm && GB.cm.display.shift || GB.extend) {
            var F9 = F7.anchor;
            if (F6) {
                var F8 = CD(GA, F9) < 0;
                if (F8 != (CD(F6, F9) < 0)) {
                    F9 = GA;
                    GA = F6
                } else {
                    if (F8 != (CD(GA, F6) < 0)) {
                        GA = F6
                    }
                }
            }
            return new Ds(F9,GA)
        } else {
            return new Ds(F6 || GA,GA)
        }
    }
    function Fo(F9, F8, F6, F7) {
        Bs(F9, new Fs([FQ(F9, F9.sel.primary(), F8, F6)],0), F7)
    }
    function AU(GB, GA, F8) {
        for (var F7 = [], F9 = 0; F9 < GB.sel.ranges.length; F9++) {
            F7[F9] = FQ(GB, GB.sel.ranges[F9], GA[F9], null)
        }
        var F6 = CV(F7, GB.sel.primIndex);
        Bs(GB, F6, F8)
    }
    function E(GA, F9, F7, F8) {
        var F6 = GA.sel.ranges.slice(0);
        F6[F9] = F7;
        Bs(GA, CV(F6, GA.sel.primIndex), F8)
    }
    function g(F9, F7, F8, F6) {
        Bs(F9, Em(F7, F8), F6)
    }
    function C(F8, F6) {
        var F7 = {
            ranges: F6.ranges,
            update: function(F9) {
                this.ranges = [];
                for (var GA = 0; GA < F9.length; GA++) {
                    this.ranges[GA] = new Ds(Fe(F8, F9[GA].anchor),Fe(F8, F9[GA].head))
                }
            }
        };
        Ab(F8, "beforeSelectionChange", F8, F7);
        if (F8.cm) {
            Ab(F8.cm, "beforeSelectionChange", F8.cm, F7)
        }
        if (F7.ranges != F6.ranges) {
            return CV(F7.ranges, F7.ranges.length - 1)
        } else {
            return F6
        }
    }
    function E1(GA, F9, F7) {
        var F6 = GA.history.done
          , F8 = Fc(F6);
        if (F8 && F8.ranges) {
            F6[F6.length - 1] = F9;
            EJ(GA, F9, F7)
        } else {
            Bs(GA, F9, F7)
        }
    }
    function Bs(F8, F7, F6) {
        EJ(F8, F7, F6);
        F0(F8, F8.sel, F8.cm ? F8.cm.curOp.id : NaN, F6)
    }
    function EJ(F9, F8, F7) {
        if (FC(F9, "beforeSelectionChange") || F9.cm && FC(F9.cm, "beforeSelectionChange")) {
            F8 = C(F9, F8)
        }
        var F6 = F7 && F7.bias || (CD(F8.primary().head, F9.sel.primary().head) < 0 ? -1 : 1);
        C6(F9, N(F9, F8, F6, true));
        if (!(F7 && F7.scroll === false) && F9.cm) {
            Fb(F9.cm)
        }
    }
    function C6(F7, F6) {
        if (F6.equals(F7.sel)) {
            return
        }
        F7.sel = F6;
        if (F7.cm) {
            F7.cm.curOp.updateInput = F7.cm.curOp.selectionChanged = true;
            w(F7.cm)
        }
        AD(F7, "cursorActivity", F7)
    }
    function ER(F6) {
        C6(F6, N(F6, F6.sel, null, false), z)
    }
    function N(GE, F6, GB, GC) {
        var F8;
        for (var F9 = 0; F9 < F6.ranges.length; F9++) {
            var GA = F6.ranges[F9];
            var GD = Bt(GE, GA.anchor, GB, GC);
            var F7 = Bt(GE, GA.head, GB, GC);
            if (F8 || GD != GA.anchor || F7 != GA.head) {
                if (!F8) {
                    F8 = F6.ranges.slice(0, F9)
                }
                F8[F9] = new Ds(GD,F7)
            }
        }
        return F8 ? CV(F8, F6.primIndex) : F6
    }
    function Bt(GF, GE, GB, GC) {
        var GG = false
          , F8 = GE;
        var F9 = GB || 1;
        GF.cantEdit = false;
        search: for (; ; ) {
            var GH = E9(GF, F8.line);
            if (GH.markedSpans) {
                for (var GA = 0; GA < GH.markedSpans.length; ++GA) {
                    var F6 = GH.markedSpans[GA]
                      , F7 = F6.marker;
                    if ((F6.from == null || (F7.inclusiveLeft ? F6.from <= F8.ch : F6.from < F8.ch)) && (F6.to == null || (F7.inclusiveRight ? F6.to >= F8.ch : F6.to > F8.ch))) {
                        if (GC) {
                            Ab(F7, "beforeCursorEnter");
                            if (F7.explicitlyCleared) {
                                if (!GH.markedSpans) {
                                    break
                                } else {
                                    --GA;
                                    continue
                                }
                            }
                        }
                        if (!F7.atomic) {
                            continue
                        }
                        var GD = F7.find(F9 < 0 ? -1 : 1);
                        if (CD(GD, F8) == 0) {
                            GD.ch += F9;
                            if (GD.ch < 0) {
                                if (GD.line > GF.first) {
                                    GD = Fe(GF, x(GD.line - 1))
                                } else {
                                    GD = null
                                }
                            } else {
                                if (GD.ch > GH.text.length) {
                                    if (GD.line < GF.first + GF.size - 1) {
                                        GD = x(GD.line + 1, 0)
                                    } else {
                                        GD = null
                                    }
                                }
                            }
                            if (!GD) {
                                if (GG) {
                                    if (!GC) {
                                        return Bt(GF, GE, GB, true)
                                    }
                                    GF.cantEdit = true;
                                    return x(GF.first, 0)
                                }
                                GG = true;
                                GD = GE;
                                F9 = -F9
                            }
                        }
                        F8 = GD;
                        continue search
                    }
                }
            }
            return F8
        }
    }
    function BJ(GG) {
        var GC = GG.display
          , GF = GG.doc
          , GH = {};
        var GE = GH.cursors = document.createDocumentFragment();
        var F8 = GH.selection = document.createDocumentFragment();
        for (var GA = 0; GA < GF.sel.ranges.length; GA++) {
            var GB = GF.sel.ranges[GA];
            var F9 = GB.empty();
            if (F9 || GG.options.showCursorWhenSelecting) {
                a(GG, GB, GE)
            }
            if (!F9) {
                Bb(GG, GB, F8)
            }
        }
        if (GG.options.moveInputWithCursor) {
            var GD = Do(GG, GF.sel.primary().head, "div");
            var F6 = GC.wrapper.getBoundingClientRect()
              , F7 = GC.lineDiv.getBoundingClientRect();
            GH.teTop = Math.max(0, Math.min(GC.wrapper.clientHeight - 10, GD.top + F7.top - F6.top));
            GH.teLeft = Math.max(0, Math.min(GC.wrapper.clientWidth - 10, GD.left + F7.left - F6.left))
        }
        return GH
    }
    function AK(F6, F7) {
        Bp(F6.display.cursorDiv, F7.cursors);
        Bp(F6.display.selectionDiv, F7.selection);
        if (F7.teTop != null) {
            F6.display.inputDiv.style.top = F7.teTop + "px";
            F6.display.inputDiv.style.left = F7.teLeft + "px"
        }
    }
    function Ba(F6) {
        AK(F6, BJ(F6))
    }
    function a(F6, F9, F8) {
        var GB = Do(F6, F9.head, "div", null, null, !F6.options.singleCursorHeightPerLine);
        var GA = F8.appendChild(Fr("div", "\u00a0", "CodeMirror-cursor"));
        GA.style.left = GB.left + "px";
        GA.style.top = GB.top + "px";
        GA.style.height = Math.max(0, GB.bottom - GB.top) * F6.options.cursorHeight + "px";
        if (GB.other) {
            var F7 = F8.appendChild(Fr("div", "\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));
            F7.style.display = "";
            F7.style.left = GB.other.left + "px";
            F7.style.top = GB.other.top + "px";
            F7.style.height = (GB.other.bottom - GB.other.top) * 0.85 + "px"
        }
    }
    function Bb(GA, GG, GB) {
        var GJ = GA.display
          , GN = GA.doc;
        var F6 = document.createDocumentFragment();
        var GF = Ez(GA.display)
          , F9 = GF.left;
        var GK = Math.max(GJ.sizerWidth, DH(GA) - GJ.sizer.offsetLeft) - GF.right;
        function GH(GR, GQ, GP, GO) {
            if (GQ < 0) {
                GQ = 0
            }
            GQ = Math.round(GQ);
            GO = Math.round(GO);
            F6.appendChild(Fr("div", null, "CodeMirror-selected", "position: absolute; left: " + GR + "px; top: " + GQ + "px; width: " + (GP == null ? GK - GR : GP) + "px; height: " + (GO - GQ) + "px"))
        }
        function F7(GP, GR, GU) {
            var GQ = E9(GN, GP);
            var GS = GQ.text.length;
            var GV, GO;
            function GT(GX, GW) {
                return Cg(GA, x(GP, GX), "div", GQ, GW)
            }
            Dy(A(GQ), GR || 0, GU == null ? GS : GU, function(Gd, Gc, GW) {
                var GZ = GT(Gd, "left"), Ga, Gb, GY;
                if (Gd == Gc) {
                    Ga = GZ;
                    Gb = GY = GZ.left
                } else {
                    Ga = GT(Gc - 1, "right");
                    if (GW == "rtl") {
                        var GX = GZ;
                        GZ = Ga;
                        Ga = GX
                    }
                    Gb = GZ.left;
                    GY = Ga.right
                }
                if (GR == null && Gd == 0) {
                    Gb = F9
                }
                if (Ga.top - GZ.top > 3) {
                    GH(Gb, GZ.top, null, GZ.bottom);
                    Gb = F9;
                    if (GZ.bottom < Ga.top) {
                        GH(Gb, GZ.bottom, null, Ga.top)
                    }
                }
                if (GU == null && Gc == GS) {
                    GY = GK
                }
                if (!GV || GZ.top < GV.top || GZ.top == GV.top && GZ.left < GV.left) {
                    GV = GZ
                }
                if (!GO || Ga.bottom > GO.bottom || Ga.bottom == GO.bottom && Ga.right > GO.right) {
                    GO = Ga
                }
                if (Gb < F9 + 1) {
                    Gb = F9
                }
                GH(Gb, Ga.top, GY - Gb, Ga.bottom)
            });
            return {
                start: GV,
                end: GO
            }
        }
        var GM = GG.from()
          , GL = GG.to();
        if (GM.line == GL.line) {
            F7(GM.line, GM.ch, GL.ch)
        } else {
            var F8 = E9(GN, GM.line)
              , GD = E9(GN, GL.line);
            var GC = Y(F8) == Y(GD);
            var GE = F7(GM.line, GM.ch, GC ? F8.text.length + 1 : null).end;
            var GI = F7(GL.line, GC ? 0 : null, GL.ch).start;
            if (GC) {
                if (GE.top < GI.top - 2) {
                    GH(GE.right, GE.top, null, GE.bottom);
                    GH(F9, GI.top, GI.left, GI.bottom)
                } else {
                    GH(GE.right, GE.top, GI.left - GE.right, GE.bottom)
                }
            }
            if (GE.bottom < GI.top) {
                GH(F9, GE.bottom, null, GI.top)
            }
        }
        GB.appendChild(F6)
    }
    function O(F6) {
        if (!F6.state.focused) {
            return
        }
        var F8 = F6.display;
        clearInterval(F8.blinker);
        var F7 = true;
        F8.cursorDiv.style.visibility = "";
        if (F6.options.cursorBlinkRate > 0) {
            F8.blinker = setInterval(function() {
                F8.cursorDiv.style.visibility = (F7 = !F7) ? "" : "hidden"
            }, F6.options.cursorBlinkRate)
        } else {
            if (F6.options.cursorBlinkRate < 0) {
                F8.cursorDiv.style.visibility = "hidden"
            }
        }
    }
    function D9(F6, F7) {
        if (F6.doc.mode.startState && F6.doc.frontier < F6.display.viewTo) {
            F6.state.highlight.set(F7, CU(Cm, F6))
        }
    }
    function Cm(F6) {
        var GA = F6.doc;
        if (GA.frontier < GA.first) {
            GA.frontier = GA.first
        }
        if (GA.frontier >= F6.display.viewTo) {
            return
        }
        var F8 = +new Date + F6.options.workTime;
        var F9 = B1(GA.mode, DV(F6, GA.frontier));
        var F7 = [];
        GA.iter(GA.frontier, Math.min(GA.first + GA.size, F6.display.viewTo + 500), function(GB) {
            if (GA.frontier >= F6.display.viewFrom) {
                var GE = GB.styles;
                var GG = FU(F6, GB, F9, true);
                GB.styles = GG.styles;
                var GD = GB.styleClasses
                  , GF = GG.classes;
                if (GF) {
                    GB.styleClasses = GF
                } else {
                    if (GD) {
                        GB.styleClasses = null
                    }
                }
                var GH = !GE || GE.length != GB.styles.length || GD != GF && (!GD || !GF || GD.bgClass != GF.bgClass || GD.textClass != GF.textClass);
                for (var GC = 0; !GH && GC < GE.length; ++GC) {
                    GH = GE[GC] != GB.styles[GC]
                }
                if (GH) {
                    F7.push(GA.frontier)
                }
                GB.stateAfter = B1(GA.mode, F9)
            } else {
                DR(F6, GB.text, F9);
                GB.stateAfter = GA.frontier % 5 == 0 ? B1(GA.mode, F9) : null
            }
            ++GA.frontier;
            if (+new Date > F8) {
                D9(F6, F6.options.workDelay);
                return true
            }
        });
        if (F7.length) {
            Cj(F6, function() {
                for (var GB = 0; GB < F7.length; GB++) {
                    s(F6, F7[GB], "text")
                }
            })
        }
    }
    function CX(GC, F6, F9) {
        var F7, GA, GB = GC.doc;
        var F8 = F9 ? -1 : F6 - (GC.doc.mode.innerMode ? 1000 : 100);
        for (var GF = F6; GF > F8; --GF) {
            if (GF <= GB.first) {
                return GB.first
            }
            var GE = E9(GB, GF - 1);
            if (GE.stateAfter && (!F9 || GF <= GB.frontier)) {
                return GF
            }
            var GD = Br(GE.text, null, GC.options.tabSize);
            if (GA == null || F7 > GD) {
                GA = GF - 1;
                F7 = GD
            }
        }
        return GA
    }
    function DV(F6, GC, F7) {
        var GA = F6.doc
          , F9 = F6.display;
        if (!GA.mode.startState) {
            return true
        }
        var GB = CX(F6, GC, F7)
          , F8 = GB > GA.first && E9(GA, GB - 1).stateAfter;
        if (!F8) {
            F8 = By(GA.mode)
        } else {
            F8 = B1(GA.mode, F8)
        }
        GA.iter(GB, GC, function(GD) {
            DR(F6, GD.text, F8);
            var GE = GB == GC - 1 || GB % 5 == 0 || GB >= F9.viewFrom && GB < F9.viewTo;
            GD.stateAfter = GE ? B1(GA.mode, F8) : null;
            ++GB
        });
        if (F7) {
            GA.frontier = GB
        }
        return F8
    }
    function E2(F6) {
        return F6.lineSpace.offsetTop
    }
    function Bg(F6) {
        return F6.mover.offsetHeight - F6.lineSpace.offsetHeight
    }
    function Ez(F9) {
        if (F9.cachedPaddingH) {
            return F9.cachedPaddingH
        }
        var F8 = Bp(F9.measure, Fr("pre", "x"));
        var F6 = window.getComputedStyle ? window.getComputedStyle(F8) : F8.currentStyle;
        var F7 = {
            left: parseInt(F6.paddingLeft),
            right: parseInt(F6.paddingRight)
        };
        if (!isNaN(F7.left) && !isNaN(F7.right)) {
            F9.cachedPaddingH = F7
        }
        return F7
    }
    function Cq(F6) {
        return Dd - F6.display.nativeBarWidth
    }
    function DH(F6) {
        return F6.display.scroller.clientWidth - Cq(F6) - F6.display.barWidth
    }
    function Cs(F6) {
        return F6.display.scroller.clientHeight - Cq(F6) - F6.display.barHeight
    }
    function CG(GD, F9, GC) {
        var F8 = GD.options.lineWrapping;
        var GA = F8 && DH(GD);
        if (!F9.measure.heights || F8 && F9.measure.width != GA) {
            var GB = F9.measure.heights = [];
            if (F8) {
                F9.measure.width = GA;
                var GF = F9.text.firstChild.getClientRects();
                for (var F6 = 0; F6 < GF.length - 1; F6++) {
                    var GE = GF[F6]
                      , F7 = GF[F6 + 1];
                    if (Math.abs(GE.bottom - F7.bottom) > 2) {
                        GB.push((GE.bottom + F7.top) / 2 - GC.top)
                    }
                }
            }
            GB.push(GC.bottom - GC.top)
        }
    }
    function CS(F8, F6, F9) {
        if (F8.line == F6) {
            return {
                map: F8.measure.map,
                cache: F8.measure.cache
            }
        }
        for (var F7 = 0; F7 < F8.rest.length; F7++) {
            if (F8.rest[F7] == F6) {
                return {
                    map: F8.measure.maps[F7],
                    cache: F8.measure.caches[F7]
                }
            }
        }
        for (var F7 = 0; F7 < F8.rest.length; F7++) {
            if (Bl(F8.rest[F7]) > F9) {
                return {
                    map: F8.measure.maps[F7],
                    cache: F8.measure.caches[F7],
                    before: true
                }
            }
        }
    }
    function Cy(F6, F8) {
        F8 = Y(F8);
        var GA = Bl(F8);
        var F7 = F6.display.externalMeasured = new BT(F6.doc,F8,GA);
        F7.lineN = GA;
        var F9 = F7.built = El(F6, F7);
        F7.text = F9.pre;
        Bp(F6.display.lineMeasure, F9.pre);
        return F7
    }
    function EB(F6, F7, F9, F8) {
        return d(F6, A0(F6, F7), F9, F8)
    }
    function E5(F6, F8) {
        if (F8 >= F6.display.viewFrom && F8 < F6.display.viewTo) {
            return F6.display.view[DM(F6, F8)]
        }
        var F7 = F6.display.externalMeasured;
        if (F7 && F8 >= F7.lineN && F8 < F7.lineN + F7.size) {
            return F7
        }
    }
    function A0(F6, F8) {
        var F9 = Bl(F8);
        var F7 = E5(F6, F9);
        if (F7 && !F7.text) {
            F7 = null
        } else {
            if (F7 && F7.changes) {
                AA(F6, F7, F9, E7(F6))
            }
        }
        if (!F7) {
            F7 = Cy(F6, F8)
        }
        var GA = CS(F7, F8, F9);
        return {
            line: F8,
            view: F7,
            rect: null,
            map: GA.map,
            cache: GA.cache,
            before: GA.before,
            hasHeights: false
        }
    }
    function d(F6, GC, GA, F7, F9) {
        if (GC.before) {
            GA = -1
        }
        var F8 = GA + (F7 || ""), GB;
        if (GC.cache.hasOwnProperty(F8)) {
            GB = GC.cache[F8]
        } else {
            if (!GC.rect) {
                GC.rect = GC.view.text.getBoundingClientRect()
            }
            if (!GC.hasHeights) {
                CG(F6, GC.view, GC.rect);
                GC.hasHeights = true
            }
            GB = J(F6, GC, GA, F7);
            if (!GB.bogus) {
                GC.cache[F8] = GB
            }
        }
        return {
            left: GB.left,
            right: GB.right,
            top: F9 ? GB.rtop : GB.top,
            bottom: F9 ? GB.rbottom : GB.bottom
        }
    }
    var EV = {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0
    };
    function J(GD, GN, GF, GB) {
        var GR = GN.map;
        var GK, GA, F9, F6;
        for (var GM = 0; GM < GR.length; GM += 3) {
            var GP = GR[GM]
              , GL = GR[GM + 1];
            if (GF < GP) {
                GA = 0;
                F9 = 1;
                F6 = "left"
            } else {
                if (GF < GL) {
                    GA = GF - GP;
                    F9 = GA + 1
                } else {
                    if (GM == GR.length - 3 || GF == GL && GR[GM + 3] > GF) {
                        F9 = GL - GP;
                        GA = F9 - 1;
                        if (GF >= GL) {
                            F6 = "right"
                        }
                    }
                }
            }
            if (GA != null) {
                GK = GR[GM + 2];
                if (GP == GL && GB == (GK.insertLeft ? "left" : "right")) {
                    F6 = GB
                }
                if (GB == "left" && GA == 0) {
                    while (GM && GR[GM - 2] == GR[GM - 3] && GR[GM - 1].insertLeft) {
                        GK = GR[(GM -= 3) + 2];
                        F6 = "left"
                    }
                }
                if (GB == "right" && GA == GL - GP) {
                    while (GM < GR.length - 3 && GR[GM + 3] == GR[GM + 4] && !GR[GM + 5].insertLeft) {
                        GK = GR[(GM += 3) + 2];
                        F6 = "right"
                    }
                }
                break
            }
        }
        var F7;
        if (GK.nodeType == 3) {
            for (var GM = 0; GM < 4; GM++) {
                while (GA && FK(GN.line.text.charAt(GP + GA))) {
                    --GA
                }
                while (GP + F9 < GL && FK(GN.line.text.charAt(GP + F9))) {
                    ++F9
                }
                if (De && K < 9 && GA == 0 && F9 == GL - GP) {
                    F7 = GK.parentNode.getBoundingClientRect()
                } else {
                    if (De && GD.options.lineWrapping) {
                        var F8 = CK(GK, GA, F9).getClientRects();
                        if (F8.length) {
                            F7 = F8[GB == "right" ? F8.length - 1 : 0]
                        } else {
                            F7 = EV
                        }
                    } else {
                        F7 = CK(GK, GA, F9).getBoundingClientRect() || EV
                    }
                }
                if (F7.left || F7.right || GA == 0) {
                    break
                }
                F9 = GA;
                GA = GA - 1;
                F6 = "right"
            }
            if (De && K < 11) {
                F7 = Eh(GD.display.measure, F7)
            }
        } else {
            if (GA > 0) {
                F6 = GB = "right"
            }
            var F8;
            if (GD.options.lineWrapping && (F8 = GK.getClientRects()).length > 1) {
                F7 = F8[GB == "right" ? F8.length - 1 : 0]
            } else {
                F7 = GK.getBoundingClientRect()
            }
        }
        if (De && K < 9 && !GA && (!F7 || !F7.left && !F7.right)) {
            var GC = GK.parentNode.getClientRects()[0];
            if (GC) {
                F7 = {
                    left: GC.left,
                    right: GC.left + DX(GD.display),
                    top: GC.top,
                    bottom: GC.bottom
                }
            } else {
                F7 = EV
            }
        }
        var GI = F7.top - GN.rect.top
          , GG = F7.bottom - GN.rect.top;
        var GQ = (GI + GG) / 2;
        var GO = GN.view.measure.heights;
        for (var GM = 0; GM < GO.length - 1; GM++) {
            if (GQ < GO[GM]) {
                break
            }
        }
        var GJ = GM ? GO[GM - 1] : 0
          , GH = GO[GM];
        var GE = {
            left: (F6 == "right" ? F7.right : F7.left) - GN.rect.left,
            right: (F6 == "left" ? F7.left : F7.right) - GN.rect.left,
            top: GJ,
            bottom: GH
        };
        if (!F7.left && !F7.right) {
            GE.bogus = true
        }
        if (!GD.options.singleCursorHeightPerLine) {
            GE.rtop = GI;
            GE.rbottom = GG
        }
        return GE
    }
    function Eh(F8, F9) {
        if (!window.screen || screen.logicalXDPI == null || screen.logicalXDPI == screen.deviceXDPI || !Ah(F8)) {
            return F9
        }
        var F7 = screen.logicalXDPI / screen.deviceXDPI;
        var F6 = screen.logicalYDPI / screen.deviceYDPI;
        return {
            left: F9.left * F7,
            right: F9.right * F7,
            top: F9.top * F6,
            bottom: F9.bottom * F6
        }
    }
    function AS(F7) {
        if (F7.measure) {
            F7.measure.cache = {};
            F7.measure.heights = null;
            if (F7.rest) {
                for (var F6 = 0; F6 < F7.rest.length; F6++) {
                    F7.measure.caches[F6] = {}
                }
            }
        }
    }
    function Ak(F6) {
        F6.display.externalMeasure = null;
        Dv(F6.display.lineMeasure);
        for (var F7 = 0; F7 < F6.display.view.length; F7++) {
            AS(F6.display.view[F7])
        }
    }
    function AJ(F6) {
        Ak(F6);
        F6.display.cachedCharWidth = F6.display.cachedTextHeight = F6.display.cachedPaddingH = null;
        if (!F6.options.lineWrapping) {
            F6.display.maxLineChanged = true
        }
        F6.display.lineNumChars = null
    }
    function CT() {
        return window.pageXOffset || (document.documentElement || document.body).scrollLeft
    }
    function CR() {
        return window.pageYOffset || (document.documentElement || document.body).scrollTop
    }
    function Ek(GC, F9, GB, F7) {
        if (F9.widgets) {
            for (var F8 = 0; F8 < F9.widgets.length; ++F8) {
                if (F9.widgets[F8].above) {
                    var GE = Cv(F9.widgets[F8]);
                    GB.top += GE;
                    GB.bottom += GE
                }
            }
        }
        if (F7 == "line") {
            return GB
        }
        if (!F7) {
            F7 = "local"
        }
        var GA = Bk(F9);
        if (F7 == "local") {
            GA += E2(GC.display)
        } else {
            GA -= GC.display.viewOffset
        }
        if (F7 == "page" || F7 == "window") {
            var F6 = GC.display.lineSpace.getBoundingClientRect();
            GA += F6.top + (F7 == "window" ? 0 : CR());
            var GD = F6.left + (F7 == "window" ? 0 : CT());
            GB.left += GD;
            GB.right += GD
        }
        GB.top += GA;
        GB.bottom += GA;
        return GB
    }
    function F3(F7, GA, F8) {
        if (F8 == "div") {
            return GA
        }
        var GC = GA.left
          , GB = GA.top;
        if (F8 == "page") {
            GC -= CT();
            GB -= CR()
        } else {
            if (F8 == "local" || !F8) {
                var F9 = F7.display.sizer.getBoundingClientRect();
                GC += F9.left;
                GB += F9.top
            }
        }
        var F6 = F7.display.lineSpace.getBoundingClientRect();
        return {
            left: GC - F6.left,
            top: GB - F6.top
        }
    }
    function Cg(F6, GA, F9, F8, F7) {
        if (!F8) {
            F8 = E9(F6.doc, GA.line)
        }
        return Ek(F6, F8, EB(F6, F8, GA.ch, F7), F9)
    }
    function Do(GF, GE, F8, GC, GH, GD) {
        GC = GC || E9(GF.doc, GE.line);
        if (!GH) {
            GH = A0(GF, GC)
        }
        function GA(GK, GJ) {
            var GI = d(GF, GH, GK, GJ ? "right" : "left", GD);
            if (GJ) {
                GI.left = GI.right
            } else {
                GI.right = GI.left
            }
            return Ek(GF, GC, GI, F8)
        }
        function GG(GL, GI) {
            var GJ = GB[GI]
              , GK = GJ.level % 2;
            if (GL == DS(GJ) && GI && GJ.level < GB[GI - 1].level) {
                GJ = GB[--GI];
                GL = F2(GJ) - (GJ.level % 2 ? 0 : 1);
                GK = true
            } else {
                if (GL == F2(GJ) && GI < GB.length - 1 && GJ.level < GB[GI + 1].level) {
                    GJ = GB[++GI];
                    GL = DS(GJ) - GJ.level % 2;
                    GK = false
                }
            }
            if (GK && GL == GJ.to && GL > GJ.from) {
                return GA(GL - 1)
            }
            return GA(GL, GK)
        }
        var GB = A(GC)
          , F6 = GE.ch;
        if (!GB) {
            return GA(F6)
        }
        var F7 = Ad(GB, F6);
        var F9 = GG(F6, F7);
        if (Ew != null) {
            F9.other = GG(F6, Ew)
        }
        return F9
    }
    function Db(F6, GA) {
        var F9 = 0
          , GA = Fe(F6.doc, GA);
        if (!F6.options.lineWrapping) {
            F9 = DX(F6.display) * GA.ch
        }
        var F7 = E9(F6.doc, GA.line);
        var F8 = Bk(F7) + E2(F6.display);
        return {
            left: F9,
            right: F9,
            top: F8,
            bottom: F8 + F7.height
        }
    }
    function Fq(F6, F7, F8, GA) {
        var F9 = x(F6, F7);
        F9.xRel = GA;
        if (F8) {
            F9.outside = true
        }
        return F9
    }
    function Fj(GD, GA, F9) {
        var GC = GD.doc;
        F9 += GD.display.viewOffset;
        if (F9 < 0) {
            return Fq(GC.first, 0, true, -1)
        }
        var F8 = Be(GC, F9)
          , GE = GC.first + GC.size - 1;
        if (F8 > GE) {
            return Fq(GC.first + GC.size - 1, E9(GC, GE).text.length, true, 1)
        }
        if (GA < 0) {
            GA = 0
        }
        var F7 = E9(GC, F8);
        for (; ; ) {
            var GF = Cw(GD, F7, F8, GA, F9);
            var GB = EP(F7);
            var F6 = GB && GB.find(0, true);
            if (GB && (GF.ch > F6.from.ch || GF.ch == F6.from.ch && GF.xRel > 0)) {
                F8 = Bl(F7 = F6.to.line)
            } else {
                return GF
            }
        }
    }
    function Cw(GG, F8, GJ, GI, GH) {
        var GF = GH - Bk(F8);
        var GC = false
          , GP = 2 * GG.display.wrapper.clientWidth;
        var GM = A0(GG, F8);
        function GT(GV) {
            var GW = Do(GG, x(GJ, GV), "line", F8, GM);
            GC = true;
            if (GF > GW.bottom) {
                return GW.left - GP
            } else {
                if (GF < GW.top) {
                    return GW.left + GP
                } else {
                    GC = false
                }
            }
            return GW.left
        }
        var GL = A(F8)
          , GO = F8.text.length;
        var GQ = Cc(F8)
          , F9 = Cp(F8);
        var GN = GT(GQ)
          , F6 = GC
          , F7 = GT(F9)
          , GB = GC;
        if (GI > F7) {
            return Fq(GJ, F9, GB, 1)
        }
        for (; ; ) {
            if (GL ? F9 == GQ || F9 == U(F8, GQ, 1) : F9 - GQ <= 1) {
                var GK = GI < GN || GI - GN <= F7 - GI ? GQ : F9;
                var GS = GI - (GK == GQ ? GN : F7);
                while (FK(F8.text.charAt(GK))) {
                    ++GK
                }
                var GE = Fq(GJ, GK, GK == GQ ? F6 : GB, GS < -1 ? -1 : GS > 1 ? 1 : 0);
                return GE
            }
            var GD = Math.ceil(GO / 2)
              , GU = GQ + GD;
            if (GL) {
                GU = GQ;
                for (var GR = 0; GR < GD; ++GR) {
                    GU = U(F8, GU, 1)
                }
            }
            var GA = GT(GU);
            if (GA > GI) {
                F9 = GU;
                F7 = GA;
                if (GB = GC) {
                    F7 += 1000
                }
                GO = GD
            } else {
                GQ = GU;
                GN = GA;
                F6 = GC;
                GO -= GD
            }
        }
    }
    var Ae;
    function At(F8) {
        if (F8.cachedTextHeight != null) {
            return F8.cachedTextHeight
        }
        if (Ae == null) {
            Ae = Fr("pre");
            for (var F7 = 0; F7 < 49; ++F7) {
                Ae.appendChild(document.createTextNode("x"));
                Ae.appendChild(Fr("br"))
            }
            Ae.appendChild(document.createTextNode("x"))
        }
        Bp(F8.measure, Ae);
        var F6 = Ae.offsetHeight / 50;
        if (F6 > 3) {
            F8.cachedTextHeight = F6
        }
        Dv(F8.measure);
        return F6 || 1
    }
    function DX(GA) {
        if (GA.cachedCharWidth != null) {
            return GA.cachedCharWidth
        }
        var F6 = Fr("span", "xxxxxxxxxx");
        var F9 = Fr("pre", [F6]);
        Bp(GA.measure, F9);
        var F8 = F6.getBoundingClientRect()
          , F7 = (F8.right - F8.left) / 10;
        if (F7 > 2) {
            GA.cachedCharWidth = F7
        }
        return F7 || 10
    }
    var BN = null;
    var D2 = 0;
    function Cf(F6) {
        F6.curOp = {
            cm: F6,
            viewChanged: false,
            startHeight: F6.doc.height,
            forceUpdate: false,
            updateInput: null,
            typing: false,
            changeObjs: null,
            cursorActivityHandlers: null,
            cursorActivityCalled: 0,
            selectionChanged: false,
            updateMaxLine: false,
            scrollLeft: null,
            scrollTop: null,
            scrollToPos: null,
            id: ++D2
        };
        if (BN) {
            BN.ops.push(F6.curOp)
        } else {
            F6.curOp.ownsGroup = BN = {
                ops: [F6.curOp],
                delayedCallbacks: []
            }
        }
    }
    function Cr(F9) {
        var F8 = F9.delayedCallbacks
          , F7 = 0;
        do {
            for (; F7 < F8.length; F7++) {
                F8[F7]()
            }
            for (var F6 = 0; F6 < F9.ops.length; F6++) {
                var GA = F9.ops[F6];
                if (GA.cursorActivityHandlers) {
                    while (GA.cursorActivityCalled < GA.cursorActivityHandlers.length) {
                        GA.cursorActivityHandlers[GA.cursorActivityCalled++](GA.cm)
                    }
                }
            }
        } while (F7 < F8.length)
    }
    function AL(F6) {
        var F9 = F6.curOp
          , F8 = F9.ownsGroup;
        if (!F8) {
            return
        }
        try {
            Cr(F8)
        } finally {
            BN = null;
            for (var F7 = 0; F7 < F8.ops.length; F7++) {
                F8.ops[F7].cm.curOp = null
            }
            Ch(F8)
        }
    }
    function Ch(F8) {
        var F7 = F8.ops;
        for (var F6 = 0; F6 < F7.length; F6++) {
            B3(F7[F6])
        }
        for (var F6 = 0; F6 < F7.length; F6++) {
            AP(F7[F6])
        }
        for (var F6 = 0; F6 < F7.length; F6++) {
            B0(F7[F6])
        }
        for (var F6 = 0; F6 < F7.length; F6++) {
            AO(F7[F6])
        }
        for (var F6 = 0; F6 < F7.length; F6++) {
            Eu(F7[F6])
        }
    }
    function B3(F8) {
        var F6 = F8.cm
          , F7 = F6.display;
        k(F6);
        if (F8.updateMaxLine) {
            G(F6)
        }
        F8.mustUpdate = F8.viewChanged || F8.forceUpdate || F8.scrollTop != null || F8.scrollToPos && (F8.scrollToPos.from.line < F7.viewFrom || F8.scrollToPos.to.line >= F7.viewTo) || F7.maxLineChanged && F6.options.lineWrapping;
        F8.update = F8.mustUpdate && new Af(F6,F8.mustUpdate && {
            top: F8.scrollTop,
            ensure: F8.scrollToPos
        },F8.forceUpdate)
    }
    function AP(F6) {
        F6.updatedDisplay = F6.mustUpdate && c(F6.cm, F6.update)
    }
    function B0(F8) {
        var F6 = F8.cm
          , F7 = F6.display;
        if (F8.updatedDisplay) {
            A5(F6)
        }
        F8.barMeasure = DU(F6);
        if (F7.maxLineChanged && !F6.options.lineWrapping) {
            F8.adjustWidthTo = EB(F6, F7.maxLine, F7.maxLine.text.length).left + 3;
            F6.display.sizerWidth = F8.adjustWidthTo;
            F8.barMeasure.scrollWidth = Math.max(F7.scroller.clientWidth, F7.sizer.offsetLeft + F8.adjustWidthTo + Cq(F6) + F6.display.barWidth);
            F8.maxScrollLeft = Math.max(0, F7.sizer.offsetLeft + F8.adjustWidthTo - DH(F6))
        }
        if (F8.updatedDisplay || F8.selectionChanged) {
            F8.newSelectionNodes = BJ(F6)
        }
    }
    function AO(F7) {
        var F6 = F7.cm;
        if (F7.adjustWidthTo != null) {
            F6.display.sizer.style.minWidth = F7.adjustWidthTo + "px";
            if (F7.maxScrollLeft < F6.doc.scrollLeft) {
                Bc(F6, Math.min(F6.display.scroller.scrollLeft, F7.maxScrollLeft), true)
            }
            F6.display.maxLineChanged = false
        }
        if (F7.newSelectionNodes) {
            AK(F6, F7.newSelectionNodes)
        }
        if (F7.updatedDisplay) {
            DT(F6, F7.barMeasure)
        }
        if (F7.updatedDisplay || F7.startHeight != F6.doc.height) {
            Es(F6, F7.barMeasure)
        }
        if (F7.selectionChanged) {
            O(F6)
        }
        if (F6.state.focused && F7.updateInput) {
            FJ(F6, F7.typing)
        }
    }
    function Eu(GD) {
        var F6 = GD.cm
          , GB = F6.display
          , GA = F6.doc;
        if (GD.updatedDisplay) {
            CI(F6, GD.update)
        }
        if (GB.wheelStartX != null && (GD.scrollTop != null || GD.scrollLeft != null || GD.scrollToPos)) {
            GB.wheelStartX = GB.wheelStartY = null
        }
        if (GD.scrollTop != null && (GB.scroller.scrollTop != GD.scrollTop || GD.forceScroll)) {
            GA.scrollTop = Math.max(0, Math.min(GB.scroller.scrollHeight - GB.scroller.clientHeight, GD.scrollTop));
            GB.scrollbars.setScrollTop(GA.scrollTop);
            GB.scroller.scrollTop = GA.scrollTop
        }
        if (GD.scrollLeft != null && (GB.scroller.scrollLeft != GD.scrollLeft || GD.forceScroll)) {
            GA.scrollLeft = Math.max(0, Math.min(GB.scroller.scrollWidth - DH(F6), GD.scrollLeft));
            GB.scrollbars.setScrollLeft(GA.scrollLeft);
            GB.scroller.scrollLeft = GA.scrollLeft;
            EY(F6)
        }
        if (GD.scrollToPos) {
            var F9 = e(F6, Fe(GA, GD.scrollToPos.from), Fe(GA, GD.scrollToPos.to), GD.scrollToPos.margin);
            if (GD.scrollToPos.isCursor && F6.state.focused) {
                D0(F6, F9)
            }
        }
        var F8 = GD.maybeHiddenMarkers
          , GC = GD.maybeUnhiddenMarkers;
        if (F8) {
            for (var F7 = 0; F7 < F8.length; ++F7) {
                if (!F8[F7].lines.length) {
                    Ab(F8[F7], "hide")
                }
            }
        }
        if (GC) {
            for (var F7 = 0; F7 < GC.length; ++F7) {
                if (GC[F7].lines.length) {
                    Ab(GC[F7], "unhide")
                }
            }
        }
        if (GB.wrapper.offsetHeight) {
            GA.scrollTop = F6.display.scroller.scrollTop
        }
        if (GD.changeObjs) {
            Ab(F6, "changes", F6, GD.changeObjs)
        }
    }
    function Cj(F6, F7) {
        if (F6.curOp) {
            return F7()
        }
        Cf(F6);
        try {
            return F7()
        } finally {
            AL(F6)
        }
    }
    function Cz(F6, F7) {
        return function() {
            if (F6.curOp) {
                return F7.apply(F6, arguments)
            }
            Cf(F6);
            try {
                return F7.apply(F6, arguments)
            } finally {
                AL(F6)
            }
        }
    }
    function C5(F6) {
        return function() {
            if (this.curOp) {
                return F6.apply(this, arguments)
            }
            Cf(this);
            try {
                return F6.apply(this, arguments)
            } finally {
                AL(this)
            }
        }
    }
    function Cb(F6) {
        return function() {
            var F7 = this.cm;
            if (!F7 || F7.curOp) {
                return F6.apply(this, arguments)
            }
            Cf(F7);
            try {
                return F6.apply(this, arguments)
            } finally {
                AL(F7)
            }
        }
    }
    function BT(F8, F6, F7) {
        this.line = F6;
        this.rest = H(F6);
        this.size = this.rest ? Bl(Fc(this.rest)) - F7 + 1 : 1;
        this.node = this.text = null;
        this.hidden = FR(F8, F6)
    }
    function Ep(F6, GC, GB) {
        var GA = [], F8;
        for (var F9 = GC; F9 < GB; F9 = F8) {
            var F7 = new BT(F6.doc,E9(F6.doc, F9),F9);
            F8 = F9 + F7.size;
            GA.push(F7)
        }
        return GA
    }
    function AG(GD, GB, GC, GE) {
        if (GB == null) {
            GB = GD.doc.first
        }
        if (GC == null) {
            GC = GD.doc.first + GD.doc.size
        }
        if (!GE) {
            GE = 0
        }
        var F8 = GD.display;
        if (GE && GC < F8.viewTo && (F8.updateLineNumbers == null || F8.updateLineNumbers > GB)) {
            F8.updateLineNumbers = GB
        }
        GD.curOp.viewChanged = true;
        if (GB >= F8.viewTo) {
            if (A3 && As(GD.doc, GB) < F8.viewTo) {
                EQ(GD)
            }
        } else {
            if (GC <= F8.viewFrom) {
                if (A3 && Dx(GD.doc, GC + GE) > F8.viewFrom) {
                    EQ(GD)
                } else {
                    F8.viewFrom += GE;
                    F8.viewTo += GE
                }
            } else {
                if (GB <= F8.viewFrom && GC >= F8.viewTo) {
                    EQ(GD)
                } else {
                    if (GB <= F8.viewFrom) {
                        var GA = DB(GD, GC, GC + GE, 1);
                        if (GA) {
                            F8.view = F8.view.slice(GA.index);
                            F8.viewFrom = GA.lineN;
                            F8.viewTo += GE
                        } else {
                            EQ(GD)
                        }
                    } else {
                        if (GC >= F8.viewTo) {
                            var GA = DB(GD, GB, GB, -1);
                            if (GA) {
                                F8.view = F8.view.slice(0, GA.index);
                                F8.viewTo = GA.lineN
                            } else {
                                EQ(GD)
                            }
                        } else {
                            var F9 = DB(GD, GB, GB, -1);
                            var F7 = DB(GD, GC, GC + GE, 1);
                            if (F9 && F7) {
                                F8.view = F8.view.slice(0, F9.index).concat(Ep(GD, F9.lineN, F7.lineN)).concat(F8.view.slice(F7.index));
                                F8.viewTo += GE
                            } else {
                                EQ(GD)
                            }
                        }
                    }
                }
            }
        }
        var F6 = F8.externalMeasured;
        if (F6) {
            if (GC < F6.lineN) {
                F6.lineN += GE
            } else {
                if (GB < F6.lineN + F6.size) {
                    F8.externalMeasured = null
                }
            }
        }
    }
    function s(F7, F8, GB) {
        F7.curOp.viewChanged = true;
        var GC = F7.display
          , GA = F7.display.externalMeasured;
        if (GA && F8 >= GA.lineN && F8 < GA.lineN + GA.size) {
            GC.externalMeasured = null
        }
        if (F8 < GC.viewFrom || F8 >= GC.viewTo) {
            return
        }
        var F9 = GC.view[DM(F7, F8)];
        if (F9.node == null) {
            return
        }
        var F6 = F9.changes || (F9.changes = []);
        if (DE(F6, GB) == -1) {
            F6.push(GB)
        }
    }
    function EQ(F6) {
        F6.display.viewFrom = F6.display.viewTo = F6.doc.first;
        F6.display.view = [];
        F6.display.viewOffset = 0
    }
    function DM(F6, F9) {
        if (F9 >= F6.display.viewTo) {
            return null
        }
        F9 -= F6.display.viewFrom;
        if (F9 < 0) {
            return null
        }
        var F7 = F6.display.view;
        for (var F8 = 0; F8 < F7.length; F8++) {
            F9 -= F7[F8].size;
            if (F9 < 0) {
                return F8
            }
        }
    }
    function DB(GE, F8, GA, F7) {
        var GB = DM(GE, F8), GD, GC = GE.display.view;
        if (!A3 || GA == GE.doc.first + GE.doc.size) {
            return {
                index: GB,
                lineN: GA
            }
        }
        for (var F9 = 0, F6 = GE.display.viewFrom; F9 < GB; F9++) {
            F6 += GC[F9].size
        }
        if (F6 != F8) {
            if (F7 > 0) {
                if (GB == GC.length - 1) {
                    return null
                }
                GD = (F6 + GC[GB].size) - F8;
                GB++
            } else {
                GD = F6 - F8
            }
            F8 += GD;
            GA += GD
        }
        while (As(GE.doc, GA) != GA) {
            if (GB == (F7 < 0 ? 0 : GC.length - 1)) {
                return null
            }
            GA += F7 * GC[GB - (F7 < 0 ? 1 : 0)].size;
            GB += F7
        }
        return {
            index: GB,
            lineN: GA
        }
    }
    function Co(F6, GA, F9) {
        var F8 = F6.display
          , F7 = F8.view;
        if (F7.length == 0 || GA >= F8.viewTo || F9 <= F8.viewFrom) {
            F8.view = Ep(F6, GA, F9);
            F8.viewFrom = GA
        } else {
            if (F8.viewFrom > GA) {
                F8.view = Ep(F6, GA, F8.viewFrom).concat(F8.view)
            } else {
                if (F8.viewFrom < GA) {
                    F8.view = F8.view.slice(DM(F6, GA))
                }
            }
            F8.viewFrom = GA;
            if (F8.viewTo < F9) {
                F8.view = F8.view.concat(Ep(F6, F8.viewTo, F9))
            } else {
                if (F8.viewTo > F9) {
                    F8.view = F8.view.slice(0, DM(F6, F9))
                }
            }
        }
        F8.viewTo = F9
    }
    function C8(F6) {
        var F7 = F6.display.view
          , GA = 0;
        for (var F9 = 0; F9 < F7.length; F9++) {
            var F8 = F7[F9];
            if (!F8.hidden && (!F8.node || F8.changes)) {
                ++GA
            }
        }
        return GA
    }
    function BK(F6) {
        if (F6.display.pollingFast) {
            return
        }
        F6.display.poll.set(F6.options.pollInterval, function() {
            CF(F6);
            if (F6.state.focused) {
                BK(F6)
            }
        })
    }
    function b(F6) {
        var F7 = false;
        F6.display.pollingFast = true;
        function F8() {
            var F9 = CF(F6);
            if (!F9 && !F7) {
                F7 = true;
                F6.display.poll.set(60, F8)
            } else {
                F6.display.pollingFast = false;
                BK(F6)
            }
        }
        F6.display.poll.set(20, F8)
    }
    var BI = null;
    function CF(GA) {
        var GB = GA.display.input
          , GE = GA.display.prevInput
          , GP = GA.doc;
        if (!GA.state.focused || (BQ(GB) && !GE) || AI(GA) || GA.options.disableInput || GA.state.keySeq) {
            return false
        }
        if (GA.state.pasteIncoming && GA.state.fakedLastChar) {
            GB.value = GB.value.substring(0, GB.value.length - 1);
            GA.state.fakedLastChar = false
        }
        var GD = GB.value;
        if (GD == GE && !GA.somethingSelected()) {
            return false
        }
        if (De && K >= 9 && GA.display.inputHasSelection === GD || B5 && /[\uf700-\uf7ff]/.test(GD)) {
            FJ(GA);
            return false
        }
        var GL = !GA.curOp;
        if (GL) {
            Cf(GA)
        }
        GA.display.shift = false;
        if (GD.charCodeAt(0) == 8203 && GP.sel == GA.display.selForContextMenu && !GE) {
            GE = "\u200b"
        }
        var GK = 0
          , GH = Math.min(GE.length, GD.length);
        while (GK < GH && GE.charCodeAt(GK) == GD.charCodeAt(GK)) {
            ++GK
        }
        var F7 = GD.slice(GK)
          , GF = Aw(F7);
        var GO = null;
        if (GA.state.pasteIncoming && GP.sel.ranges.length > 1) {
            if (BI && BI.join("\n") == F7) {
                GO = GP.sel.ranges.length % BI.length == 0 && Bq(BI, Aw)
            } else {
                if (GF.length == GP.sel.ranges.length) {
                    GO = Bq(GF, function(GQ) {
                        return [GQ]
                    })
                }
            }
        }
        for (var GM = GP.sel.ranges.length - 1; GM >= 0; GM--) {
            var GG = GP.sel.ranges[GM];
            var GI = GG.from()
              , F6 = GG.to();
            if (GK < GE.length) {
                GI = x(GI.line, GI.ch - (GE.length - GK))
            } else {
                if (GA.state.overwrite && GG.empty() && !GA.state.pasteIncoming) {
                    F6 = x(F6.line, Math.min(E9(GP, F6.line).text.length, F6.ch + Fc(GF).length))
                }
            }
            var F9 = GA.curOp.updateInput;
            var GN = {
                from: GI,
                to: F6,
                text: GO ? GO[GM % GO.length] : GF,
                origin: GA.state.pasteIncoming ? "paste" : GA.state.cutIncoming ? "cut" : "+input"
            };
            BC(GA.doc, GN);
            AD(GA, "inputRead", GA, GN);
            if (F7 && !GA.state.pasteIncoming && GA.options.electricChars && GA.options.smartIndent && GG.head.ch < 100 && (!GM || GP.sel.ranges[GM - 1].head.line != GG.head.line)) {
                var GC = GA.getModeAt(GG.head);
                var F8 = Cu(GN);
                if (GC.electricChars) {
                    for (var GJ = 0; GJ < GC.electricChars.length; GJ++) {
                        if (F7.indexOf(GC.electricChars.charAt(GJ)) > -1) {
                            AC(GA, F8.line, "smart");
                            break
                        }
                    }
                } else {
                    if (GC.electricInput) {
                        if (GC.electricInput.test(E9(GP, F8.line).text.slice(0, F8.ch))) {
                            AC(GA, F8.line, "smart")
                        }
                    }
                }
            }
        }
        Fb(GA);
        GA.curOp.updateInput = F9;
        GA.curOp.typing = true;
        if (GD.length > 1000 || GD.indexOf("\n") > -1) {
            GB.value = GA.display.prevInput = ""
        } else {
            GA.display.prevInput = GD
        }
        if (GL) {
            AL(GA)
        }
        GA.state.pasteIncoming = GA.state.cutIncoming = false;
        return true
    }
    function FJ(F6, GA) {
        if (F6.display.contextMenuPending) {
            return
        }
        var F7, F9, GC = F6.doc;
        if (F6.somethingSelected()) {
            F6.display.prevInput = "";
            var F8 = GC.sel.primary();
            F7 = C7 && (F8.to().line - F8.from().line > 100 || (F9 = F6.getSelection()).length > 1000);
            var GB = F7 ? "-" : F9 || F6.getSelection();
            F6.display.input.value = GB;
            if (F6.state.focused) {
                Df(F6.display.input)
            }
            if (De && K >= 9) {
                F6.display.inputHasSelection = GB
            }
        } else {
            if (!GA) {
                F6.display.prevInput = F6.display.input.value = "";
                if (De && K >= 9) {
                    F6.display.inputHasSelection = null
                }
            }
        }
        F6.display.inaccurateSelection = F7
    }
    function ET(F6) {
        if (F6.options.readOnly != "nocursor" && (!EA || Di() != F6.display.input)) {
            F6.display.input.focus()
        }
    }
    function R(F6) {
        if (!F6.state.focused) {
            ET(F6);
            CZ(F6)
        }
    }
    function AI(F6) {
        return F6.options.readOnly || F6.doc.cantEdit
    }
    function Fk(F6) {
        var F8 = F6.display;
        Bv(F8.scroller, "mousedown", Cz(F6, EN));
        if (De && K < 11) {
            Bv(F8.scroller, "dblclick", Cz(F6, function(GB) {
                if (An(F6, GB)) {
                    return
                }
                var GC = CM(F6, GB);
                if (!GC || L(F6, GB) || A6(F6.display, GB)) {
                    return
                }
                Cd(GB);
                var GA = F6.findWordAt(GC);
                Fo(F6.doc, GA.anchor, GA.head)
            }))
        } else {
            Bv(F8.scroller, "dblclick", function(GA) {
                An(F6, GA) || Cd(GA)
            })
        }
        Bv(F8.lineSpace, "selectstart", function(GA) {
            if (!A6(F8, GA)) {
                Cd(GA)
            }
        });
        if (!Fy) {
            Bv(F8.scroller, "contextmenu", function(GA) {
                AW(F6, GA)
            })
        }
        Bv(F8.scroller, "scroll", function() {
            if (F8.scroller.clientHeight) {
                o(F6, F8.scroller.scrollTop);
                Bc(F6, F8.scroller.scrollLeft, true);
                Ab(F6, "scroll", F6)
            }
        });
        Bv(F8.scroller, "mousewheel", function(GA) {
            B(F6, GA)
        });
        Bv(F8.scroller, "DOMMouseScroll", function(GA) {
            B(F6, GA)
        });
        Bv(F8.wrapper, "scroll", function() {
            F8.wrapper.scrollTop = F8.wrapper.scrollLeft = 0
        });
        Bv(F8.input, "keyup", function(GA) {
            BE.call(F6, GA)
        });
        Bv(F8.input, "input", function() {
            if (De && K >= 9 && F6.display.inputHasSelection) {
                F6.display.inputHasSelection = null
            }
            CF(F6)
        });
        Bv(F8.input, "keydown", Cz(F6, P));
        Bv(F8.input, "keypress", Cz(F6, CW));
        Bv(F8.input, "focus", CU(CZ, F6));
        Bv(F8.input, "blur", CU(Ar, F6));
        function F7(GA) {
            if (!An(F6, GA)) {
                EL(GA)
            }
        }
        if (F6.options.dragDrop) {
            Bv(F8.scroller, "dragstart", function(GA) {
                r(F6, GA)
            });
            Bv(F8.scroller, "dragenter", F7);
            Bv(F8.scroller, "dragover", F7);
            Bv(F8.scroller, "drop", Cz(F6, BG))
        }
        Bv(F8.scroller, "paste", function(GA) {
            if (A6(F8, GA)) {
                return
            }
            F6.state.pasteIncoming = true;
            ET(F6);
            b(F6)
        });
        Bv(F8.input, "paste", function() {
            if (Cx && !F6.state.fakedLastChar && !(new Date - F6.state.lastMiddleDown < 200)) {
                var GB = F8.input.selectionStart
                  , GA = F8.input.selectionEnd;
                F8.input.value += "$";
                F8.input.selectionEnd = GA;
                F8.input.selectionStart = GB;
                F6.state.fakedLastChar = true
            }
            F6.state.pasteIncoming = true;
            b(F6)
        });
        function F9(GE) {
            if (F6.somethingSelected()) {
                BI = F6.getSelections();
                if (F8.inaccurateSelection) {
                    F8.prevInput = "";
                    F8.inaccurateSelection = false;
                    F8.input.value = BI.join("\n");
                    Df(F8.input)
                }
            } else {
                var GF = []
                  , GB = [];
                for (var GC = 0; GC < F6.doc.sel.ranges.length; GC++) {
                    var GA = F6.doc.sel.ranges[GC].head.line;
                    var GD = {
                        anchor: x(GA, 0),
                        head: x(GA + 1, 0)
                    };
                    GB.push(GD);
                    GF.push(F6.getRange(GD.anchor, GD.head))
                }
                if (GE.type == "cut") {
                    F6.setSelections(GB, null, z)
                } else {
                    F8.prevInput = "";
                    F8.input.value = GF.join("\n");
                    Df(F8.input)
                }
                BI = GF
            }
            if (GE.type == "cut") {
                F6.state.cutIncoming = true
            }
        }
        Bv(F8.input, "cut", F9);
        Bv(F8.input, "copy", F9);
        if (A7) {
            Bv(F8.sizer, "mouseup", function() {
                if (Di() == F8.input) {
                    F8.input.blur()
                }
                ET(F6)
            })
        }
    }
    function Ap(F6) {
        var F7 = F6.display;
        if (F7.lastWrapHeight == F7.wrapper.clientHeight && F7.lastWrapWidth == F7.wrapper.clientWidth) {
            return
        }
        F7.cachedCharWidth = F7.cachedTextHeight = F7.cachedPaddingH = null;
        F7.scrollbarsClipped = false;
        F6.setSize()
    }
    function A6(F7, F6) {
        for (var F8 = m(F6); F8 != F7.wrapper; F8 = F8.parentNode) {
            if (!F8 || (F8.nodeType == 1 && F8.getAttribute("cm-ignore-events") == "true") || (F8.parentNode == F7.sizer && F8 != F7.mover)) {
                return true
            }
        }
    }
    function CM(GF, GA, F7, F8) {
        var GB = GF.display;
        if (!F7 && m(GA).getAttribute("not-content") == "true") {
            return null
        }
        var GE, GC, F6 = GB.lineSpace.getBoundingClientRect();
        try {
            GE = GA.clientX - F6.left;
            GC = GA.clientY - F6.top
        } catch (GA) {
            return null
        }
        var GD = Fj(GF, GE, GC), GG;
        if (F8 && GD.xRel == 1 && (GG = E9(GF.doc, GD.line).text).length == GD.ch) {
            var F9 = Br(GG, GG.length, GF.options.tabSize) - GG.length;
            GD = x(GD.line, Math.max(0, Math.round((GE - Ez(GF.display).left) / DX(GF.display)) - F9))
        }
        return GD
    }
    function EN(F8) {
        if (An(this, F8)) {
            return
        }
        var F6 = this
          , F7 = F6.display;
        F7.shift = F8.shiftKey;
        if (A6(F7, F8)) {
            if (!Cx) {
                F7.scroller.draggable = false;
                setTimeout(function() {
                    F7.scroller.draggable = true
                }, 100)
            }
            return
        }
        if (L(F6, F8)) {
            return
        }
        var F9 = CM(F6, F8);
        window.focus();
        switch (Fi(F8)) {
        case 1:
            if (F9) {
                AV(F6, F8, F9)
            } else {
                if (m(F8) == F7.scroller) {
                    Cd(F8)
                }
            }
            break;
        case 2:
            if (Cx) {
                F6.state.lastMiddleDown = +new Date
            }
            if (F9) {
                Fo(F6.doc, F9)
            }
            setTimeout(CU(ET, F6), 20);
            Cd(F8);
            break;
        case 3:
            if (Fy) {
                AW(F6, F8)
            }
            break
        }
    }
    var DJ, DA;
    function AV(F7, GC, GD) {
        setTimeout(CU(R, F7), 0);
        var F8 = +new Date, GA;
        if (DA && DA.time > F8 - 400 && CD(DA.pos, GD) == 0) {
            GA = "triple"
        } else {
            if (DJ && DJ.time > F8 - 400 && CD(DJ.pos, GD) == 0) {
                GA = "double";
                DA = {
                    time: F8,
                    pos: GD
                }
            } else {
                GA = "single";
                DJ = {
                    time: F8,
                    pos: GD
                }
            }
        }
        var GB = F7.doc.sel, F6 = B5 ? GC.metaKey : GC.ctrlKey, F9;
        if (F7.options.dragDrop && Ef && !AI(F7) && GA == "single" && (F9 = GB.contains(GD)) > -1 && !GB.ranges[F9].empty()) {
            Az(F7, GC, GD, F6)
        } else {
            M(F7, GC, GD, GA, F6)
        }
    }
    function Az(F8, GA, GB, F7) {
        var F9 = F8.display;
        var F6 = Cz(F8, function(GC) {
            if (Cx) {
                F9.scroller.draggable = false
            }
            F8.state.draggingText = false;
            D7(document, "mouseup", F6);
            D7(F9.scroller, "drop", F6);
            if (Math.abs(GA.clientX - GC.clientX) + Math.abs(GA.clientY - GC.clientY) < 10) {
                Cd(GC);
                if (!F7) {
                    Fo(F8.doc, GB)
                }
                ET(F8);
                if (De && K == 9) {
                    setTimeout(function() {
                        document.body.focus();
                        ET(F8)
                    }, 20)
                }
            }
        });
        if (Cx) {
            F9.scroller.draggable = true
        }
        F8.state.draggingText = F6;
        if (F9.scroller.dragDrop) {
            F9.scroller.dragDrop()
        }
        Bv(document, "mouseup", F6);
        Bv(F9.scroller, "drop", F6)
    }
    function M(GA, GO, F9, F7, GC) {
        var GL = GA.display
          , GQ = GA.doc;
        Cd(GO);
        var F8, GP, GB = GQ.sel, F6 = GB.ranges;
        if (GC && !GO.shiftKey) {
            GP = GQ.sel.contains(F9);
            if (GP > -1) {
                F8 = F6[GP]
            } else {
                F8 = new Ds(F9,F9)
            }
        } else {
            F8 = GQ.sel.primary()
        }
        if (GO.altKey) {
            F7 = "rect";
            if (!GC) {
                F8 = new Ds(F9,F9)
            }
            F9 = CM(GA, GO, true, true);
            GP = -1
        } else {
            if (F7 == "double") {
                var GM = GA.findWordAt(F9);
                if (GA.display.shift || GQ.extend) {
                    F8 = FQ(GQ, F8, GM.anchor, GM.head)
                } else {
                    F8 = GM
                }
            } else {
                if (F7 == "triple") {
                    var GF = new Ds(x(F9.line, 0),Fe(GQ, x(F9.line + 1, 0)));
                    if (GA.display.shift || GQ.extend) {
                        F8 = FQ(GQ, F8, GF.anchor, GF.head)
                    } else {
                        F8 = GF
                    }
                } else {
                    F8 = FQ(GQ, F8, F9)
                }
            }
        }
        if (!GC) {
            GP = 0;
            Bs(GQ, new Fs([F8],0), n);
            GB = GQ.sel
        } else {
            if (GP == -1) {
                GP = F6.length;
                Bs(GQ, CV(F6.concat([F8]), GP), {
                    scroll: false,
                    origin: "*mouse"
                })
            } else {
                if (F6.length > 1 && F6[GP].empty() && F7 == "single") {
                    Bs(GQ, CV(F6.slice(0, GP).concat(F6.slice(GP + 1)), 0));
                    GB = GQ.sel
                } else {
                    E(GQ, GP, F8, n)
                }
            }
        }
        var GK = F9;
        function GJ(Gb) {
            if (CD(GK, Gb) == 0) {
                return
            }
            GK = Gb;
            if (F7 == "rect") {
                var GS = []
                  , GY = GA.options.tabSize;
                var GR = Br(E9(GQ, F9.line).text, F9.ch, GY);
                var Ge = Br(E9(GQ, Gb.line).text, Gb.ch, GY);
                var GT = Math.min(GR, Ge)
                  , Gc = Math.max(GR, Ge);
                for (var Gf = Math.min(F9.line, Gb.line), GV = Math.min(GA.lastLine(), Math.max(F9.line, Gb.line)); Gf <= GV; Gf++) {
                    var Gd = E9(GQ, Gf).text
                      , GU = EK(Gd, GT, GY);
                    if (GT == Gc) {
                        GS.push(new Ds(x(Gf, GU),x(Gf, GU)))
                    } else {
                        if (Gd.length > GU) {
                            GS.push(new Ds(x(Gf, GU),x(Gf, EK(Gd, Gc, GY))))
                        }
                    }
                }
                if (!GS.length) {
                    GS.push(new Ds(F9,F9))
                }
                Bs(GQ, CV(GB.ranges.slice(0, GP).concat(GS), GP), {
                    origin: "*mouse",
                    scroll: false
                });
                GA.scrollIntoView(Gb)
            } else {
                var GZ = F8;
                var GW = GZ.anchor
                  , Ga = Gb;
                if (F7 != "single") {
                    if (F7 == "double") {
                        var GX = GA.findWordAt(Gb)
                    } else {
                        var GX = new Ds(x(Gb.line, 0),Fe(GQ, x(Gb.line + 1, 0)))
                    }
                    if (CD(GX.anchor, GW) > 0) {
                        Ga = GX.head;
                        GW = AQ(GZ.from(), GX.anchor)
                    } else {
                        Ga = GX.anchor;
                        GW = BV(GZ.to(), GX.head)
                    }
                }
                var GS = GB.ranges.slice(0);
                GS[GP] = new Ds(Fe(GQ, GW),Ga);
                Bs(GQ, CV(GS, GP), n)
            }
        }
        var GH = GL.wrapper.getBoundingClientRect();
        var GD = 0;
        function GN(GT) {
            var GR = ++GD;
            var GV = CM(GA, GT, true, F7 == "rect");
            if (!GV) {
                return
            }
            if (CD(GV, GK) != 0) {
                R(GA);
                GJ(GV);
                var GU = B4(GL, GQ);
                if (GV.line >= GU.to || GV.line < GU.from) {
                    setTimeout(Cz(GA, function() {
                        if (GD == GR) {
                            GN(GT)
                        }
                    }), 150)
                }
            } else {
                var GS = GT.clientY < GH.top ? -20 : GT.clientY > GH.bottom ? 20 : 0;
                if (GS) {
                    setTimeout(Cz(GA, function() {
                        if (GD != GR) {
                            return
                        }
                        GL.scroller.scrollTop += GS;
                        GN(GT)
                    }), 50)
                }
            }
        }
        function GG(GR) {
            GD = Infinity;
            Cd(GR);
            ET(GA);
            D7(document, "mousemove", GI);
            D7(document, "mouseup", GE);
            GQ.history.lastSelOrigin = null
        }
        var GI = Cz(GA, function(GR) {
            if (!Fi(GR)) {
                GG(GR)
            } else {
                GN(GR)
            }
        });
        var GE = Cz(GA, GG);
        Bv(document, "mousemove", GI);
        Bv(document, "mouseup", GE)
    }
    function F4(GH, GD, GF, GG, F9) {
        try {
            var F7 = GD.clientX
              , F6 = GD.clientY
        } catch (GD) {
            return false
        }
        if (F7 >= Math.floor(GH.display.gutters.getBoundingClientRect().right)) {
            return false
        }
        if (GG) {
            Cd(GD)
        }
        var GE = GH.display;
        var GC = GE.lineDiv.getBoundingClientRect();
        if (F6 > GC.bottom || !FC(GH, GF)) {
            return Bj(GD)
        }
        F6 -= GC.top - GE.viewOffset;
        for (var GA = 0; GA < GH.options.gutters.length; ++GA) {
            var GB = GE.gutters.childNodes[GA];
            if (GB && GB.getBoundingClientRect().right >= F7) {
                var GI = Be(GH.doc, F6);
                var F8 = GH.options.gutters[GA];
                F9(GH, GF, GH, GI, F8, GD);
                return Bj(GD)
            }
        }
    }
    function L(F6, F7) {
        return F4(F6, F7, "gutterClick", true, AD)
    }
    var AF = 0;
    function BG(GC) {
        var GE = this;
        if (An(GE, GC) || A6(GE.display, GC)) {
            return
        }
        Cd(GC);
        if (De) {
            AF = +new Date
        }
        var GD = CM(GE, GC, true)
          , F6 = GC.dataTransfer.files;
        if (!GD || AI(GE)) {
            return
        }
        if (F6 && F6.length && window.FileReader && window.File) {
            var F8 = F6.length
              , GF = Array(F8)
              , F7 = 0;
            var GA = function(GI, GH) {
                var GG = new FileReader;
                GG.onload = Cz(GE, function() {
                    GF[GH] = GG.result;
                    if (++F7 == F8) {
                        GD = Fe(GE.doc, GD);
                        var GJ = {
                            from: GD,
                            to: GD,
                            text: Aw(GF.join("\n")),
                            origin: "paste"
                        };
                        BC(GE.doc, GJ);
                        E1(GE.doc, Em(GD, Cu(GJ)))
                    }
                });
                GG.readAsText(GI)
            };
            for (var GB = 0; GB < F8; ++GB) {
                GA(F6[GB], GB)
            }
        } else {
            if (GE.state.draggingText && GE.doc.sel.contains(GD) > -1) {
                GE.state.draggingText(GC);
                setTimeout(CU(ET, GE), 20);
                return
            }
            try {
                var GF = GC.dataTransfer.getData("Text");
                if (GF) {
                    if (GE.state.draggingText && !(B5 ? GC.metaKey : GC.ctrlKey)) {
                        var F9 = GE.listSelections()
                    }
                    EJ(GE.doc, Em(GD, GD));
                    if (F9) {
                        for (var GB = 0; GB < F9.length; ++GB) {
                            Ax(GE.doc, "", F9[GB].anchor, F9[GB].head, "drag")
                        }
                    }
                    GE.replaceSelection(GF, "around", "paste");
                    ET(GE)
                }
            } catch (GC) {}
        }
    }
    function r(F6, F8) {
        if (De && (!F6.state.draggingText || +new Date - AF < 100)) {
            EL(F8);
            return
        }
        if (An(F6, F8) || A6(F6.display, F8)) {
            return
        }
        F8.dataTransfer.setData("Text", F6.getSelection());
        if (F8.dataTransfer.setDragImage && !AZ) {
            var F7 = Fr("img", null, null, "position: fixed; left: 0; top: 0;");
            F7.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
            if (Dw) {
                F7.width = F7.height = 1;
                F6.display.wrapper.appendChild(F7);
                F7._top = F7.offsetTop
            }
            F8.dataTransfer.setDragImage(F7, 0, 0);
            if (Dw) {
                F7.parentNode.removeChild(F7)
            }
        }
    }
    function o(F6, F7) {
        if (Math.abs(F6.doc.scrollTop - F7) < 2) {
            return
        }
        F6.doc.scrollTop = F7;
        if (!CN) {
            Dn(F6, {
                top: F7
            })
        }
        if (F6.display.scroller.scrollTop != F7) {
            F6.display.scroller.scrollTop = F7
        }
        F6.display.scrollbars.setScrollTop(F7);
        if (CN) {
            Dn(F6)
        }
        D9(F6, 100)
    }
    function Bc(F6, F8, F7) {
        if (F7 ? F8 == F6.doc.scrollLeft : Math.abs(F6.doc.scrollLeft - F8) < 2) {
            return
        }
        F8 = Math.min(F8, F6.display.scroller.scrollWidth - F6.display.scroller.clientWidth);
        F6.doc.scrollLeft = F8;
        EY(F6);
        if (F6.display.scroller.scrollLeft != F8) {
            F6.display.scroller.scrollLeft = F8
        }
        F6.display.scrollbars.setScrollLeft(F8)
    }
    var FG = 0
      , CE = null;
    if (De) {
        CE = -0.53
    } else {
        if (CN) {
            CE = 15
        } else {
            if (C9) {
                CE = -0.7
            } else {
                if (AZ) {
                    CE = -1 / 3
                }
            }
        }
    }
    var Cn = function(F8) {
        var F7 = F8.wheelDeltaX
          , F6 = F8.wheelDeltaY;
        if (F7 == null && F8.detail && F8.axis == F8.HORIZONTAL_AXIS) {
            F7 = F8.detail
        }
        if (F6 == null && F8.detail && F8.axis == F8.VERTICAL_AXIS) {
            F6 = F8.detail
        } else {
            if (F6 == null) {
                F6 = F8.wheelDelta
            }
        }
        return {
            x: F7,
            y: F6
        }
    };
    i.wheelEventPixels = function(F6) {
        var F7 = Cn(F6);
        F7.x *= CE;
        F7.y *= CE;
        return F7
    }
    ;
    function B(GE, F8) {
        var GF = Cn(F8)
          , GI = GF.x
          , GH = GF.y;
        var GA = GE.display
          , GD = GA.scroller;
        if (!(GI && GD.scrollWidth > GD.clientWidth || GH && GD.scrollHeight > GD.clientHeight)) {
            return
        }
        if (GH && B5 && Cx) {
            outer: for (var GG = F8.target, GC = GA.view; GG != GD; GG = GG.parentNode) {
                for (var F7 = 0; F7 < GC.length; F7++) {
                    if (GC[F7].node == GG) {
                        GE.display.currentWheelTarget = GG;
                        break outer
                    }
                }
            }
        }
        if (GI && !CN && !Dw && CE != null) {
            if (GH) {
                o(GE, Math.max(0, Math.min(GD.scrollTop + GH * CE, GD.scrollHeight - GD.clientHeight)))
            }
            Bc(GE, Math.max(0, Math.min(GD.scrollLeft + GI * CE, GD.scrollWidth - GD.clientWidth)));
            Cd(F8);
            GA.wheelStartX = null;
            return
        }
        if (GH && CE != null) {
            var F6 = GH * CE;
            var GB = GE.doc.scrollTop
              , F9 = GB + GA.wrapper.clientHeight;
            if (F6 < 0) {
                GB = Math.max(0, GB + F6 - 50)
            } else {
                F9 = Math.min(GE.doc.height, F9 + F6 + 50)
            }
            Dn(GE, {
                top: GB,
                bottom: F9
            })
        }
        if (FG < 20) {
            if (GA.wheelStartX == null) {
                GA.wheelStartX = GD.scrollLeft;
                GA.wheelStartY = GD.scrollTop;
                GA.wheelDX = GI;
                GA.wheelDY = GH;
                setTimeout(function() {
                    if (GA.wheelStartX == null) {
                        return
                    }
                    var GJ = GD.scrollLeft - GA.wheelStartX;
                    var GL = GD.scrollTop - GA.wheelStartY;
                    var GK = (GL && GA.wheelDY && GL / GA.wheelDY) || (GJ && GA.wheelDX && GJ / GA.wheelDX);
                    GA.wheelStartX = GA.wheelStartY = null;
                    if (!GK) {
                        return
                    }
                    CE = (CE * FG + GK) / (FG + 1);
                    ++FG
                }, 200)
            } else {
                GA.wheelDX += GI;
                GA.wheelDY += GH
            }
        }
    }
    function Fl(F7, GA, F6) {
        if (typeof GA == "string") {
            GA = EX[GA];
            if (!GA) {
                return false
            }
        }
        if (F7.display.pollingFast && CF(F7)) {
            F7.display.pollingFast = false
        }
        var F9 = F7.display.shift
          , F8 = false;
        try {
            if (AI(F7)) {
                F7.state.suppressEdits = true
            }
            if (F6) {
                F7.display.shift = false
            }
            F8 = GA(F7) != B8
        } finally {
            F7.display.shift = F9;
            F7.state.suppressEdits = false
        }
        return F8
    }
    function D4(F7, F8, GA) {
        for (var F9 = 0; F9 < F7.state.keyMaps.length; F9++) {
            var F6 = I(F8, F7.state.keyMaps[F9], GA, F7);
            if (F6) {
                return F6
            }
        }
        return (F7.options.extraKeys && I(F8, F7.options.extraKeys, GA, F7)) || I(F8, F7.options.keyMap, GA, F7)
    }
    var Dg = new F5;
    function A9(F7, F9, GB, GA) {
        var F8 = F7.state.keySeq;
        if (F8) {
            if (EW(F9)) {
                return "handled"
            }
            Dg.set(50, function() {
                if (F7.state.keySeq == F8) {
                    F7.state.keySeq = null;
                    FJ(F7)
                }
            });
            F9 = F8 + " " + F9
        }
        var F6 = D4(F7, F9, GA);
        if (F6 == "multi") {
            F7.state.keySeq = F9
        }
        if (F6 == "handled") {
            AD(F7, "keyHandled", F7, F9, GB)
        }
        if (F6 == "handled" || F6 == "multi") {
            Cd(GB);
            O(F7)
        }
        if (F8 && !F6 && /\'$/.test(F9)) {
            Cd(GB);
            return true
        }
        return !!F6
    }
    function FD(F6, F8) {
        var F7 = FM(F8, true);
        if (!F7) {
            return false
        }
        if (F8.shiftKey && !F6.state.keySeq) {
            return A9(F6, "Shift-" + F7, F8, function(F9) {
                return Fl(F6, F9, true)
            }) || A9(F6, F7, F8, function(F9) {
                if (typeof F9 == "string" ? /^go[A-Z]/.test(F9) : F9.motion) {
                    return Fl(F6, F9)
                }
            })
        } else {
            return A9(F6, F7, F8, function(F9) {
                return Fl(F6, F9)
            })
        }
    }
    function ED(F6, F8, F7) {
        return A9(F6, "'" + F7 + "'", F8, function(F9) {
            return Fl(F6, F9, true)
        })
    }
    var DI = null;
    function P(F9) {
        var F6 = this;
        R(F6);
        if (An(F6, F9)) {
            return
        }
        if (De && K < 11 && F9.keyCode == 27) {
            F9.returnValue = false
        }
        var F7 = F9.keyCode;
        F6.display.shift = F7 == 16 || F9.shiftKey;
        var F8 = FD(F6, F9);
        if (Dw) {
            DI = F8 ? F7 : null;
            if (!F8 && F7 == 88 && !C7 && (B5 ? F9.metaKey : F9.ctrlKey)) {
                F6.replaceSelection("", null, "cut")
            }
        }
        if (F7 == 18 && !/\bCodeMirror-crosshair\b/.test(F6.display.lineDiv.className)) {
            AT(F6)
        }
    }
    function AT(F7) {
        var F8 = F7.display.lineDiv;
        FV(F8, "CodeMirror-crosshair");
        function F6(F9) {
            if (F9.keyCode == 18 || !F9.altKey) {
                F(F8, "CodeMirror-crosshair");
                D7(document, "keyup", F6);
                D7(document, "mouseover", F6)
            }
        }
        Bv(document, "keyup", F6);
        Bv(document, "mouseover", F6)
    }
    function BE(F6) {
        if (F6.keyCode == 16) {
            this.doc.sel.shift = false
        }
        An(this, F6)
    }
    function CW(GA) {
        var F6 = this;
        if (An(F6, GA) || GA.ctrlKey && !GA.altKey || B5 && GA.metaKey) {
            return
        }
        var F9 = GA.keyCode
          , F7 = GA.charCode;
        if (Dw && F9 == DI) {
            DI = null;
            Cd(GA);
            return
        }
        if (((Dw && (!GA.which || GA.which < 10)) || A7) && FD(F6, GA)) {
            return
        }
        var F8 = String.fromCharCode(F7 == null ? F9 : F7);
        if (ED(F6, GA, F8)) {
            return
        }
        if (De && K >= 9) {
            F6.display.inputHasSelection = null
        }
        b(F6)
    }
    function CZ(F6) {
        if (F6.options.readOnly == "nocursor") {
            return
        }
        if (!F6.state.focused) {
            Ab(F6, "focus", F6);
            F6.state.focused = true;
            FV(F6.display.wrapper, "CodeMirror-focused");
            if (!F6.curOp && F6.display.selForContextMenu != F6.doc.sel) {
                FJ(F6);
                if (Cx) {
                    setTimeout(CU(FJ, F6, true), 0)
                }
            }
        }
        BK(F6);
        O(F6)
    }
    function Ar(F6) {
        if (F6.state.focused) {
            Ab(F6, "blur", F6);
            F6.state.focused = false;
            F(F6.display.wrapper, "CodeMirror-focused")
        }
        clearInterval(F6.display.blinker);
        setTimeout(function() {
            if (!F6.state.focused) {
                F6.display.shift = false
            }
        }, 150)
    }
    function AW(GF, GA) {
        if (An(GF, GA, "contextmenu")) {
            return
        }
        var GC = GF.display;
        if (A6(GC, GA) || DD(GF, GA)) {
            return
        }
        var GE = CM(GF, GA)
          , F6 = GC.scroller.scrollTop;
        if (!GE || Dw) {
            return
        }
        var F9 = GF.options.resetSelectionOnContextMenu;
        if (F9 && GF.doc.sel.contains(GE) == -1) {
            Cz(GF, Bs)(GF.doc, Em(GE), z)
        }
        var GB = GC.input.style.cssText;
        GC.inputDiv.style.position = "absolute";
        GC.input.style.cssText = "position: fixed; width: 30px; height: 30px; top: " + (GA.clientY - 5) + "px; left: " + (GA.clientX - 5) + "px; z-index: 1000; background: " + (De ? "rgba(255, 255, 255, .05)" : "transparent") + "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
        if (Cx) {
            var GG = window.scrollY
        }
        ET(GF);
        if (Cx) {
            window.scrollTo(null, GG)
        }
        FJ(GF);
        if (!GF.somethingSelected()) {
            GC.input.value = GC.prevInput = " "
        }
        GC.contextMenuPending = true;
        GC.selForContextMenu = GF.doc.sel;
        clearTimeout(GC.detectingSelectAll);
        function F8() {
            if (GC.input.selectionStart != null) {
                var GH = GF.somethingSelected();
                var GI = GC.input.value = "\u200b" + (GH ? GC.input.value : "");
                GC.prevInput = GH ? "" : "\u200b";
                GC.input.selectionStart = 1;
                GC.input.selectionEnd = GI.length;
                GC.selForContextMenu = GF.doc.sel
            }
        }
        function GD() {
            GC.contextMenuPending = false;
            GC.inputDiv.style.position = "relative";
            GC.input.style.cssText = GB;
            if (De && K < 9) {
                GC.scrollbars.setScrollTop(GC.scroller.scrollTop = F6)
            }
            BK(GF);
            if (GC.input.selectionStart != null) {
                if (!De || (De && K < 9)) {
                    F8()
                }
                var GH = 0
                  , GI = function() {
                    if (GC.selForContextMenu == GF.doc.sel && GC.input.selectionStart == 0) {
                        Cz(GF, EX.selectAll)(GF)
                    } else {
                        if (GH++ < 10) {
                            GC.detectingSelectAll = setTimeout(GI, 500)
                        } else {
                            FJ(GF)
                        }
                    }
                };
                GC.detectingSelectAll = setTimeout(GI, 200)
            }
        }
        if (De && K >= 9) {
            F8()
        }
        if (Fy) {
            EL(GA);
            var F7 = function() {
                D7(window, "mouseup", F7);
                setTimeout(GD, 20)
            };
            Bv(window, "mouseup", F7)
        } else {
            setTimeout(GD, 50)
        }
    }
    function DD(F6, F7) {
        if (!FC(F6, "gutterContextMenu")) {
            return false
        }
        return F4(F6, F7, "gutterContextMenu", false, Ab)
    }
    var Cu = i.changeEnd = function(F6) {
        if (!F6.text) {
            return F6.to
        }
        return x(F6.from.line + F6.text.length - 1, Fc(F6.text).length + (F6.text.length == 1 ? F6.from.ch : 0))
    }
    ;
    function Bx(F9, F8) {
        if (CD(F9, F8.from) < 0) {
            return F9
        }
        if (CD(F9, F8.to) <= 0) {
            return Cu(F8)
        }
        var F6 = F9.line + F8.text.length - (F8.to.line - F8.from.line) - 1
          , F7 = F9.ch;
        if (F9.line == F8.to.line) {
            F7 += Cu(F8).ch - F8.to.ch
        }
        return x(F6, F7)
    }
    function FE(F9, GA) {
        var F7 = [];
        for (var F8 = 0; F8 < F9.sel.ranges.length; F8++) {
            var F6 = F9.sel.ranges[F8];
            F7.push(new Ds(Bx(F6.anchor, GA),Bx(F6.head, GA)))
        }
        return CV(F7, F9.sel.primIndex)
    }
    function BS(F8, F7, F6) {
        if (F8.line == F7.line) {
            return x(F6.line, F8.ch - F7.ch + F6.ch)
        } else {
            return x(F6.line + (F8.line - F7.line), F8.ch)
        }
    }
    function AE(GG, GD, F7) {
        var F8 = [];
        var F6 = x(GG.first, 0)
          , GH = F6;
        for (var GA = 0; GA < GD.length; GA++) {
            var GC = GD[GA];
            var GF = BS(GC.from, F6, GH);
            var GE = BS(Cu(GC), F6, GH);
            F6 = GC.to;
            GH = GE;
            if (F7 == "around") {
                var GB = GG.sel.ranges[GA]
                  , F9 = CD(GB.head, GB.anchor) < 0;
                F8[GA] = new Ds(F9 ? GE : GF,F9 ? GF : GE)
            } else {
                F8[GA] = new Ds(GF,GF)
            }
        }
        return new Fs(F8,GG.sel.primIndex)
    }
    function Dl(F7, F9, F8) {
        var F6 = {
            canceled: false,
            from: F9.from,
            to: F9.to,
            text: F9.text,
            origin: F9.origin,
            cancel: function() {
                this.canceled = true
            }
        };
        if (F8) {
            F6.update = function(GD, GC, GB, GA) {
                if (GD) {
                    this.from = Fe(F7, GD)
                }
                if (GC) {
                    this.to = Fe(F7, GC)
                }
                if (GB) {
                    this.text = GB
                }
                if (GA !== undefined) {
                    this.origin = GA
                }
            }
        }
        Ab(F7, "beforeChange", F7, F6);
        if (F7.cm) {
            Ab(F7.cm, "beforeChange", F7.cm, F6)
        }
        if (F6.canceled) {
            return null
        }
        return {
            from: F6.from,
            to: F6.to,
            text: F6.text,
            origin: F6.origin
        }
    }
    function BC(F9, GA, F8) {
        if (F9.cm) {
            if (!F9.cm.curOp) {
                return Cz(F9.cm, BC)(F9, GA, F8)
            }
            if (F9.cm.state.suppressEdits) {
                return
            }
        }
        if (FC(F9, "beforeChange") || F9.cm && FC(F9.cm, "beforeChange")) {
            GA = Dl(F9, GA, true);
            if (!GA) {
                return
            }
        }
        var F7 = F1 && !F8 && Ce(F9, GA.from, GA.to);
        if (F7) {
            for (var F6 = F7.length - 1; F6 >= 0; --F6) {
                l(F9, {
                    from: F7[F6].from,
                    to: F7[F6].to,
                    text: F6 ? [""] : GA.text
                })
            }
        } else {
            l(F9, GA)
        }
    }
    function l(F8, F9) {
        if (F9.text.length == 1 && F9.text[0] == "" && CD(F9.from, F9.to) == 0) {
            return
        }
        var F7 = FE(F8, F9);
        Fh(F8, F9, F7, F8.cm ? F8.cm.curOp.id : NaN);
        D8(F8, F9, F7, EE(F8, F9));
        var F6 = [];
        D1(F8, function(GB, GA) {
            if (!GA && DE(F6, GB.history) == -1) {
                DY(GB.history, F9);
                F6.push(GB.history)
            }
            D8(GB, F9, null, EE(GB, F9))
        })
    }
    function B6(GH, GF, GJ) {
        if (GH.cm && GH.cm.state.suppressEdits) {
            return
        }
        var GE = GH.history, F8, GA = GH.sel;
        var F6 = GF == "undo" ? GE.done : GE.undone
          , GI = GF == "undo" ? GE.undone : GE.done;
        for (var GB = 0; GB < F6.length; GB++) {
            F8 = F6[GB];
            if (GJ ? F8.ranges && !F8.equals(GH.sel) : !F8.ranges) {
                break
            }
        }
        if (GB == F6.length) {
            return
        }
        GE.lastOrigin = GE.lastSelOrigin = null;
        for (; ; ) {
            F8 = F6.pop();
            if (F8.ranges) {
                Ck(F8, GI);
                if (GJ && !F8.equals(GH.sel)) {
                    Bs(GH, F8, {
                        clearRedo: false
                    });
                    return
                }
                GA = F8
            } else {
                break
            }
        }
        var GD = [];
        Ck(GA, GI);
        GI.push({
            changes: GD,
            generation: GE.generation
        });
        GE.generation = F8.generation || ++GE.maxGeneration;
        var F9 = FC(GH, "beforeChange") || GH.cm && FC(GH.cm, "beforeChange");
        for (var GB = F8.changes.length - 1; GB >= 0; --GB) {
            var GG = F8.changes[GB];
            GG.origin = GF;
            if (F9 && !Dl(GH, GG, false)) {
                F6.length = 0;
                return
            }
            GD.push(DP(GH, GG));
            var F7 = GB ? FE(GH, GG) : Fc(F6);
            D8(GH, GG, F7, D3(GH, GG));
            if (!GB && GH.cm) {
                GH.cm.scrollIntoView({
                    from: GG.from,
                    to: Cu(GG)
                })
            }
            var GC = [];
            D1(GH, function(GL, GK) {
                if (!GK && DE(GC, GL.history) == -1) {
                    DY(GL.history, GG);
                    GC.push(GL.history)
                }
                D8(GL, GG, null, D3(GL, GG))
            })
        }
    }
    function FH(F7, F9) {
        if (F9 == 0) {
            return
        }
        F7.first += F9;
        F7.sel = new Fs(Bq(F7.sel.ranges, function(GA) {
            return new Ds(x(GA.anchor.line + F9, GA.anchor.ch),x(GA.head.line + F9, GA.head.ch))
        }),F7.sel.primIndex);
        if (F7.cm) {
            AG(F7.cm, F7.first, F7.first - F9, F9);
            for (var F8 = F7.cm.display, F6 = F8.viewFrom; F6 < F8.viewTo; F6++) {
                s(F7.cm, F6, "gutter")
            }
        }
    }
    function D8(GA, GB, F9, F7) {
        if (GA.cm && !GA.cm.curOp) {
            return Cz(GA.cm, D8)(GA, GB, F9, F7)
        }
        if (GB.to.line < GA.first) {
            FH(GA, GB.text.length - 1 - (GB.to.line - GB.from.line));
            return
        }
        if (GB.from.line > GA.lastLine()) {
            return
        }
        if (GB.from.line < GA.first) {
            var F6 = GB.text.length - 1 - (GA.first - GB.from.line);
            FH(GA, F6);
            GB = {
                from: x(GA.first, 0),
                to: x(GB.to.line + F6, GB.to.ch),
                text: [Fc(GB.text)],
                origin: GB.origin
            }
        }
        var F8 = GA.lastLine();
        if (GB.to.line > F8) {
            GB = {
                from: GB.from,
                to: x(F8, E9(GA, F8).text.length),
                text: [GB.text[0]],
                origin: GB.origin
            }
        }
        GB.removed = Ft(GA, GB.from, GB.to);
        if (!F9) {
            F9 = FE(GA, GB)
        }
        if (GA.cm) {
            Ag(GA.cm, GB, F7)
        } else {
            FT(GA, GB, F7)
        }
        EJ(GA, F9, z)
    }
    function Ag(GH, GD, GB) {
        var GG = GH.doc
          , GC = GH.display
          , GE = GD.from
          , GF = GD.to;
        var F6 = false
          , GA = GE.line;
        if (!GH.options.lineWrapping) {
            GA = Bl(Y(E9(GG, GE.line)));
            GG.iter(GA, GF.line + 1, function(GJ) {
                if (GJ == GC.maxLine) {
                    F6 = true;
                    return true
                }
            })
        }
        if (GG.sel.contains(GD.from, GD.to) > -1) {
            w(GH)
        }
        FT(GG, GD, GB, BA(GH));
        if (!GH.options.lineWrapping) {
            GG.iter(GA, GE.line + GD.text.length, function(GK) {
                var GJ = EH(GK);
                if (GJ > GC.maxLineLength) {
                    GC.maxLine = GK;
                    GC.maxLineLength = GJ;
                    GC.maxLineChanged = true;
                    F6 = false
                }
            });
            if (F6) {
                GH.curOp.updateMaxLine = true
            }
        }
        GG.frontier = Math.min(GG.frontier, GE.line);
        D9(GH, 400);
        var GI = GD.text.length - (GF.line - GE.line) - 1;
        if (GD.full) {
            AG(GH)
        } else {
            if (GE.line == GF.line && GD.text.length == 1 && !Dm(GH.doc, GD)) {
                s(GH, GE.line, "text")
            } else {
                AG(GH, GE.line, GF.line + 1, GI)
            }
        }
        var F8 = FC(GH, "changes")
          , F9 = FC(GH, "change");
        if (F9 || F8) {
            var F7 = {
                from: GE,
                to: GF,
                text: GD.text,
                removed: GD.removed,
                origin: GD.origin
            };
            if (F9) {
                AD(GH, "change", GH, F7)
            }
            if (F8) {
                (GH.curOp.changeObjs || (GH.curOp.changeObjs = [])).push(F7)
            }
        }
        GH.display.selForContextMenu = null
    }
    function Ax(F9, F8, GB, GA, F6) {
        if (!GA) {
            GA = GB
        }
        if (CD(GA, GB) < 0) {
            var F7 = GA;
            GA = GB;
            GB = F7
        }
        if (typeof F8 == "string") {
            F8 = Aw(F8)
        }
        BC(F9, {
            from: GB,
            to: GA,
            text: F8,
            origin: F6
        })
    }
    function D0(F7, GA) {
        if (An(F7, "scrollCursorIntoView")) {
            return
        }
        var GB = F7.display
          , F8 = GB.sizer.getBoundingClientRect()
          , F6 = null;
        if (GA.top + F8.top < 0) {
            F6 = true
        } else {
            if (GA.bottom + F8.top > (window.innerHeight || document.documentElement.clientHeight)) {
                F6 = false
            }
        }
        if (F6 != null && !FP) {
            var F9 = Fr("div", "\u200b", null, "position: absolute; top: " + (GA.top - GB.viewOffset - E2(F7.display)) + "px; height: " + (GA.bottom - GA.top + Cq(F7) + GB.barHeight) + "px; left: " + GA.left + "px; width: 2px;");
            F7.display.lineSpace.appendChild(F9);
            F9.scrollIntoView(F6);
            F7.display.lineSpace.removeChild(F9)
        }
    }
    function e(GG, GE, GA, F9) {
        if (F9 == null) {
            F9 = 0
        }
        for (var GB = 0; GB < 5; GB++) {
            var GC = false
              , GF = Do(GG, GE);
            var F6 = !GA || GA == GE ? GF : Do(GG, GA);
            var F8 = h(GG, Math.min(GF.left, F6.left), Math.min(GF.top, F6.top) - F9, Math.max(GF.left, F6.left), Math.max(GF.bottom, F6.bottom) + F9);
            var GD = GG.doc.scrollTop
              , F7 = GG.doc.scrollLeft;
            if (F8.scrollTop != null) {
                o(GG, F8.scrollTop);
                if (Math.abs(GG.doc.scrollTop - GD) > 1) {
                    GC = true
                }
            }
            if (F8.scrollLeft != null) {
                Bc(GG, F8.scrollLeft);
                if (Math.abs(GG.doc.scrollLeft - F7) > 1) {
                    GC = true
                }
            }
            if (!GC) {
                break
            }
        }
        return GF
    }
    function f(F6, F8, GA, F7, F9) {
        var GB = h(F6, F8, GA, F7, F9);
        if (GB.scrollTop != null) {
            o(F6, GB.scrollTop)
        }
        if (GB.scrollLeft != null) {
            Bc(F6, GB.scrollLeft)
        }
    }
    function h(GI, F9, GH, F7, GG) {
        var GE = GI.display
          , GC = At(GI.display);
        if (GH < 0) {
            GH = 0
        }
        var GA = GI.curOp && GI.curOp.scrollTop != null ? GI.curOp.scrollTop : GE.scroller.scrollTop;
        var GK = Cs(GI)
          , GM = {};
        if (GG - GH > GK) {
            GG = GH + GK
        }
        var F8 = GI.doc.height + Bg(GE);
        var F6 = GH < GC
          , GD = GG > F8 - GC;
        if (GH < GA) {
            GM.scrollTop = F6 ? 0 : GH
        } else {
            if (GG > GA + GK) {
                var GF = Math.min(GH, (GD ? F8 : GG) - GK);
                if (GF != GA) {
                    GM.scrollTop = GF
                }
            }
        }
        var GL = GI.curOp && GI.curOp.scrollLeft != null ? GI.curOp.scrollLeft : GE.scroller.scrollLeft;
        var GJ = DH(GI) - (GI.options.fixedGutter ? GE.gutters.offsetWidth : 0);
        var GB = F7 - F9 > GJ;
        if (GB) {
            F7 = F9 + GJ
        }
        if (F9 < 10) {
            GM.scrollLeft = 0
        } else {
            if (F9 < GL) {
                GM.scrollLeft = Math.max(0, F9 - (GB ? 0 : 10))
            } else {
                if (F7 > GJ + GL - 3) {
                    GM.scrollLeft = F7 + (GB ? 0 : 10) - GJ
                }
            }
        }
        return GM
    }
    function Ci(F6, F8, F7) {
        if (F8 != null || F7 != null) {
            FX(F6)
        }
        if (F8 != null) {
            F6.curOp.scrollLeft = (F6.curOp.scrollLeft == null ? F6.doc.scrollLeft : F6.curOp.scrollLeft) + F8
        }
        if (F7 != null) {
            F6.curOp.scrollTop = (F6.curOp.scrollTop == null ? F6.doc.scrollTop : F6.curOp.scrollTop) + F7
        }
    }
    function Fb(F6) {
        FX(F6);
        var F7 = F6.getCursor()
          , F9 = F7
          , F8 = F7;
        if (!F6.options.lineWrapping) {
            F9 = F7.ch ? x(F7.line, F7.ch - 1) : F7;
            F8 = x(F7.line, F7.ch + 1)
        }
        F6.curOp.scrollToPos = {
            from: F9,
            to: F8,
            margin: F6.options.cursorScrollMargin,
            isCursor: true
        }
    }
    function FX(F6) {
        var F8 = F6.curOp.scrollToPos;
        if (F8) {
            F6.curOp.scrollToPos = null;
            var GA = Db(F6, F8.from)
              , F9 = Db(F6, F8.to);
            var F7 = h(F6, Math.min(GA.left, F9.left), Math.min(GA.top, F9.top) - F8.margin, Math.max(GA.right, F9.right), Math.max(GA.bottom, F9.bottom) + F8.margin);
            F6.scrollTo(F7.scrollLeft, F7.scrollTop)
        }
    }
    function AC(GJ, F9, GI, F8) {
        var GH = GJ.doc, F7;
        if (GI == null) {
            GI = "add"
        }
        if (GI == "smart") {
            if (!GH.mode.indent) {
                GI = "prev"
            } else {
                F7 = DV(GJ, F9)
            }
        }
        var GD = GJ.options.tabSize;
        var GK = E9(GH, F9)
          , GC = Br(GK.text, null, GD);
        if (GK.stateAfter) {
            GK.stateAfter = null
        }
        var F6 = GK.text.match(/^\s*/)[0], GF;
        if (!F8 && !/\S/.test(GK.text)) {
            GF = 0;
            GI = "not"
        } else {
            if (GI == "smart") {
                GF = GH.mode.indent(F7, GK.text.slice(F6.length), GK.text);
                if (GF == B8 || GF > 150) {
                    if (!F8) {
                        return
                    }
                    GI = "prev"
                }
            }
        }
        if (GI == "prev") {
            if (F9 > GH.first) {
                GF = Br(E9(GH, F9 - 1).text, null, GD)
            } else {
                GF = 0
            }
        } else {
            if (GI == "add") {
                GF = GC + GJ.options.indentUnit
            } else {
                if (GI == "subtract") {
                    GF = GC - GJ.options.indentUnit
                } else {
                    if (typeof GI == "number") {
                        GF = GC + GI
                    }
                }
            }
        }
        GF = Math.max(0, GF);
        var GG = ""
          , GE = 0;
        if (GJ.options.indentWithTabs) {
            for (var GA = Math.floor(GF / GD); GA; --GA) {
                GE += GD;
                GG += "\t"
            }
        }
        if (GE < GF) {
            GG += CO(GF - GE)
        }
        if (GG != F6) {
            Ax(GH, GG, x(F9, 0), x(F9, F6.length), "+input")
        } else {
            for (var GA = 0; GA < GH.sel.ranges.length; GA++) {
                var GB = GH.sel.ranges[GA];
                if (GB.head.line == F9 && GB.head.ch < F6.length) {
                    var GE = x(F9, F6.length);
                    E(GH, GA, new Ds(GE,GE));
                    break
                }
            }
        }
        GK.stateAfter = null
    }
    function ES(F9, F8, F6, GB) {
        var GA = F8
          , F7 = F8;
        if (typeof F8 == "number") {
            F7 = E9(F9, C2(F9, F8))
        } else {
            GA = Bl(F8)
        }
        if (GA == null) {
            return null
        }
        if (GB(F7, GA) && F9.cm) {
            s(F9.cm, GA, F6)
        }
        return F7
    }
    function Er(F6, GC) {
        var F7 = F6.doc.sel.ranges
          , GA = [];
        for (var F9 = 0; F9 < F7.length; F9++) {
            var F8 = GC(F7[F9]);
            while (GA.length && CD(F8.from, Fc(GA).to) <= 0) {
                var GB = GA.pop();
                if (CD(GB.from, F8.from) < 0) {
                    F8.from = GB.from;
                    break
                }
            }
            GA.push(F8)
        }
        Cj(F6, function() {
            for (var GD = GA.length - 1; GD >= 0; GD--) {
                Ax(F6.doc, "", GA[GD].from, GA[GD].to, "+delete")
            }
            Fb(F6)
        })
    }
    function BU(GO, GA, GI, GH, GC) {
        var GF = GA.line
          , GG = GA.ch
          , GN = GI;
        var F7 = E9(GO, GF);
        var GL = true;
        function GM() {
            var GP = GF + GI;
            if (GP < GO.first || GP >= GO.first + GO.size) {
                return ( GL = false)
            }
            GF = GP;
            return F7 = E9(GO, GP)
        }
        function GK(GQ) {
            var GP = (GC ? U : AH)(F7, GG, GI, true);
            if (GP == null) {
                if (!GQ && GM()) {
                    if (GC) {
                        GG = (GI < 0 ? Cp : Cc)(F7)
                    } else {
                        GG = GI < 0 ? F7.text.length : 0
                    }
                } else {
                    return ( GL = false)
                }
            } else {
                GG = GP
            }
            return true
        }
        if (GH == "char") {
            GK()
        } else {
            if (GH == "column") {
                GK(true)
            } else {
                if (GH == "word" || GH == "group") {
                    var GJ = null
                      , GD = GH == "group";
                    var F6 = GO.cm && GO.cm.getHelper(GA, "wordChars");
                    for (var GB = true; ; GB = false) {
                        if (GI < 0 && !GK(!GB)) {
                            break
                        }
                        var F8 = F7.text.charAt(GG) || "\n";
                        var F9 = CY(F8, F6) ? "w" : GD && F8 == "\n" ? "n" : !GD || /\s/.test(F8) ? null : "p";
                        if (GD && !GB && !F9) {
                            F9 = "s"
                        }
                        if (GJ && GJ != F9) {
                            if (GI < 0) {
                                GI = 1;
                                GK()
                            }
                            break
                        }
                        if (F9) {
                            GJ = F9
                        }
                        if (GI > 0 && !GK(!GB)) {
                            break
                        }
                    }
                }
            }
        }
        var GE = Bt(GO, x(GF, GG), GN, true);
        if (!GL) {
            GE.hitSide = true
        }
        return GE
    }
    function BO(GE, F9, F6, GD) {
        var GC = GE.doc, GB = F9.left, GA;
        if (GD == "page") {
            var F8 = Math.min(GE.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
            GA = F9.top + F6 * (F8 - (F6 < 0 ? 1.5 : 0.5) * At(GE.display))
        } else {
            if (GD == "line") {
                GA = F6 > 0 ? F9.bottom + 3 : F9.top - 3
            }
        }
        for (; ; ) {
            var F7 = Fj(GE, GB, GA);
            if (!F7.outside) {
                break
            }
            if (F6 < 0 ? GA <= 0 : GA >= GC.height) {
                F7.hitSide = true;
                break
            }
            GA += F6 * 5
        }
        return F7
    }
    i.prototype = {
        constructor: i,
        focus: function() {
            window.focus();
            ET(this);
            b(this)
        },
        setOption: function(F8, F9) {
            var F7 = this.options
              , F6 = F7[F8];
            if (F7[F8] == F9 && F8 != "mode") {
                return
            }
            F7[F8] = F9;
            if (BB.hasOwnProperty(F8)) {
                Cz(this, BB[F8])(this, F9, F6)
            }
        },
        getOption: function(F6) {
            return this.options[F6]
        },
        getDoc: function() {
            return this.doc
        },
        addKeyMap: function(F7, F6) {
            this.state.keyMaps[F6 ? "push" : "unshift"](Fp(F7))
        },
        removeKeyMap: function(F7) {
            var F8 = this.state.keyMaps;
            for (var F6 = 0; F6 < F8.length; ++F6) {
                if (F8[F6] == F7 || F8[F6].name == F7) {
                    F8.splice(F6, 1);
                    return true
                }
            }
        },
        addOverlay: C5(function(F6, F7) {
            var F8 = F6.token ? F6 : i.getMode(this.options, F6);
            if (F8.startState) {
                throw new Error("Overlays may not be stateful.")
            }
            this.state.overlays.push({
                mode: F8,
                modeSpec: F6,
                opaque: F7 && F7.opaque
            });
            this.state.modeGen++;
            AG(this)
        }),
        removeOverlay: C5(function(F6) {
            var F8 = this.state.overlays;
            for (var F7 = 0; F7 < F8.length; ++F7) {
                var F9 = F8[F7].modeSpec;
                if (F9 == F6 || typeof F6 == "string" && F9.name == F6) {
                    F8.splice(F7, 1);
                    this.state.modeGen++;
                    AG(this);
                    return
                }
            }
        }),
        indentLine: C5(function(F8, F6, F7) {
            if (typeof F6 != "string" && typeof F6 != "number") {
                if (F6 == null) {
                    F6 = this.options.smartIndent ? "smart" : "prev"
                } else {
                    F6 = F6 ? "add" : "subtract"
                }
            }
            if (B7(this.doc, F8)) {
                AC(this, F8, F6, F7)
            }
        }),
        indentSelection: C5(function(GF) {
            var F6 = this.doc.sel.ranges
              , F9 = -1;
            for (var GB = 0; GB < F6.length; GB++) {
                var GC = F6[GB];
                if (!GC.empty()) {
                    var GD = GC.from()
                      , GE = GC.to();
                    var F7 = Math.max(F9, GD.line);
                    F9 = Math.min(this.lastLine(), GE.line - (GE.ch ? 0 : 1)) + 1;
                    for (var GA = F7; GA < F9; ++GA) {
                        AC(this, GA, GF)
                    }
                    var F8 = this.doc.sel.ranges;
                    if (GD.ch == 0 && F6.length == F8.length && F8[GB].from().ch > 0) {
                        E(this.doc, GB, new Ds(GD,F8[GB].to()), z)
                    }
                } else {
                    if (GC.head.line > F9) {
                        AC(this, GC.head.line, GF, true);
                        F9 = GC.head.line;
                        if (GB == this.doc.sel.primIndex) {
                            Fb(this)
                        }
                    }
                }
            }
        }),
        getTokenAt: function(F7, F6) {
            return CP(this, F7, F6)
        },
        getLineTokens: function(F7, F6) {
            return CP(this, x(F7), F6, true)
        },
        getTokenTypeAt: function(GD) {
            GD = Fe(this.doc, GD);
            var F9 = C3(this, E9(this.doc, GD.line));
            var GB = 0
              , GC = (F9.length - 1) / 2
              , F8 = GD.ch;
            var F7;
            if (F8 == 0) {
                F7 = F9[2]
            } else {
                for (; ; ) {
                    var F6 = (GB + GC) >> 1;
                    if ((F6 ? F9[F6 * 2 - 1] : 0) >= F8) {
                        GC = F6
                    } else {
                        if (F9[F6 * 2 + 1] < F8) {
                            GB = F6 + 1
                        } else {
                            F7 = F9[F6 * 2 + 2];
                            break
                        }
                    }
                }
            }
            var GA = F7 ? F7.indexOf("cm-overlay ") : -1;
            return GA < 0 ? F7 : GA == 0 ? null : F7.slice(0, GA - 1)
        },
        getModeAt: function(F7) {
            var F6 = this.doc.mode;
            if (!F6.innerMode) {
                return F6
            }
            return i.innerMode(F6, this.getTokenAt(F7).state).mode
        },
        getHelper: function(F7, F6) {
            return this.getHelpers(F7, F6)[0]
        },
        getHelpers: function(GD, F8) {
            var F9 = [];
            if (!FI.hasOwnProperty(F8)) {
                return FI
            }
            var F6 = FI[F8]
              , GC = this.getModeAt(GD);
            if (typeof GC[F8] == "string") {
                if (F6[GC[F8]]) {
                    F9.push(F6[GC[F8]])
                }
            } else {
                if (GC[F8]) {
                    for (var F7 = 0; F7 < GC[F8].length; F7++) {
                        var GB = F6[GC[F8][F7]];
                        if (GB) {
                            F9.push(GB)
                        }
                    }
                } else {
                    if (GC.helperType && F6[GC.helperType]) {
                        F9.push(F6[GC.helperType])
                    } else {
                        if (F6[GC.name]) {
                            F9.push(F6[GC.name])
                        }
                    }
                }
            }
            for (var F7 = 0; F7 < F6._global.length; F7++) {
                var GA = F6._global[F7];
                if (GA.pred(GC, this) && DE(F9, GA.val) == -1) {
                    F9.push(GA.val)
                }
            }
            return F9
        },
        getStateAfter: function(F7, F6) {
            var F8 = this.doc;
            F7 = C2(F8, F7 == null ? F8.first + F8.size - 1 : F7);
            return DV(this, F7 + 1, F6)
        },
        cursorCoords: function(F9, F7) {
            var F8, F6 = this.doc.sel.primary();
            if (F9 == null) {
                F8 = F6.head
            } else {
                if (typeof F9 == "object") {
                    F8 = Fe(this.doc, F9)
                } else {
                    F8 = F9 ? F6.from() : F6.to()
                }
            }
            return Do(this, F8, F7 || "page")
        },
        charCoords: function(F7, F6) {
            return Cg(this, Fe(this.doc, F7), F6 || "page")
        },
        coordsChar: function(F6, F7) {
            F6 = F3(this, F6, F7 || "page");
            return Fj(this, F6.left, F6.top)
        },
        lineAtHeight: function(F6, F7) {
            F6 = F3(this, {
                top: F6,
                left: 0
            }, F7 || "page").top;
            return Be(this.doc, F6 + this.display.viewOffset)
        },
        heightAtLine: function(F7, GA) {
            var F6 = false
              , F9 = this.doc.first + this.doc.size - 1;
            if (F7 < this.doc.first) {
                F7 = this.doc.first
            } else {
                if (F7 > F9) {
                    F7 = F9;
                    F6 = true
                }
            }
            var F8 = E9(this.doc, F7);
            return Ek(this, F8, {
                top: 0,
                left: 0
            }, GA || "page").top + (F6 ? this.doc.height - Bk(F8) : 0)
        },
        defaultTextHeight: function() {
            return At(this.display)
        },
        defaultCharWidth: function() {
            return DX(this.display)
        },
        setGutterMarker: C5(function(F6, F7, F8) {
            return ES(this.doc, F6, "gutter", function(F9) {
                var GA = F9.gutterMarkers || (F9.gutterMarkers = {});
                GA[F7] = F8;
                if (!F8 && Eo(GA)) {
                    F9.gutterMarkers = null
                }
                return true
            })
        }),
        clearGutter: C5(function(F8) {
            var F6 = this
              , F9 = F6.doc
              , F7 = F9.first;
            F9.iter(function(GA) {
                if (GA.gutterMarkers && GA.gutterMarkers[F8]) {
                    GA.gutterMarkers[F8] = null;
                    s(F6, F7, "gutter");
                    if (Eo(GA.gutterMarkers)) {
                        GA.gutterMarkers = null
                    }
                }
                ++F7
            })
        }),
        addLineWidget: C5(function(F8, F7, F6) {
            return Bf(this, F8, F7, F6)
        }),
        removeLineWidget: function(F6) {
            F6.clear()
        },
        lineInfo: function(F6) {
            if (typeof F6 == "number") {
                if (!B7(this.doc, F6)) {
                    return null
                }
                var F7 = F6;
                F6 = E9(this.doc, F6);
                if (!F6) {
                    return null
                }
            } else {
                var F7 = Bl(F6);
                if (F7 == null) {
                    return null
                }
            }
            return {
                line: F7,
                handle: F6,
                text: F6.text,
                gutterMarkers: F6.gutterMarkers,
                textClass: F6.textClass,
                bgClass: F6.bgClass,
                wrapClass: F6.wrapClass,
                widgets: F6.widgets
            }
        },
        getViewport: function() {
            return {
                from: this.display.viewFrom,
                to: this.display.viewTo
            }
        },
        addWidget: function(GB, F8, GD, F9, GF) {
            var GA = this.display;
            GB = Do(this, Fe(this.doc, GB));
            var GC = GB.bottom
              , F7 = GB.left;
            F8.style.position = "absolute";
            F8.setAttribute("cm-ignore-events", "true");
            GA.sizer.appendChild(F8);
            if (F9 == "over") {
                GC = GB.top
            } else {
                if (F9 == "above" || F9 == "near") {
                    var F6 = Math.max(GA.wrapper.clientHeight, this.doc.height)
                      , GE = Math.max(GA.sizer.clientWidth, GA.lineSpace.clientWidth);
                    if ((F9 == "above" || GB.bottom + F8.offsetHeight > F6) && GB.top > F8.offsetHeight) {
                        GC = GB.top - F8.offsetHeight
                    } else {
                        if (GB.bottom + F8.offsetHeight <= F6) {
                            GC = GB.bottom
                        }
                    }
                    if (F7 + F8.offsetWidth > GE) {
                        F7 = GE - F8.offsetWidth
                    }
                }
            }
            F8.style.top = GC + "px";
            F8.style.left = F8.style.right = "";
            if (GF == "right") {
                F7 = GA.sizer.clientWidth - F8.offsetWidth;
                F8.style.right = "0px"
            } else {
                if (GF == "left") {
                    F7 = 0
                } else {
                    if (GF == "middle") {
                        F7 = (GA.sizer.clientWidth - F8.offsetWidth) / 2
                    }
                }
                F8.style.left = F7 + "px"
            }
            if (GD) {
                f(this, F7, GC, F7 + F8.offsetWidth, GC + F8.offsetHeight)
            }
        },
        triggerOnKeyDown: C5(P),
        triggerOnKeyPress: C5(CW),
        triggerOnKeyUp: BE,
        execCommand: function(F6) {
            if (EX.hasOwnProperty(F6)) {
                return EX[F6](this)
            }
        },
        findPosH: function(GC, F9, GA, F7) {
            var F6 = 1;
            if (F9 < 0) {
                F6 = -1;
                F9 = -F9
            }
            for (var F8 = 0, GB = Fe(this.doc, GC); F8 < F9; ++F8) {
                GB = BU(this.doc, GB, F6, GA, F7);
                if (GB.hitSide) {
                    break
                }
            }
            return GB
        },
        moveH: C5(function(F7, F8) {
            var F6 = this;
            F6.extendSelectionsBy(function(F9) {
                if (F6.display.shift || F6.doc.extend || F9.empty()) {
                    return BU(F6.doc, F9.head, F7, F8, F6.options.rtlMoveVisually)
                } else {
                    return F7 < 0 ? F9.from() : F9.to()
                }
            }, Ct)
        }),
        deleteH: C5(function(F6, F7) {
            var F8 = this.doc.sel
              , F9 = this.doc;
            if (F8.somethingSelected()) {
                F9.replaceSelection("", null, "+delete")
            } else {
                Er(this, function(GB) {
                    var GA = BU(F9, GB.head, F6, F7, false);
                    return F6 < 0 ? {
                        from: GA,
                        to: GB.head
                    } : {
                        from: GB.head,
                        to: GA
                    }
                })
            }
        }),
        findPosV: function(GB, F8, GC, GE) {
            var F6 = 1
              , GA = GE;
            if (F8 < 0) {
                F6 = -1;
                F8 = -F8
            }
            for (var F7 = 0, GD = Fe(this.doc, GB); F7 < F8; ++F7) {
                var F9 = Do(this, GD, "div");
                if (GA == null) {
                    GA = F9.left
                } else {
                    F9.left = GA
                }
                GD = BO(this, F9, F6, GC);
                if (GD.hitSide) {
                    break
                }
            }
            return GD
        },
        moveV: C5(function(F7, F9) {
            var F6 = this
              , GB = this.doc
              , GA = [];
            var GC = !F6.display.shift && !GB.extend && GB.sel.somethingSelected();
            GB.extendSelectionsBy(function(GD) {
                if (GC) {
                    return F7 < 0 ? GD.from() : GD.to()
                }
                var GF = Do(F6, GD.head, "div");
                if (GD.goalColumn != null) {
                    GF.left = GD.goalColumn
                }
                GA.push(GF.left);
                var GE = BO(F6, GF, F7, F9);
                if (F9 == "page" && GD == GB.sel.primary()) {
                    Ci(F6, null, Cg(F6, GE, "div").top - GF.top)
                }
                return GE
            }, Ct);
            if (GA.length) {
                for (var F8 = 0; F8 < GB.sel.ranges.length; F8++) {
                    GB.sel.ranges[F8].goalColumn = GA[F8]
                }
            }
        }),
        findWordAt: function(GD) {
            var GB = this.doc
              , F9 = E9(GB, GD.line).text;
            var GC = GD.ch
              , F8 = GD.ch;
            if (F9) {
                var GA = this.getHelper(GD, "wordChars");
                if ((GD.xRel < 0 || F8 == F9.length) && GC) {
                    --GC
                } else {
                    ++F8
                }
                var F7 = F9.charAt(GC);
                var F6 = CY(F7, GA) ? function(GE) {
                    return CY(GE, GA)
                }
                : /\s/.test(F7) ? function(GE) {
                    return /\s/.test(GE)
                }
                : function(GE) {
                    return !/\s/.test(GE) && !CY(GE)
                }
                ;
                while (GC > 0 && F6(F9.charAt(GC - 1))) {
                    --GC
                }
                while (F8 < F9.length && F6(F9.charAt(F8))) {
                    ++F8
                }
            }
            return new Ds(x(GD.line, GC),x(GD.line, F8))
        },
        toggleOverwrite: function(F6) {
            if (F6 != null && F6 == this.state.overwrite) {
                return
            }
            if (this.state.overwrite = !this.state.overwrite) {
                FV(this.display.cursorDiv, "CodeMirror-overwrite")
            } else {
                F(this.display.cursorDiv, "CodeMirror-overwrite")
            }
            Ab(this, "overwriteToggle", this, this.state.overwrite)
        },
        hasFocus: function() {
            return Di() == this.display.input
        },
        scrollTo: C5(function(F6, F7) {
            if (F6 != null || F7 != null) {
                FX(this)
            }
            if (F6 != null) {
                this.curOp.scrollLeft = F6
            }
            if (F7 != null) {
                this.curOp.scrollTop = F7
            }
        }),
        getScrollInfo: function() {
            var F6 = this.display.scroller;
            return {
                left: F6.scrollLeft,
                top: F6.scrollTop,
                height: F6.scrollHeight - Cq(this) - this.display.barHeight,
                width: F6.scrollWidth - Cq(this) - this.display.barWidth,
                clientHeight: Cs(this),
                clientWidth: DH(this)
            }
        },
        scrollIntoView: C5(function(F7, F8) {
            if (F7 == null) {
                F7 = {
                    from: this.doc.sel.primary().head,
                    to: null
                };
                if (F8 == null) {
                    F8 = this.options.cursorScrollMargin
                }
            } else {
                if (typeof F7 == "number") {
                    F7 = {
                        from: x(F7, 0),
                        to: null
                    }
                } else {
                    if (F7.from == null) {
                        F7 = {
                            from: F7,
                            to: null
                        }
                    }
                }
            }
            if (!F7.to) {
                F7.to = F7.from
            }
            F7.margin = F8 || 0;
            if (F7.from.line != null) {
                FX(this);
                this.curOp.scrollToPos = F7
            } else {
                var F6 = h(this, Math.min(F7.from.left, F7.to.left), Math.min(F7.from.top, F7.to.top) - F7.margin, Math.max(F7.from.right, F7.to.right), Math.max(F7.from.bottom, F7.to.bottom) + F7.margin);
                this.scrollTo(F6.scrollLeft, F6.scrollTop)
            }
        }),
        setSize: C5(function(F9, F7) {
            var F6 = this;
            function F8(GB) {
                return typeof GB == "number" || /^\d+$/.test(String(GB)) ? GB + "px" : GB
            }
            if (F9 != null) {
                F6.display.wrapper.style.width = F8(F9)
            }
            if (F7 != null) {
                F6.display.wrapper.style.height = F8(F7)
            }
            if (F6.options.lineWrapping) {
                Ak(this)
            }
            var GA = F6.display.viewFrom;
            F6.doc.iter(GA, F6.display.viewTo, function(GB) {
                if (GB.widgets) {
                    for (var GC = 0; GC < GB.widgets.length; GC++) {
                        if (GB.widgets[GC].noHScroll) {
                            s(F6, GA, "widget");
                            break
                        }
                    }
                }
                ++GA
            });
            F6.curOp.forceUpdate = true;
            Ab(F6, "refresh", this)
        }),
        operation: function(F6) {
            return Cj(this, F6)
        },
        refresh: C5(function() {
            var F6 = this.display.cachedTextHeight;
            AG(this);
            this.curOp.forceUpdate = true;
            AJ(this);
            this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);
            C1(this);
            if (F6 == null || Math.abs(F6 - At(this.display)) > 0.5) {
                y(this)
            }
            Ab(this, "refresh", this)
        }),
        swapDoc: C5(function(F7) {
            var F6 = this.doc;
            F6.cm = null;
            D5(this, F7);
            AJ(this);
            FJ(this);
            this.scrollTo(F7.scrollLeft, F7.scrollTop);
            this.curOp.forceScroll = true;
            AD(this, "swapDoc", this, F6);
            return F6
        }),
        getInputField: function() {
            return this.display.input
        },
        getWrapperElement: function() {
            return this.display.wrapper
        },
        getScrollerElement: function() {
            return this.display.scroller
        },
        getGutterElement: function() {
            return this.display.gutters
        }
    };
    BW(i);
    var Ex = i.defaults = {};
    var BB = i.optionHandlers = {};
    function S(F6, F9, F8, F7) {
        i.defaults[F6] = F9;
        if (F8) {
            BB[F6] = F7 ? function(GA, GC, GB) {
                if (GB != CA) {
                    F8(GA, GC, GB)
                }
            }
            : F8
        }
    }
    var CA = i.Init = {
        toString: function() {
            return "CodeMirror.Init"
        }
    };
    S("value", "", function(F6, F7) {
        F6.setValue(F7)
    }, true);
    S("mode", null, function(F6, F7) {
        F6.doc.modeOption = F7;
        BP(F6)
    }, true);
    S("indentUnit", 2, BP, true);
    S("indentWithTabs", false);
    S("smartIndent", true);
    S("tabSize", 4, function(F6) {
        EF(F6);
        AJ(F6);
        AG(F6)
    }, true);
    S("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function(F6, F7) {
        F6.options.specialChars = new RegExp(F7.source + (F7.test("\t") ? "" : "|\t"),"g");
        F6.refresh()
    }, true);
    S("specialCharPlaceholder", E6, function(F6) {
        F6.refresh()
    }, true);
    S("electricChars", true);
    S("rtlMoveVisually", !Al);
    S("wholeLineUpdateBefore", true);
    S("theme", "default", function(F6) {
        Cl(F6);
        DQ(F6)
    }, true);
    S("keyMap", "default", function(F6, GA, F7) {
        var F8 = Fp(GA);
        var F9 = F7 != i.Init && Fp(F7);
        if (F9 && F9.detach) {
            F9.detach(F6, F8)
        }
        if (F8.attach) {
            F8.attach(F6, F9 || null)
        }
    });
    S("extraKeys", null);
    S("lineWrapping", false, Ea, true);
    S("gutters", [], function(F6) {
        CC(F6.options);
        DQ(F6)
    }, true);
    S("fixedGutter", true, function(F6, F7) {
        F6.display.gutters.style.left = F7 ? Dr(F6.display) + "px" : "0";
        F6.refresh()
    }, true);
    S("coverGutterNextToScrollbar", false, function(F6) {
        Es(F6)
    }, true);
    S("scrollbarStyle", "native", function(F6) {
        Aa(F6);
        Es(F6);
        F6.display.scrollbars.setScrollTop(F6.doc.scrollTop);
        F6.display.scrollbars.setScrollLeft(F6.doc.scrollLeft)
    }, true);
    S("lineNumbers", false, function(F6) {
        CC(F6.options);
        DQ(F6)
    }, true);
    S("firstLineNumber", 1, DQ, true);
    S("lineNumberFormatter", function(F6) {
        return F6
    }, DQ, true);
    S("showCursorWhenSelecting", false, Ba, true);
    S("resetSelectionOnContextMenu", true);
    S("readOnly", false, function(F6, F7) {
        if (F7 == "nocursor") {
            Ar(F6);
            F6.display.input.blur();
            F6.display.disabled = true
        } else {
            F6.display.disabled = false;
            if (!F7) {
                FJ(F6)
            }
        }
    });
    S("disableInput", false, function(F6, F7) {
        if (!F7) {
            FJ(F6)
        }
    }, true);
    S("dragDrop", true);
    S("cursorBlinkRate", 530);
    S("cursorScrollMargin", 0);
    S("cursorHeight", 1, Ba, true);
    S("singleCursorHeightPerLine", true, Ba, true);
    S("workTime", 100);
    S("workDelay", 100);
    S("flattenSpans", true, EF, true);
    S("addModeClass", false, EF, true);
    S("pollInterval", 100);
    S("undoDepth", 200, function(F6, F7) {
        F6.doc.history.undoDepth = F7
    });
    S("historyEventDelay", 1250);
    S("viewportMargin", 10, function(F6) {
        F6.refresh()
    }, true);
    S("maxHighlightLength", 10000, EF, true);
    S("moveInputWithCursor", true, function(F6, F7) {
        if (!F7) {
            F6.display.inputDiv.style.top = F6.display.inputDiv.style.left = 0
        }
    });
    S("tabindex", null, function(F6, F7) {
        F6.display.input.tabIndex = F7 || ""
    });
    S("autofocus", null);
    var DN = i.modes = {}
      , Ao = i.mimeModes = {};
    i.defineMode = function(F6, F7) {
        if (!i.defaults.mode && F6 != "null") {
            i.defaults.mode = F6
        }
        if (arguments.length > 2) {
            F7.dependencies = Array.prototype.slice.call(arguments, 2)
        }
        DN[F6] = F7
    }
    ;
    i.defineMIME = function(F7, F6) {
        Ao[F7] = F6
    }
    ;
    i.resolveMode = function(F6) {
        if (typeof F6 == "string" && Ao.hasOwnProperty(F6)) {
            F6 = Ao[F6]
        } else {
            if (F6 && typeof F6.name == "string" && Ao.hasOwnProperty(F6.name)) {
                var F7 = Ao[F6.name];
                if (typeof F7 == "string") {
                    F7 = {
                        name: F7
                    }
                }
                F6 = CJ(F7, F6);
                F6.name = F7.name
            } else {
                if (typeof F6 == "string" && /^[\w\-]+\/[\w\-]+\+xml$/.test(F6)) {
                    return i.resolveMode("application/xml")
                }
            }
        }
        if (typeof F6 == "string") {
            return {
                name: F6
            }
        } else {
            return F6 || {
                name: "null"
            }
        }
    }
    ;
    i.getMode = function(F7, F6) {
        var F6 = i.resolveMode(F6);
        var F9 = DN[F6.name];
        if (!F9) {
            return i.getMode(F7, "text/plain")
        }
        var GA = F9(F7, F6);
        if (DK.hasOwnProperty(F6.name)) {
            var F8 = DK[F6.name];
            for (var GB in F8) {
                if (!F8.hasOwnProperty(GB)) {
                    continue
                }
                if (GA.hasOwnProperty(GB)) {
                    GA["_" + GB] = GA[GB]
                }
                GA[GB] = F8[GB]
            }
        }
        GA.name = F6.name;
        if (F6.helperType) {
            GA.helperType = F6.helperType
        }
        if (F6.modeProps) {
            for (var GB in F6.modeProps) {
                GA[GB] = F6.modeProps[GB]
            }
        }
        return GA
    }
    ;
    i.defineMode("null", function() {
        return {
            token: function(F6) {
                F6.skipToEnd()
            }
        }
    });
    i.defineMIME("text/plain", "null");
    var DK = i.modeExtensions = {};
    i.extendMode = function(F8, F7) {
        var F6 = DK.hasOwnProperty(F8) ? DK[F8] : (DK[F8] = {});
        Aj(F7, F6)
    }
    ;
    i.defineExtension = function(F6, F7) {
        i.prototype[F6] = F7
    }
    ;
    i.defineDocExtension = function(F6, F7) {
        AR.prototype[F6] = F7
    }
    ;
    i.defineOption = S;
    var A4 = [];
    i.defineInitHook = function(F6) {
        A4.push(F6)
    }
    ;
    var FI = i.helpers = {};
    i.registerHelper = function(F7, F6, F8) {
        if (!FI.hasOwnProperty(F7)) {
            FI[F7] = i[F7] = {
                _global: []
            }
        }
        FI[F7][F6] = F8
    }
    ;
    i.registerGlobalHelper = function(F8, F7, F6, F9) {
        i.registerHelper(F8, F7, F9);
        FI[F8]._global.push({
            pred: F6,
            val: F9
        })
    }
    ;
    var B1 = i.copyState = function(F9, F6) {
        if (F6 === true) {
            return F6
        }
        if (F9.copyState) {
            return F9.copyState(F6)
        }
        var F8 = {};
        for (var GA in F6) {
            var F7 = F6[GA];
            if (F7 instanceof Array) {
                F7 = F7.concat([])
            }
            F8[GA] = F7
        }
        return F8
    }
    ;
    var By = i.startState = function(F8, F7, F6) {
        return F8.startState ? F8.startState(F7, F6) : true
    }
    ;
    i.innerMode = function(F8, F6) {
        while (F8.innerMode) {
            var F7 = F8.innerMode(F6);
            if (!F7 || F7.mode == F8) {
                break
            }
            F6 = F7.state;
            F8 = F7.mode
        }
        return F7 || {
            mode: F8,
            state: F6
        }
    }
    ;
    var EX = i.commands = {
        selectAll: function(F6) {
            F6.setSelection(x(F6.firstLine(), 0), x(F6.lastLine()), z)
        },
        singleSelection: function(F6) {
            F6.setSelection(F6.getCursor("anchor"), F6.getCursor("head"), z)
        },
        killLine: function(F6) {
            Er(F6, function(F8) {
                if (F8.empty()) {
                    var F7 = E9(F6.doc, F8.head.line).text.length;
                    if (F8.head.ch == F7 && F8.head.line < F6.lastLine()) {
                        return {
                            from: F8.head,
                            to: x(F8.head.line + 1, 0)
                        }
                    } else {
                        return {
                            from: F8.head,
                            to: x(F8.head.line, F7)
                        }
                    }
                } else {
                    return {
                        from: F8.from(),
                        to: F8.to()
                    }
                }
            })
        },
        deleteLine: function(F6) {
            Er(F6, function(F7) {
                return {
                    from: x(F7.from().line, 0),
                    to: Fe(F6.doc, x(F7.to().line + 1, 0))
                }
            })
        },
        delLineLeft: function(F6) {
            Er(F6, function(F7) {
                return {
                    from: x(F7.from().line, 0),
                    to: F7.from()
                }
            })
        },
        delWrappedLineLeft: function(F6) {
            Er(F6, function(F7) {
                var F9 = F6.charCoords(F7.head, "div").top + 5;
                var F8 = F6.coordsChar({
                    left: 0,
                    top: F9
                }, "div");
                return {
                    from: F8,
                    to: F7.from()
                }
            })
        },
        delWrappedLineRight: function(F6) {
            Er(F6, function(F7) {
                var F9 = F6.charCoords(F7.head, "div").top + 5;
                var F8 = F6.coordsChar({
                    left: F6.display.lineDiv.offsetWidth + 100,
                    top: F9
                }, "div");
                return {
                    from: F7.from(),
                    to: F8
                }
            })
        },
        undo: function(F6) {
            F6.undo()
        },
        redo: function(F6) {
            F6.redo()
        },
        undoSelection: function(F6) {
            F6.undoSelection()
        },
        redoSelection: function(F6) {
            F6.redoSelection()
        },
        goDocStart: function(F6) {
            F6.extendSelection(x(F6.firstLine(), 0))
        },
        goDocEnd: function(F6) {
            F6.extendSelection(x(F6.lastLine()))
        },
        goLineStart: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                return BR(F6, F7.head.line)
            }, {
                origin: "+move",
                bias: 1
            })
        },
        goLineStartSmart: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                return Dc(F6, F7.head)
            }, {
                origin: "+move",
                bias: 1
            })
        },
        goLineEnd: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                return Dj(F6, F7.head.line)
            }, {
                origin: "+move",
                bias: -1
            })
        },
        goLineRight: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                var F8 = F6.charCoords(F7.head, "div").top + 5;
                return F6.coordsChar({
                    left: F6.display.lineDiv.offsetWidth + 100,
                    top: F8
                }, "div")
            }, Ct)
        },
        goLineLeft: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                var F8 = F6.charCoords(F7.head, "div").top + 5;
                return F6.coordsChar({
                    left: 0,
                    top: F8
                }, "div")
            }, Ct)
        },
        goLineLeftSmart: function(F6) {
            F6.extendSelectionsBy(function(F7) {
                var F8 = F6.charCoords(F7.head, "div").top + 5;
                var F9 = F6.coordsChar({
                    left: 0,
                    top: F8
                }, "div");
                if (F9.ch < F6.getLine(F9.line).search(/\S/)) {
                    return Dc(F6, F7.head)
                }
                return F9
            }, Ct)
        },
        goLineUp: function(F6) {
            F6.moveV(-1, "line")
        },
        goLineDown: function(F6) {
            F6.moveV(1, "line")
        },
        goPageUp: function(F6) {
            F6.moveV(-1, "page")
        },
        goPageDown: function(F6) {
            F6.moveV(1, "page")
        },
        goCharLeft: function(F6) {
            F6.moveH(-1, "char")
        },
        goCharRight: function(F6) {
            F6.moveH(1, "char")
        },
        goColumnLeft: function(F6) {
            F6.moveH(-1, "column")
        },
        goColumnRight: function(F6) {
            F6.moveH(1, "column")
        },
        goWordLeft: function(F6) {
            F6.moveH(-1, "word")
        },
        goGroupRight: function(F6) {
            F6.moveH(1, "group")
        },
        goGroupLeft: function(F6) {
            F6.moveH(-1, "group")
        },
        goWordRight: function(F6) {
            F6.moveH(1, "word")
        },
        delCharBefore: function(F6) {
            F6.deleteH(-1, "char")
        },
        delCharAfter: function(F6) {
            F6.deleteH(1, "char")
        },
        delWordBefore: function(F6) {
            F6.deleteH(-1, "word")
        },
        delWordAfter: function(F6) {
            F6.deleteH(1, "word")
        },
        delGroupBefore: function(F6) {
            F6.deleteH(-1, "group")
        },
        delGroupAfter: function(F6) {
            F6.deleteH(1, "group")
        },
        indentAuto: function(F6) {
            F6.indentSelection("smart")
        },
        indentMore: function(F6) {
            F6.indentSelection("add")
        },
        indentLess: function(F6) {
            F6.indentSelection("subtract")
        },
        insertTab: function(F6) {
            F6.replaceSelection("\t")
        },
        insertSoftTab: function(F6) {
            var F8 = []
              , F7 = F6.listSelections()
              , GB = F6.options.tabSize;
            for (var GA = 0; GA < F7.length; GA++) {
                var GC = F7[GA].from();
                var F9 = Br(F6.getLine(GC.line), GC.ch, GB);
                F8.push(new Array(GB - F9 % GB + 1).join(" "))
            }
            F6.replaceSelections(F8)
        },
        defaultTab: function(F6) {
            if (F6.somethingSelected()) {
                F6.indentSelection("add")
            } else {
                F6.execCommand("insertTab")
            }
        },
        transposeChars: function(F6) {
            Cj(F6, function() {
                var F9 = F6.listSelections()
                  , F8 = [];
                for (var GA = 0; GA < F9.length; GA++) {
                    var GC = F9[GA].head
                      , F7 = E9(F6.doc, GC.line).text;
                    if (F7) {
                        if (GC.ch == F7.length) {
                            GC = new x(GC.line,GC.ch - 1)
                        }
                        if (GC.ch > 0) {
                            GC = new x(GC.line,GC.ch + 1);
                            F6.replaceRange(F7.charAt(GC.ch - 1) + F7.charAt(GC.ch - 2), x(GC.line, GC.ch - 2), GC, "+transpose")
                        } else {
                            if (GC.line > F6.doc.first) {
                                var GB = E9(F6.doc, GC.line - 1).text;
                                if (GB) {
                                    F6.replaceRange(F7.charAt(0) + "\n" + GB.charAt(GB.length - 1), x(GC.line - 1, GB.length - 1), x(GC.line, 1), "+transpose")
                                }
                            }
                        }
                    }
                    F8.push(new Ds(GC,GC))
                }
                F6.setSelections(F8)
            })
        },
        newlineAndIndent: function(F6) {
            Cj(F6, function() {
                var F7 = F6.listSelections().length;
                for (var F9 = 0; F9 < F7; F9++) {
                    var F8 = F6.listSelections()[F9];
                    F6.replaceRange("\n", F8.anchor, F8.head, "+input");
                    F6.indentLine(F8.from().line + 1, null, true);
                    Fb(F6)
                }
            })
        },
        toggleOverwrite: function(F6) {
            F6.toggleOverwrite()
        }
    };
    var E4 = i.keyMap = {};
    E4.basic = {
        Left: "goCharLeft",
        Right: "goCharRight",
        Up: "goLineUp",
        Down: "goLineDown",
        End: "goLineEnd",
        Home: "goLineStartSmart",
        PageUp: "goPageUp",
        PageDown: "goPageDown",
        Delete: "delCharAfter",
        Backspace: "delCharBefore",
        "Shift-Backspace": "delCharBefore",
        Tab: "defaultTab",
        "Shift-Tab": "indentAuto",
        Enter: "newlineAndIndent",
        Insert: "toggleOverwrite",
        Esc: "singleSelection"
    };
    E4.pcDefault = {
        "Ctrl-A": "selectAll",
        "Ctrl-D": "deleteLine",
        "Ctrl-Z": "undo",
        "Shift-Ctrl-Z": "redo",
        "Ctrl-Y": "redo",
        "Ctrl-Home": "goDocStart",
        "Ctrl-End": "goDocEnd",
        "Ctrl-Up": "goLineUp",
        "Ctrl-Down": "goLineDown",
        "Ctrl-Left": "goGroupLeft",
        "Ctrl-Right": "goGroupRight",
        "Alt-Left": "goLineStart",
        "Alt-Right": "goLineEnd",
        "Ctrl-Backspace": "delGroupBefore",
        "Ctrl-Delete": "delGroupAfter",
        "Ctrl-S": "save",
        "Ctrl-F": "find",
        "Ctrl-G": "findNext",
        "Shift-Ctrl-G": "findPrev",
        "Shift-Ctrl-F": "replace",
        "Shift-Ctrl-R": "replaceAll",
        "Ctrl-[": "indentLess",
        "Ctrl-]": "indentMore",
        "Ctrl-U": "undoSelection",
        "Shift-Ctrl-U": "redoSelection",
        "Alt-U": "redoSelection",
        fallthrough: "basic"
    };
    E4.emacsy = {
        "Ctrl-F": "goCharRight",
        "Ctrl-B": "goCharLeft",
        "Ctrl-P": "goLineUp",
        "Ctrl-N": "goLineDown",
        "Alt-F": "goWordRight",
        "Alt-B": "goWordLeft",
        "Ctrl-A": "goLineStart",
        "Ctrl-E": "goLineEnd",
        "Ctrl-V": "goPageDown",
        "Shift-Ctrl-V": "goPageUp",
        "Ctrl-D": "delCharAfter",
        "Ctrl-H": "delCharBefore",
        "Alt-D": "delWordAfter",
        "Alt-Backspace": "delWordBefore",
        "Ctrl-K": "killLine",
        "Ctrl-T": "transposeChars"
    };
    E4.macDefault = {
        "Cmd-A": "selectAll",
        "Cmd-D": "deleteLine",
        "Cmd-Z": "undo",
        "Shift-Cmd-Z": "redo",
        "Cmd-Y": "redo",
        "Cmd-Home": "goDocStart",
        "Cmd-Up": "goDocStart",
        "Cmd-End": "goDocEnd",
        "Cmd-Down": "goDocEnd",
        "Alt-Left": "goGroupLeft",
        "Alt-Right": "goGroupRight",
        "Cmd-Left": "goLineLeft",
        "Cmd-Right": "goLineRight",
        "Alt-Backspace": "delGroupBefore",
        "Ctrl-Alt-Backspace": "delGroupAfter",
        "Alt-Delete": "delGroupAfter",
        "Cmd-S": "save",
        "Cmd-F": "find",
        "Cmd-G": "findNext",
        "Shift-Cmd-G": "findPrev",
        "Cmd-Alt-F": "replace",
        "Shift-Cmd-Alt-F": "replaceAll",
        "Cmd-[": "indentLess",
        "Cmd-]": "indentMore",
        "Cmd-Backspace": "delWrappedLineLeft",
        "Cmd-Delete": "delWrappedLineRight",
        "Cmd-U": "undoSelection",
        "Shift-Cmd-U": "redoSelection",
        "Ctrl-Up": "goDocStart",
        "Ctrl-Down": "goDocEnd",
        fallthrough: ["basic", "emacsy"]
    };
    E4["default"] = B5 ? E4.macDefault : E4.pcDefault;
    function DO(F7) {
        var GD = F7.split(/-(?!$)/)
          , F7 = GD[GD.length - 1];
        var GC, GB, F6, GA;
        for (var F9 = 0; F9 < GD.length - 1; F9++) {
            var F8 = GD[F9];
            if (/^(cmd|meta|m)$/i.test(F8)) {
                GA = true
            } else {
                if (/^a(lt)?$/i.test(F8)) {
                    GC = true
                } else {
                    if (/^(c|ctrl|control)$/i.test(F8)) {
                        GB = true
                    } else {
                        if (/^s(hift)$/i.test(F8)) {
                            F6 = true
                        } else {
                            throw new Error("Unrecognized modifier name: " + F8)
                        }
                    }
                }
            }
        }
        if (GC) {
            F7 = "Alt-" + F7
        }
        if (GB) {
            F7 = "Ctrl-" + F7
        }
        if (GA) {
            F7 = "Cmd-" + F7
        }
        if (F6) {
            F7 = "Shift-" + F7
        }
        return F7
    }
    i.normalizeKeyMap = function(GD) {
        var F7 = {};
        for (var GC in GD) {
            if (GD.hasOwnProperty(GC)) {
                var GE = GD[GC];
                if (/^(name|fallthrough|(de|at)tach)$/.test(GC)) {
                    continue
                }
                if (GE == "...") {
                    delete GD[GC];
                    continue
                }
                var GF = Bq(GC.split(" "), DO);
                for (var GB = 0; GB < GF.length; GB++) {
                    var F9, F8;
                    if (GB == GF.length - 1) {
                        F8 = GC;
                        F9 = GE
                    } else {
                        F8 = GF.slice(0, GB + 1).join(" ");
                        F9 = "..."
                    }
                    var GA = F7[F8];
                    if (!GA) {
                        F7[F8] = F9
                    } else {
                        if (GA != F9) {
                            throw new Error("Inconsistent bindings for " + F8)
                        }
                    }
                }
                delete GD[GC]
            }
        }
        for (var F6 in F7) {
            GD[F6] = F7[F6]
        }
        return GD
    }
    ;
    var I = i.lookupKey = function(F9, GC, GB, F8) {
        GC = Fp(GC);
        var GA = GC.call ? GC.call(F9, F8) : GC[F9];
        if (GA === false) {
            return "nothing"
        }
        if (GA === "...") {
            return "multi"
        }
        if (GA != null && GB(GA)) {
            return "handled"
        }
        if (GC.fallthrough) {
            if (Object.prototype.toString.call(GC.fallthrough) != "[object Array]") {
                return I(F9, GC.fallthrough, GB, F8)
            }
            for (var F7 = 0; F7 < GC.fallthrough.length; F7++) {
                var F6 = I(F9, GC.fallthrough[F7], GB, F8);
                if (F6) {
                    return F6
                }
            }
        }
    }
    ;
    var EW = i.isModifierKey = function(F7) {
        var F6 = typeof F7 == "string" ? F7 : FA[F7.keyCode];
        return F6 == "Ctrl" || F6 == "Alt" || F6 == "Shift" || F6 == "Mod"
    }
    ;
    var FM = i.keyName = function(F7, F9) {
        if (Dw && F7.keyCode == 34 && F7["char"]) {
            return false
        }
        var F8 = FA[F7.keyCode]
          , F6 = F8;
        if (F6 == null || F7.altGraphKey) {
            return false
        }
        if (F7.altKey && F8 != "Alt") {
            F6 = "Alt-" + F6
        }
        if ((Bo ? F7.metaKey : F7.ctrlKey) && F8 != "Ctrl") {
            F6 = "Ctrl-" + F6
        }
        if ((Bo ? F7.ctrlKey : F7.metaKey) && F8 != "Cmd") {
            F6 = "Cmd-" + F6
        }
        if (!F9 && F7.shiftKey && F8 != "Shift") {
            F6 = "Shift-" + F6
        }
        return F6
    }
    ;
    function Fp(F6) {
        return typeof F6 == "string" ? E4[F6] : F6
    }
    i.fromTextArea = function(GD, GE) {
        if (!GE) {
            GE = {}
        }
        GE.value = GD.value;
        if (!GE.tabindex && GD.tabindex) {
            GE.tabindex = GD.tabindex
        }
        if (!GE.placeholder && GD.placeholder) {
            GE.placeholder = GD.placeholder
        }
        if (GE.autofocus == null) {
            var F6 = Di();
            GE.autofocus = F6 == GD || GD.getAttribute("autofocus") != null && F6 == document.body
        }
        function GA() {
            GD.value = GC.getValue()
        }
        if (GD.form) {
            Bv(GD.form, "submit", GA);
            if (!GE.leaveSubmitMethodAlone) {
                var F7 = GD.form
                  , GB = F7.submit;
                try {
                    var F9 = F7.submit = function() {
                        GA();
                        F7.submit = GB;
                        F7.submit();
                        F7.submit = F9
                    }
                } catch (F8) {}
            }
        }
        GD.style.display = "none";
        var GC = i(function(GF) {
            GD.parentNode.insertBefore(GF, GD.nextSibling)
        }, GE);
        GC.save = GA;
        GC.getTextArea = function() {
            return GD
        }
        ;
        GC.toTextArea = function() {
            GC.toTextArea = isNaN;
            GA();
            GD.parentNode.removeChild(GC.getWrapperElement());
            GD.style.display = "";
            if (GD.form) {
                D7(GD.form, "submit", GA);
                if (typeof GD.form.submit == "function") {
                    GD.form.submit = GB
                }
            }
        }
        ;
        return GC
    }
    ;
    var En = i.StringStream = function(F6, F7) {
        this.pos = this.start = 0;
        this.string = F6;
        this.tabSize = F7 || 8;
        this.lastColumnPos = this.lastColumnValue = 0;
        this.lineStart = 0
    }
    ;
    En.prototype = {
        eol: function() {
            return this.pos >= this.string.length
        },
        sol: function() {
            return this.pos == this.lineStart
        },
        peek: function() {
            return this.string.charAt(this.pos) || undefined
        },
        next: function() {
            if (this.pos < this.string.length) {
                return this.string.charAt(this.pos++)
            }
        },
        eat: function(F6) {
            var F8 = this.string.charAt(this.pos);
            if (typeof F6 == "string") {
                var F7 = F8 == F6
            } else {
                var F7 = F8 && (F6.test ? F6.test(F8) : F6(F8))
            }
            if (F7) {
                ++this.pos;
                return F8
            }
        },
        eatWhile: function(F6) {
            var F7 = this.pos;
            while (this.eat(F6)) {}
            return this.pos > F7
        },
        eatSpace: function() {
            var F6 = this.pos;
            while (/[\s\u00a0]/.test(this.string.charAt(this.pos))) {
                ++this.pos
            }
            return this.pos > F6
        },
        skipToEnd: function() {
            this.pos = this.string.length
        },
        skipTo: function(F6) {
            var F7 = this.string.indexOf(F6, this.pos);
            if (F7 > -1) {
                this.pos = F7;
                return true
            }
        },
        backUp: function(F6) {
            this.pos -= F6
        },
        column: function() {
            if (this.lastColumnPos < this.start) {
                this.lastColumnValue = Br(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
                this.lastColumnPos = this.start
            }
            return this.lastColumnValue - (this.lineStart ? Br(this.string, this.lineStart, this.tabSize) : 0)
        },
        indentation: function() {
            return Br(this.string, null, this.tabSize) - (this.lineStart ? Br(this.string, this.lineStart, this.tabSize) : 0)
        },
        match: function(GA, F7, F6) {
            if (typeof GA == "string") {
                var GB = function(GC) {
                    return F6 ? GC.toLowerCase() : GC
                };
                var F9 = this.string.substr(this.pos, GA.length);
                if (GB(F9) == GB(GA)) {
                    if (F7 !== false) {
                        this.pos += GA.length
                    }
                    return true
                }
            } else {
                var F8 = this.string.slice(this.pos).match(GA);
                if (F8 && F8.index > 0) {
                    return null
                }
                if (F8 && F7 !== false) {
                    this.pos += F8[0].length
                }
                return F8
            }
        },
        current: function() {
            return this.string.slice(this.start, this.pos)
        },
        hideFirstChars: function(F7, F6) {
            this.lineStart += F7;
            try {
                return F6()
            } finally {
                this.lineStart -= F7
            }
        }
    };
    var q = i.TextMarker = function(F7, F6) {
        this.lines = [];
        this.type = F6;
        this.doc = F7
    }
    ;
    BW(q);
    q.prototype.clear = function() {
        if (this.explicitlyCleared) {
            return
        }
        var GD = this.doc.cm
          , F7 = GD && !GD.curOp;
        if (F7) {
            Cf(GD)
        }
        if (FC(this, "clear")) {
            var GE = this.find();
            if (GE) {
                AD(this, "clear", GE.from, GE.to)
            }
        }
        var F8 = null
          , GB = null;
        for (var F9 = 0; F9 < this.lines.length; ++F9) {
            var GF = this.lines[F9];
            var GC = E3(GF.markedSpans, this);
            if (GD && !this.collapsed) {
                s(GD, Bl(GF), "text")
            } else {
                if (GD) {
                    if (GC.to != null) {
                        GB = Bl(GF)
                    }
                    if (GC.from != null) {
                        F8 = Bl(GF)
                    }
                }
            }
            GF.markedSpans = Eb(GF.markedSpans, GC);
            if (GC.from == null && this.collapsed && !FR(this.doc, GF) && GD) {
                Fu(GF, At(GD.display))
            }
        }
        if (GD && this.collapsed && !GD.options.lineWrapping) {
            for (var F9 = 0; F9 < this.lines.length; ++F9) {
                var F6 = Y(this.lines[F9])
                  , GA = EH(F6);
                if (GA > GD.display.maxLineLength) {
                    GD.display.maxLine = F6;
                    GD.display.maxLineLength = GA;
                    GD.display.maxLineChanged = true
                }
            }
        }
        if (F8 != null && GD && this.collapsed) {
            AG(GD, F8, GB + 1)
        }
        this.lines.length = 0;
        this.explicitlyCleared = true;
        if (this.atomic && this.doc.cantEdit) {
            this.doc.cantEdit = false;
            if (GD) {
                ER(GD.doc)
            }
        }
        if (GD) {
            AD(GD, "markerCleared", GD, this)
        }
        if (F7) {
            AL(GD)
        }
        if (this.parent) {
            this.parent.clear()
        }
    }
    ;
    q.prototype.find = function(F9, F7) {
        if (F9 == null && this.type == "bookmark") {
            F9 = 1
        }
        var GC, GB;
        for (var F8 = 0; F8 < this.lines.length; ++F8) {
            var F6 = this.lines[F8];
            var GA = E3(F6.markedSpans, this);
            if (GA.from != null) {
                GC = x(F7 ? F6 : Bl(F6), GA.from);
                if (F9 == -1) {
                    return GC
                }
            }
            if (GA.to != null) {
                GB = x(F7 ? F6 : Bl(F6), GA.to);
                if (F9 == 1) {
                    return GB
                }
            }
        }
        return GC && {
            from: GC,
            to: GB
        }
    }
    ;
    q.prototype.changed = function() {
        var F8 = this.find(-1, true)
          , F7 = this
          , F6 = this.doc.cm;
        if (!F8 || !F6) {
            return
        }
        Cj(F6, function() {
            var GA = F8.line
              , GB = Bl(F8.line);
            var F9 = E5(F6, GB);
            if (F9) {
                AS(F9);
                F6.curOp.selectionChanged = F6.curOp.forceUpdate = true
            }
            F6.curOp.updateMaxLine = true;
            if (!FR(F7.doc, GA) && F7.height != null) {
                var GD = F7.height;
                F7.height = null;
                var GC = Cv(F7) - GD;
                if (GC) {
                    Fu(GA, GA.height + GC)
                }
            }
        })
    }
    ;
    q.prototype.attachLine = function(F6) {
        if (!this.lines.length && this.doc.cm) {
            var F7 = this.doc.cm.curOp;
            if (!F7.maybeHiddenMarkers || DE(F7.maybeHiddenMarkers, this) == -1) {
                (F7.maybeUnhiddenMarkers || (F7.maybeUnhiddenMarkers = [])).push(this)
            }
        }
        this.lines.push(F6)
    }
    ;
    q.prototype.detachLine = function(F6) {
        this.lines.splice(DE(this.lines, F6), 1);
        if (!this.lines.length && this.doc.cm) {
            var F7 = this.doc.cm.curOp;
            (F7.maybeHiddenMarkers || (F7.maybeHiddenMarkers = [])).push(this)
        }
    }
    ;
    var A1 = 0;
    function EZ(GE, GC, GD, GG, GA) {
        if (GG && GG.shared) {
            return p(GE, GC, GD, GG, GA)
        }
        if (GE.cm && !GE.cm.curOp) {
            return Cz(GE.cm, EZ)(GE, GC, GD, GG, GA)
        }
        var F9 = new q(GE,GA)
          , GF = CD(GC, GD);
        if (GG) {
            Aj(GG, F9, false)
        }
        if (GF > 0 || GF == 0 && F9.clearWhenEmpty !== false) {
            return F9
        }
        if (F9.replacedWith) {
            F9.collapsed = true;
            F9.widgetNode = Fr("span", [F9.replacedWith], "CodeMirror-widget");
            if (!GG.handleMouseEvents) {
                F9.widgetNode.setAttribute("cm-ignore-events", "true")
            }
            if (GG.insertLeft) {
                F9.widgetNode.insertLeft = true
            }
        }
        if (F9.collapsed) {
            if (Z(GE, GC.line, GC, GD, F9) || GC.line != GD.line && Z(GE, GD.line, GC, GD, F9)) {
                throw new Error("Inserting collapsed marker partially overlapping an existing one")
            }
            A3 = true
        }
        if (F9.addToHistory) {
            Fh(GE, {
                from: GC,
                to: GD,
                origin: "markText"
            }, GE.sel, NaN)
        }
        var F7 = GC.line, GB = GE.cm, F6;
        GE.iter(F7, GD.line + 1, function(GH) {
            if (GB && F9.collapsed && !GB.options.lineWrapping && Y(GH) == GB.display.maxLine) {
                F6 = true
            }
            if (F9.collapsed && F7 != GC.line) {
                Fu(GH, 0)
            }
            CB(GH, new EC(F9,F7 == GC.line ? GC.ch : null,F7 == GD.line ? GD.ch : null));
            ++F7
        });
        if (F9.collapsed) {
            GE.iter(GC.line, GD.line + 1, function(GH) {
                if (FR(GE, GH)) {
                    Fu(GH, 0)
                }
            })
        }
        if (F9.clearOnEnter) {
            Bv(F9, "beforeCursorEnter", function() {
                F9.clear()
            })
        }
        if (F9.readOnly) {
            F1 = true;
            if (GE.history.done.length || GE.history.undone.length) {
                GE.clearHistory()
            }
        }
        if (F9.collapsed) {
            F9.id = ++A1;
            F9.atomic = true
        }
        if (GB) {
            if (F6) {
                GB.curOp.updateMaxLine = true
            }
            if (F9.collapsed) {
                AG(GB, GC.line, GD.line + 1)
            } else {
                if (F9.className || F9.title || F9.startStyle || F9.endStyle || F9.css) {
                    for (var F8 = GC.line; F8 <= GD.line; F8++) {
                        s(GB, F8, "text")
                    }
                }
            }
            if (F9.atomic) {
                ER(GB.doc)
            }
            AD(GB, "markerAdded", GB, F9)
        }
        return F9
    }
    var X = i.SharedTextMarker = function(F8, F7) {
        this.markers = F8;
        this.primary = F7;
        for (var F6 = 0; F6 < F8.length; ++F6) {
            F8[F6].parent = this
        }
    }
    ;
    BW(X);
    X.prototype.clear = function() {
        if (this.explicitlyCleared) {
            return
        }
        this.explicitlyCleared = true;
        for (var F6 = 0; F6 < this.markers.length; ++F6) {
            this.markers[F6].clear()
        }
        AD(this, "clear")
    }
    ;
    X.prototype.find = function(F7, F6) {
        return this.primary.find(F7, F6)
    }
    ;
    function p(GA, GD, GC, F6, F8) {
        F6 = Aj(F6);
        F6.shared = false;
        var GB = [EZ(GA, GD, GC, F6, F8)]
          , F7 = GB[0];
        var F9 = F6.widgetNode;
        D1(GA, function(GF) {
            if (F9) {
                F6.widgetNode = F9.cloneNode(true)
            }
            GB.push(EZ(GF, Fe(GF, GD), Fe(GF, GC), F6, F8));
            for (var GE = 0; GE < GF.linked.length; ++GE) {
                if (GF.linked[GE].isParent) {
                    return
                }
            }
            F7 = Fc(GB)
        });
        return new X(GB,F7)
    }
    function Ej(F6) {
        return F6.findMarks(x(F6.first, 0), F6.clipPos(x(F6.lastLine())), function(F7) {
            return F7.parent
        })
    }
    function DZ(GB, GC) {
        for (var F9 = 0; F9 < GC.length; F9++) {
            var F7 = GC[F9]
              , GD = F7.find();
            var F6 = GB.clipPos(GD.from)
              , GA = GB.clipPos(GD.to);
            if (CD(F6, GA)) {
                var F8 = EZ(GB, F6, GA, F7.primary, F7.primary.type);
                F7.markers.push(F8);
                F8.parent = F7
            }
        }
    }
    function EI(F9) {
        for (var F8 = 0; F8 < F9.length; F8++) {
            var F6 = F9[F8]
              , GB = [F6.primary.doc];
            D1(F6.primary.doc, function(GC) {
                GB.push(GC)
            });
            for (var F7 = 0; F7 < F6.markers.length; F7++) {
                var GA = F6.markers[F7];
                if (DE(GB, GA.doc) == -1) {
                    GA.parent = null;
                    F6.markers.splice(F7--, 1)
                }
            }
        }
    }
    function EC(F6, F8, F7) {
        this.marker = F6;
        this.from = F8;
        this.to = F7
    }
    function E3(F8, F6) {
        if (F8) {
            for (var F7 = 0; F7 < F8.length; ++F7) {
                var F9 = F8[F7];
                if (F9.marker == F6) {
                    return F9
                }
            }
        }
    }
    function Eb(F7, F8) {
        for (var F9, F6 = 0; F6 < F7.length; ++F6) {
            if (F7[F6] != F8) {
                (F9 || (F9 = [])).push(F7[F6])
            }
        }
        return F9
    }
    function CB(F6, F7) {
        F6.markedSpans = F6.markedSpans ? F6.markedSpans.concat([F7]) : [F7];
        F7.marker.attachLine(F6)
    }
    function Am(F7, F8, GC) {
        if (F7) {
            for (var GA = 0, GD; GA < F7.length; ++GA) {
                var GE = F7[GA]
                  , GB = GE.marker;
                var F6 = GE.from == null || (GB.inclusiveLeft ? GE.from <= F8 : GE.from < F8);
                if (F6 || GE.from == F8 && GB.type == "bookmark" && (!GC || !GE.marker.insertLeft)) {
                    var F9 = GE.to == null || (GB.inclusiveRight ? GE.to >= F8 : GE.to > F8);
                    (GD || (GD = [])).push(new EC(GB,GE.from,F9 ? null : GE.to))
                }
            }
        }
        return GD
    }
    function AY(F7, F9, GC) {
        if (F7) {
            for (var GA = 0, GD; GA < F7.length; ++GA) {
                var GE = F7[GA]
                  , GB = GE.marker;
                var F8 = GE.to == null || (GB.inclusiveRight ? GE.to >= F9 : GE.to > F9);
                if (F8 || GE.from == F9 && GB.type == "bookmark" && (!GC || GE.marker.insertLeft)) {
                    var F6 = GE.from == null || (GB.inclusiveLeft ? GE.from <= F9 : GE.from < F9);
                    (GD || (GD = [])).push(new EC(GB,F6 ? null : GE.from - F9,GE.to == null ? null : GE.to - F9))
                }
            }
        }
        return GD
    }
    function EE(GI, GF) {
        if (GF.full) {
            return null
        }
        var GE = B7(GI, GF.from.line) && E9(GI, GF.from.line).markedSpans;
        var GL = B7(GI, GF.to.line) && E9(GI, GF.to.line).markedSpans;
        if (!GE && !GL) {
            return null
        }
        var F7 = GF.from.ch
          , GA = GF.to.ch
          , GD = CD(GF.from, GF.to) == 0;
        var GC = Am(GE, F7, GD);
        var GK = AY(GL, GA, GD);
        var GJ = GF.text.length == 1
          , F8 = Fc(GF.text).length + (GJ ? F7 : 0);
        if (GC) {
            for (var F9 = 0; F9 < GC.length; ++F9) {
                var GH = GC[F9];
                if (GH.to == null) {
                    var GM = E3(GK, GH.marker);
                    if (!GM) {
                        GH.to = F7
                    } else {
                        if (GJ) {
                            GH.to = GM.to == null ? null : GM.to + F8
                        }
                    }
                }
            }
        }
        if (GK) {
            for (var F9 = 0; F9 < GK.length; ++F9) {
                var GH = GK[F9];
                if (GH.to != null) {
                    GH.to += F8
                }
                if (GH.from == null) {
                    var GM = E3(GC, GH.marker);
                    if (!GM) {
                        GH.from = F8;
                        if (GJ) {
                            (GC || (GC = [])).push(GH)
                        }
                    }
                } else {
                    GH.from += F8;
                    if (GJ) {
                        (GC || (GC = [])).push(GH)
                    }
                }
            }
        }
        if (GC) {
            GC = Q(GC)
        }
        if (GK && GK != GC) {
            GK = Q(GK)
        }
        var GB = [GC];
        if (!GJ) {
            var GG = GF.text.length - 2, F6;
            if (GG > 0 && GC) {
                for (var F9 = 0; F9 < GC.length; ++F9) {
                    if (GC[F9].to == null) {
                        (F6 || (F6 = [])).push(new EC(GC[F9].marker,null,null))
                    }
                }
            }
            for (var F9 = 0; F9 < GG; ++F9) {
                GB.push(F6)
            }
            GB.push(GK)
        }
        return GB
    }
    function Q(F7) {
        for (var F6 = 0; F6 < F7.length; ++F6) {
            var F8 = F7[F6];
            if (F8.from != null && F8.from == F8.to && F8.marker.clearWhenEmpty !== false) {
                F7.splice(F6--, 1)
            }
        }
        if (!F7.length) {
            return null
        }
        return F7
    }
    function D3(GE, GC) {
        var F6 = B2(GE, GC);
        var GF = EE(GE, GC);
        if (!F6) {
            return GF
        }
        if (!GF) {
            return F6
        }
        for (var F9 = 0; F9 < F6.length; ++F9) {
            var GA = F6[F9]
              , GB = GF[F9];
            if (GA && GB) {
                spans: for (var F8 = 0; F8 < GB.length; ++F8) {
                    var GD = GB[F8];
                    for (var F7 = 0; F7 < GA.length; ++F7) {
                        if (GA[F7].marker == GD.marker) {
                            continue spans
                        }
                    }
                    GA.push(GD)
                }
            } else {
                if (GB) {
                    F6[F9] = GB
                }
            }
        }
        return F6
    }
    function Ce(GI, GG, GH) {
        var GA = null;
        GI.iter(GG.line, GH.line + 1, function(GJ) {
            if (GJ.markedSpans) {
                for (var GK = 0; GK < GJ.markedSpans.length; ++GK) {
                    var GL = GJ.markedSpans[GK].marker;
                    if (GL.readOnly && (!GA || DE(GA, GL) == -1)) {
                        (GA || (GA = [])).push(GL)
                    }
                }
            }
        });
        if (!GA) {
            return null
        }
        var GB = [{
            from: GG,
            to: GH
        }];
        for (var GC = 0; GC < GA.length; ++GC) {
            var GD = GA[GC]
              , F8 = GD.find(0);
            for (var F9 = 0; F9 < GB.length; ++F9) {
                var F7 = GB[F9];
                if (CD(F7.to, F8.from) < 0 || CD(F7.from, F8.to) > 0) {
                    continue
                }
                var GF = [F9, 1]
                  , F6 = CD(F7.from, F8.from)
                  , GE = CD(F7.to, F8.to);
                if (F6 < 0 || !GD.inclusiveLeft && !F6) {
                    GF.push({
                        from: F7.from,
                        to: F8.from
                    })
                }
                if (GE > 0 || !GD.inclusiveRight && !GE) {
                    GF.push({
                        from: F8.to,
                        to: F7.to
                    })
                }
                GB.splice.apply(GB, GF);
                F9 += GF.length - 1
            }
        }
        return GB
    }
    function Fx(F6) {
        var F8 = F6.markedSpans;
        if (!F8) {
            return
        }
        for (var F7 = 0; F7 < F8.length; ++F7) {
            F8[F7].marker.detachLine(F6)
        }
        F6.markedSpans = null
    }
    function C0(F6, F8) {
        if (!F8) {
            return
        }
        for (var F7 = 0; F7 < F8.length; ++F7) {
            F8[F7].marker.attachLine(F6)
        }
        F6.markedSpans = F8
    }
    function V(F6) {
        return F6.inclusiveLeft ? -1 : 0
    }
    function Bu(F6) {
        return F6.inclusiveRight ? 1 : 0
    }
    function Dk(F9, F7) {
        var GB = F9.lines.length - F7.lines.length;
        if (GB != 0) {
            return GB
        }
        var F8 = F9.find()
          , GC = F7.find();
        var F6 = CD(F8.from, GC.from) || V(F9) - V(F7);
        if (F6) {
            return -F6
        }
        var GA = CD(F8.to, GC.to) || Bu(F9) - Bu(F7);
        if (GA) {
            return GA
        }
        return F7.id - F9.id
    }
    function A2(F7, GB) {
        var F6 = A3 && F7.markedSpans, GA;
        if (F6) {
            for (var F9, F8 = 0; F8 < F6.length; ++F8) {
                F9 = F6[F8];
                if (F9.marker.collapsed && (GB ? F9.from : F9.to) == null && (!GA || Dk(GA, F9.marker) < 0)) {
                    GA = F9.marker
                }
            }
        }
        return GA
    }
    function Ei(F6) {
        return A2(F6, true)
    }
    function EP(F6) {
        return A2(F6, false)
    }
    function Z(GE, F8, GC, GD, GA) {
        var GH = E9(GE, F8);
        var F6 = A3 && GH.markedSpans;
        if (F6) {
            for (var F9 = 0; F9 < F6.length; ++F9) {
                var F7 = F6[F9];
                if (!F7.marker.collapsed) {
                    continue
                }
                var GG = F7.marker.find(0);
                var GF = CD(GG.from, GC) || V(F7.marker) - V(GA);
                var GB = CD(GG.to, GD) || Bu(F7.marker) - Bu(GA);
                if (GF >= 0 && GB <= 0 || GF <= 0 && GB >= 0) {
                    continue
                }
                if (GF <= 0 && (CD(GG.to, GC) > 0 || (F7.marker.inclusiveRight && GA.inclusiveLeft)) || GF >= 0 && (CD(GG.from, GD) < 0 || (F7.marker.inclusiveLeft && GA.inclusiveRight))) {
                    return true
                }
            }
        }
    }
    function Y(F7) {
        var F6;
        while (F6 = Ei(F7)) {
            F7 = F6.find(-1, true).line
        }
        return F7
    }
    function H(F8) {
        var F6, F7;
        while (F6 = EP(F8)) {
            F8 = F6.find(1, true).line;
            (F7 || (F7 = [])).push(F8)
        }
        return F7
    }
    function As(F9, F7) {
        var F6 = E9(F9, F7)
          , F8 = Y(F6);
        if (F6 == F8) {
            return F7
        }
        return Bl(F8)
    }
    function Dx(F9, F8) {
        if (F8 > F9.lastLine()) {
            return F8
        }
        var F7 = E9(F9, F8), F6;
        if (!FR(F9, F7)) {
            return F8
        }
        while (F6 = EP(F7)) {
            F7 = F6.find(1, true).line
        }
        return Bl(F7) + 1
    }
    function FR(GA, F7) {
        var F6 = A3 && F7.markedSpans;
        if (F6) {
            for (var F9, F8 = 0; F8 < F6.length; ++F8) {
                F9 = F6[F8];
                if (!F9.marker.collapsed) {
                    continue
                }
                if (F9.from == null) {
                    return true
                }
                if (F9.marker.widgetNode) {
                    continue
                }
                if (F9.from == 0 && F9.marker.inclusiveLeft && u(GA, F7, F9)) {
                    return true
                }
            }
        }
    }
    function u(GB, F7, F9) {
        if (F9.to == null) {
            var F6 = F9.marker.find(1, true);
            return u(GB, F6.line, E3(F6.line.markedSpans, F9.marker))
        }
        if (F9.marker.inclusiveRight && F9.to == F7.text.length) {
            return true
        }
        for (var GA, F8 = 0; F8 < F7.markedSpans.length; ++F8) {
            GA = F7.markedSpans[F8];
            if (GA.marker.collapsed && !GA.marker.widgetNode && GA.from == F9.to && (GA.to == null || GA.to != F9.from) && (GA.marker.inclusiveLeft || F9.marker.inclusiveRight) && u(GB, F7, GA)) {
                return true
            }
        }
    }
    var DW = i.LineWidget = function(F6, F9, F7) {
        if (F7) {
            for (var F8 in F7) {
                if (F7.hasOwnProperty(F8)) {
                    this[F8] = F7[F8]
                }
            }
        }
        this.cm = F6;
        this.node = F9
    }
    ;
    BW(DW);
    function Du(F6, F7, F8) {
        if (Bk(F7) < ((F6.curOp && F6.curOp.scrollTop) || F6.doc.scrollTop)) {
            Ci(F6, null, F8)
        }
    }
    DW.prototype.clear = function() {
        var F7 = this.cm
          , F9 = this.line.widgets
          , F8 = this.line
          , GB = Bl(F8);
        if (GB == null || !F9) {
            return
        }
        for (var GA = 0; GA < F9.length; ++GA) {
            if (F9[GA] == this) {
                F9.splice(GA--, 1)
            }
        }
        if (!F9.length) {
            F8.widgets = null
        }
        var F6 = Cv(this);
        Cj(F7, function() {
            Du(F7, F8, -F6);
            s(F7, GB, "widget");
            Fu(F8, Math.max(0, F8.height - F6))
        })
    }
    ;
    DW.prototype.changed = function() {
        var F7 = this.height
          , F6 = this.cm
          , F8 = this.line;
        this.height = null;
        var F9 = Cv(this) - F7;
        if (!F9) {
            return
        }
        Cj(F6, function() {
            F6.curOp.forceUpdate = true;
            Du(F6, F8, F9);
            Fu(F8, F8.height + F9)
        })
    }
    ;
    function Cv(F7) {
        if (F7.height != null) {
            return F7.height
        }
        if (!Fz(document.body, F7.node)) {
            var F6 = "position: relative;";
            if (F7.coverGutter) {
                F6 += "margin-left: -" + F7.cm.display.gutters.offsetWidth + "px;"
            }
            if (F7.noHScroll) {
                F6 += "width: " + F7.cm.display.wrapper.clientWidth + "px;"
            }
            Bp(F7.cm.display.measure, Fr("div", [F7.node], null, F6))
        }
        return F7.height = F7.node.offsetHeight
    }
    function Bf(F6, GA, F8, F7) {
        var F9 = new DW(F6,F8,F7);
        if (F9.noHScroll) {
            F6.display.alignWidgets = true
        }
        ES(F6.doc, GA, "widget", function(GC) {
            var GD = GC.widgets || (GC.widgets = []);
            if (F9.insertAt == null) {
                GD.push(F9)
            } else {
                GD.splice(Math.min(GD.length - 1, Math.max(0, F9.insertAt)), 0, F9)
            }
            F9.line = GC;
            if (!FR(F6.doc, GC)) {
                var GB = Bk(GC) < F6.doc.scrollTop;
                Fu(GC, GC.height + Cv(F9));
                if (GB) {
                    Ci(F6, null, F9.height)
                }
                F6.curOp.forceUpdate = true
            }
            return true
        });
        return F9
    }
    var Fv = i.Line = function(F8, F7, F6) {
        this.text = F8;
        C0(this, F7);
        this.height = F6 ? F6(this) : 1
    }
    ;
    BW(Fv);
    Fv.prototype.lineNo = function() {
        return Bl(this)
    }
    ;
    function EG(F7, GA, F8, F6) {
        F7.text = GA;
        if (F7.stateAfter) {
            F7.stateAfter = null
        }
        if (F7.styles) {
            F7.styles = null
        }
        if (F7.order != null) {
            F7.order = null
        }
        Fx(F7);
        C0(F7, F8);
        var F9 = F6 ? F6(F7) : 1;
        if (F9 != F7.height) {
            Fu(F7, F9)
        }
    }
    function BZ(F6) {
        F6.parent = null;
        Fx(F6)
    }
    function DF(F8, F7) {
        if (F8) {
            for (; ; ) {
                var F6 = F8.match(/(?:^|\s+)line-(background-)?(\S+)/);
                if (!F6) {
                    break
                }
                F8 = F8.slice(0, F6.index) + F8.slice(F6.index + F6[0].length);
                var F9 = F6[1] ? "bgClass" : "textClass";
                if (F7[F9] == null) {
                    F7[F9] = F6[2]
                } else {
                    if (!(new RegExp("(?:^|s)" + F6[2] + "(?:$|s)")).test(F7[F9])) {
                        F7[F9] += " " + F6[2]
                    }
                }
            }
        }
        return F8
    }
    function FL(F8, F7) {
        if (F8.blankLine) {
            return F8.blankLine(F7)
        }
        if (!F8.innerMode) {
            return
        }
        var F6 = i.innerMode(F8, F7);
        if (F6.mode.blankLine) {
            return F6.mode.blankLine(F6.state)
        }
    }
    function EU(GB, GA, F9, F6) {
        for (var F7 = 0; F7 < 10; F7++) {
            if (F6) {
                F6[0] = i.innerMode(GB, F9).mode
            }
            var F8 = GB.token(GA, F9);
            if (GA.pos > GA.start) {
                return F8
            }
        }
        throw new Error("Mode " + GB.name + " failed to advance stream.")
    }
    function CP(GF, GD, GA, F9) {
        function F6(GI) {
            return {
                start: GG.start,
                end: GG.pos,
                string: GG.current(),
                type: F8 || null,
                state: GI ? B1(GE.mode, F7) : F7
            }
        }
        var GE = GF.doc, GB = GE.mode, F8;
        GD = Fe(GE, GD);
        var GH = E9(GE, GD.line)
          , F7 = DV(GF, GD.line, GA);
        var GG = new En(GH.text,GF.options.tabSize), GC;
        if (F9) {
            GC = []
        }
        while ((F9 || GG.pos < GD.ch) && !GG.eol()) {
            GG.start = GG.pos;
            F8 = EU(GB, GG, F7);
            if (F9) {
                GC.push(F6(true))
            }
        }
        return F9 ? GC : F6()
    }
    function W(GG, GI, GB, F7, GC, F9, GA) {
        var F8 = GB.flattenSpans;
        if (F8 == null) {
            F8 = GG.options.flattenSpans
        }
        var GE = 0
          , GD = null;
        var GH = new En(GI,GG.options.tabSize), F6;
        var GK = GG.options.addModeClass && [null];
        if (GI == "") {
            DF(FL(GB, F7), F9)
        }
        while (!GH.eol()) {
            if (GH.pos > GG.options.maxHighlightLength) {
                F8 = false;
                if (GA) {
                    DR(GG, GI, F7, GH.pos)
                }
                GH.pos = GI.length;
                F6 = null
            } else {
                F6 = DF(EU(GB, GH, F7, GK), F9)
            }
            if (GK) {
                var GJ = GK[0].name;
                if (GJ) {
                    F6 = "m-" + (F6 ? GJ + " " + F6 : GJ)
                }
            }
            if (!F8 || GD != F6) {
                while (GE < GH.start) {
                    GE = Math.min(GH.start, GE + 50000);
                    GC(GE, GD)
                }
                GD = F6
            }
            GH.start = GH.pos
        }
        while (GE < GH.pos) {
            var GF = Math.min(GH.pos, GE + 50000);
            GC(GF, GD);
            GE = GF
        }
    }
    function FU(GD, GF, F6, GA) {
        var GE = [GD.state.modeGen]
          , F9 = {};
        W(GD, GF.text, GD.doc.mode, F6, function(GG, GH) {
            GE.push(GG, GH)
        }, F9, GA);
        for (var F7 = 0; F7 < GD.state.overlays.length; ++F7) {
            var GB = GD.state.overlays[F7]
              , GC = 1
              , F8 = 0;
            W(GD, GF.text, GB.mode, true, function(GG, GI) {
                var GK = GC;
                while (F8 < GG) {
                    var GH = GE[GC];
                    if (GH > GG) {
                        GE.splice(GC, 1, GG, GE[GC + 1], GH)
                    }
                    GC += 2;
                    F8 = Math.min(GG, GH)
                }
                if (!GI) {
                    return
                }
                if (GB.opaque) {
                    GE.splice(GK, GC - GK, GG, "cm-overlay " + GI);
                    GC = GK + 2
                } else {
                    for (; GK < GC; GK += 2) {
                        var GJ = GE[GK + 1];
                        GE[GK + 1] = (GJ ? GJ + " " : "") + "cm-overlay " + GI
                    }
                }
            }, F9)
        }
        return {
            styles: GE,
            classes: F9.bgClass || F9.textClass ? F9 : null
        }
    }
    function C3(F7, F8, F9) {
        if (!F8.styles || F8.styles[0] != F7.state.modeGen) {
            var F6 = FU(F7, F8, F8.stateAfter = DV(F7, Bl(F8)));
            F8.styles = F6.styles;
            if (F6.classes) {
                F8.styleClasses = F6.classes
            } else {
                if (F8.styleClasses) {
                    F8.styleClasses = null
                }
            }
            if (F9 === F7.doc.frontier) {
                F7.doc.frontier++
            }
        }
        return F8.styles
    }
    function DR(F6, GB, F8, F7) {
        var GA = F6.doc.mode;
        var F9 = new En(GB,F6.options.tabSize);
        F9.start = F9.pos = F7 || 0;
        if (GB == "") {
            FL(GA, F8)
        }
        while (!F9.eol() && F9.pos <= F6.options.maxHighlightLength) {
            EU(GA, F9, F8);
            F9.start = F9.pos
        }
    }
    var Dq = {}
      , Bz = {};
    function Eq(F8, F7) {
        if (!F8 || /^\s*$/.test(F8)) {
            return null
        }
        var F6 = F7.addModeClass ? Bz : Dq;
        return F6[F8] || (F6[F8] = F8.replace(/\S+/g, "cm-$&"))
    }
    function El(F7, GB) {
        var GC = Fr("span", null, null, Cx ? "padding-right: .1px" : null);
        var F9 = {
            pre: Fr("pre", [GC]),
            content: GC,
            col: 0,
            pos: 0,
            cm: F7
        };
        GB.measure = {};
        for (var GA = 0; GA <= (GB.rest ? GB.rest.length : 0); GA++) {
            var F8 = GA ? GB.rest[GA - 1] : GB.line, F6;
            F9.pos = 0;
            F9.addToken = T;
            if ((De || Cx) && F7.getOption("lineWrapping")) {
                F9.addToken = Fa(F9.addToken)
            }
            if (Bm(F7.display.measure) && (F6 = A(F8))) {
                F9.addToken = v(F9.addToken, F6)
            }
            F9.map = [];
            var GD = GB != F7.display.externalMeasured && Bl(F8);
            BM(F8, F9, C3(F7, F8, GD));
            if (F8.styleClasses) {
                if (F8.styleClasses.bgClass) {
                    F9.bgClass = Fm(F8.styleClasses.bgClass, F9.bgClass || "")
                }
                if (F8.styleClasses.textClass) {
                    F9.textClass = Fm(F8.styleClasses.textClass, F9.textClass || "")
                }
            }
            if (F9.map.length == 0) {
                F9.map.push(0, 0, F9.content.appendChild(BL(F7.display.measure)))
            }
            if (GA == 0) {
                GB.measure.map = F9.map;
                GB.measure.cache = {}
            } else {
                (GB.measure.maps || (GB.measure.maps = [])).push(F9.map);
                (GB.measure.caches || (GB.measure.caches = [])).push({})
            }
        }
        if (Cx && /\bcm-tab\b/.test(F9.content.lastChild.className)) {
            F9.content.className = "cm-tab-wrap-hack"
        }
        Ab(F7, "renderLine", F7, GB.line, F9.pre);
        if (F9.pre.className) {
            F9.textClass = Fm(F9.pre.className, F9.textClass || "")
        }
        return F9
    }
    function E6(F7) {
        var F6 = Fr("span", "\u2022", "cm-invalidchar");
        F6.title = "\\u" + F7.charCodeAt(0).toString(16);
        return F6
    }
    function T(GH, GC, GL, GJ, GF, GN, GB) {
        if (!GC) {
            return
        }
        var F6 = GH.cm.options.specialChars
          , F7 = false;
        if (!F6.test(GC)) {
            GH.col += GC.length;
            var GK = document.createTextNode(GC);
            GH.map.push(GH.pos, GH.pos + GC.length, GK);
            if (De && K < 9) {
                F7 = true
            }
            GH.pos += GC.length
        } else {
            var GK = document.createDocumentFragment()
              , F9 = 0;
            while (true) {
                F6.lastIndex = F9;
                var GI = F6.exec(GC);
                var GM = GI ? GI.index - F9 : GC.length - F9;
                if (GM) {
                    var GE = document.createTextNode(GC.slice(F9, F9 + GM));
                    if (De && K < 9) {
                        GK.appendChild(Fr("span", [GE]))
                    } else {
                        GK.appendChild(GE)
                    }
                    GH.map.push(GH.pos, GH.pos + GM, GE);
                    GH.col += GM;
                    GH.pos += GM
                }
                if (!GI) {
                    break
                }
                F9 += GM + 1;
                if (GI[0] == "\t") {
                    var GG = GH.cm.options.tabSize
                      , GD = GG - GH.col % GG;
                    var GE = GK.appendChild(Fr("span", CO(GD), "cm-tab"));
                    GH.col += GD
                } else {
                    var GE = GH.cm.options.specialCharPlaceholder(GI[0]);
                    if (De && K < 9) {
                        GK.appendChild(Fr("span", [GE]))
                    } else {
                        GK.appendChild(GE)
                    }
                    GH.col += 1
                }
                GH.map.push(GH.pos, GH.pos + 1, GE);
                GH.pos++
            }
        }
        if (GL || GJ || GF || F7 || GB) {
            var F8 = GL || "";
            if (GJ) {
                F8 += GJ
            }
            if (GF) {
                F8 += GF
            }
            var GA = Fr("span", [GK], F8, GB);
            if (GN) {
                GA.title = GN
            }
            return GH.content.appendChild(GA)
        }
        GH.content.appendChild(GK)
    }
    function Fa(F6) {
        function F7(F8) {
            var F9 = " ";
            for (var GA = 0; GA < F8.length - 2; ++GA) {
                F9 += GA % 2 ? " " : "\u00a0"
            }
            F9 += " ";
            return F9
        }
        return function(F9, GD, GA, F8, GC, GB) {
            F6(F9, GD.replace(/ {3,}/g, F7), GA, F8, GC, GB)
        }
    }
    function v(F7, F6) {
        return function(GE, GG, F8, GC, GH, GF) {
            F8 = F8 ? F8 + " cm-force-border" : "cm-force-border";
            var F9 = GE.pos
              , GB = F9 + GG.length;
            for (; ; ) {
                for (var GD = 0; GD < F6.length; GD++) {
                    var GA = F6[GD];
                    if (GA.to > F9 && GA.from <= F9) {
                        break
                    }
                }
                if (GA.to >= GB) {
                    return F7(GE, GG, F8, GC, GH, GF)
                }
                F7(GE, GG.slice(0, GA.to - F9), F8, GC, null, GF);
                GC = null;
                GG = GG.slice(GA.to - F9);
                F9 = GA.to
            }
        }
    }
    function AB(F7, F9, F6, F8) {
        var GA = !F8 && F6.widgetNode;
        if (GA) {
            F7.map.push(F7.pos, F7.pos + F9, GA);
            F7.content.appendChild(GA)
        }
        F7.pos += F9
    }
    function BM(GF, GM, GE) {
        var GB = GF.markedSpans
          , GD = GF.text
          , GK = 0;
        if (!GB) {
            for (var GP = 1; GP < GE.length; GP += 2) {
                GM.addToken(GM, GD.slice(GK, GK = GE[GP]), Eq(GE[GP + 1], GM.cm.options))
            }
            return
        }
        var GQ = GD.length, GA = 0, GP = 1, GI = "", GR, GG;
        var GT = 0, F6, GS, GJ, GU, F8;
        for (; ; ) {
            if (GT == GA) {
                F6 = GS = GJ = GU = GG = "";
                F8 = null;
                GT = Infinity;
                var GC = [];
                for (var GN = 0; GN < GB.length; ++GN) {
                    var GO = GB[GN]
                      , GL = GO.marker;
                    if (GO.from <= GA && (GO.to == null || GO.to > GA)) {
                        if (GO.to != null && GT > GO.to) {
                            GT = GO.to;
                            GS = ""
                        }
                        if (GL.className) {
                            F6 += " " + GL.className
                        }
                        if (GL.css) {
                            GG = GL.css
                        }
                        if (GL.startStyle && GO.from == GA) {
                            GJ += " " + GL.startStyle
                        }
                        if (GL.endStyle && GO.to == GT) {
                            GS += " " + GL.endStyle
                        }
                        if (GL.title && !GU) {
                            GU = GL.title
                        }
                        if (GL.collapsed && (!F8 || Dk(F8.marker, GL) < 0)) {
                            F8 = GO
                        }
                    } else {
                        if (GO.from > GA && GT > GO.from) {
                            GT = GO.from
                        }
                    }
                    if (GL.type == "bookmark" && GO.from == GA && GL.widgetNode) {
                        GC.push(GL)
                    }
                }
                if (F8 && (F8.from || 0) == GA) {
                    AB(GM, (F8.to == null ? GQ + 1 : F8.to) - GA, F8.marker, F8.from == null);
                    if (F8.to == null) {
                        return
                    }
                }
                if (!F8 && GC.length) {
                    for (var GN = 0; GN < GC.length; ++GN) {
                        AB(GM, 0, GC[GN])
                    }
                }
            }
            if (GA >= GQ) {
                break
            }
            var GH = Math.min(GQ, GT);
            while (true) {
                if (GI) {
                    var F7 = GA + GI.length;
                    if (!F8) {
                        var F9 = F7 > GH ? GI.slice(0, GH - GA) : GI;
                        GM.addToken(GM, F9, GR ? GR + F6 : F6, GJ, GA + F9.length == GT ? GS : "", GU, GG)
                    }
                    if (F7 >= GH) {
                        GI = GI.slice(GH - GA);
                        GA = GH;
                        break
                    }
                    GA = F7;
                    GJ = ""
                }
                GI = GD.slice(GK, GK = GE[GP++]);
                GR = Eq(GE[GP++], GM.cm.options)
            }
        }
    }
    function Dm(F6, F7) {
        return F7.from.ch == 0 && F7.to.ch == 0 && Fc(F7.text) == "" && (!F6.cm || F6.cm.options.wholeLineUpdateBefore)
    }
    function FT(GJ, GE, F7, GA) {
        function GK(GM) {
            return F7 ? F7[GM] : null
        }
        function F8(GM, GO, GN) {
            EG(GM, GO, GN, GA);
            AD(GM, "change", GM, GE)
        }
        function F6(GP, GN) {
            for (var GO = GP, GM = []; GO < GN; ++GO) {
                GM.push(new Fv(GL[GO],GK(GO),GA))
            }
            return GM
        }
        var GI = GE.from
          , GH = GE.to
          , GL = GE.text;
        var GF = E9(GJ, GI.line)
          , GG = E9(GJ, GH.line);
        var GD = Fc(GL)
          , F9 = GK(GL.length - 1)
          , GC = GH.line - GI.line;
        if (GE.full) {
            GJ.insert(0, F6(0, GL.length));
            GJ.remove(GL.length, GJ.size - GL.length)
        } else {
            if (Dm(GJ, GE)) {
                var GB = F6(0, GL.length - 1);
                F8(GG, GG.text, F9);
                if (GC) {
                    GJ.remove(GI.line, GC)
                }
                if (GB.length) {
                    GJ.insert(GI.line, GB)
                }
            } else {
                if (GF == GG) {
                    if (GL.length == 1) {
                        F8(GF, GF.text.slice(0, GI.ch) + GD + GF.text.slice(GH.ch), F9)
                    } else {
                        var GB = F6(1, GL.length - 1);
                        GB.push(new Fv(GD + GF.text.slice(GH.ch),F9,GA));
                        F8(GF, GF.text.slice(0, GI.ch) + GL[0], GK(0));
                        GJ.insert(GI.line + 1, GB)
                    }
                } else {
                    if (GL.length == 1) {
                        F8(GF, GF.text.slice(0, GI.ch) + GL[0] + GG.text.slice(GH.ch), GK(0));
                        GJ.remove(GI.line + 1, GC)
                    } else {
                        F8(GF, GF.text.slice(0, GI.ch) + GL[0], GK(0));
                        F8(GG, GD + GG.text.slice(GH.ch), F9);
                        var GB = F6(1, GL.length - 1);
                        if (GC > 1) {
                            GJ.remove(GI.line + 1, GC - 1)
                        }
                        GJ.insert(GI.line + 1, GB)
                    }
                }
            }
        }
        AD(GJ, "change", GJ, GE)
    }
    function Et(F7) {
        this.lines = F7;
        this.parent = null;
        for (var F8 = 0, F6 = 0; F8 < F7.length; ++F8) {
            F7[F8].parent = this;
            F6 += F7[F8].height
        }
        this.height = F6
    }
    Et.prototype = {
        chunkSize: function() {
            return this.lines.length
        },
        removeInner: function(F6, GA) {
            for (var F8 = F6, F9 = F6 + GA; F8 < F9; ++F8) {
                var F7 = this.lines[F8];
                this.height -= F7.height;
                BZ(F7);
                AD(F7, "delete")
            }
            this.lines.splice(F6, GA)
        },
        collapse: function(F6) {
            F6.push.apply(F6, this.lines)
        },
        insertInner: function(F7, F8, F6) {
            this.height += F6;
            this.lines = this.lines.slice(0, F7).concat(F8).concat(this.lines.slice(F7));
            for (var F9 = 0; F9 < F8.length; ++F9) {
                F8[F9].parent = this
            }
        },
        iterN: function(F6, F9, F8) {
            for (var F7 = F6 + F9; F6 < F7; ++F6) {
                if (F8(this.lines[F6])) {
                    return true
                }
            }
        }
    };
    function FS(F9) {
        this.children = F9;
        var F8 = 0
          , F6 = 0;
        for (var F7 = 0; F7 < F9.length; ++F7) {
            var GA = F9[F7];
            F8 += GA.chunkSize();
            F6 += GA.height;
            GA.parent = this
        }
        this.size = F8;
        this.height = F6;
        this.parent = null
    }
    FS.prototype = {
        chunkSize: function() {
            return this.size
        },
        removeInner: function(F6, GD) {
            this.size -= GD;
            for (var F8 = 0; F8 < this.children.length; ++F8) {
                var GC = this.children[F8]
                  , GA = GC.chunkSize();
                if (F6 < GA) {
                    var F9 = Math.min(GD, GA - F6)
                      , GB = GC.height;
                    GC.removeInner(F6, F9);
                    this.height -= GB - GC.height;
                    if (GA == F9) {
                        this.children.splice(F8--, 1);
                        GC.parent = null
                    }
                    if ((GD -= F9) == 0) {
                        break
                    }
                    F6 = 0
                } else {
                    F6 -= GA
                }
            }
            if (this.size - GD < 25 && (this.children.length > 1 || !(this.children[0]instanceof Et))) {
                var F7 = [];
                this.collapse(F7);
                this.children = [new Et(F7)];
                this.children[0].parent = this
            }
        },
        collapse: function(F6) {
            for (var F7 = 0; F7 < this.children.length; ++F7) {
                this.children[F7].collapse(F6)
            }
        },
        insertInner: function(F7, F8, F6) {
            this.size += F8.length;
            this.height += F6;
            for (var GB = 0; GB < this.children.length; ++GB) {
                var GD = this.children[GB]
                  , GC = GD.chunkSize();
                if (F7 <= GC) {
                    GD.insertInner(F7, F8, F6);
                    if (GD.lines && GD.lines.length > 50) {
                        while (GD.lines.length > 50) {
                            var GA = GD.lines.splice(GD.lines.length - 25, 25);
                            var F9 = new Et(GA);
                            GD.height -= F9.height;
                            this.children.splice(GB + 1, 0, F9);
                            F9.parent = this
                        }
                        this.maybeSpill()
                    }
                    break
                }
                F7 -= GC
            }
        },
        maybeSpill: function() {
            if (this.children.length <= 10) {
                return
            }
            var F9 = this;
            do {
                var F7 = F9.children.splice(F9.children.length - 5, 5);
                var F8 = new FS(F7);
                if (!F9.parent) {
                    var GA = new FS(F9.children);
                    GA.parent = F9;
                    F9.children = [GA, F8];
                    F9 = GA
                } else {
                    F9.size -= F8.size;
                    F9.height -= F8.height;
                    var F6 = DE(F9.parent.children, F9);
                    F9.parent.children.splice(F6 + 1, 0, F8)
                }
                F8.parent = F9.parent
            } while (F9.children.length > 10);F9.parent.maybeSpill()
        },
        iterN: function(F6, GC, GB) {
            for (var F7 = 0; F7 < this.children.length; ++F7) {
                var GA = this.children[F7]
                  , F9 = GA.chunkSize();
                if (F6 < F9) {
                    var F8 = Math.min(GC, F9 - F6);
                    if (GA.iterN(F6, F8, GB)) {
                        return true
                    }
                    if ((GC -= F8) == 0) {
                        break
                    }
                    F6 = 0
                } else {
                    F6 -= F9
                }
            }
        }
    };
    var CQ = 0;
    var AR = i.Doc = function(F8, F7, F6) {
        if (!(this instanceof AR)) {
            return new AR(F8,F7,F6)
        }
        if (F6 == null) {
            F6 = 0
        }
        FS.call(this, [new Et([new Fv("",null)])]);
        this.first = F6;
        this.scrollTop = this.scrollLeft = 0;
        this.cantEdit = false;
        this.cleanGeneration = 1;
        this.frontier = F6;
        var F9 = x(F6, 0);
        this.sel = Em(F9);
        this.history = new Fn(null);
        this.id = ++CQ;
        this.modeOption = F7;
        if (typeof F8 == "string") {
            F8 = Aw(F8)
        }
        FT(this, {
            from: F9,
            to: F9,
            text: F8
        });
        Bs(this, Em(F9), z)
    }
    ;
    AR.prototype = CJ(FS.prototype, {
        constructor: AR,
        iter: function(F8, F7, F6) {
            if (F6) {
                this.iterN(F8 - this.first, F7 - F8, F6)
            } else {
                this.iterN(this.first, this.first + this.size, F8)
            }
        },
        insert: function(F7, F8) {
            var F6 = 0;
            for (var F9 = 0; F9 < F8.length; ++F9) {
                F6 += F8[F9].height
            }
            this.insertInner(F7 - this.first, F8, F6)
        },
        remove: function(F6, F7) {
            this.removeInner(F6 - this.first, F7)
        },
        getValue: function(F7) {
            var F6 = Ay(this, this.first, this.first + this.size);
            if (F7 === false) {
                return F6
            }
            return F6.join(F7 || "\n")
        },
        setValue: Cb(function(F7) {
            var F8 = x(this.first, 0)
              , F6 = this.first + this.size - 1;
            BC(this, {
                from: F8,
                to: x(F6, E9(this, F6).text.length),
                text: Aw(F7),
                origin: "setValue",
                full: true
            }, true);
            Bs(this, Em(F8))
        }),
        replaceRange: function(F7, F9, F8, F6) {
            F9 = Fe(this, F9);
            F8 = F8 ? Fe(this, F8) : F9;
            Ax(this, F7, F9, F8, F6)
        },
        getRange: function(F9, F8, F7) {
            var F6 = Ft(this, Fe(this, F9), Fe(this, F8));
            if (F7 === false) {
                return F6
            }
            return F6.join(F7 || "\n")
        },
        getLine: function(F7) {
            var F6 = this.getLineHandle(F7);
            return F6 && F6.text
        },
        getLineHandle: function(F6) {
            if (B7(this, F6)) {
                return E9(this, F6)
            }
        },
        getLineNumber: function(F6) {
            return Bl(F6)
        },
        getLineHandleVisualStart: function(F6) {
            if (typeof F6 == "number") {
                F6 = E9(this, F6)
            }
            return Y(F6)
        },
        lineCount: function() {
            return this.size
        },
        firstLine: function() {
            return this.first
        },
        lastLine: function() {
            return this.first + this.size - 1
        },
        clipPos: function(F6) {
            return Fe(this, F6)
        },
        getCursor: function(F8) {
            var F6 = this.sel.primary(), F7;
            if (F8 == null || F8 == "head") {
                F7 = F6.head
            } else {
                if (F8 == "anchor") {
                    F7 = F6.anchor
                } else {
                    if (F8 == "end" || F8 == "to" || F8 === false) {
                        F7 = F6.to()
                    } else {
                        F7 = F6.from()
                    }
                }
            }
            return F7
        },
        listSelections: function() {
            return this.sel.ranges
        },
        somethingSelected: function() {
            return this.sel.somethingSelected()
        },
        setCursor: Cb(function(F6, F8, F7) {
            g(this, Fe(this, typeof F6 == "number" ? x(F6, F8 || 0) : F6), null, F7)
        }),
        setSelection: Cb(function(F7, F8, F6) {
            g(this, Fe(this, F7), Fe(this, F8 || F7), F6)
        }),
        extendSelection: Cb(function(F8, F6, F7) {
            Fo(this, Fe(this, F8), F6 && Fe(this, F6), F7)
        }),
        extendSelections: Cb(function(F7, F6) {
            AU(this, Dt(this, F7, F6))
        }),
        extendSelectionsBy: Cb(function(F7, F6) {
            AU(this, Bq(this.sel.ranges, F7), F6)
        }),
        setSelections: Cb(function(F6, GA, F8) {
            if (!F6.length) {
                return
            }
            for (var F9 = 0, F7 = []; F9 < F6.length; F9++) {
                F7[F9] = new Ds(Fe(this, F6[F9].anchor),Fe(this, F6[F9].head))
            }
            if (GA == null) {
                GA = Math.min(F6.length - 1, this.sel.primIndex)
            }
            Bs(this, CV(F7, GA), F8)
        }),
        addSelection: Cb(function(F8, F9, F7) {
            var F6 = this.sel.ranges.slice(0);
            F6.push(new Ds(Fe(this, F8),Fe(this, F9 || F8)));
            Bs(this, CV(F6, F6.length - 1), F7)
        }),
        getSelection: function(GA) {
            var F7 = this.sel.ranges, F6;
            for (var F8 = 0; F8 < F7.length; F8++) {
                var F9 = Ft(this, F7[F8].from(), F7[F8].to());
                F6 = F6 ? F6.concat(F9) : F9
            }
            if (GA === false) {
                return F6
            } else {
                return F6.join(GA || "\n")
            }
        },
        getSelections: function(GA) {
            var F9 = []
              , F6 = this.sel.ranges;
            for (var F7 = 0; F7 < F6.length; F7++) {
                var F8 = Ft(this, F6[F7].from(), F6[F7].to());
                if (GA !== false) {
                    F8 = F8.join(GA || "\n")
                }
                F9[F7] = F8
            }
            return F9
        },
        replaceSelection: function(F8, GA, F6) {
            var F9 = [];
            for (var F7 = 0; F7 < this.sel.ranges.length; F7++) {
                F9[F7] = F8
            }
            this.replaceSelections(F9, GA, F6 || "+input")
        },
        replaceSelections: Cb(function(GB, GD, F8) {
            var GA = []
              , GC = this.sel;
            for (var F9 = 0; F9 < GC.ranges.length; F9++) {
                var F7 = GC.ranges[F9];
                GA[F9] = {
                    from: F7.from(),
                    to: F7.to(),
                    text: Aw(GB[F9]),
                    origin: F8
                }
            }
            var F6 = GD && GD != "end" && AE(this, GA, GD);
            for (var F9 = GA.length - 1; F9 >= 0; F9--) {
                BC(this, GA[F9])
            }
            if (F6) {
                E1(this, F6)
            } else {
                if (this.cm) {
                    Fb(this.cm)
                }
            }
        }),
        undo: Cb(function() {
            B6(this, "undo")
        }),
        redo: Cb(function() {
            B6(this, "redo")
        }),
        undoSelection: Cb(function() {
            B6(this, "undo", true)
        }),
        redoSelection: Cb(function() {
            B6(this, "redo", true)
        }),
        setExtending: function(F6) {
            this.extend = F6
        },
        getExtending: function() {
            return this.extend
        },
        historySize: function() {
            var F9 = this.history
              , F6 = 0
              , F8 = 0;
            for (var F7 = 0; F7 < F9.done.length; F7++) {
                if (!F9.done[F7].ranges) {
                    ++F6
                }
            }
            for (var F7 = 0; F7 < F9.undone.length; F7++) {
                if (!F9.undone[F7].ranges) {
                    ++F8
                }
            }
            return {
                undo: F6,
                redo: F8
            }
        },
        clearHistory: function() {
            this.history = new Fn(this.history.maxGeneration)
        },
        markClean: function() {
            this.cleanGeneration = this.changeGeneration(true)
        },
        changeGeneration: function(F6) {
            if (F6) {
                this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null
            }
            return this.history.generation
        },
        isClean: function(F6) {
            return this.history.generation == (F6 || this.cleanGeneration)
        },
        getHistory: function() {
            return {
                done: Bn(this.history.done),
                undone: Bn(this.history.undone)
            }
        },
        setHistory: function(F7) {
            var F6 = this.history = new Fn(this.history.maxGeneration);
            F6.done = Bn(F7.done.slice(0), null, true);
            F6.undone = Bn(F7.undone.slice(0), null, true)
        },
        addLineClass: Cb(function(F8, F7, F6) {
            return ES(this, F8, F7 == "gutter" ? "gutter" : "class", function(F9) {
                var GA = F7 == "text" ? "textClass" : F7 == "background" ? "bgClass" : F7 == "gutter" ? "gutterClass" : "wrapClass";
                if (!F9[GA]) {
                    F9[GA] = F6
                } else {
                    if (t(F6).test(F9[GA])) {
                        return false
                    } else {
                        F9[GA] += " " + F6
                    }
                }
                return true
            })
        }),
        removeLineClass: Cb(function(F8, F7, F6) {
            return ES(this, F8, F7 == "gutter" ? "gutter" : "class", function(GA) {
                var GD = F7 == "text" ? "textClass" : F7 == "background" ? "bgClass" : F7 == "gutter" ? "gutterClass" : "wrapClass";
                var GC = GA[GD];
                if (!GC) {
                    return false
                } else {
                    if (F6 == null) {
                        GA[GD] = null
                    } else {
                        var GB = GC.match(t(F6));
                        if (!GB) {
                            return false
                        }
                        var F9 = GB.index + GB[0].length;
                        GA[GD] = GC.slice(0, GB.index) + (!GB.index || F9 == GC.length ? "" : " ") + GC.slice(F9) || null
                    }
                }
                return true
            })
        }),
        markText: function(F8, F7, F6) {
            return EZ(this, Fe(this, F8), Fe(this, F7), F6, "range")
        },
        setBookmark: function(F8, F6) {
            var F7 = {
                replacedWith: F6 && (F6.nodeType == null ? F6.widget : F6),
                insertLeft: F6 && F6.insertLeft,
                clearWhenEmpty: false,
                shared: F6 && F6.shared
            };
            F8 = Fe(this, F8);
            return EZ(this, F8, F8, F7, "bookmark")
        },
        findMarksAt: function(GA) {
            GA = Fe(this, GA);
            var F9 = []
              , F7 = E9(this, GA.line).markedSpans;
            if (F7) {
                for (var F6 = 0; F6 < F7.length; ++F6) {
                    var F8 = F7[F6];
                    if ((F8.from == null || F8.from <= GA.ch) && (F8.to == null || F8.to >= GA.ch)) {
                        F9.push(F8.marker.parent || F8.marker)
                    }
                }
            }
            return F9
        },
        findMarks: function(GA, F9, F6) {
            GA = Fe(this, GA);
            F9 = Fe(this, F9);
            var F7 = []
              , F8 = GA.line;
            this.iter(GA.line, F9.line + 1, function(GB) {
                var GD = GB.markedSpans;
                if (GD) {
                    for (var GC = 0; GC < GD.length; GC++) {
                        var GE = GD[GC];
                        if (!(F8 == GA.line && GA.ch > GE.to || GE.from == null && F8 != GA.line || F8 == F9.line && GE.from > F9.ch) && (!F6 || F6(GE.marker))) {
                            F7.push(GE.marker.parent || GE.marker)
                        }
                    }
                }
                ++F8
            });
            return F7
        },
        getAllMarks: function() {
            var F6 = [];
            this.iter(function(F8) {
                var F7 = F8.markedSpans;
                if (F7) {
                    for (var F9 = 0; F9 < F7.length; ++F9) {
                        if (F7[F9].from != null) {
                            F6.push(F7[F9].marker)
                        }
                    }
                }
            });
            return F6
        },
        posFromIndex: function(F7) {
            var F6, F8 = this.first;
            this.iter(function(F9) {
                var GA = F9.text.length + 1;
                if (GA > F7) {
                    F6 = F7;
                    return true
                }
                F7 -= GA;
                ++F8
            });
            return Fe(this, x(F8, F6))
        },
        indexFromPos: function(F7) {
            F7 = Fe(this, F7);
            var F6 = F7.ch;
            if (F7.line < this.first || F7.ch < 0) {
                return 0
            }
            this.iter(this.first, F7.line, function(F8) {
                F6 += F8.text.length + 1
            });
            return F6
        },
        copy: function(F6) {
            var F7 = new AR(Ay(this, this.first, this.first + this.size),this.modeOption,this.first);
            F7.scrollTop = this.scrollTop;
            F7.scrollLeft = this.scrollLeft;
            F7.sel = this.sel;
            F7.extend = false;
            if (F6) {
                F7.history.undoDepth = this.history.undoDepth;
                F7.setHistory(this.getHistory())
            }
            return F7
        },
        linkedDoc: function(F6) {
            if (!F6) {
                F6 = {}
            }
            var F9 = this.first
              , F8 = this.first + this.size;
            if (F6.from != null && F6.from > F9) {
                F9 = F6.from
            }
            if (F6.to != null && F6.to < F8) {
                F8 = F6.to
            }
            var F7 = new AR(Ay(this, F9, F8),F6.mode || this.modeOption,F9);
            if (F6.sharedHist) {
                F7.history = this.history
            }
            (this.linked || (this.linked = [])).push({
                doc: F7,
                sharedHist: F6.sharedHist
            });
            F7.linked = [{
                doc: this,
                isParent: true,
                sharedHist: F6.sharedHist
            }];
            DZ(F7, Ej(this));
            return F7
        },
        unlinkDoc: function(F7) {
            if (F7 instanceof i) {
                F7 = F7.doc
            }
            if (this.linked) {
                for (var F8 = 0; F8 < this.linked.length; ++F8) {
                    var F9 = this.linked[F8];
                    if (F9.doc != F7) {
                        continue
                    }
                    this.linked.splice(F8, 1);
                    F7.unlinkDoc(this);
                    EI(Ej(this));
                    break
                }
            }
            if (F7.history == this.history) {
                var F6 = [F7.id];
                D1(F7, function(GA) {
                    F6.push(GA.id)
                }, true);
                F7.history = new Fn(null);
                F7.history.done = Bn(this.history.done, F6);
                F7.history.undone = Bn(this.history.undone, F6)
            }
        },
        iterLinkedDocs: function(F6) {
            D1(this, F6)
        },
        getMode: function() {
            return this.mode
        },
        getEditor: function() {
            return this.cm
        }
    });
    AR.prototype.eachLine = AR.prototype.iter;
    var D = "iter insert remove copy getEditor".split(" ");
    for (var Bi in AR.prototype) {
        if (AR.prototype.hasOwnProperty(Bi) && DE(D, Bi) < 0) {
            i.prototype[Bi] = (function(F6) {
                return function() {
                    return F6.apply(this.doc, arguments)
                }
            })(AR.prototype[Bi])
        }
    }
    BW(AR);
    function D1(F9, F8, F7) {
        function F6(GF, GD, GB) {
            if (GF.linked) {
                for (var GC = 0; GC < GF.linked.length; ++GC) {
                    var GA = GF.linked[GC];
                    if (GA.doc == GD) {
                        continue
                    }
                    var GE = GB && GA.sharedHist;
                    if (F7 && !GE) {
                        continue
                    }
                    F8(GA.doc, GE);
                    F6(GA.doc, GF, GE)
                }
            }
        }
        F6(F9, null, true)
    }
    function D5(F6, F7) {
        if (F7.cm) {
            throw new Error("This document is already in use.")
        }
        F6.doc = F7;
        F7.cm = F6;
        y(F6);
        BP(F6);
        if (!F6.options.lineWrapping) {
            G(F6)
        }
        F6.options.mode = F7.modeOption;
        AG(F6)
    }
    function E9(F9, GB) {
        GB -= F9.first;
        if (GB < 0 || GB >= F9.size) {
            throw new Error("There is no line " + (GB + F9.first) + " in the document.")
        }
        for (var F6 = F9; !F6.lines; ) {
            for (var F7 = 0; ; ++F7) {
                var GA = F6.children[F7]
                  , F8 = GA.chunkSize();
                if (GB < F8) {
                    F6 = GA;
                    break
                }
                GB -= F8
            }
        }
        return F6.lines[GB]
    }
    function Ft(F8, GA, F6) {
        var F7 = []
          , F9 = GA.line;
        F8.iter(GA.line, F6.line + 1, function(GB) {
            var GC = GB.text;
            if (F9 == F6.line) {
                GC = GC.slice(0, F6.ch)
            }
            if (F9 == GA.line) {
                GC = GC.slice(GA.ch)
            }
            F7.push(GC);
            ++F9
        });
        return F7
    }
    function Ay(F7, F9, F8) {
        var F6 = [];
        F7.iter(F9, F8, function(GA) {
            F6.push(GA.text)
        });
        return F6
    }
    function Fu(F7, F6) {
        var F8 = F6 - F7.height;
        if (F8) {
            for (var F9 = F7; F9; F9 = F9.parent) {
                F9.height += F8
            }
        }
    }
    function Bl(F6) {
        if (F6.parent == null) {
            return null
        }
        var GA = F6.parent
          , F9 = DE(GA.lines, F6);
        for (var F7 = GA.parent; F7; GA = F7,
        F7 = F7.parent) {
            for (var F8 = 0; ; ++F8) {
                if (F7.children[F8] == GA) {
                    break
                }
                F9 += F7.children[F8].chunkSize()
            }
        }
        return F9 + GA.first
    }
    function Be(F8, GB) {
        var GD = F8.first;
        outer: do {
            for (var F9 = 0; F9 < F8.children.length; ++F9) {
                var GC = F8.children[F9]
                  , GA = GC.height;
                if (GB < GA) {
                    F8 = GC;
                    continue outer
                }
                GB -= GA;
                GD += GC.chunkSize()
            }
            return GD
        } while (!F8.lines);for (var F9 = 0; F9 < F8.lines.length; ++F9) {
            var F7 = F8.lines[F9]
              , F6 = F7.height;
            if (GB < F6) {
                break
            }
            GB -= F6
        }
        return GD + F9
    }
    function Bk(F8) {
        F8 = Y(F8);
        var GA = 0
          , F7 = F8.parent;
        for (var F9 = 0; F9 < F7.lines.length; ++F9) {
            var F6 = F7.lines[F9];
            if (F6 == F8) {
                break
            } else {
                GA += F6.height
            }
        }
        for (var GB = F7.parent; GB; F7 = GB,
        GB = F7.parent) {
            for (var F9 = 0; F9 < GB.children.length; ++F9) {
                var GC = GB.children[F9];
                if (GC == F7) {
                    break
                } else {
                    GA += GC.height
                }
            }
        }
        return GA
    }
    function A(F7) {
        var F6 = F7.order;
        if (F6 == null) {
            F6 = F7.order = BD(F7.text)
        }
        return F6
    }
    function Fn(F6) {
        this.done = [];
        this.undone = [];
        this.undoDepth = Infinity;
        this.lastModTime = this.lastSelTime = 0;
        this.lastOp = this.lastSelOp = null;
        this.lastOrigin = this.lastSelOrigin = null;
        this.generation = this.maxGeneration = F6 || 1
    }
    function DP(F6, F8) {
        var F7 = {
            from: CH(F8.from),
            to: Cu(F8),
            text: Ft(F6, F8.from, F8.to)
        };
        Bw(F6, F7, F8.from.line, F8.to.line + 1);
        D1(F6, function(F9) {
            Bw(F9, F7, F8.from.line, F8.to.line + 1)
        }, true);
        return F7
    }
    function FW(F7) {
        while (F7.length) {
            var F6 = Fc(F7);
            if (F6.ranges) {
                F7.pop()
            } else {
                break
            }
        }
    }
    function Eg(F7, F6) {
        if (F6) {
            FW(F7.done);
            return Fc(F7.done)
        } else {
            if (F7.done.length && !Fc(F7.done).ranges) {
                return Fc(F7.done)
            } else {
                if (F7.done.length > 1 && !F7.done[F7.done.length - 2].ranges) {
                    F7.done.pop();
                    return Fc(F7.done)
                }
            }
        }
    }
    function Fh(GC, GA, F6, F9) {
        var F8 = GC.history;
        F8.undone.length = 0;
        var F7 = +new Date, GD;
        if ((F8.lastOp == F9 || F8.lastOrigin == GA.origin && GA.origin && ((GA.origin.charAt(0) == "+" && GC.cm && F8.lastModTime > F7 - GC.cm.options.historyEventDelay) || GA.origin.charAt(0) == "*")) && (GD = Eg(F8, F8.lastOp == F9))) {
            var GE = Fc(GD.changes);
            if (CD(GA.from, GA.to) == 0 && CD(GA.from, GE.to) == 0) {
                GE.to = Cu(GA)
            } else {
                GD.changes.push(DP(GC, GA))
            }
        } else {
            var GB = Fc(F8.done);
            if (!GB || !GB.ranges) {
                Ck(GC.sel, F8.done)
            }
            GD = {
                changes: [DP(GC, GA)],
                generation: F8.generation
            };
            F8.done.push(GD);
            while (F8.done.length > F8.undoDepth) {
                F8.done.shift();
                if (!F8.done[0].ranges) {
                    F8.done.shift()
                }
            }
        }
        F8.done.push(F6);
        F8.generation = ++F8.maxGeneration;
        F8.lastModTime = F8.lastSelTime = F7;
        F8.lastOp = F8.lastSelOp = F9;
        F8.lastOrigin = F8.lastSelOrigin = GA.origin;
        if (!GE) {
            Ab(GC, "historyAdded")
        }
    }
    function BY(GA, F6, F8, F9) {
        var F7 = F6.charAt(0);
        return F7 == "*" || F7 == "+" && F8.ranges.length == F9.ranges.length && F8.somethingSelected() == F9.somethingSelected() && new Date - GA.history.lastSelTime <= (GA.cm ? GA.cm.options.historyEventDelay : 500)
    }
    function F0(GB, F9, F6, F8) {
        var GA = GB.history
          , F7 = F8 && F8.origin;
        if (F6 == GA.lastSelOp || (F7 && GA.lastSelOrigin == F7 && (GA.lastModTime == GA.lastSelTime && GA.lastOrigin == F7 || BY(GB, F7, Fc(GA.done), F9)))) {
            GA.done[GA.done.length - 1] = F9
        } else {
            Ck(F9, GA.done)
        }
        GA.lastSelTime = +new Date;
        GA.lastSelOrigin = F7;
        GA.lastSelOp = F6;
        if (F8 && F8.clearRedo !== false) {
            FW(GA.undone)
        }
    }
    function Ck(F7, F6) {
        var F8 = Fc(F6);
        if (!(F8 && F8.ranges && F8.equals(F7))) {
            F6.push(F7)
        }
    }
    function Bw(F7, GB, GA, F9) {
        var F6 = GB["spans_" + F7.id]
          , F8 = 0;
        F7.iter(Math.max(F7.first, GA), Math.min(F7.first + F7.size, F9), function(GC) {
            if (GC.markedSpans) {
                (F6 || (F6 = GB["spans_" + F7.id] = {}))[F8] = GC.markedSpans
            }
            ++F8
        })
    }
    function BH(F8) {
        if (!F8) {
            return null
        }
        for (var F7 = 0, F6; F7 < F8.length; ++F7) {
            if (F8[F7].marker.explicitlyCleared) {
                if (!F6) {
                    F6 = F8.slice(0, F7)
                }
            } else {
                if (F6) {
                    F6.push(F8[F7])
                }
            }
        }
        return !F6 ? F8 : F6.length ? F6 : null
    }
    function B2(F9, GA) {
        var F8 = GA["spans_" + F9.id];
        if (!F8) {
            return null
        }
        for (var F7 = 0, F6 = []; F7 < GA.text.length; ++F7) {
            F6.push(BH(F8[F7]))
        }
        return F6
    }
    function Bn(GH, F9, GG) {
        for (var GC = 0, F7 = []; GC < GH.length; ++GC) {
            var F8 = GH[GC];
            if (F8.ranges) {
                F7.push(GG ? Fs.prototype.deepCopy.call(F8) : F8);
                continue
            }
            var GE = F8.changes
              , GF = [];
            F7.push({
                changes: GF
            });
            for (var GB = 0; GB < GE.length; ++GB) {
                var GD = GE[GB], GA;
                GF.push({
                    from: GD.from,
                    to: GD.to,
                    text: GD.text
                });
                if (F9) {
                    for (var F6 in GD) {
                        if (GA = F6.match(/^spans_(\d+)$/)) {
                            if (DE(F9, Number(GA[1])) > -1) {
                                Fc(GF)[F6] = GD[F6];
                                delete GD[F6]
                            }
                        }
                    }
                }
            }
        }
        return F7
    }
    function j(F9, F8, F7, F6) {
        if (F7 < F9.line) {
            F9.line += F6
        } else {
            if (F8 < F9.line) {
                F9.line = F8;
                F9.ch = 0
            }
        }
    }
    function FB(F9, GB, GC, GD) {
        for (var F8 = 0; F8 < F9.length; ++F8) {
            var F6 = F9[F8]
              , GA = true;
            if (F6.ranges) {
                if (!F6.copied) {
                    F6 = F9[F8] = F6.deepCopy();
                    F6.copied = true
                }
                for (var F7 = 0; F7 < F6.ranges.length; F7++) {
                    j(F6.ranges[F7].anchor, GB, GC, GD);
                    j(F6.ranges[F7].head, GB, GC, GD)
                }
                continue
            }
            for (var F7 = 0; F7 < F6.changes.length; ++F7) {
                var GE = F6.changes[F7];
                if (GC < GE.from.line) {
                    GE.from = x(GE.from.line + GD, GE.from.ch);
                    GE.to = x(GE.to.line + GD, GE.to.ch)
                } else {
                    if (GB <= GE.to.line) {
                        GA = false;
                        break
                    }
                }
            }
            if (!GA) {
                F9.splice(0, F8 + 1);
                F8 = 0
            }
        }
    }
    function DY(F7, GA) {
        var F9 = GA.from.line
          , F8 = GA.to.line
          , F6 = GA.text.length - (F8 - F9) - 1;
        FB(F7.done, F9, F8, F6);
        FB(F7.undone, F9, F8, F6)
    }
    var Cd = i.e_preventDefault = function(F6) {
        if (F6.preventDefault) {
            F6.preventDefault()
        } else {
            F6.returnValue = false
        }
    }
    ;
    var DL = i.e_stopPropagation = function(F6) {
        if (F6.stopPropagation) {
            F6.stopPropagation()
        } else {
            F6.cancelBubble = true
        }
    }
    ;
    function Bj(F6) {
        return F6.defaultPrevented != null ? F6.defaultPrevented : F6.returnValue == false
    }
    var EL = i.e_stop = function(F6) {
        Cd(F6);
        DL(F6)
    }
    ;
    function m(F6) {
        return F6.target || F6.srcElement
    }
    function Fi(F7) {
        var F6 = F7.which;
        if (F6 == null) {
            if (F7.button & 1) {
                F6 = 1
            } else {
                if (F7.button & 2) {
                    F6 = 3
                } else {
                    if (F7.button & 4) {
                        F6 = 2
                    }
                }
            }
        }
        if (B5 && F7.ctrlKey && F6 == 1) {
            F6 = 3
        }
        return F6
    }
    var Bv = i.on = function(F9, F7, F8) {
        if (F9.addEventListener) {
            F9.addEventListener(F7, F8, false)
        } else {
            if (F9.attachEvent) {
                F9.attachEvent("on" + F7, F8)
            } else {
                var GA = F9._handlers || (F9._handlers = {});
                var F6 = GA[F7] || (GA[F7] = []);
                F6.push(F8)
            }
        }
    }
    ;
    var D7 = i.off = function(GA, F8, F9) {
        if (GA.removeEventListener) {
            GA.removeEventListener(F8, F9, false)
        } else {
            if (GA.detachEvent) {
                GA.detachEvent("on" + F8, F9)
            } else {
                var F6 = GA._handlers && GA._handlers[F8];
                if (!F6) {
                    return
                }
                for (var F7 = 0; F7 < F6.length; ++F7) {
                    if (F6[F7] == F9) {
                        F6.splice(F7, 1);
                        break
                    }
                }
            }
        }
    }
    ;
    var Ab = i.signal = function(GA, F9) {
        var F6 = GA._handlers && GA._handlers[F9];
        if (!F6) {
            return
        }
        var F7 = Array.prototype.slice.call(arguments, 2);
        for (var F8 = 0; F8 < F6.length; ++F8) {
            F6[F8].apply(null, F7)
        }
    }
    ;
    var BX = null;
    function AD(GC, GA) {
        var F6 = GC._handlers && GC._handlers[GA];
        if (!F6) {
            return
        }
        var F8 = Array.prototype.slice.call(arguments, 2), GB;
        if (BN) {
            GB = BN.delayedCallbacks
        } else {
            if (BX) {
                GB = BX
            } else {
                GB = BX = [];
                setTimeout(Ai, 0)
            }
        }
        function F7(GD) {
            return function() {
                GD.apply(null, F8)
            }
        }
        for (var F9 = 0; F9 < F6.length; ++F9) {
            GB.push(F7(F6[F9]))
        }
    }
    function Ai() {
        var F6 = BX;
        BX = null;
        for (var F7 = 0; F7 < F6.length; ++F7) {
            F6[F7]()
        }
    }
    function An(F6, F8, F7) {
        if (typeof F8 == "string") {
            F8 = {
                type: F8,
                preventDefault: function() {
                    this.defaultPrevented = true
                }
            }
        }
        Ab(F6, F7 || F8.type, F6, F8);
        return Bj(F8) || F8.codemirrorIgnore
    }
    function w(F7) {
        var F6 = F7._handlers && F7._handlers.cursorActivity;
        if (!F6) {
            return
        }
        var F9 = F7.curOp.cursorActivityHandlers || (F7.curOp.cursorActivityHandlers = []);
        for (var F8 = 0; F8 < F6.length; ++F8) {
            if (DE(F9, F6[F8]) == -1) {
                F9.push(F6[F8])
            }
        }
    }
    function FC(F8, F7) {
        var F6 = F8._handlers && F8._handlers[F7];
        return F6 && F6.length > 0
    }
    function BW(F6) {
        F6.prototype.on = function(F7, F8) {
            Bv(this, F7, F8)
        }
        ;
        F6.prototype.off = function(F7, F8) {
            D7(this, F7, F8)
        }
    }
    var Dd = 30;
    var B8 = i.Pass = {
        toString: function() {
            return "CodeMirror.Pass"
        }
    };
    var z = {
        scroll: false
    }
      , n = {
        origin: "*mouse"
    }
      , Ct = {
        origin: "+move"
    };
    function F5() {
        this.id = null
    }
    F5.prototype.set = function(F6, F7) {
        clearTimeout(this.id);
        this.id = setTimeout(F7, F6)
    }
    ;
    var Br = i.countColumn = function(F9, F7, GB, GC, F8) {
        if (F7 == null) {
            F7 = F9.search(/[^\s\u00a0]/);
            if (F7 == -1) {
                F7 = F9.length
            }
        }
        for (var GA = GC || 0, GD = F8 || 0; ; ) {
            var F6 = F9.indexOf("\t", GA);
            if (F6 < 0 || F6 >= F7) {
                return GD + (F7 - GA)
            }
            GD += F6 - GA;
            GD += GB - (GD % GB);
            GA = F6 + 1
        }
    }
    ;
    function EK(GA, F9, GB) {
        for (var GC = 0, F8 = 0; ; ) {
            var F7 = GA.indexOf("\t", GC);
            if (F7 == -1) {
                F7 = GA.length
            }
            var F6 = F7 - GC;
            if (F7 == GA.length || F8 + F6 >= F9) {
                return GC + Math.min(F6, F9 - F8)
            }
            F8 += F7 - GC;
            F8 += GB - (F8 % GB);
            GC = F7 + 1;
            if (F8 >= F9) {
                return GC
            }
        }
    }
    var Av = [""];
    function CO(F6) {
        while (Av.length <= F6) {
            Av.push(Fc(Av) + " ")
        }
        return Av[F6]
    }
    function Fc(F6) {
        return F6[F6.length - 1]
    }
    var Df = function(F6) {
        F6.select()
    };
    if (Ev) {
        Df = function(F6) {
            F6.selectionStart = 0;
            F6.selectionEnd = F6.value.length
        }
    } else {
        if (De) {
            Df = function(F7) {
                try {
                    F7.select()
                } catch (F6) {}
            }
        }
    }
    function DE(F8, F6) {
        for (var F7 = 0; F7 < F8.length; ++F7) {
            if (F8[F7] == F6) {
                return F7
            }
        }
        return -1
    }
    function Bq(F9, F8) {
        var F6 = [];
        for (var F7 = 0; F7 < F9.length; F7++) {
            F6[F7] = F8(F9[F7], F7)
        }
        return F6
    }
    function CJ(F9, F6) {
        var F8;
        if (Object.create) {
            F8 = Object.create(F9)
        } else {
            var F7 = function() {};
            F7.prototype = F9;
            F8 = new F7()
        }
        if (F6) {
            Aj(F6, F8)
        }
        return F8
    }
    function Aj(F8, F7, F6) {
        if (!F7) {
            F7 = {}
        }
        for (var F9 in F8) {
            if (F8.hasOwnProperty(F9) && (F6 !== false || !F7.hasOwnProperty(F9))) {
                F7[F9] = F8[F9]
            }
        }
        return F7
    }
    function CU(F7) {
        var F6 = Array.prototype.slice.call(arguments, 1);
        return function() {
            return F7.apply(null, F6)
        }
    }
    var A8 = /[\u00df\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
    var FY = i.isWordChar = function(F6) {
        return /\w/.test(F6) || F6 > "\x80" && (F6.toUpperCase() != F6.toLowerCase() || A8.test(F6))
    }
    ;
    function CY(F6, F7) {
        if (!F7) {
            return FY(F6)
        }
        if (F7.source.indexOf("\\w") > -1 && FY(F6)) {
            return true
        }
        return F7.test(F6)
    }
    function Eo(F6) {
        for (var F7 in F6) {
            if (F6.hasOwnProperty(F7) && F6[F7]) {
                return false
            }
        }
        return true
    }
    var Ed = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
    function FK(F6) {
        return F6.charCodeAt(0) >= 768 && Ed.test(F6)
    }
    function Fr(F6, GA, F9, F8) {
        var GB = document.createElement(F6);
        if (F9) {
            GB.className = F9
        }
        if (F8) {
            GB.style.cssText = F8
        }
        if (typeof GA == "string") {
            GB.appendChild(document.createTextNode(GA))
        } else {
            if (GA) {
                for (var F7 = 0; F7 < GA.length; ++F7) {
                    GB.appendChild(GA[F7])
                }
            }
        }
        return GB
    }
    var CK;
    if (document.createRange) {
        CK = function(F8, F9, F6) {
            var F7 = document.createRange();
            F7.setEnd(F8, F6);
            F7.setStart(F8, F9);
            return F7
        }
    } else {
        CK = function(F8, GA, F6) {
            var F7 = document.body.createTextRange();
            try {
                F7.moveToElementText(F8.parentNode)
            } catch (F9) {
                return F7
            }
            F7.collapse(true);
            F7.moveEnd("character", F6);
            F7.moveStart("character", GA);
            return F7
        }
    }
    function Dv(F7) {
        for (var F6 = F7.childNodes.length; F6 > 0; --F6) {
            F7.removeChild(F7.firstChild)
        }
        return F7
    }
    function Bp(F6, F7) {
        return Dv(F6).appendChild(F7)
    }
    function Fz(F6, F7) {
        if (F6.contains) {
            return F6.contains(F7)
        }
        while (F7 = F7.parentNode) {
            if (F7 == F6) {
                return true
            }
        }
    }
    function Di() {
        return document.activeElement
    }
    if (De && K < 11) {
        Di = function() {
            try {
                return document.activeElement
            } catch (F6) {
                return document.body
            }
        }
    }
    function t(F6) {
        return new RegExp("(^|\\s)" + F6 + "(?:$|\\s)\\s*")
    }
    var F = i.rmClass = function(F8, F6) {
        var F9 = F8.className;
        var F7 = t(F6).exec(F9);
        if (F7) {
            var GA = F9.slice(F7.index + F7[0].length);
            F8.className = F9.slice(0, F7.index) + (GA ? F7[1] + GA : "")
        }
    }
    ;
    var FV = i.addClass = function(F7, F6) {
        var F8 = F7.className;
        if (!t(F6).test(F8)) {
            F7.className += (F8 ? " " : "") + F6
        }
    }
    ;
    function Fm(F8, F6) {
        var F7 = F8.split(" ");
        for (var F9 = 0; F9 < F7.length; F9++) {
            if (F7[F9] && !t(F7[F9]).test(F6)) {
                F6 += " " + F7[F9]
            }
        }
        return F6
    }
    function AX(F9) {
        if (!document.body.getElementsByClassName) {
            return
        }
        var F8 = document.body.getElementsByClassName("CodeMirror");
        for (var F7 = 0; F7 < F8.length; F7++) {
            var F6 = F8[F7].CodeMirror;
            if (F6) {
                F9(F6)
            }
        }
    }
    var Ca = false;
    function BF() {
        if (Ca) {
            return
        }
        FZ();
        Ca = true
    }
    function FZ() {
        var F6;
        Bv(window, "resize", function() {
            if (F6 == null) {
                F6 = setTimeout(function() {
                    F6 = null;
                    AX(Ap)
                }, 100)
            }
        });
        Bv(window, "blur", function() {
            AX(Ar)
        })
    }
    var Ef = function() {
        if (De && K < 9) {
            return false
        }
        var F6 = Fr("div");
        return "draggable"in F6 || "dragDrop"in F6
    }();
    var Fg;
    function BL(F6) {
        if (Fg == null) {
            var F7 = Fr("span", "\u200b");
            Bp(F6, Fr("span", [F7, document.createTextNode("x")]));
            if (F6.firstChild.offsetHeight != 0) {
                Fg = F7.offsetWidth <= 1 && F7.offsetHeight > 2 && !(De && K < 8)
            }
        }
        if (Fg) {
            return Fr("span", "\u200b")
        } else {
            return Fr("span", "\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px")
        }
    }
    var Ff;
    function Bm(F9) {
        if (Ff != null) {
            return Ff
        }
        var F6 = Bp(F9, document.createTextNode("A\u062eA"));
        var F8 = CK(F6, 0, 1).getBoundingClientRect();
        if (!F8 || F8.left == F8.right) {
            return false
        }
        var F7 = CK(F6, 1, 2).getBoundingClientRect();
        return Ff = (F7.right - F8.right < 3)
    }
    var Aw = i.splitLines = "\n\nb".split(/\n/).length != 3 ? function(GB) {
        var GC = 0
          , F6 = []
          , GA = GB.length;
        while (GC <= GA) {
            var F9 = GB.indexOf("\n", GC);
            if (F9 == -1) {
                F9 = GB.length
            }
            var F8 = GB.slice(GC, GB.charAt(F9 - 1) == "\r" ? F9 - 1 : F9);
            var F7 = F8.indexOf("\r");
            if (F7 != -1) {
                F6.push(F8.slice(0, F7));
                GC += F7 + 1
            } else {
                F6.push(F8);
                GC = F9 + 1
            }
        }
        return F6
    }
    : function(F6) {
        return F6.split(/\r\n?|\n/)
    }
    ;
    var BQ = window.getSelection ? function(F7) {
        try {
            return F7.selectionStart != F7.selectionEnd
        } catch (F6) {
            return false
        }
    }
    : function(F8) {
        try {
            var F6 = F8.ownerDocument.selection.createRange()
        } catch (F7) {}
        if (!F6 || F6.parentElement() != F8) {
            return false
        }
        return F6.compareEndPoints("StartToEnd", F6) != 0
    }
    ;
    var C7 = (function() {
        var F6 = Fr("div");
        if ("oncopy"in F6) {
            return true
        }
        F6.setAttribute("oncopy", "return;");
        return typeof F6.oncopy == "function"
    })();
    var E0 = null;
    function Ah(F7) {
        if (E0 != null) {
            return E0
        }
        var F8 = Bp(F7, Fr("span", "x"));
        var F9 = F8.getBoundingClientRect();
        var F6 = CK(F8, 0, 1).getBoundingClientRect();
        return E0 = Math.abs(F9.left - F6.left) > 1
    }
    var FA = {
        3: "Enter",
        8: "Backspace",
        9: "Tab",
        13: "Enter",
        16: "Shift",
        17: "Ctrl",
        18: "Alt",
        19: "Pause",
        20: "CapsLock",
        27: "Esc",
        32: "Space",
        33: "PageUp",
        34: "PageDown",
        35: "End",
        36: "Home",
        37: "Left",
        38: "Up",
        39: "Right",
        40: "Down",
        44: "PrintScrn",
        45: "Insert",
        46: "Delete",
        59: ";",
        61: "=",
        91: "Mod",
        92: "Mod",
        93: "Mod",
        107: "=",
        109: "-",
        127: "Delete",
        173: "-",
        186: ";",
        187: "=",
        188: ",",
        189: "-",
        190: ".",
        191: "/",
        192: "`",
        219: "[",
        220: "\\",
        221: "]",
        222: "'",
        63232: "Up",
        63233: "Down",
        63234: "Left",
        63235: "Right",
        63272: "Delete",
        63273: "Home",
        63275: "End",
        63276: "PageUp",
        63277: "PageDown",
        63302: "Insert"
    };
    i.keyNames = FA;
    (function() {
        for (var F6 = 0; F6 < 10; F6++) {
            FA[F6 + 48] = FA[F6 + 96] = String(F6)
        }
        for (var F6 = 65; F6 <= 90; F6++) {
            FA[F6] = String.fromCharCode(F6)
        }
        for (var F6 = 1; F6 <= 12; F6++) {
            FA[F6 + 111] = FA[F6 + 63235] = "F" + F6
        }
    })();
    function Dy(F6, GC, GB, GA) {
        if (!F6) {
            return GA(GC, GB, "ltr")
        }
        var F9 = false;
        for (var F8 = 0; F8 < F6.length; ++F8) {
            var F7 = F6[F8];
            if (F7.from < GB && F7.to > GC || GC == GB && F7.to == GC) {
                GA(Math.max(F7.from, GC), Math.min(F7.to, GB), F7.level == 1 ? "rtl" : "ltr");
                F9 = true
            }
        }
        if (!F9) {
            GA(GC, GB, "ltr")
        }
    }
    function DS(F6) {
        return F6.level % 2 ? F6.to : F6.from
    }
    function F2(F6) {
        return F6.level % 2 ? F6.from : F6.to
    }
    function Cc(F7) {
        var F6 = A(F7);
        return F6 ? DS(F6[0]) : 0
    }
    function Cp(F7) {
        var F6 = A(F7);
        if (!F6) {
            return F7.text.length
        }
        return F2(Fc(F6))
    }
    function BR(F7, GA) {
        var F8 = E9(F7.doc, GA);
        var GB = Y(F8);
        if (GB != F8) {
            GA = Bl(GB)
        }
        var F6 = A(GB);
        var F9 = !F6 ? 0 : F6[0].level % 2 ? Cp(GB) : Cc(GB);
        return x(GA, F9)
    }
    function Dj(F8, GB) {
        var F7, F9 = E9(F8.doc, GB);
        while (F7 = EP(F9)) {
            F9 = F7.find(1, true).line;
            GB = null
        }
        var F6 = A(F9);
        var GA = !F6 ? F9.text.length : F6[0].level % 2 ? Cc(F9) : Cp(F9);
        return x(GB == null ? Bl(F9) : GB, GA)
    }
    function Dc(F7, GC) {
        var GB = BR(F7, GC.line);
        var F8 = E9(F7.doc, GB.line);
        var F6 = A(F8);
        if (!F6 || F6[0].level == 0) {
            var GA = Math.max(0, F8.text.search(/\S/));
            var F9 = GC.line == GB.line && GC.ch <= GA && GC.ch;
            return x(GB.line, F9 ? 0 : GA)
        }
        return GB
    }
    function AM(F7, F8, F6) {
        var F9 = F7[0].level;
        if (F8 == F9) {
            return true
        }
        if (F6 == F9) {
            return false
        }
        return F8 < F6
    }
    var Ew;
    function Ad(F6, GA) {
        Ew = null;
        for (var F7 = 0, F8; F7 < F6.length; ++F7) {
            var F9 = F6[F7];
            if (F9.from < GA && F9.to > GA) {
                return F7
            }
            if ((F9.from == GA || F9.to == GA) ) {
                if (F8 == null) {
                    F8 = F7
                } else {
                    if (AM(F6, F9.level, F6[F8].level)) {
                        if (F9.from != F9.to) {
                            Ew = F8
                        }
                        return F7
                    } else {
                        if (F9.from != F9.to) {
                            Ew = F7
                        }
                        return F8
                    }
                }
            }
        }
        return F8
    }
    function E8(F6, F9, F7, F8) {
        if (!F8) {
            return F9 + F7
        }
        do {
            F9 += F7
        } while (F9 > 0 && FK(F6.text.charAt(F9)));return F9
    }
    function U(F6, GD, F8, F9) {
        var GA = A(F6);
        if (!GA) {
            return AH(F6, GD, F8, F9)
        }
        var GC = Ad(GA, GD)
          , F7 = GA[GC];
        var GB = E8(F6, GD, F7.level % 2 ? -F8 : F8, F9);
        for (; ; ) {
            if (GB > F7.from && GB < F7.to) {
                return GB
            }
            if (GB == F7.from || GB == F7.to) {
                if (Ad(GA, GB) == GC) {
                    return GB
                }
                F7 = GA[GC += F8];
                return (F8 > 0) == F7.level % 2 ? F7.to : F7.from
            } else {
                F7 = GA[GC += F8];
                if (!F7) {
                    return null
                }
                if ((F8 > 0) == F7.level % 2) {
                    GB = E8(F6, F7.to, -1, F9)
                } else {
                    GB = E8(F6, F7.from, 1, F9)
                }
            }
        }
    }
    function AH(F6, GA, F7, F8) {
        var F9 = GA + F7;
        if (F8) {
            while (F9 > 0 && FK(F6.text.charAt(F9))) {
                F9 += F7
            }
        }
        return F9 < 0 || F9 > F6.text.length ? null : F9
    }
    var BD = (function() {
        var GC = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
        var GA = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
        function F9(GG) {
            if (GG <= 247) {
                return GC.charAt(GG)
            } else {
                if (1424 <= GG && GG <= 1524) {
                    return "R"
                } else {
                    if (1536 <= GG && GG <= 1773) {
                        return GA.charAt(GG - 1536)
                    } else {
                        if (1774 <= GG && GG <= 2220) {
                            return "r"
                        } else {
                            if (8192 <= GG && GG <= 8203) {
                                return "w"
                            } else {
                                if (GG == 8204) {
                                    return "b"
                                } else {
                                    return "L"
                                }
                            }
                        }
                    }
                }
            }
        }
        var F6 = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
        var GF = /[stwN]/
          , F8 = /[LRr]/
          , F7 = /[Lb1n]/
          , GB = /[1n]/;
        var GE = "L";
        function GD(GI, GH, GG) {
            this.level = GI;
            this.from = GH;
            this.to = GG
        }
        return function(GQ) {
            if (!F6.test(GQ)) {
                return false
            }
            var GW = GQ.length
              , GM = [];
            for (var GV = 0, GI; GV < GW; ++GV) {
                GM.push(GI = F9(GQ.charCodeAt(GV)))
            }
            for (var GV = 0, GP = GE; GV < GW; ++GV) {
                var GI = GM[GV];
                if (GI == "m") {
                    GM[GV] = GP
                } else {
                    GP = GI
                }
            }
            for (var GV = 0, GG = GE; GV < GW; ++GV) {
                var GI = GM[GV];
                if (GI == "1" && GG == "r") {
                    GM[GV] = "n"
                } else {
                    if (F8.test(GI)) {
                        GG = GI;
                        if (GI == "r") {
                            GM[GV] = "R"
                        }
                    }
                }
            }
            for (var GV = 1, GP = GM[0]; GV < GW - 1; ++GV) {
                var GI = GM[GV];
                if (GI == "+" && GP == "1" && GM[GV + 1] == "1") {
                    GM[GV] = "1"
                } else {
                    if (GI == "," && GP == GM[GV + 1] && (GP == "1" || GP == "n")) {
                        GM[GV] = GP
                    }
                }
                GP = GI
            }
            for (var GV = 0; GV < GW; ++GV) {
                var GI = GM[GV];
                if (GI == ",") {
                    GM[GV] = "N"
                } else {
                    if (GI == "%") {
                        for (var GJ = GV + 1; GJ < GW && GM[GJ] == "%"; ++GJ) {}
                        var GX = (GV && GM[GV - 1] == "!") || (GJ < GW && GM[GJ] == "1") ? "1" : "N";
                        for (var GT = GV; GT < GJ; ++GT) {
                            GM[GT] = GX
                        }
                        GV = GJ - 1
                    }
                }
            }
            for (var GV = 0, GG = GE; GV < GW; ++GV) {
                var GI = GM[GV];
                if (GG == "L" && GI == "1") {
                    GM[GV] = "L"
                } else {
                    if (F8.test(GI)) {
                        GG = GI
                    }
                }
            }
            for (var GV = 0; GV < GW; ++GV) {
                if (GF.test(GM[GV])) {
                    for (var GJ = GV + 1; GJ < GW && GF.test(GM[GJ]); ++GJ) {}
                    var GN = (GV ? GM[GV - 1] : GE) == "L";
                    var GH = (GJ < GW ? GM[GJ] : GE) == "L";
                    var GX = GN || GH ? "L" : "R";
                    for (var GT = GV; GT < GJ; ++GT) {
                        GM[GT] = GX
                    }
                    GV = GJ - 1
                }
            }
            var GU = [], GR;
            for (var GV = 0; GV < GW; ) {
                if (F7.test(GM[GV])) {
                    var GK = GV;
                    for (++GV; GV < GW && F7.test(GM[GV]); ++GV) {}
                    GU.push(new GD(0,GK,GV))
                } else {
                    var GL = GV
                      , GO = GU.length;
                    for (++GV; GV < GW && GM[GV] != "L"; ++GV) {}
                    for (var GT = GL; GT < GV; ) {
                        if (GB.test(GM[GT])) {
                            if (GL < GT) {
                                GU.splice(GO, 0, new GD(1,GL,GT))
                            }
                            var GS = GT;
                            for (++GT; GT < GV && GB.test(GM[GT]); ++GT) {}
                            GU.splice(GO, 0, new GD(2,GS,GT));
                            GL = GT
                        } else {
                            ++GT
                        }
                    }
                    if (GL < GV) {
                        GU.splice(GO, 0, new GD(1,GL,GV))
                    }
                }
            }
            if (GU[0].level == 1 && (GR = GQ.match(/^\s+/))) {
                GU[0].from = GR[0].length;
                GU.unshift(new GD(0,0,GR[0].length))
            }
            if (Fc(GU).level == 1 && (GR = GQ.match(/\s+$/))) {
                Fc(GU).to -= GR[0].length;
                GU.push(new GD(0,GW - GR[0].length,GW))
            }
            if (GU[0].level != Fc(GU).level) {
                GU.push(new GD(GU[0].level,GW,GW))
            }
            return GU
        }
    })();
    i.version = "4.12.0";
    return i
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-raw', location = '/static/bower/CodeMirror/addon/selection/mark-selection.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(B) {
    B.defineOption("styleSelectedText", false, function(K, N, L) {
        var M = L && L != B.Init;
        if (N && !M) {
            K.state.markedSelection = [];
            K.state.markedSelectionStyle = typeof N == "string" ? N : "CodeMirror-selectedtext";
            F(K);
            K.on("cursorActivity", G);
            K.on("change", H)
        } else {
            if (!N && M) {
                K.off("cursorActivity", G);
                K.off("change", H);
                D(K);
                K.state.markedSelection = K.state.markedSelectionStyle = null
            }
        }
    });
    function G(K) {
        K.operation(function() {
            C(K)
        })
    }
    function H(K) {
        if (K.state.markedSelection.length) {
            K.operation(function() {
                D(K)
            })
        }
    }
    var A = 8;
    var J = B.Pos;
    var I = B.cmpPos;
    function E(T, R, S, O) {
        if (I(R, S) == 0) {
            return
        }
        var P = T.state.markedSelection;
        var U = T.state.markedSelectionStyle;
        for (var V = R.line; ; ) {
            var K = V == R.line ? R : J(V, 0);
            var L = V + A
              , Q = L >= S.line;
            var N = Q ? S : J(L, 0);
            var M = T.markText(K, N, {
                className: U
            });
            if (O == null) {
                P.push(M)
            } else {
                P.splice(O++, 0, M)
            }
            if (Q) {
                break
            }
            V = L
        }
    }
    function D(K) {
        var M = K.state.markedSelection;
        for (var L = 0; L < M.length; ++L) {
            M[L].clear()
        }
        M.length = 0
    }
    function F(K) {
        D(K);
        var L = K.listSelections();
        for (var M = 0; M < L.length; M++) {
            E(K, L[M].from(), L[M].to())
        }
    }
    function C(K) {
        if (!K.somethingSelected()) {
            return D(K)
        }
        if (K.listSelections().length > 1) {
            return F(K)
        }
        var P = K.getCursor("start")
          , O = K.getCursor("end");
        var N = K.state.markedSelection;
        if (!N.length) {
            return E(K, P, O)
        }
        var M = N[0].find()
          , L = N[N.length - 1].find();
        if (!M || !L || O.line - P.line < A || I(P, L.to) >= 0 || I(O, M.from) <= 0) {
            return F(K)
        }
        while (I(P, M.from) > 0) {
            N.shift().clear();
            M = N[0].find()
        }
        if (I(P, M.from) < 0) {
            if (M.to.line - P.line < A) {
                N.shift().clear();
                E(K, P, M.to, 0)
            } else {
                E(K, P, M.from, 0)
            }
        }
        while (I(O, L.to) < 0) {
            N.pop().clear();
            L = N[N.length - 1].find()
        }
        if (I(O, L.to) > 0) {
            if (O.line - L.from.line < A) {
                N.pop().clear();
                E(K, L.from, O)
            } else {
                E(K, L.to, O)
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-raw', location = '/static/bower/CodeMirror/addon/search/match-highlighter.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    var I = 2;
    var B = "matchhighlight";
    var C = 100;
    var K = false;
    function H(L) {
        if (typeof L == "object") {
            this.minChars = L.minChars;
            this.style = L.style;
            this.showToken = L.showToken;
            this.delay = L.delay;
            this.wordsOnly = L.wordsOnly
        }
        if (this.style == null) {
            this.style = B
        }
        if (this.minChars == null) {
            this.minChars = I
        }
        if (this.delay == null) {
            this.delay = C
        }
        if (this.wordsOnly == null) {
            this.wordsOnly = K
        }
        this.overlay = this.timeout = null
    }
    A.defineOption("highlightSelectionMatches", false, function(L, O, M) {
        if (M && M != A.Init) {
            var N = L.state.matchHighlighter.overlay;
            if (N) {
                L.removeOverlay(N)
            }
            clearTimeout(L.state.matchHighlighter.timeout);
            L.state.matchHighlighter = null;
            L.off("cursorActivity", G)
        }
        if (O) {
            L.state.matchHighlighter = new H(O);
            E(L);
            L.on("cursorActivity", G)
        }
    });
    function G(L) {
        var M = L.state.matchHighlighter;
        clearTimeout(M.timeout);
        M.timeout = setTimeout(function() {
            E(L)
        }, M.delay)
    }
    function E(L) {
        L.operation(function() {
            var M = L.state.matchHighlighter;
            if (M.overlay) {
                L.removeOverlay(M.overlay);
                M.overlay = null
            }
            if (!L.somethingSelected() && M.showToken) {
                var T = M.showToken === true ? /[\w$]/ : M.showToken;
                var S = L.getCursor()
                  , U = L.getLine(S.line)
                  , N = S.ch
                  , O = N;
                while (N && T.test(U.charAt(N - 1))) {
                    --N
                }
                while (O < U.length && T.test(U.charAt(O))) {
                    ++O
                }
                if (N < O) {
                    L.addOverlay(M.overlay = D(U.slice(N, O), T, M.style))
                }
                return
            }
            var Q = L.getCursor("from")
              , R = L.getCursor("to");
            if (Q.line != R.line) {
                return
            }
            if (M.wordsOnly && !F(L, Q, R)) {
                return
            }
            var P = L.getRange(Q, R).replace(/^\s+|\s+$/g, "");
            if (P.length >= M.minChars) {
                L.addOverlay(M.overlay = D(P, false, M.style))
            }
        })
    }
    function F(L, Q, P) {
        var N = L.getRange(Q, P);
        if (N.match(/^\w+$/) !== null) {
            if (Q.ch > 0) {
                var O = {
                    line: Q.line,
                    ch: Q.ch - 1
                };
                var M = L.getRange(O, Q);
                if (M.match(/\W/) === null) {
                    return false
                }
            }
            if (P.ch < L.getLine(Q.line).length) {
                var O = {
                    line: P.line,
                    ch: P.ch + 1
                };
                var M = L.getRange(P, O);
                if (M.match(/\W/) === null) {
                    return false
                }
            }
            return true
        } else {
            return false
        }
    }
    function J(M, L) {
        return (!M.start || !L.test(M.string.charAt(M.start - 1))) && (M.pos == M.string.length || !L.test(M.string.charAt(M.pos)))
    }
    function D(N, M, L) {
        return {
            token: function(O) {
                if (O.match(N) && (!M || J(O, M))) {
                    return L
                }
                O.next();
                O.skipTo(N.charAt(0)) || O.skipToEnd()
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-raw', location = '/static/bower/CodeMirror/addon/search/searchcursor.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    var B = A.Pos;
    function C(K, I, L, G) {
        this.atOccurrence = false;
        this.doc = K;
        if (G == null && typeof I == "string") {
            G = false
        }
        L = L ? K.clipPos(L) : B(0, 0);
        this.pos = {
            from: L,
            to: L
        };
        if (typeof I != "string") {
            if (!I.global) {
                I = new RegExp(I.source,I.ignoreCase ? "ig" : "g")
            }
            this.matches = function(P, T) {
                if (P) {
                    I.lastIndex = 0;
                    var M = K.getLine(T.line).slice(0, T.ch), R = 0, O, S;
                    for (; ; ) {
                        I.lastIndex = R;
                        var Q = I.exec(M);
                        if (!Q) {
                            break
                        }
                        O = Q;
                        S = O.index;
                        R = O.index + (O[0].length || 1);
                        if (R == M.length) {
                            break
                        }
                    }
                    var N = (O && O[0].length) || 0;
                    if (!N) {
                        if (S == 0 && M.length == 0) {
                            O = undefined
                        } else {
                            if (S != K.getLine(T.line).length) {
                                N++
                            }
                        }
                    }
                } else {
                    I.lastIndex = T.ch;
                    var M = K.getLine(T.line)
                      , O = I.exec(M);
                    var N = (O && O[0].length) || 0;
                    var S = O && O.index;
                    if (S + N != M.length && !N) {
                        N = 1
                    }
                }
                if (O && N) {
                    return {
                        from: B(T.line, S),
                        to: B(T.line, S + N),
                        match: O
                    }
                }
            }
        } else {
            var E = I;
            if (G) {
                I = I.toLowerCase()
            }
            var F = G ? function(M) {
                return M.toLowerCase()
            }
            : function(M) {
                return M
            }
            ;
            var J = I.split("\n");
            if (J.length == 1) {
                if (!I.length) {
                    this.matches = function() {}
                } else {
                    this.matches = function(O, Q) {
                        if (O) {
                            var P = K.getLine(Q.line).slice(0, Q.ch)
                              , M = F(P);
                            var N = M.lastIndexOf(I);
                            if (N > -1) {
                                N = D(P, M, N);
                                return {
                                    from: B(Q.line, N),
                                    to: B(Q.line, N + E.length)
                                }
                            }
                        } else {
                            var P = K.getLine(Q.line).slice(Q.ch)
                              , M = F(P);
                            var N = M.indexOf(I);
                            if (N > -1) {
                                N = D(P, M, N) + Q.ch;
                                return {
                                    from: B(Q.line, N),
                                    to: B(Q.line, N + E.length)
                                }
                            }
                        }
                    }
                }
            } else {
                var H = E.split("\n");
                this.matches = function(N, P) {
                    var T = J.length - 1;
                    if (N) {
                        if (P.line - (J.length - 1) < K.firstLine()) {
                            return
                        }
                        if (F(K.getLine(P.line).slice(0, H[T].length)) != J[J.length - 1]) {
                            return
                        }
                        var S = B(P.line, H[T].length);
                        for (var O = P.line - 1, M = T - 1; M >= 1; --M,
                        --O) {
                            if (J[M] != F(K.getLine(O))) {
                                return
                            }
                        }
                        var U = K.getLine(O)
                          , Q = U.length - H[0].length;
                        if (F(U.slice(Q)) != J[0]) {
                            return
                        }
                        return {
                            from: B(O, Q),
                            to: S
                        }
                    } else {
                        if (P.line + (J.length - 1) > K.lastLine()) {
                            return
                        }
                        var U = K.getLine(P.line)
                          , Q = U.length - H[0].length;
                        if (F(U.slice(Q)) != J[0]) {
                            return
                        }
                        var R = B(P.line, Q);
                        for (var O = P.line + 1, M = 1; M < T; ++M,
                        ++O) {
                            if (J[M] != F(K.getLine(O))) {
                                return
                            }
                        }
                        if (F(K.getLine(O).slice(0, H[T].length)) != J[T]) {
                            return
                        }
                        return {
                            from: R,
                            to: B(O, H[T].length)
                        }
                    }
                }
            }
        }
    }
    C.prototype = {
        findNext: function() {
            return this.find(false)
        },
        findPrevious: function() {
            return this.find(true)
        },
        find: function(F) {
            var E = this
              , I = this.doc.clipPos(F ? this.pos.from : this.pos.to);
            function G(J) {
                var K = B(J, 0);
                E.pos = {
                    from: K,
                    to: K
                };
                E.atOccurrence = false;
                return false
            }
            for (; ; ) {
                if (this.pos = this.matches(F, I)) {
                    this.atOccurrence = true;
                    return this.pos.match || true
                }
                if (F) {
                    if (!I.line) {
                        return G(0)
                    }
                    I = B(I.line - 1, this.doc.getLine(I.line - 1).length)
                } else {
                    var H = this.doc.lineCount();
                    if (I.line == H - 1) {
                        return G(H)
                    }
                    I = B(I.line + 1, 0)
                }
            }
        },
        from: function() {
            if (this.atOccurrence) {
                return this.pos.from
            }
        },
        to: function() {
            if (this.atOccurrence) {
                return this.pos.to
            }
        },
        replace: function(F) {
            if (!this.atOccurrence) {
                return
            }
            var E = A.splitLines(F);
            this.doc.replaceRange(E, this.pos.from, this.pos.to);
            this.pos.to = B(this.pos.from.line + E.length - 1, E[E.length - 1].length + (E.length == 1 ? this.pos.from.ch : 0))
        }
    };
    function D(I, G, H) {
        if (I.length == G.length) {
            return H
        }
        for (var F = Math.min(H, I.length); ; ) {
            var E = I.slice(0, F).toLowerCase().length;
            if (E < H) {
                ++F
            } else {
                if (E > H) {
                    --F
                } else {
                    return F
                }
            }
        }
    }
    A.defineExtension("getSearchCursor", function(F, G, E) {
        return new C(this.doc,F,G,E)
    });
    A.defineDocExtension("getSearchCursor", function(F, G, E) {
        return new C(this,F,G,E)
    });
    A.defineExtension("selectMatches", function(H, G) {
        var E = [], F;
        var I = this.getSearchCursor(H, this.getCursor("from"), G);
        while (F = I.findNext()) {
            if (A.cmpPos(I.to(), this.getCursor("to")) > 0) {
                break
            }
            E.push({
                anchor: I.from(),
                head: I.to()
            })
        }
        if (E.length) {
            this.setSelections(E, 0)
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-raw', location = '/static/bower/CodeMirror/addon/dialog/dialog.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(B) {
    function C(D, H, E) {
        var G = D.getWrapperElement();
        var F;
        F = G.appendChild(document.createElement("div"));
        if (E) {
            F.className = "CodeMirror-dialog CodeMirror-dialog-bottom"
        } else {
            F.className = "CodeMirror-dialog CodeMirror-dialog-top"
        }
        if (typeof H == "string") {
            F.innerHTML = H
        } else {
            F.appendChild(H)
        }
        return F
    }
    function A(D, E) {
        if (D.state.currentNotificationClose) {
            D.state.currentNotificationClose()
        }
        D.state.currentNotificationClose = E
    }
    B.defineExtension("openDialog", function(I, J, L) {
        if (!L) {
            L = {}
        }
        A(this, null);
        var F = C(this, I, L.bottom);
        var E = false
          , G = this;
        function K(M) {
            if (typeof M == "string") {
                H.value = M
            } else {
                if (E) {
                    return
                }
                E = true;
                F.parentNode.removeChild(F);
                G.focus();
                if (L.onClose) {
                    L.onClose(F)
                }
            }
        }
        var H = F.getElementsByTagName("input")[0], D;
        if (H) {
            if (L.value) {
                H.value = L.value;
                H.select()
            }
            if (L.onInput) {
                B.on(H, "input", function(M) {
                    L.onInput(M, H.value, K)
                })
            }
            if (L.onKeyUp) {
                B.on(H, "keyup", function(M) {
                    L.onKeyUp(M, H.value, K)
                })
            }
            B.on(H, "keydown", function(M) {
                if (L && L.onKeyDown && L.onKeyDown(M, H.value, K)) {
                    return
                }
                if (M.keyCode == 27 || (L.closeOnEnter !== false && M.keyCode == 13)) {
                    H.blur();
                    B.e_stop(M);
                    K()
                }
                if (M.keyCode == 13) {
                    J(H.value, M)
                }
            });
            if (L.closeOnBlur !== false) {
                B.on(H, "blur", K)
            }
            H.focus()
        } else {
            if (D = F.getElementsByTagName("button")[0]) {
                B.on(D, "click", function() {
                    K();
                    G.focus()
                });
                if (L.closeOnBlur !== false) {
                    B.on(D, "blur", K)
                }
                D.focus()
            }
        }
        return K
    });
    B.defineExtension("openConfirm", function(L, G, N) {
        A(this, null);
        var H = C(this, L, N && N.bottom);
        var I = H.getElementsByTagName("button");
        var F = false
          , J = this
          , D = 1;
        function M() {
            if (F) {
                return
            }
            F = true;
            H.parentNode.removeChild(H);
            J.focus()
        }
        I[0].focus();
        for (var E = 0; E < I.length; ++E) {
            var K = I[E];
            (function(O) {
                B.on(K, "click", function(P) {
                    B.e_preventDefault(P);
                    M();
                    if (O) {
                        O(J)
                    }
                })
            })(G[E]);
            B.on(K, "blur", function() {
                --D;
                setTimeout(function() {
                    if (D <= 0) {
                        M()
                    }
                }, 200)
            });
            B.on(K, "focus", function() {
                ++D
            })
        }
    });
    B.defineExtension("openNotification", function(G, E) {
        A(this, J);
        var F = C(this, G, E && E.bottom);
        var D = false, H;
        var I = E && typeof E.duration !== "undefined" ? E.duration : 5000;
        function J() {
            if (D) {
                return
            }
            D = true;
            clearTimeout(H);
            F.parentNode.removeChild(F)
        }
        B.on(F, "click", function(K) {
            B.e_preventDefault(K);
            J()
        });
        if (I) {
            H = setTimeout(J, I)
        }
        return J
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror-mode-meta', location = '/static/bower/CodeMirror/mode/meta.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.modeInfo = [{
        name: "APL",
        mime: "text/apl",
        mode: "apl",
        ext: ["dyalog", "apl"]
    }, {
        name: "Asterisk",
        mime: "text/x-asterisk",
        mode: "asterisk",
        file: /^extensions\.conf$/i
    }, {
        name: "C",
        mime: "text/x-csrc",
        mode: "clike",
        ext: ["c", "h"]
    }, {
        name: "C++",
        mime: "text/x-c++src",
        mode: "clike",
        ext: ["cpp", "c++", "cc", "cxx", "hpp", "h++", "hh", "hxx"],
        alias: ["cpp"]
    }, {
        name: "Cobol",
        mime: "text/x-cobol",
        mode: "cobol",
        ext: ["cob", "cpy"]
    }, {
        name: "C#",
        mime: "text/x-csharp",
        mode: "clike",
        ext: ["cs"],
        alias: ["csharp"]
    }, {
        name: "Clojure",
        mime: "text/x-clojure",
        mode: "clojure",
        ext: ["clj"]
    }, {
        name: "CoffeeScript",
        mime: "text/x-coffeescript",
        mode: "coffeescript",
        ext: ["coffee"],
        alias: ["coffee", "coffee-script"]
    }, {
        name: "Common Lisp",
        mime: "text/x-common-lisp",
        mode: "commonlisp",
        ext: ["cl", "lisp", "el"],
        alias: ["lisp"]
    }, {
        name: "Cypher",
        mime: "application/x-cypher-query",
        mode: "cypher",
        ext: ["cyp", "cypher"]
    }, {
        name: "Cython",
        mime: "text/x-cython",
        mode: "python",
        ext: ["pyx", "pxd", "pxi"]
    }, {
        name: "CSS",
        mime: "text/css",
        mode: "css",
        ext: ["css"]
    }, {
        name: "CQL",
        mime: "text/x-cassandra",
        mode: "sql",
        ext: ["cql"]
    }, {
        name: "D",
        mime: "text/x-d",
        mode: "d",
        ext: ["d"]
    }, {
        name: "Dart",
        mimes: ["application/dart", "text/x-dart"],
        mode: "dart",
        ext: ["dart"]
    }, {
        name: "diff",
        mime: "text/x-diff",
        mode: "diff",
        ext: ["diff", "patch"]
    }, {
        name: "Django",
        mime: "text/x-django",
        mode: "django"
    }, {
        name: "Dockerfile",
        mime: "text/x-dockerfile",
        mode: "dockerfile",
        file: /^Dockerfile$/
    }, {
        name: "DTD",
        mime: "application/xml-dtd",
        mode: "dtd",
        ext: ["dtd"]
    }, {
        name: "Dylan",
        mime: "text/x-dylan",
        mode: "dylan",
        ext: ["dylan", "dyl", "intr"]
    }, {
        name: "EBNF",
        mime: "text/x-ebnf",
        mode: "ebnf"
    }, {
        name: "ECL",
        mime: "text/x-ecl",
        mode: "ecl",
        ext: ["ecl"]
    }, {
        name: "Eiffel",
        mime: "text/x-eiffel",
        mode: "eiffel",
        ext: ["e"]
    }, {
        name: "Embedded Javascript",
        mime: "application/x-ejs",
        mode: "htmlembedded",
        ext: ["ejs"]
    }, {
        name: "Embedded Ruby",
        mime: "application/x-erb",
        mode: "htmlembedded",
        ext: ["erb"]
    }, {
        name: "Erlang",
        mime: "text/x-erlang",
        mode: "erlang",
        ext: ["erl"]
    }, {
        name: "Fortran",
        mime: "text/x-fortran",
        mode: "fortran",
        ext: ["f", "for", "f77", "f90"]
    }, {
        name: "F#",
        mime: "text/x-fsharp",
        mode: "mllike",
        ext: ["fs"],
        alias: ["fsharp"]
    }, {
        name: "Gas",
        mime: "text/x-gas",
        mode: "gas",
        ext: ["s"]
    }, {
        name: "Gherkin",
        mime: "text/x-feature",
        mode: "gherkin",
        ext: ["feature"]
    }, {
        name: "GitHub Flavored Markdown",
        mime: "text/x-gfm",
        mode: "gfm",
        file: /^(readme|contributing|history).md$/i
    }, {
        name: "Go",
        mime: "text/x-go",
        mode: "go",
        ext: ["go"]
    }, {
        name: "Groovy",
        mime: "text/x-groovy",
        mode: "groovy",
        ext: ["groovy"]
    }, {
        name: "HAML",
        mime: "text/x-haml",
        mode: "haml",
        ext: ["haml"]
    }, {
        name: "Haskell",
        mime: "text/x-haskell",
        mode: "haskell",
        ext: ["hs"]
    }, {
        name: "Haxe",
        mime: "text/x-haxe",
        mode: "haxe",
        ext: ["hx"]
    }, {
        name: "HXML",
        mime: "text/x-hxml",
        mode: "haxe",
        ext: ["hxml"]
    }, {
        name: "ASP.NET",
        mime: "application/x-aspx",
        mode: "htmlembedded",
        ext: ["aspx"],
        alias: ["asp", "aspx"]
    }, {
        name: "HTML",
        mime: "text/html",
        mode: "htmlmixed",
        ext: ["html", "htm"],
        alias: ["xhtml"]
    }, {
        name: "HTTP",
        mime: "message/http",
        mode: "http"
    }, {
        name: "IDL",
        mime: "text/x-idl",
        mode: "idl",
        ext: ["pro"]
    }, {
        name: "Jade",
        mime: "text/x-jade",
        mode: "jade",
        ext: ["jade"]
    }, {
        name: "Java",
        mime: "text/x-java",
        mode: "clike",
        ext: ["java"]
    }, {
        name: "Java Server Pages",
        mime: "application/x-jsp",
        mode: "htmlembedded",
        ext: ["jsp"],
        alias: ["jsp"]
    }, {
        name: "JavaScript",
        mimes: ["text/javascript", "text/ecmascript", "application/javascript", "application/x-javascript", "application/ecmascript"],
        mode: "javascript",
        ext: ["js"],
        alias: ["ecmascript", "js", "node"]
    }, {
        name: "JSON",
        mimes: ["application/json", "application/x-json"],
        mode: "javascript",
        ext: ["json", "map"],
        alias: ["json5"]
    }, {
        name: "JSON-LD",
        mime: "application/ld+json",
        mode: "javascript",
        ext: ["jsonld"],
        alias: ["jsonld"]
    }, {
        name: "Jinja2",
        mime: "null",
        mode: "jinja2"
    }, {
        name: "Julia",
        mime: "text/x-julia",
        mode: "julia",
        ext: ["jl"]
    }, {
        name: "Kotlin",
        mime: "text/x-kotlin",
        mode: "kotlin",
        ext: ["kt"]
    }, {
        name: "LESS",
        mime: "text/x-less",
        mode: "css",
        ext: ["less"]
    }, {
        name: "LiveScript",
        mime: "text/x-livescript",
        mode: "livescript",
        ext: ["ls"],
        alias: ["ls"]
    }, {
        name: "Lua",
        mime: "text/x-lua",
        mode: "lua",
        ext: ["lua"]
    }, {
        name: "Markdown",
        mime: "text/x-markdown",
        mode: "markdown",
        ext: ["markdown", "md", "mkd"]
    }, {
        name: "mIRC",
        mime: "text/mirc",
        mode: "mirc"
    }, {
        name: "MariaDB SQL",
        mime: "text/x-mariadb",
        mode: "sql"
    }, {
        name: "Modelica",
        mime: "text/x-modelica",
        mode: "modelica",
        ext: ["mo"]
    }, {
        name: "MS SQL",
        mime: "text/x-mssql",
        mode: "sql"
    }, {
        name: "MySQL",
        mime: "text/x-mysql",
        mode: "sql"
    }, {
        name: "Nginx",
        mime: "text/x-nginx-conf",
        mode: "nginx",
        file: /nginx.*\.conf$/i
    }, {
        name: "NTriples",
        mime: "text/n-triples",
        mode: "ntriples",
        ext: ["nt"]
    }, {
        name: "Objective C",
        mime: "text/x-objectivec",
        mode: "clike",
        ext: ["m", "mm"]
    }, {
        name: "OCaml",
        mime: "text/x-ocaml",
        mode: "mllike",
        ext: ["ml", "mli", "mll", "mly"]
    }, {
        name: "Octave",
        mime: "text/x-octave",
        mode: "octave",
        ext: ["m"]
    }, {
        name: "Pascal",
        mime: "text/x-pascal",
        mode: "pascal",
        ext: ["p", "pas"]
    }, {
        name: "PEG.js",
        mime: "null",
        mode: "pegjs",
        ext: ["jsonld"]
    }, {
        name: "Perl",
        mime: "text/x-perl",
        mode: "perl",
        ext: ["pl", "pm"]
    }, {
        name: "PHP",
        mime: "application/x-httpd-php",
        mode: "php",
        ext: ["php", "php3", "php4", "php5", "phtml"]
    }, {
        name: "Pig",
        mime: "text/x-pig",
        mode: "pig",
        ext: ["pig"]
    }, {
        name: "Plain Text",
        mime: "text/plain",
        mode: "null",
        ext: ["txt", "text", "conf", "def", "list", "log"]
    }, {
        name: "PLSQL",
        mime: "text/x-plsql",
        mode: "sql",
        ext: ["pls"]
    }, {
        name: "Properties files",
        mime: "text/x-properties",
        mode: "properties",
        ext: ["properties", "ini", "in"],
        alias: ["ini", "properties"]
    }, {
        name: "Python",
        mime: "text/x-python",
        mode: "python",
        ext: ["py", "pyw"]
    }, {
        name: "Puppet",
        mime: "text/x-puppet",
        mode: "puppet",
        ext: ["pp"]
    }, {
        name: "Q",
        mime: "text/x-q",
        mode: "q",
        ext: ["q"]
    }, {
        name: "R",
        mime: "text/x-rsrc",
        mode: "r",
        ext: ["r"],
        alias: ["rscript"]
    }, {
        name: "reStructuredText",
        mime: "text/x-rst",
        mode: "rst",
        ext: ["rst"],
        alias: ["rst"]
    }, {
        name: "RPM Changes",
        mime: "text/x-rpm-changes",
        mode: "rpm"
    }, {
        name: "RPM Spec",
        mime: "text/x-rpm-spec",
        mode: "rpm",
        ext: ["spec"]
    }, {
        name: "Ruby",
        mime: "text/x-ruby",
        mode: "ruby",
        ext: ["rb"],
        alias: ["jruby", "macruby", "rake", "rb", "rbx"]
    }, {
        name: "Rust",
        mime: "text/x-rustsrc",
        mode: "rust",
        ext: ["rs"]
    }, {
        name: "Sass",
        mime: "text/x-sass",
        mode: "sass",
        ext: ["sass"]
    }, {
        name: "Scala",
        mime: "text/x-scala",
        mode: "clike",
        ext: ["scala"]
    }, {
        name: "Scheme",
        mime: "text/x-scheme",
        mode: "scheme",
        ext: ["scm", "ss"]
    }, {
        name: "SCSS",
        mime: "text/x-scss",
        mode: "css",
        ext: ["scss"]
    }, {
        name: "Shell",
        mime: "text/x-sh",
        mode: "shell",
        ext: ["sh", "ksh", "bash"],
        alias: ["bash", "sh", "zsh"]
    }, {
        name: "Sieve",
        mime: "application/sieve",
        mode: "sieve",
        ext: ["siv", "sieve"]
    }, {
        name: "Slim",
        mimes: ["text/x-slim", "application/x-slim"],
        mode: "slim",
        ext: ["slim"]
    }, {
        name: "Smalltalk",
        mime: "text/x-stsrc",
        mode: "smalltalk",
        ext: ["st"]
    }, {
        name: "Smarty",
        mime: "text/x-smarty",
        mode: "smarty",
        ext: ["tpl"]
    }, {
        name: "SmartyMixed",
        mime: "text/x-smarty",
        mode: "smartymixed"
    }, {
        name: "Solr",
        mime: "text/x-solr",
        mode: "solr"
    }, {
        name: "Soy",
        mime: "text/x-soy",
        mode: "soy",
        ext: ["soy"],
        alias: ["closure template"]
    }, {
        name: "SPARQL",
        mime: "application/sparql-query",
        mode: "sparql",
        ext: ["rq", "sparql"],
        alias: ["sparul"]
    }, {
        name: "Spreadsheet",
        mime: "text/x-spreadsheet",
        mode: "spreadsheet",
        alias: ["excel", "formula"]
    }, {
        name: "SQL",
        mime: "text/x-sql",
        mode: "sql",
        ext: ["sql"]
    }, {
        name: "MariaDB",
        mime: "text/x-mariadb",
        mode: "sql"
    }, {
        name: "sTeX",
        mime: "text/x-stex",
        mode: "stex"
    }, {
        name: "LaTeX",
        mime: "text/x-latex",
        mode: "stex",
        ext: ["text", "ltx"],
        alias: ["tex"]
    }, {
        name: "SystemVerilog",
        mime: "text/x-systemverilog",
        mode: "verilog",
        ext: ["v"]
    }, {
        name: "Tcl",
        mime: "text/x-tcl",
        mode: "tcl",
        ext: ["tcl"]
    }, {
        name: "Textile",
        mime: "text/x-textile",
        mode: "textile",
        ext: ["textile"]
    }, {
        name: "TiddlyWiki ",
        mime: "text/x-tiddlywiki",
        mode: "tiddlywiki"
    }, {
        name: "Tiki wiki",
        mime: "text/tiki",
        mode: "tiki"
    }, {
        name: "TOML",
        mime: "text/x-toml",
        mode: "toml",
        ext: ["toml"]
    }, {
        name: "Tornado",
        mime: "text/x-tornado",
        mode: "tornado"
    }, {
        name: "Turtle",
        mime: "text/turtle",
        mode: "turtle",
        ext: ["ttl"]
    }, {
        name: "TypeScript",
        mime: "application/typescript",
        mode: "javascript",
        ext: ["ts"],
        alias: ["ts"]
    }, {
        name: "VB.NET",
        mime: "text/x-vb",
        mode: "vb",
        ext: ["vb"]
    }, {
        name: "VBScript",
        mime: "text/vbscript",
        mode: "vbscript",
        ext: ["vbs"]
    }, {
        name: "Velocity",
        mime: "text/velocity",
        mode: "velocity",
        ext: ["vtl"]
    }, {
        name: "Verilog",
        mime: "text/x-verilog",
        mode: "verilog",
        ext: ["v"]
    }, {
        name: "XML",
        mimes: ["application/xml", "text/xml"],
        mode: "xml",
        ext: ["xml", "xsl", "xsd"],
        alias: ["rss", "wsdl", "xsd"]
    }, {
        name: "XQuery",
        mime: "application/xquery",
        mode: "xquery",
        ext: ["xy", "xquery"]
    }, {
        name: "YAML",
        mime: "text/x-yaml",
        mode: "yaml",
        ext: ["yaml"],
        alias: ["yml"]
    }, {
        name: "Z80",
        mime: "text/x-z80",
        mode: "z80",
        ext: ["z80"]
    }];
    for (var B = 0; B < A.modeInfo.length; B++) {
        var C = A.modeInfo[B];
        if (C.mimes) {
            C.mime = C.mimes[0]
        }
    }
    A.findModeByMIME = function(F) {
        F = F.toLowerCase();
        for (var E = 0; E < A.modeInfo.length; E++) {
            var G = A.modeInfo[E];
            if (G.mime == F) {
                return G
            }
            if (G.mimes) {
                for (var D = 0; D < G.mimes.length; D++) {
                    if (G.mimes[D] == F) {
                        return G
                    }
                }
            }
        }
    }
    ;
    A.findModeByExtension = function(F) {
        for (var E = 0; E < A.modeInfo.length; E++) {
            var G = A.modeInfo[E];
            if (G.ext) {
                for (var D = 0; D < G.ext.length; D++) {
                    if (G.ext[D] == F) {
                        return G
                    }
                }
            }
        }
    }
    ;
    A.findModeByFileName = function(E) {
        for (var F = 0; F < A.modeInfo.length; F++) {
            var H = A.modeInfo[F];
            if (H.file && H.file.test(E)) {
                return H
            }
        }
        var D = E.lastIndexOf(".");
        var G = D > -1 && E.substring(D + 1, E.length);
        if (G) {
            return A.findModeByExtension(G)
        }
    }
    ;
    A.findModeByName = function(E) {
        E = E.toLowerCase();
        for (var F = 0; F < A.modeInfo.length; F++) {
            var G = A.modeInfo[F];
            if (G.name.toLowerCase() == E) {
                return G
            }
            if (G.alias) {
                for (var D = 0; D < G.alias.length; D++) {
                    if (G.alias[D].toLowerCase() == E) {
                        return G
                    }
                }
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror', location = '/static/lib/CodeMirror/codemirror-AMD.js' */
define("codemirror", function() {
    return CodeMirror
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:codemirror', location = '/static/bower/CodeMirror/addon/runmode/runmode.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.runMode = function(K, H, O, Q) {
        var J = A.getMode(A.defaults, H);
        var D = /MSIE \d/.test(navigator.userAgent);
        var G = D && (document.documentMode == null || document.documentMode < 9);
        if (O.nodeType == 1) {
            var L = (Q && Q.tabSize) || A.defaults.tabSize;
            var F = O
              , E = 0;
            F.innerHTML = "";
            O = function(X, U) {
                if (X == "\n") {
                    F.appendChild(document.createTextNode(G ? "\r" : X));
                    E = 0;
                    return
                }
                var V = "";
                for (var Y = 0; ; ) {
                    var R = X.indexOf("\t", Y);
                    if (R == -1) {
                        V += X.slice(Y);
                        E += X.length - Y;
                        break
                    } else {
                        E += R - Y;
                        V += X.slice(Y, R);
                        var T = L - E % L;
                        E += T;
                        for (var S = 0; S < T; ++S) {
                            V += " "
                        }
                        Y = R + 1
                    }
                }
                if (U) {
                    var W = F.appendChild(document.createElement("span"));
                    W.className = "cm-" + U.replace(/ +/g, " cm-");
                    W.appendChild(document.createTextNode(V))
                } else {
                    F.appendChild(document.createTextNode(V))
                }
            }
        }
        var P = A.splitLines(K)
          , C = (Q && Q.state) || A.startState(J);
        for (var I = 0, M = P.length; I < M; ++I) {
            if (I) {
                O("\n")
            }
            var N = new A.StringStream(P[I]);
            if (!N.string && J.blankLine) {
                J.blankLine(C)
            }
            while (!N.eol()) {
                var B = J.token(N, C);
                O(N.current(), B, I, N.start, C);
                N.start = N.pos
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:determine-language', location = '/static/util/determine-language.js' */
define("util/determine-language", ["codemirror", "jquery", "lodash", "exports"], function(O, G, Q, R) {
    document.documentElement.className += " cm-s-stash-default";
    var N = {
        bash: "text/x-sh",
        clojure: "text/x-clojure",
        coffeescript: "text/x-coffeescript",
        cpp: "text/x-c++src",
        cs: "text/x-csharp",
        css: "text/css",
        d: "text/x-d",
        diff: "text/x-diff",
        dos: "text/x-sh",
        erlang: "text/x-erlang",
        go: "text/x-go",
        haskell: "text/x-haskell",
        html: "text/html",
        ini: "text/x-toml",
        java: "text/x-java",
        javascript: "text/javascript",
        json: "application/json",
        less: "text/x-less",
        lisp: "text/x-common-lisp",
        lua: "text/x-lua",
        markdown: "text/x-markdown",
        objectivec: "text/x-csrc",
        perl: "text/x-perl",
        php: "application/x-httpd-php",
        python: "text/x-python",
        ruby: "text/x-ruby",
        scala: "text/x-scala",
        sql: "text/x-sql",
        tex: "text/x-stex",
        vbscript: "text/vbscript",
        xml: "application/xml"
    };
    var C = WRM.data.claim("com.atlassian.stash.stash-web-plugin:determine-language.syntax-highlighters") || {};
    var J = {};
    var I = {};
    Q.forEach(C, function(S, T) {
        if (T.indexOf("/") === -1) {
            console && console.warn && console.warn("DEPRECATED - Using HighlightJS mapping (" + T + ") has been has been deprecated since 3.5 and will be removed in 4.0. See https://confluence.atlassian.com/display/STASHKB/Syntax+highlight+changes")
        }
        Q.forEach(S.e, function(U) {
            J[U] = T
        });
        Q.forEach(S.x, function(U) {
            I[U] = T
        })
    });
    var K = {};
    var L = {};
    function B(S) {
        return Q.has(J, S) ? J[S] : null
    }
    function D(S) {
        return Q.has(I, S) ? I[S] : null
    }
    function H(S) {
        var T = S;
        if (S.indexOf("/") === -1) {
            T = N[S]
        }
        return O.findModeByMIME(T)
    }
    function E(S) {
        var U = /^#!(?:\/(?:usr\/)?(?:local\/)?bin\/([^\s]+))(?:\s+([^\s]+))?/;
        var T = U.exec(S);
        if (T) {
            var V = T[1];
            if (V === "env") {
                V = T[2]
            }
            return V
        }
        return null
    }
    function A(T, S) {
        return K.hasOwnProperty(T) ? K[T] : S && L.hasOwnProperty(S) ? L[S] : null
    }
    function M(U) {
        var S = U.path;
        var T = S.lastIndexOf(".");
        var Y = T === -1 ? S : S.substring(T + 1);
        var X = U.firstLine.length > 1 ? E(U.firstLine) : null;
        var W = A(Y, X);
        var V;
        if (!W) {
            V = B(Y) || (X != null ? D(X) : null);
            if (V) {
                W = H(V)
            } else {
                W = O.findModeByFileName(S)
            }
            W = W || O.findModeByMIME("text/plain");
            W.builtIn = true
        }
        if (U.legacy) {
            return V || "text"
        }
        return W
    }
    function P(U, T, S) {
        if (T) {
            T.forEach(function(V) {
                K[V] = U
            })
        }
        if (S) {
            S.forEach(function(V) {
                L[V] = U
            })
        }
    }
    function F(T) {
        var S = O.findModeByName(T) || O.findModeByExtension(T);
        if (!S) {
            return G.Deferred().resolve(O.findModeByMIME("text/plain"))
        }
        if (typeof O.mimeModes[S.mime] === "undefined") {
            return WRM.require("wr!com.atlassian.stash.stash-highlight-plugin:" + S.mode).then(function() {
                return S
            })
        }
        return G.Deferred().resolve(S)
    }
    R.fromFileInfo = M;
    R.registerCodeMirrorMode = P;
    R.getCodeMirrorModeForName = F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:stash-codemirror', location = '/static/feature/file-content/stash-codemirror/search.js' */
define("feature/file-content/stash-codemirror/search", ["codemirror", "jquery", "util/navigator"], function(E, G, M) {
    function A(Q, P) {
        if (typeof Q === "string") {
            Q = new RegExp("^" + Q.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&"),P ? "i" : "")
        } else {
            Q = new RegExp("^(?:" + Q.source + ")",Q.ignoreCase ? "i" : "")
        }
        return {
            token: function(R) {
                if (R.match(Q)) {
                    return "searching"
                }
                while (!R.eol()) {
                    R.next();
                    if (R.match(Q, false)) {
                        break
                    }
                }
            }
        }
    }
    function K() {
        this.cursor = null;
        this.dialogEl = null;
        this.overlay = null;
        this.query = null
    }
    function F(P) {
        return P.state.search || (P.state.search = new K())
    }
    function N(P) {
        return typeof P === "string" && P === P.toLowerCase()
    }
    function L(P, Q, R) {
        return P.getSearchCursor(Q, R, N(Q))
    }
    function D(Q) {
        var P = Q.match(/^\/(.*)\/([a-z]*)$/);
        return P ? new RegExp(P[1],P[2].indexOf("i") === -1 ? "" : "i") : Q
    }
    function B(P, Q) {
        P.operation(function() {
            P.removeOverlay(Q.overlay);
            Q.overlay = A(Q.query, N(Q.query));
            P.addOverlay(Q.overlay)
        })
    }
    function O(P, Q) {
        P.operation(function() {
            P.removeOverlay(Q.overlay);
            Q.overlay = null
        })
    }
    function I(P, R, Q) {
        R = R && R.trim();
        if (!R || R.length === 0) {
            return
        }
        P.operation(function() {
            var S = F(P);
            if (R !== S.query) {
                S.query = D(R);
                S.cursor = null;
                B(P, S)
            } else {
                if (!S.overlay) {
                    B(P, S)
                }
            }
            H(P, Q)
        })
    }
    function J(P, Q) {
        var S = F(P);
        if (S.dialogEl) {
            var V = S.dialogEl.getElementsByClassName("search-query")[0];
            V.focus();
            I(P, V.value, Q);
            return
        }
        var R = G(stash.feature.fileContent.codemirror.searchQuery());
        R.find(".search-button").on("click", function(W) {
            H(P, G(W.target).closest(".aui-button").data("rev"))
        }).tooltip();
        var T = R.find("input")[0];
        T.onkeydown = function(Z) {
            S.query = undefined;
            var W = M.isMac();
            var X = String.fromCharCode(Z.keyCode);
            var Y = ((W && Z.metaKey && !Z.ctrlKey) || (!W && !Z.metaKey && Z.ctrlKey));
            if (X === "F" && Y && !Z.shiftKey && !Z.altKey) {
                Z.preventDefault()
            } else {
                if (X === "G" && Y && !Z.shiftKey && !Z.altKey) {
                    Z.preventDefault();
                    I(P, T.value)
                } else {
                    if (X === "G" && Y && Z.shiftKey && !Z.altKey) {
                        Z.preventDefault();
                        I(P, T.value, true)
                    }
                }
            }
        }
        ;
        S.dialogEl = R[0];
        var U = {
            value: P.getSelection() || S.query,
            closeOnEnter: false,
            closeOnBlur: false,
            onClose: function() {
                O(P, S);
                S.dialogEl = S.cursor = null
            }
        };
        P.openDialog(S.dialogEl, function(W, X) {
            X.preventDefault();
            I(P, W)
        }, U);
        I(P, U.value, Q)
    }
    function H(P, Q) {
        P.operation(function() {
            var U = F(P);
            if (!U.query || !U.dialogEl) {
                J(P, Q);
                return
            }
            if (!U.cursor) {
                if (Q) {
                    P.execCommand("goCharLeft")
                }
                U.cursor = L(P, U.query, P.getCursor())
            }
            if (!U.cursor.find(Q)) {
                U.cursor = L(P, U.query, Q ? E.Pos(P.lastLine()) : E.Pos(P.firstLine(), 0));
                if (!U.cursor.find(Q)) {
                    return
                }
            }
            P.setSelection(U.cursor.from(), U.cursor.to());
            var V = {
                from: U.cursor.from(),
                to: U.cursor.to()
            };
            var S = P.getOption("scrollLineIntoViewFunc");
            if (S) {
                S(V);
                var R = P.charCoords(V.from, "local");
                var T = P.getScrollInfo();
                if (T.left > R.left || T.left + T.clientWidth < R.left) {
                    P.scrollTo(Math.max(0, R.left - 20), null)
                }
            } else {
                P.scrollIntoView(V, 100)
            }
        })
    }
    function C(P, R) {
        var Q = F(P);
        if (R.length === 0) {
            O(P, Q)
        } else {
            Q.query = D(R);
            B(P, Q)
        }
    }
    E.defineOption("scrollLineIntoViewFunc", null);
    E.commands.find = J;
    E.commands.findNext = H;
    E.commands.findPrev = function(P) {
        return H(P, true)
    }
    ;
    E.commands.highlight = C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:stash-codemirror', location = '/static/feature/file-content/stash-codemirror/codemirror-search.soy' */
// This file was automatically generated from codemirror-search.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.codemirror.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.codemirror == 'undefined') {
    stash.feature.fileContent.codemirror = {};
}

stash.feature.fileContent.codemirror.searchQuery = function(opt_data, opt_ignored) {
    return '<div class="codemirror-search-query">' + soy.$$escapeHtml("Search:") + '<div class="search-box"><input class="search-query" type="text" style="width: 10em"/></div>' + aui.buttons.buttons({
        content: '' + aui.buttons.button({
            text: '',
            iconType: 'aui',
            iconClass: 'aui-icon-small aui-iconfont-up',
            extraClasses: ['search-button'],
            extraAttributes: {
                type: 'button',
                'data-rev': 'true',
                title: "Previous match"
            }
        }) + aui.buttons.button({
            text: '',
            iconType: 'aui',
            iconClass: 'aui-icon-small aui-iconfont-down',
            extraClasses: ['search-button'],
            extraAttributes: {
                type: 'button',
                title: "Next match"
            }
        })
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.codemirror.searchQuery.soyTemplateName = 'stash.feature.fileContent.codemirror.searchQuery';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:stash-codemirror', location = '/static/feature/file-content/stash-codemirror/stash-codemirror.js' */
define("feature/file-content/stash-codemirror", ["aui", "codemirror", "jquery", "lodash", "util/function", "feature/file-content/stash-codemirror/stash-scrollbar"], function(L, D, E, M, J) {
    function H(O) {
        O.on("keydown", function(P, Q) {
            if (Q.which >= 37 && Q.which <= 40 && !Q.shiftKey && !P.somethingSelected()) {
                P.getInputField().blur()
            }
        })
    }
    function K(P) {
        var O = false;
        var Q = J.lazyDelay(function() {
            var R;
            if (!O) {
                R = P.lineAtHeight(P.getScrollInfo().top + P.heightAtLine(0));
                P.setSelection({
                    line: R + 1,
                    ch: 0
                })
            }
            O = false
        }, 10);
        P.on("contextmenu", function() {
            O = true
        });
        P.on("blur", function(R) {
            if (R.somethingSelected()) {
                Q()
            }
            O = false
        })
    }
    function B(O) {
        O.on("keydown", F);
        O.on("keypress", F)
    }
    var I = {};
    I[L.keyCode.TAB] = true;
    function G(P) {
        var O = P.which || P.keyCode;
        return !!I[O]
    }
    var A = ["which", "keyCode", "shiftKey", "ctrlKey", "metaKey"];
    function F(P, Q) {
        var O = M.extend(jQuery.Event(Q.type), M.pick(Q, A));
        E(document).trigger(O);
        Q.codemirrorIgnore = G(Q)
    }
    function N(R) {
        var Q = {};
        var O = Array.prototype.slice.call(arguments, 1);
        var P = J.spread(function(T, S) {
            Q[T] = S !== undefined ? M.compose(J.constant(S), R[T].bind(R)) : R[T].bind(R)
        });
        O.forEach(J.unary(P));
        return Q
    }
    function C(R, O) {
        var P = new D(R,E.extend({
            mode: "text/plain",
            readOnly: true,
            lineNumbers: false,
            wholeLineUpdateBefore: false,
            scrollbarStyle: "stash",
            cursorBlinkRate: 0,
            styleSelectedText: true,
            theme: "stash-default"
        }, {
            viewportMargin: O && O.autoResizing ? Infinity : undefined
        }, O));
        E(P.getWrapperElement()).find(".CodeMirror-lines, .CodeMirror-code").attr("data-skate-ignore", "true");
        if (O && O.autoResizing) {
            R.className += " codemirror-auto-resizing-container"
        }
        H(P);
        B(P);
        K(P);
        var Q = N(P, ["addLineClass", this], "addLineWidget", "charCoords", "execCommand", "getDoc", "getInputField", "getLine", "getLineHandle", "getLineNumber", "getOption", "getScrollInfo", "getWrapperElement", "heightAtLine", "lastLine", "lineAtHeight", ["markText", this], ["off", this], ["on", this], ["refresh", this], ["removeLineClass", this], "replaceRange", ["scrollIntoView", this], ["scrollTo", this], ["setGutterMarker", this], ["setOption", this], ["setSelection", this], ["setValue", this]);
        E.extend(this, Q);
        this.operation = function(S) {
            P.operation(J.unary(M.partial(S, this)));
            return this
        }
        ;
        this._highlight = function(S) {
            D.commands.highlight(P, S)
        }
        ;
        this._insert = function(Z, T, V) {
            var X = 0 === T;
            var U = T - 1;
            var S = P.getOption("wholeLineUpdateBefore");
            P.setOption("wholeLineUpdateBefore", X);
            var Y = P.getDoc();
            var W = {
                line: U,
                ch: X ? 0 : P.getLine(U).length
            };
            Y.replaceRange(X ? Z + "\n" : "\n" + Z, W);
            if (V) {
                Y.setSelection({
                    line: U,
                    ch: 0
                })
            }
            P.setOption("wholeLineUpdateBefore", S)
        }
        ;
        return this
    }
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:stash-codemirror', location = '/static/feature/file-content/stash-codemirror/stash-scrollbar.js' */
define("feature/file-content/stash-codemirror/stash-scrollbar", ["codemirror", "jquery"], function(A, B) {
    function C(F, E, D) {
        this.cm = D;
        var G = B("<div>").css("height", "100%").css("min-height", "1px");
        var H = this.horiz = B("<div>").addClass("CodeMirror-hscrollbar").css("min-height", "18px").append(G)[0];
        F(H);
        A.on(H, "scroll", function() {
            if (H.clientWidth) {
                E(H.scrollLeft, "horizontal")
            }
        })
    }
    C.prototype = {
        update: function(D) {
            var E = D.scrollWidth > D.clientWidth + 1;
            var F = D.nativeBarWidth;
            if (E) {
                this.horiz.style.display = "block";
                this.horiz.style.right = "0";
                this.horiz.style.left = D.barLeft + "px";
                this.horiz.firstChild.style.width = (D.scrollWidth - D.clientWidth + (D.barWidth || this.horiz.clientWidth)) + "px"
            } else {
                this.horiz.style.display = "";
                this.horiz.firstChild.style.width = "0"
            }
            return {
                right: 0,
                bottom: E ? F : 0
            }
        },
        setScrollLeft: function(D) {
            if (this.horiz.scrollLeft !== D) {
                this.horiz.scrollLeft = D
            }
        },
        setScrollTop: function(D) {},
        clear: function() {
            var D = this.horiz.parentNode;
            D.removeChild(this.horiz);
            D.removeChild(this.vert)
        }
    };
    A.scrollbarModel.stash = C
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:clike', location = '/static/bower/CodeMirror/mode/clike/clike.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(B) {
    B.defineMode("clike", function(a, M) {
        var U = a.indentUnit
          , S = M.statementIndentUnit || U
          , V = M.dontAlignCalls
          , O = M.keywords || {}
          , b = M.builtin || {}
          , W = M.blockKeywords || {}
          , K = M.atoms || {}
          , J = M.hooks || {}
          , R = M.multiLineStrings
          , P = M.indentStatements !== false;
        var Q = /[+\-*&%=<>!?|\/]/;
        var Y;
        function c(h, f) {
            var e = h.next();
            if (J[e]) {
                var d = J[e](h, f);
                if (d !== false) {
                    return d
                }
            }
            if (e == '"' || e == "'") {
                f.tokenize = N(e);
                return f.tokenize(h, f)
            }
            if (/[\[\]{}\(\),;\:\.]/.test(e)) {
                Y = e;
                return null
            }
            if (/\d/.test(e)) {
                h.eatWhile(/[\w\.]/);
                return "number"
            }
            if (e == "/") {
                if (h.eat("*")) {
                    f.tokenize = T;
                    return T(h, f)
                }
                if (h.eat("/")) {
                    h.skipToEnd();
                    return "comment"
                }
            }
            if (Q.test(e)) {
                h.eatWhile(Q);
                return "operator"
            }
            h.eatWhile(/[\w\$_\xa1-\uffff]/);
            var g = h.current();
            if (O.propertyIsEnumerable(g)) {
                if (W.propertyIsEnumerable(g)) {
                    Y = "newstatement"
                }
                return "keyword"
            }
            if (b.propertyIsEnumerable(g)) {
                if (W.propertyIsEnumerable(g)) {
                    Y = "newstatement"
                }
                return "builtin"
            }
            if (K.propertyIsEnumerable(g)) {
                return "atom"
            }
            return "variable"
        }
        function N(d) {
            return function(i, g) {
                var h = false, f, e = false;
                while ((f = i.next()) != null) {
                    if (f == d && !h) {
                        e = true;
                        break
                    }
                    h = !h && f == "\\"
                }
                if (e || !(h || R)) {
                    g.tokenize = null
                }
                return "string"
            }
        }
        function T(g, f) {
            var d = false, e;
            while (e = g.next()) {
                if (e == "/" && d) {
                    f.tokenize = null;
                    break
                }
                d = (e == "*")
            }
            return "comment"
        }
        function X(h, e, d, g, f) {
            this.indented = h;
            this.column = e;
            this.type = d;
            this.align = g;
            this.prev = f
        }
        function L(g, e, f) {
            var d = g.indented;
            if (g.context && g.context.type == "statement") {
                d = g.context.indented
            }
            return g.context = new X(d,e,f,null,g.context)
        }
        function Z(e) {
            var d = e.context.type;
            if (d == ")" || d == "]" || d == "}") {
                e.indented = e.context.indented
            }
            return e.context = e.context.prev
        }
        return {
            startState: function(d) {
                return {
                    tokenize: null,
                    context: new X((d || 0) - U,0,"top",false),
                    indented: 0,
                    startOfLine: true
                }
            },
            token: function(g, f) {
                var d = f.context;
                if (g.sol()) {
                    if (d.align == null) {
                        d.align = false
                    }
                    f.indented = g.indentation();
                    f.startOfLine = true
                }
                if (g.eatSpace()) {
                    return null
                }
                Y = null;
                var e = (f.tokenize || c)(g, f);
                if (e == "comment" || e == "meta") {
                    return e
                }
                if (d.align == null) {
                    d.align = true
                }
                if ((Y == ";" || Y == ":" || Y == ",") && d.type == "statement") {
                    Z(f)
                } else {
                    if (Y == "{") {
                        L(f, g.column(), "}")
                    } else {
                        if (Y == "[") {
                            L(f, g.column(), "]")
                        } else {
                            if (Y == "(") {
                                L(f, g.column(), ")")
                            } else {
                                if (Y == "}") {
                                    while (d.type == "statement") {
                                        d = Z(f)
                                    }
                                    if (d.type == "}") {
                                        d = Z(f)
                                    }
                                    while (d.type == "statement") {
                                        d = Z(f)
                                    }
                                } else {
                                    if (Y == d.type) {
                                        Z(f)
                                    } else {
                                        if (P && (((d.type == "}" || d.type == "top") && Y != ";") || (d.type == "statement" && Y == "newstatement"))) {
                                            L(f, g.column(), "statement")
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                f.startOfLine = false;
                return e
            },
            indent: function(h, e) {
                if (h.tokenize != c && h.tokenize != null) {
                    return B.Pass
                }
                var d = h.context
                  , g = e && e.charAt(0);
                if (d.type == "statement" && g == "}") {
                    d = d.prev
                }
                var f = g == d.type;
                if (d.type == "statement") {
                    return d.indented + (g == "{" ? 0 : S)
                } else {
                    if (d.align && (!V || d.type != ")")) {
                        return d.column + (f ? 0 : 1)
                    } else {
                        if (d.type == ")" && !f) {
                            return d.indented + S
                        } else {
                            return d.indented + (f ? 0 : U)
                        }
                    }
                }
            },
            electricChars: "{}",
            blockCommentStart: "/*",
            blockCommentEnd: "*/",
            lineComment: "//",
            fold: "brace"
        }
    });
    function F(M) {
        var K = {}
          , L = M.split(" ");
        for (var J = 0; J < L.length; ++J) {
            K[L[J]] = true
        }
        return K
    }
    var I = "auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile";
    function C(K, J) {
        if (!J.startOfLine) {
            return false
        }
        for (; ; ) {
            if (K.skipTo("\\")) {
                K.next();
                if (K.eol()) {
                    J.tokenize = C;
                    break
                }
            } else {
                K.skipToEnd();
                J.tokenize = null;
                break
            }
        }
        return "meta"
    }
    function H(L, K) {
        L.backUp(1);
        if (L.match(/(R|u8R|uR|UR|LR)/)) {
            var J = L.match(/"([^\s\\()]{0,16})\(/);
            if (!J) {
                return false
            }
            K.cpp11RawStringDelim = J[1];
            K.tokenize = E;
            return E(L, K)
        }
        if (L.match(/(u8|u|U|L)/)) {
            if (L.match(/["']/, false)) {
                return "string"
            }
            return false
        }
        L.next();
        return false
    }
    function G(L, K) {
        var J;
        while ((J = L.next()) != null) {
            if (J == '"' && !L.eat('"')) {
                K.tokenize = null;
                break
            }
        }
        return "string"
    }
    function E(M, K) {
        var L = K.cpp11RawStringDelim.replace(/[^\w\s]/g, "\\$&");
        var J = M.match(new RegExp(".*?\\)" + L + '"'));
        if (J) {
            K.tokenize = null
        } else {
            M.skipToEnd()
        }
        return "string"
    }
    function A(J, N) {
        if (typeof J == "string") {
            J = [J]
        }
        var M = [];
        function L(O) {
            if (O) {
                for (var P in O) {
                    if (O.hasOwnProperty(P)) {
                        M.push(P)
                    }
                }
            }
        }
        L(N.keywords);
        L(N.builtin);
        L(N.atoms);
        if (M.length) {
            N.helperType = J[0];
            B.registerHelper("hintWords", J[0], M)
        }
        for (var K = 0; K < J.length; ++K) {
            B.defineMIME(J[K], N)
        }
    }
    A(["text/x-csrc", "text/x-c", "text/x-chdr"], {
        name: "clike",
        keywords: F(I),
        blockKeywords: F("case do else for if switch while struct"),
        atoms: F("null"),
        hooks: {
            "#": C
        },
        modeProps: {
            fold: ["brace", "include"]
        }
    });
    A(["text/x-c++src", "text/x-c++hdr"], {
        name: "clike",
        keywords: F(I + " asm dynamic_cast namespace reinterpret_cast try bool explicit new static_cast typeid catch operator template typename class friend private this using const_cast inline public throw virtual delete mutable protected wchar_t alignas alignof constexpr decltype nullptr noexcept thread_local final static_assert override"),
        blockKeywords: F("catch class do else finally for if struct switch try while"),
        atoms: F("true false null"),
        hooks: {
            "#": C,
            u: H,
            U: H,
            L: H,
            R: H
        },
        modeProps: {
            fold: ["brace", "include"]
        }
    });
    A("text/x-java", {
        name: "clike",
        keywords: F("abstract assert boolean break byte case catch char class const continue default do double else enum extends final finally float for goto if implements import instanceof int interface long native new package private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),
        blockKeywords: F("catch class do else finally for if switch try while"),
        atoms: F("true false null"),
        hooks: {
            "@": function(J) {
                J.eatWhile(/[\w\$_]/);
                return "meta"
            }
        },
        modeProps: {
            fold: ["brace", "import"]
        }
    });
    A("text/x-csharp", {
        name: "clike",
        keywords: F("abstract as base break case catch checked class const continue default delegate do else enum event explicit extern finally fixed for foreach goto if implicit in interface internal is lock namespace new operator out override params private protected public readonly ref return sealed sizeof stackalloc static struct switch this throw try typeof unchecked unsafe using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),
        blockKeywords: F("catch class do else finally for foreach if struct switch try while"),
        builtin: F("Boolean Byte Char DateTime DateTimeOffset Decimal Double Guid Int16 Int32 Int64 Object SByte Single String TimeSpan UInt16 UInt32 UInt64 bool byte char decimal double short int long object sbyte float string ushort uint ulong"),
        atoms: F("true false null"),
        hooks: {
            "@": function(K, J) {
                if (K.eat('"')) {
                    J.tokenize = G;
                    return G(K, J)
                }
                K.eatWhile(/[\w\$_]/);
                return "meta"
            }
        }
    });
    function D(L, J) {
        var K = false;
        while (!L.eol()) {
            if (!K && L.match('"""')) {
                J.tokenize = null;
                break
            }
            K = L.next() != "\\" && !K
        }
        return "string"
    }
    A("text/x-scala", {
        name: "clike",
        keywords: F("abstract case catch class def do else extends false final finally for forSome if implicit import lazy match new null object override package private protected return sealed super this throw trait try trye type val var while with yield _ : = => <- <: <% >: # @ assert assume require print println printf readLine readBoolean readByte readShort readChar readInt readLong readFloat readDouble AnyVal App Application Array BufferedIterator BigDecimal BigInt Char Console Either Enumeration Equiv Error Exception Fractional Function IndexedSeq Integral Iterable Iterator List Map Numeric Nil NotNull Option Ordered Ordering PartialFunction PartialOrdering Product Proxy Range Responder Seq Serializable Set Specializable Stream StringBuilder StringContext Symbol Throwable Traversable TraversableOnce Tuple Unit Vector :: #:: Boolean Byte Character CharSequence Class ClassLoader Cloneable Comparable Compiler Double Exception Float Integer Long Math Number Object Package Pair Process Runtime Runnable SecurityManager Short StackTraceElement StrictMath String StringBuffer System Thread ThreadGroup ThreadLocal Throwable Triple Void"),
        multiLineStrings: true,
        blockKeywords: F("catch class do else finally for forSome if match switch try while"),
        atoms: F("true false null"),
        indentStatements: false,
        hooks: {
            "@": function(J) {
                J.eatWhile(/[\w\$_]/);
                return "meta"
            },
            '"': function(K, J) {
                if (!K.match('""')) {
                    return false
                }
                J.tokenize = D;
                return J.tokenize(K, J)
            }
        }
    });
    A(["x-shader/x-vertex", "x-shader/x-fragment"], {
        name: "clike",
        keywords: F("float int bool void vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 mat2 mat3 mat4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow const attribute uniform varying break continue discard return for while do if else struct in out inout"),
        blockKeywords: F("for while do if else struct"),
        builtin: F("radians degrees sin cos tan asin acos atan pow exp log exp2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize ftransform faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not texture1D texture1DProj texture1DLod texture1DProjLod texture2D texture2DProj texture2DLod texture2DProjLod texture3D texture3DProj texture3DLod texture3DProjLod textureCube textureCubeLod shadow1D shadow2D shadow1DProj shadow2DProj shadow1DLod shadow2DLod shadow1DProjLod shadow2DProjLod dFdx dFdy fwidth noise1 noise2 noise3 noise4"),
        atoms: F("true false gl_FragColor gl_SecondaryColor gl_Normal gl_Vertex gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_FogCoord gl_PointCoord gl_Position gl_PointSize gl_ClipVertex gl_FrontColor gl_BackColor gl_FrontSecondaryColor gl_BackSecondaryColor gl_TexCoord gl_FogFragCoord gl_FragCoord gl_FrontFacing gl_FragData gl_FragDepth gl_ModelViewMatrix gl_ProjectionMatrix gl_ModelViewProjectionMatrix gl_TextureMatrix gl_NormalMatrix gl_ModelViewMatrixInverse gl_ProjectionMatrixInverse gl_ModelViewProjectionMatrixInverse gl_TexureMatrixTranspose gl_ModelViewMatrixInverseTranspose gl_ProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixInverseTranspose gl_TextureMatrixInverseTranspose gl_NormalScale gl_DepthRange gl_ClipPlane gl_Point gl_FrontMaterial gl_BackMaterial gl_LightSource gl_LightModel gl_FrontLightModelProduct gl_BackLightModelProduct gl_TextureColor gl_EyePlaneS gl_EyePlaneT gl_EyePlaneR gl_EyePlaneQ gl_FogParameters gl_MaxLights gl_MaxClipPlanes gl_MaxTextureUnits gl_MaxTextureCoords gl_MaxVertexAttribs gl_MaxVertexUniformComponents gl_MaxVaryingFloats gl_MaxVertexTextureImageUnits gl_MaxTextureImageUnits gl_MaxFragmentUniformComponents gl_MaxCombineTextureImageUnits gl_MaxDrawBuffers"),
        hooks: {
            "#": C
        },
        modeProps: {
            fold: ["brace", "include"]
        }
    });
    A("text/x-nesc", {
        name: "clike",
        keywords: F(I + "as atomic async call command component components configuration event generic implementation includes interface module new norace nx_struct nx_union post provides signal task uses abstract extends"),
        blockKeywords: F("case do else for if switch while struct"),
        atoms: F("null"),
        hooks: {
            "#": C
        },
        modeProps: {
            fold: ["brace", "include"]
        }
    });
    A("text/x-objectivec", {
        name: "clike",
        keywords: F(I + "inline restrict _Bool _Complex _Imaginery BOOL Class bycopy byref id IMP in inout nil oneway out Protocol SEL self super atomic nonatomic retain copy readwrite readonly"),
        atoms: F("YES NO NULL NILL ON OFF"),
        hooks: {
            "@": function(J) {
                J.eatWhile(/[\w\$]/);
                return "keyword"
            },
            "#": C
        },
        modeProps: {
            fold: "brace"
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:commonlisp', location = '/static/bower/CodeMirror/mode/commonlisp/commonlisp.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("commonlisp", function(C) {
        var H = /^(block|let*|return-from|catch|load-time-value|setq|eval-when|locally|symbol-macrolet|flet|macrolet|tagbody|function|multiple-value-call|the|go|multiple-value-prog1|throw|if|progn|unwind-protect|labels|progv|let|quote)$/;
        var K = /^with|^def|^do|^prog|case$|^cond$|bind$|when$|unless$/;
        var G = /^(?:[+\-]?(?:\d+|\d*\.\d+)(?:[efd][+\-]?\d+)?|[+\-]?\d+(?:\/[+\-]?\d+)?|#b[+\-]?[01]+|#o[+\-]?[0-7]+|#x[+\-]?[\da-f]+)/;
        var D = /[^\s'`,@()\[\]";]/;
        var I;
        function F(M) {
            var L;
            while (L = M.next()) {
                if (L == "\\") {
                    M.next()
                } else {
                    if (!D.test(L)) {
                        M.backUp(1);
                        break
                    }
                }
            }
            return M.current()
        }
        function B(O, N) {
            if (O.eatSpace()) {
                I = "ws";
                return null
            }
            if (O.match(G)) {
                return "number"
            }
            var M = O.next();
            if (M == "\\") {
                M = O.next()
            }
            if (M == '"') {
                return (N.tokenize = E)(O, N)
            } else {
                if (M == "(") {
                    I = "open";
                    return "bracket"
                } else {
                    if (M == ")" || M == "]") {
                        I = "close";
                        return "bracket"
                    } else {
                        if (M == ";") {
                            O.skipToEnd();
                            I = "ws";
                            return "comment"
                        } else {
                            if (/['`,@]/.test(M)) {
                                return null
                            } else {
                                if (M == "|") {
                                    if (O.skipTo("|")) {
                                        O.next();
                                        return "symbol"
                                    } else {
                                        O.skipToEnd();
                                        return "error"
                                    }
                                } else {
                                    if (M == "#") {
                                        var M = O.next();
                                        if (M == "[") {
                                            I = "open";
                                            return "bracket"
                                        } else {
                                            if (/[+\-=\.']/.test(M)) {
                                                return null
                                            } else {
                                                if (/\d/.test(M) && O.match(/^\d*#/)) {
                                                    return null
                                                } else {
                                                    if (M == "|") {
                                                        return (N.tokenize = J)(O, N)
                                                    } else {
                                                        if (M == ":") {
                                                            F(O);
                                                            return "meta"
                                                        } else {
                                                            return "error"
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    } else {
                                        var L = F(O);
                                        if (L == ".") {
                                            return null
                                        }
                                        I = "symbol";
                                        if (L == "nil" || L == "t" || L.charAt(0) == ":") {
                                            return "atom"
                                        }
                                        if (N.lastType == "open" && (H.test(L) || K.test(L))) {
                                            return "keyword"
                                        }
                                        if (L.charAt(0) == "&") {
                                            return "variable-2"
                                        }
                                        return "variable"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        function E(O, M) {
            var N = false, L;
            while (L = O.next()) {
                if (L == '"' && !N) {
                    M.tokenize = B;
                    break
                }
                N = !N && L == "\\"
            }
            return "string"
        }
        function J(O, N) {
            var L, M;
            while (L = O.next()) {
                if (L == "#" && M == "|") {
                    N.tokenize = B;
                    break
                }
                M = L
            }
            I = "ws";
            return "comment"
        }
        return {
            startState: function() {
                return {
                    ctx: {
                        prev: null,
                        start: 0,
                        indentTo: 0
                    },
                    lastType: null,
                    tokenize: B
                }
            },
            token: function(N, M) {
                if (N.sol() && typeof M.ctx.indentTo != "number") {
                    M.ctx.indentTo = M.ctx.start + 1
                }
                I = null;
                var L = M.tokenize(N, M);
                if (I != "ws") {
                    if (M.ctx.indentTo == null) {
                        if (I == "symbol" && K.test(N.current())) {
                            M.ctx.indentTo = M.ctx.start + C.indentUnit
                        } else {
                            M.ctx.indentTo = "next"
                        }
                    } else {
                        if (M.ctx.indentTo == "next") {
                            M.ctx.indentTo = N.column()
                        }
                    }
                    M.lastType = I
                }
                if (I == "open") {
                    M.ctx = {
                        prev: M.ctx,
                        start: N.column(),
                        indentTo: null
                    }
                } else {
                    if (I == "close") {
                        M.ctx = M.ctx.prev || M.ctx
                    }
                }
                return L
            },
            indent: function(N, L) {
                var M = N.ctx.indentTo;
                return typeof M == "number" ? M : N.ctx.start + 1
            },
            lineComment: ";;",
            blockCommentStart: "#|",
            blockCommentEnd: "|#"
        }
    });
    A.defineMIME("text/x-common-lisp", "commonlisp")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:css', location = '/static/bower/CodeMirror/mode/css/css.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(N) {
    N.defineMode("css", function(o, c) {
        if (!c.propertyKeywords) {
            c = N.resolveMode("text/css")
        }
        var i = o.indentUnit
          , U = c.tokenHooks
          , n = c.mediaTypes || {}
          , e = c.mediaFeatures || {}
          , b = c.propertyKeywords || {}
          , V = c.nonStandardPropertyKeywords || {}
          , h = c.colorKeywords || {}
          , k = c.valueKeywords || {}
          , X = c.fontProperties || {}
          , f = c.allowNested;
        var W, g;
        function p(s, t) {
            W = t;
            return s
        }
        function r(v, u) {
            var t = v.next();
            if (U[t]) {
                var s = U[t](v, u);
                if (s !== false) {
                    return s
                }
            }
            if (t == "@") {
                v.eatWhile(/[\w\\\-]/);
                return p("def", v.current())
            } else {
                if (t == "=" || (t == "~" || t == "|") && v.eat("=")) {
                    return p(null, "compare")
                } else {
                    if (t == '"' || t == "'") {
                        u.tokenize = d(t);
                        return u.tokenize(v, u)
                    } else {
                        if (t == "#") {
                            v.eatWhile(/[\w\\\-]/);
                            return p("atom", "hash")
                        } else {
                            if (t == "!") {
                                v.match(/^\s*\w*/);
                                return p("keyword", "important")
                            } else {
                                if (/\d/.test(t) || t == "." && v.eat(/\d/)) {
                                    v.eatWhile(/[\w.%]/);
                                    return p("number", "unit")
                                } else {
                                    if (t === "-") {
                                        if (/[\d.]/.test(v.peek())) {
                                            v.eatWhile(/[\w.%]/);
                                            return p("number", "unit")
                                        } else {
                                            if (v.match(/^\w+-/)) {
                                                return p("meta", "meta")
                                            }
                                        }
                                    } else {
                                        if (/[,+>*\/]/.test(t)) {
                                            return p(null, "select-op")
                                        } else {
                                            if (t == "." && v.match(/^-?[_a-z][_a-z0-9-]*/i)) {
                                                return p("qualifier", "qualifier")
                                            } else {
                                                if (/[:;{}\[\]\(\)]/.test(t)) {
                                                    return p(null, t)
                                                } else {
                                                    if (t == "u" && v.match("rl(")) {
                                                        v.backUp(1);
                                                        u.tokenize = q;
                                                        return p("property", "word")
                                                    } else {
                                                        if (/[\w\\\-]/.test(t)) {
                                                            v.eatWhile(/[\w\\\-]/);
                                                            return p("property", "word")
                                                        } else {
                                                            return p(null, null)
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        function d(s) {
            return function(w, u) {
                var v = false, t;
                while ((t = w.next()) != null) {
                    if (t == s && !v) {
                        if (s == ")") {
                            w.backUp(1)
                        }
                        break
                    }
                    v = !v && t == "\\"
                }
                if (t == s || !v && s != ")") {
                    u.tokenize = null
                }
                return p("string", "string")
            }
        }
        function q(t, s) {
            t.next();
            if (!t.match(/\s*[\"\')]/, false)) {
                s.tokenize = d(")")
            } else {
                s.tokenize = null
            }
            return p(null, "(")
        }
        function j(t, s, u) {
            this.type = t;
            this.indent = s;
            this.prev = u
        }
        function Z(t, u, s) {
            t.context = new j(s,u.indentation() + i,t.context);
            return s
        }
        function l(s) {
            s.context = s.context.prev;
            return s.context.type
        }
        function T(s, u, t) {
            return Y[t.context.type](s, u, t)
        }
        function m(t, v, u, w) {
            for (var s = w || 1; s > 0; s--) {
                u.context = u.context.prev
            }
            return T(t, v, u)
        }
        function a(t) {
            var s = t.current().toLowerCase();
            if (k.hasOwnProperty(s)) {
                g = "atom"
            } else {
                if (h.hasOwnProperty(s)) {
                    g = "keyword"
                } else {
                    g = "variable"
                }
            }
        }
        var Y = {};
        Y.top = function(s, u, t) {
            if (s == "{") {
                return Z(t, u, "block")
            } else {
                if (s == "}" && t.context.prev) {
                    return l(t)
                } else {
                    if (s == "@media") {
                        return Z(t, u, "media")
                    } else {
                        if (s == "@font-face") {
                            return "font_face_before"
                        } else {
                            if (/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(s)) {
                                return "keyframes"
                            } else {
                                if (s && s.charAt(0) == "@") {
                                    return Z(t, u, "at")
                                } else {
                                    if (s == "hash") {
                                        g = "builtin"
                                    } else {
                                        if (s == "word") {
                                            g = "tag"
                                        } else {
                                            if (s == "variable-definition") {
                                                return "maybeprop"
                                            } else {
                                                if (s == "interpolation") {
                                                    return Z(t, u, "interpolation")
                                                } else {
                                                    if (s == ":") {
                                                        return "pseudo"
                                                    } else {
                                                        if (f && s == "(") {
                                                            return Z(t, u, "parens")
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            return t.context.type
        }
        ;
        Y.block = function(s, v, t) {
            if (s == "word") {
                var u = v.current().toLowerCase();
                if (b.hasOwnProperty(u)) {
                    g = "property";
                    return "maybeprop"
                } else {
                    if (V.hasOwnProperty(u)) {
                        g = "string-2";
                        return "maybeprop"
                    } else {
                        if (f) {
                            g = v.match(/^\s*:(?:\s|$)/, false) ? "property" : "tag";
                            return "block"
                        } else {
                            g += " error";
                            return "maybeprop"
                        }
                    }
                }
            } else {
                if (s == "meta") {
                    return "block"
                } else {
                    if (!f && (s == "hash" || s == "qualifier")) {
                        g = "error";
                        return "block"
                    } else {
                        return Y.top(s, v, t)
                    }
                }
            }
        }
        ;
        Y.maybeprop = function(s, u, t) {
            if (s == ":") {
                return Z(t, u, "prop")
            }
            return T(s, u, t)
        }
        ;
        Y.prop = function(s, u, t) {
            if (s == ";") {
                return l(t)
            }
            if (s == "{" && f) {
                return Z(t, u, "propBlock")
            }
            if (s == "}" || s == "{") {
                return m(s, u, t)
            }
            if (s == "(") {
                return Z(t, u, "parens")
            }
            if (s == "hash" && !/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(u.current())) {
                g += " error"
            } else {
                if (s == "word") {
                    a(u)
                } else {
                    if (s == "interpolation") {
                        return Z(t, u, "interpolation")
                    }
                }
            }
            return "prop"
        }
        ;
        Y.propBlock = function(t, s, u) {
            if (t == "}") {
                return l(u)
            }
            if (t == "word") {
                g = "property";
                return "maybeprop"
            }
            return u.context.type
        }
        ;
        Y.parens = function(s, u, t) {
            if (s == "{" || s == "}") {
                return m(s, u, t)
            }
            if (s == ")") {
                return l(t)
            }
            if (s == "(") {
                return Z(t, u, "parens")
            }
            if (s == "word") {
                a(u)
            }
            return "parens"
        }
        ;
        Y.pseudo = function(s, u, t) {
            if (s == "word") {
                g = "variable-3";
                return t.context.type
            }
            return T(s, u, t)
        }
        ;
        Y.media = function(s, v, t) {
            if (s == "(") {
                return Z(t, v, "media_parens")
            }
            if (s == "}") {
                return m(s, v, t)
            }
            if (s == "{") {
                return l(t) && Z(t, v, f ? "block" : "top")
            }
            if (s == "word") {
                var u = v.current().toLowerCase();
                if (u == "only" || u == "not" || u == "and") {
                    g = "keyword"
                } else {
                    if (n.hasOwnProperty(u)) {
                        g = "attribute"
                    } else {
                        if (e.hasOwnProperty(u)) {
                            g = "property"
                        } else {
                            g = "error"
                        }
                    }
                }
            }
            return t.context.type
        }
        ;
        Y.media_parens = function(s, u, t) {
            if (s == ")") {
                return l(t)
            }
            if (s == "{" || s == "}") {
                return m(s, u, t, 2)
            }
            return Y.media(s, u, t)
        }
        ;
        Y.font_face_before = function(s, u, t) {
            if (s == "{") {
                return Z(t, u, "font_face")
            }
            return T(s, u, t)
        }
        ;
        Y.font_face = function(s, u, t) {
            if (s == "}") {
                return l(t)
            }
            if (s == "word") {
                if (!X.hasOwnProperty(u.current().toLowerCase())) {
                    g = "error"
                } else {
                    g = "property"
                }
                return "maybeprop"
            }
            return "font_face"
        }
        ;
        Y.keyframes = function(s, u, t) {
            if (s == "word") {
                g = "variable";
                return "keyframes"
            }
            if (s == "{") {
                return Z(t, u, "top")
            }
            return T(s, u, t)
        }
        ;
        Y.at = function(s, u, t) {
            if (s == ";") {
                return l(t)
            }
            if (s == "{" || s == "}") {
                return m(s, u, t)
            }
            if (s == "word") {
                g = "tag"
            } else {
                if (s == "hash") {
                    g = "builtin"
                }
            }
            return "at"
        }
        ;
        Y.interpolation = function(s, u, t) {
            if (s == "}") {
                return l(t)
            }
            if (s == "{" || s == ";") {
                return m(s, u, t)
            }
            if (s != "variable") {
                g = "error"
            }
            return "interpolation"
        }
        ;
        return {
            startState: function(s) {
                return {
                    tokenize: null,
                    state: "top",
                    context: new j("top",s || 0,null)
                }
            },
            token: function(u, t) {
                if (!t.tokenize && u.eatSpace()) {
                    return null
                }
                var s = (t.tokenize || r)(u, t);
                if (s && typeof s == "object") {
                    W = s[1];
                    s = s[0]
                }
                g = s;
                t.state = Y[t.state](W, u, t);
                return g
            },
            indent: function(w, u) {
                var t = w.context
                  , v = u && u.charAt(0);
                var s = t.indent;
                if (t.type == "prop" && (v == "}" || v == ")")) {
                    t = t.prev
                }
                if (t.prev && (v == "}" && (t.type == "block" || t.type == "top" || t.type == "interpolation" || t.type == "font_face") || v == ")" && (t.type == "parens" || t.type == "media_parens") || v == "{" && (t.type == "at" || t.type == "media"))) {
                    s = t.indent - i;
                    t = t.prev
                }
                return s
            },
            electricChars: "}",
            blockCommentStart: "/*",
            blockCommentEnd: "*/",
            fold: "brace"
        }
    });
    function F(V) {
        var U = {};
        for (var T = 0; T < V.length; ++T) {
            U[V[T]] = true
        }
        return U
    }
    var A = ["all", "aural", "braille", "handheld", "print", "projection", "screen", "tty", "tv", "embossed"]
      , Q = F(A);
    var S = ["width", "min-width", "max-width", "height", "min-height", "max-height", "device-width", "min-device-width", "max-device-width", "device-height", "min-device-height", "max-device-height", "aspect-ratio", "min-aspect-ratio", "max-aspect-ratio", "device-aspect-ratio", "min-device-aspect-ratio", "max-device-aspect-ratio", "color", "min-color", "max-color", "color-index", "min-color-index", "max-color-index", "monochrome", "min-monochrome", "max-monochrome", "resolution", "min-resolution", "max-resolution", "scan", "grid"]
      , I = F(S);
    var C = ["align-content", "align-items", "align-self", "alignment-adjust", "alignment-baseline", "anchor-point", "animation", "animation-delay", "animation-direction", "animation-duration", "animation-fill-mode", "animation-iteration-count", "animation-name", "animation-play-state", "animation-timing-function", "appearance", "azimuth", "backface-visibility", "background", "background-attachment", "background-clip", "background-color", "background-image", "background-origin", "background-position", "background-repeat", "background-size", "baseline-shift", "binding", "bleed", "bookmark-label", "bookmark-level", "bookmark-state", "bookmark-target", "border", "border-bottom", "border-bottom-color", "border-bottom-left-radius", "border-bottom-right-radius", "border-bottom-style", "border-bottom-width", "border-collapse", "border-color", "border-image", "border-image-outset", "border-image-repeat", "border-image-slice", "border-image-source", "border-image-width", "border-left", "border-left-color", "border-left-style", "border-left-width", "border-radius", "border-right", "border-right-color", "border-right-style", "border-right-width", "border-spacing", "border-style", "border-top", "border-top-color", "border-top-left-radius", "border-top-right-radius", "border-top-style", "border-top-width", "border-width", "bottom", "box-decoration-break", "box-shadow", "box-sizing", "break-after", "break-before", "break-inside", "caption-side", "clear", "clip", "color", "color-profile", "column-count", "column-fill", "column-gap", "column-rule", "column-rule-color", "column-rule-style", "column-rule-width", "column-span", "column-width", "columns", "content", "counter-increment", "counter-reset", "crop", "cue", "cue-after", "cue-before", "cursor", "direction", "display", "dominant-baseline", "drop-initial-after-adjust", "drop-initial-after-align", "drop-initial-before-adjust", "drop-initial-before-align", "drop-initial-size", "drop-initial-value", "elevation", "empty-cells", "fit", "fit-position", "flex", "flex-basis", "flex-direction", "flex-flow", "flex-grow", "flex-shrink", "flex-wrap", "float", "float-offset", "flow-from", "flow-into", "font", "font-feature-settings", "font-family", "font-kerning", "font-language-override", "font-size", "font-size-adjust", "font-stretch", "font-style", "font-synthesis", "font-variant", "font-variant-alternates", "font-variant-caps", "font-variant-east-asian", "font-variant-ligatures", "font-variant-numeric", "font-variant-position", "font-weight", "grid", "grid-area", "grid-auto-columns", "grid-auto-flow", "grid-auto-position", "grid-auto-rows", "grid-column", "grid-column-end", "grid-column-start", "grid-row", "grid-row-end", "grid-row-start", "grid-template", "grid-template-areas", "grid-template-columns", "grid-template-rows", "hanging-punctuation", "height", "hyphens", "icon", "image-orientation", "image-rendering", "image-resolution", "inline-box-align", "justify-content", "left", "letter-spacing", "line-break", "line-height", "line-stacking", "line-stacking-ruby", "line-stacking-shift", "line-stacking-strategy", "list-style", "list-style-image", "list-style-position", "list-style-type", "margin", "margin-bottom", "margin-left", "margin-right", "margin-top", "marker-offset", "marks", "marquee-direction", "marquee-loop", "marquee-play-count", "marquee-speed", "marquee-style", "max-height", "max-width", "min-height", "min-width", "move-to", "nav-down", "nav-index", "nav-left", "nav-right", "nav-up", "object-fit", "object-position", "opacity", "order", "orphans", "outline", "outline-color", "outline-offset", "outline-style", "outline-width", "overflow", "overflow-style", "overflow-wrap", "overflow-x", "overflow-y", "padding", "padding-bottom", "padding-left", "padding-right", "padding-top", "page", "page-break-after", "page-break-before", "page-break-inside", "page-policy", "pause", "pause-after", "pause-before", "perspective", "perspective-origin", "pitch", "pitch-range", "play-during", "position", "presentation-level", "punctuation-trim", "quotes", "region-break-after", "region-break-before", "region-break-inside", "region-fragment", "rendering-intent", "resize", "rest", "rest-after", "rest-before", "richness", "right", "rotation", "rotation-point", "ruby-align", "ruby-overhang", "ruby-position", "ruby-span", "shape-image-threshold", "shape-inside", "shape-margin", "shape-outside", "size", "speak", "speak-as", "speak-header", "speak-numeral", "speak-punctuation", "speech-rate", "stress", "string-set", "tab-size", "table-layout", "target", "target-name", "target-new", "target-position", "text-align", "text-align-last", "text-decoration", "text-decoration-color", "text-decoration-line", "text-decoration-skip", "text-decoration-style", "text-emphasis", "text-emphasis-color", "text-emphasis-position", "text-emphasis-style", "text-height", "text-indent", "text-justify", "text-outline", "text-overflow", "text-shadow", "text-size-adjust", "text-space-collapse", "text-transform", "text-underline-position", "text-wrap", "top", "transform", "transform-origin", "transform-style", "transition", "transition-delay", "transition-duration", "transition-property", "transition-timing-function", "unicode-bidi", "vertical-align", "visibility", "voice-balance", "voice-duration", "voice-family", "voice-pitch", "voice-range", "voice-rate", "voice-stress", "voice-volume", "volume", "white-space", "widows", "width", "word-break", "word-spacing", "word-wrap", "z-index", "clip-path", "clip-rule", "mask", "enable-background", "filter", "flood-color", "flood-opacity", "lighting-color", "stop-color", "stop-opacity", "pointer-events", "color-interpolation", "color-interpolation-filters", "color-rendering", "fill", "fill-opacity", "fill-rule", "image-rendering", "marker", "marker-end", "marker-mid", "marker-start", "shape-rendering", "stroke", "stroke-dasharray", "stroke-dashoffset", "stroke-linecap", "stroke-linejoin", "stroke-miterlimit", "stroke-opacity", "stroke-width", "text-rendering", "baseline-shift", "dominant-baseline", "glyph-orientation-horizontal", "glyph-orientation-vertical", "text-anchor", "writing-mode"]
      , H = F(C);
    var L = ["scrollbar-arrow-color", "scrollbar-base-color", "scrollbar-dark-shadow-color", "scrollbar-face-color", "scrollbar-highlight-color", "scrollbar-shadow-color", "scrollbar-3d-light-color", "scrollbar-track-color", "shape-inside", "searchfield-cancel-button", "searchfield-decoration", "searchfield-results-button", "searchfield-results-decoration", "zoom"]
      , D = F(L);
    var B = ["aliceblue", "antiquewhite", "aqua", "aquamarine", "azure", "beige", "bisque", "black", "blanchedalmond", "blue", "blueviolet", "brown", "burlywood", "cadetblue", "chartreuse", "chocolate", "coral", "cornflowerblue", "cornsilk", "crimson", "cyan", "darkblue", "darkcyan", "darkgoldenrod", "darkgray", "darkgreen", "darkkhaki", "darkmagenta", "darkolivegreen", "darkorange", "darkorchid", "darkred", "darksalmon", "darkseagreen", "darkslateblue", "darkslategray", "darkturquoise", "darkviolet", "deeppink", "deepskyblue", "dimgray", "dodgerblue", "firebrick", "floralwhite", "forestgreen", "fuchsia", "gainsboro", "ghostwhite", "gold", "goldenrod", "gray", "grey", "green", "greenyellow", "honeydew", "hotpink", "indianred", "indigo", "ivory", "khaki", "lavender", "lavenderblush", "lawngreen", "lemonchiffon", "lightblue", "lightcoral", "lightcyan", "lightgoldenrodyellow", "lightgray", "lightgreen", "lightpink", "lightsalmon", "lightseagreen", "lightskyblue", "lightslategray", "lightsteelblue", "lightyellow", "lime", "limegreen", "linen", "magenta", "maroon", "mediumaquamarine", "mediumblue", "mediumorchid", "mediumpurple", "mediumseagreen", "mediumslateblue", "mediumspringgreen", "mediumturquoise", "mediumvioletred", "midnightblue", "mintcream", "mistyrose", "moccasin", "navajowhite", "navy", "oldlace", "olive", "olivedrab", "orange", "orangered", "orchid", "palegoldenrod", "palegreen", "paleturquoise", "palevioletred", "papayawhip", "peachpuff", "peru", "pink", "plum", "powderblue", "purple", "rebeccapurple", "red", "rosybrown", "royalblue", "saddlebrown", "salmon", "sandybrown", "seagreen", "seashell", "sienna", "silver", "skyblue", "slateblue", "slategray", "snow", "springgreen", "steelblue", "tan", "teal", "thistle", "tomato", "turquoise", "violet", "wheat", "white", "whitesmoke", "yellow", "yellowgreen"]
      , K = F(B);
    var J = ["above", "absolute", "activeborder", "activecaption", "afar", "after-white-space", "ahead", "alias", "all", "all-scroll", "alternate", "always", "amharic", "amharic-abegede", "antialiased", "appworkspace", "arabic-indic", "armenian", "asterisks", "auto", "avoid", "avoid-column", "avoid-page", "avoid-region", "background", "backwards", "baseline", "below", "bidi-override", "binary", "bengali", "blink", "block", "block-axis", "bold", "bolder", "border", "border-box", "both", "bottom", "break", "break-all", "break-word", "button", "button-bevel", "buttonface", "buttonhighlight", "buttonshadow", "buttontext", "cambodian", "capitalize", "caps-lock-indicator", "caption", "captiontext", "caret", "cell", "center", "checkbox", "circle", "cjk-earthly-branch", "cjk-heavenly-stem", "cjk-ideographic", "clear", "clip", "close-quote", "col-resize", "collapse", "column", "compact", "condensed", "contain", "content", "content-box", "context-menu", "continuous", "copy", "cover", "crop", "cross", "crosshair", "currentcolor", "cursive", "dashed", "decimal", "decimal-leading-zero", "default", "default-button", "destination-atop", "destination-in", "destination-out", "destination-over", "devanagari", "disc", "discard", "document", "dot-dash", "dot-dot-dash", "dotted", "double", "down", "e-resize", "ease", "ease-in", "ease-in-out", "ease-out", "element", "ellipse", "ellipsis", "embed", "end", "ethiopic", "ethiopic-abegede", "ethiopic-abegede-am-et", "ethiopic-abegede-gez", "ethiopic-abegede-ti-er", "ethiopic-abegede-ti-et", "ethiopic-halehame-aa-er", "ethiopic-halehame-aa-et", "ethiopic-halehame-am-et", "ethiopic-halehame-gez", "ethiopic-halehame-om-et", "ethiopic-halehame-sid-et", "ethiopic-halehame-so-et", "ethiopic-halehame-ti-er", "ethiopic-halehame-ti-et", "ethiopic-halehame-tig", "ew-resize", "expanded", "extra-condensed", "extra-expanded", "fantasy", "fast", "fill", "fixed", "flat", "flex", "footnotes", "forwards", "from", "geometricPrecision", "georgian", "graytext", "groove", "gujarati", "gurmukhi", "hand", "hangul", "hangul-consonant", "hebrew", "help", "hidden", "hide", "higher", "highlight", "highlighttext", "hiragana", "hiragana-iroha", "horizontal", "hsl", "hsla", "icon", "ignore", "inactiveborder", "inactivecaption", "inactivecaptiontext", "infinite", "infobackground", "infotext", "inherit", "initial", "inline", "inline-axis", "inline-block", "inline-flex", "inline-table", "inset", "inside", "intrinsic", "invert", "italic", "justify", "kannada", "katakana", "katakana-iroha", "keep-all", "khmer", "landscape", "lao", "large", "larger", "left", "level", "lighter", "line-through", "linear", "lines", "list-item", "listbox", "listitem", "local", "logical", "loud", "lower", "lower-alpha", "lower-armenian", "lower-greek", "lower-hexadecimal", "lower-latin", "lower-norwegian", "lower-roman", "lowercase", "ltr", "malayalam", "match", "media-controls-background", "media-current-time-display", "media-fullscreen-button", "media-mute-button", "media-play-button", "media-return-to-realtime-button", "media-rewind-button", "media-seek-back-button", "media-seek-forward-button", "media-slider", "media-sliderthumb", "media-time-remaining-display", "media-volume-slider", "media-volume-slider-container", "media-volume-sliderthumb", "medium", "menu", "menulist", "menulist-button", "menulist-text", "menulist-textfield", "menutext", "message-box", "middle", "min-intrinsic", "mix", "mongolian", "monospace", "move", "multiple", "myanmar", "n-resize", "narrower", "ne-resize", "nesw-resize", "no-close-quote", "no-drop", "no-open-quote", "no-repeat", "none", "normal", "not-allowed", "nowrap", "ns-resize", "nw-resize", "nwse-resize", "oblique", "octal", "open-quote", "optimizeLegibility", "optimizeSpeed", "oriya", "oromo", "outset", "outside", "outside-shape", "overlay", "overline", "padding", "padding-box", "painted", "page", "paused", "persian", "plus-darker", "plus-lighter", "pointer", "polygon", "portrait", "pre", "pre-line", "pre-wrap", "preserve-3d", "progress", "push-button", "radio", "read-only", "read-write", "read-write-plaintext-only", "rectangle", "region", "relative", "repeat", "repeat-x", "repeat-y", "reset", "reverse", "rgb", "rgba", "ridge", "right", "round", "row-resize", "rtl", "run-in", "running", "s-resize", "sans-serif", "scroll", "scrollbar", "se-resize", "searchfield", "searchfield-cancel-button", "searchfield-decoration", "searchfield-results-button", "searchfield-results-decoration", "semi-condensed", "semi-expanded", "separate", "serif", "show", "sidama", "single", "skip-white-space", "slide", "slider-horizontal", "slider-vertical", "sliderthumb-horizontal", "sliderthumb-vertical", "slow", "small", "small-caps", "small-caption", "smaller", "solid", "somali", "source-atop", "source-in", "source-out", "source-over", "space", "square", "square-button", "start", "static", "status-bar", "stretch", "stroke", "sub", "subpixel-antialiased", "super", "sw-resize", "table", "table-caption", "table-cell", "table-column", "table-column-group", "table-footer-group", "table-header-group", "table-row", "table-row-group", "telugu", "text", "text-bottom", "text-top", "textarea", "textfield", "thai", "thick", "thin", "threeddarkshadow", "threedface", "threedhighlight", "threedlightshadow", "threedshadow", "tibetan", "tigre", "tigrinya-er", "tigrinya-er-abegede", "tigrinya-et", "tigrinya-et-abegede", "to", "top", "transparent", "ultra-condensed", "ultra-expanded", "underline", "up", "upper-alpha", "upper-armenian", "upper-greek", "upper-hexadecimal", "upper-latin", "upper-norwegian", "upper-roman", "uppercase", "urdu", "url", "vertical", "vertical-text", "visible", "visibleFill", "visiblePainted", "visibleStroke", "visual", "w-resize", "wait", "wave", "wider", "window", "windowframe", "windowtext", "x-large", "x-small", "xor", "xx-large", "xx-small"]
      , O = F(J);
    var P = ["font-family", "src", "unicode-range", "font-variant", "font-feature-settings", "font-stretch", "font-weight", "font-style"]
      , E = F(P);
    var M = A.concat(S).concat(C).concat(L).concat(B).concat(J);
    N.registerHelper("hintWords", "css", M);
    function R(W, V) {
        var T = false, U;
        while ((U = W.next()) != null) {
            if (T && U == "/") {
                V.tokenize = null;
                break
            }
            T = (U == "*")
        }
        return ["comment", "comment"]
    }
    function G(U, T) {
        if (U.skipTo("-->")) {
            U.match("-->");
            T.tokenize = null
        } else {
            U.skipToEnd()
        }
        return ["comment", "comment"]
    }
    N.defineMIME("text/css", {
        mediaTypes: Q,
        mediaFeatures: I,
        propertyKeywords: H,
        nonStandardPropertyKeywords: D,
        colorKeywords: K,
        valueKeywords: O,
        fontProperties: E,
        tokenHooks: {
            "<": function(U, T) {
                if (!U.match("!--")) {
                    return false
                }
                T.tokenize = G;
                return G(U, T)
            },
            "/": function(U, T) {
                if (!U.eat("*")) {
                    return false
                }
                T.tokenize = R;
                return R(U, T)
            }
        },
        name: "css"
    });
    N.defineMIME("text/x-scss", {
        mediaTypes: Q,
        mediaFeatures: I,
        propertyKeywords: H,
        nonStandardPropertyKeywords: D,
        colorKeywords: K,
        valueKeywords: O,
        fontProperties: E,
        allowNested: true,
        tokenHooks: {
            "/": function(U, T) {
                if (U.eat("/")) {
                    U.skipToEnd();
                    return ["comment", "comment"]
                } else {
                    if (U.eat("*")) {
                        T.tokenize = R;
                        return R(U, T)
                    } else {
                        return ["operator", "operator"]
                    }
                }
            },
            ":": function(T) {
                if (T.match(/\s*\{/)) {
                    return [null, "{"]
                }
                return false
            },
            "$": function(T) {
                T.match(/^[\w-]+/);
                if (T.match(/^\s*:/, false)) {
                    return ["variable-2", "variable-definition"]
                }
                return ["variable-2", "variable"]
            },
            "#": function(T) {
                if (!T.eat("{")) {
                    return false
                }
                return [null, "interpolation"]
            }
        },
        name: "css",
        helperType: "scss"
    });
    N.defineMIME("text/x-less", {
        mediaTypes: Q,
        mediaFeatures: I,
        propertyKeywords: H,
        nonStandardPropertyKeywords: D,
        colorKeywords: K,
        valueKeywords: O,
        fontProperties: E,
        allowNested: true,
        tokenHooks: {
            "/": function(U, T) {
                if (U.eat("/")) {
                    U.skipToEnd();
                    return ["comment", "comment"]
                } else {
                    if (U.eat("*")) {
                        T.tokenize = R;
                        return R(U, T)
                    } else {
                        return ["operator", "operator"]
                    }
                }
            },
            "@": function(T) {
                if (T.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/, false)) {
                    return false
                }
                T.eatWhile(/[\w\\\-]/);
                if (T.match(/^\s*:/, false)) {
                    return ["variable-2", "variable-definition"]
                }
                return ["variable-2", "variable"]
            },
            "&": function() {
                return ["atom", "atom"]
            }
        },
        name: "css",
        helperType: "less"
    })
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:javascript', location = '/static/bower/CodeMirror/mode/javascript/javascript.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("javascript", function(y, AI) {
        var K = y.indentUnit;
        var Z = AI.statementIndent;
        var AY = AI.jsonld;
        var Y = AI.json || AY;
        var G = AI.typescript;
        var AS = AI.wordCharacters || /[\w$\xa1-\uffff]/;
        var AQ = function() {
            function Ao(Aq) {
                return {
                    type: Aq,
                    style: "keyword"
                }
            }
            var Aj = Ao("keyword a")
              , Ah = Ao("keyword b")
              , Ag = Ao("keyword c");
            var Ai = Ao("operator")
              , Am = {
                type: "atom",
                style: "atom"
            };
            var Ak = {
                "if": Ao("if"),
                "while": Aj,
                "with": Aj,
                "else": Ah,
                "do": Ah,
                "try": Ah,
                "finally": Ah,
                "return": Ag,
                "break": Ag,
                "continue": Ag,
                "new": Ag,
                "delete": Ag,
                "throw": Ag,
                "debugger": Ag,
                "var": Ao("var"),
                "const": Ao("var"),
                let: Ao("var"),
                "function": Ao("function"),
                "catch": Ao("catch"),
                "for": Ao("for"),
                "switch": Ao("switch"),
                "case": Ao("case"),
                "default": Ao("default"),
                "in": Ai,
                "typeof": Ai,
                "instanceof": Ai,
                "true": Am,
                "false": Am,
                "null": Am,
                "undefined": Am,
                "NaN": Am,
                "Infinity": Am,
                "this": Ao("this"),
                module: Ao("module"),
                "class": Ao("class"),
                "super": Ao("atom"),
                yield: Ag,
                "export": Ao("export"),
                "import": Ao("import"),
                "extends": Ag
            };
            if (G) {
                var Ap = {
                    type: "variable",
                    style: "variable-3"
                };
                var Al = {
                    "interface": Ao("interface"),
                    "extends": Ao("extends"),
                    constructor: Ao("constructor"),
                    "public": Ao("public"),
                    "private": Ao("private"),
                    "protected": Ao("protected"),
                    "static": Ao("static"),
                    string: Ap,
                    number: Ap,
                    bool: Ap,
                    any: Ap
                };
                for (var An in Al) {
                    Ak[An] = Al[An]
                }
            }
            return Ak
        }();
        var o = /[+\-*&%=<>!?|~^]/;
        var AP = /^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;
        function e(Aj) {
            var Ah = false, Ag, Ai = false;
            while ((Ag = Aj.next()) != null) {
                if (!Ah) {
                    if (Ag == "/" && !Ai) {
                        return
                    }
                    if (Ag == "[") {
                        Ai = true
                    } else {
                        if (Ai && Ag == "]") {
                            Ai = false
                        }
                    }
                }
                Ah = !Ah && Ag == "\\"
            }
        }
        var r, f;
        function k(Ai, Ah, Ag) {
            r = Ai;
            f = Ag;
            return Ah
        }
        function t(Ak, Ai) {
            var Ag = Ak.next();
            if (Ag == '"' || Ag == "'") {
                Ai.tokenize = q(Ag);
                return Ai.tokenize(Ak, Ai)
            } else {
                if (Ag == "." && Ak.match(/^\d+(?:[eE][+\-]?\d+)?/)) {
                    return k("number", "number")
                } else {
                    if (Ag == "." && Ak.match("..")) {
                        return k("spread", "meta")
                    } else {
                        if (/[\[\]{}\(\),;\:\.]/.test(Ag)) {
                            return k(Ag)
                        } else {
                            if (Ag == "=" && Ak.eat(">")) {
                                return k("=>", "operator")
                            } else {
                                if (Ag == "0" && Ak.eat(/x/i)) {
                                    Ak.eatWhile(/[\da-f]/i);
                                    return k("number", "number")
                                } else {
                                    if (/\d/.test(Ag)) {
                                        Ak.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/);
                                        return k("number", "number")
                                    } else {
                                        if (Ag == "/") {
                                            if (Ak.eat("*")) {
                                                Ai.tokenize = AX;
                                                return AX(Ak, Ai)
                                            } else {
                                                if (Ak.eat("/")) {
                                                    Ak.skipToEnd();
                                                    return k("comment", "comment")
                                                } else {
                                                    if (Ai.lastType == "operator" || Ai.lastType == "keyword c" || Ai.lastType == "sof" || /^[\[{}\(,;:]$/.test(Ai.lastType)) {
                                                        e(Ak);
                                                        Ak.eatWhile(/[gimy]/);
                                                        return k("regexp", "string-2")
                                                    } else {
                                                        Ak.eatWhile(o);
                                                        return k("operator", "operator", Ak.current())
                                                    }
                                                }
                                            }
                                        } else {
                                            if (Ag == "`") {
                                                Ai.tokenize = AZ;
                                                return AZ(Ak, Ai)
                                            } else {
                                                if (Ag == "#") {
                                                    Ak.skipToEnd();
                                                    return k("error", "error")
                                                } else {
                                                    if (o.test(Ag)) {
                                                        Ak.eatWhile(o);
                                                        return k("operator", "operator", Ak.current())
                                                    } else {
                                                        if (AS.test(Ag)) {
                                                            Ak.eatWhile(AS);
                                                            var Aj = Ak.current()
                                                              , Ah = AQ.propertyIsEnumerable(Aj) && AQ[Aj];
                                                            return (Ah && Ai.lastType != ".") ? k(Ah.type, Ah.style, Aj) : k("variable", "variable", Aj)
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        function q(Ag) {
            return function(Ak, Ai) {
                var Aj = false, Ah;
                if (AY && Ak.peek() == "@" && Ak.match(AP)) {
                    Ai.tokenize = t;
                    return k("jsonld-keyword", "meta")
                }
                while ((Ah = Ak.next()) != null) {
                    if (Ah == Ag && !Aj) {
                        break
                    }
                    Aj = !Aj && Ah == "\\"
                }
                if (!Aj) {
                    Ai.tokenize = t
                }
                return k("string", "string")
            }
        }
        function AX(Aj, Ai) {
            var Ag = false, Ah;
            while (Ah = Aj.next()) {
                if (Ah == "/" && Ag) {
                    Ai.tokenize = t;
                    break
                }
                Ag = (Ah == "*")
            }
            return k("comment", "comment")
        }
        function AZ(Aj, Ah) {
            var Ai = false, Ag;
            while ((Ag = Aj.next()) != null) {
                if (!Ai && (Ag == "`" || Ag == "$" && Aj.eat("{"))) {
                    Ah.tokenize = t;
                    break
                }
                Ai = !Ai && Ag == "\\"
            }
            return k("quasi", "string-2", Aj.current())
        }
        var L = "([{}])";
        function AU(Am, Aj) {
            if (Aj.fatArrowAt) {
                Aj.fatArrowAt = null
            }
            var Ai = Am.string.indexOf("=>", Am.start);
            if (Ai < 0) {
                return
            }
            var Al = 0
              , Ah = false;
            for (var An = Ai - 1; An >= 0; --An) {
                var Ag = Am.string.charAt(An);
                var Ak = L.indexOf(Ag);
                if (Ak >= 0 && Ak < 3) {
                    if (!Al) {
                        ++An;
                        break
                    }
                    if (--Al == 0) {
                        break
                    }
                } else {
                    if (Ak >= 3 && Ak < 6) {
                        ++Al
                    } else {
                        if (AS.test(Ag)) {
                            Ah = true
                        } else {
                            if (/["'\/]/.test(Ag)) {
                                return
                            } else {
                                if (Ah && !Al) {
                                    ++An;
                                    break
                                }
                            }
                        }
                    }
                }
            }
            if (Ah && !Al) {
                Aj.fatArrowAt = An
            }
        }
        var B = {
            atom: true,
            number: true,
            variable: true,
            string: true,
            regexp: true,
            "this": true,
            "jsonld-keyword": true
        };
        function i(Al, Ah, Ag, Ak, Ai, Aj) {
            this.indented = Al;
            this.column = Ah;
            this.type = Ag;
            this.prev = Ai;
            this.info = Aj;
            if (Ak != null) {
                this.align = Ak
            }
        }
        function R(Aj, Ai) {
            for (var Ah = Aj.localVars; Ah; Ah = Ah.next) {
                if (Ah.name == Ai) {
                    return true
                }
            }
            for (var Ag = Aj.context; Ag; Ag = Ag.prev) {
                for (var Ah = Ag.vars; Ah; Ah = Ah.next) {
                    if (Ah.name == Ai) {
                        return true
                    }
                }
            }
        }
        function F(Ak, Ah, Ag, Aj, Al) {
            var Am = Ak.cc;
            c.state = Ak;
            c.stream = Al;
            c.marked = null,
            c.cc = Am;
            c.style = Ah;
            if (!Ak.lexical.hasOwnProperty("align")) {
                Ak.lexical.align = true
            }
            while (true) {
                var Ai = Am.length ? Am.pop() : Y ? AM : Ae;
                if (Ai(Ag, Aj)) {
                    while (Am.length && Am[Am.length - 1].lex) {
                        Am.pop()()
                    }
                    if (c.marked) {
                        return c.marked
                    }
                    if (Ag == "variable" && R(Ak, Aj)) {
                        return "variable-2"
                    }
                    return Ah
                }
            }
        }
        var c = {
            state: null,
            column: null,
            marked: null,
            cc: null
        };
        function z() {
            for (var Ag = arguments.length - 1; Ag >= 0; Ag--) {
                c.cc.push(arguments[Ag])
            }
        }
        function AD() {
            z.apply(null, arguments);
            return true
        }
        function AT(Ah) {
            function Ag(Ak) {
                for (var Aj = Ak; Aj; Aj = Aj.next) {
                    if (Aj.name == Ah) {
                        return true
                    }
                }
                return false
            }
            var Ai = c.state;
            if (Ai.context) {
                c.marked = "def";
                if (Ag(Ai.localVars)) {
                    return
                }
                Ai.localVars = {
                    name: Ah,
                    next: Ai.localVars
                }
            } else {
                if (Ag(Ai.globalVars)) {
                    return
                }
                if (AI.globalVars) {
                    Ai.globalVars = {
                        name: Ah,
                        next: Ai.globalVars
                    }
                }
            }
        }
        var P = {
            name: "this",
            next: {
                name: "arguments"
            }
        };
        function V() {
            c.state.context = {
                prev: c.state.context,
                vars: c.state.localVars
            };
            c.state.localVars = P
        }
        function W() {
            c.state.localVars = c.state.context.vars;
            c.state.context = c.state.context.prev
        }
        function Ac(Ah, Ai) {
            var Ag = function() {
                var Al = c.state
                  , Aj = Al.indented;
                if (Al.lexical.type == "stat") {
                    Aj = Al.lexical.indented
                } else {
                    for (var Ak = Al.lexical; Ak && Ak.type == ")" && Ak.align; Ak = Ak.prev) {
                        Aj = Ak.indented
                    }
                }
                Al.lexical = new i(Aj,c.stream.column(),Ah,null,Al.lexical,Ai)
            };
            Ag.lex = true;
            return Ag
        }
        function H() {
            var Ag = c.state;
            if (Ag.lexical.prev) {
                if (Ag.lexical.type == ")") {
                    Ag.indented = Ag.lexical.indented
                }
                Ag.lexical = Ag.lexical.prev
            }
        }
        H.lex = true;
        function Q(Ag) {
            function Ah(Ai) {
                if (Ai == Ag) {
                    return AD()
                } else {
                    if (Ag == ";") {
                        return z()
                    } else {
                        return AD(Ah)
                    }
                }
            }
            return Ah
        }
        function Ae(Ag, Ah) {
            if (Ag == "var") {
                return AD(Ac("vardef", Ah.length), D, Q(";"), H)
            }
            if (Ag == "keyword a") {
                return AD(Ac("form"), AM, Ae, H)
            }
            if (Ag == "keyword b") {
                return AD(Ac("form"), Ae, H)
            }
            if (Ag == "{") {
                return AD(Ac("}"), X, H)
            }
            if (Ag == ";") {
                return AD()
            }
            if (Ag == "if") {
                if (c.state.lexical.info == "else" && c.state.cc[c.state.cc.length - 1] == H) {
                    c.state.cc.pop()()
                }
                return AD(Ac("form"), AM, Ae, H, E)
            }
            if (Ag == "function") {
                return AD(l)
            }
            if (Ag == "for") {
                return AD(Ac("form"), T, Ae, H)
            }
            if (Ag == "variable") {
                return AD(Ac("stat"), Af)
            }
            if (Ag == "switch") {
                return AD(Ac("form"), AM, Ac("}", "switch"), Q("{"), X, H, H)
            }
            if (Ag == "case") {
                return AD(AM, Q(":"))
            }
            if (Ag == "default") {
                return AD(Q(":"))
            }
            if (Ag == "catch") {
                return AD(Ac("form"), V, Q("("), AE, Q(")"), Ae, H, W)
            }
            if (Ag == "module") {
                return AD(Ac("form"), V, g, W, H)
            }
            if (Ag == "class") {
                return AD(Ac("form"), u, H)
            }
            if (Ag == "export") {
                return AD(Ac("form"), Ad, H)
            }
            if (Ag == "import") {
                return AD(Ac("form"), AF, H)
            }
            return z(Ac("stat"), AM, Q(";"), H)
        }
        function AM(Ag) {
            return x(Ag, false)
        }
        function Ab(Ag) {
            return x(Ag, true)
        }
        function x(Ah, Aj) {
            if (c.state.fatArrowAt == c.stream.start) {
                var Ag = Aj ? m : v;
                if (Ah == "(") {
                    return AD(V, Ac(")"), AR(I, ")"), H, Q("=>"), Ag, W)
                } else {
                    if (Ah == "variable") {
                        return z(V, I, Q("=>"), Ag, W)
                    }
                }
            }
            var Ai = Aj ? J : AA;
            if (B.hasOwnProperty(Ah)) {
                return AD(Ai)
            }
            if (Ah == "function") {
                return AD(l, Ai)
            }
            if (Ah == "keyword c") {
                return AD(Aj ? AJ : AH)
            }
            if (Ah == "(") {
                return AD(Ac(")"), AH, AW, Q(")"), H, Ai)
            }
            if (Ah == "operator" || Ah == "spread") {
                return AD(Aj ? Ab : AM)
            }
            if (Ah == "[") {
                return AD(Ac("]"), M, H, Ai)
            }
            if (Ah == "{") {
                return AV(S, "}", null, Ai)
            }
            if (Ah == "quasi") {
                return z(p, Ai)
            }
            return AD()
        }
        function AH(Ag) {
            if (Ag.match(/[;\}\)\],]/)) {
                return z()
            }
            return z(AM)
        }
        function AJ(Ag) {
            if (Ag.match(/[;\}\)\],]/)) {
                return z()
            }
            return z(Ab)
        }
        function AA(Ag, Ah) {
            if (Ag == ",") {
                return AD(AM)
            }
            return J(Ag, Ah, false)
        }
        function J(Ag, Ai, Ak) {
            var Ah = Ak == false ? AA : J;
            var Aj = Ak == false ? AM : Ab;
            if (Ag == "=>") {
                return AD(V, Ak ? m : v, W)
            }
            if (Ag == "operator") {
                if (/\+\+|--/.test(Ai)) {
                    return AD(Ah)
                }
                if (Ai == "?") {
                    return AD(AM, Q(":"), Aj)
                }
                return AD(Aj)
            }
            if (Ag == "quasi") {
                return z(p, Ah)
            }
            if (Ag == ";") {
                return
            }
            if (Ag == "(") {
                return AV(Ab, ")", "call", Ah)
            }
            if (Ag == ".") {
                return AD(AK, Ah)
            }
            if (Ag == "[") {
                return AD(Ac("]"), AH, Q("]"), H, Ah)
            }
        }
        function p(Ag, Ah) {
            if (Ag != "quasi") {
                return z()
            }
            if (Ah.slice(Ah.length - 2) != "${") {
                return AD(p)
            }
            return AD(AM, O)
        }
        function O(Ag) {
            if (Ag == "}") {
                c.marked = "string-2";
                c.state.tokenize = AZ;
                return AD(p)
            }
        }
        function v(Ag) {
            AU(c.stream, c.state);
            return z(Ag == "{" ? Ae : AM)
        }
        function m(Ag) {
            AU(c.stream, c.state);
            return z(Ag == "{" ? Ae : Ab)
        }
        function Af(Ag) {
            if (Ag == ":") {
                return AD(H, Ae)
            }
            return z(AA, Q(";"), H)
        }
        function AK(Ag) {
            if (Ag == "variable") {
                c.marked = "property";
                return AD()
            }
        }
        function S(Ag, Ah) {
            if (Ag == "variable" || c.style == "keyword") {
                c.marked = "property";
                if (Ah == "get" || Ah == "set") {
                    return AD(h)
                }
                return AD(j)
            } else {
                if (Ag == "number" || Ag == "string") {
                    c.marked = AY ? "property" : (c.style + " property");
                    return AD(j)
                } else {
                    if (Ag == "jsonld-keyword") {
                        return AD(j)
                    } else {
                        if (Ag == "[") {
                            return AD(AM, Q("]"), j)
                        }
                    }
                }
            }
        }
        function h(Ag) {
            if (Ag != "variable") {
                return z(j)
            }
            c.marked = "property";
            return AD(l)
        }
        function j(Ag) {
            if (Ag == ":") {
                return AD(Ab)
            }
            if (Ag == "(") {
                return z(l)
            }
        }
        function AR(Ai, Ag) {
            function Ah(Ak) {
                if (Ak == ",") {
                    var Aj = c.state.lexical;
                    if (Aj.info == "call") {
                        Aj.pos = (Aj.pos || 0) + 1
                    }
                    return AD(Ai, Ah)
                }
                if (Ak == Ag) {
                    return AD()
                }
                return AD(Q(Ag))
            }
            return function(Aj) {
                if (Aj == Ag) {
                    return AD()
                }
                return z(Ai, Ah)
            }
        }
        function AV(Aj, Ag, Ai) {
            for (var Ah = 3; Ah < arguments.length; Ah++) {
                c.cc.push(arguments[Ah])
            }
            return AD(Ac(Ag, Ai), AR(Aj, Ag), H)
        }
        function X(Ag) {
            if (Ag == "}") {
                return AD()
            }
            return z(Ae, X)
        }
        function s(Ag) {
            if (G && Ag == ":") {
                return AD(AC)
            }
        }
        function AC(Ag) {
            if (Ag == "variable") {
                c.marked = "variable-3";
                return AD()
            }
        }
        function D() {
            return z(I, s, AB, w)
        }
        function I(Ag, Ah) {
            if (Ag == "variable") {
                AT(Ah);
                return AD()
            }
            if (Ag == "[") {
                return AV(I, "]")
            }
            if (Ag == "{") {
                return AV(Aa, "}")
            }
        }
        function Aa(Ag, Ah) {
            if (Ag == "variable" && !c.stream.match(/^\s*:/, false)) {
                AT(Ah);
                return AD(AB)
            }
            if (Ag == "variable") {
                c.marked = "property"
            }
            return AD(Q(":"), I, AB)
        }
        function AB(Ag, Ah) {
            if (Ah == "=") {
                return AD(Ab)
            }
        }
        function w(Ag) {
            if (Ag == ",") {
                return AD(D)
            }
        }
        function E(Ag, Ah) {
            if (Ag == "keyword b" && Ah == "else") {
                return AD(Ac("form", "else"), Ae, H)
            }
        }
        function T(Ag) {
            if (Ag == "(") {
                return AD(Ac(")"), d, Q(")"), H)
            }
        }
        function d(Ag) {
            if (Ag == "var") {
                return AD(D, Q(";"), b)
            }
            if (Ag == ";") {
                return AD(b)
            }
            if (Ag == "variable") {
                return AD(U)
            }
            return z(AM, Q(";"), b)
        }
        function U(Ag, Ah) {
            if (Ah == "in" || Ah == "of") {
                c.marked = "keyword";
                return AD(AM)
            }
            return AD(AA, b)
        }
        function b(Ag, Ah) {
            if (Ag == ";") {
                return AD(a)
            }
            if (Ah == "in" || Ah == "of") {
                c.marked = "keyword";
                return AD(AM)
            }
            return z(AM, Q(";"), a)
        }
        function a(Ag) {
            if (Ag != ")") {
                AD(AM)
            }
        }
        function l(Ag, Ah) {
            if (Ah == "*") {
                c.marked = "keyword";
                return AD(l)
            }
            if (Ag == "variable") {
                AT(Ah);
                return AD(l)
            }
            if (Ag == "(") {
                return AD(V, Ac(")"), AR(AE, ")"), H, Ae, W)
            }
        }
        function AE(Ag) {
            if (Ag == "spread") {
                return AD(AE)
            }
            return z(I, s)
        }
        function u(Ag, Ah) {
            if (Ag == "variable") {
                AT(Ah);
                return AD(n)
            }
        }
        function n(Ag, Ah) {
            if (Ah == "extends") {
                return AD(AM, n)
            }
            if (Ag == "{") {
                return AD(Ac("}"), N, H)
            }
        }
        function N(Ag, Ah) {
            if (Ag == "variable" || c.style == "keyword") {
                c.marked = "property";
                if (Ah == "get" || Ah == "set") {
                    return AD(C, l, N)
                }
                return AD(l, N)
            }
            if (Ah == "*") {
                c.marked = "keyword";
                return AD(N)
            }
            if (Ag == ";") {
                return AD(N)
            }
            if (Ag == "}") {
                return AD()
            }
        }
        function C(Ag) {
            if (Ag != "variable") {
                return z()
            }
            c.marked = "property";
            return AD()
        }
        function g(Ag, Ah) {
            if (Ag == "string") {
                return AD(Ae)
            }
            if (Ag == "variable") {
                AT(Ah);
                return AD(AG)
            }
        }
        function Ad(Ag, Ah) {
            if (Ah == "*") {
                c.marked = "keyword";
                return AD(AG, Q(";"))
            }
            if (Ah == "default") {
                c.marked = "keyword";
                return AD(AM, Q(";"))
            }
            return z(Ae)
        }
        function AF(Ag) {
            if (Ag == "string") {
                return AD()
            }
            return z(AO, AG)
        }
        function AO(Ag, Ah) {
            if (Ag == "{") {
                return AV(AO, "}")
            }
            if (Ag == "variable") {
                AT(Ah)
            }
            return AD()
        }
        function AG(Ag, Ah) {
            if (Ah == "from") {
                c.marked = "keyword";
                return AD(AM)
            }
        }
        function M(Ag) {
            if (Ag == "]") {
                return AD()
            }
            return z(Ab, AL)
        }
        function AL(Ag) {
            if (Ag == "for") {
                return z(AW, Q("]"))
            }
            if (Ag == ",") {
                return AD(AR(AJ, "]"))
            }
            return z(AR(Ab, "]"))
        }
        function AW(Ag) {
            if (Ag == "for") {
                return AD(T, AW)
            }
            if (Ag == "if") {
                return AD(AM, AW)
            }
        }
        function AN(Ah, Ag) {
            return Ah.lastType == "operator" || Ah.lastType == "," || o.test(Ag.charAt(0)) || /[,.]/.test(Ag.charAt(0))
        }
        return {
            startState: function(Ah) {
                var Ag = {
                    tokenize: t,
                    lastType: "sof",
                    cc: [],
                    lexical: new i((Ah || 0) - K,0,"block",false),
                    localVars: AI.localVars,
                    context: AI.localVars && {
                        vars: AI.localVars
                    },
                    indented: 0
                };
                if (AI.globalVars && typeof AI.globalVars == "object") {
                    Ag.globalVars = AI.globalVars
                }
                return Ag
            },
            token: function(Ai, Ah) {
                if (Ai.sol()) {
                    if (!Ah.lexical.hasOwnProperty("align")) {
                        Ah.lexical.align = false
                    }
                    Ah.indented = Ai.indentation();
                    AU(Ai, Ah)
                }
                if (Ah.tokenize != AX && Ai.eatSpace()) {
                    return null
                }
                var Ag = Ah.tokenize(Ai, Ah);
                if (r == "comment") {
                    return Ag
                }
                Ah.lastType = r == "operator" && (f == "++" || f == "--") ? "incdec" : r;
                return F(Ah, Ag, r, f, Ai)
            },
            indent: function(Am, Ag) {
                if (Am.tokenize == AX) {
                    return A.Pass
                }
                if (Am.tokenize != t) {
                    return 0
                }
                var Al = Ag && Ag.charAt(0)
                  , Aj = Am.lexical;
                if (!/^\s*else\b/.test(Ag)) {
                    for (var Ai = Am.cc.length - 1; Ai >= 0; --Ai) {
                        var An = Am.cc[Ai];
                        if (An == H) {
                            Aj = Aj.prev
                        } else {
                            if (An != E) {
                                break
                            }
                        }
                    }
                }
                if (Aj.type == "stat" && Al == "}") {
                    Aj = Aj.prev
                }
                if (Z && Aj.type == ")" && Aj.prev.type == "stat") {
                    Aj = Aj.prev
                }
                var Ak = Aj.type
                  , Ah = Al == Ak;
                if (Ak == "vardef") {
                    return Aj.indented + (Am.lastType == "operator" || Am.lastType == "," ? Aj.info + 1 : 0)
                } else {
                    if (Ak == "form" && Al == "{") {
                        return Aj.indented
                    } else {
                        if (Ak == "form") {
                            return Aj.indented + K
                        } else {
                            if (Ak == "stat") {
                                return Aj.indented + (AN(Am, Ag) ? Z || K : 0)
                            } else {
                                if (Aj.info == "switch" && !Ah && AI.doubleIndentSwitch != false) {
                                    return Aj.indented + (/^(?:case|default)\b/.test(Ag) ? K : 2 * K)
                                } else {
                                    if (Aj.align) {
                                        return Aj.column + (Ah ? 0 : 1)
                                    } else {
                                        return Aj.indented + (Ah ? 0 : K)
                                    }
                                }
                            }
                        }
                    }
                }
            },
            electricInput: /^\s*(?:case .*?:|default:|\{|\})$/,
            blockCommentStart: Y ? null : "/*",
            blockCommentEnd: Y ? null : "*/",
            lineComment: Y ? null : "//",
            fold: "brace",
            helperType: Y ? "json" : "javascript",
            jsonldMode: AY,
            jsonMode: Y
        }
    });
    A.registerHelper("wordChars", "javascript", /[\w$]/);
    A.defineMIME("text/javascript", "javascript");
    A.defineMIME("text/ecmascript", "javascript");
    A.defineMIME("application/javascript", "javascript");
    A.defineMIME("application/x-javascript", "javascript");
    A.defineMIME("application/ecmascript", "javascript");
    A.defineMIME("application/json", {
        name: "javascript",
        json: true
    });
    A.defineMIME("application/x-json", {
        name: "javascript",
        json: true
    });
    A.defineMIME("application/ld+json", {
        name: "javascript",
        jsonld: true
    });
    A.defineMIME("text/typescript", {
        name: "javascript",
        typescript: true
    });
    A.defineMIME("application/typescript", {
        name: "javascript",
        typescript: true
    })
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:xml', location = '/static/bower/CodeMirror/mode/xml/xml.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("xml", function(Y, K) {
        var P = Y.indentUnit;
        var X = K.multilineTagIndentFactor || 1;
        var D = K.multilineTagIndentPastTag;
        if (D == null) {
            D = true
        }
        var W = K.htmlMode ? {
            autoSelfClosers: {
                area: true,
                base: true,
                br: true,
                col: true,
                command: true,
                embed: true,
                frame: true,
                hr: true,
                img: true,
                input: true,
                keygen: true,
                link: true,
                meta: true,
                param: true,
                source: true,
                track: true,
                wbr: true,
                menuitem: true
            },
            implicitlyClosed: {
                dd: true,
                li: true,
                optgroup: true,
                option: true,
                p: true,
                rp: true,
                rt: true,
                tbody: true,
                td: true,
                tfoot: true,
                th: true,
                tr: true
            },
            contextGrabbers: {
                dd: {
                    dd: true,
                    dt: true
                },
                dt: {
                    dd: true,
                    dt: true
                },
                li: {
                    li: true
                },
                option: {
                    option: true,
                    optgroup: true
                },
                optgroup: {
                    optgroup: true
                },
                p: {
                    address: true,
                    article: true,
                    aside: true,
                    blockquote: true,
                    dir: true,
                    div: true,
                    dl: true,
                    fieldset: true,
                    footer: true,
                    form: true,
                    h1: true,
                    h2: true,
                    h3: true,
                    h4: true,
                    h5: true,
                    h6: true,
                    header: true,
                    hgroup: true,
                    hr: true,
                    menu: true,
                    nav: true,
                    ol: true,
                    p: true,
                    pre: true,
                    section: true,
                    table: true,
                    ul: true
                },
                rp: {
                    rp: true,
                    rt: true
                },
                rt: {
                    rp: true,
                    rt: true
                },
                tbody: {
                    tbody: true,
                    tfoot: true
                },
                td: {
                    td: true,
                    th: true
                },
                tfoot: {
                    tbody: true
                },
                th: {
                    td: true,
                    th: true
                },
                thead: {
                    tbody: true,
                    tfoot: true
                },
                tr: {
                    tr: true
                }
            },
            doNotIndent: {
                pre: true
            },
            allowUnquoted: true,
            allowMissing: true,
            caseFold: true
        } : {
            autoSelfClosers: {},
            implicitlyClosed: {},
            contextGrabbers: {},
            doNotIndent: {},
            allowUnquoted: false,
            allowMissing: false,
            caseFold: false
        };
        var C = K.alignCDATA;
        var F, G;
        function N(f, e) {
            function c(g) {
                e.tokenize = g;
                return g(f, e)
            }
            var d = f.next();
            if (d == "<") {
                if (f.eat("!")) {
                    if (f.eat("[")) {
                        if (f.match("CDATA[")) {
                            return c(V("atom", "]]>"))
                        } else {
                            return null
                        }
                    } else {
                        if (f.match("--")) {
                            return c(V("comment", "-->"))
                        } else {
                            if (f.match("DOCTYPE", true, true)) {
                                f.eatWhile(/[\w\._\-]/);
                                return c(Z(1))
                            } else {
                                return null
                            }
                        }
                    }
                } else {
                    if (f.eat("?")) {
                        f.eatWhile(/[\w\._\-]/);
                        e.tokenize = V("meta", "?>");
                        return "meta"
                    } else {
                        F = f.eat("/") ? "closeTag" : "openTag";
                        e.tokenize = M;
                        return "tag bracket"
                    }
                }
            } else {
                if (d == "&") {
                    var b;
                    if (f.eat("#")) {
                        if (f.eat("x")) {
                            b = f.eatWhile(/[a-fA-F\d]/) && f.eat(";")
                        } else {
                            b = f.eatWhile(/[\d]/) && f.eat(";")
                        }
                    } else {
                        b = f.eatWhile(/[\w\.\-:]/) && f.eat(";")
                    }
                    return b ? "atom" : "error"
                } else {
                    f.eatWhile(/[^&<]/);
                    return null
                }
            }
        }
        function M(e, d) {
            var c = e.next();
            if (c == ">" || (c == "/" && e.eat(">"))) {
                d.tokenize = N;
                F = c == ">" ? "endTag" : "selfcloseTag";
                return "tag bracket"
            } else {
                if (c == "=") {
                    F = "equals";
                    return null
                } else {
                    if (c == "<") {
                        d.tokenize = N;
                        d.state = L;
                        d.tagName = d.tagStart = null;
                        var b = d.tokenize(e, d);
                        return b ? b + " tag error" : "tag error"
                    } else {
                        if (/[\'\"]/.test(c)) {
                            d.tokenize = J(c);
                            d.stringStartCol = e.column();
                            return d.tokenize(e, d)
                        } else {
                            e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);
                            return "word"
                        }
                    }
                }
            }
        }
        function J(b) {
            var c = function(e, d) {
                while (!e.eol()) {
                    if (e.next() == b) {
                        d.tokenize = M;
                        break
                    }
                }
                return "string"
            };
            c.isInAttribute = true;
            return c
        }
        function V(c, b) {
            return function(e, d) {
                while (!e.eol()) {
                    if (e.match(b)) {
                        d.tokenize = N;
                        break
                    }
                    e.next()
                }
                return c
            }
        }
        function Z(b) {
            return function(e, d) {
                var c;
                while ((c = e.next()) != null) {
                    if (c == "<") {
                        d.tokenize = Z(b + 1);
                        return d.tokenize(e, d)
                    } else {
                        if (c == ">") {
                            if (b == 1) {
                                d.tokenize = N;
                                break
                            } else {
                                d.tokenize = Z(b - 1);
                                return d.tokenize(e, d)
                            }
                        }
                    }
                }
                return "meta"
            }
        }
        function R(c, b, d) {
            this.prev = c.context;
            this.tagName = b;
            this.indent = c.indented;
            this.startOfLine = d;
            if (W.doNotIndent.hasOwnProperty(b) || (c.context && c.context.noIndent)) {
                this.noIndent = true
            }
        }
        function U(b) {
            if (b.context) {
                b.context = b.context.prev
            }
        }
        function Q(d, c) {
            var b;
            while (true) {
                if (!d.context) {
                    return
                }
                b = d.context.tagName;
                if (!W.contextGrabbers.hasOwnProperty(b) || !W.contextGrabbers[b].hasOwnProperty(c)) {
                    return
                }
                U(d)
            }
        }
        function L(b, d, c) {
            if (b == "openTag") {
                c.tagStart = d.column();
                return B
            } else {
                if (b == "closeTag") {
                    return T
                } else {
                    return L
                }
            }
        }
        function B(b, d, c) {
            if (b == "word") {
                c.tagName = d.current();
                G = "tag";
                return E
            } else {
                G = "error";
                return B
            }
        }
        function T(c, e, d) {
            if (c == "word") {
                var b = e.current();
                if (d.context && d.context.tagName != b && W.implicitlyClosed.hasOwnProperty(d.context.tagName)) {
                    U(d)
                }
                if (d.context && d.context.tagName == b) {
                    G = "tag";
                    return S
                } else {
                    G = "tag error";
                    return a
                }
            } else {
                G = "error";
                return a
            }
        }
        function S(c, b, d) {
            if (c != "endTag") {
                G = "error";
                return S
            }
            U(d);
            return L
        }
        function a(b, d, c) {
            G = "error";
            return S(b, d, c)
        }
        function E(e, c, f) {
            if (e == "word") {
                G = "attribute";
                return I
            } else {
                if (e == "endTag" || e == "selfcloseTag") {
                    var d = f.tagName
                      , b = f.tagStart;
                    f.tagName = f.tagStart = null;
                    if (e == "selfcloseTag" || W.autoSelfClosers.hasOwnProperty(d)) {
                        Q(f, d)
                    } else {
                        Q(f, d);
                        f.context = new R(f,d,b == f.indented)
                    }
                    return L
                }
            }
            G = "error";
            return E
        }
        function I(b, d, c) {
            if (b == "equals") {
                return O
            }
            if (!W.allowMissing) {
                G = "error"
            }
            return E(b, d, c)
        }
        function O(b, d, c) {
            if (b == "string") {
                return H
            }
            if (b == "word" && W.allowUnquoted) {
                G = "string";
                return E
            }
            G = "error";
            return E(b, d, c)
        }
        function H(b, d, c) {
            if (b == "string") {
                return H
            }
            return E(b, d, c)
        }
        return {
            startState: function() {
                return {
                    tokenize: N,
                    state: L,
                    indented: 0,
                    tagName: null,
                    tagStart: null,
                    context: null
                }
            },
            token: function(d, c) {
                if (!c.tagName && d.sol()) {
                    c.indented = d.indentation()
                }
                if (d.eatSpace()) {
                    return null
                }
                F = null;
                var b = c.tokenize(d, c);
                if ((b || F) && b != "comment") {
                    G = null;
                    c.state = c.state(F || b, d, c);
                    if (G) {
                        b = G == "error" ? b + " error" : G
                    }
                }
                return b
            },
            indent: function(g, c, f) {
                var e = g.context;
                if (g.tokenize.isInAttribute) {
                    if (g.tagStart == g.indented) {
                        return g.stringStartCol + 1
                    } else {
                        return g.indented + P
                    }
                }
                if (e && e.noIndent) {
                    return A.Pass
                }
                if (g.tokenize != M && g.tokenize != N) {
                    return f ? f.match(/^(\s*)/)[0].length : 0
                }
                if (g.tagName) {
                    if (D) {
                        return g.tagStart + g.tagName.length + 2
                    } else {
                        return g.tagStart + P * X
                    }
                }
                if (C && /<!\[CDATA\[/.test(c)) {
                    return 0
                }
                var b = c && /^<(\/)?([\w_:\.-]*)/.exec(c);
                if (b && b[1]) {
                    while (e) {
                        if (e.tagName == b[2]) {
                            e = e.prev;
                            break
                        } else {
                            if (W.implicitlyClosed.hasOwnProperty(e.tagName)) {
                                e = e.prev
                            } else {
                                break
                            }
                        }
                    }
                } else {
                    if (b) {
                        while (e) {
                            var d = W.contextGrabbers[e.tagName];
                            if (d && d.hasOwnProperty(b[2])) {
                                e = e.prev
                            } else {
                                break
                            }
                        }
                    }
                }
                while (e && !e.startOfLine) {
                    e = e.prev
                }
                if (e) {
                    return e.indent + P
                } else {
                    return 0
                }
            },
            electricInput: /<\/[\s\w:]+>$/,
            blockCommentStart: "<!--",
            blockCommentEnd: "-->",
            configuration: K.htmlMode ? "html" : "xml",
            helperType: K.htmlMode ? "html" : "xml"
        }
    });
    A.defineMIME("text/xml", "xml");
    A.defineMIME("application/xml", "xml");
    if (!A.mimeModes.hasOwnProperty("text/html")) {
        A.defineMIME("text/html", {
            name: "xml",
            htmlMode: true
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:htmlmixed', location = '/static/bower/CodeMirror/mode/htmlmixed/htmlmixed.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"), require("../xml/xml"), require("../javascript/javascript"), require("../css/css"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror", "../xml/xml", "../javascript/javascript", "../css/css"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("htmlmixed", function(C, D) {
        var B = A.getMode(C, {
            name: "xml",
            htmlMode: true,
            multilineTagIndentFactor: D.multilineTagIndentFactor,
            multilineTagIndentPastTag: D.multilineTagIndentPastTag
        });
        var M = A.getMode(C, "css");
        var K = []
          , J = D && D.scriptTypes;
        K.push({
            matches: /^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,
            mode: A.getMode(C, "javascript")
        });
        if (J) {
            for (var E = 0; E < J.length; ++E) {
                var I = J[E];
                K.push({
                    matches: I.matches,
                    mode: I.mode && A.getMode(C, I.mode)
                })
            }
        }
        K.push({
            matches: /./,
            mode: A.getMode(C, "text/plain")
        });
        function F(S, Q) {
            var O = Q.htmlState.tagName;
            if (O) {
                O = O.toLowerCase()
            }
            var P = B.token(S, Q.htmlState);
            if (O == "script" && /\btag\b/.test(P) && S.current() == ">") {
                var T = S.string.slice(Math.max(0, S.pos - 100), S.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);
                T = T ? T[1] : "";
                if (T && /[\"\']/.test(T.charAt(0))) {
                    T = T.slice(1, T.length - 1)
                }
                for (var N = 0; N < K.length; ++N) {
                    var R = K[N];
                    if (typeof R.matches == "string" ? T == R.matches : R.matches.test(T)) {
                        if (R.mode) {
                            Q.token = L;
                            Q.localMode = R.mode;
                            Q.localState = R.mode.startState && R.mode.startState(B.indent(Q.htmlState, ""))
                        }
                        break
                    }
                }
            } else {
                if (O == "style" && /\btag\b/.test(P) && S.current() == ">") {
                    Q.token = G;
                    Q.localMode = M;
                    Q.localState = M.startState(B.indent(Q.htmlState, ""))
                }
            }
            return P
        }
        function H(S, O, P) {
            var R = S.current();
            var Q = R.search(O), N;
            if (Q > -1) {
                S.backUp(R.length - Q)
            } else {
                if (N = R.match(/<\/?$/)) {
                    S.backUp(R.length);
                    if (!S.match(O, false)) {
                        S.match(R)
                    }
                }
            }
            return P
        }
        function L(O, N) {
            if (O.match(/^<\/\s*script\s*>/i, false)) {
                N.token = F;
                N.localState = N.localMode = null;
                return null
            }
            return H(O, /<\/\s*script\s*>/, N.localMode.token(O, N.localState))
        }
        function G(O, N) {
            if (O.match(/^<\/\s*style\s*>/i, false)) {
                N.token = F;
                N.localState = N.localMode = null;
                return null
            }
            return H(O, /<\/\s*style\s*>/, M.token(O, N.localState))
        }
        return {
            startState: function() {
                var N = B.startState();
                return {
                    token: F,
                    localMode: null,
                    localState: null,
                    htmlState: N
                }
            },
            copyState: function(O) {
                if (O.localState) {
                    var N = A.copyState(O.localMode, O.localState)
                }
                return {
                    token: O.token,
                    localMode: O.localMode,
                    localState: N,
                    htmlState: A.copyState(B, O.htmlState)
                }
            },
            token: function(O, N) {
                return N.token(O, N)
            },
            indent: function(O, N) {
                if (!O.localMode || /^\s*<\//.test(N)) {
                    return B.indent(O.htmlState, N)
                } else {
                    if (O.localMode.indent) {
                        return O.localMode.indent(O.localState, N)
                    } else {
                        return A.Pass
                    }
                }
            },
            innerMode: function(N) {
                return {
                    state: N.localState || N.htmlState,
                    mode: N.localMode || B
                }
            }
        }
    }, "xml", "javascript", "css");
    A.defineMIME("text/html", "htmlmixed")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:markdown', location = '/static/bower/CodeMirror/mode/markdown/markdown.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"), require("../xml/xml"), require("../meta"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror", "../xml/xml", "../meta"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("markdown", function(Y, Z) {
        var P = A.modes.hasOwnProperty("xml");
        var J = A.getMode(Y, P ? {
            name: "xml",
            htmlMode: true
        } : "text/plain");
        function f(x) {
            if (A.findModeByName) {
                var y = A.findModeByName(x);
                if (y) {
                    x = y.mime || y.mimes[0]
                }
            }
            var z = A.getMode(Y, x);
            return z.name == "null" ? null : z
        }
        if (Z.highlightFormatting === undefined) {
            Z.highlightFormatting = false
        }
        if (Z.maxBlockquoteDepth === undefined) {
            Z.maxBlockquoteDepth = 0
        }
        if (Z.underscoresBreakWords === undefined) {
            Z.underscoresBreakWords = true
        }
        if (Z.fencedCodeBlocks === undefined) {
            Z.fencedCodeBlocks = false
        }
        if (Z.taskLists === undefined) {
            Z.taskLists = false
        }
        if (Z.strikethrough === undefined) {
            Z.strikethrough = false
        }
        var K = 0;
        var I = "header"
          , G = "comment"
          , R = "quote"
          , q = "variable-2"
          , n = "variable-3"
          , m = "keyword"
          , p = "hr"
          , H = "tag"
          , U = "formatting"
          , Q = "link"
          , M = "link"
          , g = "link"
          , e = "string"
          , r = "em"
          , a = "strong"
          , N = "strikethrough";
        var B = /^([*\-=_])(?:\s*\1){2,}\s*$/
          , E = /^[*\-+]\s+/
          , c = /^[0-9]+\.\s+/
          , T = /^\[(x| )\](?=\s)/
          , t = /^#+/
          , w = /^(?:\={1,}|-{1,})$/
          , b = /^[^#!\[\]*_\\<>` "'(~]+/;
        function u(z, y, x) {
            y.f = y.inline = x;
            return x(z, y)
        }
        function d(z, y, x) {
            y.f = y.block = x;
            return x(z, y)
        }
        function C(x) {
            x.linkTitle = false;
            x.em = false;
            x.strong = false;
            x.strikethrough = false;
            x.quote = 0;
            if (!P && x.f == S) {
                x.f = s;
                x.block = j
            }
            x.trailingSpace = 0;
            x.trailingSpaceNewLine = false;
            x.thisLineHasContent = false;
            return null
        }
        function j(AC, AB) {
            var AA = AC.sol();
            var y = (AB.list !== false);
            if (AB.list !== false && AB.indentationDiff >= 0) {
                if (AB.indentationDiff < 4) {
                    AB.indentation -= AB.indentationDiff
                }
                AB.list = null
            } else {
                if (AB.list !== false && AB.indentation > 0) {
                    AB.list = null;
                    AB.listDepth = Math.floor(AB.indentation / 4)
                } else {
                    if (AB.list !== false) {
                        AB.list = false;
                        AB.listDepth = 0
                    }
                }
            }
            var x = null;
            if (AB.indentationDiff >= 4) {
                AB.indentation -= 4;
                AC.skipToEnd();
                return G
            } else {
                if (AC.eatSpace()) {
                    return null
                } else {
                    if (x = AC.match(t)) {
                        AB.header = x[0].length <= 6 ? x[0].length : 6;
                        if (Z.highlightFormatting) {
                            AB.formatting = "header"
                        }
                        AB.f = AB.inline;
                        return W(AB)
                    } else {
                        if (AB.prevLineHasContent && (x = AC.match(w))) {
                            AB.header = x[0].charAt(0) == "=" ? 1 : 2;
                            if (Z.highlightFormatting) {
                                AB.formatting = "header"
                            }
                            AB.f = AB.inline;
                            return W(AB)
                        } else {
                            if (AC.eat(">")) {
                                AB.indentation++;
                                AB.quote = AA ? 1 : AB.quote + 1;
                                if (Z.highlightFormatting) {
                                    AB.formatting = "quote"
                                }
                                AC.eatSpace();
                                return W(AB)
                            } else {
                                if (AC.peek() === "[") {
                                    return u(AC, AB, D)
                                } else {
                                    if (AC.match(B, true)) {
                                        return p
                                    } else {
                                        if ((!AB.prevLineHasContent || y) && (AC.match(E, false) || AC.match(c, false))) {
                                            var z = null;
                                            if (AC.match(E, true)) {
                                                z = "ul"
                                            } else {
                                                AC.match(c, true);
                                                z = "ol"
                                            }
                                            AB.indentation += 4;
                                            AB.list = true;
                                            AB.listDepth++;
                                            if (Z.taskLists && AC.match(T, false)) {
                                                AB.taskList = true
                                            }
                                            AB.f = AB.inline;
                                            if (Z.highlightFormatting) {
                                                AB.formatting = ["list", "list-" + z]
                                            }
                                            return W(AB)
                                        } else {
                                            if (Z.fencedCodeBlocks && AC.match(/^```[ \t]*([\w+#]*)/, true)) {
                                                AB.localMode = f(RegExp.$1);
                                                if (AB.localMode) {
                                                    AB.localState = AB.localMode.startState()
                                                }
                                                AB.f = AB.block = i;
                                                if (Z.highlightFormatting) {
                                                    AB.formatting = "code-block"
                                                }
                                                AB.code = true;
                                                return W(AB)
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            return u(AC, AB, AB.inline)
        }
        function S(z, y) {
            var x = J.token(z, y.htmlState);
            if ((P && y.htmlState.tagStart === null && !y.htmlState.context) || (y.md_inside && z.current().indexOf(">") > -1)) {
                y.f = s;
                y.block = j;
                y.htmlState = null
            }
            return x
        }
        function i(y, x) {
            if (y.sol() && y.match("```", false)) {
                x.localMode = x.localState = null;
                x.f = x.block = o;
                return null
            } else {
                if (x.localMode) {
                    return x.localMode.token(y, x.localState)
                } else {
                    y.skipToEnd();
                    return G
                }
            }
        }
        function o(z, y) {
            z.match("```");
            y.block = j;
            y.f = s;
            if (Z.highlightFormatting) {
                y.formatting = "code-block"
            }
            y.code = true;
            var x = W(y);
            y.code = false;
            return x
        }
        function W(AA) {
            var z = [];
            if (AA.formatting) {
                z.push(U);
                if (typeof AA.formatting === "string") {
                    AA.formatting = [AA.formatting]
                }
                for (var x = 0; x < AA.formatting.length; x++) {
                    z.push(U + "-" + AA.formatting[x]);
                    if (AA.formatting[x] === "header") {
                        z.push(U + "-" + AA.formatting[x] + "-" + AA.header)
                    }
                    if (AA.formatting[x] === "quote") {
                        if (!Z.maxBlockquoteDepth || Z.maxBlockquoteDepth >= AA.quote) {
                            z.push(U + "-" + AA.formatting[x] + "-" + AA.quote)
                        } else {
                            z.push("error")
                        }
                    }
                }
            }
            if (AA.taskOpen) {
                z.push("meta");
                return z.length ? z.join(" ") : null
            }
            if (AA.taskClosed) {
                z.push("property");
                return z.length ? z.join(" ") : null
            }
            if (AA.linkHref) {
                z.push(e);
                return z.length ? z.join(" ") : null
            }
            if (AA.strong) {
                z.push(a)
            }
            if (AA.em) {
                z.push(r)
            }
            if (AA.strikethrough) {
                z.push(N)
            }
            if (AA.linkText) {
                z.push(g)
            }
            if (AA.code) {
                z.push(G)
            }
            if (AA.header) {
                z.push(I);
                z.push(I + "-" + AA.header)
            }
            if (AA.quote) {
                z.push(R);
                if (!Z.maxBlockquoteDepth || Z.maxBlockquoteDepth >= AA.quote) {
                    z.push(R + "-" + AA.quote)
                } else {
                    z.push(R + "-" + Z.maxBlockquoteDepth)
                }
            }
            if (AA.list !== false) {
                var y = (AA.listDepth - 1) % 3;
                if (!y) {
                    z.push(q)
                } else {
                    if (y === 1) {
                        z.push(n)
                    } else {
                        z.push(m)
                    }
                }
            }
            if (AA.trailingSpaceNewLine) {
                z.push("trailing-space-new-line")
            } else {
                if (AA.trailingSpace) {
                    z.push("trailing-space-" + (AA.trailingSpace % 2 ? "a" : "b"))
                }
            }
            return z.length ? z.join(" ") : null
        }
        function O(y, x) {
            if (y.match(b, true)) {
                return W(x)
            }
            return undefined
        }
        function s(AM, y) {
            var z = y.text(AM, y);
            if (typeof z !== "undefined") {
                return z
            }
            if (y.list) {
                y.list = null;
                return W(y)
            }
            if (y.taskList) {
                var AC = AM.match(T, true)[1] !== "x";
                if (AC) {
                    y.taskOpen = true
                } else {
                    y.taskClosed = true
                }
                if (Z.highlightFormatting) {
                    y.formatting = "task"
                }
                y.taskList = false;
                return W(y)
            }
            y.taskOpen = false;
            y.taskClosed = false;
            if (y.header && AM.match(/^#+$/, true)) {
                if (Z.highlightFormatting) {
                    y.formatting = "header"
                }
                return W(y)
            }
            var AE = AM.sol();
            var x = AM.next();
            if (x === "\\") {
                AM.next();
                if (Z.highlightFormatting) {
                    var AF = W(y);
                    return AF ? AF + " formatting-escape" : "formatting-escape"
                }
            }
            if (y.linkTitle) {
                y.linkTitle = false;
                var AI = x;
                if (x === "(") {
                    AI = ")"
                }
                AI = (AI + "").replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
                var AH = "^\\s*(?:[^" + AI + "\\\\]+|\\\\\\\\|\\\\.)" + AI;
                if (AM.match(new RegExp(AH), true)) {
                    return e
                }
            }
            if (x === "`") {
                var AK = y.formatting;
                if (Z.highlightFormatting) {
                    y.formatting = "code"
                }
                var AN = W(y);
                var AG = AM.pos;
                AM.eatWhile("`");
                var AA = 1 + AM.pos - AG;
                if (!y.code) {
                    K = AA;
                    y.code = true;
                    return W(y)
                } else {
                    if (AA === K) {
                        y.code = false;
                        return AN
                    }
                    y.formatting = AK;
                    return W(y)
                }
            } else {
                if (y.code) {
                    return W(y)
                }
            }
            if (x === "!" && AM.match(/\[[^\]]*\] ?(?:\(|\[)/, false)) {
                AM.match(/\[[^\]]*\]/);
                y.inline = y.f = X;
                return H
            }
            if (x === "[" && AM.match(/.*\](\(.*\)| ?\[.*\])/, false)) {
                y.linkText = true;
                if (Z.highlightFormatting) {
                    y.formatting = "link"
                }
                return W(y)
            }
            if (x === "]" && y.linkText && AM.match(/\(.*\)| ?\[.*\]/, false)) {
                if (Z.highlightFormatting) {
                    y.formatting = "link"
                }
                var AF = W(y);
                y.linkText = false;
                y.inline = y.f = X;
                return AF
            }
            if (x === "<" && AM.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/, false)) {
                y.f = y.inline = l;
                if (Z.highlightFormatting) {
                    y.formatting = "link"
                }
                var AF = W(y);
                if (AF) {
                    AF += " "
                } else {
                    AF = ""
                }
                return AF + Q
            }
            if (x === "<" && AM.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/, false)) {
                y.f = y.inline = l;
                if (Z.highlightFormatting) {
                    y.formatting = "link"
                }
                var AF = W(y);
                if (AF) {
                    AF += " "
                } else {
                    AF = ""
                }
                return AF + M
            }
            if (x === "<" && AM.match(/^\w/, false)) {
                if (AM.string.indexOf(">") != -1) {
                    var AD = AM.string.substring(1, AM.string.indexOf(">"));
                    if (/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(AD)) {
                        y.md_inside = true
                    }
                }
                AM.backUp(1);
                y.htmlState = A.startState(J);
                return d(AM, y, S)
            }
            if (x === "<" && AM.match(/^\/\w*?>/)) {
                y.md_inside = false;
                return "tag"
            }
            var AB = false;
            if (!Z.underscoresBreakWords) {
                if (x === "_" && AM.peek() !== "_" && AM.match(/(\w)/, false)) {
                    var AJ = AM.pos - 2;
                    if (AJ >= 0) {
                        var AL = AM.string.charAt(AJ);
                        if (AL !== "_" && AL.match(/(\w)/, false)) {
                            AB = true
                        }
                    }
                }
            }
            if (x === "*" || (x === "_" && !AB)) {
                if (AE && AM.peek() === " ") {} else {
                    if (y.strong === x && AM.eat(x)) {
                        if (Z.highlightFormatting) {
                            y.formatting = "strong"
                        }
                        var AN = W(y);
                        y.strong = false;
                        return AN
                    } else {
                        if (!y.strong && AM.eat(x)) {
                            y.strong = x;
                            if (Z.highlightFormatting) {
                                y.formatting = "strong"
                            }
                            return W(y)
                        } else {
                            if (y.em === x) {
                                if (Z.highlightFormatting) {
                                    y.formatting = "em"
                                }
                                var AN = W(y);
                                y.em = false;
                                return AN
                            } else {
                                if (!y.em) {
                                    y.em = x;
                                    if (Z.highlightFormatting) {
                                        y.formatting = "em"
                                    }
                                    return W(y)
                                }
                            }
                        }
                    }
                }
            } else {
                if (x === " ") {
                    if (AM.eat("*") || AM.eat("_")) {
                        if (AM.peek() === " ") {
                            return W(y)
                        } else {
                            AM.backUp(1)
                        }
                    }
                }
            }
            if (Z.strikethrough) {
                if (x === "~" && AM.eatWhile(x)) {
                    if (y.strikethrough) {
                        if (Z.highlightFormatting) {
                            y.formatting = "strikethrough"
                        }
                        var AN = W(y);
                        y.strikethrough = false;
                        return AN
                    } else {
                        if (AM.match(/^[^\s]/, false)) {
                            y.strikethrough = true;
                            if (Z.highlightFormatting) {
                                y.formatting = "strikethrough"
                            }
                            return W(y)
                        }
                    }
                } else {
                    if (x === " ") {
                        if (AM.match(/^~~/, true)) {
                            if (AM.peek() === " ") {
                                return W(y)
                            } else {
                                AM.backUp(2)
                            }
                        }
                    }
                }
            }
            if (x === " ") {
                if (AM.match(/ +$/, false)) {
                    y.trailingSpace++
                } else {
                    if (y.trailingSpace) {
                        y.trailingSpaceNewLine = true
                    }
                }
            }
            return W(y)
        }
        function l(AA, z) {
            var y = AA.next();
            if (y === ">") {
                z.f = z.inline = s;
                if (Z.highlightFormatting) {
                    z.formatting = "link"
                }
                var x = W(z);
                if (x) {
                    x += " "
                } else {
                    x = ""
                }
                return x + Q
            }
            AA.match(/^[^>]+/, true);
            return Q
        }
        function X(z, y) {
            if (z.eatSpace()) {
                return null
            }
            var x = z.next();
            if (x === "(" || x === "[") {
                y.f = y.inline = k(x === "(" ? ")" : "]");
                if (Z.highlightFormatting) {
                    y.formatting = "link-string"
                }
                y.linkHref = true;
                return W(y)
            }
            return "error"
        }
        function k(x) {
            return function(AB, AA) {
                var z = AB.next();
                if (z === x) {
                    AA.f = AA.inline = s;
                    if (Z.highlightFormatting) {
                        AA.formatting = "link-string"
                    }
                    var y = W(AA);
                    AA.linkHref = false;
                    return y
                }
                if (AB.match(V(x), true)) {
                    AB.backUp(1)
                }
                AA.linkHref = true;
                return W(AA)
            }
        }
        function D(y, x) {
            if (y.match(/^[^\]]*\]:/, false)) {
                x.f = h;
                y.next();
                if (Z.highlightFormatting) {
                    x.formatting = "link"
                }
                x.linkText = true;
                return W(x)
            }
            return u(y, x, s)
        }
        function h(z, y) {
            if (z.match(/^\]:/, true)) {
                y.f = y.inline = F;
                if (Z.highlightFormatting) {
                    y.formatting = "link"
                }
                var x = W(y);
                y.linkText = false;
                return x
            }
            z.match(/^[^\]]+/, true);
            return g
        }
        function F(y, x) {
            if (y.eatSpace()) {
                return null
            }
            y.match(/^[^\s]+/, true);
            if (y.peek() === undefined) {
                x.linkTitle = true
            } else {
                y.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/, true)
            }
            x.f = x.inline = s;
            return e
        }
        var v = [];
        function V(x) {
            if (!v[x]) {
                x = (x + "").replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
                v[x] = new RegExp("^(?:[^\\\\]|\\\\.)*?(" + x + ")")
            }
            return v[x]
        }
        var L = {
            startState: function() {
                return {
                    f: j,
                    prevLineHasContent: false,
                    thisLineHasContent: false,
                    block: j,
                    htmlState: null,
                    indentation: 0,
                    inline: s,
                    text: O,
                    formatting: false,
                    linkText: false,
                    linkHref: false,
                    linkTitle: false,
                    em: false,
                    strong: false,
                    header: 0,
                    taskList: false,
                    list: false,
                    listDepth: 0,
                    quote: 0,
                    trailingSpace: 0,
                    trailingSpaceNewLine: false,
                    strikethrough: false
                }
            },
            copyState: function(x) {
                return {
                    f: x.f,
                    prevLineHasContent: x.prevLineHasContent,
                    thisLineHasContent: x.thisLineHasContent,
                    block: x.block,
                    htmlState: x.htmlState && A.copyState(J, x.htmlState),
                    indentation: x.indentation,
                    localMode: x.localMode,
                    localState: x.localMode ? A.copyState(x.localMode, x.localState) : null,
                    inline: x.inline,
                    text: x.text,
                    formatting: false,
                    linkTitle: x.linkTitle,
                    em: x.em,
                    strong: x.strong,
                    strikethrough: x.strikethrough,
                    header: x.header,
                    taskList: x.taskList,
                    list: x.list,
                    listDepth: x.listDepth,
                    quote: x.quote,
                    trailingSpace: x.trailingSpace,
                    trailingSpaceNewLine: x.trailingSpaceNewLine,
                    md_inside: x.md_inside
                }
            },
            token: function(AB, AA) {
                AA.formatting = false;
                if (AB.sol()) {
                    var x = !!AA.header;
                    AA.header = 0;
                    if (AB.match(/^\s*$/, true) || x) {
                        AA.prevLineHasContent = false;
                        C(AA);
                        return x ? this.token(AB, AA) : null
                    } else {
                        AA.prevLineHasContent = AA.thisLineHasContent;
                        AA.thisLineHasContent = true
                    }
                    AA.taskList = false;
                    AA.code = false;
                    AA.trailingSpace = 0;
                    AA.trailingSpaceNewLine = false;
                    AA.f = AA.block;
                    var y = AB.match(/^\s*/, true)[0].replace(/\t/g, "    ").length;
                    var AC = Math.floor((y - AA.indentation) / 4) * 4;
                    if (AC > 4) {
                        AC = 4
                    }
                    var z = AA.indentation + AC;
                    AA.indentationDiff = z - AA.indentation;
                    AA.indentation = z;
                    if (y > 0) {
                        return null
                    }
                }
                return AA.f(AB, AA)
            },
            innerMode: function(x) {
                if (x.block == S) {
                    return {
                        state: x.htmlState,
                        mode: J
                    }
                }
                if (x.localState) {
                    return {
                        state: x.localState,
                        mode: x.localMode
                    }
                }
                return {
                    state: x,
                    mode: L
                }
            },
            blankLine: C,
            getType: W,
            fold: "markdown"
        };
        return L
    }, "xml");
    A.defineMIME("text/x-markdown", "markdown")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:perl', location = '/static/bower/CodeMirror/mode/perl/perl.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("perl", function() {
        var F = {
            "->": 4,
            "++": 4,
            "--": 4,
            "**": 4,
            "=~": 4,
            "!~": 4,
            "*": 4,
            "/": 4,
            "%": 4,
            x: 4,
            "+": 4,
            "-": 4,
            ".": 4,
            "<<": 4,
            ">>": 4,
            "<": 4,
            ">": 4,
            "<=": 4,
            ">=": 4,
            lt: 4,
            gt: 4,
            le: 4,
            ge: 4,
            "==": 4,
            "!=": 4,
            "<=>": 4,
            eq: 4,
            ne: 4,
            cmp: 4,
            "~~": 4,
            "&": 4,
            "|": 4,
            "^": 4,
            "&&": 4,
            "||": 4,
            "//": 4,
            "..": 4,
            "...": 4,
            "?": 4,
            ":": 4,
            "=": 4,
            "+=": 4,
            "-=": 4,
            "*=": 4,
            ",": 4,
            "=>": 4,
            "::": 4,
            not: 4,
            and: 4,
            or: 4,
            xor: 4,
            BEGIN: [5, 1],
            END: [5, 1],
            PRINT: [5, 1],
            PRINTF: [5, 1],
            GETC: [5, 1],
            READ: [5, 1],
            READLINE: [5, 1],
            DESTROY: [5, 1],
            TIE: [5, 1],
            TIEHANDLE: [5, 1],
            UNTIE: [5, 1],
            STDIN: 5,
            STDIN_TOP: 5,
            STDOUT: 5,
            STDOUT_TOP: 5,
            STDERR: 5,
            STDERR_TOP: 5,
            "$ARG": 5,
            "$_": 5,
            "@ARG": 5,
            "@_": 5,
            "$LIST_SEPARATOR": 5,
            '$"': 5,
            "$PROCESS_ID": 5,
            "$PID": 5,
            "$$": 5,
            "$REAL_GROUP_ID": 5,
            "$GID": 5,
            "$(": 5,
            "$EFFECTIVE_GROUP_ID": 5,
            "$EGID": 5,
            "$)": 5,
            "$PROGRAM_NAME": 5,
            "$0": 5,
            "$SUBSCRIPT_SEPARATOR": 5,
            "$SUBSEP": 5,
            "$;": 5,
            "$REAL_USER_ID": 5,
            "$UID": 5,
            "$<": 5,
            "$EFFECTIVE_USER_ID": 5,
            "$EUID": 5,
            "$>": 5,
            "$a": 5,
            "$b": 5,
            "$COMPILING": 5,
            "$^C": 5,
            "$DEBUGGING": 5,
            "$^D": 5,
            "${^ENCODING}": 5,
            "$ENV": 5,
            "%ENV": 5,
            "$SYSTEM_FD_MAX": 5,
            "$^F": 5,
            "@F": 5,
            "${^GLOBAL_PHASE}": 5,
            "$^H": 5,
            "%^H": 5,
            "@INC": 5,
            "%INC": 5,
            "$INPLACE_EDIT": 5,
            "$^I": 5,
            "$^M": 5,
            "$OSNAME": 5,
            "$^O": 5,
            "${^OPEN}": 5,
            "$PERLDB": 5,
            "$^P": 5,
            "$SIG": 5,
            "%SIG": 5,
            "$BASETIME": 5,
            "$^T": 5,
            "${^TAINT}": 5,
            "${^UNICODE}": 5,
            "${^UTF8CACHE}": 5,
            "${^UTF8LOCALE}": 5,
            "$PERL_VERSION": 5,
            "$^V": 5,
            "${^WIN32_SLOPPY_STAT}": 5,
            "$EXECUTABLE_NAME": 5,
            "$^X": 5,
            "$1": 5,
            "$MATCH": 5,
            "$&": 5,
            "${^MATCH}": 5,
            "$PREMATCH": 5,
            "$`": 5,
            "${^PREMATCH}": 5,
            "$POSTMATCH": 5,
            "$'": 5,
            "${^POSTMATCH}": 5,
            "$LAST_PAREN_MATCH": 5,
            "$+": 5,
            "$LAST_SUBMATCH_RESULT": 5,
            "$^N": 5,
            "@LAST_MATCH_END": 5,
            "@+": 5,
            "%LAST_PAREN_MATCH": 5,
            "%+": 5,
            "@LAST_MATCH_START": 5,
            "@-": 5,
            "%LAST_MATCH_START": 5,
            "%-": 5,
            "$LAST_REGEXP_CODE_RESULT": 5,
            "$^R": 5,
            "${^RE_DEBUG_FLAGS}": 5,
            "${^RE_TRIE_MAXBUF}": 5,
            "$ARGV": 5,
            "@ARGV": 5,
            ARGV: 5,
            ARGVOUT: 5,
            "$OUTPUT_FIELD_SEPARATOR": 5,
            "$OFS": 5,
            "$,": 5,
            "$INPUT_LINE_NUMBER": 5,
            "$NR": 5,
            "$.": 5,
            "$INPUT_RECORD_SEPARATOR": 5,
            "$RS": 5,
            "$/": 5,
            "$OUTPUT_RECORD_SEPARATOR": 5,
            "$ORS": 5,
            "$\\": 5,
            "$OUTPUT_AUTOFLUSH": 5,
            "$|": 5,
            "$ACCUMULATOR": 5,
            "$^A": 5,
            "$FORMAT_FORMFEED": 5,
            "$^L": 5,
            "$FORMAT_PAGE_NUMBER": 5,
            "$%": 5,
            "$FORMAT_LINES_LEFT": 5,
            "$-": 5,
            "$FORMAT_LINE_BREAK_CHARACTERS": 5,
            "$:": 5,
            "$FORMAT_LINES_PER_PAGE": 5,
            "$=": 5,
            "$FORMAT_TOP_NAME": 5,
            "$^": 5,
            "$FORMAT_NAME": 5,
            "$~": 5,
            "${^CHILD_ERROR_NATIVE}": 5,
            "$EXTENDED_OS_ERROR": 5,
            "$^E": 5,
            "$EXCEPTIONS_BEING_CAUGHT": 5,
            "$^S": 5,
            "$WARNING": 5,
            "$^W": 5,
            "${^WARNING_BITS}": 5,
            "$OS_ERROR": 5,
            "$ERRNO": 5,
            "$!": 5,
            "%OS_ERROR": 5,
            "%ERRNO": 5,
            "%!": 5,
            "$CHILD_ERROR": 5,
            "$?": 5,
            "$EVAL_ERROR": 5,
            "$@": 5,
            "$OFMT": 5,
            "$#": 5,
            "$*": 5,
            "$ARRAY_BASE": 5,
            "$[": 5,
            "$OLD_PERL_VERSION": 5,
            "$]": 5,
            "if": [1, 1],
            elsif: [1, 1],
            "else": [1, 1],
            "while": [1, 1],
            unless: [1, 1],
            "for": [1, 1],
            foreach: [1, 1],
            abs: 1,
            accept: 1,
            alarm: 1,
            atan2: 1,
            bind: 1,
            binmode: 1,
            bless: 1,
            bootstrap: 1,
            "break": 1,
            caller: 1,
            chdir: 1,
            chmod: 1,
            chomp: 1,
            chop: 1,
            chown: 1,
            chr: 1,
            chroot: 1,
            close: 1,
            closedir: 1,
            connect: 1,
            "continue": [1, 1],
            cos: 1,
            crypt: 1,
            dbmclose: 1,
            dbmopen: 1,
            "default": 1,
            defined: 1,
            "delete": 1,
            die: 1,
            "do": 1,
            dump: 1,
            each: 1,
            endgrent: 1,
            endhostent: 1,
            endnetent: 1,
            endprotoent: 1,
            endpwent: 1,
            endservent: 1,
            eof: 1,
            "eval": 1,
            exec: 1,
            exists: 1,
            exit: 1,
            exp: 1,
            fcntl: 1,
            fileno: 1,
            flock: 1,
            fork: 1,
            format: 1,
            formline: 1,
            getc: 1,
            getgrent: 1,
            getgrgid: 1,
            getgrnam: 1,
            gethostbyaddr: 1,
            gethostbyname: 1,
            gethostent: 1,
            getlogin: 1,
            getnetbyaddr: 1,
            getnetbyname: 1,
            getnetent: 1,
            getpeername: 1,
            getpgrp: 1,
            getppid: 1,
            getpriority: 1,
            getprotobyname: 1,
            getprotobynumber: 1,
            getprotoent: 1,
            getpwent: 1,
            getpwnam: 1,
            getpwuid: 1,
            getservbyname: 1,
            getservbyport: 1,
            getservent: 1,
            getsockname: 1,
            getsockopt: 1,
            given: 1,
            glob: 1,
            gmtime: 1,
            "goto": 1,
            grep: 1,
            hex: 1,
            "import": 1,
            index: 1,
            "int": 1,
            ioctl: 1,
            join: 1,
            keys: 1,
            kill: 1,
            last: 1,
            lc: 1,
            lcfirst: 1,
            length: 1,
            link: 1,
            listen: 1,
            local: 2,
            localtime: 1,
            lock: 1,
            log: 1,
            lstat: 1,
            m: null,
            map: 1,
            mkdir: 1,
            msgctl: 1,
            msgget: 1,
            msgrcv: 1,
            msgsnd: 1,
            my: 2,
            "new": 1,
            next: 1,
            no: 1,
            oct: 1,
            open: 1,
            opendir: 1,
            ord: 1,
            our: 2,
            pack: 1,
            "package": 1,
            pipe: 1,
            pop: 1,
            pos: 1,
            print: 1,
            printf: 1,
            prototype: 1,
            push: 1,
            q: null,
            qq: null,
            qr: null,
            quotemeta: null,
            qw: null,
            qx: null,
            rand: 1,
            read: 1,
            readdir: 1,
            readline: 1,
            readlink: 1,
            readpipe: 1,
            recv: 1,
            redo: 1,
            ref: 1,
            rename: 1,
            require: 1,
            reset: 1,
            "return": 1,
            reverse: 1,
            rewinddir: 1,
            rindex: 1,
            rmdir: 1,
            s: null,
            say: 1,
            scalar: 1,
            seek: 1,
            seekdir: 1,
            select: 1,
            semctl: 1,
            semget: 1,
            semop: 1,
            send: 1,
            setgrent: 1,
            sethostent: 1,
            setnetent: 1,
            setpgrp: 1,
            setpriority: 1,
            setprotoent: 1,
            setpwent: 1,
            setservent: 1,
            setsockopt: 1,
            shift: 1,
            shmctl: 1,
            shmget: 1,
            shmread: 1,
            shmwrite: 1,
            shutdown: 1,
            sin: 1,
            sleep: 1,
            socket: 1,
            socketpair: 1,
            sort: 1,
            splice: 1,
            split: 1,
            sprintf: 1,
            sqrt: 1,
            srand: 1,
            stat: 1,
            state: 1,
            study: 1,
            sub: 1,
            substr: 1,
            symlink: 1,
            syscall: 1,
            sysopen: 1,
            sysread: 1,
            sysseek: 1,
            system: 1,
            syswrite: 1,
            tell: 1,
            telldir: 1,
            tie: 1,
            tied: 1,
            time: 1,
            times: 1,
            tr: null,
            truncate: 1,
            uc: 1,
            ucfirst: 1,
            umask: 1,
            undef: 1,
            unlink: 1,
            unpack: 1,
            unshift: 1,
            untie: 1,
            use: 1,
            utime: 1,
            values: 1,
            vec: 1,
            wait: 1,
            waitpid: 1,
            wantarray: 1,
            warn: 1,
            when: 1,
            write: 1,
            y: null
        };
        var J = "string-2";
        var H = /[goseximacplud]/;
        function G(P, O, M, N, L) {
            O.chain = null;
            O.style = null;
            O.tail = null;
            O.tokenize = function(T, R) {
                var S = false, U, Q = 0;
                while (U = T.next()) {
                    if (U === M[Q] && !S) {
                        if (M[++Q] !== undefined) {
                            R.chain = M[Q];
                            R.style = N;
                            R.tail = L
                        } else {
                            if (L) {
                                T.eatWhile(L)
                            }
                        }
                        R.tokenize = K;
                        return N
                    }
                    S = !S && U == "\\"
                }
                return N
            }
            ;
            return O.tokenize(P, O)
        }
        function I(N, M, L) {
            M.tokenize = function(P, O) {
                if (P.string == L) {
                    O.tokenize = K
                }
                P.skipToEnd();
                return "string"
            }
            ;
            return M.tokenize(N, M)
        }
        function K(P, N) {
            if (P.eatSpace()) {
                return null
            }
            if (N.chain) {
                return G(P, N, N.chain, N.style, N.tail)
            }
            if (P.match(/^\-?[\d\.]/, false)) {
                if (P.match(/^(\-?(\d*\.\d+(e[+-]?\d+)?|\d+\.\d*)|0x[\da-fA-F]+|0b[01]+|\d+(e[+-]?\d+)?)/)) {
                    return "number"
                }
            }
            if (P.match(/^<<(?=\w)/)) {
                P.eatWhile(/\w/);
                return I(P, N, P.current().substr(2))
            }
            if (P.sol() && P.match(/^\=item(?!\w)/)) {
                return I(P, N, "=cut")
            }
            var M = P.next();
            if (M == '"' || M == "'") {
                if (C(P, 3) == "<<" + M) {
                    var O = P.pos;
                    P.eatWhile(/\w/);
                    var R = P.current().substr(1);
                    if (R && P.eat(M)) {
                        return I(P, N, R)
                    }
                    P.pos = O
                }
                return G(P, N, [M], "string")
            }
            if (M == "q") {
                var Q = B(P, -2);
                if (!(Q && /\w/.test(Q))) {
                    Q = B(P, 0);
                    if (Q == "x") {
                        Q = B(P, 1);
                        if (Q == "(") {
                            D(P, 2);
                            return G(P, N, [")"], J, H)
                        }
                        if (Q == "[") {
                            D(P, 2);
                            return G(P, N, ["]"], J, H)
                        }
                        if (Q == "{") {
                            D(P, 2);
                            return G(P, N, ["}"], J, H)
                        }
                        if (Q == "<") {
                            D(P, 2);
                            return G(P, N, [">"], J, H)
                        }
                        if (/[\^'"!~\/]/.test(Q)) {
                            D(P, 1);
                            return G(P, N, [P.eat(Q)], J, H)
                        }
                    } else {
                        if (Q == "q") {
                            Q = B(P, 1);
                            if (Q == "(") {
                                D(P, 2);
                                return G(P, N, [")"], "string")
                            }
                            if (Q == "[") {
                                D(P, 2);
                                return G(P, N, ["]"], "string")
                            }
                            if (Q == "{") {
                                D(P, 2);
                                return G(P, N, ["}"], "string")
                            }
                            if (Q == "<") {
                                D(P, 2);
                                return G(P, N, [">"], "string")
                            }
                            if (/[\^'"!~\/]/.test(Q)) {
                                D(P, 1);
                                return G(P, N, [P.eat(Q)], "string")
                            }
                        } else {
                            if (Q == "w") {
                                Q = B(P, 1);
                                if (Q == "(") {
                                    D(P, 2);
                                    return G(P, N, [")"], "bracket")
                                }
                                if (Q == "[") {
                                    D(P, 2);
                                    return G(P, N, ["]"], "bracket")
                                }
                                if (Q == "{") {
                                    D(P, 2);
                                    return G(P, N, ["}"], "bracket")
                                }
                                if (Q == "<") {
                                    D(P, 2);
                                    return G(P, N, [">"], "bracket")
                                }
                                if (/[\^'"!~\/]/.test(Q)) {
                                    D(P, 1);
                                    return G(P, N, [P.eat(Q)], "bracket")
                                }
                            } else {
                                if (Q == "r") {
                                    Q = B(P, 1);
                                    if (Q == "(") {
                                        D(P, 2);
                                        return G(P, N, [")"], J, H)
                                    }
                                    if (Q == "[") {
                                        D(P, 2);
                                        return G(P, N, ["]"], J, H)
                                    }
                                    if (Q == "{") {
                                        D(P, 2);
                                        return G(P, N, ["}"], J, H)
                                    }
                                    if (Q == "<") {
                                        D(P, 2);
                                        return G(P, N, [">"], J, H)
                                    }
                                    if (/[\^'"!~\/]/.test(Q)) {
                                        D(P, 1);
                                        return G(P, N, [P.eat(Q)], J, H)
                                    }
                                } else {
                                    if (/[\^'"!~\/(\[{<]/.test(Q)) {
                                        if (Q == "(") {
                                            D(P, 1);
                                            return G(P, N, [")"], "string")
                                        }
                                        if (Q == "[") {
                                            D(P, 1);
                                            return G(P, N, ["]"], "string")
                                        }
                                        if (Q == "{") {
                                            D(P, 1);
                                            return G(P, N, ["}"], "string")
                                        }
                                        if (Q == "<") {
                                            D(P, 1);
                                            return G(P, N, [">"], "string")
                                        }
                                        if (/[\^'"!~\/]/.test(Q)) {
                                            return G(P, N, [P.eat(Q)], "string")
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            if (M == "m") {
                var Q = B(P, -2);
                if (!(Q && /\w/.test(Q))) {
                    Q = P.eat(/[(\[{<\^'"!~\/]/);
                    if (Q) {
                        if (/[\^'"!~\/]/.test(Q)) {
                            return G(P, N, [Q], J, H)
                        }
                        if (Q == "(") {
                            return G(P, N, [")"], J, H)
                        }
                        if (Q == "[") {
                            return G(P, N, ["]"], J, H)
                        }
                        if (Q == "{") {
                            return G(P, N, ["}"], J, H)
                        }
                        if (Q == "<") {
                            return G(P, N, [">"], J, H)
                        }
                    }
                }
            }
            if (M == "s") {
                var Q = /[\/>\]})\w]/.test(B(P, -2));
                if (!Q) {
                    Q = P.eat(/[(\[{<\^'"!~\/]/);
                    if (Q) {
                        if (Q == "[") {
                            return G(P, N, ["]", "]"], J, H)
                        }
                        if (Q == "{") {
                            return G(P, N, ["}", "}"], J, H)
                        }
                        if (Q == "<") {
                            return G(P, N, [">", ">"], J, H)
                        }
                        if (Q == "(") {
                            return G(P, N, [")", ")"], J, H)
                        }
                        return G(P, N, [Q, Q], J, H)
                    }
                }
            }
            if (M == "y") {
                var Q = /[\/>\]})\w]/.test(B(P, -2));
                if (!Q) {
                    Q = P.eat(/[(\[{<\^'"!~\/]/);
                    if (Q) {
                        if (Q == "[") {
                            return G(P, N, ["]", "]"], J, H)
                        }
                        if (Q == "{") {
                            return G(P, N, ["}", "}"], J, H)
                        }
                        if (Q == "<") {
                            return G(P, N, [">", ">"], J, H)
                        }
                        if (Q == "(") {
                            return G(P, N, [")", ")"], J, H)
                        }
                        return G(P, N, [Q, Q], J, H)
                    }
                }
            }
            if (M == "t") {
                var Q = /[\/>\]})\w]/.test(B(P, -2));
                if (!Q) {
                    Q = P.eat("r");
                    if (Q) {
                        Q = P.eat(/[(\[{<\^'"!~\/]/);
                        if (Q) {
                            if (Q == "[") {
                                return G(P, N, ["]", "]"], J, H)
                            }
                            if (Q == "{") {
                                return G(P, N, ["}", "}"], J, H)
                            }
                            if (Q == "<") {
                                return G(P, N, [">", ">"], J, H)
                            }
                            if (Q == "(") {
                                return G(P, N, [")", ")"], J, H)
                            }
                            return G(P, N, [Q, Q], J, H)
                        }
                    }
                }
            }
            if (M == "`") {
                return G(P, N, [M], "variable-2")
            }
            if (M == "/") {
                if (!/~\s*$/.test(C(P))) {
                    return "operator"
                } else {
                    return G(P, N, [M], J, H)
                }
            }
            if (M == "$") {
                var O = P.pos;
                if (P.eatWhile(/\d/) || P.eat("{") && P.eatWhile(/\d/) && P.eat("}")) {
                    return "variable-2"
                } else {
                    P.pos = O
                }
            }
            if (/[$@%]/.test(M)) {
                var O = P.pos;
                if (P.eat("^") && P.eat(/[A-Z]/) || !/[@$%&]/.test(B(P, -2)) && P.eat(/[=|\\\-#?@;:&`~\^!\[\]*'"$+.,\/<>()]/)) {
                    var Q = P.current();
                    if (F[Q]) {
                        return "variable-2"
                    }
                }
                P.pos = O
            }
            if (/[$@%&]/.test(M)) {
                if (P.eatWhile(/[\w$\[\]]/) || P.eat("{") && P.eatWhile(/[\w$\[\]]/) && P.eat("}")) {
                    var Q = P.current();
                    if (F[Q]) {
                        return "variable-2"
                    } else {
                        return "variable"
                    }
                }
            }
            if (M == "#") {
                if (B(P, -2) != "$") {
                    P.skipToEnd();
                    return "comment"
                }
            }
            if (/[:+\-\^*$&%@=<>!?|\/~\.]/.test(M)) {
                var O = P.pos;
                P.eatWhile(/[:+\-\^*$&%@=<>!?|\/~\.]/);
                if (F[P.current()]) {
                    return "operator"
                } else {
                    P.pos = O
                }
            }
            if (M == "_") {
                if (P.pos == 1) {
                    if (E(P, 6) == "_END__") {
                        return G(P, N, ["\0"], "comment")
                    } else {
                        if (E(P, 7) == "_DATA__") {
                            return G(P, N, ["\0"], "variable-2")
                        } else {
                            if (E(P, 7) == "_C__") {
                                return G(P, N, ["\0"], "string")
                            }
                        }
                    }
                }
            }
            if (/\w/.test(M)) {
                var O = P.pos;
                if (B(P, -2) == "{" && (B(P, 0) == "}" || P.eatWhile(/\w/) && B(P, 0) == "}")) {
                    return "string"
                } else {
                    P.pos = O
                }
            }
            if (/[A-Z]/.test(M)) {
                var L = B(P, -2);
                var O = P.pos;
                P.eatWhile(/[A-Z_]/);
                if (/[\da-z]/.test(B(P, 0))) {
                    P.pos = O
                } else {
                    var Q = F[P.current()];
                    if (!Q) {
                        return "meta"
                    }
                    if (Q[1]) {
                        Q = Q[0]
                    }
                    if (L != ":") {
                        if (Q == 1) {
                            return "keyword"
                        } else {
                            if (Q == 2) {
                                return "def"
                            } else {
                                if (Q == 3) {
                                    return "atom"
                                } else {
                                    if (Q == 4) {
                                        return "operator"
                                    } else {
                                        if (Q == 5) {
                                            return "variable-2"
                                        } else {
                                            return "meta"
                                        }
                                    }
                                }
                            }
                        }
                    } else {
                        return "meta"
                    }
                }
            }
            if (/[a-zA-Z_]/.test(M)) {
                var L = B(P, -2);
                P.eatWhile(/\w/);
                var Q = F[P.current()];
                if (!Q) {
                    return "meta"
                }
                if (Q[1]) {
                    Q = Q[0]
                }
                if (L != ":") {
                    if (Q == 1) {
                        return "keyword"
                    } else {
                        if (Q == 2) {
                            return "def"
                        } else {
                            if (Q == 3) {
                                return "atom"
                            } else {
                                if (Q == 4) {
                                    return "operator"
                                } else {
                                    if (Q == 5) {
                                        return "variable-2"
                                    } else {
                                        return "meta"
                                    }
                                }
                            }
                        }
                    }
                } else {
                    return "meta"
                }
            }
            return null
        }
        return {
            startState: function() {
                return {
                    tokenize: K,
                    chain: null,
                    style: null,
                    tail: null
                }
            },
            token: function(M, L) {
                return (L.tokenize || K)(M, L)
            },
            lineComment: "#"
        }
    });
    A.registerHelper("wordChars", "perl", /[\w$]/);
    A.defineMIME("text/x-perl", "perl");
    function B(F, G) {
        return F.string.charAt(F.pos + (G || 0))
    }
    function C(G, H) {
        if (H) {
            var F = G.pos - H;
            return G.string.substr((F >= 0 ? F : 0), H)
        } else {
            return G.string.substr(0, G.pos - 1)
        }
    }
    function E(G, I) {
        var H = G.string.length;
        var F = H - G.pos + 1;
        return G.string.substr(G.pos, (I && I < H ? I : F))
    }
    function D(G, I) {
        var F = G.pos + I;
        var H;
        if (F <= 0) {
            G.pos = 0
        } else {
            if (F >= (H = G.string.length - 1)) {
                G.pos = H
            } else {
                G.pos = F
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:php', location = '/static/bower/CodeMirror/mode/php/php.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"), require("../htmlmixed/htmlmixed"), require("../clike/clike"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror", "../htmlmixed/htmlmixed", "../clike/clike"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(C) {
    function E(M) {
        var K = {}
          , L = M.split(" ");
        for (var J = 0; J < L.length; ++J) {
            K[L[J]] = true
        }
        return K
    }
    function D(K, J) {
        if (K.length == 0) {
            return G(J)
        }
        return function(O, N) {
            var M = K[0];
            for (var L = 0; L < M.length; L++) {
                if (O.match(M[L][0])) {
                    N.tokenize = D(K.slice(1), J);
                    return M[L][1]
                }
            }
            N.tokenize = G(J);
            return "string"
        }
    }
    function G(J) {
        return function(L, K) {
            return A(L, K, J)
        }
    }
    function A(M, K, J) {
        if (M.match("${", false) || M.match("{$", false)) {
            K.tokenize = null;
            return "string"
        }
        if (M.match(/^\$[a-zA-Z_][a-zA-Z0-9_]*/)) {
            if (M.match("[", false)) {
                K.tokenize = D([[["[", null]], [[/\d[\w\.]*/, "number"], [/\$[a-zA-Z_][a-zA-Z0-9_]*/, "variable-2"], [/[\w\$]+/, "variable"]], [["]", null]]], J)
            }
            if (M.match(/\-\>\w/, false)) {
                K.tokenize = D([[["->", null]], [[/[\w]+/, "variable"]]], J)
            }
            return "variable-2"
        }
        var L = false;
        while (!M.eol() && (L || (!M.match("{$", false) && !M.match(/^(\$[a-zA-Z_][a-zA-Z0-9_]*|\$\{)/, false)))) {
            if (!L && M.match(J)) {
                K.tokenize = null;
                K.tokStack.pop();
                K.tokStack.pop();
                break
            }
            L = M.next() == "\\" && !L
        }
        return "string"
    }
    var H = "abstract and array as break case catch class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw trait try use var while xor die echo empty exit eval include include_once isset list require require_once return print unset __halt_compiler self static parent yield insteadof finally";
    var I = "true false null TRUE FALSE NULL __CLASS__ __DIR__ __FILE__ __LINE__ __METHOD__ __FUNCTION__ __NAMESPACE__ __TRAIT__";
    var B = "func_num_args func_get_arg func_get_args strlen strcmp strncmp strcasecmp strncasecmp each error_reporting define defined trigger_error user_error set_error_handler restore_error_handler get_declared_classes get_loaded_extensions extension_loaded get_extension_funcs debug_backtrace constant bin2hex hex2bin sleep usleep time mktime gmmktime strftime gmstrftime strtotime date gmdate getdate localtime checkdate flush wordwrap htmlspecialchars htmlentities html_entity_decode md5 md5_file crc32 getimagesize image_type_to_mime_type phpinfo phpversion phpcredits strnatcmp strnatcasecmp substr_count strspn strcspn strtok strtoupper strtolower strpos strrpos strrev hebrev hebrevc nl2br basename dirname pathinfo stripslashes stripcslashes strstr stristr strrchr str_shuffle str_word_count strcoll substr substr_replace quotemeta ucfirst ucwords strtr addslashes addcslashes rtrim str_replace str_repeat count_chars chunk_split trim ltrim strip_tags similar_text explode implode setlocale localeconv parse_str str_pad chop strchr sprintf printf vprintf vsprintf sscanf fscanf parse_url urlencode urldecode rawurlencode rawurldecode readlink linkinfo link unlink exec system escapeshellcmd escapeshellarg passthru shell_exec proc_open proc_close rand srand getrandmax mt_rand mt_srand mt_getrandmax base64_decode base64_encode abs ceil floor round is_finite is_nan is_infinite bindec hexdec octdec decbin decoct dechex base_convert number_format fmod ip2long long2ip getenv putenv getopt microtime gettimeofday getrusage uniqid quoted_printable_decode set_time_limit get_cfg_var magic_quotes_runtime set_magic_quotes_runtime get_magic_quotes_gpc get_magic_quotes_runtime import_request_variables error_log serialize unserialize memory_get_usage var_dump var_export debug_zval_dump print_r highlight_file show_source highlight_string ini_get ini_get_all ini_set ini_alter ini_restore get_include_path set_include_path restore_include_path setcookie header headers_sent connection_aborted connection_status ignore_user_abort parse_ini_file is_uploaded_file move_uploaded_file intval floatval doubleval strval gettype settype is_null is_resource is_bool is_long is_float is_int is_integer is_double is_real is_numeric is_string is_array is_object is_scalar ereg ereg_replace eregi eregi_replace split spliti join sql_regcase dl pclose popen readfile rewind rmdir umask fclose feof fgetc fgets fgetss fread fopen fpassthru ftruncate fstat fseek ftell fflush fwrite fputs mkdir rename copy tempnam tmpfile file file_get_contents stream_select stream_context_create stream_context_set_params stream_context_set_option stream_context_get_options stream_filter_prepend stream_filter_append fgetcsv flock get_meta_tags stream_set_write_buffer set_file_buffer set_socket_blocking stream_set_blocking socket_set_blocking stream_get_meta_data stream_register_wrapper stream_wrapper_register stream_set_timeout socket_set_timeout socket_get_status realpath fnmatch fsockopen pfsockopen pack unpack get_browser crypt opendir closedir chdir getcwd rewinddir readdir dir glob fileatime filectime filegroup fileinode filemtime fileowner fileperms filesize filetype file_exists is_writable is_writeable is_readable is_executable is_file is_dir is_link stat lstat chown touch clearstatcache mail ob_start ob_flush ob_clean ob_end_flush ob_end_clean ob_get_flush ob_get_clean ob_get_length ob_get_level ob_get_status ob_get_contents ob_implicit_flush ob_list_handlers ksort krsort natsort natcasesort asort arsort sort rsort usort uasort uksort shuffle array_walk count end prev next reset current key min max in_array array_search extract compact array_fill range array_multisort array_push array_pop array_shift array_unshift array_splice array_slice array_merge array_merge_recursive array_keys array_values array_count_values array_reverse array_reduce array_pad array_flip array_change_key_case array_rand array_unique array_intersect array_intersect_assoc array_diff array_diff_assoc array_sum array_filter array_map array_chunk array_key_exists pos sizeof key_exists assert assert_options version_compare ftok str_rot13 aggregate session_name session_module_name session_save_path session_id session_regenerate_id session_decode session_register session_unregister session_is_registered session_encode session_start session_destroy session_unset session_set_save_handler session_cache_limiter session_cache_expire session_set_cookie_params session_get_cookie_params session_write_close preg_match preg_match_all preg_replace preg_replace_callback preg_split preg_quote preg_grep overload ctype_alnum ctype_alpha ctype_cntrl ctype_digit ctype_lower ctype_graph ctype_print ctype_punct ctype_space ctype_upper ctype_xdigit virtual apache_request_headers apache_note apache_lookup_uri apache_child_terminate apache_setenv apache_response_headers apache_get_version getallheaders mysql_connect mysql_pconnect mysql_close mysql_select_db mysql_create_db mysql_drop_db mysql_query mysql_unbuffered_query mysql_db_query mysql_list_dbs mysql_list_tables mysql_list_fields mysql_list_processes mysql_error mysql_errno mysql_affected_rows mysql_insert_id mysql_result mysql_num_rows mysql_num_fields mysql_fetch_row mysql_fetch_array mysql_fetch_assoc mysql_fetch_object mysql_data_seek mysql_fetch_lengths mysql_fetch_field mysql_field_seek mysql_free_result mysql_field_name mysql_field_table mysql_field_len mysql_field_type mysql_field_flags mysql_escape_string mysql_real_escape_string mysql_stat mysql_thread_id mysql_client_encoding mysql_get_client_info mysql_get_host_info mysql_get_proto_info mysql_get_server_info mysql_info mysql mysql_fieldname mysql_fieldtable mysql_fieldlen mysql_fieldtype mysql_fieldflags mysql_selectdb mysql_createdb mysql_dropdb mysql_freeresult mysql_numfields mysql_numrows mysql_listdbs mysql_listtables mysql_listfields mysql_db_name mysql_dbname mysql_tablename mysql_table_name pg_connect pg_pconnect pg_close pg_connection_status pg_connection_busy pg_connection_reset pg_host pg_dbname pg_port pg_tty pg_options pg_ping pg_query pg_send_query pg_cancel_query pg_fetch_result pg_fetch_row pg_fetch_assoc pg_fetch_array pg_fetch_object pg_fetch_all pg_affected_rows pg_get_result pg_result_seek pg_result_status pg_free_result pg_last_oid pg_num_rows pg_num_fields pg_field_name pg_field_num pg_field_size pg_field_type pg_field_prtlen pg_field_is_null pg_get_notify pg_get_pid pg_result_error pg_last_error pg_last_notice pg_put_line pg_end_copy pg_copy_to pg_copy_from pg_trace pg_untrace pg_lo_create pg_lo_unlink pg_lo_open pg_lo_close pg_lo_read pg_lo_write pg_lo_read_all pg_lo_import pg_lo_export pg_lo_seek pg_lo_tell pg_escape_string pg_escape_bytea pg_unescape_bytea pg_client_encoding pg_set_client_encoding pg_meta_data pg_convert pg_insert pg_update pg_delete pg_select pg_exec pg_getlastoid pg_cmdtuples pg_errormessage pg_numrows pg_numfields pg_fieldname pg_fieldsize pg_fieldtype pg_fieldnum pg_fieldprtlen pg_fieldisnull pg_freeresult pg_result pg_loreadall pg_locreate pg_lounlink pg_loopen pg_loclose pg_loread pg_lowrite pg_loimport pg_loexport http_response_code get_declared_traits getimagesizefromstring socket_import_stream stream_set_chunk_size trait_exists header_register_callback class_uses session_status session_register_shutdown echo print global static exit array empty eval isset unset die include require include_once require_once json_decode json_encode json_last_error json_last_error_msg curl_close curl_copy_handle curl_errno curl_error curl_escape curl_exec curl_file_create curl_getinfo curl_init curl_multi_add_handle curl_multi_close curl_multi_exec curl_multi_getcontent curl_multi_info_read curl_multi_init curl_multi_remove_handle curl_multi_select curl_multi_setopt curl_multi_strerror curl_pause curl_reset curl_setopt_array curl_setopt curl_share_close curl_share_init curl_share_setopt curl_strerror curl_unescape curl_version mysqli_affected_rows mysqli_autocommit mysqli_change_user mysqli_character_set_name mysqli_close mysqli_commit mysqli_connect_errno mysqli_connect_error mysqli_connect mysqli_data_seek mysqli_debug mysqli_dump_debug_info mysqli_errno mysqli_error_list mysqli_error mysqli_fetch_all mysqli_fetch_array mysqli_fetch_assoc mysqli_fetch_field_direct mysqli_fetch_field mysqli_fetch_fields mysqli_fetch_lengths mysqli_fetch_object mysqli_fetch_row mysqli_field_count mysqli_field_seek mysqli_field_tell mysqli_free_result mysqli_get_charset mysqli_get_client_info mysqli_get_client_stats mysqli_get_client_version mysqli_get_connection_stats mysqli_get_host_info mysqli_get_proto_info mysqli_get_server_info mysqli_get_server_version mysqli_info mysqli_init mysqli_insert_id mysqli_kill mysqli_more_results mysqli_multi_query mysqli_next_result mysqli_num_fields mysqli_num_rows mysqli_options mysqli_ping mysqli_prepare mysqli_query mysqli_real_connect mysqli_real_escape_string mysqli_real_query mysqli_reap_async_query mysqli_refresh mysqli_rollback mysqli_select_db mysqli_set_charset mysqli_set_local_infile_default mysqli_set_local_infile_handler mysqli_sqlstate mysqli_ssl_set mysqli_stat mysqli_stmt_init mysqli_store_result mysqli_thread_id mysqli_thread_safe mysqli_use_result mysqli_warning_count";
    C.registerHelper("hintWords", "php", [H, I, B].join(" ").split(" "));
    C.registerHelper("wordChars", "php", /[\w$]/);
    var F = {
        name: "clike",
        helperType: "php",
        keywords: E(H),
        blockKeywords: E("catch do else elseif for foreach if switch try while finally"),
        atoms: E(I),
        builtin: E(B),
        multiLineStrings: true,
        hooks: {
            "$": function(J) {
                J.eatWhile(/[\w\$_]/);
                return "variable-2"
            },
            "<": function(L, J) {
                if (L.match(/<</)) {
                    L.eatWhile(/[\w\.]/);
                    var K = L.current().slice(3);
                    if (K) {
                        (J.tokStack || (J.tokStack = [])).push(K, 0);
                        J.tokenize = G(K);
                        return "string"
                    }
                }
                return false
            },
            "#": function(J) {
                while (!J.eol() && !J.match("?>", false)) {
                    J.next()
                }
                return "comment"
            },
            "/": function(J) {
                if (J.eat("/")) {
                    while (!J.eol() && !J.match("?>", false)) {
                        J.next()
                    }
                    return "comment"
                }
                return false
            },
            '"': function(J, K) {
                (K.tokStack || (K.tokStack = [])).push('"', 0);
                K.tokenize = G('"');
                return "string"
            },
            "{": function(J, K) {
                if (K.tokStack && K.tokStack.length) {
                    K.tokStack[K.tokStack.length - 1]++
                }
                return false
            },
            "}": function(J, K) {
                if (K.tokStack && K.tokStack.length > 0 && !--K.tokStack[K.tokStack.length - 1]) {
                    K.tokenize = G(K.tokStack[K.tokStack.length - 2])
                }
                return false
            }
        }
    };
    C.defineMode("php", function(L, M) {
        var N = C.getMode(L, "text/html");
        var J = C.getMode(L, F);
        function K(U, S) {
            var R = S.curMode == J;
            if (U.sol() && S.pending && S.pending != '"' && S.pending != "'") {
                S.pending = null
            }
            if (!R) {
                if (U.match(/^<\?\w*/)) {
                    S.curMode = J;
                    S.curState = S.php;
                    return "meta"
                }
                if (S.pending == '"' || S.pending == "'") {
                    while (!U.eol() && U.next() != S.pending) {}
                    var Q = "string"
                } else {
                    if (S.pending && U.pos < S.pending.end) {
                        U.pos = S.pending.end;
                        var Q = S.pending.style
                    } else {
                        var Q = N.token(U, S.curState)
                    }
                }
                if (S.pending) {
                    S.pending = null
                }
                var T = U.current(), P = T.search(/<\?/), O;
                if (P != -1) {
                    if (Q == "string" && (O = T.match(/[\'\"]$/)) && !/\?>/.test(T)) {
                        S.pending = O[0]
                    } else {
                        S.pending = {
                            end: U.pos,
                            style: Q
                        }
                    }
                    U.backUp(T.length - P)
                }
                return Q
            } else {
                if (R && S.php.tokenize == null && U.match("?>")) {
                    S.curMode = N;
                    S.curState = S.html;
                    return "meta"
                } else {
                    return J.token(U, S.curState)
                }
            }
        }
        return {
            startState: function() {
                var O = C.startState(N)
                  , P = C.startState(J);
                return {
                    html: O,
                    php: P,
                    curMode: M.startOpen ? J : N,
                    curState: M.startOpen ? P : O,
                    pending: null
                }
            },
            copyState: function(R) {
                var P = R.html, Q = C.copyState(N, P), T = R.php, O = C.copyState(J, T), S;
                if (R.curMode == N) {
                    S = Q
                } else {
                    S = O
                }
                return {
                    html: Q,
                    php: O,
                    curMode: R.curMode,
                    curState: S,
                    pending: R.pending
                }
            },
            token: K,
            indent: function(P, O) {
                if ((P.curMode != J && /^\s*<\//.test(O)) || (P.curMode == J && /^\?>/.test(O))) {
                    return N.indent(P.html, O)
                }
                return P.curMode.indent(P.curState, O)
            },
            blockCommentStart: "/*",
            blockCommentEnd: "*/",
            lineComment: "//",
            innerMode: function(O) {
                return {
                    state: O.curState,
                    mode: O.curMode
                }
            }
        }
    }, "htmlmixed", "clike");
    C.defineMIME("application/x-httpd-php", "php");
    C.defineMIME("application/x-httpd-php-open", {
        name: "php",
        startOpen: true
    });
    C.defineMIME("text/x-php", F)
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:python', location = '/static/bower/CodeMirror/mode/python/python.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(C) {
    function E(J) {
        return new RegExp("^((" + J.join(")|(") + "))\\b")
    }
    var H = E(["and", "or", "not", "is"]);
    var I = ["as", "assert", "break", "class", "continue", "def", "del", "elif", "else", "except", "finally", "for", "from", "global", "if", "import", "lambda", "pass", "raise", "return", "try", "while", "with", "yield", "in"];
    var D = ["abs", "all", "any", "bin", "bool", "bytearray", "callable", "chr", "classmethod", "compile", "complex", "delattr", "dict", "dir", "divmod", "enumerate", "eval", "filter", "float", "format", "frozenset", "getattr", "globals", "hasattr", "hash", "help", "hex", "id", "input", "int", "isinstance", "issubclass", "iter", "len", "list", "locals", "map", "max", "memoryview", "min", "next", "object", "oct", "open", "ord", "pow", "property", "range", "repr", "reversed", "round", "set", "setattr", "slice", "sorted", "staticmethod", "str", "sum", "super", "tuple", "type", "vars", "zip", "__import__", "NotImplemented", "Ellipsis", "__debug__"];
    var B = {
        builtins: ["apply", "basestring", "buffer", "cmp", "coerce", "execfile", "file", "intern", "long", "raw_input", "reduce", "reload", "unichr", "unicode", "xrange", "False", "True", "None"],
        keywords: ["exec", "print"]
    };
    var A = {
        builtins: ["ascii", "bytes", "exec", "print"],
        keywords: ["nonlocal", "False", "True", "None"]
    };
    C.registerHelper("hintWords", "python", I.concat(D));
    function G(J) {
        return J.scopes[J.scopes.length - 1]
    }
    C.defineMode("python", function(S, b) {
        var K = "error";
        var W = b.singleDelimiters || new RegExp("^[\\(\\)\\[\\]\\{\\}@,:`=;\\.]");
        var J = b.doubleOperators || new RegExp("^((==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//)|(\\*\\*))");
        var Q = b.doubleDelimiters || new RegExp("^((\\+=)|(\\-=)|(\\*=)|(%=)|(/=)|(&=)|(\\|=)|(\\^=))");
        var c = b.tripleDelimiters || new RegExp("^((//=)|(>>=)|(<<=)|(\\*\\*=))");
        if (b.version && parseInt(b.version, 10) == 3) {
            var V = b.singleOperators || new RegExp("^[\\+\\-\\*/%&|\\^~<>!@]");
            var P = b.identifiers || new RegExp("^[_A-Za-z\u00A1-\uFFFF][_A-Za-z0-9\u00A1-\uFFFF]*")
        } else {
            var V = b.singleOperators || new RegExp("^[\\+\\-\\*/%&|\\^~<>!]");
            var P = b.identifiers || new RegExp("^[_A-Za-z][_A-Za-z0-9]*")
        }
        var L = b.hangingIndent || S.indentUnit;
        var a = I
          , X = D;
        if (b.extra_keywords != undefined) {
            a = a.concat(b.extra_keywords)
        }
        if (b.extra_builtins != undefined) {
            X = X.concat(b.extra_builtins)
        }
        if (b.version && parseInt(b.version, 10) == 3) {
            a = a.concat(A.keywords);
            X = X.concat(A.builtins);
            var T = new RegExp("^(([rb]|(br))?('{3}|\"{3}|['\"]))","i")
        } else {
            a = a.concat(B.keywords);
            X = X.concat(B.builtins);
            var T = new RegExp("^(([rub]|(ur)|(br))?('{3}|\"{3}|['\"]))","i")
        }
        var R = E(a);
        var M = E(X);
        function e(j, i) {
            if (j.sol() && G(i).type == "py") {
                var f = G(i).offset;
                if (j.eatSpace()) {
                    var g = j.indentation();
                    if (g > f) {
                        U(j, i, "py")
                    } else {
                        if (g < f && N(j, i)) {
                            i.errorToken = true
                        }
                    }
                    return null
                } else {
                    var h = Y(j, i);
                    if (f > 0 && N(j, i)) {
                        h += " " + K
                    }
                    return h
                }
            }
            return Y(j, i)
        }
        function Y(j, i) {
            if (j.eatSpace()) {
                return null
            }
            var h = j.peek();
            if (h == "#") {
                j.skipToEnd();
                return "comment"
            }
            if (j.match(/^[0-9\.]/, false)) {
                var g = false;
                if (j.match(/^\d*\.\d+(e[\+\-]?\d+)?/i)) {
                    g = true
                }
                if (j.match(/^\d+\.\d*/)) {
                    g = true
                }
                if (j.match(/^\.\d+/)) {
                    g = true
                }
                if (g) {
                    j.eat(/J/i);
                    return "number"
                }
                var f = false;
                if (j.match(/^0x[0-9a-f]+/i)) {
                    f = true
                }
                if (j.match(/^0b[01]+/i)) {
                    f = true
                }
                if (j.match(/^0o[0-7]+/i)) {
                    f = true
                }
                if (j.match(/^[1-9]\d*(e[\+\-]?\d+)?/)) {
                    j.eat(/J/i);
                    f = true
                }
                if (j.match(/^0(?![\dx])/i)) {
                    f = true
                }
                if (f) {
                    j.eat(/L/i);
                    return "number"
                }
            }
            if (j.match(T)) {
                i.tokenize = Z(j.current());
                return i.tokenize(j, i)
            }
            if (j.match(c) || j.match(Q)) {
                return null
            }
            if (j.match(J) || j.match(V) || j.match(H)) {
                return "operator"
            }
            if (j.match(W)) {
                return null
            }
            if (j.match(R)) {
                return "keyword"
            }
            if (j.match(M)) {
                return "builtin"
            }
            if (j.match(/^(self|cls)\b/)) {
                return "variable-2"
            }
            if (j.match(P)) {
                if (i.lastToken == "def" || i.lastToken == "class") {
                    return "def"
                }
                return "variable"
            }
            j.next();
            return K
        }
        function Z(f) {
            while ("rub".indexOf(f.charAt(0).toLowerCase()) >= 0) {
                f = f.substr(1)
            }
            var h = f.length == 1;
            var g = "string";
            function i(k, j) {
                while (!k.eol()) {
                    k.eatWhile(/[^'"\\]/);
                    if (k.eat("\\")) {
                        k.next();
                        if (h && k.eol()) {
                            return g
                        }
                    } else {
                        if (k.match(f)) {
                            j.tokenize = e;
                            return g
                        } else {
                            k.eat(/['"]/)
                        }
                    }
                }
                if (h) {
                    if (b.singleLineStringErrors) {
                        return K
                    } else {
                        j.tokenize = e
                    }
                }
                return g
            }
            i.isString = true;
            return i
        }
        function U(i, g, f) {
            var h = 0
              , j = null;
            if (f == "py") {
                while (G(g).type != "py") {
                    g.scopes.pop()
                }
            }
            h = G(g).offset + (f == "py" ? S.indentUnit : L);
            if (f != "py" && !i.match(/^(\s|#.*)*$/, false)) {
                j = i.column() + 1
            }
            g.scopes.push({
                offset: h,
                type: f,
                align: j
            })
        }
        function N(g, f) {
            var h = g.indentation();
            while (G(f).offset > h) {
                if (G(f).type != "py") {
                    return true
                }
                f.scopes.pop()
            }
            return G(f).offset != h
        }
        function d(j, h) {
            var g = h.tokenize(j, h);
            var i = j.current();
            if (i == ".") {
                g = j.match(P, false) ? null : K;
                if (g == null && h.lastStyle == "meta") {
                    g = "meta"
                }
                return g
            }
            if (i == "@") {
                if (b.version && parseInt(b.version, 10) == 3) {
                    return j.match(P, false) ? "meta" : "operator"
                } else {
                    return j.match(P, false) ? "meta" : K
                }
            }
            if ((g == "variable" || g == "builtin") && h.lastStyle == "meta") {
                g = "meta"
            }
            if (i == "pass" || i == "return") {
                h.dedent += 1
            }
            if (i == "lambda") {
                h.lambda = true
            }
            if (i == ":" && !h.lambda && G(h).type == "py") {
                U(j, h, "py")
            }
            var f = i.length == 1 ? "[({".indexOf(i) : -1;
            if (f != -1) {
                U(j, h, "])}".slice(f, f + 1))
            }
            f = "])}".indexOf(i);
            if (f != -1) {
                if (G(h).type == i) {
                    h.scopes.pop()
                } else {
                    return K
                }
            }
            if (h.dedent > 0 && j.eol() && G(h).type == "py") {
                if (h.scopes.length > 1) {
                    h.scopes.pop()
                }
                h.dedent -= 1
            }
            return g
        }
        var O = {
            startState: function(f) {
                return {
                    tokenize: e,
                    scopes: [{
                        offset: f || 0,
                        type: "py",
                        align: null
                    }],
                    lastStyle: null,
                    lastToken: null,
                    lambda: false,
                    dedent: 0
                }
            },
            token: function(j, g) {
                var i = g.errorToken;
                if (i) {
                    g.errorToken = false
                }
                var f = d(j, g);
                g.lastStyle = f;
                var h = j.current();
                if (h && f) {
                    g.lastToken = h
                }
                if (j.eol() && g.lambda) {
                    g.lambda = false
                }
                return i ? f + " " + K : f
            },
            indent: function(i, f) {
                if (i.tokenize != e) {
                    return i.tokenize.isString ? C.Pass : 0
                }
                var h = G(i);
                var g = f && f.charAt(0) == h.type;
                if (h.align != null) {
                    return h.align - (g ? 1 : 0)
                } else {
                    if (g && i.scopes.length > 1) {
                        return i.scopes[i.scopes.length - 2].offset
                    } else {
                        return h.offset
                    }
                }
            },
            lineComment: "#",
            fold: "indent"
        };
        return O
    });
    C.defineMIME("text/x-python", "python");
    var F = function(J) {
        return J.split(" ")
    };
    C.defineMIME("text/x-cython", {
        name: "python",
        extra_keywords: F("by cdef cimport cpdef ctypedef enum exceptextern gil include nogil property publicreadonly struct union DEF IF ELIF ELSE")
    })
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:ruby', location = '/static/bower/CodeMirror/mode/ruby/ruby.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("ruby", function(F) {
        function B(S) {
            var R = {};
            for (var P = 0, Q = S.length; P < Q; ++P) {
                R[S[P]] = true
            }
            return R
        }
        var K = B(["alias", "and", "BEGIN", "begin", "break", "case", "class", "def", "defined?", "do", "else", "elsif", "END", "end", "ensure", "false", "for", "if", "in", "module", "next", "not", "or", "redo", "rescue", "retry", "return", "self", "super", "then", "true", "undef", "unless", "until", "when", "while", "yield", "nil", "raise", "throw", "catch", "fail", "loop", "callcc", "caller", "lambda", "proc", "public", "protected", "private", "require", "load", "require_relative", "extend", "autoload", "__END__", "__FILE__", "__LINE__", "__dir__"]);
        var J = B(["def", "class", "case", "for", "while", "module", "then", "catch", "loop", "proc", "begin"]);
        var E = B(["end", "until"]);
        var D = {
            "[": "]",
            "{": "}",
            "(": ")"
        };
        var M;
        function C(P, R, Q) {
            Q.tokenize.push(P);
            return P(R, Q)
        }
        function G(a, R) {
            M = null;
            if (a.sol() && a.match("=begin") && a.eol()) {
                R.tokenize.push(L);
                return "comment"
            }
            if (a.eatSpace()) {
                return null
            }
            var P = a.next(), U;
            if (P == "`" || P == "'" || P == '"') {
                return C(N(P, "string", P == '"' || P == "`"), a, R)
            } else {
                if (P == "/") {
                    var X = a.current().length;
                    if (a.skipTo("/")) {
                        var V = a.current().length;
                        a.backUp(a.current().length - X);
                        var T = 0;
                        while (a.current().length < V) {
                            var Z = a.next();
                            if (Z == "(") {
                                T += 1
                            } else {
                                if (Z == ")") {
                                    T -= 1
                                }
                            }
                            if (T < 0) {
                                break
                            }
                        }
                        a.backUp(a.current().length - X);
                        if (T == 0) {
                            return C(N(P, "string-2", true), a, R)
                        }
                    }
                    return "operator"
                } else {
                    if (P == "%") {
                        var Q = "string"
                          , W = true;
                        if (a.eat("s")) {
                            Q = "atom"
                        } else {
                            if (a.eat(/[WQ]/)) {
                                Q = "string"
                            } else {
                                if (a.eat(/[r]/)) {
                                    Q = "string-2"
                                } else {
                                    if (a.eat(/[wxq]/)) {
                                        Q = "string";
                                        W = false
                                    }
                                }
                            }
                        }
                        var S = a.eat(/[^\w\s=]/);
                        if (!S) {
                            return "operator"
                        }
                        if (D.propertyIsEnumerable(S)) {
                            S = D[S]
                        }
                        return C(N(S, Q, W, true), a, R)
                    } else {
                        if (P == "#") {
                            a.skipToEnd();
                            return "comment"
                        } else {
                            if (P == "<" && (U = a.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))) {
                                return C(I(U[1]), a, R)
                            } else {
                                if (P == "0") {
                                    if (a.eat("x")) {
                                        a.eatWhile(/[\da-fA-F]/)
                                    } else {
                                        if (a.eat("b")) {
                                            a.eatWhile(/[01]/)
                                        } else {
                                            a.eatWhile(/[0-7]/)
                                        }
                                    }
                                    return "number"
                                } else {
                                    if (/\d/.test(P)) {
                                        a.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);
                                        return "number"
                                    } else {
                                        if (P == "?") {
                                            while (a.match(/^\\[CM]-/)) {}
                                            if (a.eat("\\")) {
                                                a.eatWhile(/\w/)
                                            } else {
                                                a.next()
                                            }
                                            return "string"
                                        } else {
                                            if (P == ":") {
                                                if (a.eat("'")) {
                                                    return C(N("'", "atom", false), a, R)
                                                }
                                                if (a.eat('"')) {
                                                    return C(N('"', "atom", true), a, R)
                                                }
                                                if (a.eat(/[\<\>]/)) {
                                                    a.eat(/[\<\>]/);
                                                    return "atom"
                                                }
                                                if (a.eat(/[\+\-\*\/\&\|\:\!]/)) {
                                                    return "atom"
                                                }
                                                if (a.eat(/[a-zA-Z$@_\xa1-\uffff]/)) {
                                                    a.eatWhile(/[\w$\xa1-\uffff]/);
                                                    a.eat(/[\?\!\=]/);
                                                    return "atom"
                                                }
                                                return "operator"
                                            } else {
                                                if (P == "@" && a.match(/^@?[a-zA-Z_\xa1-\uffff]/)) {
                                                    a.eat("@");
                                                    a.eatWhile(/[\w\xa1-\uffff]/);
                                                    return "variable-2"
                                                } else {
                                                    if (P == "$") {
                                                        if (a.eat(/[a-zA-Z_]/)) {
                                                            a.eatWhile(/[\w]/)
                                                        } else {
                                                            if (a.eat(/\d/)) {
                                                                a.eat(/\d/)
                                                            } else {
                                                                a.next()
                                                            }
                                                        }
                                                        return "variable-3"
                                                    } else {
                                                        if (/[a-zA-Z_\xa1-\uffff]/.test(P)) {
                                                            a.eatWhile(/[\w\xa1-\uffff]/);
                                                            a.eat(/[\?\!]/);
                                                            if (a.eat(":")) {
                                                                return "atom"
                                                            }
                                                            return "ident"
                                                        } else {
                                                            if (P == "|" && (R.varList || R.lastTok == "{" || R.lastTok == "do")) {
                                                                M = "|";
                                                                return null
                                                            } else {
                                                                if (/[\(\)\[\]{}\\;]/.test(P)) {
                                                                    M = P;
                                                                    return null
                                                                } else {
                                                                    if (P == "-" && a.eat(">")) {
                                                                        return "arrow"
                                                                    } else {
                                                                        if (/[=+\-\/*:\.^%<>~|]/.test(P)) {
                                                                            var Y = a.eatWhile(/[=+\-\/*:\.^%<>~|]/);
                                                                            if (P == "." && !Y) {
                                                                                M = "."
                                                                            }
                                                                            return "operator"
                                                                        } else {
                                                                            return null
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        function O(P) {
            if (!P) {
                P = 1
            }
            return function(R, Q) {
                if (R.peek() == "}") {
                    if (P == 1) {
                        Q.tokenize.pop();
                        return Q.tokenize[Q.tokenize.length - 1](R, Q)
                    } else {
                        Q.tokenize[Q.tokenize.length - 1] = O(P - 1)
                    }
                } else {
                    if (R.peek() == "{") {
                        Q.tokenize[Q.tokenize.length - 1] = O(P + 1)
                    }
                }
                return G(R, Q)
            }
        }
        function H() {
            var P = false;
            return function(R, Q) {
                if (P) {
                    Q.tokenize.pop();
                    return Q.tokenize[Q.tokenize.length - 1](R, Q)
                }
                P = true;
                return G(R, Q)
            }
        }
        function N(P, Q, S, R) {
            return function(W, U) {
                var V = false, T;
                if (U.context.type === "read-quoted-paused") {
                    U.context = U.context.prev;
                    W.eat("}")
                }
                while ((T = W.next()) != null) {
                    if (T == P && (R || !V)) {
                        U.tokenize.pop();
                        break
                    }
                    if (S && T == "#" && !V) {
                        if (W.eat("{")) {
                            if (P == "}") {
                                U.context = {
                                    prev: U.context,
                                    type: "read-quoted-paused"
                                }
                            }
                            U.tokenize.push(O());
                            break
                        } else {
                            if (/[@\$]/.test(W.peek())) {
                                U.tokenize.push(H());
                                break
                            }
                        }
                    }
                    V = !V && T == "\\"
                }
                return Q
            }
        }
        function I(P) {
            return function(R, Q) {
                if (R.match(P)) {
                    Q.tokenize.pop()
                } else {
                    R.skipToEnd()
                }
                return "string"
            }
        }
        function L(Q, P) {
            if (Q.sol() && Q.match("=end") && Q.eol()) {
                P.tokenize.pop()
            }
            Q.skipToEnd();
            return "comment"
        }
        return {
            startState: function() {
                return {
                    tokenize: [G],
                    indented: 0,
                    context: {
                        type: "top",
                        indented: -F.indentUnit
                    },
                    continuedLine: false,
                    lastTok: null,
                    varList: false
                }
            },
            token: function(U, R) {
                if (U.sol()) {
                    R.indented = U.indentation()
                }
                var Q = R.tokenize[R.tokenize.length - 1](U, R), T;
                var P = M;
                if (Q == "ident") {
                    var S = U.current();
                    Q = R.lastTok == "." ? "property" : K.propertyIsEnumerable(U.current()) ? "keyword" : /^[A-Z]/.test(S) ? "tag" : (R.lastTok == "def" || R.lastTok == "class" || R.varList) ? "def" : "variable";
                    if (Q == "keyword") {
                        P = S;
                        if (J.propertyIsEnumerable(S)) {
                            T = "indent"
                        } else {
                            if (E.propertyIsEnumerable(S)) {
                                T = "dedent"
                            } else {
                                if ((S == "if" || S == "unless") && U.column() == U.indentation()) {
                                    T = "indent"
                                } else {
                                    if (S == "do" && R.context.indented < R.indented) {
                                        T = "indent"
                                    }
                                }
                            }
                        }
                    }
                }
                if (M || (Q && Q != "comment")) {
                    R.lastTok = P
                }
                if (M == "|") {
                    R.varList = !R.varList
                }
                if (T == "indent" || /[\(\[\{]/.test(M)) {
                    R.context = {
                        prev: R.context,
                        type: M || Q,
                        indented: R.indented
                    }
                } else {
                    if ((T == "dedent" || /[\)\]\}]/.test(M)) && R.context.prev) {
                        R.context = R.context.prev
                    }
                }
                if (U.eol()) {
                    R.continuedLine = (M == "\\" || Q == "operator")
                }
                return Q
            },
            indent: function(T, P) {
                if (T.tokenize[T.tokenize.length - 1] != G) {
                    return 0
                }
                var S = P && P.charAt(0);
                var R = T.context;
                var Q = R.type == D[S] || R.type == "keyword" && /^(?:end|until|else|elsif|when|rescue)\b/.test(P);
                return R.indented + (Q ? 0 : F.indentUnit) + (T.continuedLine ? F.indentUnit : 0)
            },
            electricChars: "}de",
            lineComment: "#"
        }
    });
    A.defineMIME("text/x-ruby", "ruby")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:sass', location = '/static/bower/CodeMirror/mode/sass/sass.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("sass", function(F) {
        function P(Q) {
            return new RegExp("^" + Q.join("|"))
        }
        var K = ["true", "false", "null", "auto"];
        var B = new RegExp("^" + K.join("|"));
        var I = ["\\(", "\\)", "=", ">", "<", "==", ">=", "<=", "\\+", "-", "\\!=", "/", "\\*", "%", "and", "or", "not", ";", "\\{", "\\}", ":"];
        var N = P(I);
        var O = /^::?[a-zA-Z_][\w\-]*/;
        function M(S, R) {
            var Q = S.peek();
            if (Q === ")") {
                S.next();
                R.tokenizer = G;
                return "operator"
            } else {
                if (Q === "(") {
                    S.next();
                    S.eatSpace();
                    return "operator"
                } else {
                    if (Q === "'" || Q === '"') {
                        R.tokenizer = H(S.next());
                        return "string"
                    } else {
                        R.tokenizer = H(")", false);
                        return "string"
                    }
                }
            }
        }
        function L(Q, R) {
            return function(T, S) {
                if (T.sol() && T.indentation() <= Q) {
                    S.tokenizer = G;
                    return G(T, S)
                }
                if (R && T.skipTo("*/")) {
                    T.next();
                    T.next();
                    S.tokenizer = G
                } else {
                    T.skipToEnd()
                }
                return "comment"
            }
        }
        function H(Q, S) {
            if (S == null) {
                S = true
            }
            function R(X, U) {
                var W = X.next();
                var T = X.peek();
                var Y = X.string.charAt(X.pos - 2);
                var V = ((W !== "\\" && T === Q) || (W === Q && Y !== "\\"));
                if (V) {
                    if (W !== Q && S) {
                        X.next()
                    }
                    U.tokenizer = G;
                    return "string"
                } else {
                    if (W === "#" && T === "{") {
                        U.tokenizer = D(R);
                        X.next();
                        return "operator"
                    } else {
                        return "string"
                    }
                }
            }
            return R
        }
        function D(Q) {
            return function(S, R) {
                if (S.peek() === "}") {
                    S.next();
                    R.tokenizer = Q;
                    return "operator"
                } else {
                    return G(S, R)
                }
            }
        }
        function E(R) {
            if (R.indentCount == 0) {
                R.indentCount++;
                var S = R.scopes[0].offset;
                var Q = S + F.indentUnit;
                R.scopes.unshift({
                    offset: Q
                })
            }
        }
        function J(Q) {
            if (Q.scopes.length == 1) {
                return
            }
            Q.scopes.shift()
        }
        function G(S, R) {
            var Q = S.peek();
            if (S.match("/*")) {
                R.tokenizer = L(S.indentation(), true);
                return R.tokenizer(S, R)
            }
            if (S.match("//")) {
                R.tokenizer = L(S.indentation(), false);
                return R.tokenizer(S, R)
            }
            if (S.match("#{")) {
                R.tokenizer = D(G);
                return "operator"
            }
            if (Q === '"' || Q === "'") {
                S.next();
                R.tokenizer = H(Q);
                return "string"
            }
            if (!R.cursorHalf) {
                if (Q === ".") {
                    S.next();
                    if (S.match(/^[\w-]+/)) {
                        E(R);
                        return "atom"
                    } else {
                        if (S.peek() === "#") {
                            E(R);
                            return "atom"
                        }
                    }
                }
                if (Q === "#") {
                    S.next();
                    if (S.match(/^[\w-]+/)) {
                        E(R);
                        return "atom"
                    }
                    if (S.peek() === "#") {
                        E(R);
                        return "atom"
                    }
                }
                if (Q === "$") {
                    S.next();
                    S.eatWhile(/[\w-]/);
                    return "variable-2"
                }
                if (S.match(/^-?[0-9\.]+/)) {
                    return "number"
                }
                if (S.match(/^(px|em|in)\b/)) {
                    return "unit"
                }
                if (S.match(B)) {
                    return "keyword"
                }
                if (S.match(/^url/) && S.peek() === "(") {
                    R.tokenizer = M;
                    return "atom"
                }
                if (Q === "=") {
                    if (S.match(/^=[\w-]+/)) {
                        E(R);
                        return "meta"
                    }
                }
                if (Q === "+") {
                    if (S.match(/^\+[\w-]+/)) {
                        return "variable-3"
                    }
                }
                if (Q === "@") {
                    if (S.match(/@extend/)) {
                        if (!S.match(/\s*[\w]/)) {
                            J(R)
                        }
                    }
                }
                if (S.match(/^@(else if|if|media|else|for|each|while|mixin|function)/)) {
                    E(R);
                    return "meta"
                }
                if (Q === "@") {
                    S.next();
                    S.eatWhile(/[\w-]/);
                    return "meta"
                }
                if (S.eatWhile(/[\w-]/)) {
                    if (S.match(/ *: *[\w-\+\$#!\("']/, false)) {
                        return "propery"
                    } else {
                        if (S.match(/ *:/, false)) {
                            E(R);
                            R.cursorHalf = 1;
                            return "atom"
                        } else {
                            if (S.match(/ *,/, false)) {
                                return "atom"
                            } else {
                                E(R);
                                return "atom"
                            }
                        }
                    }
                }
                if (Q === ":") {
                    if (S.match(O)) {
                        return "keyword"
                    }
                    S.next();
                    R.cursorHalf = 1;
                    return "operator"
                }
            } else {
                if (Q === "#") {
                    S.next();
                    if (S.match(/[0-9a-fA-F]{6}|[0-9a-fA-F]{3}/)) {
                        if (!S.peek()) {
                            R.cursorHalf = 0
                        }
                        return "number"
                    }
                }
                if (S.match(/^-?[0-9\.]+/)) {
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "number"
                }
                if (S.match(/^(px|em|in)\b/)) {
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "unit"
                }
                if (S.match(B)) {
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "keyword"
                }
                if (S.match(/^url/) && S.peek() === "(") {
                    R.tokenizer = M;
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "atom"
                }
                if (Q === "$") {
                    S.next();
                    S.eatWhile(/[\w-]/);
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "variable-3"
                }
                if (Q === "!") {
                    S.next();
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return S.match(/^[\w]+/) ? "keyword" : "operator"
                }
                if (S.match(N)) {
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "operator"
                }
                if (S.eatWhile(/[\w-]/)) {
                    if (!S.peek()) {
                        R.cursorHalf = 0
                    }
                    return "attribute"
                }
                if (!S.peek()) {
                    R.cursorHalf = 0;
                    return null
                }
            }
            if (S.match(N)) {
                return "operator"
            }
            S.next();
            return null
        }
        function C(X, R) {
            if (X.sol()) {
                R.indentCount = 0
            }
            var S = R.tokenizer(X, R);
            var W = X.current();
            if (W === "@return" || W === "}") {
                J(R)
            }
            if (S !== null) {
                var T = X.pos - W.length;
                var V = T + (F.indentUnit * R.indentCount);
                var Q = [];
                for (var U = 0; U < R.scopes.length; U++) {
                    var Y = R.scopes[U];
                    if (Y.offset <= V) {
                        Q.push(Y)
                    }
                }
                R.scopes = Q
            }
            return S
        }
        return {
            startState: function() {
                return {
                    tokenizer: G,
                    scopes: [{
                        offset: 0,
                        type: "sass"
                    }],
                    indentCount: 0,
                    cursorHalf: 0,
                    definedVars: [],
                    definedMixins: []
                }
            },
            token: function(S, R) {
                var Q = C(S, R);
                R.lastToken = {
                    style: Q,
                    content: S.current()
                };
                return Q
            },
            indent: function(Q) {
                return Q.scopes[0].offset
            }
        }
    });
    A.defineMIME("text/x-sass", "sass")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:shell', location = '/static/bower/CodeMirror/mode/shell/shell.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("shell", function() {
        var E = {};
        function G(K, H) {
            var J = H.split(" ");
            for (var I = 0; I < J.length; I++) {
                E[J[I]] = K
            }
        }
        G("atom", "true false");
        G("keyword", "if then do else elif while until for in esac fi fin fil done exit set unset export function");
        G("builtin", "ab awk bash beep cat cc cd chown chmod chroot clear cp curl cut diff echo find gawk gcc get git grep kill killall ln ls make mkdir openssl mv nc node npm ping ps restart rm rmdir sed service sh shopt shred source sort sleep ssh start stop su sudo tee telnet top touch vi vim wall wc wget who write yes zsh");
        function F(L, J) {
            if (L.eatSpace()) {
                return null
            }
            var I = L.sol();
            var H = L.next();
            if (H === "\\") {
                L.next();
                return null
            }
            if (H === "'" || H === '"' || H === "`") {
                J.tokens.unshift(C(H));
                return D(L, J)
            }
            if (H === "#") {
                if (I && L.eat("!")) {
                    L.skipToEnd();
                    return "meta"
                }
                L.skipToEnd();
                return "comment"
            }
            if (H === "$") {
                J.tokens.unshift(B);
                return D(L, J)
            }
            if (H === "+" || H === "=") {
                return "operator"
            }
            if (H === "-") {
                L.eat("-");
                L.eatWhile(/\w/);
                return "attribute"
            }
            if (/\d/.test(H)) {
                L.eatWhile(/\d/);
                if (L.eol() || !/\w/.test(L.peek())) {
                    return "number"
                }
            }
            L.eatWhile(/[\w-]/);
            var K = L.current();
            if (L.peek() === "=" && /\w+/.test(K)) {
                return "def"
            }
            return E.hasOwnProperty(K) ? E[K] : null
        }
        function C(H) {
            return function(M, K) {
                var J, I = false, L = false;
                while ((J = M.next()) != null) {
                    if (J === H && !L) {
                        I = true;
                        break
                    }
                    if (J === "$" && !L && H !== "'") {
                        L = true;
                        M.backUp(1);
                        K.tokens.unshift(B);
                        break
                    }
                    L = !L && J === "\\"
                }
                if (I || !L) {
                    K.tokens.shift()
                }
                return ( H === "`" || H === ")" ? "quote" : "string")
            }
        }
        var B = function(K, I) {
            if (I.tokens.length > 1) {
                K.eat("$")
            }
            var H = K.next()
              , J = /\w/;
            if (H === "{") {
                J = /[^}]/
            }
            if (H === "(") {
                I.tokens[0] = C(")");
                return D(K, I)
            }
            if (!/\d/.test(H)) {
                K.eatWhile(J);
                K.eat("}")
            }
            I.tokens.shift();
            return "def"
        };
        function D(I, H) {
            return (H.tokens[0] || F)(I, H)
        }
        return {
            startState: function() {
                return {
                    tokens: []
                }
            },
            token: function(I, H) {
                return D(I, H)
            },
            lineComment: "#",
            fold: "brace"
        }
    });
    A.defineMIME("text/x-sh", "shell")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:sql', location = '/static/bower/CodeMirror/mode/sql/sql.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("sql", function(C, F) {
        var D = F.client || {}
          , I = F.atoms || {
            "false": true,
            "true": true,
            "null": true
        }
          , M = F.builtin || {}
          , G = F.keywords || {}
          , H = F.operatorChars || /^[*+\-%<>!=&|~^]/
          , N = F.support || {}
          , P = F.hooks || {}
          , B = F.dateSQL || {
            date: true,
            time: true,
            timestamp: true
        };
        function E(U, S) {
            var R = U.next();
            if (P[R]) {
                var Q = P[R](U, S);
                if (Q !== false) {
                    return Q
                }
            }
            if (N.hexNumber == true && ((R == "0" && U.match(/^[xX][0-9a-fA-F]+/)) || (R == "x" || R == "X") && U.match(/^'[0-9a-fA-F]+'/))) {
                return "number"
            } else {
                if (N.binaryNumber == true && (((R == "b" || R == "B") && U.match(/^'[01]+'/)) || (R == "0" && U.match(/^b[01]+/)))) {
                    return "number"
                } else {
                    if (R.charCodeAt(0) > 47 && R.charCodeAt(0) < 58) {
                        U.match(/^[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/);
                        N.decimallessFloat == true && U.eat(".");
                        return "number"
                    } else {
                        if (R == "?" && (U.eatSpace() || U.eol() || U.eat(";"))) {
                            return "variable-3"
                        } else {
                            if (R == "'" || (R == '"' && N.doubleQuote)) {
                                S.tokenize = O(R);
                                return S.tokenize(U, S)
                            } else {
                                if ((((N.nCharCast == true && (R == "n" || R == "N")) || (N.charsetCast == true && R == "_" && U.match(/[a-z][a-z0-9]*/i))) && (U.peek() == "'" || U.peek() == '"')) ) {
                                    return "keyword"
                                } else {
                                    if (/^[\(\),\;\[\]]/.test(R)) {
                                        return null
                                    } else {
                                        if (N.commentSlashSlash && R == "/" && U.eat("/")) {
                                            U.skipToEnd();
                                            return "comment"
                                        } else {
                                            if ((N.commentHash && R == "#") || (R == "-" && U.eat("-") && (!N.commentSpaceRequired || U.eat(" ")))) {
                                                U.skipToEnd();
                                                return "comment"
                                            } else {
                                                if (R == "/" && U.eat("*")) {
                                                    S.tokenize = K;
                                                    return S.tokenize(U, S)
                                                } else {
                                                    if (R == ".") {
                                                        if (N.zerolessFloat == true && U.match(/^(?:\d+(?:e[+-]?\d+)?)/i)) {
                                                            return "number"
                                                        }
                                                        if (N.ODBCdotTable == true && U.match(/^[a-zA-Z_]+/)) {
                                                            return "variable-2"
                                                        }
                                                    } else {
                                                        if (H.test(R)) {
                                                            U.eatWhile(H);
                                                            return null
                                                        } else {
                                                            if (R == "{" && (U.match(/^( )*(d|D|t|T|ts|TS)( )*'[^']*'( )*}/) || U.match(/^( )*(d|D|t|T|ts|TS)( )*"[^"]*"( )*}/))) {
                                                                return "number"
                                                            } else {
                                                                U.eatWhile(/^[_\w\d]/);
                                                                var T = U.current().toLowerCase();
                                                                if (B.hasOwnProperty(T) && (U.match(/^( )+'[^']*'/) || U.match(/^( )+"[^"]*"/))) {
                                                                    return "number"
                                                                }
                                                                if (I.hasOwnProperty(T)) {
                                                                    return "atom"
                                                                }
                                                                if (M.hasOwnProperty(T)) {
                                                                    return "builtin"
                                                                }
                                                                if (G.hasOwnProperty(T)) {
                                                                    return "keyword"
                                                                }
                                                                if (D.hasOwnProperty(T)) {
                                                                    return "string-2"
                                                                }
                                                                return null
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        function O(Q) {
            return function(U, S) {
                var T = false, R;
                while ((R = U.next()) != null) {
                    if (R == Q && !T) {
                        S.tokenize = E;
                        break
                    }
                    T = !T && R == "\\"
                }
                return "string"
            }
        }
        function K(R, Q) {
            while (true) {
                if (R.skipTo("*")) {
                    R.next();
                    if (R.eat("/")) {
                        Q.tokenize = E;
                        break
                    }
                } else {
                    R.skipToEnd();
                    break
                }
            }
            return "comment"
        }
        function J(S, R, Q) {
            R.context = {
                prev: R.context,
                indent: S.indentation(),
                col: S.column(),
                type: Q
            }
        }
        function L(Q) {
            Q.indent = Q.context.indent;
            Q.context = Q.context.prev
        }
        return {
            startState: function() {
                return {
                    tokenize: E,
                    context: null
                }
            },
            token: function(T, S) {
                if (T.sol()) {
                    if (S.context && S.context.align == null) {
                        S.context.align = false
                    }
                }
                if (T.eatSpace()) {
                    return null
                }
                var R = S.tokenize(T, S);
                if (R == "comment") {
                    return R
                }
                if (S.context && S.context.align == null) {
                    S.context.align = true
                }
                var Q = T.current();
                if (Q == "(") {
                    J(T, S, ")")
                } else {
                    if (Q == "[") {
                        J(T, S, "]")
                    } else {
                        if (S.context && S.context.type == Q) {
                            L(S)
                        }
                    }
                }
                return R
            },
            indent: function(T, R) {
                var Q = T.context;
                if (!Q) {
                    return 0
                }
                var S = R.charAt(0) == Q.type;
                if (Q.align) {
                    return Q.col + (S ? 0 : 1)
                } else {
                    return Q.indent + (S ? 0 : C.indentUnit)
                }
            },
            blockCommentStart: "/*",
            blockCommentEnd: "*/",
            lineComment: N.commentSlashSlash ? "//" : N.commentHash ? "#" : null
        }
    });
    (function() {
        function C(H) {
            var G;
            while ((G = H.next()) != null) {
                if (G == "`" && !H.eat("`")) {
                    return "variable-2"
                }
            }
            H.backUp(H.current().length - 1);
            return H.eatWhile(/\w/) ? "variable-2" : null
        }
        function B(G) {
            if (G.eat("@")) {
                G.match(/^session\./);
                G.match(/^local\./);
                G.match(/^global\./)
            }
            if (G.eat("'")) {
                G.match(/^.*'/);
                return "variable-2"
            } else {
                if (G.eat('"')) {
                    G.match(/^.*"/);
                    return "variable-2"
                } else {
                    if (G.eat("`")) {
                        G.match(/^.*`/);
                        return "variable-2"
                    } else {
                        if (G.match(/^[0-9a-zA-Z$\.\_]+/)) {
                            return "variable-2"
                        }
                    }
                }
            }
            return null
        }
        function D(G) {
            if (G.eat("N")) {
                return "atom"
            }
            return G.match(/^[a-zA-Z.#!?]/) ? "variable-2" : null
        }
        var E = "alter and as asc between by count create delete desc distinct drop from having in insert into is join like not on or order select set table union update values where ";
        function F(J) {
            var H = {}
              , I = J.split(" ");
            for (var G = 0; G < I.length; ++G) {
                H[I[G]] = true
            }
            return H
        }
        A.defineMIME("text/x-sql", {
            name: "sql",
            keywords: F(E + "begin"),
            builtin: F("bool boolean bit blob enum long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision real date datetime year unsigned signed decimal numeric"),
            atoms: F("false true null unknown"),
            operatorChars: /^[*+\-%<>!=]/,
            dateSQL: F("date time timestamp"),
            support: F("ODBCdotTable doubleQuote binaryNumber hexNumber")
        });
        A.defineMIME("text/x-mssql", {
            name: "sql",
            client: F("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),
            keywords: F(E + "begin trigger proc view index for add constraint key primary foreign collate clustered nonclustered"),
            builtin: F("bigint numeric bit smallint decimal smallmoney int tinyint money float real char varchar text nchar nvarchar ntext binary varbinary image cursor timestamp hierarchyid uniqueidentifier sql_variant xml table "),
            atoms: F("false true null unknown"),
            operatorChars: /^[*+\-%<>!=]/,
            dateSQL: F("date datetimeoffset datetime2 smalldatetime datetime time"),
            hooks: {
                "@": B
            }
        });
        A.defineMIME("text/x-mysql", {
            name: "sql",
            client: F("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),
            keywords: F(E + "accessible action add after algorithm all analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general get global grant grants group groupby_concat handler hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show signal slave slow smallint snapshot soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),
            builtin: F("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),
            atoms: F("false true null unknown"),
            operatorChars: /^[*+\-%<>!=&|^]/,
            dateSQL: F("date time timestamp"),
            support: F("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),
            hooks: {
                "@": B,
                "`": C,
                "\\": D
            }
        });
        A.defineMIME("text/x-mariadb", {
            name: "sql",
            client: F("charset clear connect edit ego exit go help nopager notee nowarning pager print prompt quit rehash source status system tee"),
            keywords: F(E + "accessible action add after algorithm all always analyze asensitive at authors auto_increment autocommit avg avg_row_length before binary binlog both btree cache call cascade cascaded case catalog_name chain change changed character check checkpoint checksum class_origin client_statistics close coalesce code collate collation collations column columns comment commit committed completion concurrent condition connection consistent constraint contains continue contributors convert cross current current_date current_time current_timestamp current_user cursor data database databases day_hour day_microsecond day_minute day_second deallocate dec declare default delay_key_write delayed delimiter des_key_file describe deterministic dev_pop dev_samp deviance diagnostics directory disable discard distinctrow div dual dumpfile each elseif enable enclosed end ends engine engines enum errors escape escaped even event events every execute exists exit explain extended fast fetch field fields first flush for force foreign found_rows full fulltext function general generated get global grant grants group groupby_concat handler hard hash help high_priority hosts hour_microsecond hour_minute hour_second if ignore ignore_server_ids import index index_statistics infile inner innodb inout insensitive insert_method install interval invoker isolation iterate key keys kill language last leading leave left level limit linear lines list load local localtime localtimestamp lock logs low_priority master master_heartbeat_period master_ssl_verify_server_cert masters match max max_rows maxvalue message_text middleint migrate min min_rows minute_microsecond minute_second mod mode modifies modify mutex mysql_errno natural next no no_write_to_binlog offline offset one online open optimize option optionally out outer outfile pack_keys parser partition partitions password persistent phase plugin plugins prepare preserve prev primary privileges procedure processlist profile profiles purge query quick range read read_write reads real rebuild recover references regexp relaylog release remove rename reorganize repair repeatable replace require resignal restrict resume return returns revoke right rlike rollback rollup row row_format rtree savepoint schedule schema schema_name schemas second_microsecond security sensitive separator serializable server session share show shutdown signal slave slow smallint snapshot soft soname spatial specific sql sql_big_result sql_buffer_result sql_cache sql_calc_found_rows sql_no_cache sql_small_result sqlexception sqlstate sqlwarning ssl start starting starts status std stddev stddev_pop stddev_samp storage straight_join subclass_origin sum suspend table_name table_statistics tables tablespace temporary terminated to trailing transaction trigger triggers truncate uncommitted undo uninstall unique unlock upgrade usage use use_frm user user_resources user_statistics using utc_date utc_time utc_timestamp value variables varying view views virtual warnings when while with work write xa xor year_month zerofill begin do then else loop repeat"),
            builtin: F("bool boolean bit blob decimal double float long longblob longtext medium mediumblob mediumint mediumtext time timestamp tinyblob tinyint tinytext text bigint int int1 int2 int3 int4 int8 integer float float4 float8 double char varbinary varchar varcharacter precision date datetime year unsigned signed numeric"),
            atoms: F("false true null unknown"),
            operatorChars: /^[*+\-%<>!=&|^]/,
            dateSQL: F("date time timestamp"),
            support: F("ODBCdotTable decimallessFloat zerolessFloat binaryNumber hexNumber doubleQuote nCharCast charsetCast commentHash commentSpaceRequired"),
            hooks: {
                "@": B,
                "`": C,
                "\\": D
            }
        });
        A.defineMIME("text/x-cassandra", {
            name: "sql",
            client: {},
            keywords: F("use select from using consistency where limit first reversed first and in insert into values using consistency ttl update set delete truncate begin batch apply create keyspace with columnfamily primary key index on drop alter type add any one quorum all local_quorum each_quorum"),
            builtin: F("ascii bigint blob boolean counter decimal double float int text timestamp uuid varchar varint"),
            atoms: F("false true"),
            operatorChars: /^[<>=]/,
            dateSQL: {},
            support: F("commentSlashSlash decimallessFloat"),
            hooks: {}
        });
        A.defineMIME("text/x-plsql", {
            name: "sql",
            client: F("appinfo arraysize autocommit autoprint autorecovery autotrace blockterminator break btitle cmdsep colsep compatibility compute concat copycommit copytypecheck define describe echo editfile embedded escape exec execute feedback flagger flush heading headsep instance linesize lno loboffset logsource long longchunksize markup native newpage numformat numwidth pagesize pause pno recsep recsepchar release repfooter repheader serveroutput shiftinout show showmode size spool sqlblanklines sqlcase sqlcode sqlcontinue sqlnumber sqlpluscompatibility sqlprefix sqlprompt sqlterminator suffix tab term termout time timing trimout trimspool ttitle underline verify version wrap"),
            keywords: F("abort accept access add all alter and any array arraylen as asc assert assign at attributes audit authorization avg base_table begin between binary_integer body boolean by case cast char char_base check close cluster clusters colauth column comment commit compress connect connected constant constraint crash create current currval cursor data_base database date dba deallocate debugoff debugon decimal declare default definition delay delete desc digits dispose distinct do drop else elseif elsif enable end entry escape exception exception_init exchange exclusive exists exit external fast fetch file for force form from function generic goto grant group having identified if immediate in increment index indexes indicator initial initrans insert interface intersect into is key level library like limited local lock log logging long loop master maxextents maxtrans member minextents minus mislabel mode modify multiset new next no noaudit nocompress nologging noparallel not nowait number_base object of off offline on online only open option or order out package parallel partition pctfree pctincrease pctused pls_integer positive positiven pragma primary prior private privileges procedure public raise range raw read rebuild record ref references refresh release rename replace resource restrict return returning returns reverse revoke rollback row rowid rowlabel rownum rows run savepoint schema segment select separate session set share snapshot some space split sql start statement storage subtype successful synonym tabauth table tables tablespace task terminate then to trigger truncate type union unique unlimited unrecoverable unusable update use using validate value values variable view views when whenever where while with work"),
            builtin: F("abs acos add_months ascii asin atan atan2 average bfile bfilename bigserial bit blob ceil character chartorowid chr clob concat convert cos cosh count dec decode deref dual dump dup_val_on_index empty error exp false float floor found glb greatest hextoraw initcap instr instrb int integer isopen last_day least lenght lenghtb ln lower lpad ltrim lub make_ref max min mlslabel mod months_between natural naturaln nchar nclob new_time next_day nextval nls_charset_decl_len nls_charset_id nls_charset_name nls_initcap nls_lower nls_sort nls_upper nlssort no_data_found notfound null number numeric nvarchar2 nvl others power rawtohex real reftohex round rowcount rowidtochar rowtype rpad rtrim serial sign signtype sin sinh smallint soundex sqlcode sqlerrm sqrt stddev string substr substrb sum sysdate tan tanh to_char text to_date to_label to_multi_byte to_number to_single_byte translate true trunc uid unlogged upper user userenv varchar varchar2 variance varying vsize xml"),
            operatorChars: /^[*+\-%<>!=~]/,
            dateSQL: F("date time timestamp"),
            support: F("doubleQuote nCharCast zerolessFloat binaryNumber hexNumber")
        });
        A.defineMIME("text/x-hive", {
            name: "sql",
            keywords: F("select alter $elem$ $key$ $value$ add after all analyze and archive as asc before between binary both bucket buckets by cascade case cast change cluster clustered clusterstatus collection column columns comment compute concatenate continue create cross cursor data database databases dbproperties deferred delete delimited desc describe directory disable distinct distribute drop else enable end escaped exclusive exists explain export extended external false fetch fields fileformat first format formatted from full function functions grant group having hold_ddltime idxproperties if import in index indexes inpath inputdriver inputformat insert intersect into is items join keys lateral left like limit lines load local location lock locks mapjoin materialized minus msck no_drop nocompress not of offline on option or order out outer outputdriver outputformat overwrite partition partitioned partitions percent plus preserve procedure purge range rcfile read readonly reads rebuild recordreader recordwriter recover reduce regexp rename repair replace restrict revoke right rlike row schema schemas semi sequencefile serde serdeproperties set shared show show_database sort sorted ssl statistics stored streamtable table tables tablesample tblproperties temporary terminated textfile then tmp to touch transform trigger true unarchive undo union uniquejoin unlock update use using utc utc_tmestamp view when where while with"),
            builtin: F("bool boolean long timestamp tinyint smallint bigint int float double date datetime unsigned string array struct map uniontype"),
            atoms: F("false true null unknown"),
            operatorChars: /^[*+\-%<>!=]/,
            dateSQL: F("date timestamp"),
            support: F("ODBCdotTable doubleQuote binaryNumber hexNumber")
        })
    }())
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:vbscript', location = '/static/bower/CodeMirror/mode/vbscript/vbscript.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("vbscript", function(h, N) {
        var T = "error";
        function F(s) {
            return new RegExp("^((" + s.join(")|(") + "))\\b","i")
        }
        var p = new RegExp("^[\\+\\-\\*/&\\\\\\^<>=]");
        var O = new RegExp("^((<>)|(<=)|(>=))");
        var L = new RegExp("^[\\.,]");
        var d = new RegExp("^[\\(\\)]");
        var i = new RegExp("^[A-Za-z][_A-Za-z0-9]*");
        var g = ["class", "sub", "select", "while", "if", "function", "property", "with", "for"];
        var V = ["else", "elseif", "case"];
        var D = ["next", "loop", "wend"];
        var E = F(["and", "or", "not", "xor", "is", "mod", "eqv", "imp"]);
        var J = ["dim", "redim", "then", "until", "randomize", "byval", "byref", "new", "property", "exit", "in", "const", "private", "public", "get", "set", "let", "stop", "on error resume next", "on error goto 0", "option explicit", "call", "me"];
        var X = ["true", "false", "nothing", "empty", "null"];
        var m = ["abs", "array", "asc", "atn", "cbool", "cbyte", "ccur", "cdate", "cdbl", "chr", "cint", "clng", "cos", "csng", "cstr", "date", "dateadd", "datediff", "datepart", "dateserial", "datevalue", "day", "escape", "eval", "execute", "exp", "filter", "formatcurrency", "formatdatetime", "formatnumber", "formatpercent", "getlocale", "getobject", "getref", "hex", "hour", "inputbox", "instr", "instrrev", "int", "fix", "isarray", "isdate", "isempty", "isnull", "isnumeric", "isobject", "join", "lbound", "lcase", "left", "len", "loadpicture", "log", "ltrim", "rtrim", "trim", "maths", "mid", "minute", "month", "monthname", "msgbox", "now", "oct", "replace", "rgb", "right", "rnd", "round", "scriptengine", "scriptenginebuildversion", "scriptenginemajorversion", "scriptengineminorversion", "second", "setlocale", "sgn", "sin", "space", "split", "sqr", "strcomp", "string", "strreverse", "tan", "time", "timer", "timeserial", "timevalue", "typename", "ubound", "ucase", "unescape", "vartype", "weekday", "weekdayname", "year"];
        var l = ["vbBlack", "vbRed", "vbGreen", "vbYellow", "vbBlue", "vbMagenta", "vbCyan", "vbWhite", "vbBinaryCompare", "vbTextCompare", "vbSunday", "vbMonday", "vbTuesday", "vbWednesday", "vbThursday", "vbFriday", "vbSaturday", "vbUseSystemDayOfWeek", "vbFirstJan1", "vbFirstFourDays", "vbFirstFullWeek", "vbGeneralDate", "vbLongDate", "vbShortDate", "vbLongTime", "vbShortTime", "vbObjectError", "vbOKOnly", "vbOKCancel", "vbAbortRetryIgnore", "vbYesNoCancel", "vbYesNo", "vbRetryCancel", "vbCritical", "vbQuestion", "vbExclamation", "vbInformation", "vbDefaultButton1", "vbDefaultButton2", "vbDefaultButton3", "vbDefaultButton4", "vbApplicationModal", "vbSystemModal", "vbOK", "vbCancel", "vbAbort", "vbRetry", "vbIgnore", "vbYes", "vbNo", "vbCr", "VbCrLf", "vbFormFeed", "vbLf", "vbNewLine", "vbNullChar", "vbNullString", "vbTab", "vbVerticalTab", "vbUseDefault", "vbTrue", "vbFalse", "vbEmpty", "vbNull", "vbInteger", "vbLong", "vbSingle", "vbDouble", "vbCurrency", "vbDate", "vbString", "vbObject", "vbError", "vbBoolean", "vbVariant", "vbDataObject", "vbDecimal", "vbByte", "vbArray"];
        var j = ["WScript", "err", "debug", "RegExp"];
        var r = ["description", "firstindex", "global", "helpcontext", "helpfile", "ignorecase", "length", "number", "pattern", "source", "value", "count"];
        var U = ["clear", "execute", "raise", "replace", "test", "write", "writeline", "close", "open", "state", "eof", "update", "addnew", "end", "createobject", "quit"];
        var f = ["server", "response", "request", "session", "application"];
        var I = ["buffer", "cachecontrol", "charset", "contenttype", "expires", "expiresabsolute", "isclientconnected", "pics", "status", "clientcertificate", "cookies", "form", "querystring", "servervariables", "totalbytes", "contents", "staticobjects", "codepage", "lcid", "sessionid", "timeout", "scripttimeout"];
        var G = ["addheader", "appendtolog", "binarywrite", "end", "flush", "redirect", "binaryread", "remove", "removeall", "lock", "unlock", "abandon", "getlasterror", "htmlencode", "mappath", "transfer", "urlencode"];
        var S = U.concat(r);
        j = j.concat(l);
        if (h.isASP) {
            j = j.concat(f);
            S = S.concat(G, I)
        }
        var C = F(J);
        var P = F(X);
        var Q = F(m);
        var n = F(j);
        var B = F(S);
        var o = '"';
        var R = F(g);
        var Z = F(V);
        var a = F(D);
        var k = F(["end"]);
        var b = F(["do"]);
        var q = F(["on error resume next", "exit"]);
        var W = F(["rem"]);
        function K(s, t) {
            t.currentIndent++
        }
        function H(s, t) {
            t.currentIndent--
        }
        function Y(w, v) {
            if (w.eatSpace()) {
                return "space"
            }
            var u = w.peek();
            if (u === "'") {
                w.skipToEnd();
                return "comment"
            }
            if (w.match(W)) {
                w.skipToEnd();
                return "comment"
            }
            if (w.match(/^((&H)|(&O))?[0-9\.]/i, false) && !w.match(/^((&H)|(&O))?[0-9\.]+[a-z_]/i, false)) {
                var t = false;
                if (w.match(/^\d*\.\d+/i)) {
                    t = true
                } else {
                    if (w.match(/^\d+\.\d*/)) {
                        t = true
                    } else {
                        if (w.match(/^\.\d+/)) {
                            t = true
                        }
                    }
                }
                if (t) {
                    w.eat(/J/i);
                    return "number"
                }
                var s = false;
                if (w.match(/^&H[0-9a-f]+/i)) {
                    s = true
                } else {
                    if (w.match(/^&O[0-7]+/i)) {
                        s = true
                    } else {
                        if (w.match(/^[1-9]\d*F?/)) {
                            w.eat(/J/i);
                            s = true
                        } else {
                            if (w.match(/^0(?![\dx])/i)) {
                                s = true
                            }
                        }
                    }
                }
                if (s) {
                    w.eat(/L/i);
                    return "number"
                }
            }
            if (w.match(o)) {
                v.tokenize = e(w.current());
                return v.tokenize(w, v)
            }
            if (w.match(O) || w.match(p) || w.match(E)) {
                return "operator"
            }
            if (w.match(L)) {
                return null
            }
            if (w.match(d)) {
                return "bracket"
            }
            if (w.match(q)) {
                v.doInCurrentLine = true;
                return "keyword"
            }
            if (w.match(b)) {
                K(w, v);
                v.doInCurrentLine = true;
                return "keyword"
            }
            if (w.match(R)) {
                if (!v.doInCurrentLine) {
                    K(w, v)
                } else {
                    v.doInCurrentLine = false
                }
                return "keyword"
            }
            if (w.match(Z)) {
                return "keyword"
            }
            if (w.match(k)) {
                H(w, v);
                H(w, v);
                return "keyword"
            }
            if (w.match(a)) {
                if (!v.doInCurrentLine) {
                    H(w, v)
                } else {
                    v.doInCurrentLine = false
                }
                return "keyword"
            }
            if (w.match(C)) {
                return "keyword"
            }
            if (w.match(P)) {
                return "atom"
            }
            if (w.match(B)) {
                return "variable-2"
            }
            if (w.match(Q)) {
                return "builtin"
            }
            if (w.match(n)) {
                return "variable-2"
            }
            if (w.match(i)) {
                return "variable"
            }
            w.next();
            return T
        }
        function e(s) {
            var u = s.length == 1;
            var t = "string";
            return function(w, v) {
                while (!w.eol()) {
                    w.eatWhile(/[^'"]/);
                    if (w.match(s)) {
                        v.tokenize = Y;
                        return t
                    } else {
                        w.eat(/['"]/)
                    }
                }
                if (u) {
                    if (N.singleLineStringErrors) {
                        return T
                    } else {
                        v.tokenize = Y
                    }
                }
                return t
            }
        }
        function M(v, t) {
            var s = t.tokenize(v, t);
            var u = v.current();
            if (u === ".") {
                s = t.tokenize(v, t);
                u = v.current();
                if (s && (s.substr(0, 8) === "variable" || s === "builtin" || s === "keyword")) {
                    if (s === "builtin" || s === "keyword") {
                        s = "variable"
                    }
                    if (S.indexOf(u.substr(1)) > -1) {
                        s = "variable-2"
                    }
                    return s
                } else {
                    return T
                }
            }
            return s
        }
        var c = {
            electricChars: "dDpPtTfFeE ",
            startState: function() {
                return {
                    tokenize: Y,
                    lastToken: null,
                    currentIndent: 0,
                    nextLineIndent: 0,
                    doInCurrentLine: false,
                    ignoreKeyword: false
                }
            },
            token: function(u, t) {
                if (u.sol()) {
                    t.currentIndent += t.nextLineIndent;
                    t.nextLineIndent = 0;
                    t.doInCurrentLine = 0
                }
                var s = M(u, t);
                t.lastToken = {
                    style: s,
                    content: u.current()
                };
                if (s === "space") {
                    s = null
                }
                return s
            },
            indent: function(u, s) {
                var t = s.replace(/^\s+|\s+$/g, "");
                if (t.match(a) || t.match(k) || t.match(Z)) {
                    return h.indentUnit * (u.currentIndent - 1)
                }
                if (u.currentIndent < 0) {
                    return 0
                }
                return u.currentIndent * h.indentUnit
            }
        };
        return c
    });
    A.defineMIME("text/vbscript", "vbscript")
});
;;/* module-key = 'com.atlassian.stash.stash-highlight-plugin:yaml', location = '/static/bower/CodeMirror/mode/yaml/yaml.js' */
(function(A) {
    if (typeof exports == "object" && typeof module == "object") {
        A(require("../../lib/codemirror"))
    } else {
        if (typeof define == "function" && define.amd) {
            define(["../../lib/codemirror"], A)
        } else {
            A(CodeMirror)
        }
    }
})(function(A) {
    A.defineMode("yaml", function() {
        var B = ["true", "false", "on", "off", "yes", "no"];
        var C = new RegExp("\\b((" + B.join(")|(") + "))$","i");
        return {
            token: function(G, F) {
                var E = G.peek();
                var D = F.escaped;
                F.escaped = false;
                if (E == "#" && (G.pos == 0 || /\s/.test(G.string.charAt(G.pos - 1)))) {
                    G.skipToEnd();
                    return "comment"
                }
                if (G.match(/^('([^']|\\.)*'?|"([^"]|\\.)*"?)/)) {
                    return "string"
                }
                if (F.literal && G.indentation() > F.keyCol) {
                    G.skipToEnd();
                    return "string"
                } else {
                    if (F.literal) {
                        F.literal = false
                    }
                }
                if (G.sol()) {
                    F.keyCol = 0;
                    F.pair = false;
                    F.pairStart = false;
                    if (G.match(/---/)) {
                        return "def"
                    }
                    if (G.match(/\.\.\./)) {
                        return "def"
                    }
                    if (G.match(/\s*-\s+/)) {
                        return "meta"
                    }
                }
                if (G.match(/^(\{|\}|\[|\])/)) {
                    if (E == "{") {
                        F.inlinePairs++
                    } else {
                        if (E == "}") {
                            F.inlinePairs--
                        } else {
                            if (E == "[") {
                                F.inlineList++
                            } else {
                                F.inlineList--
                            }
                        }
                    }
                    return "meta"
                }
                if (F.inlineList > 0 && !D && E == ",") {
                    G.next();
                    return "meta"
                }
                if (F.inlinePairs > 0 && !D && E == ",") {
                    F.keyCol = 0;
                    F.pair = false;
                    F.pairStart = false;
                    G.next();
                    return "meta"
                }
                if (F.pairStart) {
                    if (G.match(/^\s*(\||\>)\s*/)) {
                        F.literal = true;
                        return "meta"
                    }
                    if (G.match(/^\s*(\&|\*)[a-z0-9\._-]+\b/i)) {
                        return "variable-2"
                    }
                    if (F.inlinePairs == 0 && G.match(/^\s*-?[0-9\.\,]+\s?$/)) {
                        return "number"
                    }
                    if (F.inlinePairs > 0 && G.match(/^\s*-?[0-9\.\,]+\s?(?=(,|}))/)) {
                        return "number"
                    }
                    if (G.match(C)) {
                        return "keyword"
                    }
                }
                if (!F.pair && G.match(/^\s*(?:[,\[\]{}&*!|>'"%@`][^\s'":]|[^,\[\]{}#&*!|>'"%@`])[^#]*?(?=\s*:($|\s))/)) {
                    F.pair = true;
                    F.keyCol = G.indentation();
                    return "atom"
                }
                if (F.pair && G.match(/^:\s*/)) {
                    F.pairStart = true;
                    return "meta"
                }
                F.pairStart = false;
                F.escaped = (E == "\\");
                G.next();
                return null
            },
            startState: function() {
                return {
                    pair: false,
                    pairStart: false,
                    keyCol: 0,
                    inlinePairs: 0,
                    inlineList: 0,
                    literal: false,
                    escaped: false
                }
            }
        }
    });
    A.defineMIME("text/x-yaml", "yaml")
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:syntax-highlight', location = '/static/util/syntax-highlight.js' */
define("util/syntax-highlight", ["codemirror", "jquery", "util/determine-language", "exports"], function(C, F, E, B) {
    function D(I) {
        var H = F(I);
        if (!H.length) {
            return
        }
        var K = H.attr("data-language");
        E.getCodeMirrorModeForName(K).then(G).fail(J);
        function G(L) {
            C.runMode(H.text(), L.mime || {
                name: K
            }, H[0])
        }
        function J(L) {
            console.warn(L || (K + " could not be loaded for syntax highlighting."))
        }
    }
    function A(G) {
        F(G).find("pre > code[data-language]").each(function() {
            D(this)
        })
    }
    B.codeblock = D;
    B.container = A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-preview', location = '/static/widget/markup-preview/markup-preview.js' */
define("widget/markup-preview", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "util/dom-event", "util/events", "util/navigator", "util/syntax-highlight"], function(I, E, J, B, H, F, K, G, A) {
    var D = "ctrl+shift+p";
    K.on("stash.keyboard.shortcuts.requestPreviewComment", function(M) {
        D = M;
        this.unbind()
    });
    function L(M) {
        this.init.apply(this, arguments)
    }
    K.addLocalEventMixin(L.prototype);
    L.prototype.init = function(N) {
        J.bindAll(this, "togglePreview", "updatePreview", "refreshPreview", "hidePreview", "cancelPreview");
        var P = G.isMac ? D.replace(/ctrl/i, "meta") : D;
        this.$editor = E(N);
        this.$textarea = this.$editor.find("textarea");
        this.$previewButton = this.$editor.find(".markup-preview-button");
        this.$previewPanel = this.$editor.find(".markup-preview");
        this._destroyables = [];
        var M = this.$textarea.add(this.$previewButton);
        M.on("keydown", [P], this.togglePreview);
        this._destroyables.push({
            destroy: function() {
                M.off("keydown", this.togglePreview)
            }
            .bind(this)
        });
        this._destroyables.push(K.chainWith(this.$previewButton).on("click", this.togglePreview));
        this._destroyables.push(K.chainWith(this.$previewPanel).on("click", F.filterByTarget(":not(a, a > img)", this.togglePreview)));
        this._destroyables.push(K.chainWith(this.$textarea).on("input", J.debounce(this.refreshPreview, 100)));
        this._destroyables.push({
            destroy: this.cancelPreview
        });
        var O = this;
        this.$previewButton.tooltip({
            gravity: function() {
                return E.fn.tipsy.autoNS.apply(this, arguments) + "e"
            },
            title: function() {
                return O.isPreviewing() ? "Continue editing" : O.$previewButton.attr("data-preview-tooltip")
            }
        })
    }
    ;
    L.prototype.isPreviewing = function() {
        return this.$editor.hasClass("previewing")
    }
    ;
    L.prototype.togglePreview = F.preventDefault(function() {
        if (this.isPreviewing()) {
            this.cancelPreview()
        } else {
            this.showPreview()
        }
    });
    L.prototype.showPreview = function() {
        this.$editor.addClass("previewing");
        this.$textarea.parent().spin("medium");
        this.$previewButton.text("Edit");
        this._request && this._request.abort();
        function N(P, O) {
            if (O !== "abort") {
                this.hidePreview()
            }
        }
        function M() {
            this.$textarea.parent().spinStop();
            this._request = null
        }
        this._request = H.rest({
            type: "POST",
            url: C(),
            data: this.$textarea.val(),
            dataType: "json"
        }).done(this.updatePreview).fail(N.bind(this)).always(M.bind(this))
    }
    ;
    L.prototype.refreshPreview = function() {
        this.isPreviewing() && this.showPreview()
    }
    ;
    L.prototype.updatePreview = function(M) {
        this.$previewPanel.html(M.html);
        this.$previewPanel.find("a").attr("target", "_blank");
        this.$editor.addClass("loaded");
        this.$previewButton.focus();
        A.container(this.$previewPanel);
        var N = this.trigger.bind(this, "resize");
        J.defer(N);
        this.$previewPanel.imagesLoaded(N)
    }
    ;
    L.prototype.cancelPreview = function() {
        this._request && this._request.abort();
        this.hidePreview()
    }
    ;
    L.prototype.hidePreview = function() {
        this.$editor.removeClass("previewing loaded");
        this.$previewButton.text("Preview");
        this.$textarea.focus();
        this.trigger("resize")
    }
    ;
    L.prototype.destroy = function() {
        J.invoke(this._destroyables, "destroy")
    }
    ;
    var C = J.once(function() {
        return B.rest().markup().preview().build()
    });
    return L
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-preview', location = '/static/widget/markup-preview/markup-preview.soy' */
// This file was automatically generated from markup-preview.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.markupPreview.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.markupPreview == 'undefined') {
    stash.widget.markupPreview = {};
}

stash.widget.markupPreview.preview = function(opt_data, opt_ignored) {
    return '<div class="markup-preview markup" title="' + soy.$$escapeHtml("Click to edit") + '"></div>';
}
;
if (goog.DEBUG) {
    stash.widget.markupPreview.preview.soyTemplateName = 'stash.widget.markupPreview.preview';
}

stash.widget.markupPreview.previewHelp = function(opt_data, opt_ignored) {
    return '' + stash.buttons.button({
        href: 'http:\/\/docs.atlassian.com\/stash\/docs-038\/Markdown+syntax+guide',
        extraClasses: 'aui-button-subtle aui-button-compact markup-preview-help',
        title: "Markup syntax guide",
        iconType: 'custom',
        iconClass: 'aui-icon aui-icon-small aui-iconfont-help',
        iconText: "Markup syntax guide",
        buttonText: '',
        extraAttributes: {
            target: '_blank'
        }
    });
}
;
if (goog.DEBUG) {
    stash.widget.markupPreview.previewHelp.soyTemplateName = 'stash.widget.markupPreview.previewHelp';
}

stash.widget.markupPreview.previewButton = function(opt_data, opt_ignored) {
    return '' + stash.buttons.button({
        extraClasses: 'aui-button-subtle aui-button-compact markup-preview-button',
        buttonText: "Preview",
        extraAttributes: {
            type: 'button',
            'data-preview-tooltip': opt_data.title
        }
    });
}
;
if (goog.DEBUG) {
    stash.widget.markupPreview.previewButton.soyTemplateName = 'stash.widget.markupPreview.previewButton';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:client-file-handlers', location = '/static/widget/client-file-handlers/client-file-handler.js' */
define("widget/client-file-handlers/client-file-handler", ["jquery", "lodash", "util/events"], function(D, B, C) {
    function A(E) {
        return this.init(E)
    }
    C.addLocalEventMixin(A.prototype);
    A.typeFilters = {
        all: /.*/,
        application: /^application\/.*/i,
        audio: /^audio\/.*/i,
        image: /^image\/.*/i,
        imageWeb: /^image\/(jpeg|png|gif)$/i,
        text: /^text\/.*/i,
        video: /^video\/.*/i
    };
    A.prototype.defaults = {
        fileTypeFilter: A.typeFilters.all,
        fileCountLimit: Infinity,
        fileSizeLimit: 10 * 1024 * 1024,
        onSuccess: D.noop,
        onError: D.noop
    };
    A.prototype.init = function(E) {
        this.options = D.extend({}, this.defaults, E);
        if (E && !E.fileSizeLimit) {
            this.options.fileSizeLimit = this.defaults.fileSizeLimit
        }
        if (E && !E.fileCountLimit) {
            this.options.fileCountLimit = this.defaults.fileCountLimit
        }
        B.bindAll(this, "handleFiles", "filterFiles");
        return this
    }
    ;
    A.prototype.handleFiles = function(G, F) {
        this.trigger("filesSelected", G);
        var E = this.filterFiles(G);
        if (E.valid.length > 0) {
            B.isFunction(this.options.onSuccess) && this.options.onSuccess(E.valid);
            this.trigger("validFiles", E.valid)
        } else {
            B.isFunction(this.options.onError) && this.options.onError(E.invalid)
        }
        if (B.keys(E.invalid).length) {
            this.trigger("invalidFiles", E.invalid)
        }
    }
    ;
    A.prototype.filterFiles = function(G) {
        var H = B.isRegExp(this.options.fileTypeFilter) ? this.options.fileTypeFilter : this.defaults.fileTypeFilter;
        var F = this.options.fileSizeLimit;
        var E = B.reduce(G, function(I, J) {
            if (!H.test(J.type)) {
                I.invalid.byType = I.invalid.byType ? I.invalid.byType.concat(J) : [J]
            } else {
                if (J.size > F) {
                    I.invalid.bySize = I.invalid.bySize ? I.invalid.bySize.concat(J) : [J]
                } else {
                    I.valid.push(J)
                }
            }
            return I
        }, {
            valid: [],
            invalid: {}
        });
        if (E.valid.length > this.options.fileCountLimit) {
            E.invalid.byCount = E.valid.slice(this.options.fileCountLimit);
            E.valid = E.valid.slice(0, this.options.fileCountLimit)
        }
        return E
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:client-file-handlers', location = '/static/widget/client-file-handlers/client-file-uploader.js' */
define("widget/client-file-handlers/client-file-uploader", ["jquery", "lodash", "util/ajax", "util/feature-detect", "widget/client-file-handlers/client-file-handler"], function(F, D, E, B, A) {
    function C(G) {
        if (!C.isSupported()) {
            throw new Error("ClientFileUploader requires FormData support")
        }
        this.init.apply(this, arguments)
    }
    C.isSupported = B.formData;
    C.typeFilters = A.typeFilters;
    F.extend(C.prototype, A.prototype);
    C.prototype.defaults = F.extend({}, A.prototype.defaults, {
        url: undefined,
        fieldName: "file",
        fileSizeLimit: undefined
    });
    C.prototype.init = function(G) {
        D.bindAll(this, "uploadFiles");
        A.prototype.init.call(this, G);
        this.uploads = [];
        this.on("validFiles", this.uploadFiles)
    }
    ;
    C.prototype.uploadFiles = function(H) {
        var G = this;
        D.forEach(H, function(J) {
            var K = new FormData();
            var I = F.Deferred();
            K.append(G.options.fieldName, J, J.name);
            var L = E.ajax({
                url: G.options.url,
                type: "POST",
                data: K,
                xhr: function() {
                    var N = F.ajaxSettings.xhr();
                    var M = N.upload ? N.upload : N;
                    M.addEventListener("progress", function(O) {
                        if (O.lengthComputable) {
                            I.notify(Math.max(0, Math.min(100, 100 * O.loaded / O.total)))
                        }
                    });
                    return N
                },
                statusCode: {
                    500: false
                },
                processData: false,
                contentType: false
            }).done(function() {
                I.notify(100);
                I.resolveWith(this, arguments)
            }).fail(function() {
                I.rejectWith(this, arguments)
            }).always(function() {
                G.uploads = D.without(G.uploads, L)
            });
            I.promise(L);
            G.uploads.push(L);
            G.trigger("uploadStarted", L, J)
        })
    }
    ;
    C.prototype.destroy = function() {
        D.invoke(this.uploads, "abort");
        this.uploads = []
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:client-file-handlers', location = '/static/widget/client-file-handlers/client-file-reader.js' */
define("widget/client-file-handlers/client-file-reader", ["jquery", "lodash", "util/feature-detect", "widget/client-file-handlers/client-file-handler"], function(F, E, C, B) {
    var D = {
        ArrayBuffer: "readAsArrayBuffer",
        BinaryString: "readAsBinaryString",
        DataURL: "readAsDataURL",
        Text: "readAsText"
    };
    function A(G) {
        if (!A.isSupported()) {
            throw new Error("ClientFileReader requires FileReaderAPI support")
        }
        return this.init(G)
    }
    A.isSupported = C.fileReader;
    F.extend(A.prototype, B.prototype);
    A.readMethods = {
        ArrayBuffer: "ArrayBuffer",
        BinaryString: "BinaryString",
        DataURL: "DataURL",
        Text: "Text"
    };
    A.typeFilters = B.typeFilters;
    A.prototype.defaults = F.extend({}, B.prototype.defaults, {
        readMethod: A.readMethods.DataURL,
        onRead: F.noop
    });
    A.prototype.init = function(G) {
        E.bindAll(this, "onSuccess", "readFile");
        B.prototype.init.call(this, G);
        this.options.onSuccess = this.onSuccess;
        return this
    }
    ;
    A.prototype.onSuccess = function(H) {
        var G = E.has(D, this.options.readMethod) ? D[this.options.readMethod] : undefined;
        if (G) {
            E.each(H, E.bind(function(J) {
                var I = new FileReader();
                I.onload = E.bind(this.readFile, this, J);
                I[G](J)
            }, this))
        }
    }
    ;
    A.prototype.readFile = function(G, H) {
        E.isFunction(this.options.onRead) && this.options.onRead(H.target.result, G)
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:client-file-handlers', location = '/static/widget/client-file-handlers/client-file-iframe-uploader.js' */
define("widget/client-file-handlers/client-file-iframe-uploader", ["jquery", "lodash", "util/deprecation", "widget/client-file-handlers/client-file-handler"], function(F, C, E, B) {
    var A = E.getMessageLogger("widget/client-file-handlers/client-file-iframe-uploader", null, "3.7", "4.0");
    function D(G) {
        A();
        return this.init(G)
    }
    F.extend(D.prototype, B.prototype);
    D.prototype.defaults = F.extend({}, B.prototype.defaults, {
        uploadURL: "",
        uploadFieldName: "file",
        onUpload: F.noop,
        responseHandler: function(H, I) {
            var G;
            try {
                G = JSON.parse(F(H).html())
            } catch (J) {
                I.reject()
            }
            if (G) {
                I.resolve(G)
            } else {
                I.reject()
            }
        }
    });
    D.prototype.states = {
        IN_PROGRESS: "IN_PROGRESS",
        IDLE: "IDLE"
    };
    D.prototype.init = function(G) {
        C.bindAll(this, "createHiddenIframe", "onIframeLoad", "handleFiles", "setStateInProgress", "setStateIdle", "cancelUpload");
        this.options = F.extend({}, this.defaults, G);
        this.$uploadIframe = this.createHiddenIframe();
        if (this.options.cancelTrigger) {
            this.$cancelTrigger = F(this.options.cancelTrigger);
            this.$cancelTrigger.click(C.bind(function() {
                this.cancelUpload()
            }, this))
        }
        this.state = this.states.IDLE;
        return this
    }
    ;
    D.prototype.createHiddenIframe = function() {
        return F("<iframe>").attr("name", "hidden-upload-iframe").hide().appendTo(document.body).on("load", this.onIframeLoad)
    }
    ;
    D.prototype.onIframeLoad = function(G) {
        if (this.state === this.states.IN_PROGRESS) {
            this.requestPromise.done(this.options.onUpload).fail(this.options.onError);
            this.options.responseHandler(G.target.contentDocument.body, this.requestPromise)
        }
    }
    ;
    D.prototype.handleFiles = function(I, G) {
        if (this.state === this.states.IN_PROGRESS) {
            this.cancelUpload()
        }
        if (!this.$fileSourceElem) {
            this.$fileSourceElem = F(G);
            this.$fileSourceElem.attr("name", this.options.uploadFieldName);
            if (!this.$fileSourceElem.prop("form")) {
                this.$fileSourceElem.wrap("<form>")
            }
            var J = F(this.$fileSourceElem.prop("form"));
            J.addClass("hidden-upload-form").attr("action", this.options.uploadURL).attr("method", "post").attr("enctype", "multipart/form-data").attr("encoding", "multipart/form-data").attr("target", this.$uploadIframe.attr("name"));
            this.$spinner = F('<div class="spinner"></div>').insertBefore(this.$fileSourceElem);
            if (F.isPlainObject(this.options.extraData)) {
                C.each(this.options.extraData, function(L, K) {
                    F('<input type="hidden">').attr("name", K).val(L).appendTo(J)
                })
            }
        }
        var H = F(this.$fileSourceElem.prop("form"));
        if (this.options.xsrfToken && this.options.xsrfToken.name && this.options.xsrfToken.value) {
            H.append("<input type='hidden' name='" + this.options.xsrfToken.name + "' value='" + this.options.xsrfToken.value + "'/>")
        }
        H.submit();
        this.requestPromise = F.Deferred();
        this.requestPromise.always(this.setStateIdle);
        this.setStateInProgress()
    }
    ;
    D.prototype.setStateInProgress = function() {
        this.state = this.states.IN_PROGRESS;
        if (this.$spinner) {
            this.$spinner.spin()
        }
        if (this.$fileSourceElem) {
            this.$fileSourceElem.attr("disabled", "disabled")
        }
    }
    ;
    D.prototype.setStateIdle = function() {
        this.state = this.states.IDLE;
        if (this.$spinner) {
            this.$spinner.spinStop()
        }
        if (this.$fileSourceElem) {
            this.$fileSourceElem.removeAttr("disabled")
        }
        this.requestPromise = null
    }
    ;
    D.prototype.cancelUpload = function() {
        this.$uploadIframe.remove();
        this.setStateIdle();
        this.$uploadIframe = this.createHiddenIframe()
    }
    ;
    return D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:drag-drop-file-target', location = '/static/widget/drag-drop-file-target/drag-drop-file-target.js' */
define("widget/drag-drop-file-target", ["jquery", "lodash", "util/events"], function(D, A, B) {
    function C(E, F) {
        return this.init.apply(this, arguments)
    }
    C.prototype.getDefaults = function() {
        return {
            activeDropTargetClass: "active-drop-target",
            uploadPrompt: "Drag a file here to upload",
            clientFileHandler: null
        }
    }
    ;
    C.prototype.init = function(E, F) {
        A.bindAll(this, "onDragOver", "onDragEnd", "onDrop");
        this.$target = D(E);
        this.options = D.extend({}, this.getDefaults(), F);
        this.$target.attr("data-upload-prompt", this.options.uploadPrompt);
        this._destroyables = [];
        this._destroyables.push(B.chainWith(this.$target).on("dragover", this.onDragOver).on("dragleave", this.onDragEnd).on("dragend", this.onDragEnd).on("drop", this.onDrop))
    }
    ;
    C.prototype.onDragOver = function(E) {
        E.preventDefault();
        this.$target.addClass(this.options.activeDropTargetClass)
    }
    ;
    C.prototype.onDragEnd = function(E) {
        E.preventDefault();
        this.$target.removeClass(this.options.activeDropTargetClass)
    }
    ;
    C.prototype.onDrop = function(E) {
        E.preventDefault();
        E.originalEvent.preventDefault();
        this.$target.removeClass(this.options.activeDropTargetClass);
        if (this.options.clientFileHandler) {
            this.options.clientFileHandler.handleFiles(E.originalEvent.dataTransfer.files, E.originalEvent.target)
        }
    }
    ;
    C.prototype.destroy = function() {
        this.$target.removeAttr("data-upload-prompt");
        this.$target.removeClass(this.options.activeDropTargetClass);
        A.invoke(this._destroyables, "destroy")
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:paste-image-target', location = '/static/widget/paste-image-target/paste-image-target.js' */
define("widget/paste-image-target", ["jquery", "lodash", "util/events", "util/function", "widget/client-file-handlers/client-file-handler"], function(F, B, C, D, A) {
    function E(G, H) {
        this.init.apply(this, arguments)
    }
    E.prototype.init = function(G, H) {
        B.bindAll(this, "handlePaste", "processClipboardItem");
        this.$el = F(G);
        this.clientFileHandler = H;
        this._destroyables = [];
        this._destroyables.push(C.chainWith(this.$el).on("paste", this.handlePaste))
    }
    ;
    E.prototype.handlePaste = function(J) {
        var I = A.typeFilters.image;
        var G = J.originalEvent;
        var H = G.clipboardData && G.clipboardData.items;
        if (this.clientFileHandler && H && H.length === 1) {
            B.toArray(H).filter(B.compose(I.test.bind(I), D.dot("type"))).forEach(this.processClipboardItem)
        }
    }
    ;
    E.prototype.processClipboardItem = function(H) {
        var G = H.getAsFile();
        G.name = "upload." + B.last(G.type.split("/"));
        this.clientFileHandler.handleFiles([G], this.$el)
    }
    ;
    E.prototype.destroy = function() {
        B.invoke(this._destroyables, "destroy")
    }
    ;
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:upload-interceptor', location = '/static/widget/upload-interceptor/upload-interceptor.js' */
define("widget/upload-interceptor", ["jquery", "lodash", "util/events"], function(D, A, B) {
    function C(E, F) {
        this.init.apply(this, arguments)
    }
    C.prototype.init = function(E, F) {
        A.bindAll(this, "onSelectFile");
        this.$el = D(E);
        this.clientFileHandler = F;
        this._destroyables = [];
        this._destroyables.push(B.chainWith(this.$el).on("change", this.onSelectFile))
    }
    ;
    C.prototype.onSelectFile = function(F) {
        var E = F.target;
        if ((E.value !== "" || (E.files && E.files.length)) && this.clientFileHandler) {
            this.clientFileHandler.handleFiles(E.files, E);
            D(E).wrap("<form>").parent("form").trigger("reset").end().unwrap()
        }
    }
    ;
    C.prototype.destroy = function() {
        A.invoke(this._destroyables, "destroy")
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:faux-upload-field', location = '/static/widget/faux-upload-field/faux-upload-field.js' */
define("widget/faux-upload-field", ["jquery", "lodash", "util/dom-event", "util/events", "util/navigator", "widget/client-file-handlers/client-file-handler", "widget/upload-interceptor"], function(H, D, G, E, C, A, F) {
    function B(I, J) {
        this.init.apply(this, arguments)
    }
    B.prototype.defaults = {
        clientFileHandler: null,
        accept: null,
        allowMultiple: false
    };
    B.prototype.init = function(J, K) {
        this.$el = H(J);
        this._destroyables = [];
        switch (K.accept) {
        case A.typeFilters.audio:
            K.accept = "audio/*";
            break;
        case A.typeFilters.image:
            K.accept = "image/*";
            break;
        case A.typeFilters.imageWeb:
            K.accept = "image/jpeg, image/gif, image/png";
            break;
        case A.typeFilters.video:
            K.accept = "video/*";
            break
        }
        this.options = H.extend({}, this.defaults, K);
        var I = D.uniqueId("faux-upload-field-");
        var L = H(stash.widget.fauxUploadField.uploadField({
            id: I,
            accept: this.options.accept,
            allowMultiple: this.options.allowMultiple
        })).hide().insertAfter(this.$el);
        this.$el.tooltip({
            gravity: H.fn.tipsy.autoNS
        });
        if (this.$el.is("label")) {
            this.$el.attr("for", I)
        } else {
            if (C.isIE()) {
                this.$el.hide();
                L.show()
            } else {
                this._destroyables.push(E.chainWith(this.$el).on("click", G.preventDefault(L.click.bind(L))))
            }
        }
        if (this.options.clientFileHandler) {
            this._destroyables.push(new F(L,this.options.clientFileHandler))
        }
    }
    ;
    B.prototype.destroy = function() {
        D.invoke(this._destroyables, "destroy")
    }
    ;
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:faux-upload-field', location = '/static/widget/faux-upload-field/faux-upload-field.soy' */
// This file was automatically generated from faux-upload-field.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.fauxUploadField.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.fauxUploadField == 'undefined') {
    stash.widget.fauxUploadField = {};
}

stash.widget.fauxUploadField.uploadField = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<input type="file" ' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + 'class="faux-upload-field ' + ((opt_data.extraClasses) ? soy.$$escapeHtml(opt_data.extraClasses) : '') + '"' + ((opt_data.accept) ? ' accept="' + soy.$$escapeHtml(opt_data.accept) + '"' : '') + ((opt_data.allowMultiple) ? ' multiple' : '') + '/>';
}
;
if (goog.DEBUG) {
    stash.widget.fauxUploadField.uploadField.soyTemplateName = 'stash.widget.fauxUploadField.uploadField';
}

stash.widget.fauxUploadField.labelButton = function(opt_data, opt_ignored) {
    return '' + aui.buttons.button({
        tagName: 'label',
        extraClasses: 'faux-upload-label-button ' + opt_data.extraClasses,
        text: opt_data.text
    });
}
;
if (goog.DEBUG) {
    stash.widget.fauxUploadField.labelButton.soyTemplateName = 'stash.widget.fauxUploadField.labelButton';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:drag-drop-file-uploader', location = '/static/widget/drag-drop-file-uploader/drag-drop-file-uploader.js' */
define("widget/drag-drop-file-uploader", ["jquery", "lodash", "util/events", "widget/client-file-handlers/client-file-uploader", "widget/drag-drop-file-target", "widget/faux-upload-field", "widget/paste-image-target"], function(H, D, E, C, G, B, F) {
    function A(J, I) {
        if (!A.isSupported()) {
            throw new Error("DragDropUploader requires ClientFileUploader support")
        }
        this.init.apply(this, arguments)
    }
    A.typeFilters = C.typeFilters;
    A.isSupported = C.isSupported;
    E.addLocalEventMixin(A.prototype);
    A.prototype.defaults = {
        url: null,
        fieldName: "file",
        uploadButton: undefined,
        fileTypeFilter: undefined,
        fileCountLimit: undefined,
        fileSizeLimit: undefined,
        pasteUpload: true
    };
    A.prototype.init = function(L, J) {
        this.$target = H(L);
        var K = D.pick(C.prototype.defaults, "fileTypeFilter", "fileCountLimit", "fileSizeLimit");
        this.options = H.extend({}, this.defaults, K, J);
        this._destroyables = [];
        var I = new C({
            url: this.options.url,
            fieldName: this.options.fieldName
        });
        this._destroyables.push(this.retriggerFrom(I, "filesSelected", "validFiles", "invalidFiles", "uploadStarted"));
        this._destroyables.push(I);
        this._destroyables.push(new G(this.$target,{
            clientFileHandler: I
        }));
        if (this.options.uploadButton) {
            this._destroyables.push(new B(H(this.options.uploadButton),{
                clientFileHandler: I,
                allowMultiple: this.options.fileCountLimit > 1
            }))
        }
        if (this.options.pasteUpload) {
            this._destroyables.push(new F(this.$target,I))
        }
    }
    ;
    A.prototype.destroy = function() {
        D.invoke(this._destroyables, "destroy")
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:promise-util', location = '/static/util/promise.js' */
define("util/promise", ["jquery", "lodash", "exports"], function(H, O, F) {
    var B = {
        PENDING: "pending",
        REJECTED: "rejected",
        RESOLVED: "resolved"
    };
    function E(R) {
        R && R.abort && R.abort()
    }
    function K() {
        var R = Array.prototype.slice.call(arguments);
        var S = H.when.apply(H, R);
        S.abort = function() {
            O.forEach(R, E)
        }
        ;
        return S
    }
    function M() {
        console.log("Promise does not have an abort function")
    }
    function C() {
        var R = H.when.apply(H, arguments);
        R.abort = O.invoke.bind(O, arguments, "abort");
        return P(R)
    }
    function P(a, T, S) {
        var R;
        var Z = a;
        var V = H.Callbacks();
        var W = {};
        function X() {
            if (W.state() === "pending") {
                if (!R) {
                    E(Z)
                }
                R = true
            }
            V.fire()
        }
        function Y(b, c) {
            return function() {
                if (R) {
                    return new H.Deferred()[b + "With"](this, arguments)
                }
                Z = c.apply(this, arguments);
                return Z
            }
        }
        var U = a.then(T ? Y("resolve", T) : null, S ? Y("reject", S) : null);
        W.abort = X;
        W.thenAbortable = function(b, d) {
            var c = P(W, b, d);
            V.add(c.abort);
            return c
        }
        ;
        return U.promise(W)
    }
    function G(S, R) {
        return function() {
            var X = H.Deferred();
            var T = this;
            var U = Array.prototype.slice.call(arguments);
            var Y;
            var W = function() {
                return setTimeout(function() {
                    var Z = S.apply(T, U);
                    Z.done(X.resolve).fail(X.reject);
                    Y = Z.abort ? O.bind(Z.abort, Z) : M
                }, R)
            };
            var V = W();
            Y = function() {
                clearTimeout(V);
                X.reject(X, "abort", "abort")
            }
            ;
            return X.promise({
                abort: function() {
                    Y()
                },
                reset: function() {
                    if (X.state() === "pending") {
                        clearTimeout(V);
                        U = Array.prototype.slice.call(arguments);
                        V = W()
                    }
                }
            })
        }
    }
    function I() {
        return H.when.apply(H, O.map(arguments, A)).then(L, L)
    }
    function A(R) {
        return R.then(Q(false), Q(true))
    }
    function Q(R) {
        return function() {
            return H.Deferred().resolve({
                rejectedSelf: R && this,
                self: this,
                args: Array.prototype.slice.call(arguments)
            })
        }
    }
    function L() {
        var U = O.chain(arguments).pluck("rejectedSelf").find(O.identity).value();
        var T = (U ? "reject" : "resolve") + "With";
        var R = U || arguments[0].self;
        var S = O.pluck(arguments, "args");
        return H.Deferred()[T](R, S)
    }
    function N(R, V, S, U) {
        var T = H(R).spin(S || "small", U || {});
        return V.always(function() {
            T.remove()
        })
    }
    function D(R, W, S) {
        S = S || "small";
        var V;
        var T = H(R);
        function U() {
            var X = Array.prototype.slice.call(arguments);
            if (!X.length) {
                return
            }
            T.spin(S).addClass("spinning");
            V = I.apply(null, O.compact(X.concat(V)));
            V.always(function() {
                if (V.state() !== B.PENDING) {
                    T.spinStop().removeClass("spinning")
                }
            })
        }
        W && U(W);
        return {
            add: U
        }
    }
    function J(V) {
        var T = H.Deferred()
          , R = {
            timeout: 10000,
            interval: 100,
            name: "",
            predicate: H.noop
        };
        V = H.extend(R, V);
        var S = new Date().getTime() + (V.timeout);
        var U = setInterval(function() {
            var W = V.predicate();
            if (W) {
                clearInterval(U);
                T.resolve(W)
            } else {
                if (new Date().getTime() > S) {
                    clearInterval(U);
                    T.reject("Predicate '" + V.name + "' was false after " + V.timeout + "ms")
                }
            }
        }, V.interval);
        return T.promise()
    }
    F.state = B;
    F.delay = G;
    F.reduce = K;
    F.settle = I;
    F.spinner = N;
    F.rollingSpinner = D;
    F.thenAbortable = P;
    F.whenAbortable = C;
    F.waitFor = J
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:inline-error-dialog', location = '/static/widget/inline-error-dialog/inline-error-dialog.js' */
define("widget/inline-error-dialog", ["aui", "jquery", "lodash", "util/events"], function(B, E, C, D) {
    function A(F, G) {
        this.init.apply(this, arguments)
    }
    A.prototype.init = function(F, H) {
        this.errors = [];
        this.options = E.extend({
            persistent: true
        }, H);
        this._destroyables = [];
        C.bindAll(this, "_renderDialogContents", "hide", "show", "refresh", "add", "reset", "destroy");
        var G = {
            noBind: true,
            persistent: this.options.persistent,
            addActiveClass: false,
            fadeTime: 0
        };
        this._$inlineDialog = B.InlineDialog(E(F), C.uniqueId("inline-error-dialog-"), this._renderDialogContents, G);
        if (this.options.persistent) {
            this._destroyables.push(D.chainWith(this._$inlineDialog).on("click", ".dismiss-button", this.hide))
        }
    }
    ;
    A.prototype._renderDialogContents = function(G, F, H) {
        G.html(stash.widget.inlineErrorDialog.contents({
            title: C.isFunction(this.options.title) ? this.options.title(this.errors) : this.options.title,
            subtitle: C.isFunction(this.options.subtitle) ? this.options.subtitle(this.errors) : this.options.subtitle,
            errors: this.errors,
            persistent: this.options.persistent
        })).addClass("inline-error-contents");
        H()
    }
    ;
    A.prototype.hide = function() {
        this._$inlineDialog.hide();
        this.reset()
    }
    ;
    A.prototype.show = function() {
        this._$inlineDialog.show();
        this.refresh()
    }
    ;
    A.prototype.refresh = function() {
        this._$inlineDialog.refresh()
    }
    ;
    A.prototype.add = function(F) {
        this.errors.push(F)
    }
    ;
    A.prototype.reset = function() {
        this.errors.length = 0
    }
    ;
    A.prototype.destroy = function() {
        this.errors.length = 0;
        C.invoke(this._destroyables, "destroy");
        this._$inlineDialog.remove()
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:inline-error-dialog', location = '/static/widget/inline-error-dialog/inline-error-dialog.soy' */
// This file was automatically generated from inline-error-dialog.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.inlineErrorDialog.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.inlineErrorDialog == 'undefined') {
    stash.widget.inlineErrorDialog = {};
}

stash.widget.inlineErrorDialog.contents = function(opt_data, opt_ignored) {
    var output = '<h4>' + aui.icons.icon({
        icon: 'error',
        useIconFont: true
    }) + ((opt_data.title) ? soy.$$escapeHtml(opt_data.title) : '') + '</h4>' + ((opt_data.subtitle) ? '<h6>' + soy.$$escapeHtml(opt_data.subtitle) + '</h6>' : '');
    var errorList16 = opt_data.errors;
    var errorListLen16 = errorList16.length;
    for (var errorIndex16 = 0; errorIndex16 < errorListLen16; errorIndex16++) {
        var errorData16 = errorList16[errorIndex16];
        output += ((errorIndex16 == 0) ? '<ul>' : '') + '<li>' + soy.$$escapeHtml(errorData16) + '</li>' + ((errorIndex16 == errorListLen16 - 1) ? '</ul>' : '');
    }
    output += (opt_data.persistent) ? stash.buttons.button({
        extraClasses: 'dismiss-button',
        type: 'button',
        buttonText: "Dismiss"
    }) : '';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.inlineErrorDialog.contents.soyTemplateName = 'stash.widget.inlineErrorDialog.contents';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:property-util', location = '/static/util/property.js' */
define("util/property", ["jquery", "exports"], function(D, B) {
    function C(F, E) {
        if (F == null) {
            return F
        }
        switch (E) {
        case "STRING":
            return F;
        case "NUMBER":
            return Number(F);
        case "BOOLEAN":
            return F.toLowerCase() === "true"
        }
    }
    var A = {};
    B.getFromProvider = function(E) {
        var F = A[E] || (A[E] = WRM.data.claim("com.atlassian.stash.config-wrm-data:" + E + ".data"));
        return D.Deferred().resolve(C(F.value, F.type))
    }
    ;
    B._coerce = C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:feature-enabled', location = '/static/util/feature-enabled.js' */
define("util/feature-enabled", ["jquery", "exports"], function(D, B) {
    var A = {};
    var C = Object.prototype.hasOwnProperty;
    B.getFromProvider = function(E) {
        var F = C.call(A, E) ? A[E] : (A[E] = WRM.data.claim("com.atlassian.stash.feature-wrm-data:" + E + ".data"));
        return D.Deferred().resolve(F)
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-attachments', location = '/static/widget/markup-attachments/markup-attachments.soy' */
// This file was automatically generated from markup-attachments.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.markupAttachments.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.markupAttachments == 'undefined') {
    stash.widget.markupAttachments = {};
}

stash.widget.markupAttachments.uploadTrigger = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + stash.buttons.button({
        tagName: 'label',
        extraClasses: 'aui-button-subtle aui-button-compact markup-attachments-button',
        title: opt_data.title,
        iconType: 'aui',
        iconClass: 'aui-icon-small aui-iconfont-attachment',
        iconText: opt_data.accessibilityText,
        buttonText: opt_data.buttonText ? opt_data.buttonText : ''
    });
}
;
if (goog.DEBUG) {
    stash.widget.markupAttachments.uploadTrigger.soyTemplateName = 'stash.widget.markupAttachments.uploadTrigger';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-attachments', location = '/static/widget/markup-attachments/markup-attachments.js' */
define("widget/markup-attachments", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/events", "util/feature-enabled", "util/function", "util/promise", "util/property", "util/text", "model/page-state", "widget/drag-drop-file-uploader", "widget/inline-error-dialog"], function(K, H, U, J, D, E, L, T, P, B, N, G, Q) {
    var M;
    E.getFromProvider("attachments").done(function(V) {
        M = V
    });
    var C;
    P.getFromProvider("attachment.upload.max.size").done(function(V) {
        C = V
    });
    function I(V) {
        if (!I.isSupported()) {
            throw new Error("MarkupAttachments requires DragDropFileUploader support")
        }
        this.init.apply(this, arguments)
    }
    I.isEnabled = function() {
        return M
    }
    ;
    I.isSupported = G.isSupported;
    I._editorClass = "markup-attachments";
    I.prototype.init = function(W) {
        this.$editor = H(W);
        this.$textarea = this.$editor.find("textarea");
        this.$uploadButton = this.$editor.find(".markup-attachments-button");
        this._destroyables = [];
        U.bindAll(this, "handleUpload", "handleAttachment", "handleFailures", "hideErrors");
        this.$editor.addClass(I._editorClass);
        this.dragDropFileUploader = new G(this.$editor,{
            url: O(),
            fieldName: "files",
            uploadButton: this.$uploadButton,
            fileSizeLimit: C
        });
        this._destroyables.push(this.dragDropFileUploader);
        this._destroyables.push(D.chainWith(this.dragDropFileUploader).on({
            filesSelected: this.hideErrors,
            invalidFiles: L.partialRight(U.forEach, L.binary(this.handleFailures)),
            uploadStarted: this.handleUpload
        }));
        var X = B.formatSizeInBytes(this.dragDropFileUploader.options.fileSizeLimit);
        this.errorDialog = new Q(this.$uploadButton,{
            title: function(Y) {
                return K.format("{0,choice,1#There was a problem with your upload and the following file was not added|1\u003cThere was a problem with your upload and the following files were not added}", Y.length)
            },
            subtitle: K.format("Note: There is a {0} size limit per file", X)
        });
        this._destroyables.push(this.errorDialog);
        this._destroyables.push(D.chainWith(this.$editor).on("resize", this.errorDialog.refresh));
        var V = H(aui.icons.icon({
            icon: "success",
            useIconFont: true
        })).appendTo(this.$uploadButton);
        this._destroyables.push({
            destroy: V.remove.bind(V)
        });
        this.rollingSpinner = T.rollingSpinner(this.$uploadButton)
    }
    ;
    I.prototype.handleUpload = function(Y, V) {
        this.rollingSpinner.add(Y);
        var X = U.compose(L.partialRight(U.forEach, U.partial(this.handleAttachment, V)), L.dot("attachments"));
        var W = function(a, Z) {
            this.handleFailures([V], Z, {
                statusCode: a.status
            })
        };
        Y.done(X).fail(W.bind(this))
    }
    ;
    I.prototype.handleAttachment = function(W, X) {
        if (X.errors) {
            var V = U.first(X.errors);
            this.handleFailures([W], V.exceptionName, {
                message: V.message
            });
            return
        }
        this.$textarea.val(F(this.$textarea.val()) + A(X, W.name, W.type)).trigger("input").focus()
    }
    ;
    I.prototype.handleFailures = function(V, W, X) {
        if (W === "abort" || W === "error" && X.statusCode !== 500) {
            this.hideErrors();
            return
        }
        U.pluck(V, "name").forEach(this.errorDialog.add);
        this.errorDialog.show()
    }
    ;
    I.prototype.hideErrors = function() {
        this.errorDialog.hide()
    }
    ;
    I.prototype.destroy = function() {
        this.$editor.removeClass(I._editorClass);
        U.invoke(this._destroyables, "destroy")
    }
    ;
    var O = U.once(function() {
        return N.getRepository() && J.currentRepo().attachments().build()
    });
    function R(V) {
        V = (V || "").replace(/[^\w\.\-]/g, "");
        return (V.length === 0 || U.first(V) === ".") ? "upload" + V : V
    }
    function S(V) {
        return V.replace(/([\(\)])/g, "\\$1")
    }
    function A(a, c, V) {
        var X = a.links.attachment;
        var Y = X && X.href || a.links.self.href;
        var Z = R(c);
        var b = S(Y);
        var W = G.typeFilters.image.test(V) ? "![" + Z + "](" + b + ")" : Z;
        return "[" + W + "](" + b + ")"
    }
    function F(V) {
        return V + ((V.length && U.last(V) !== "\n") ? "\n" : "")
    }
    return I
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-editor', location = '/static/widget/markup-editor/markup-editor.soy' */
// This file was automatically generated from markup-editor.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.markupEditor.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.markupEditor == 'undefined') {
    stash.widget.markupEditor = {};
}

stash.widget.markupEditor.editor = function(opt_data, opt_ignored) {
    return '<div class="markup-editor">' + stash.widget.markupPreview.preview(null) + widget.aui.form.expandingTextarea({
        id: opt_data.textareaId,
        name: opt_data.textareaName ? opt_data.textareaName : 'text',
        extraClasses: 'text',
        initialValue: opt_data.text,
        placeholderText: opt_data.placeholderText
    }) + '<div class="markup-toolbar"><div class="secondary">' + stash.widget.markupPreview.previewHelp(null) + stash.widget.markupPreview.previewButton({
        title: opt_data.previewButtonTitle
    }) + '</div><div class="primary">' + stash.widget.markupAttachments.uploadTrigger({
        title: opt_data.attachmentButtonTitle,
        accessibilityText: opt_data.attachmentButtonAccessibilityText
    }) + '</div><div class="tertiary"></div></div></div>';
}
;
if (goog.DEBUG) {
    stash.widget.markupEditor.editor.soyTemplateName = 'stash.widget.markupEditor.editor';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:markup-editor', location = '/static/widget/markup-editor/markup-editor.js' */
define("widget/markup-editor", ["aui", "jquery", "lodash", "util/events", "widget/markup-attachments", "widget/markup-preview", "widget/mentionable-textarea"], function(B, G, C, E, H, D, F) {
    function A(I) {
        this.init.apply(this, arguments)
    }
    A._dataKey = "markup-editor";
    A.bindTo = function(J) {
        var K = A.unbindFrom(J);
        var I = new A(K);
        K.data(A._dataKey, I);
        return I
    }
    ;
    A.unbindFrom = function(J) {
        var K = G(J);
        K = K.is(".markup-editor") ? K : K.find(".markup-editor");
        var I = K.data(A._dataKey);
        I && I.destroy();
        return K
    }
    ;
    E.addLocalEventMixin(A.prototype);
    A.prototype.init = function(K) {
        var L = G(K);
        this.$editor = L.is(".markup-editor") ? L : L.find(".markup-editor");
        this._destroyables = [];
        var N = this.$editor.find("textarea");
        if (N.is(document.activeElement)) {
            C.defer(N.focus.bind(N))
        }
        var J = this.$editor.find("textarea.expanding").expandingTextarea();
        this._destroyables.push(E.chainWith(J).on("resize.expanding", this.onComponentResize.bind(this, false)));
        this._destroyables.push({
            destroy: J.expandingTextarea.bind(J, "destroy")
        });
        var M = new D(this.$editor);
        this._destroyables.push(E.chainWith(M).on("resize", this.onComponentResize.bind(this, true)));
        this._destroyables.push(M);
        this._destroyables.push(new F({
            $container: this.$editor
        }));
        var I = function(O) {
            this.$editor.find(".markup-attachments-button").addClass("disabled").prop("disabled", "disabled").attr("aria-disabled", true).attr("title", O)
        }
        .bind(this);
        if (H.isEnabled()) {
            if (H.isSupported()) {
                this._destroyables.push(new H(this.$editor))
            } else {
                I("Uploading attachments is not supported in this browser")
            }
        } else {
            I("Your system administrator has disabled uploading attachments")
        }
        this.$editor.find(".markup-preview-help").tooltip({
            gravity: G.fn.tipsy.autoNS
        })
    }
    ;
    A.prototype.onComponentResize = function(I) {
        this.$editor.triggerHandler("resize");
        this.trigger("resize", I)
    }
    ;
    A.prototype.destroy = function() {
        C.invoke(this._destroyables, "destroy");
        this.$editor.data(A._dataKey, null);
        this.$editor = null;
        this.off()
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.auiplugin:aui-select2', location = 'js-vendor/jquery/plugins/jquery.select2.js' */
(function(e) {
    "undefined" == typeof e.fn.each2 && e.extend(e.fn, {
        each2: function(n) {
            for (var j = e([0]), k = -1, w = this.length; ++k < w && (j.context = j[0] = this[k]) && !1 !== n.call(j[0], k, j); )
                ;
            return this
        }
    })
})(jQuery);
(function(e) {
    function n(a) {
        var b, c, d, g;
        if (!a || 1 > a.length)
            return a;
        b = "";
        c = 0;
        for (d = a.length; c < d; c++)
            g = a.charAt(c),
            b += M[g] || g;
        return b
    }
    function j(a, b) {
        for (var c = 0, d = b.length; c < d; c += 1)
            if (k(a, b[c]))
                return c;
        return -1
    }
    function k(a, b) {
        return a === b ? !0 : void 0 === a || void 0 === b || null === a || null === b ? !1 : a.constructor === String ? a + "" === b + "" : b.constructor === String ? b + "" === a + "" : !1
    }
    function w(a, b) {
        var c, d, g;
        if (null === a || 1 > a.length)
            return [];
        c = a.split(b);
        d = 0;
        for (g = c.length; d < g; d += 1)
            c[d] = e.trim(c[d]);
        return c
    }
    function E(a) {
        a.on("keydown", function() {
            void 0 === e.data(a, "keyup-change-value") && e.data(a, "keyup-change-value", a.val())
        });
        a.on("keyup", function() {
            var b = e.data(a, "keyup-change-value");
            void 0 !== b && a.val() !== b && (e.removeData(a, "keyup-change-value"),
            a.trigger("keyup-change"))
        })
    }
    function F(a, b, c) {
        var c = c || void 0, d;
        return function() {
            var g = arguments;
            window.clearTimeout(d);
            d = window.setTimeout(function() {
                b.apply(c, g)
            }, a)
        }
    }
    function l(a) {
        a.preventDefault();
        a.stopPropagation()
    }
    function y(a, b, c) {
        var d, g = [], h;
        (d = a.attr("class")) && e(("" + d).split(" ")).each2(function() {
            0 === this.indexOf("select2-") && g.push(this)
        });
        (d = b.attr("class")) && e(("" + d).split(" ")).each2(function() {
            0 !== this.indexOf("select2-") && (h = c(this)) && g.push(h)
        });
        a.attr("class", g.join(" "))
    }
    function G(a, b, c, d) {
        var g = n(a.toUpperCase()).indexOf(n(b.toUpperCase()))
          , b = b.length;
        0 > g ? c.push(d(a)) : (c.push(d(a.substring(0, g))),
        c.push("<span class='select2-match'>"),
        c.push(d(a.substring(g, g + b))),
        c.push("</span>"),
        c.push(d(a.substring(g + b, a.length))))
    }
    function H(a) {
        var b = {
            "\\": "&#92;",
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
            "/": "&#47;"
        };
        return String(a).replace(/[&<>"'\/\\]/g, function(a) {
            return b[a]
        })
    }
    function I(a) {
        var b, c = null, d = a.quietMillis || 100, g = a.url, h = this;
        return function(m) {
            window.clearTimeout(b);
            b = window.setTimeout(function() {
                var b = a.data
                  , d = g
                  , t = a.transport || e.fn.select2.ajaxDefaults.transport
                  , f = e.extend({}, e.fn.select2.ajaxDefaults.params, {
                    type: a.type || "GET",
                    cache: a.cache || !1,
                    jsonpCallback: a.jsonpCallback || void 0,
                    dataType: a.dataType || "json"
                })
                  , b = b ? b.call(h, m.term, m.page, m.context) : null
                  , d = "function" === typeof d ? d.call(h, m.term, m.page, m.context) : d;
                c && c.abort();
                a.params && (e.isFunction(a.params) ? e.extend(f, a.params.call(h)) : e.extend(f, a.params));
                e.extend(f, {
                    url: d,
                    dataType: a.dataType,
                    data: b,
                    success: function(b) {
                        b = a.results(b, m.page);
                        m.callback(b)
                    }
                });
                c = t.call(h, f)
            }, d)
        }
    }
    function J(a) {
        var b = a, c, d, g = function(a) {
            return "" + a.text
        };
        e.isArray(b) && (d = b,
        b = {
            results: d
        });
        !1 === e.isFunction(b) && (d = b,
        b = function() {
            return d
        }
        );
        a = b();
        a.text && (g = a.text,
        e.isFunction(g) || (c = a.text,
        g = function(a) {
            return a[c]
        }
        ));
        return function(a) {
            var c = a.term, d = {
                results: []
            }, o;
            if (c === "")
                a.callback(b());
            else {
                o = function(b, d) {
                    var i, f, b = b[0];
                    if (b.children) {
                        i = {};
                        for (f in b)
                            b.hasOwnProperty(f) && (i[f] = b[f]);
                        i.children = [];
                        e(b.children).each2(function(a, b) {
                            o(b, i.children)
                        });
                        (i.children.length || a.matcher(c, g(i), b)) && d.push(i)
                    } else
                        a.matcher(c, g(b), b) && d.push(b)
                }
                ;
                e(b().results).each2(function(a, b) {
                    o(b, d.results)
                });
                a.callback(d)
            }
        }
    }
    function K(a) {
        var b = e.isFunction(a);
        return function(c) {
            var d = c.term
              , g = {
                results: []
            };
            e(b ? a() : a).each(function() {
                var a = void 0 !== this.text
                  , b = a ? this.text : this;
                if ("" === d || c.matcher(d, b))
                    g.results.push(a ? this : {
                        id: this,
                        text: this
                    })
            });
            c.callback(g)
        }
    }
    function s(a, b) {
        if (e.isFunction(a))
            return !0;
        if (!a)
            return !1;
        throw Error(b + " must be a function or a falsy value");
    }
    function p(a) {
        return e.isFunction(a) ? a() : a
    }
    function L(a) {
        var b = 0;
        e.each(a, function(a, d) {
            d.children ? b += L(d.children) : b++
        });
        return b
    }
    function N(a, b, c, d) {
        var g = a, h = !1, e, i, f, t;
        if (d.createSearchChoice && d.tokenSeparators && !(1 > d.tokenSeparators.length)) {
            for (; ; ) {
                h = -1;
                i = 0;
                for (f = d.tokenSeparators.length; i < f && !(t = d.tokenSeparators[i],
                h = a.indexOf(t),
                0 <= h); i++)
                    ;
                if (0 > h)
                    break;
                e = a.substring(0, h);
                a = a.substring(h + t.length);
                if (0 < e.length && (e = d.createSearchChoice.call(this, e, b),
                void 0 !== e && null !== e && void 0 !== d.id(e) && null !== d.id(e))) {
                    h = !1;
                    i = 0;
                    for (f = b.length; i < f; i++)
                        if (k(d.id(e), d.id(b[i]))) {
                            h = !0;
                            break
                        }
                    h || c(e)
                }
            }
            if (g !== a)
                return a
        }
    }
    function A(a, b) {
        var c = function() {};
        c.prototype = new a;
        c.prototype.constructor = c;
        c.prototype.parent = a.prototype;
        c.prototype = e.extend(c.prototype, b);
        return c
    }
    if (void 0 === window.Select2) {
        var f, u, B, C, z, v, x = {
            x: 0,
            y: 0
        }, D;
        f = {
            TAB: 9,
            ENTER: 13,
            ESC: 27,
            SPACE: 32,
            LEFT: 37,
            UP: 38,
            RIGHT: 39,
            DOWN: 40,
            SHIFT: 16,
            CTRL: 17,
            ALT: 18,
            PAGE_UP: 33,
            PAGE_DOWN: 34,
            HOME: 36,
            END: 35,
            BACKSPACE: 8,
            DELETE: 46,
            isArrow: function(a) {
                a = a.which ? a.which : a;
                switch (a) {
                case f.LEFT:
                case f.RIGHT:
                case f.UP:
                case f.DOWN:
                    return !0
                }
                return !1
            },
            isControl: function(a) {
                switch (a.which) {
                case f.SHIFT:
                case f.CTRL:
                case f.ALT:
                    return !0
                }
                return a.metaKey ? !0 : !1
            },
            isFunctionKey: function(a) {
                a = a.which ? a.which : a;
                return 112 <= a && 123 >= a
            }
        };
        var M = {
            "\u24b6": "A",
            "\uff21": "A",
            "\u00c0": "A",
            "\u00c1": "A",
            "\u00c2": "A",
            "\u1ea6": "A",
            "\u1ea4": "A",
            "\u1eaa": "A",
            "\u1ea8": "A",
            "\u00c3": "A",
            "\u0100": "A",
            "\u0102": "A",
            "\u1eb0": "A",
            "\u1eae": "A",
            "\u1eb4": "A",
            "\u1eb2": "A",
            "\u0226": "A",
            "\u01e0": "A",
            "\u00c4": "A",
            "\u01de": "A",
            "\u1ea2": "A",
            "\u00c5": "A",
            "\u01fa": "A",
            "\u01cd": "A",
            "\u0200": "A",
            "\u0202": "A",
            "\u1ea0": "A",
            "\u1eac": "A",
            "\u1eb6": "A",
            "\u1e00": "A",
            "\u0104": "A",
            "\u023a": "A",
            "\u2c6f": "A",
            "\ua732": "AA",
            "\u00c6": "AE",
            "\u01fc": "AE",
            "\u01e2": "AE",
            "\ua734": "AO",
            "\ua736": "AU",
            "\ua738": "AV",
            "\ua73a": "AV",
            "\ua73c": "AY",
            "\u24b7": "B",
            "\uff22": "B",
            "\u1e02": "B",
            "\u1e04": "B",
            "\u1e06": "B",
            "\u0243": "B",
            "\u0182": "B",
            "\u0181": "B",
            "\u24b8": "C",
            "\uff23": "C",
            "\u0106": "C",
            "\u0108": "C",
            "\u010a": "C",
            "\u010c": "C",
            "\u00c7": "C",
            "\u1e08": "C",
            "\u0187": "C",
            "\u023b": "C",
            "\ua73e": "C",
            "\u24b9": "D",
            "\uff24": "D",
            "\u1e0a": "D",
            "\u010e": "D",
            "\u1e0c": "D",
            "\u1e10": "D",
            "\u1e12": "D",
            "\u1e0e": "D",
            "\u0110": "D",
            "\u018b": "D",
            "\u018a": "D",
            "\u0189": "D",
            "\ua779": "D",
            "\u01f1": "DZ",
            "\u01c4": "DZ",
            "\u01f2": "Dz",
            "\u01c5": "Dz",
            "\u24ba": "E",
            "\uff25": "E",
            "\u00c8": "E",
            "\u00c9": "E",
            "\u00ca": "E",
            "\u1ec0": "E",
            "\u1ebe": "E",
            "\u1ec4": "E",
            "\u1ec2": "E",
            "\u1ebc": "E",
            "\u0112": "E",
            "\u1e14": "E",
            "\u1e16": "E",
            "\u0114": "E",
            "\u0116": "E",
            "\u00cb": "E",
            "\u1eba": "E",
            "\u011a": "E",
            "\u0204": "E",
            "\u0206": "E",
            "\u1eb8": "E",
            "\u1ec6": "E",
            "\u0228": "E",
            "\u1e1c": "E",
            "\u0118": "E",
            "\u1e18": "E",
            "\u1e1a": "E",
            "\u0190": "E",
            "\u018e": "E",
            "\u24bb": "F",
            "\uff26": "F",
            "\u1e1e": "F",
            "\u0191": "F",
            "\ua77b": "F",
            "\u24bc": "G",
            "\uff27": "G",
            "\u01f4": "G",
            "\u011c": "G",
            "\u1e20": "G",
            "\u011e": "G",
            "\u0120": "G",
            "\u01e6": "G",
            "\u0122": "G",
            "\u01e4": "G",
            "\u0193": "G",
            "\ua7a0": "G",
            "\ua77d": "G",
            "\ua77e": "G",
            "\u24bd": "H",
            "\uff28": "H",
            "\u0124": "H",
            "\u1e22": "H",
            "\u1e26": "H",
            "\u021e": "H",
            "\u1e24": "H",
            "\u1e28": "H",
            "\u1e2a": "H",
            "\u0126": "H",
            "\u2c67": "H",
            "\u2c75": "H",
            "\ua78d": "H",
            "\u24be": "I",
            "\uff29": "I",
            "\u00cc": "I",
            "\u00cd": "I",
            "\u00ce": "I",
            "\u0128": "I",
            "\u012a": "I",
            "\u012c": "I",
            "\u0130": "I",
            "\u00cf": "I",
            "\u1e2e": "I",
            "\u1ec8": "I",
            "\u01cf": "I",
            "\u0208": "I",
            "\u020a": "I",
            "\u1eca": "I",
            "\u012e": "I",
            "\u1e2c": "I",
            "\u0197": "I",
            "\u24bf": "J",
            "\uff2a": "J",
            "\u0134": "J",
            "\u0248": "J",
            "\u24c0": "K",
            "\uff2b": "K",
            "\u1e30": "K",
            "\u01e8": "K",
            "\u1e32": "K",
            "\u0136": "K",
            "\u1e34": "K",
            "\u0198": "K",
            "\u2c69": "K",
            "\ua740": "K",
            "\ua742": "K",
            "\ua744": "K",
            "\ua7a2": "K",
            "\u24c1": "L",
            "\uff2c": "L",
            "\u013f": "L",
            "\u0139": "L",
            "\u013d": "L",
            "\u1e36": "L",
            "\u1e38": "L",
            "\u013b": "L",
            "\u1e3c": "L",
            "\u1e3a": "L",
            "\u0141": "L",
            "\u023d": "L",
            "\u2c62": "L",
            "\u2c60": "L",
            "\ua748": "L",
            "\ua746": "L",
            "\ua780": "L",
            "\u01c7": "LJ",
            "\u01c8": "Lj",
            "\u24c2": "M",
            "\uff2d": "M",
            "\u1e3e": "M",
            "\u1e40": "M",
            "\u1e42": "M",
            "\u2c6e": "M",
            "\u019c": "M",
            "\u24c3": "N",
            "\uff2e": "N",
            "\u01f8": "N",
            "\u0143": "N",
            "\u00d1": "N",
            "\u1e44": "N",
            "\u0147": "N",
            "\u1e46": "N",
            "\u0145": "N",
            "\u1e4a": "N",
            "\u1e48": "N",
            "\u0220": "N",
            "\u019d": "N",
            "\ua790": "N",
            "\ua7a4": "N",
            "\u01ca": "NJ",
            "\u01cb": "Nj",
            "\u24c4": "O",
            "\uff2f": "O",
            "\u00d2": "O",
            "\u00d3": "O",
            "\u00d4": "O",
            "\u1ed2": "O",
            "\u1ed0": "O",
            "\u1ed6": "O",
            "\u1ed4": "O",
            "\u00d5": "O",
            "\u1e4c": "O",
            "\u022c": "O",
            "\u1e4e": "O",
            "\u014c": "O",
            "\u1e50": "O",
            "\u1e52": "O",
            "\u014e": "O",
            "\u022e": "O",
            "\u0230": "O",
            "\u00d6": "O",
            "\u022a": "O",
            "\u1ece": "O",
            "\u0150": "O",
            "\u01d1": "O",
            "\u020c": "O",
            "\u020e": "O",
            "\u01a0": "O",
            "\u1edc": "O",
            "\u1eda": "O",
            "\u1ee0": "O",
            "\u1ede": "O",
            "\u1ee2": "O",
            "\u1ecc": "O",
            "\u1ed8": "O",
            "\u01ea": "O",
            "\u01ec": "O",
            "\u00d8": "O",
            "\u01fe": "O",
            "\u0186": "O",
            "\u019f": "O",
            "\ua74a": "O",
            "\ua74c": "O",
            "\u01a2": "OI",
            "\ua74e": "OO",
            "\u0222": "OU",
            "\u24c5": "P",
            "\uff30": "P",
            "\u1e54": "P",
            "\u1e56": "P",
            "\u01a4": "P",
            "\u2c63": "P",
            "\ua750": "P",
            "\ua752": "P",
            "\ua754": "P",
            "\u24c6": "Q",
            "\uff31": "Q",
            "\ua756": "Q",
            "\ua758": "Q",
            "\u024a": "Q",
            "\u24c7": "R",
            "\uff32": "R",
            "\u0154": "R",
            "\u1e58": "R",
            "\u0158": "R",
            "\u0210": "R",
            "\u0212": "R",
            "\u1e5a": "R",
            "\u1e5c": "R",
            "\u0156": "R",
            "\u1e5e": "R",
            "\u024c": "R",
            "\u2c64": "R",
            "\ua75a": "R",
            "\ua7a6": "R",
            "\ua782": "R",
            "\u24c8": "S",
            "\uff33": "S",
            "\u1e9e": "S",
            "\u015a": "S",
            "\u1e64": "S",
            "\u015c": "S",
            "\u1e60": "S",
            "\u0160": "S",
            "\u1e66": "S",
            "\u1e62": "S",
            "\u1e68": "S",
            "\u0218": "S",
            "\u015e": "S",
            "\u2c7e": "S",
            "\ua7a8": "S",
            "\ua784": "S",
            "\u24c9": "T",
            "\uff34": "T",
            "\u1e6a": "T",
            "\u0164": "T",
            "\u1e6c": "T",
            "\u021a": "T",
            "\u0162": "T",
            "\u1e70": "T",
            "\u1e6e": "T",
            "\u0166": "T",
            "\u01ac": "T",
            "\u01ae": "T",
            "\u023e": "T",
            "\ua786": "T",
            "\ua728": "TZ",
            "\u24ca": "U",
            "\uff35": "U",
            "\u00d9": "U",
            "\u00da": "U",
            "\u00db": "U",
            "\u0168": "U",
            "\u1e78": "U",
            "\u016a": "U",
            "\u1e7a": "U",
            "\u016c": "U",
            "\u00dc": "U",
            "\u01db": "U",
            "\u01d7": "U",
            "\u01d5": "U",
            "\u01d9": "U",
            "\u1ee6": "U",
            "\u016e": "U",
            "\u0170": "U",
            "\u01d3": "U",
            "\u0214": "U",
            "\u0216": "U",
            "\u01af": "U",
            "\u1eea": "U",
            "\u1ee8": "U",
            "\u1eee": "U",
            "\u1eec": "U",
            "\u1ef0": "U",
            "\u1ee4": "U",
            "\u1e72": "U",
            "\u0172": "U",
            "\u1e76": "U",
            "\u1e74": "U",
            "\u0244": "U",
            "\u24cb": "V",
            "\uff36": "V",
            "\u1e7c": "V",
            "\u1e7e": "V",
            "\u01b2": "V",
            "\ua75e": "V",
            "\u0245": "V",
            "\ua760": "VY",
            "\u24cc": "W",
            "\uff37": "W",
            "\u1e80": "W",
            "\u1e82": "W",
            "\u0174": "W",
            "\u1e86": "W",
            "\u1e84": "W",
            "\u1e88": "W",
            "\u2c72": "W",
            "\u24cd": "X",
            "\uff38": "X",
            "\u1e8a": "X",
            "\u1e8c": "X",
            "\u24ce": "Y",
            "\uff39": "Y",
            "\u1ef2": "Y",
            "\u00dd": "Y",
            "\u0176": "Y",
            "\u1ef8": "Y",
            "\u0232": "Y",
            "\u1e8e": "Y",
            "\u0178": "Y",
            "\u1ef6": "Y",
            "\u1ef4": "Y",
            "\u01b3": "Y",
            "\u024e": "Y",
            "\u1efe": "Y",
            "\u24cf": "Z",
            "\uff3a": "Z",
            "\u0179": "Z",
            "\u1e90": "Z",
            "\u017b": "Z",
            "\u017d": "Z",
            "\u1e92": "Z",
            "\u1e94": "Z",
            "\u01b5": "Z",
            "\u0224": "Z",
            "\u2c7f": "Z",
            "\u2c6b": "Z",
            "\ua762": "Z",
            "\u24d0": "a",
            "\uff41": "a",
            "\u1e9a": "a",
            "\u00e0": "a",
            "\u00e1": "a",
            "\u00e2": "a",
            "\u1ea7": "a",
            "\u1ea5": "a",
            "\u1eab": "a",
            "\u1ea9": "a",
            "\u00e3": "a",
            "\u0101": "a",
            "\u0103": "a",
            "\u1eb1": "a",
            "\u1eaf": "a",
            "\u1eb5": "a",
            "\u1eb3": "a",
            "\u0227": "a",
            "\u01e1": "a",
            "\u00e4": "a",
            "\u01df": "a",
            "\u1ea3": "a",
            "\u00e5": "a",
            "\u01fb": "a",
            "\u01ce": "a",
            "\u0201": "a",
            "\u0203": "a",
            "\u1ea1": "a",
            "\u1ead": "a",
            "\u1eb7": "a",
            "\u1e01": "a",
            "\u0105": "a",
            "\u2c65": "a",
            "\u0250": "a",
            "\ua733": "aa",
            "\u00e6": "ae",
            "\u01fd": "ae",
            "\u01e3": "ae",
            "\ua735": "ao",
            "\ua737": "au",
            "\ua739": "av",
            "\ua73b": "av",
            "\ua73d": "ay",
            "\u24d1": "b",
            "\uff42": "b",
            "\u1e03": "b",
            "\u1e05": "b",
            "\u1e07": "b",
            "\u0180": "b",
            "\u0183": "b",
            "\u0253": "b",
            "\u24d2": "c",
            "\uff43": "c",
            "\u0107": "c",
            "\u0109": "c",
            "\u010b": "c",
            "\u010d": "c",
            "\u00e7": "c",
            "\u1e09": "c",
            "\u0188": "c",
            "\u023c": "c",
            "\ua73f": "c",
            "\u2184": "c",
            "\u24d3": "d",
            "\uff44": "d",
            "\u1e0b": "d",
            "\u010f": "d",
            "\u1e0d": "d",
            "\u1e11": "d",
            "\u1e13": "d",
            "\u1e0f": "d",
            "\u0111": "d",
            "\u018c": "d",
            "\u0256": "d",
            "\u0257": "d",
            "\ua77a": "d",
            "\u01f3": "dz",
            "\u01c6": "dz",
            "\u24d4": "e",
            "\uff45": "e",
            "\u00e8": "e",
            "\u00e9": "e",
            "\u00ea": "e",
            "\u1ec1": "e",
            "\u1ebf": "e",
            "\u1ec5": "e",
            "\u1ec3": "e",
            "\u1ebd": "e",
            "\u0113": "e",
            "\u1e15": "e",
            "\u1e17": "e",
            "\u0115": "e",
            "\u0117": "e",
            "\u00eb": "e",
            "\u1ebb": "e",
            "\u011b": "e",
            "\u0205": "e",
            "\u0207": "e",
            "\u1eb9": "e",
            "\u1ec7": "e",
            "\u0229": "e",
            "\u1e1d": "e",
            "\u0119": "e",
            "\u1e19": "e",
            "\u1e1b": "e",
            "\u0247": "e",
            "\u025b": "e",
            "\u01dd": "e",
            "\u24d5": "f",
            "\uff46": "f",
            "\u1e1f": "f",
            "\u0192": "f",
            "\ua77c": "f",
            "\u24d6": "g",
            "\uff47": "g",
            "\u01f5": "g",
            "\u011d": "g",
            "\u1e21": "g",
            "\u011f": "g",
            "\u0121": "g",
            "\u01e7": "g",
            "\u0123": "g",
            "\u01e5": "g",
            "\u0260": "g",
            "\ua7a1": "g",
            "\u1d79": "g",
            "\ua77f": "g",
            "\u24d7": "h",
            "\uff48": "h",
            "\u0125": "h",
            "\u1e23": "h",
            "\u1e27": "h",
            "\u021f": "h",
            "\u1e25": "h",
            "\u1e29": "h",
            "\u1e2b": "h",
            "\u1e96": "h",
            "\u0127": "h",
            "\u2c68": "h",
            "\u2c76": "h",
            "\u0265": "h",
            "\u0195": "hv",
            "\u24d8": "i",
            "\uff49": "i",
            "\u00ec": "i",
            "\u00ed": "i",
            "\u00ee": "i",
            "\u0129": "i",
            "\u012b": "i",
            "\u012d": "i",
            "\u00ef": "i",
            "\u1e2f": "i",
            "\u1ec9": "i",
            "\u01d0": "i",
            "\u0209": "i",
            "\u020b": "i",
            "\u1ecb": "i",
            "\u012f": "i",
            "\u1e2d": "i",
            "\u0268": "i",
            "\u0131": "i",
            "\u24d9": "j",
            "\uff4a": "j",
            "\u0135": "j",
            "\u01f0": "j",
            "\u0249": "j",
            "\u24da": "k",
            "\uff4b": "k",
            "\u1e31": "k",
            "\u01e9": "k",
            "\u1e33": "k",
            "\u0137": "k",
            "\u1e35": "k",
            "\u0199": "k",
            "\u2c6a": "k",
            "\ua741": "k",
            "\ua743": "k",
            "\ua745": "k",
            "\ua7a3": "k",
            "\u24db": "l",
            "\uff4c": "l",
            "\u0140": "l",
            "\u013a": "l",
            "\u013e": "l",
            "\u1e37": "l",
            "\u1e39": "l",
            "\u013c": "l",
            "\u1e3d": "l",
            "\u1e3b": "l",
            "\u017f": "l",
            "\u0142": "l",
            "\u019a": "l",
            "\u026b": "l",
            "\u2c61": "l",
            "\ua749": "l",
            "\ua781": "l",
            "\ua747": "l",
            "\u01c9": "lj",
            "\u24dc": "m",
            "\uff4d": "m",
            "\u1e3f": "m",
            "\u1e41": "m",
            "\u1e43": "m",
            "\u0271": "m",
            "\u026f": "m",
            "\u24dd": "n",
            "\uff4e": "n",
            "\u01f9": "n",
            "\u0144": "n",
            "\u00f1": "n",
            "\u1e45": "n",
            "\u0148": "n",
            "\u1e47": "n",
            "\u0146": "n",
            "\u1e4b": "n",
            "\u1e49": "n",
            "\u019e": "n",
            "\u0272": "n",
            "\u0149": "n",
            "\ua791": "n",
            "\ua7a5": "n",
            "\u01cc": "nj",
            "\u24de": "o",
            "\uff4f": "o",
            "\u00f2": "o",
            "\u00f3": "o",
            "\u00f4": "o",
            "\u1ed3": "o",
            "\u1ed1": "o",
            "\u1ed7": "o",
            "\u1ed5": "o",
            "\u00f5": "o",
            "\u1e4d": "o",
            "\u022d": "o",
            "\u1e4f": "o",
            "\u014d": "o",
            "\u1e51": "o",
            "\u1e53": "o",
            "\u014f": "o",
            "\u022f": "o",
            "\u0231": "o",
            "\u00f6": "o",
            "\u022b": "o",
            "\u1ecf": "o",
            "\u0151": "o",
            "\u01d2": "o",
            "\u020d": "o",
            "\u020f": "o",
            "\u01a1": "o",
            "\u1edd": "o",
            "\u1edb": "o",
            "\u1ee1": "o",
            "\u1edf": "o",
            "\u1ee3": "o",
            "\u1ecd": "o",
            "\u1ed9": "o",
            "\u01eb": "o",
            "\u01ed": "o",
            "\u00f8": "o",
            "\u01ff": "o",
            "\u0254": "o",
            "\ua74b": "o",
            "\ua74d": "o",
            "\u0275": "o",
            "\u01a3": "oi",
            "\u0223": "ou",
            "\ua74f": "oo",
            "\u24df": "p",
            "\uff50": "p",
            "\u1e55": "p",
            "\u1e57": "p",
            "\u01a5": "p",
            "\u1d7d": "p",
            "\ua751": "p",
            "\ua753": "p",
            "\ua755": "p",
            "\u24e0": "q",
            "\uff51": "q",
            "\u024b": "q",
            "\ua757": "q",
            "\ua759": "q",
            "\u24e1": "r",
            "\uff52": "r",
            "\u0155": "r",
            "\u1e59": "r",
            "\u0159": "r",
            "\u0211": "r",
            "\u0213": "r",
            "\u1e5b": "r",
            "\u1e5d": "r",
            "\u0157": "r",
            "\u1e5f": "r",
            "\u024d": "r",
            "\u027d": "r",
            "\ua75b": "r",
            "\ua7a7": "r",
            "\ua783": "r",
            "\u24e2": "s",
            "\uff53": "s",
            "\u00df": "s",
            "\u015b": "s",
            "\u1e65": "s",
            "\u015d": "s",
            "\u1e61": "s",
            "\u0161": "s",
            "\u1e67": "s",
            "\u1e63": "s",
            "\u1e69": "s",
            "\u0219": "s",
            "\u015f": "s",
            "\u023f": "s",
            "\ua7a9": "s",
            "\ua785": "s",
            "\u1e9b": "s",
            "\u24e3": "t",
            "\uff54": "t",
            "\u1e6b": "t",
            "\u1e97": "t",
            "\u0165": "t",
            "\u1e6d": "t",
            "\u021b": "t",
            "\u0163": "t",
            "\u1e71": "t",
            "\u1e6f": "t",
            "\u0167": "t",
            "\u01ad": "t",
            "\u0288": "t",
            "\u2c66": "t",
            "\ua787": "t",
            "\ua729": "tz",
            "\u24e4": "u",
            "\uff55": "u",
            "\u00f9": "u",
            "\u00fa": "u",
            "\u00fb": "u",
            "\u0169": "u",
            "\u1e79": "u",
            "\u016b": "u",
            "\u1e7b": "u",
            "\u016d": "u",
            "\u00fc": "u",
            "\u01dc": "u",
            "\u01d8": "u",
            "\u01d6": "u",
            "\u01da": "u",
            "\u1ee7": "u",
            "\u016f": "u",
            "\u0171": "u",
            "\u01d4": "u",
            "\u0215": "u",
            "\u0217": "u",
            "\u01b0": "u",
            "\u1eeb": "u",
            "\u1ee9": "u",
            "\u1eef": "u",
            "\u1eed": "u",
            "\u1ef1": "u",
            "\u1ee5": "u",
            "\u1e73": "u",
            "\u0173": "u",
            "\u1e77": "u",
            "\u1e75": "u",
            "\u0289": "u",
            "\u24e5": "v",
            "\uff56": "v",
            "\u1e7d": "v",
            "\u1e7f": "v",
            "\u028b": "v",
            "\ua75f": "v",
            "\u028c": "v",
            "\ua761": "vy",
            "\u24e6": "w",
            "\uff57": "w",
            "\u1e81": "w",
            "\u1e83": "w",
            "\u0175": "w",
            "\u1e87": "w",
            "\u1e85": "w",
            "\u1e98": "w",
            "\u1e89": "w",
            "\u2c73": "w",
            "\u24e7": "x",
            "\uff58": "x",
            "\u1e8b": "x",
            "\u1e8d": "x",
            "\u24e8": "y",
            "\uff59": "y",
            "\u1ef3": "y",
            "\u00fd": "y",
            "\u0177": "y",
            "\u1ef9": "y",
            "\u0233": "y",
            "\u1e8f": "y",
            "\u00ff": "y",
            "\u1ef7": "y",
            "\u1e99": "y",
            "\u1ef5": "y",
            "\u01b4": "y",
            "\u024f": "y",
            "\u1eff": "y",
            "\u24e9": "z",
            "\uff5a": "z",
            "\u017a": "z",
            "\u1e91": "z",
            "\u017c": "z",
            "\u017e": "z",
            "\u1e93": "z",
            "\u1e95": "z",
            "\u01b6": "z",
            "\u0225": "z",
            "\u0240": "z",
            "\u2c6c": "z",
            "\ua763": "z"
        };
        u = e(document);
        var O = 1;
        z = function() {
            return O++
        }
        ;
        u.on("mousemove", function(a) {
            x.x = a.pageX;
            x.y = a.pageY
        });
        u = A(Object, {
            bind: function(a) {
                var b = this;
                return function() {
                    a.apply(b, arguments)
                }
            },
            init: function(a) {
                var b, c;
                this.opts = a = this.prepareOpts(a);
                this.id = a.id;
                void 0 !== a.element.data("select2") && null !== a.element.data("select2") && a.element.data("select2").destroy();
                this.container = this.createContainer();
                this.containerId = "s2id_" + (a.element.attr("id") || "autogen" + z());
                this.containerSelector = "#" + this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g, "\\$1");
                this.container.attr("id", this.containerId);
                var d = !1, g;
                this.body = function() {
                    !1 === d && (g = a.element.closest("body"),
                    d = !0);
                    return g
                }
                ;
                y(this.container, this.opts.element, this.opts.adaptContainerCssClass);
                this.container.attr("style", a.element.attr("style"));
                this.container.css(p(a.containerCss));
                this.container.addClass(p(a.containerCssClass));
                this.elementTabIndex = this.opts.element.attr("tabindex");
                this.opts.element.data("select2", this).attr("tabindex", "-1").before(this.container).on("click.select2", l);
                this.container.data("select2", this);
                this.dropdown = this.container.find(".select2-drop");
                y(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
                this.dropdown.addClass(p(a.dropdownCssClass));
                this.dropdown.data("select2", this);
                this.dropdown.on("click", l);
                this.results = b = this.container.find(".select2-results");
                this.search = c = this.container.find("input.select2-input");
                this.resultsPage = this.queryCount = 0;
                this.context = null;
                this.initContainer();
                this.container.on("click", l);
                this.results.on("mousemove", function(a) {
                    (void 0 === x || x.x !== a.pageX || x.y !== a.pageY) && e(a.target).trigger("mousemove-filtered", a)
                });
                this.dropdown.on("mousemove-filtered touchstart touchmove touchend", ".select2-results", this.bind(this.highlightUnderEvent));
                var h = this.results
                  , m = F(80, function(a) {
                    h.trigger("scroll-debounced", a)
                });
                h.on("scroll", function(a) {
                    0 <= j(a.target, h.get()) && m(a)
                });
                this.dropdown.on("scroll-debounced", ".select2-results", this.bind(this.loadMoreIfNeeded));
                e(this.container).on("change", ".select2-input", function(a) {
                    a.stopPropagation()
                });
                e(this.dropdown).on("change", ".select2-input", function(a) {
                    a.stopPropagation()
                });
                e.fn.mousewheel && b.mousewheel(function(a, c, d, e) {
                    c = b.scrollTop();
                    0 < e && 0 >= c - e ? (b.scrollTop(0),
                    l(a)) : 0 > e && b.get(0).scrollHeight - b.scrollTop() + e <= b.height() && (b.scrollTop(b.get(0).scrollHeight - b.height()),
                    l(a))
                });
                E(c);
                c.on("keyup-change input paste", this.bind(this.updateResults));
                c.on("focus", function() {
                    c.addClass("select2-focused")
                });
                c.on("blur", function() {
                    c.removeClass("select2-focused")
                });
                this.dropdown.on("mouseup", ".select2-results", this.bind(function(a) {
                    0 < e(a.target).closest(".select2-result-selectable").length && (this.highlightUnderEvent(a),
                    this.selectHighlighted(a))
                }));
                this.dropdown.on("click mouseup mousedown", function(a) {
                    a.stopPropagation()
                });
                e.isFunction(this.opts.initSelection) && (this.initSelection(),
                this.monitorSource());
                null !== a.maximumInputLength && this.search.attr("maxlength", a.maximumInputLength);
                var i = a.element.prop("disabled");
                void 0 === i && (i = !1);
                this.enable(!i);
                i = a.element.prop("readonly");
                void 0 === i && (i = !1);
                this.readonly(i);
                if (!(i = D)) {
                    i = e("<div class='select2-measure-scrollbar'></div>");
                    i.appendTo("body");
                    var f = {
                        width: i.width() - i[0].clientWidth,
                        height: i.height() - i[0].clientHeight
                    };
                    i.remove();
                    i = f
                }
                D = i;
                this.autofocus = a.element.prop("autofocus");
                a.element.prop("autofocus", !1);
                this.autofocus && this.focus();
                this.nextSearchTerm = void 0
            },
            destroy: function() {
                var a = this.opts.element
                  , b = a.data("select2");
                this.close();
                this.propertyObserver && (delete this.propertyObserver,
                this.propertyObserver = null);
                void 0 !== b && (b.container.remove(),
                b.dropdown.remove(),
                a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus", this.autofocus || !1),
                this.elementTabIndex ? a.attr({
                    tabindex: this.elementTabIndex
                }) : a.removeAttr("tabindex"),
                a.show())
            },
            optionToData: function(a) {
                if (a.is("option"))
                    return {
                        id: a.prop("value"),
                        text: a.text(),
                        element: a.get(),
                        css: a.attr("class"),
                        disabled: a.prop("disabled"),
                        locked: k(a.attr("locked"), "locked") || k(a.data("locked"), !0)
                    };
                if (a.is("optgroup"))
                    return {
                        text: a.attr("label"),
                        children: [],
                        element: a.get(),
                        css: a.attr("class")
                    }
            },
            prepareOpts: function(a) {
                var b, c, d, g = this;
                b = a.element;
                "select" === b.get(0).tagName.toLowerCase() && (this.select = c = a.element);
                c && e.each("id multiple ajax query createSearchChoice initSelection data tags".split(" "), function() {
                    if (this in a)
                        throw Error("Option '" + this + "' is not allowed for Select2 when attached to a <select> element.");
                });
                a = e.extend({}, {
                    populateResults: function(b, c, d) {
                        var f, t = this.opts.id;
                        f = function(b, c, h) {
                            var m, l, k, j, n, p, r, b = a.sortResults(b, c, d);
                            m = 0;
                            for (l = b.length; m < l; m = m + 1) {
                                k = b[m];
                                n = k.disabled === true;
                                j = !n && t(k) !== void 0;
                                p = k.children && k.children.length > 0;
                                r = e("<li></li>");
                                r.addClass("select2-results-dept-" + h);
                                r.addClass("select2-result");
                                r.addClass(j ? "select2-result-selectable" : "select2-result-unselectable");
                                n && r.addClass("select2-disabled");
                                p && r.addClass("select2-result-with-children");
                                r.addClass(g.opts.formatResultCssClass(k));
                                j = e(document.createElement("div"));
                                j.addClass("select2-result-label");
                                n = a.formatResult(k, j, d, g.opts.escapeMarkup);
                                n !== void 0 && j.html(n);
                                r.append(j);
                                if (p) {
                                    p = e("<ul></ul>");
                                    p.addClass("select2-result-sub");
                                    f(k.children, p, h + 1);
                                    r.append(p)
                                }
                                r.data("select2-data", k);
                                c.append(r)
                            }
                        }
                        ;
                        f(c, b, 0)
                    }
                }, e.fn.select2.defaults, a);
                "function" !== typeof a.id && (d = a.id,
                a.id = function(a) {
                    return a[d]
                }
                );
                if (e.isArray(a.element.data("select2Tags"))) {
                    if ("tags"in a)
                        throw "tags specified as both an attribute 'data-select2-tags' and in options of Select2 " + a.element.attr("id");
                    a.tags = a.element.data("select2Tags")
                }
                if (c)
                    a.query = this.bind(function(a) {
                        var c = {
                            results: [],
                            more: false
                        }, d = a.term, e, f, q;
                        q = function(b, c) {
                            var e;
                            if (b.is("option"))
                                a.matcher(d, b.text(), b) && c.push(g.optionToData(b));
                            else if (b.is("optgroup")) {
                                e = g.optionToData(b);
                                b.children().each2(function(a, b) {
                                    q(b, e.children)
                                });
                                e.children.length > 0 && c.push(e)
                            }
                        }
                        ;
                        e = b.children();
                        if (this.getPlaceholder() !== void 0 && e.length > 0)
                            (f = this.getPlaceholderOption()) && (e = e.not(f));
                        e.each2(function(a, b) {
                            q(b, c.results)
                        });
                        a.callback(c)
                    }),
                    a.id = function(a) {
                        return a.id
                    }
                    ,
                    a.formatResultCssClass = function(a) {
                        return a.css
                    }
                    ;
                else if (!("query"in a))
                    if ("ajax"in a) {
                        if ((c = a.element.data("ajax-url")) && 0 < c.length)
                            a.ajax.url = c;
                        a.query = I.call(a.element, a.ajax)
                    } else if ("data"in a)
                        a.query = J(a.data);
                    else if ("tags"in a && (a.query = K(a.tags),
                    void 0 === a.createSearchChoice && (a.createSearchChoice = function(a) {
                        return {
                            id: e.trim(a),
                            text: e.trim(a)
                        }
                    }
                    ),
                    void 0 === a.initSelection))
                        a.initSelection = function(b, c) {
                            var d = [];
                            e(w(b.val(), a.separator)).each(function() {
                                var b = {
                                    id: this,
                                    text: this
                                }
                                  , c = a.tags;
                                e.isFunction(c) && (c = c());
                                e(c).each(function() {
                                    if (k(this.id, b.id)) {
                                        b = this;
                                        return false
                                    }
                                });
                                d.push(b)
                            });
                            c(d)
                        }
                        ;
                if ("function" !== typeof a.query)
                    throw "query function not defined for Select2 " + a.element.attr("id");
                return a
            },
            monitorSource: function() {
                var a = this.opts.element, b, c;
                a.on("change.select2", this.bind(function() {
                    !0 !== this.opts.element.data("select2-change-triggered") && this.initSelection()
                }));
                b = this.bind(function() {
                    var b = a.prop("disabled");
                    void 0 === b && (b = !1);
                    this.enable(!b);
                    b = a.prop("readonly");
                    void 0 === b && (b = !1);
                    this.readonly(b);
                    y(this.container, this.opts.element, this.opts.adaptContainerCssClass);
                    this.container.addClass(p(this.opts.containerCssClass));
                    y(this.dropdown, this.opts.element, this.opts.adaptDropdownCssClass);
                    this.dropdown.addClass(p(this.opts.dropdownCssClass))
                });
                a.on("propertychange.select2", b);
                void 0 === this.mutationCallback && (this.mutationCallback = function(a) {
                    a.forEach(b)
                }
                );
                c = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;
                void 0 !== c && (this.propertyObserver && (delete this.propertyObserver,
                this.propertyObserver = null),
                this.propertyObserver = new c(this.mutationCallback),
                this.propertyObserver.observe(a.get(0), {
                    attributes: !0,
                    subtree: !1
                }))
            },
            triggerSelect: function(a) {
                a = e.Event("select2-selecting", {
                    val: this.id(a),
                    object: a
                });
                this.opts.element.trigger(a);
                return !a.isDefaultPrevented()
            },
            triggerChange: function(a) {
                a = a || {};
                a = e.extend({}, a, {
                    type: "change",
                    val: this.val()
                });
                this.opts.element.data("select2-change-triggered", !0);
                this.opts.element.trigger(a);
                this.opts.element.data("select2-change-triggered", !1);
                this.opts.element.click();
                this.opts.blurOnChange && this.opts.element.blur()
            },
            isInterfaceEnabled: function() {
                return !0 === this.enabledInterface
            },
            enableInterface: function() {
                var a = this._enabled && !this._readonly;
                if (a === this.enabledInterface)
                    return !1;
                this.container.toggleClass("select2-container-disabled", !a);
                this.close();
                this.enabledInterface = a;
                return !0
            },
            enable: function(a) {
                void 0 === a && (a = !0);
                this._enabled !== a && (this._enabled = a,
                this.opts.element.prop("disabled", !a),
                this.enableInterface())
            },
            disable: function() {
                this.enable(!1)
            },
            readonly: function(a) {
                void 0 === a && (a = !1);
                if (this._readonly === a)
                    return !1;
                this._readonly = a;
                this.opts.element.prop("readonly", a);
                this.enableInterface();
                return !0
            },
            opened: function() {
                return this.container.hasClass("select2-dropdown-open")
            },
            positionDropdown: function() {
                var a = this.dropdown, b = this.container.offset(), c = this.container.outerHeight(!1), d = this.container.outerWidth(!1), g = a.outerHeight(!1), h = e(window), f = h.width(), i = h.height(), o = h.scrollLeft() + f, k = h.scrollTop() + i, c = b.top + c, q = b.left, k = c + g <= k, l = b.top - g >= this.body().scrollTop(), j = a.outerWidth(!1), n = q + j <= o, s;
                a.hasClass("select2-drop-above") ? (g = !0,
                !l && k && (s = !0,
                g = !1)) : (g = !1,
                !k && l && (g = s = !0));
                s && (a.hide(),
                b = this.container.offset(),
                c = this.container.outerHeight(!1),
                d = this.container.outerWidth(!1),
                a.outerHeight(!1),
                o = h.scrollLeft() + f,
                h.scrollTop(),
                c = b.top + c,
                q = b.left,
                j = a.outerWidth(!1),
                n = q + j <= o,
                a.show());
                this.opts.dropdownAutoWidth ? (h = e(".select2-results", a)[0],
                a.addClass("select2-drop-auto-width"),
                a.css("width", ""),
                j = a.outerWidth(!1) + (h.scrollHeight === h.clientHeight ? 0 : D.width),
                j > d ? d = j : j = d,
                n = q + j <= o) : this.container.removeClass("select2-drop-auto-width");
                "static" !== this.body().css("position") && (o = this.body().offset(),
                c -= o.top,
                q -= o.left);
                n || (q = b.left + d - j);
                d = {
                    left: q,
                    width: d
                };
                g ? (d.bottom = i - b.top,
                d.top = "auto",
                this.container.addClass("select2-drop-above"),
                a.addClass("select2-drop-above")) : (d.top = c,
                d.bottom = "auto",
                this.container.removeClass("select2-drop-above"),
                a.removeClass("select2-drop-above"));
                d = e.extend(d, p(this.opts.dropdownCss));
                a.css(d)
            },
            shouldOpen: function() {
                var a;
                if (this.opened() || !1 === this._enabled || !0 === this._readonly)
                    return !1;
                a = e.Event("select2-opening");
                this.opts.element.trigger(a);
                return !a.isDefaultPrevented()
            },
            clearDropdownAlignmentPreference: function() {
                this.container.removeClass("select2-drop-above");
                this.dropdown.removeClass("select2-drop-above")
            },
            open: function() {
                if (!this.shouldOpen())
                    return !1;
                this.opening();
                return !0
            },
            opening: function() {
                var a = this.containerId
                  , b = "scroll." + a
                  , c = "resize." + a
                  , d = "orientationchange." + a;
                this.container.addClass("select2-dropdown-open").addClass("select2-container-active");
                this.clearDropdownAlignmentPreference();
                this.dropdown[0] !== this.body().children().last()[0] && this.dropdown.detach().appendTo(this.body());
                a = e("#select2-drop-mask");
                0 == a.length && (a = e(document.createElement("div")),
                a.attr("id", "select2-drop-mask").attr("class", "select2-drop-mask"),
                a.hide(),
                a.appendTo(this.body()),
                a.on("mousedown touchstart click", function(a) {
                    var b = e("#select2-drop");
                    0 < b.length && (b = b.data("select2"),
                    b.opts.selectOnBlur && b.selectHighlighted({
                        noFocus: !0
                    }),
                    b.close({
                        focus: !0
                    }),
                    a.preventDefault(),
                    a.stopPropagation())
                }));
                this.dropdown.prev()[0] !== a[0] && this.dropdown.before(a);
                e("#select2-drop").removeAttr("id");
                this.dropdown.attr("id", "select2-drop");
                a.show();
                this.positionDropdown();
                this.dropdown.show();
                this.positionDropdown();
                this.dropdown.addClass("select2-drop-active");
                var g = this;
                this.container.parents().add(window).each(function() {
                    e(this).on(c + " " + b + " " + d, function() {
                        g.positionDropdown()
                    })
                })
            },
            close: function() {
                if (this.opened()) {
                    var a = this.containerId
                      , b = "scroll." + a
                      , c = "resize." + a
                      , d = "orientationchange." + a;
                    this.container.parents().add(window).each(function() {
                        e(this).off(b).off(c).off(d)
                    });
                    this.clearDropdownAlignmentPreference();
                    e("#select2-drop-mask").hide();
                    this.dropdown.removeAttr("id");
                    this.dropdown.hide();
                    this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active");
                    this.results.empty();
                    this.clearSearch();
                    this.search.removeClass("select2-active");
                    this.opts.element.trigger(e.Event("select2-close"))
                }
            },
            externalSearch: function(a) {
                this.open();
                this.search.val(a);
                this.updateResults(!1)
            },
            clearSearch: function() {},
            getMaximumSelectionSize: function() {
                return p(this.opts.maximumSelectionSize)
            },
            ensureHighlightVisible: function() {
                var a = this.results, b, c, d, g;
                c = this.highlight();
                0 > c || (0 == c ? a.scrollTop(0) : (b = this.findHighlightableChoices().find(".select2-result-label"),
                d = e(b[c]),
                g = d.offset().top + d.outerHeight(!0),
                c === b.length - 1 && (b = a.find("li.select2-more-results"),
                0 < b.length && (g = b.offset().top + b.outerHeight(!0))),
                b = a.offset().top + a.outerHeight(!0),
                g > b && a.scrollTop(a.scrollTop() + (g - b)),
                g = d.offset().top - a.offset().top,
                0 > g && "none" != d.css("display") && a.scrollTop(a.scrollTop() + g)))
            },
            findHighlightableChoices: function() {
                return this.results.find(".select2-result-selectable:not(.select2-disabled, .select2-selected)")
            },
            moveHighlight: function(a) {
                for (var b = this.findHighlightableChoices(), c = this.highlight(); -1 < c && c < b.length; ) {
                    var c = c + a
                      , d = e(b[c]);
                    if (d.hasClass("select2-result-selectable") && !d.hasClass("select2-disabled") && !d.hasClass("select2-selected")) {
                        this.highlight(c);
                        break
                    }
                }
            },
            highlight: function(a) {
                var b = this.findHighlightableChoices();
                if (0 === arguments.length)
                    return j(b.filter(".select2-highlighted")[0], b.get());
                a >= b.length && (a = b.length - 1);
                0 > a && (a = 0);
                this.removeHighlight();
                b = e(b[a]);
                b.addClass("select2-highlighted");
                this.ensureHighlightVisible();
                (b = b.data("select2-data")) && this.opts.element.trigger({
                    type: "select2-highlight",
                    val: this.id(b),
                    choice: b
                })
            },
            removeHighlight: function() {
                this.results.find(".select2-highlighted").removeClass("select2-highlighted")
            },
            countSelectableResults: function() {
                return this.findHighlightableChoices().length
            },
            highlightUnderEvent: function(a) {
                a = e(a.target).closest(".select2-result-selectable");
                if (0 < a.length && !a.is(".select2-highlighted")) {
                    var b = this.findHighlightableChoices();
                    this.highlight(b.index(a))
                } else
                    0 == a.length && this.removeHighlight()
            },
            loadMoreIfNeeded: function() {
                var a = this.results, b = a.find("li.select2-more-results"), c, d = this.resultsPage + 1, e = this, h = this.search.val(), f = this.context;
                0 !== b.length && (c = b.offset().top - a.offset().top - a.height(),
                c <= this.opts.loadMorePadding && (b.addClass("select2-active"),
                this.opts.query({
                    element: this.opts.element,
                    term: h,
                    page: d,
                    context: f,
                    matcher: this.opts.matcher,
                    callback: this.bind(function(c) {
                        e.opened() && (e.opts.populateResults.call(this, a, c.results, {
                            term: h,
                            page: d,
                            context: f
                        }),
                        e.postprocessResults(c, !1, !1),
                        !0 === c.more ? (b.detach().appendTo(a).text(e.opts.formatLoadMore(d + 1)),
                        window.setTimeout(function() {
                            e.loadMoreIfNeeded()
                        }, 10)) : b.remove(),
                        e.positionDropdown(),
                        e.resultsPage = d,
                        e.context = c.context,
                        this.opts.element.trigger({
                            type: "select2-loaded",
                            items: c
                        }))
                    })
                })))
            },
            tokenize: function() {},
            updateResults: function(a) {
                function b() {
                    d.removeClass("select2-active");
                    i.positionDropdown()
                }
                function c(a) {
                    g.html(a);
                    b()
                }
                var d = this.search, g = this.results, h = this.opts, f, i = this;
                f = d.val();
                var o = e.data(this.container, "select2-last-term"), j;
                if (!(!0 !== a && o && k(f, o)) && (e.data(this.container, "select2-last-term", f),
                !(!0 !== a && (!1 === this.showSearchInput || !this.opened())))) {
                    j = ++this.queryCount;
                    o = this.getMaximumSelectionSize();
                    if (1 <= o && (f = this.data(),
                    e.isArray(f) && f.length >= o && s(h.formatSelectionTooBig, "formatSelectionTooBig"))) {
                        c("<li class='select2-selection-limit'>" + h.formatSelectionTooBig(o) + "</li>");
                        return
                    }
                    d.val().length < h.minimumInputLength ? (s(h.formatInputTooShort, "formatInputTooShort") ? c("<li class='select2-no-results'>" + h.formatInputTooShort(d.val(), h.minimumInputLength) + "</li>") : c(""),
                    a && this.showSearch && this.showSearch(!0)) : h.maximumInputLength && d.val().length > h.maximumInputLength ? s(h.formatInputTooLong, "formatInputTooLong") ? c("<li class='select2-no-results'>" + h.formatInputTooLong(d.val(), h.maximumInputLength) + "</li>") : c("") : (h.formatSearching && 0 === this.findHighlightableChoices().length && c("<li class='select2-searching'>" + h.formatSearching() + "</li>"),
                    d.addClass("select2-active"),
                    this.removeHighlight(),
                    f = this.tokenize(),
                    void 0 != f && null != f && d.val(f),
                    this.resultsPage = 1,
                    h.query({
                        element: h.element,
                        term: d.val(),
                        page: this.resultsPage,
                        context: null,
                        matcher: h.matcher,
                        callback: this.bind(function(f) {
                            var m;
                            j == this.queryCount && (this.opened() ? (this.context = void 0 === f.context ? null : f.context,
                            this.opts.createSearchChoice && "" !== d.val() && (m = this.opts.createSearchChoice.call(i, d.val(), f.results),
                            void 0 !== m && null !== m && void 0 !== i.id(m) && null !== i.id(m) && 0 === e(f.results).filter(function() {
                                return k(i.id(this), i.id(m))
                            }).length && f.results.unshift(m)),
                            0 === f.results.length && s(h.formatNoMatches, "formatNoMatches")) ? c("<li class='select2-no-results'>" + h.formatNoMatches(d.val()) + "</li>") : (g.empty(),
                            i.opts.populateResults.call(this, g, f.results, {
                                term: d.val(),
                                page: this.resultsPage,
                                context: null
                            }),
                            !0 === f.more && s(h.formatLoadMore, "formatLoadMore") && (g.append("<li class='select2-more-results'>" + i.opts.escapeMarkup(h.formatLoadMore(this.resultsPage)) + "</li>"),
                            window.setTimeout(function() {
                                i.loadMoreIfNeeded()
                            }, 10)),
                            this.postprocessResults(f, a),
                            b(),
                            this.opts.element.trigger({
                                type: "select2-loaded",
                                items: f
                            })) : this.search.removeClass("select2-active"))
                        })
                    }))
                }
            },
            cancel: function() {
                this.close()
            },
            blur: function() {
                this.opts.selectOnBlur && this.selectHighlighted({
                    noFocus: !0
                });
                this.close();
                this.container.removeClass("select2-container-active");
                this.search[0] === document.activeElement && this.search.blur();
                this.clearSearch();
                this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")
            },
            focusSearch: function() {
                var a = this.search;
                a[0] !== document.activeElement && window.setTimeout(function() {
                    var b = a[0]
                      , c = a.val().length;
                    a.focus();
                    a.is(":visible") && b === document.activeElement && (b.setSelectionRange ? b.setSelectionRange(c, c) : b.createTextRange && (b = b.createTextRange(),
                    b.collapse(!1),
                    b.select()))
                }, 0)
            },
            selectHighlighted: function(a) {
                var b = this.highlight()
                  , c = this.results.find(".select2-highlighted").closest(".select2-result").data("select2-data");
                c ? (this.highlight(b),
                this.onSelect(c, a)) : a && a.noFocus && this.close()
            },
            getPlaceholder: function() {
                var a;
                return this.opts.element.attr("placeholder") || this.opts.element.attr("data-placeholder") || this.opts.element.data("placeholder") || this.opts.placeholder || (void 0 !== (a = this.getPlaceholderOption()) ? a.text() : void 0)
            },
            getPlaceholderOption: function() {
                if (this.select) {
                    var a = this.select.children("option").first();
                    if (void 0 !== this.opts.placeholderOption)
                        return "first" === this.opts.placeholderOption && a || "function" === typeof this.opts.placeholderOption && this.opts.placeholderOption(this.select);
                    if ("" === a.text() && "" === a.val())
                        return a
                }
            },
            initContainerWidth: function() {
                var a = function() {
                    var a, c, d, g;
                    if ("off" === this.opts.width)
                        return null;
                    if ("element" === this.opts.width)
                        return 0 === this.opts.element.outerWidth(!1) ? "auto" : this.opts.element.outerWidth(!1) + "px";
                    if ("copy" === this.opts.width || "resolve" === this.opts.width) {
                        a = this.opts.element.attr("style");
                        if (void 0 !== a) {
                            a = a.split(";");
                            d = 0;
                            for (g = a.length; d < g; d += 1)
                                if (c = a[d].replace(/\s/g, ""),
                                c = c.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),
                                null !== c && 1 <= c.length)
                                    return c[1]
                        }
                        return "resolve" === this.opts.width ? (a = this.opts.element.css("width"),
                        0 < a.indexOf("%") ? a : 0 === this.opts.element.outerWidth(!1) ? "auto" : this.opts.element.outerWidth(!1) + "px") : null
                    }
                    return e.isFunction(this.opts.width) ? this.opts.width() : this.opts.width
                }
                .call(this);
                null !== a && this.container.css("width", a)
            }
        });
        B = A(u, {
            createContainer: function() {
                return e(document.createElement("div")).attr({
                    "class": "select2-container"
                }).html("<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>   <span class='select2-arrow'><b></b></span></a><input class='select2-focusser select2-offscreen' type='text'/><div class='select2-drop select2-display-none'>   <div class='select2-search'>       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>   </div>   <ul class='select2-results'>   </ul></div>")
            },
            enableInterface: function() {
                this.parent.enableInterface.apply(this, arguments) && this.focusser.prop("disabled", !this.isInterfaceEnabled())
            },
            opening: function() {
                var a, b;
                0 <= this.opts.minimumResultsForSearch && this.showSearch(!0);
                this.parent.opening.apply(this, arguments);
                !1 !== this.showSearchInput && this.search.val(this.focusser.val());
                this.search.focus();
                a = this.search.get(0);
                a.createTextRange ? (a = a.createTextRange(),
                a.collapse(!1),
                a.select()) : a.setSelectionRange && (b = this.search.val().length,
                a.setSelectionRange(b, b));
                "" === this.search.val() && void 0 != this.nextSearchTerm && (this.search.val(this.nextSearchTerm),
                this.search.select());
                this.focusser.prop("disabled", !0).val("");
                this.updateResults(!0);
                this.opts.element.trigger(e.Event("select2-open"))
            },
            close: function(a) {
                this.opened() && (this.parent.close.apply(this, arguments),
                a = a || {
                    focus: !0
                },
                this.focusser.removeAttr("disabled"),
                a.focus && this.focusser.focus())
            },
            focus: function() {
                this.opened() ? this.close() : (this.focusser.removeAttr("disabled"),
                this.focusser.focus())
            },
            isFocused: function() {
                return this.container.hasClass("select2-container-active")
            },
            cancel: function() {
                this.parent.cancel.apply(this, arguments);
                this.focusser.removeAttr("disabled");
                this.focusser.focus()
            },
            destroy: function() {
                e("label[for='" + this.focusser.attr("id") + "']").attr("for", this.opts.element.attr("id"));
                this.parent.destroy.apply(this, arguments)
            },
            initContainer: function() {
                var a, b = this.container, c = this.dropdown;
                0 > this.opts.minimumResultsForSearch ? this.showSearch(!1) : this.showSearch(!0);
                this.selection = a = b.find(".select2-choice");
                this.focusser = b.find(".select2-focusser");
                this.focusser.attr("id", "s2id_autogen" + z());
                e("label[for='" + this.opts.element.attr("id") + "']").attr("for", this.focusser.attr("id"));
                this.focusser.attr("tabindex", this.elementTabIndex);
                this.search.on("keydown", this.bind(function(a) {
                    if (this.isInterfaceEnabled())
                        if (a.which === f.PAGE_UP || a.which === f.PAGE_DOWN)
                            l(a);
                        else
                            switch (a.which) {
                            case f.UP:
                            case f.DOWN:
                                this.moveHighlight(a.which === f.UP ? -1 : 1);
                                l(a);
                                break;
                            case f.ENTER:
                                this.selectHighlighted();
                                l(a);
                                break;
                            case f.TAB:
                                this.selectHighlighted({
                                    noFocus: !0
                                });
                                break;
                            case f.ESC:
                                this.cancel(a),
                                l(a)
                            }
                }));
                this.search.on("blur", this.bind(function() {
                    document.activeElement === this.body().get(0) && window.setTimeout(this.bind(function() {
                        this.search.focus()
                    }), 0)
                }));
                this.focusser.on("keydown", this.bind(function(a) {
                    if (this.isInterfaceEnabled() && !(a.which === f.TAB || f.isControl(a) || f.isFunctionKey(a) || a.which === f.ESC))
                        if (!1 === this.opts.openOnEnter && a.which === f.ENTER)
                            l(a);
                        else if (a.which == f.DOWN || a.which == f.UP || a.which == f.ENTER && this.opts.openOnEnter)
                            !a.altKey && (!a.ctrlKey && !a.shiftKey && !a.metaKey) && (this.open(),
                            l(a));
                        else if (a.which == f.DELETE || a.which == f.BACKSPACE)
                            this.opts.allowClear && this.clear(),
                            l(a)
                }));
                E(this.focusser);
                this.focusser.on("keyup-change input", this.bind(function(a) {
                    0 <= this.opts.minimumResultsForSearch && (a.stopPropagation(),
                    this.opened() || this.open())
                }));
                a.on("mousedown", "abbr", this.bind(function(a) {
                    this.isInterfaceEnabled() && (this.clear(),
                    a.preventDefault(),
                    a.stopImmediatePropagation(),
                    this.close(),
                    this.selection.focus())
                }));
                a.on("mousedown", this.bind(function(a) {
                    this.container.hasClass("select2-container-active") || this.opts.element.trigger(e.Event("select2-focus"));
                    this.opened() ? this.close() : this.isInterfaceEnabled() && this.open();
                    l(a)
                }));
                c.on("mousedown", this.bind(function() {
                    this.search.focus()
                }));
                a.on("focus", this.bind(function(a) {
                    l(a)
                }));
                this.focusser.on("focus", this.bind(function() {
                    this.container.hasClass("select2-container-active") || this.opts.element.trigger(e.Event("select2-focus"));
                    this.container.addClass("select2-container-active")
                })).on("blur", this.bind(function() {
                    this.opened() || (this.container.removeClass("select2-container-active"),
                    this.opts.element.trigger(e.Event("select2-blur")))
                }));
                this.search.on("focus", this.bind(function() {
                    this.container.hasClass("select2-container-active") || this.opts.element.trigger(e.Event("select2-focus"));
                    this.container.addClass("select2-container-active")
                }));
                this.initContainerWidth();
                this.opts.element.addClass("select2-offscreen");
                this.setPlaceholder()
            },
            clear: function(a) {
                var b = this.selection.data("select2-data");
                if (b) {
                    var c = e.Event("select2-clearing");
                    this.opts.element.trigger(c);
                    c.isDefaultPrevented() || (c = this.getPlaceholderOption(),
                    this.opts.element.val(c ? c.val() : ""),
                    this.selection.find(".select2-chosen").empty(),
                    this.selection.removeData("select2-data"),
                    this.setPlaceholder(),
                    !1 !== a && (this.opts.element.trigger({
                        type: "select2-removed",
                        val: this.id(b),
                        choice: b
                    }),
                    this.triggerChange({
                        removed: b
                    })))
                }
            },
            initSelection: function() {
                if (this.isPlaceholderOptionSelected())
                    this.updateSelection(null),
                    this.close(),
                    this.setPlaceholder();
                else {
                    var a = this;
                    this.opts.initSelection.call(null, this.opts.element, function(b) {
                        void 0 !== b && null !== b && (a.updateSelection(b),
                        a.close(),
                        a.setPlaceholder())
                    })
                }
            },
            isPlaceholderOptionSelected: function() {
                var a;
                return !this.getPlaceholder() ? !1 : void 0 !== (a = this.getPlaceholderOption()) && a.prop("selected") || "" === this.opts.element.val() || void 0 === this.opts.element.val() || null === this.opts.element.val()
            },
            prepareOpts: function() {
                var a = this.parent.prepareOpts.apply(this, arguments)
                  , b = this;
                "select" === a.element.get(0).tagName.toLowerCase() ? a.initSelection = function(a, d) {
                    var e = a.find("option").filter(function() {
                        return this.selected
                    });
                    d(b.optionToData(e))
                }
                : "data"in a && (a.initSelection = a.initSelection || function(b, d) {
                    var g = b.val()
                      , f = null;
                    a.query({
                        matcher: function(b, c, d) {
                            (b = k(g, a.id(d))) && (f = d);
                            return b
                        },
                        callback: !e.isFunction(d) ? e.noop : function() {
                            d(f)
                        }
                    })
                }
                );
                return a
            },
            getPlaceholder: function() {
                return this.select && void 0 === this.getPlaceholderOption() ? void 0 : this.parent.getPlaceholder.apply(this, arguments)
            },
            setPlaceholder: function() {
                var a = this.getPlaceholder();
                this.isPlaceholderOptionSelected() && void 0 !== a && !(this.select && void 0 === this.getPlaceholderOption()) && (this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),
                this.selection.addClass("select2-default"),
                this.container.removeClass("select2-allowclear"))
            },
            postprocessResults: function(a, b, c) {
                var d = 0
                  , e = this;
                this.findHighlightableChoices().each2(function(a, b) {
                    if (k(e.id(b.data("select2-data")), e.opts.element.val()))
                        return d = a,
                        !1
                });
                !1 !== c && (!0 === b && 0 <= d ? this.highlight(d) : this.highlight(0));
                !0 === b && (b = this.opts.minimumResultsForSearch,
                0 <= b && this.showSearch(L(a.results) >= b))
            },
            showSearch: function(a) {
                this.showSearchInput !== a && (this.showSearchInput = a,
                this.dropdown.find(".select2-search").toggleClass("select2-search-hidden", !a),
                this.dropdown.find(".select2-search").toggleClass("select2-offscreen", !a),
                e(this.dropdown, this.container).toggleClass("select2-with-searchbox", a))
            },
            onSelect: function(a, b) {
                if (this.triggerSelect(a)) {
                    var c = this.opts.element.val()
                      , d = this.data();
                    this.opts.element.val(this.id(a));
                    this.updateSelection(a);
                    this.opts.element.trigger({
                        type: "select2-selected",
                        val: this.id(a),
                        choice: a
                    });
                    this.nextSearchTerm = this.opts.nextSearchTerm(a, this.search.val());
                    this.close();
                    (!b || !b.noFocus) && this.focusser.focus();
                    k(c, this.id(a)) || this.triggerChange({
                        added: a,
                        removed: d
                    })
                }
            },
            updateSelection: function(a) {
                var b = this.selection.find(".select2-chosen"), c;
                this.selection.data("select2-data", a);
                b.empty();
                null !== a && (c = this.opts.formatSelection(a, b, this.opts.escapeMarkup));
                void 0 !== c && b.append(c);
                a = this.opts.formatSelectionCssClass(a, b);
                void 0 !== a && b.addClass(a);
                this.selection.removeClass("select2-default");
                this.opts.allowClear && void 0 !== this.getPlaceholder() && this.container.addClass("select2-allowclear")
            },
            val: function() {
                var a, b = !1, c = null, d = this, e = this.data();
                if (0 === arguments.length)
                    return this.opts.element.val();
                a = arguments[0];
                1 < arguments.length && (b = arguments[1]);
                if (this.select)
                    this.select.val(a).find("option").filter(function() {
                        return this.selected
                    }).each2(function(a, b) {
                        c = d.optionToData(b);
                        return !1
                    }),
                    this.updateSelection(c),
                    this.setPlaceholder(),
                    b && this.triggerChange({
                        added: c,
                        removed: e
                    });
                else if (!a && 0 !== a)
                    this.clear(b);
                else {
                    if (void 0 === this.opts.initSelection)
                        throw Error("cannot call val() if initSelection() is not defined");
                    this.opts.element.val(a);
                    this.opts.initSelection(this.opts.element, function(a) {
                        d.opts.element.val(!a ? "" : d.id(a));
                        d.updateSelection(a);
                        d.setPlaceholder();
                        b && d.triggerChange({
                            added: a,
                            removed: e
                        })
                    })
                }
            },
            clearSearch: function() {
                this.search.val("");
                this.focusser.val("")
            },
            data: function(a) {
                var b, c = !1;
                if (0 === arguments.length)
                    return b = this.selection.data("select2-data"),
                    void 0 == b && (b = null),
                    b;
                1 < arguments.length && (c = arguments[1]);
                a ? (b = this.data(),
                this.opts.element.val(!a ? "" : this.id(a)),
                this.updateSelection(a),
                c && this.triggerChange({
                    added: a,
                    removed: b
                })) : this.clear(c)
            }
        });
        C = A(u, {
            createContainer: function() {
                return e(document.createElement("div")).attr({
                    "class": "select2-container select2-container-multi"
                }).html("<ul class='select2-choices'>  <li class='select2-search-field'>    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>  </li></ul><div class='select2-drop select2-drop-multi select2-display-none'>   <ul class='select2-results'>   </ul></div>")
            },
            prepareOpts: function() {
                var a = this.parent.prepareOpts.apply(this, arguments)
                  , b = this;
                "select" === a.element.get(0).tagName.toLowerCase() ? a.initSelection = function(a, d) {
                    var e = [];
                    a.find("option").filter(function() {
                        return this.selected
                    }).each2(function(a, c) {
                        e.push(b.optionToData(c))
                    });
                    d(e)
                }
                : "data"in a && (a.initSelection = a.initSelection || function(b, d) {
                    var f = w(b.val(), a.separator)
                      , h = [];
                    a.query({
                        matcher: function(b, c, d) {
                            (b = e.grep(f, function(b) {
                                return k(b, a.id(d))
                            }).length) && h.push(d);
                            return b
                        },
                        callback: !e.isFunction(d) ? e.noop : function() {
                            for (var b = [], c = 0; c < f.length; c++)
                                for (var e = f[c], j = 0; j < h.length; j++) {
                                    var l = h[j];
                                    if (k(e, a.id(l))) {
                                        b.push(l);
                                        h.splice(j, 1);
                                        break
                                    }
                                }
                            d(b)
                        }
                    })
                }
                );
                return a
            },
            selectChoice: function(a) {
                var b = this.container.find(".select2-search-choice-focus");
                if (!b.length || !(a && a[0] == b[0]))
                    b.length && this.opts.element.trigger("choice-deselected", b),
                    b.removeClass("select2-search-choice-focus"),
                    a && a.length && (this.close(),
                    a.addClass("select2-search-choice-focus"),
                    this.opts.element.trigger("choice-selected", a))
            },
            destroy: function() {
                e("label[for='" + this.search.attr("id") + "']").attr("for", this.opts.element.attr("id"));
                this.parent.destroy.apply(this, arguments)
            },
            initContainer: function() {
                var a;
                this.searchContainer = this.container.find(".select2-search-field");
                this.selection = a = this.container.find(".select2-choices");
                var b = this;
                this.selection.on("click", ".select2-search-choice:not(.select2-locked)", function() {
                    b.search[0].focus();
                    b.selectChoice(e(this))
                });
                this.search.attr("id", "s2id_autogen" + z());
                e("label[for='" + this.opts.element.attr("id") + "']").attr("for", this.search.attr("id"));
                this.search.on("input paste", this.bind(function() {
                    this.isInterfaceEnabled() && (this.opened() || this.open())
                }));
                this.search.attr("tabindex", this.elementTabIndex);
                this.keydowns = 0;
                this.search.on("keydown", this.bind(function(b) {
                    var d, g;
                    if (this.isInterfaceEnabled()) {
                        ++this.keydowns;
                        var h = a.find(".select2-search-choice-focus")
                          , j = h.prev(".select2-search-choice:not(.select2-locked)")
                          , i = h.next(".select2-search-choice:not(.select2-locked)");
                        d = this.search;
                        d = e(d)[0];
                        var k = 0;
                        g = 0;
                        "selectionStart"in d ? (k = d.selectionStart,
                        g = d.selectionEnd - k) : "selection"in document && (d.focus(),
                        k = document.selection.createRange(),
                        g = document.selection.createRange().text.length,
                        k.moveStart("character", -d.value.length),
                        k = k.text.length - g);
                        d = k;
                        if (h.length && (b.which == f.LEFT || b.which == f.RIGHT || b.which == f.BACKSPACE || b.which == f.DELETE || b.which == f.ENTER))
                            g = h,
                            b.which == f.LEFT && j.length ? g = j : b.which == f.RIGHT ? g = i.length ? i : null : b.which === f.BACKSPACE ? (this.unselect(h.first()),
                            this.search.width(10),
                            g = j.length ? j : i) : b.which == f.DELETE ? (this.unselect(h.first()),
                            this.search.width(10),
                            g = i.length ? i : null) : b.which == f.ENTER && (g = null),
                            this.selectChoice(g),
                            l(b),
                            (!g || !g.length) && this.open();
                        else if ((b.which === f.BACKSPACE && 1 == this.keydowns || b.which == f.LEFT) && 0 == d && !g)
                            this.selectChoice(a.find(".select2-search-choice:not(.select2-locked)").last()),
                            l(b);
                        else {
                            this.selectChoice(null);
                            if (this.opened())
                                switch (b.which) {
                                case f.UP:
                                case f.DOWN:
                                    this.moveHighlight(b.which === f.UP ? -1 : 1);
                                    l(b);
                                    return;
                                case f.ENTER:
                                    this.selectHighlighted();
                                    l(b);
                                    return;
                                case f.TAB:
                                    this.selectHighlighted({
                                        noFocus: !0
                                    });
                                    this.close();
                                    return;
                                case f.ESC:
                                    this.cancel(b);
                                    l(b);
                                    return
                                }
                            b.which === f.TAB || f.isControl(b) || f.isFunctionKey(b) || b.which === f.BACKSPACE || b.which === f.ESC || b.which === f.ENTER && (!1 === this.opts.openOnEnter || b.altKey || b.ctrlKey || b.shiftKey || b.metaKey) || (this.open(),
                            (b.which === f.PAGE_UP || b.which === f.PAGE_DOWN) && l(b),
                            b.which === f.ENTER && l(b))
                        }
                    }
                }));
                this.search.on("keyup", this.bind(function() {
                    this.keydowns = 0;
                    this.resizeSearch()
                }));
                this.search.on("blur", this.bind(function(a) {
                    this.container.removeClass("select2-container-active");
                    this.search.removeClass("select2-focused");
                    this.selectChoice(null);
                    this.opened() || this.clearSearch();
                    a.stopImmediatePropagation();
                    this.opts.element.trigger(e.Event("select2-blur"))
                }));
                this.container.on("click", ".select2-choices", this.bind(function(a) {
                    this.isInterfaceEnabled() && !(0 < e(a.target).closest(".select2-search-choice").length) && (this.selectChoice(null),
                    this.clearPlaceholder(),
                    this.container.hasClass("select2-container-active") || this.opts.element.trigger(e.Event("select2-focus")),
                    this.open(),
                    this.focusSearch(),
                    a.preventDefault())
                }));
                this.container.on("focus", ".select2-choices", this.bind(function() {
                    this.isInterfaceEnabled() && (this.container.hasClass("select2-container-active") || this.opts.element.trigger(e.Event("select2-focus")),
                    this.container.addClass("select2-container-active"),
                    this.dropdown.addClass("select2-drop-active"),
                    this.clearPlaceholder())
                }));
                this.initContainerWidth();
                this.opts.element.addClass("select2-offscreen");
                this.clearSearch()
            },
            enableInterface: function() {
                this.parent.enableInterface.apply(this, arguments) && this.search.prop("disabled", !this.isInterfaceEnabled())
            },
            initSelection: function() {
                "" === this.opts.element.val() && "" === this.opts.element.text() && (this.updateSelection([]),
                this.close(),
                this.clearSearch());
                if (this.select || "" !== this.opts.element.val()) {
                    var a = this;
                    this.opts.initSelection.call(null, this.opts.element, function(b) {
                        if (b !== void 0 && b !== null) {
                            a.updateSelection(b);
                            a.close();
                            a.clearSearch()
                        }
                    })
                }
            },
            clearSearch: function() {
                var a = this.getPlaceholder()
                  , b = this.getMaxSearchWidth();
                void 0 !== a && 0 === this.getVal().length && !1 === this.search.hasClass("select2-focused") ? (this.search.val(a).addClass("select2-default"),
                this.search.width(0 < b ? b : this.container.css("width"))) : this.search.val("").width(10)
            },
            clearPlaceholder: function() {
                this.search.hasClass("select2-default") && this.search.val("").removeClass("select2-default")
            },
            opening: function() {
                this.clearPlaceholder();
                this.resizeSearch();
                this.parent.opening.apply(this, arguments);
                this.focusSearch();
                this.updateResults(!0);
                this.search.focus();
                this.opts.element.trigger(e.Event("select2-open"))
            },
            close: function() {
                this.opened() && this.parent.close.apply(this, arguments)
            },
            focus: function() {
                this.close();
                this.search.focus()
            },
            isFocused: function() {
                return this.search.hasClass("select2-focused")
            },
            updateSelection: function(a) {
                var b = []
                  , c = []
                  , d = this;
                e(a).each(function() {
                    0 > j(d.id(this), b) && (b.push(d.id(this)),
                    c.push(this))
                });
                a = c;
                this.selection.find(".select2-search-choice").remove();
                e(a).each(function() {
                    d.addSelectedChoice(this)
                });
                d.postprocessResults()
            },
            tokenize: function() {
                var a = this.search.val()
                  , a = this.opts.tokenizer.call(this, a, this.data(), this.bind(this.onSelect), this.opts);
                null != a && void 0 != a && (this.search.val(a),
                0 < a.length && this.open())
            },
            onSelect: function(a, b) {
                this.triggerSelect(a) && (this.addSelectedChoice(a),
                this.opts.element.trigger({
                    type: "selected",
                    val: this.id(a),
                    choice: a
                }),
                (this.select || !this.opts.closeOnSelect) && this.postprocessResults(a, !1, !0 === this.opts.closeOnSelect),
                this.opts.closeOnSelect ? (this.close(),
                this.search.width(10)) : 0 < this.countSelectableResults() ? (this.search.width(10),
                this.resizeSearch(),
                0 < this.getMaximumSelectionSize() && this.val().length >= this.getMaximumSelectionSize() && this.updateResults(!0),
                this.positionDropdown()) : (this.close(),
                this.search.width(10)),
                this.triggerChange({
                    added: a
                }),
                (!b || !b.noFocus) && this.focusSearch())
            },
            cancel: function() {
                this.close();
                this.focusSearch()
            },
            addSelectedChoice: function(a) {
                var b = !a.locked, c = e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"), d = e("<li class='select2-search-choice select2-locked'><div></div></li>"), c = b ? c : d, d = this.id(a), f = this.getVal(), h;
                h = this.opts.formatSelection(a, c.find("div"), this.opts.escapeMarkup);
                void 0 != h && c.find("div").replaceWith("<div>" + h + "</div>");
                h = this.opts.formatSelectionCssClass(a, c.find("div"));
                void 0 != h && c.addClass(h);
                if (b)
                    c.find(".select2-search-choice-close").on("mousedown", l).on("click dblclick", this.bind(function(a) {
                        this.isInterfaceEnabled() && (e(a.target).closest(".select2-search-choice").fadeOut("fast", this.bind(function() {
                            this.unselect(e(a.target));
                            this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");
                            this.close();
                            this.focusSearch()
                        })).dequeue(),
                        l(a))
                    })).on("focus", this.bind(function() {
                        this.isInterfaceEnabled() && (this.container.addClass("select2-container-active"),
                        this.dropdown.addClass("select2-drop-active"))
                    }));
                c.data("select2-data", a);
                c.insertBefore(this.searchContainer);
                f.push(d);
                this.setVal(f)
            },
            unselect: function(a) {
                var b = this.getVal(), c, d, a = a.closest(".select2-search-choice");
                if (0 === a.length)
                    throw "Invalid argument: " + a + ". Must be .select2-search-choice";
                if (c = a.data("select2-data")) {
                    for (; 0 <= (d = j(this.id(c), b)); )
                        b.splice(d, 1),
                        this.setVal(b),
                        this.select && this.postprocessResults();
                    b = e.Event("select2-removing");
                    b.val = this.id(c);
                    b.choice = c;
                    this.opts.element.trigger(b);
                    b.isDefaultPrevented() || (a.remove(),
                    this.opts.element.trigger({
                        type: "select2-removed",
                        val: this.id(c),
                        choice: c
                    }),
                    this.triggerChange({
                        removed: c
                    }))
                }
            },
            postprocessResults: function(a, b, c) {
                var d = this.getVal()
                  , b = this.results.find(".select2-result")
                  , e = this.results.find(".select2-result-with-children")
                  , f = this;
                b.each2(function(a, b) {
                    var c = f.id(b.data("select2-data"));
                    0 <= j(c, d) && (b.addClass("select2-selected"),
                    b.find(".select2-result-selectable").addClass("select2-selected"))
                });
                e.each2(function(a, b) {
                    !b.is(".select2-result-selectable") && 0 === b.find(".select2-result-selectable:not(.select2-selected)").length && b.addClass("select2-selected")
                });
                -1 == this.highlight() && !1 !== c && f.highlight(0);
                !this.opts.createSearchChoice && 0 < !b.filter(".select2-result:not(.select2-selected)").length && (!a || a && !a.more && 0 === this.results.find(".select2-no-results").length) && s(f.opts.formatNoMatches, "formatNoMatches") && this.results.append("<li class='select2-no-results'>" + f.opts.formatNoMatches(f.search.val()) + "</li>")
            },
            getMaxSearchWidth: function() {
                return this.selection.width() - (this.search.outerWidth(!1) - this.search.width())
            },
            resizeSearch: function() {
                var a, b, c, d, f = this.search.outerWidth(!1) - this.search.width();
                a = this.search;
                v || (c = a[0].currentStyle || window.getComputedStyle(a[0], null),
                v = e(document.createElement("div")).css({
                    position: "absolute",
                    left: "-10000px",
                    top: "-10000px",
                    display: "none",
                    fontSize: c.fontSize,
                    fontFamily: c.fontFamily,
                    fontStyle: c.fontStyle,
                    fontWeight: c.fontWeight,
                    letterSpacing: c.letterSpacing,
                    textTransform: c.textTransform,
                    whiteSpace: "nowrap"
                }),
                v.attr("class", "select2-sizer"),
                e("body").append(v));
                v.text(a.val());
                a = v.width() + 10;
                b = this.search.offset().left;
                c = this.selection.width();
                d = this.selection.offset().left;
                b = c - (b - d) - f;
                b < a && (b = c - f);
                40 > b && (b = c - f);
                0 >= b && (b = a);
                this.search.width(Math.floor(b))
            },
            getVal: function() {
                var a;
                if (this.select)
                    return a = this.select.val(),
                    null === a ? [] : a;
                a = this.opts.element.val();
                return w(a, this.opts.separator)
            },
            setVal: function(a) {
                var b;
                this.select ? this.select.val(a) : (b = [],
                e(a).each(function() {
                    0 > j(this, b) && b.push(this)
                }),
                this.opts.element.val(0 === b.length ? "" : b.join(this.opts.separator)))
            },
            buildChangeDetails: function(a, b) {
                for (var b = b.slice(0), a = a.slice(0), c = 0; c < b.length; c++)
                    for (var d = 0; d < a.length; d++)
                        k(this.opts.id(b[c]), this.opts.id(a[d])) && (b.splice(c, 1),
                        0 < c && c--,
                        a.splice(d, 1),
                        d--);
                return {
                    added: b,
                    removed: a
                }
            },
            val: function(a, b) {
                var c, d = this;
                if (0 === arguments.length)
                    return this.getVal();
                c = this.data();
                c.length || (c = []);
                if (!a && 0 !== a)
                    this.opts.element.val(""),
                    this.updateSelection([]),
                    this.clearSearch(),
                    b && this.triggerChange({
                        added: this.data(),
                        removed: c
                    });
                else {
                    this.setVal(a);
                    if (this.select)
                        this.opts.initSelection(this.select, this.bind(this.updateSelection)),
                        b && this.triggerChange(this.buildChangeDetails(c, this.data()));
                    else {
                        if (void 0 === this.opts.initSelection)
                            throw Error("val() cannot be called if initSelection() is not defined");
                        this.opts.initSelection(this.opts.element, function(a) {
                            var f = e.map(a, d.id);
                            d.setVal(f);
                            d.updateSelection(a);
                            d.clearSearch();
                            b && d.triggerChange(d.buildChangeDetails(c, d.data()))
                        })
                    }
                    this.clearSearch()
                }
            },
            onSortStart: function() {
                if (this.select)
                    throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");
                this.search.width(0);
                this.searchContainer.hide()
            },
            onSortEnd: function() {
                var a = []
                  , b = this;
                this.searchContainer.show();
                this.searchContainer.appendTo(this.searchContainer.parent());
                this.resizeSearch();
                this.selection.find(".select2-search-choice").each(function() {
                    a.push(b.opts.id(e(this).data("select2-data")))
                });
                this.setVal(a);
                this.triggerChange()
            },
            data: function(a, b) {
                var c = this, d, f;
                if (0 === arguments.length)
                    return this.selection.find(".select2-search-choice").map(function() {
                        return e(this).data("select2-data")
                    }).get();
                f = this.data();
                a || (a = []);
                d = e.map(a, function(a) {
                    return c.opts.id(a)
                });
                this.setVal(d);
                this.updateSelection(a);
                this.clearSearch();
                b && this.triggerChange(this.buildChangeDetails(f, this.data()))
            }
        });
        e.fn.select2 = function() {
            var a = Array.prototype.slice.call(arguments, 0), b, c, d, f, h, k = "val destroy opened open close focus isFocused container dropdown onSortStart onSortEnd enable disable readonly positionDropdown data search".split(" "), i = ["opened", "isFocused", "container", "dropdown"], l = ["val", "data"], n = {
                search: "externalSearch"
            };
            this.each(function() {
                if (0 === a.length || "object" === typeof a[0])
                    b = 0 === a.length ? {} : e.extend({}, a[0]),
                    b.element = e(this),
                    "select" === b.element.get(0).tagName.toLowerCase() ? h = b.element.prop("multiple") : (h = b.multiple || !1,
                    "tags"in b && (b.multiple = h = !0)),
                    c = h ? new C : new B,
                    c.init(b);
                else if ("string" === typeof a[0]) {
                    if (0 > j(a[0], k))
                        throw "Unknown method: " + a[0];
                    f = void 0;
                    c = e(this).data("select2");
                    if (void 0 !== c && (d = a[0],
                    "container" === d ? f = c.container : "dropdown" === d ? f = c.dropdown : (n[d] && (d = n[d]),
                    f = c[d].apply(c, a.slice(1))),
                    0 <= j(a[0], i) || j(a[0], l) && 1 == a.length))
                        return !1
                } else
                    throw "Invalid arguments to select2 plugin: " + a;
            });
            return void 0 === f ? this : f
        }
        ;
        e.fn.select2.defaults = {
            width: "copy",
            loadMorePadding: 0,
            closeOnSelect: !0,
            openOnEnter: !0,
            containerCss: {},
            dropdownCss: {},
            containerCssClass: "",
            dropdownCssClass: "",
            formatResult: function(a, b, c, d) {
                b = [];
                G(a.text, c.term, b, d);
                return b.join("")
            },
            formatSelection: function(a, b, c) {
                return a ? c(a.text) : void 0
            },
            sortResults: function(a) {
                return a
            },
            formatResultCssClass: function() {},
            formatSelectionCssClass: function() {},
            formatNoMatches: function() {
                return "No matches found"
            },
            formatInputTooShort: function(a, b) {
                var c = b - a.length;
                return "Please enter " + c + " more character" + (1 == c ? "" : "s")
            },
            formatInputTooLong: function(a, b) {
                var c = a.length - b;
                return "Please delete " + c + " character" + (1 == c ? "" : "s")
            },
            formatSelectionTooBig: function(a) {
                return "You can only select " + a + " item" + (1 == a ? "" : "s")
            },
            formatLoadMore: function() {
                return "Loading more results..."
            },
            formatSearching: function() {
                return "Searching..."
            },
            minimumResultsForSearch: 0,
            minimumInputLength: 0,
            maximumInputLength: null,
            maximumSelectionSize: 0,
            id: function(a) {
                return a.id
            },
            matcher: function(a, b) {
                return 0 <= n("" + b).toUpperCase().indexOf(n("" + a).toUpperCase())
            },
            separator: ",",
            tokenSeparators: [],
            tokenizer: N,
            escapeMarkup: H,
            blurOnChange: !1,
            selectOnBlur: !1,
            adaptContainerCssClass: function(a) {
                return a
            },
            adaptDropdownCssClass: function() {
                return null
            },
            nextSearchTerm: function() {}
        };
        e.fn.select2.ajaxDefaults = {
            transport: e.ajax,
            params: {
                type: "GET",
                cache: !1,
                dataType: "json"
            }
        };
        window.Select2 = {
            query: {
                ajax: I,
                local: J,
                tags: K
            },
            util: {
                debounce: F,
                markMatch: G,
                escapeMarkup: H,
                stripDiacritics: n
            },
            "class": {
                "abstract": u,
                single: B,
                multi: C
            }
        }
    }
})(jQuery);
;;/* module-key = 'com.atlassian.auiplugin:aui-select2', location = 'js/aui-select2.js' */
(function(c) {
    var e = c.fn.select2;
    c.fn.auiSelect2 = function(d) {
        var b;
        if (c.isPlainObject(d)) {
            var a = c.extend({}, d);
            b = a.hasAvatar ? " aui-has-avatar" : "";
            a.containerCssClass = "aui-select2-container" + b + (a.containerCssClass ? " " + a.containerCssClass : "");
            a.dropdownCssClass = "aui-select2-drop aui-dropdown2 aui-style-default" + b + (a.dropdownCssClass ? " " + a.dropdownCssClass : "");
            b = Array.prototype.slice.call(arguments, 1);
            b.unshift(a)
        } else
            b = arguments.length ? arguments : [{
                containerCssClass: "aui-select2-container",
                dropdownCssClass: "aui-select2-drop aui-dropdown2 aui-style-default"
            }];
        return e.apply(this, b)
    }
})(AJS.$);
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:searchable-multi-selector', location = '/static/widget/searchable-multi-selector/searchable-multi-selector.js' */
define("widget/searchable-multi-selector", ["aui", "jquery", "lodash", "util/ajax", "util/events", "util/function", "util/promise"], function(M, I, N, L, O, K, E) {
    function C(R, Q) {
        this._$field = R;
        Q = this._options = I.extend(true, {}, this.defaults, Q);
        A(this);
        if (!(N.isFunction(Q.selectionTemplate))) {
            throw "a selectionTemplate must be a function"
        }
        if (!(N.isFunction(Q.resultTemplate))) {
            throw "a resultTemplate must be a function"
        }
        this._selectedItems = [];
        this._initialItems = [];
        this._excludedIds = N.map(Q.excludedItems, Q.generateId);
        J(this);
        this.setSelectedItems(Q.initialItems.slice(0))
    }
    I.extend(true, C.prototype, O.createEventMixin("stash.widget.searchable.multi.selector"), {
        defaults: {
            minimumInputLength: 1,
            extraClasses: null,
            dropdownClasses: null,
            debounceInterval: 300,
            initialItems: [],
            excludedItems: [],
            urlParams: {},
            hasAvatar: false,
            inputTooShortTemplate: function() {
                return M.escapeHtml("Start typing to search")
            },
            noMatchesTemplate: function() {
                return M.escapeHtml("No matches found")
            },
            generateId: function(Q) {
                return Q.id || Q.name
            },
            generateText: function(Q) {
                return Q.displayName || Q.name
            },
            prepareSearchTerm: N.identity
        },
        getSelectedItems: function() {
            return N.pluck(this._selectedItems, "item")
        },
        setSelectedItems: function(Q) {
            this._initialItems = Q.slice(0);
            this._$field.auiSelect2("val", N.map(Q, this._options.generateId))
        },
        clearSelectedItems: function() {
            this.setSelectedItems([])
        }
    });
    function F(R, Q) {
        this._url = R;
        this._urlParams = Q;
        this.clear();
        this._pageReceived = N.bind(this._pageReceived, this)
    }
    F.prototype.clear = function() {
        this._nextPageStart = 0
    }
    ;
    F.prototype.nextPage = function(Q) {
        return L.rest({
            url: this._url,
            data: I.extend({}, this._urlParams, {
                start: this._nextPageStart,
                filter: Q
            })
        }).done(this._pageReceived)
    }
    ;
    F.prototype._pageReceived = function(Q) {
        this._nextPageStart = Q.nextPageStart || (Q.start + Q.size)
    }
    ;
    C.PagedDataSource = F;
    function H(Q, R) {
        this.clear = N.bind(Q.clear, Q);
        this.nextPage = E.delay(N.bind(Q.nextPage, Q), R)
    }
    function B(Q) {
        var R = I(".select2-drop-active > .select2-results");
        if (!R.length) {
            return
        }
        if (R.children(".select2-result-selectable").length === 0 && R.children(".select2-disabled").length) {
            I('<li class="select2-no-results"></li>').html(Q._options.noMatchesTemplate()).appendTo(R)
        }
    }
    function D(Q, R) {
        return {
            id: Q.generateId(R),
            text: Q.generateText(R),
            item: R
        }
    }
    function P(R, Q) {
        return N.reject(R, function(S) {
            return ( S.id === Q.id)
        })
    }
    function G(Q) {
        Q && Q.abort && Q.abort()
    }
    function A(Q) {
        var R = Q._options;
        if (!(R.dataSource)) {
            if (R.url) {
                R.dataSource = new F(R.url,R.urlParams)
            } else {
                throw "either a dataSource or url must be supplied"
            }
        }
        R.dataSource = new H(R.dataSource,R.debounceInterval)
    }
    function J(R) {
        var S = R._options;
        var T = R._$field;
        var U = R._excludedIds;
        var V = N.bind(D, null, S);
        var Q = [];
        T.auiSelect2({
            hasAvatar: S.hasAvatar,
            query: function(X) {
                if (X.page <= 1) {
                    S.dataSource.clear();
                    N.forEach(Q, G);
                    Q = []
                }
                var W = S.prepareSearchTerm(I.trim(X.term));
                var Y = S.dataSource.nextPage(W);
                Y = Y.then(function(Z) {
                    return {
                        results: N.chain(Z.values).map(V).filter(function(a) {
                            return N.indexOf(U, a.id) === -1
                        }).value(),
                        more: !(Z.isLastPage)
                    }
                }).promise(Y);
                Q.push(Y);
                Y.always(function() {
                    Q = N.reject(Q, K.eq(Y))
                }).done(X.callback)
            },
            formatSelection: function(W) {
                return S.selectionTemplate(W.item)
            },
            formatResult: function(W) {
                return S.resultTemplate(W.item)
            },
            initSelection: function(X, Y) {
                var W = N.map(R._initialItems, V);
                R._selectedItems = W;
                Y(W)
            },
            separator: "|!|",
            multiple: true,
            minimumInputLength: S.minimumInputLength,
            formatInputTooShort: S.inputTooShortTemplate,
            formatNoMatches: S.noMatchesTemplate,
            containerCssClass: ["searchable-multi-selector", S.extraClasses].join(" "),
            dropdownCssClass: ["searchable-multi-selector-dropdown", S.dropdownClasses].join(" "),
            openOnEnter: false
        }).on("change", function(W) {
            if (W.removed) {
                R._selectedItems = P(R._selectedItems, W.removed)
            }
            if (W.added) {
                R._selectedItems.push(W.added)
            }
            R.trigger("change")
        }).on("open", N.bind(B, null, this))
    }
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:user-multi-selector', location = '/static/feature/user/user-multi-selector/user-multi-selector.js' */
define("feature/user/user-multi-selector", ["aui", "jquery", "stash/api/util/navbuilder", "widget/searchable-multi-selector"], function(B, E, G, F) {
    function A(I, H) {
        F.call(this, I, H)
    }
    E.extend(true, A.prototype, F.prototype, {
        defaults: {
            hasAvatar: true,
            url: G.rest().users().build(),
            selectionTemplate: function(H) {
                return stash.widget.avatarWithName({
                    size: "xsmall",
                    person: H
                })
            },
            urlParams: {
                avatarSize: stash.widget.avatarSizeInPx({
                    size: "xsmall"
                })
            },
            resultTemplate: function(H) {
                return stash.widget.avatarWithNameAndEmail({
                    size: "small",
                    person: H
                })
            },
            generateId: function(H) {
                return H.name
            },
            inputTooShortTemplate: function D() {
                return B.escapeHtml("Start typing to search for users")
            },
            noMatchesTemplate: function C() {
                return B.escapeHtml("No matching users found")
            },
            prepareSearchTerm: function(H) {
                return H.replace(/^@/, "")
            }
        }
    });
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:pull-request-details-form', location = '/static/feature/pull-request/details-form/pull-request-details.soy' */
// This file was automatically generated from pull-request-details.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.pullRequest.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.pullRequest == 'undefined') {
    stash.feature.pullRequest = {};
}

stash.feature.pullRequest.detailsForm = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<fieldset class="pull-request-details">' + aui.form.textField({
        id: 'title',
        extraClasses: 'pull-request-title',
        name: 'title',
        value: opt_data.title ? opt_data.title : '',
        errorTexts: opt_data.fieldErrors && opt_data.fieldErrors.title ? opt_data.fieldErrors.title : null,
        isRequired: true,
        maxLength: 255,
        labelContent: '' + soy.$$escapeHtml("Title"),
        fieldWidth: 'long'
    }) + widget.aui.form.field({
        id: 'description',
        labelContent: '' + soy.$$escapeHtml("Description"),
        errors: opt_data.fieldErrors && opt_data.fieldErrors.description ? opt_data.fieldErrors.description : null,
        fieldGroupClass: 'pull-request-description',
        input: '' + stash.widget.markupEditor.editor({
            textareaId: 'pull-request-description',
            textareaName: 'description',
            text: opt_data.description,
            previewButtonTitle: "View a preview of this description",
            attachmentButtonTitle: "Attach a file to this pull request. You can also drag and drop a file to attach it.",
            attachmentButtonAccessibilityText: "Attach file"
        })
    }) + aui.form.textField({
        id: 'reviewers',
        extraClasses: 'pull-request-reviewers',
        name: 'reviewers',
        errorTexts: opt_data.fieldErrors && opt_data.fieldErrors.reviewers ? opt_data.fieldErrors.reviewers : null,
        labelContent: '' + soy.$$escapeHtml("Reviewers"),
        descriptionText: "Reviewers can approve a pull request to let others know when it is good to merge",
        fieldWidth: 'long'
    }) + ((opt_data.pluginFieldsContent) ? soy.$$filterNoAutoescape(opt_data.pluginFieldsContent) : '') + '</fieldset>';
}
;
if (goog.DEBUG) {
    stash.feature.pullRequest.detailsForm.soyTemplateName = 'stash.feature.pullRequest.detailsForm';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:project-model', location = '/static/model/project.js' */
define("model/project", ["backbone-brace", "model/stash-user"], function(B, A) {
    var C = B.Model.extend({
        namedAttributes: {
            id: "number",
            name: "string",
            key: "string",
            description: "string",
            type: "string",
            owner: A,
            avatarUrl: "string",
            link: Object,
            links: Object,
            "public": "boolean"
        },
        isEqual: function(D) {
            return !!(D && D instanceof C && this.id === D.id)
        }
    }, {
        projectType: {
            NORMAL: "NORMAL",
            PERSONAL: "PERSONAL"
        }
    });
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-model', location = '/static/model/repository.js' */
define("model/repository", ["backbone-brace", "model/project"], function(B, C) {
    var A = B.Model.extend({
        namedAttributes: {
            id: "number",
            name: "string",
            slug: "string",
            project: C,
            "public": "boolean",
            scmId: "string",
            state: "string",
            statusMessage: "string",
            forkable: "boolean",
            cloneUrl: "string",
            link: Object,
            links: Object,
            origin: null
        },
        isEqual: function(D) {
            return !!(D && D instanceof A && this.id === D.id)
        }
    });
    B.Mixins.applyMixin(A, {
        namedAttributes: {
            origin: A
        }
    });
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:revision-reference', location = '/static/model/revision-reference.js' */
define("model/revision-reference", ["aui", "backbone-brace", "lodash", "model/page-state", "model/repository"], function(C, F, D, E, A) {
    var B = {
        TAG: {
            id: "tag",
            name: "Tag"
        },
        BRANCH: {
            id: "branch",
            name: "Branch"
        },
        COMMIT: {
            id: "commit",
            name: "Commit"
        },
        isTag: function(H) {
            return H && (H === B.TAG.id || H.id === B.TAG.id)
        },
        isBranch: function(H) {
            return H && (H === B.BRANCH.id || H.id === B.BRANCH.id)
        },
        isCommit: function(H) {
            return H && (H === B.COMMIT.id || H.id === B.COMMIT.id)
        },
        from: function(H) {
            if (B.isTag(H)) {
                return B.TAG
            } else {
                if (B.isBranch(H)) {
                    return B.BRANCH
                } else {
                    if (B.isCommit(H)) {
                        return B.COMMIT
                    }
                }
            }
            window.console && console.error("Unknown RevisionReference type " + H);
            return null
        }
    };
    var G = F.Model.extend({
        namedAttributes: {
            id: "string",
            displayId: "string",
            type: B.from,
            isDefault: "boolean",
            latestChangeset: "string",
            latestCommit: "string",
            hash: "string",
            repository: A
        },
        initialize: function() {
            if (!this.getDisplayId()) {
                this.setDisplayId(this.getId())
            }
            if (!this.getIsDefault()) {
                this.setIsDefault(false)
            }
            if (!this.getRepository()) {
                this.setRepository(E.getRepository())
            }
        },
        getTypeName: function() {
            return this.getType().name
        },
        isDefault: function() {
            return this.get("isDefault") || false
        },
        isTag: function() {
            return B.isTag(this.getType())
        },
        isBranch: function() {
            return B.isBranch(this.getType())
        },
        isCommit: function() {
            return B.isCommit(this.getType())
        },
        isEqual: function(H) {
            return (H instanceof G) && this.getId() === H.getId() && this.getType().id === H.getType().id && this.getRepository().isEqual(H.getRepository())
        }
    }, {
        fromChangeset: function(H) {
            return new G({
                id: H.id,
                displayId: H.displayId,
                type: B.COMMIT,
                isDefault: false
            })
        },
        hydrateRefFromId: function(N, M, K, L) {
            if (!D.isString(N)) {
                return null
            }
            var H = /^refs\/(heads|tags)\/(.+)/;
            var J = N.replace(H, "$2");
            if (!K) {
                K = G.type.BRANCH;
                var I = N.match(H);
                if (I && I[1] === "tags") {
                    K = G.type.TAG
                }
            }
            return new G({
                id: N,
                displayId: J,
                type: K,
                isDefault: M,
                latestChangeset: L
            })
        },
        hydrateDeprecated: function(H) {
            if (!H.__json) {
                return new G(H.toJSON())
            }
            return new G(H.__json)
        }
    });
    G.type = B;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:parse-commit-message-util', location = '/static/util/parse-commit-message.js' */
define("util/parse-commit-message", [], function() {
    var A = ["\n\n", "\n", ". "];
    return {
        splitIntoSubjectAndBody: function(G) {
            for (var F = 0; F < A.length; F++) {
                var C = A[F];
                var D = G.indexOf(C);
                if (D !== -1) {
                    var E = G.substring(0, D).replace(/\n/g, " ") + C.trim();
                    var B = G.substring(D + C.length);
                    return this.subjectAndBody(E, B)
                }
            }
            return this.subjectAndBody(G, "")
        },
        subjectAndBody: function(C, B) {
            return {
                subject: C,
                body: B
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:pull-request-metadata-generator', location = '/static/feature/pull-request/metadata-generator/metadata-generator.js' */
define("feature/pull-request/metadata-generator", ["jquery", "lodash", "util/parse-commit-message", "util/text", "exports"], function(C, H, E, D, B) {
    var G = (C("<div>").text("\n").text().length === 1);
    function J(L) {
        var K = E.splitIntoSubjectAndBody(L);
        return F(K)
    }
    function F(K) {
        var L = K.subject.substring(0, 255);
        return {
            title: L,
            description: K.body
        }
    }
    function I(L) {
        if (!G) {
            return
        }
        var K = "";
        if (L.length > 1) {
            L = H.map(L, A)
        }
        if (L.length > 0) {
            K = L.reverse().join("").trim()
        }
        return K
    }
    function A(O) {
        var K = O.replace(/\n\n+/g, "\n\n");
        var M = /\n(.)/g
          , L = "\n" + D.indent("$1");
        var P = K.replace(M, L);
        var N = P.indexOf("\n\n") !== -1 ? "\n\n" : "\n";
        return "* " + P + N
    }
    B.generateTitleAndDescriptionFromCommitMessage = J;
    B.generateDescriptionFromCommitMessages = I
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:pull-request-create-form', location = '/static/feature/pull-request/create-form/pull-request-create.js' */
define("feature/pull-request/pull-request-create", ["bacon", "jquery", "lodash", "stash/api/util/navbuilder", "stash/api/util/server", "util/events", "util/function", "util/text", "model/page-state", "widget/markup-editor", "widget/searchable-multi-selector", "feature/pull-request/metadata-generator", "feature/user/user-multi-selector", "exports"], function(H, E, R, F, L, C, G, A, I, J, D, K, N, S) {
    function P(g, a, Z, b, X) {
        var e = [];
        var h = E(g);
        J.bindTo(h.find(".markup-editor"));
        var Y = I.getCurrentUser();
        var W = {
            avatarSize: stash.widget.avatarSizeInPx({
                size: "xsmall"
            }),
            permission: "LICENSED_USER"
        };
        var U = new D.PagedDataSource(F.rest().users().build(),W);
        new N(h.find("#reviewers"),{
            initialItems: a,
            excludedItems: Y ? [Y.toJSON()] : [],
            dataSource: U
        });
        var c = Z.onValue(function(i) {
            E.extend(W, {
                "permission.1": "REPO_READ",
                "permission.1.repositoryId": i.targetRepo.id
            })
        });
        e.push({
            destroy: c
        });
        var T = h.find("#submit-form");
        var f = X.onValue(function(i) {
            T.enable(i).attr("aria-disabled", !i)
        });
        e.push({
            destroy: f
        });
        var d = h.find("#title");
        if (d.val() === "") {
            var V = d.asEventStream("keydown").doAction(function(i) {
                E(i.target).data("title-changed", true)
            });
            f = Z.map(R.compose(A.convertBranchNameToSentence.bind(A), G.dotX("source.getDisplayId"))).takeUntil(V).onValue(d.val.bind(d));
            e.push({
                destroy: f
            })
        }
        if (E("#pull-request-description").val() === "") {
            e.push({
                destroy: Q(Z, b)
            })
        }
        e.push({
            destroy: O(Z)
        });
        return {
            destroy: function() {
                R.invoke(e, "destroy")
            }
        }
    }
    function Q(V, a) {
        var b = V.filter(function(c) {
            return c.source && c.target
        });
        var T = false;
        var Y;
        var U = function(c) {
            if (T) {
                T = false;
                var e = E(c.values).filter(":not(.merge)").find(".message-subject");
                var d = R.map(e, function(f) {
                    return E(f).attr("title")
                });
                B(d)
            }
        };
        var X = function(d) {
            var c = R.filter(d.values, function(f) {
                return f.parents.length === 1
            });
            var e = R.map(c, G.dot("message"));
            B(e);
            Y = null
        };
        C.on("stash.widget.commitsTable.contentAdded", U);
        var W = E("#pull-request-description").asEventStream("keydown").doAction(function(c) {
            E(c.target).data("description-changed", true);
            if (Y) {
                Y.abort();
                Y = null
            }
        });
        var Z = H.combineAsArray(b, a).skipDuplicates(function(d, c) {
            return d[0] === c[0] && d[1] === c[1]
        }).takeUntil(W).slidingWindow(2, 1).map(function(c) {
            if (c.length === 1) {
                c[0].push(false);
                return c[0]
            }
            c[1].push(c[0][1] !== c[1][1]);
            return c[1]
        }).onValue(function(e) {
            var c = e[0];
            var f = e[1];
            var d = e[2];
            if ((d && T) || !d && f !== "commits") {
                T = false;
                if (Y) {
                    Y.abort();
                    Y = null
                }
                Y = M(c.source, c.target, X)
            } else {
                if (!d && f === "commits") {
                    T = true
                }
            }
        });
        return function() {
            C.off("stash.widget.commitsTable.contentAdded", U);
            Z()
        }
    }
    function M(V, W, U) {
        console.log("Rest for: " + V.getDisplayId() + " " + W.getDisplayId());
        var T = F.project(V.getRepository().getProject()).repo(V.getRepository()).commits().withParams({
            until: V.getLatestChangeset(),
            since: W.getLatestChangeset(),
            secondaryRepositoryId: W.getRepository().getId(),
            start: 0,
            limit: 10
        }).build();
        return L.rest({
            type: "GET",
            url: T,
            statusCode: {
                "*": false
            }
        }).done(U)
    }
    function B(Z) {
        if (Z.length === 0) {
            return
        }
        var X = E("#title");
        var U = E("#pull-request-description");
        var T = !X.data("title-changed");
        var V = !U.data("description-changed");
        if (T && Z.length === 1) {
            var Y = K.generateTitleAndDescriptionFromCommitMessage(Z[0]);
            X.val(Y.title);
            if (V) {
                U.val(Y.description).trigger("input")
            }
        } else {
            if (V) {
                var W = K.generateDescriptionFromCommitMessages(Z);
                U.val(W).trigger("input")
            }
        }
    }
    function O(T) {
        I.extend("sourceRepository");
        I.extend("targetBranch");
        I.extend("sourceBranch");
        return T.onValue(function(U) {
            I.setProject(U.targetRepo.getProject());
            I.setRepository(U.targetRepo);
            I.setSourceRepository(U.sourceRepo);
            I.setTargetBranch(U.target);
            I.setSourceBranch(U.source)
        })
    }
    S.init = P
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:pull-request-create-form', location = '/static/feature/pull-request/create-form/pull-request-create.soy' */
// This file was automatically generated from pull-request-create.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.pullRequest.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.pullRequest == 'undefined') {
    stash.feature.pullRequest = {};
}

stash.feature.pullRequest.create = function(opt_data, opt_ignored) {
    var output = '';
    var branchesAreIdentical__soy3 = opt_data.sourceRepository.id == opt_data.repository.id && opt_data.sourceBranch.id == opt_data.targetBranch.id;
    output += stash.feature.pullRequest.detailsForm(opt_data) + aui.form.buttons({
        content: '' + aui.form.submit({
            id: 'submit-form',
            type: 'primary',
            text: "Create",
            isDisabled: branchesAreIdentical__soy3
        }) + aui.buttons.button({
            type: 'link',
            extraAttributes: {
                type: 'button'
            },
            extraClasses: 'show-hide-button',
            id: 'cancel-button',
            text: "Cancel"
        })
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.pullRequest.create.soyTemplateName = 'stash.feature.pullRequest.create';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:loaded-range', location = '/static/widget/loaded-range.js' */
define("widget/loaded-range", function() {
    function A(B) {
        this.start = undefined;
        this.nextPageStart = undefined;
        this._reachedStart = false;
        this._reachedEnd = false;
        this._reachedCapacity = false;
        this._capacity = B || Infinity
    }
    A.prototype.isEmpty = function() {
        return this.start === undefined
    }
    ;
    A.prototype.isBeforeStart = function(B) {
        return B < this.start
    }
    ;
    A.prototype.isAfterNextPageStart = function(B) {
        return B > this.nextPageStart
    }
    ;
    A.prototype.isLoaded = function(B) {
        return !(this.isEmpty() || this.isBeforeStart(B) || this.isAfterNextPageStart(B))
    }
    ;
    A.prototype.getAttachmentMethod = function(C, B) {
        return this.isEmpty() ? "html" : this.isBeforeStart(C) ? "prepend" : "append"
    }
    ;
    A.prototype.add = function(G, C, B, E) {
        var F = this.isEmpty();
        E = E || (G + C);
        if (F || this.isBeforeStart(G)) {
            this.start = G
        }
        if (F || this.isAfterNextPageStart(E)) {
            this.nextPageStart = E
        }
        this._reachedStart = this._reachedStart || G <= 0;
        var D = this._reachedEnd = this._reachedEnd || B;
        if (!D && this.nextPageStart >= this._capacity) {
            this._reachedCapacity = this._reachedEnd = true
        }
        return this
    }
    ;
    A.prototype.reachedStart = function() {
        return this._reachedStart
    }
    ;
    A.prototype.reachedEnd = function() {
        return this._reachedEnd
    }
    ;
    A.prototype.reachedCapacity = function() {
        return this._reachedCapacity
    }
    ;
    A.prototype.pageBefore = function(B) {
        if (this.reachedStart()) {
            return null
        }
        var C = Math.max(0, this.start - B);
        return {
            start: C,
            limit: this.start - C
        }
    }
    ;
    A.prototype.pageAfter = function(B) {
        if (this.reachedEnd()) {
            return null
        }
        return {
            start: this.nextPageStart,
            limit: B
        }
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:paged-scrollable', location = '/static/widget/paged-scrollable.js' */
define("widget/paged-scrollable", ["aui", "jquery", "lodash", "util/events", "util/function", "util/navigator", "widget/loaded-range"], function(H, C, I, J, E, F, B) {
    var A = F.isIE();
    function G(L, K) {
        this.options = C.extend({}, G.defaults, K);
        this.$scrollElement = C(L || window);
        if (C.isWindow(this.$scrollElement[0])) {
            var M = window.document.documentElement;
            this.getPaneHeight = function() {
                return M.clientHeight
            }
            ;
            this.getContentHeight = function() {
                return M.scrollHeight
            }
        }
        this._eventHandlers = []
    }
    G.defaults = {
        pageSize: 50,
        scrollDelay: 250,
        bufferPixels: 0,
        precedingSpaceMaintained: true,
        suspendOnFailure: true,
        dataLoadedEvent: "stash.widget.pagedscrollable.dataLoaded",
        autoLoad: true,
        preventOverscroll: false,
        idForEntity: null,
        paginationContext: null
    };
    G.prototype.init = function(M) {
        G.prototype.reset.call(this);
        M = M || {};
        this.loadedRange = M.loadedRange || new B();
        var L = this;
        var K = this.options.pageSize;
        var N = M.targetedItem ? Math.floor(M.targetedItem / K) * K : 0;
        if (M.suspended) {
            this.suspend()
        }
        if (this.loadedRange.isLoaded(N)) {
            return (this.loadIfRequired() || C.Deferred().resolve()).done(function() {
                L.onFirstDataLoaded()
            })
        }
        return D(this, N, K).then(undefined, function() {
            var O = N !== 0;
            if (O) {
                return D(L, 0, K)
            } else {
                return C.Deferred().rejectWith(this, arguments)
            }
        }).fail(function(R, Q, O, P) {
            if (P && P.errors && P.errors.length) {
                L.handleErrors(P.errors)
            }
        })
    }
    ;
    G.prototype.reset = function() {
        if (this.currentXHR) {
            this.cancelRequest()
        }
        this.clearListeners();
        if (this._resizeHandler) {
            C(window).off("resize", this._resizeHandler);
            this._resizeHandler = null
        }
        if (this.options.idForEntity) {
            this._ids = {}
        }
        this._suspended = false
    }
    ;
    G.prototype.destroy = function() {
        this.reset();
        delete this.$scrollElement
    }
    ;
    G.prototype.suspend = function() {
        this._suspended = true
    }
    ;
    G.prototype.resume = function() {
        this._suspended = false;
        return this.loadIfRequired()
    }
    ;
    G.prototype.isSuspended = function() {
        return this._suspended
    }
    ;
    G.prototype.getScrollTop = function() {
        return this.$scrollElement.scrollTop()
    }
    ;
    G.prototype.setScrollTop = function(K) {
        this.$scrollElement.scrollTop(K)
    }
    ;
    G.prototype.getPane = function() {
        return this.$scrollElement
    }
    ;
    G.prototype.getPaneHeight = function() {
        return this.$scrollElement[0].clientHeight
    }
    ;
    G.prototype.getContentHeight = function() {
        return this.$scrollElement[0].scrollHeight
    }
    ;
    G.prototype.getOption = function(K) {
        if (Object.prototype.hasOwnProperty.call(this.options, K)) {
            return this.options[K]
        }
        return undefined
    }
    ;
    G.prototype.setOptions = function(K) {
        if (C.isPlainObject(K)) {
            this.options = C.extend(this.options, K)
        }
    }
    ;
    G.prototype.addScrollListener = function(L) {
        var K = this.scrollDelay ? I.debounce(L, this.scrollDelay) : L;
        this._eventHandlers.push(K);
        this.$scrollElement.on("scroll.paged-scrollable", K)
    }
    ;
    G.prototype._bindOverscrollPrevention = function() {
        function K(N, O) {
            var L = C(this).outerHeight();
            var M = this.scrollHeight;
            if ((this.scrollTop === (M - L) && O < 0) || (this.scrollTop === 0 && O > 0)) {
                N.preventDefault()
            }
        }
        this._eventHandlers.push(K);
        this.$scrollElement.on("mousewheel.paged-scrollable", K)
    }
    ;
    G.prototype.clearListeners = function() {
        var K = this;
        I.each(this._eventHandlers, function(L) {
            K.$scrollElement.unbind(".paged-scrollable", L)
        });
        this._eventHandlers.length = 0
    }
    ;
    G.prototype.loadIfRequired = function() {
        if (this.isSuspended() || (this.loadedRange.reachedEnd() && this.loadedRange.reachedStart())) {
            return
        }
        var P = this.getScrollTop()
          , L = this.getPaneHeight()
          , N = this.getContentHeight()
          , O = L + P;
        if (!C.isWindow(this.getPane()[0]) && this.getPane().is(":hidden")) {
            return
        }
        if (I.any([true, "previous"], E.eq(this.options.autoLoad)) && P < this.options.bufferPixels + (this.loadedRange.start / this.loadedRange.nextPageStart) * N) {
            var K = this.loadedRange.pageBefore(this.options.pageSize);
            if (K) {
                return this.load(K.start, K.limit)
            }
        }
        var Q = 1;
        if (I.any([true, "next"], E.eq(this.options.autoLoad)) && O + Q >= N - this.options.bufferPixels) {
            var M = this.loadedRange.pageAfter(this.options.pageSize);
            if (M) {
                return this.load(M.start, M.limit)
            }
        }
    }
    ;
    function D(L, M, K) {
        if (L.currentXHR) {
            return C.Deferred().reject()
        }
        L.currentXHR = L.requestData(M, K);
        return L.currentXHR.always(function() {
            L.currentXHR = null
        }).done(function(N) {
            if (!L.loadedRange.isEmpty() && L.options.paginationContext) {
                J.trigger("internal.stash.ui.nav.pagination", null, {
                    context: L.options.paginationContext,
                    page: ((N.start || M) / (N.limit || K)) + 1
                })
            }
            L.onDataLoaded(M, K, N)
        }).fail(function() {
            L.suspend()
        })
    }
    G.prototype.load = function(M, K) {
        var L = this;
        return D(this, M, K).fail(function(Q, P, N, O) {
            if (O && O.errors) {
                L.handleErrors(O.errors)
            }
        })
    }
    ;
    G.prototype.loadAfter = function() {
        var K = this.loadedRange.pageAfter(this.options.pageSize);
        return K && this.load(K.start, K.limit)
    }
    ;
    G.prototype.loadBefore = function() {
        var K = this.loadedRange.pageBefore(this.options.pageSize);
        return K && this.load(K.start, K.limit)
    }
    ;
    G.prototype.onDataLoaded = function(M, N, P) {
        if (P.start !== undefined) {
            M = P.start
        }
        var R = this.loadedRange.isEmpty()
          , K = this.loadedRange.getAttachmentMethod(M, P.size)
          , Q = K === "prepend";
        this.loadedRange.add(M, P.size, P.isLastPage, P.nextPageStart);
        var S, O;
        if (Q || A) {
            O = this.getScrollTop();
            S = this.getContentHeight()
        }
        P = this._addPage(P, K);
        if (Q || A) {
            var L = Q ? this.getContentHeight() - S : 0;
            this.setScrollTop(O + L)
        }
        if (R) {
            this.onFirstDataLoaded(M, N, P)
        }
        J.trigger(this.options.dataLoadedEvent, this, M, N, P);
        this.loadIfRequired()
    }
    ;
    G.prototype._addPage = function(L, K) {
        L = this._dedupe(L);
        this.attachNewContent(L, K);
        return L
    }
    ;
    G.prototype._dedupe = function(M) {
        if (M && M.values && this.options.idForEntity) {
            var L = this._ids;
            var K = this.options.idForEntity;
            M = C.extend({}, M, {
                values: I.filter(M.values, function(N) {
                    var O = K(N);
                    if (!I.has(L, O)) {
                        L[O] = true;
                        return true
                    }
                    return false
                })
            })
        }
        return M
    }
    ;
    G.prototype.onFirstDataLoaded = function() {
        var K = this;
        this.addScrollListener(function() {
            K.loadIfRequired()
        });
        if (this.options.preventOverscroll) {
            this._bindOverscrollPrevention()
        }
        C(window).on("resize", this._resizeHandler = function() {
            K.loadIfRequired()
        }
        )
    }
    ;
    G.prototype.cancelRequest = function() {
        if (this.currentXHR) {
            if (this.currentXHR.abort) {
                this.currentXHR.abort()
            } else {
                if (this.currentXHR.reject) {
                    this.currentXHR.reject()
                } else {
                    H.log("Couldn't cancel the current request.")
                }
            }
            this.currentXHR = null
        }
    }
    ;
    G.prototype.add = function(L, K) {
        if (L.length) {
            L = this._addPage({
                values: L,
                size: L.length
            }, K || "prepend");
            return true
        }
        return false
    }
    ;
    G.prototype.remove = function(K) {
        if (this.options.idForEntity) {
            var L = this.options.idForEntity(K);
            if (I.has(this._ids, L)) {
                delete this._ids[L];
                if (typeof this.loadedRange.nextPageStart === "number") {
                    this.loadedRange.nextPageStart = Math.max(0, this.loadedRange.nextPageStart - 1)
                }
                return true
            }
        }
        return false
    }
    ;
    G.prototype.attachNewContent = function(L, K) {
        throw new Error("attachNewContent is abstract and must be implemented.")
    }
    ;
    G.prototype.requestData = function(L, K) {
        throw new Error("requestData is abstract and must be implemented.  It must return a promise. It is preferred to return a jqXHR.")
    }
    ;
    G.prototype.handleErrors = function(K) {
        throw new Error("handleErrors is abstract and must be implemented.")
    }
    ;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:keyboard-controller', location = '/static/widget/keyboard-controller.js' */
define("widget/keyboard-controller", ["aui", "jquery"], function(B, D) {
    function A(I, G) {
        if (!(this instanceof A)) {
            return new A(I,G)
        }
        var F = D(I);
        var H;
        F.on("keydown", H = function(J) {
            if (J.keyCode in G) {
                if (!G[J.keyCode](J)) {
                    J.preventDefault()
                }
            }
        }
        );
        this.destroy = function() {
            F.off("keydown", H)
        }
        ;
        return this
    }
    function C(I, G) {
        G = D.extend({}, C.defaults, G);
        function H(J) {
            J.focus().addClass(G.focusedClass)
        }
        var F = {};
        F[B.keyCode.TAB] = function(N) {
            var K, J, L, M = N.target;
            K = D("a:visible, :input:visible:enabled, :checkbox:visible:enabled, :radio:visible:enabled, [tabindex]", I).not("[tabindex=-1]").filter(function() {
                return D(this).css("visibility") !== "hidden"
            });
            L = K.last();
            J = K.first();
            K.removeClass(G.focusedClass);
            if (N.shiftKey && M === J[0]) {
                if (!G.wrapAround) {
                    return true
                }
                H(L)
            } else {
                if (!N.shiftKey && M === L[0]) {
                    if (!G.wrapAround) {
                        return true
                    }
                    H(J)
                } else {
                    if (N.shiftKey) {
                        H(K.eq(K.index(M) - 1))
                    } else {
                        H(K.eq(K.index(M) + 1))
                    }
                }
            }
        }
        ;
        return new A(I,F)
    }
    C.defaults = {
        focusedClass: "item-focused",
        wrapAround: true
    };
    function E(S, T, U) {
        U = D.extend({}, E.defaults, U);
        var G = D(T);
        var R = D.Callbacks();
        var P = D.Callbacks();
        if (U.onSelect) {
            R.add(U.onSelect)
        }
        if (U.onFocus) {
            P.add(U.onFocus)
        }
        var J = false
          , F = false
          , L = false;
        function I(W) {
            do {
                var X = W.find(">:first-child");
                var V = W.next();
                if (X.length) {
                    W = X
                } else {
                    if (V.length) {
                        W = V
                    } else {
                        W = W.parentsUntil(G[0]).next().first()
                    }
                }
            } while (W.length && !W.is(U.itemSelector));return W
        }
        function O(X) {
            do {
                var W = X.prev();
                if (W.length) {
                    var V;
                    while ((V = W.find(">:last-child")).length) {
                        W = V
                    }
                    X = W
                } else {
                    X = X.parent();
                    if (X[0] === G[0]) {
                        X = D()
                    }
                }
            } while (X.length && !X.is(U.itemSelector));return X
        }
        function Q(V) {
            return function W(d) {
                var c = D(U.itemSelector, G);
                var f = c.filter(function() {
                    return D(this).hasClass(U.focusedClass)
                });
                var X = false;
                var g = V === "next";
                var a;
                if (f.length) {
                    if (U.adjacentItems) {
                        a = f[V](U.itemSelector)
                    } else {
                        if (V === "next") {
                            a = I(f)
                        } else {
                            a = O(f)
                        }
                    }
                } else {
                    if (V === "next") {
                        a = c.first()
                    } else {
                        if (U.wrapAround) {
                            a = c.last()
                        } else {
                            return
                        }
                    }
                }
                L = true;
                if (!a.length) {
                    if (V === "next" && U.requestMore && !J) {
                        if (!F) {
                            L = false;
                            var i = U.requestMore();
                            if (i) {
                                F = true;
                                i.done(function(e) {
                                    J = e;
                                    if (!L) {
                                        W(d)
                                    }
                                }).always(function() {
                                    F = false;
                                    L = false
                                });
                                return
                            } else {
                                J = true;
                                W(d);
                                return
                            }
                        } else {
                            L = false;
                            return
                        }
                    } else {
                        if (U.wrapAround) {
                            X = true;
                            g = !g;
                            a = c[V === "next" ? "first" : "last"]()
                        } else {
                            return
                        }
                    }
                }
                f.removeClass(U.focusedClass);
                a.addClass(U.focusedClass);
                var Y = a[V]()
                  , b = !X && Y.length ? Y : a;
                var Z = document.activeElement;
                if (U.focusIntoView && Z) {
                    var h = b.attr("tabindex");
                    b.attr("tabindex", "0");
                    b.focus();
                    Z.focus();
                    if (h == null) {
                        b.removeAttr("tabindex")
                    } else {
                        b.attr("tabindex", h)
                    }
                } else {
                    a[0].scrollIntoView(false)
                }
                P.fire(a, d)
            }
        }
        var K = {};
        var N = K[B.keyCode.UP] = Q("prev");
        var H = K[B.keyCode.DOWN] = Q("next");
        K[B.keyCode.ENTER] = function(V) {
            var X = D(U.itemSelector, G);
            var W = X.filter(function() {
                return D(this).hasClass(U.focusedClass)
            });
            if (W.length) {
                R.fire(W, V)
            }
        }
        ;
        var M = new A(S,K);
        M.setListElement = function(V) {
            G = D(V)
        }
        ;
        M.blur = function() {
            D(U.itemSelector, G).removeClass(U.focusedClass)
        }
        ;
        M.focus = function() {
            P.add.apply(P, arguments);
            return this
        }
        ;
        M.select = function() {
            R.add.apply(R, arguments);
            return this
        }
        ;
        M.moveToNext = H;
        M.moveToPrev = N;
        return M
    }
    E.defaults = {
        itemSelector: "li",
        focusedClass: "item-focused",
        wrapAround: false,
        adjacentItems: true,
        requestMore: undefined,
        onFocus: undefined,
        onSelect: undefined
    };
    return {
        KeyboardController: A,
        TabKeyboardController: C,
        ListKeyboardController: E
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:jquery-mousewheel', location = '/static/bower/jquery-mousewheel/jquery.mousewheel.js' */
/* Copyright (c) 2013 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.1.1
 *
 * Requires: 1.2.2+
 */
(function(A) {
    if (typeof define === "function" && define.amd) {
        define(["jquery"], A)
    } else {
        A(jQuery)
    }
}(function(E) {
    var D = ["wheel", "mousewheel", "DOMMouseScroll"];
    var G = "onwheel"in document || document.documentMode >= 9 ? ["wheel"] : ["mousewheel", "DomMouseScroll", "MozMousePixelScroll"];
    var F, A;
    if (E.event.fixHooks) {
        for (var B = D.length; B; ) {
            E.event.fixHooks[D[--B]] = E.event.mouseHooks
        }
    }
    E.event.special.mousewheel = {
        setup: function() {
            if (this.addEventListener) {
                for (var H = G.length; H; ) {
                    this.addEventListener(G[--H], C, false)
                }
            } else {
                this.onmousewheel = C
            }
        },
        teardown: function() {
            if (this.removeEventListener) {
                for (var H = G.length; H; ) {
                    this.removeEventListener(G[--H], C, false)
                }
            } else {
                this.onmousewheel = null
            }
        }
    };
    E.fn.extend({
        mousewheel: function(H) {
            return H ? this.bind("mousewheel", H) : this.trigger("mousewheel")
        },
        unmousewheel: function(H) {
            return this.unbind("mousewheel", H)
        }
    });
    function C(H) {
        var I = H || window.event, N = [].slice.call(arguments, 1), P = 0, K = 0, J = 0, M = 0, L = 0, O;
        H = E.event.fix(I);
        H.type = "mousewheel";
        if (I.wheelDelta) {
            P = I.wheelDelta
        }
        if (I.detail) {
            P = I.detail * -1
        }
        if (I.deltaY) {
            J = I.deltaY * -1;
            P = J
        }
        if (I.deltaX) {
            K = I.deltaX;
            P = K * -1
        }
        if (I.wheelDeltaY !== undefined) {
            J = I.wheelDeltaY
        }
        if (I.wheelDeltaX !== undefined) {
            K = I.wheelDeltaX * -1
        }
        M = Math.abs(P);
        if (!F || M < F) {
            F = M
        }
        L = Math.max(Math.abs(J), Math.abs(K));
        if (!A || L < A) {
            A = L
        }
        O = P > 0 ? "floor" : "ceil";
        P = Math[O](P / F);
        K = Math[O](K / A);
        J = Math[O](J / A);
        N.unshift(H, P, K, J);
        return (E.event.dispatch || E.event.handle).apply(this, N)
    }
}));
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:searchable-selector', location = '/static/widget/searchable-selector/searchable-selector.soy' */
// This file was automatically generated from searchable-selector.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.searchableSelector = function(opt_data, opt_ignored) {
    var output = '<div class="searchable-selector ' + ((opt_data.extraClasses) ? soy.$$escapeHtml(opt_data.extraClasses) : '') + '" id="' + soy.$$escapeHtml(opt_data.id) + '">' + ((opt_data.searchable) ? '<header><label class="assistive" for="' + soy.$$escapeHtml(opt_data.id) + '-search-input">' + soy.$$escapeHtml(opt_data.searchPlaceholder ? opt_data.searchPlaceholder : "Search") + '</label><input id="' + soy.$$escapeHtml(opt_data.id) + '-search-input" type="text" name="filter" class="filter" placeholder="' + soy.$$escapeHtml(opt_data.searchPlaceholder ? opt_data.searchPlaceholder : "Search") + '"/></header>' : '');
    if (opt_data.tabs && opt_data.tabs.length > 1) {
        output += '<div class="aui-tabs horizontal-tabs"><ul class="tabs-menu">';
        var tabList24 = opt_data.tabs;
        var tabListLen24 = tabList24.length;
        for (var tabIndex24 = 0; tabIndex24 < tabListLen24; tabIndex24++) {
            var tabData24 = tabList24[tabIndex24];
            output += aui.tabMenuItem({
                url: '#' + soy.$$escapeHtml(opt_data.id) + '-tab-pane-' + soy.$$escapeHtml(tabIndex24),
                text: tabData24.label,
                isActive: tabIndex24 == 0,
                extraAttributes: {
                    'data-tab-id': tabIndex24
                }
            });
        }
        output += '</ul>';
        var tabList36 = opt_data.tabs;
        var tabListLen36 = tabList36.length;
        for (var tabIndex36 = 0; tabIndex36 < tabListLen36; tabIndex36++) {
            var tabData36 = tabList36[tabIndex36];
            output += aui.tabPane({
                content: '<ul class="results-list"></ul><div class="spinner"></div>',
                id: opt_data.id + '-tab-pane-' + tabIndex36,
                isActive: tabIndex36 == 0,
                extraClasses: 'results',
                extraAttributes: {
                    'data-tab-id': tabIndex36
                }
            });
        }
        output += '</div>';
    } else {
        output += '<div class="results"><ul class="results-list"></ul><div class="spinner"></div></div>';
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelector.soyTemplateName = 'stash.widget.searchableSelector';
}

stash.widget.searchableSelectorResults = function(opt_data, opt_ignored) {
    var output = '';
    var resultList50 = opt_data.values;
    var resultListLen50 = resultList50.length;
    for (var resultIndex50 = 0; resultIndex50 < resultListLen50; resultIndex50++) {
        var resultData50 = resultList50[resultIndex50];
        output += '<li class="result ' + ((opt_data.isPreload) ? 'preload' : '') + '"><a href="' + soy.$$escapeHtml(resultData50.url ? resultData50.url : '#') + '" tabindex="-1" data-id="' + soy.$$escapeHtml(resultData50.id) + '" data-item="' + soy.$$escapeHtml(JSON.stringify(resultData50).replace(/\//g, '\\/')) + '">' + soy.$$escapeHtml(resultData50.name) + '</a></li>';
    }
    output += (opt_data.isLastPage) ? (opt_data.size > 0) ? '<li class="no-results">' + soy.$$escapeHtml(opt_data.noMoreResultsText ? opt_data.noMoreResultsText : "No more results") + '</li>' : '<li class="no-results">' + soy.$$escapeHtml(opt_data.noResultsText ? opt_data.noResultsText : "No results") + '</li>' : '';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelectorResults.soyTemplateName = 'stash.widget.searchableSelectorResults';
}

stash.widget.searchableSelectorTrigger = function(opt_data, opt_ignored) {
    return '' + stash.widget.searchableSelectorTriggerGeneric({
        id: opt_data.id,
        content: '' + stash.widget.searchableSelectorTriggerContent(opt_data),
        autofocus: opt_data.autofocus,
        extraClasses: opt_data.extraClasses,
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelectorTrigger.soyTemplateName = 'stash.widget.searchableSelectorTrigger';
}

stash.widget.searchableSelectorTriggerGeneric = function(opt_data, opt_ignored) {
    return '<button ' + ((opt_data.id) ? 'id="' + soy.$$escapeHtml(opt_data.id) + '" ' : '') + 'type="button" class="aui-button searchable-selector-trigger' + aui.renderExtraClasses(opt_data) + '"' + ((opt_data.autofocus) ? ' autofocus' : '') + aui.renderExtraAttributes(opt_data) + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</button>';
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelectorTriggerGeneric.soyTemplateName = 'stash.widget.searchableSelectorTriggerGeneric';
}

stash.widget.searchableSelectorTriggerWithField = function(opt_data, opt_ignored) {
    return '' + stash.widget.searchableSelectorTrigger(opt_data) + widget.aui.form.input({
        id: opt_data.fieldId ? opt_data.fieldId : opt_data.id + '-field',
        name: opt_data.fieldName ? opt_data.fieldName : opt_data.id + '-field',
        initialValue: opt_data.item ? opt_data.item.id : null,
        type: 'hidden'
    });
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelectorTriggerWithField.soyTemplateName = 'stash.widget.searchableSelectorTriggerWithField';
}

stash.widget.searchableSelectorTriggerContent = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + ((opt_data.item) ? '<span class="name" data-id="' + soy.$$escapeHtml(opt_data.item.id) + '" data-item="' + soy.$$escapeHtml(JSON.stringify(opt_data.item).replace(/\//g, '\\/')) + '">' + soy.$$escapeHtml(opt_data.item.name) + '</span>' : '<span class="placeholder">' + soy.$$escapeHtml(opt_data.text ? opt_data.text : "Select item") + '</span>');
}
;
if (goog.DEBUG) {
    stash.widget.searchableSelectorTriggerContent.soyTemplateName = 'stash.widget.searchableSelectorTriggerContent';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:searchable-selector', location = '/static/widget/searchable-selector/searchable-selector.js' */
define("widget/searchable-selector", ["aui", "jquery", "lodash", "util/ajax", "util/dom-event", "util/events", "util/navigator", "util/promise", "widget/keyboard-controller", "widget/paged-scrollable"], function(M, D, N, L, H, O, J, B, G, K) {
    var C = G.TabKeyboardController;
    var E = G.ListKeyboardController;
    var I = 0;
    function F(Q, P) {
        return this.init.apply(this, arguments)
    }
    F.prototype.defaults = {
        id: null,
        extraClasses: null,
        namespace: "searchable-selector",
        url: null,
        tabs: null,
        searchable: true,
        searchPlaceholder: null,
        queryParamKey: "filter",
        queryParamsBuilder: null,
        pageSize: 20,
        statusCodeHandlers: {},
        followLinks: false,
        hideDialogOnSelect: true,
        itemSelectedEvent: "stash.widget.searchableSelector.itemSelected",
        context: null,
        field: null,
        itemDataKey: "item",
        template: stash.widget.searchableSelector,
        resultsTemplate: stash.widget.searchableSelectorResults,
        noResultsText: null,
        noMoreResultsText: null,
        triggerContentTemplate: stash.widget.searchableSelectorTriggerContent,
        triggerPlaceholder: null,
        preloadData: null,
        alwaysShowPreload: false,
        dataTransform: null,
        postOptionsInit: null,
        clearResultsOnSearch: true,
        popUpOffsetX: 0,
        popUpOffsetY: -1,
        width: 350
    };
    F.constructDataPageFromPreloadArray = function(P) {
        if (!N.isArray(P)) {
            return null
        }
        return {
            values: P,
            isLastPage: false,
            size: P.length,
            start: 0,
            limit: P.length
        }
    }
    ;
    F.prototype.tabOptionKeys = ["label", "url", "resultsTemplate", "noResultsText", "noMoreResultsText", "dataTransform", "queryParamKey", "preloadData", "searchPlaceholder"];
    F.prototype.init = function(R, Q) {
        var P = this;
        this.instanceId = I++;
        this.$trigger = D(R);
        this.setOptions(Q);
        this.scrollables = [];
        this.scrollableDataStores = [];
        if (!this._getOptionVal("id")) {
            this.options.id = this._getOptionVal("namespace") + "-" + this.instanceId
        }
        if (this.options.tabs && this.options.tabs.length) {
            this.tabs = N.map(this.options.tabs, function(V) {
                return D.extend(true, {}, N.pick(P.options, P.tabOptionKeys), V)
            })
        }
        var U = this._getOption("postOptionsInit");
        if (N.isFunction(U)) {
            U.call(this)
        }
        var T;
        this.blockShortcutPropagation = T = function(V) {
            var W = (this === document);
            if (V.keyCode === M.keyCode.ESCAPE) {
                V[W ? "stopImmediatePropagation" : "stopPropagation"]();
                P.dialog.hide()
            } else {
                if (!W) {
                    V.stopPropagation()
                }
            }
        }
        ;
        var S = P._getOptionVal("externalSearchField");
        this.dialog = M.InlineDialog(this.$trigger, this._getOptionVal("id"), function(W, V, X) {
            if (!W.data("initialised")) {
                P._initialiseDialogContent(W)
            }
            X();
            if (!S) {
                N.defer(N.bind(P.setFocus, P))
            }
        }, {
            offsetX: this._getOptionVal("popUpOffsetX"),
            offsetY: this._getOptionVal("popUpOffsetY"),
            noBind: !!S,
            width: this._getOptionVal("width"),
            hideCallback: function() {
                if (P.$content.is(document.activeElement) || D.contains(P.$content[0], document.activeElement)) {
                    P.$trigger.focus()
                }
                D(document).add(P.dialog).off("keydown keypress", T)
            },
            initCallback: function() {
                D(document).add(P.dialog).on("keydown keypress", T)
            }
        });
        if (this._getOptionVal("searchable") && S) {
            this.$searchField = D(S);
            this._initialiseSearchOnInput()
        }
        if (this.$trigger.find(".name").length) {
            this._selectedItem = this._getItemFromTrigger()
        }
        M.bind("hide.dialog", function(W, V) {
            if (P.$trigger.closest(V.dialog.popup.element).length) {
                P.dialog.hide()
            }
        });
        return this
    }
    ;
    F.prototype.getSelectedItem = function() {
        return this._selectedItem
    }
    ;
    F.prototype.setSelectedItem = function(P) {
        if (D.isPlainObject(P) && P.id != null) {
            if (!this._selectedItem || this._selectedItem.id !== P.id) {
                this._itemSelected(P)
            }
        }
    }
    ;
    F.prototype.clearSelection = function() {
        this._selectedItem = null;
        if (this._getOptionVal("field")) {
            D(this._getOptionVal("field")).val("")
        }
        this.resetTrigger()
    }
    ;
    F.prototype._getItemFromTrigger = function() {
        var P = this.$trigger.find(".name");
        return D.extend({}, this._buildObjectFromElementDataAttributes(P), {
            name: P.text()
        })
    }
    ;
    F.prototype._buildObjectFromElementDataAttributes = function(P) {
        return D(P).data(this._getOptionVal("itemDataKey"))
    }
    ;
    F.prototype._initialiseDialogContent = function(Q) {
        var P = this;
        var R = this._getOptionVal("searchable");
        var S = this._getOptionVal("externalSearchField");
        Q.append(this._getOption("template")({
            id: this._getOptionVal("id"),
            tabs: this.tabs,
            searchable: !S && R,
            searchPlaceholder: this._getOptionVal("searchPlaceholder"),
            extraClasses: this._getOptionVal("extraClasses")
        }));
        Q.closest(".aui-inline-dialog").addClass("searchable-selector-dialog");
        if (R && !S) {
            this.$searchField = Q.find("input.filter");
            this._initialiseSearchOnInput()
        }
        if (this.tabs) {
            var T = Q.find("ul.tabs-menu a");
            T.on("tabSelect", function(V, U) {
                P.currentTabId = U.tab.parent().data("tab-id");
                if (P._getOptionVal("searchable") || P._getDataStoreForScrollable().length === 0) {
                    P._populateScrollable()
                }
                P._resultsKeyboardController.setListElement(P._getCurrentScrollable().$scrollElement.find("ul.results-list"));
                if (R) {
                    P.$searchField.focus()
                }
                P._updateSearchPlaceholder()
            });
            T.on("click", function(U) {
                if (D(this).parent().hasClass("active-tab")) {
                    U.stopPropagation();
                    U.preventDefault()
                }
            });
            T.on("keydown", function(V) {
                if (V.keyCode === M.keyCode.ENTER) {
                    var U = D(this);
                    if (U.parent("li").hasClass("active-tab")) {
                        V.preventDefault()
                    } else {
                        U.click()
                    }
                }
            });
            M.tabs.setup()
        }
        Q.find(".results").each(function() {
            P.scrollables.push(P._createScrollable(D(this)));
            P.scrollableDataStores.push([])
        });
        Q.on("click", ".result a", function(U) {
            P.selectItem(U, D(this))
        });
        this._initialiseKeyboardNavigation(Q);
        this._initialiseMouseNavigation(Q);
        this._populateScrollable();
        this.$content = Q;
        Q.data("initialised", true)
    }
    ;
    F.prototype._initialiseSearchOnInput = function() {
        var Q = this;
        var R = this._getSearchTerm();
        var S = this._getOptionVal("externalSearchField");
        var T = B.delay(N.bind(this._handleSearchInput, this), 350);
        var P = N.bind(function() {
            if (R !== (R = this._getSearchTerm())) {
                if (!this._pendingSearch) {
                    this._pendingSearch = T(R);
                    this._pendingSearch.always(function() {
                        Q._pendingSearch = null
                    })
                } else {
                    this._pendingSearch.reset(R)
                }
            }
        }, this);
        this.$searchField.on("keydown.searchable-selector input.searchable-selector", N.bind(function(U) {
            if (S) {
                if (U.which === M.keyCode.ESCAPE) {
                    this._pendingSearch && this._pendingSearch.abort()
                } else {
                    if (U.which === M.keyCode.DOWN && this._shouldSearch(R)) {
                        this.dialog.show()
                    } else {
                        if (U.which === M.keyCode.ENTER && !this.dialog.is(":visible")) {
                            this._pendingSearch && this._pendingSearch.done(function() {
                                var V = Q._getCurrentScrollable().$scrollElement.find("ul.results-list li.result:first");
                                Q._clickItem(V)
                            })
                        }
                    }
                }
            }
            N.defer(P)
        }, this))
    }
    ;
    F.prototype._handleSearchInput = function(P) {
        var Q = this._getOptionVal("externalSearchField");
        if (Q) {
            if (this._shouldSearch(P)) {
                if (!this.dialog.is(":visible")) {
                    this.dialog.show()
                }
                return this._populateScrollable()
            } else {
                this.dialog.hide();
                return D.Deferred().reject().promise()
            }
        } else {
            return this._populateScrollable()
        }
    }
    ;
    F.prototype._initialiseKeyboardNavigation = function(R) {
        var S = this;
        var Q;
        var T = false;
        var P = function(V) {
            var W = S.dialog.is(":visible");
            if (S._getOptionVal("externalSearchField") && !W) {
                return
            }
            if (T && !W) {
                S.$trigger.click()
            } else {
                S._clickItem(V)
            }
        };
        if (this._resultsKeyboardController) {
            this._resultsKeyboardController.destroy()
        }
        if (this.$searchField) {
            Q = this.$searchField
        } else {
            if (this.tabs) {
                Q = R.find("ul.tabs-menu")
            } else {
                Q = this.$trigger;
                T = true
            }
        }
        var U = S._getCurrentScrollable().$scrollElement.find("ul.results-list");
        this._resultsKeyboardController = new E(Q,U,{
            wrapAround: false,
            focusedClass: "focused",
            itemSelector: "li.result",
            requestMore: function() {
                var V = S._getCurrentScrollable().loadAfter();
                return V && V.then(function(W) {
                    return W.isLastPage
                })
            },
            onSelect: function(V) {
                if (S._pendingSearch) {
                    S._pendingSearch.done(function() {
                        var W = U.find("li.result:first");
                        if (W.length) {
                            P(W)
                        }
                    })
                } else {
                    P(V)
                }
            },
            focusIntoView: true,
            adjacentItems: S._getOptionVal("adjacentItems")
        });
        if (this._tabKeyboardController) {
            this._tabKeyboardController.destroy()
        }
        if (J.isMozilla() || J.isWebkit()) {
            R.addClass("override-focus-style")
        }
        this._tabKeyboardController = new C(R)
    }
    ;
    F.prototype._initialiseMouseNavigation = function(P) {
        var Q = "focused";
        P.on("mousemove", "li", function() {
            if (D(this).find("." + Q).hasClass(Q)) {
                return
            }
            P.find("." + Q).removeClass(Q);
            D(this).addClass(Q)
        })
    }
    ;
    F.prototype._clickItem = function(P) {
        P.children("a").each(function() {
            this.click()
        })
    }
    ;
    F.prototype.setFocus = function() {
        if (this.$searchField) {
            this.$searchField.focus()
        } else {
            if (this.tabs) {
                this.$content.find("ul.tabs-menu a").first().focus()
            } else {
                this.$trigger.focus()
            }
        }
    }
    ;
    F.prototype._createScrollable = function(P) {
        var Q = new K(P,{
            pageSize: this._getOptionVal("pageSize"),
            bufferPixels: 0,
            preventOverscroll: true,
            paginationContext: this.options.paginationContext
        });
        Q.requestData = N.bind(this.getResults, this, Q);
        Q.attachNewContent = N.bind(this.addResultsToList, this, Q, false);
        return Q
    }
    ;
    F.prototype._populateScrollable = function(Q) {
        Q = Q || this._getCurrentScrollable();
        this._emptyScrollable(Q);
        var P = this._getPreloadData();
        var S = 0;
        if (P) {
            S = this.addResultsToList(Q, true, P)
        }
        var R = Q.init();
        if (S > 0) {
            return D.Deferred().resolve().promise()
        } else {
            return R
        }
    }
    ;
    F.prototype._getPreloadData = function() {
        var Q = this._getOptionVal("preloadData");
        var R = this._getSearchTerm();
        if (Q && (this._getOptionVal("alwaysShowPreload") || R === "")) {
            var P = this._getOption("dataTransform");
            if (N.isFunction(P)) {
                Q = P.call(this, Q, R)
            }
        } else {
            Q = null
        }
        return Q
    }
    ;
    F.prototype._emptyScrollable = function(P) {
        P = P || this._getCurrentScrollable();
        P.reset();
        this._getDataStoreForScrollable(P).length = 0;
        if (this._getOptionVal("clearResultsOnSearch")) {
            P.$scrollElement.children("ul.results-list").empty()
        }
    }
    ;
    F.prototype._getCurrentScrollable = function() {
        return this.scrollables[this.tabs && this.currentTabId ? this.currentTabId : 0]
    }
    ;
    F.prototype._getDataStoreForScrollable = function(Q) {
        if (!Q) {
            return this.scrollableDataStores[this.tabs && this.currentTabId ? this.currentTabId : 0]
        }
        var P = N.indexOf(this.scrollables, Q);
        if (P !== -1) {
            return this.scrollableDataStores[P]
        } else {
            return null
        }
    }
    ;
    F.prototype._getSearchTerm = function() {
        return (this.$searchField) ? this.$searchField.val() : ""
    }
    ;
    F.prototype._updateSearchPlaceholder = function() {
        if (this.$searchField) {
            this.$searchField.attr("placeholder", this._getOptionVal("searchPlaceholder"))
        }
    }
    ;
    F.prototype._getOptionVal = function(P) {
        return this._getOption(P, true)
    }
    ;
    F.prototype._getOption = function(P, R) {
        var Q;
        if (this.tabs && N.contains(this.tabOptionKeys, P)) {
            Q = this.tabs[this.currentTabId || 0][P]
        } else {
            Q = this.options[P]
        }
        return (R) ? A(Q, this) : Q
    }
    ;
    F.prototype.setOptions = function(P) {
        this.options = D.extend(true, {}, this.defaults, P)
    }
    ;
    F.prototype.getResults = function(U, W, P) {
        var Q = this;
        if (this.currentXHR && this.currentXHR.abort) {
            this.currentXHR.abort()
        }
        var T = this._getOption("queryParamsBuilder") || this._defaultQueryParamsBuilder;
        var S = T.call(this, this._getSearchTerm(), W, P);
        if (S === null) {
            return D.Deferred().reject().promise()
        }
        var V = U.$scrollElement.children("ul.results-list");
        this._showSpinner(U);
        V.scrollTop(V[0].scrollHeight);
        var R = this.currentXHR = L.rest({
            url: this._getOptionVal("url"),
            data: S,
            statusCode: this._getOptionVal("statusCodeHandlers")
        });
        R.always(function() {
            Q._hideSpinner(U);
            Q.currentXHR = null
        });
        return R
    }
    ;
    F.prototype._showSpinner = function(P) {
        P.$scrollElement.children(".spinner").show().spin()
    }
    ;
    F.prototype._hideSpinner = function(P) {
        P.$scrollElement.children(".spinner").spinStop().hide()
    }
    ;
    F.prototype._shouldSearch = function(P) {
        var Q = this._getOption("queryParamsBuilder") || this._defaultQueryParamsBuilder;
        return Q.call(this, P, 0, this._getOptionVal("pageSize")) != null
    }
    ;
    F.prototype._defaultQueryParamsBuilder = function(Q, S, P) {
        var R = {
            start: S,
            limit: P
        };
        if (this._getOptionVal("searchable")) {
            R[this._getOptionVal("queryParamKey")] = Q
        }
        return R
    }
    ;
    F.prototype.addResultsToList = function(V, Q, T) {
        var X = this._getOption("dataTransform");
        var W;
        if (N.isFunction(X)) {
            T = X.call(this, T, this._getSearchTerm())
        }
        if (!Q && (W = this._getPreloadData())) {
            T = this.dedupeData(T, W)
        }
        T = D.extend({}, T, {
            isPreload: Q,
            noResultsText: this._getOptionVal("noResultsText"),
            noMoreResultsText: this._getOptionVal("noMoreResultsText")
        });
        var U = D(this._getOption("resultsTemplate")(T));
        var S = this._getDataStoreForScrollable(V);
        S.push.apply(S, T.values);
        var R = V.$scrollElement.children("ul.results-list");
        var P = T.start === 0 && !(W && W.size > 0) && (!Q || T.size > 0);
        if (P) {
            R.empty()
        }
        R.append(U).attr("data-last-updated", new Date().getTime());
        if (P && T.size > 0) {
            this._resultsKeyboardController.moveToNext()
        }
        return T.size
    }
    ;
    F.prototype.dedupeData = function(Q, P) {
        if (Q && Q.values && P && P.values) {
            Q = D.extend(true, {}, Q);
            Q.values = N.reject(Q.values, function(R) {
                return N.find(P.values, function(S) {
                    return R.id === S.id
                })
            })
        }
        return Q
    }
    ;
    F.prototype.selectItem = function(R, Q) {
        var S = Q.data("id");
        var P = N.find(this._getDataStoreForScrollable(), function(T) {
            return T.id === S
        });
        if (Q.attr("href") !== "#" && (this._getOptionVal("followLinks") || !H.openInSameTab)) {} else {
            R.preventDefault()
        }
        if (!this._selectedItem || this._selectedItem.id !== P.id) {
            this._itemSelected(P)
        }
        if (this._getOptionVal("hideDialogOnSelect")) {
            this.dialog.hide()
        }
    }
    ;
    F.prototype._itemSelected = function(P) {
        this._selectedItem = P;
        if (this._getOptionVal("field")) {
            D(this._getOptionVal("field")).val(P.id)
        }
        this.updateTrigger({
            item: P
        });
        O.trigger(this._getOptionVal("itemSelectedEvent"), this, P, this._getOptionVal("context"))
    }
    ;
    F.prototype.updateTrigger = function(P) {
        if (!this._getOptionVal("externalSearchField")) {
            this.$trigger.html(this._getOption("triggerContentTemplate")(P || {}))
        }
    }
    ;
    F.prototype.resetTrigger = function() {
        this.updateTrigger({
            text: this._getOptionVal("triggerPlaceholder")
        })
    }
    ;
    F.prototype.destroy = function() {
        if (this.blockShortcutPropagation) {
            D(document).add(this.dialog).off("keydown keypress", this.blockShortcutPropagation)
        }
        if (this._getOptionVal("externalSearchField")) {
            this.$searchField.off(".searchable-selector")
        }
        if (this.dialog) {
            this.dialog.hide();
            this.dialog.remove();
            this.dialog = null
        }
        if (this._resultsKeyboardController) {
            this._resultsKeyboardController.destroy();
            this._resultsKeyboardController = null
        }
        if (this._tabKeyboardController) {
            this._tabKeyboardController.destroy();
            this._tabKeyboardController = null
        }
        this.$trigger = null;
        this.scrollables = null;
        this.scrollableDataStores = null;
        this.tabs = null;
        this._initialiseDialogContent = D.noop
    }
    ;
    function A(Q, P) {
        return N.isFunction(Q) ? Q.call(P) : Q
    }
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:revision-reference-selector', location = '/static/feature/repository/revision-reference-selector/revision-reference-selector.js' */
define("feature/repository/revision-reference-selector", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "util/events", "model/page-state", "model/repository", "model/revision-reference", "widget/searchable-selector"], function(I, C, J, B, G, K, H, D, A, E) {
    function F(M, L) {
        return this.init.apply(this, arguments)
    }
    C.extend(F.prototype, E.prototype);
    F.prototype._addRefTypeAndRepositoryToResults = function(M) {
        if (M && M.values) {
            var N = C.extend(true, {}, M);
            var L = this._getCurrentType();
            J.each(N.values, J.bind(function(O) {
                if (!O.type) {
                    O.type = L
                }
                if (!O.repository) {
                    O.repository = this.repository && this.repository.toJSON()
                }
            }, this));
            return N
        }
        return M
    }
    ;
    F.prototype.defaults = C.extend(true, {}, E.prototype.defaults, {
        tabs: [{
            label: "Branches",
            type: A.type.BRANCH,
            url: function() {
                return this.getBranchesUrl()
            },
            resultsTemplate: stash.feature.repository.revisionReferenceSelectorBranchResults,
            searchPlaceholder: "Search for a branch"
        }, {
            label: "Tags",
            type: A.type.TAG,
            url: function() {
                return this.getTagsUrl()
            },
            resultsTemplate: stash.feature.repository.revisionReferenceSelectorTagResults,
            searchPlaceholder: "Search for a tag"
        }, {
            label: "Commits",
            type: A.type.COMMIT,
            url: function() {
                return this.getCommitsUrl()
            },
            resultsTemplate: stash.feature.repository.revisionReferenceSelectorCommitResults,
            searchPlaceholder: "Search for a commit"
        }],
        queryParamKey: "filterText",
        namespace: "revision-reference-selector",
        itemSelectedEvent: "stash.feature.repository.revisionReferenceSelector.revisionRefChanged",
        itemUnselectedEvent: "stash.feature.repository.revisionReferenceSelector.revisionRefUnselected",
        itemDataKey: "revision-ref",
        statusCodeHandlers: G.ignore404WithinRepository(),
        triggerContentTemplate: stash.feature.repository.revisionReferenceSelectorTriggerContent,
        extraClasses: "revision-reference-selector",
        repository: function() {
            return H.getRepository()
        },
        show: {
            branches: true,
            tags: true,
            commits: false
        },
        dataTransform: F.prototype._addRefTypeAndRepositoryToResults,
        postOptionsInit: function() {
            this.setRepository(this._getOptionVal("repository"))
        },
        paginationContext: "revision-reference-selector"
    });
    F.prototype.init = function(M, L) {
        E.prototype.init.apply(this, arguments);
        return this
    }
    ;
    F.prototype.setOptions = function(N) {
        if (N.extraClasses) {
            N.extraClasses = this.defaults.extraClasses + " " + C.trim(N.extraClasses)
        }
        N = C.extend(true, {}, this.defaults, N);
        var M = {
            branches: A.type.BRANCH.id,
            tags: A.type.TAG.id,
            commits: A.type.COMMIT.id
        };
        var L = J.filter(M, function(P, O) {
            return N.show[O]
        });
        N.tabs = J.filter(N.tabs, function(O) {
            return J.indexOf(L, O.type.id) !== -1
        });
        this.options = N
    }
    ;
    F.prototype._getItemFromTrigger = function() {
        var L = this.$trigger.find(".name");
        return new A(C.extend({}, this._buildObjectFromElementDataAttributes(L), {
            displayId: L.text(),
            repository: this.repository
        }))
    }
    ;
    F.prototype.getBranchesUrl = function() {
        return B.rest().project(this.repository.getProject()).repo(this.repository).branches().build()
    }
    ;
    F.prototype.getTagsUrl = function() {
        return B.rest().project(this.repository.getProject()).repo(this.repository).tags().build()
    }
    ;
    F.prototype.getCommitsUrl = function() {
        return B.rest().project(this.repository.getProject()).repo(this.repository).commits().build()
    }
    ;
    F.prototype.getRepository = function() {
        return this.repository
    }
    ;
    F.prototype.setRepository = function(L) {
        var N = this.repository;
        if (L instanceof D && !L.isEqual(N)) {
            this.repository = L;
            if (N) {
                var M = this._getCurrentScrollable();
                if (M) {
                    this._emptyScrollable(M);
                    M.init()
                }
                this.clearSelection();
                this.dialog.hide();
                K.trigger("stash.feature.repository.revisionReferenceSelector.repoChanged", this, L, this._getOptionVal("context"))
            }
        }
    }
    ;
    F.prototype._getCurrentType = function() {
        return this.tabs[this.currentTabId || 0].type
    }
    ;
    F.prototype.setSelectedItem = function(L) {
        if (L instanceof A && !L.isEqual(this._selectedItem)) {
            this._itemSelected(L)
        }
    }
    ;
    F.prototype.clearSelection = function() {
        E.prototype.clearSelection.apply(this, arguments);
        K.trigger(this._getOptionVal("itemUnselectedEvent"), this, null, this._getOptionVal("context"))
    }
    ;
    F.prototype._itemSelected = function(N) {
        var L;
        var M;
        if (N instanceof A) {
            L = N.toJSON();
            M = N
        } else {
            L = J.pick(N, J.keys(A.prototype.namedAttributes));
            M = new A(L)
        }
        this._selectedItem = M;
        if (this._getOptionVal("field")) {
            C(this._getOptionVal("field")).val(L.id)
        }
        this.updateTrigger({
            ref: L
        });
        K.trigger(this._getOptionVal("itemSelectedEvent"), this, M, this._getOptionVal("context"))
    }
    ;
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:revision-reference-selector', location = '/static/feature/repository/revision-reference-selector/revision-reference-selector.soy' */
// This file was automatically generated from revision-reference-selector.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.revisionReferenceSelectorBranchResults = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.revisionReferenceSelectorResults({
        values: opt_data.values,
        isLastPage: opt_data.isLastPage,
        size: opt_data.size,
        isPreload: opt_data.isPreload,
        noResultsText: "No branches",
        noMoreResultsText: "No more branches"
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorBranchResults.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorBranchResults';
}

stash.feature.repository.revisionReferenceSelectorTagResults = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.revisionReferenceSelectorResults({
        values: opt_data.values,
        isLastPage: opt_data.isLastPage,
        size: opt_data.size,
        isPreload: opt_data.isPreload,
        noResultsText: "No tags",
        noMoreResultsText: "No more tags"
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorTagResults.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorTagResults';
}

stash.feature.repository.revisionReferenceSelectorCommitResults = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.revisionReferenceSelectorResults({
        values: opt_data.values,
        isLastPage: opt_data.isLastPage,
        size: opt_data.size,
        isPreload: opt_data.isPreload,
        noResultsText: "No commits",
        noMoreResultsText: "No more commits"
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorCommitResults.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorCommitResults';
}

stash.feature.repository.revisionReferenceSelectorResults = function(opt_data, opt_ignored) {
    var output = '';
    var refList27 = opt_data.values;
    var refListLen27 = refList27.length;
    for (var refIndex27 = 0; refIndex27 < refListLen27; refIndex27++) {
        var refData27 = refList27[refIndex27];
        output += '<li class="result ' + ((opt_data.isPreload) ? 'preload' : '') + '"><a href="' + soy.$$escapeHtml(refData27.url ? refData27.url : '#') + '" data-id="' + soy.$$escapeHtml(refData27.id) + '" tabindex="-1">' + stash.feature.repository.revisionReferenceSelectorRef({
            ref: refData27
        }) + '</a></li>';
    }
    output += (opt_data.isLastPage) ? (opt_data.size > 0) ? '<li class="no-results">' + soy.$$escapeHtml(opt_data.noMoreResultsText ? opt_data.noMoreResultsText : "No more results") + '</li>' : '<li class="no-results">' + soy.$$escapeHtml(opt_data.noResultsText ? opt_data.noResultsText : "No results") + '</li>' : '';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorResults.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorResults';
}

stash.feature.repository.revisionReferenceSelectorTrigger = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + stash.widget.searchableSelectorTriggerGeneric({
        id: opt_data.id,
        content: '' + stash.feature.repository.revisionReferenceSelectorTriggerContent(opt_data),
        autofocus: opt_data.autofocus,
        extraClasses: 'revision-reference-selector-trigger' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorTrigger.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorTrigger';
}

stash.feature.repository.revisionReferenceSelectorTriggerWithField = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + stash.feature.repository.revisionReferenceSelectorTrigger(opt_data) + widget.aui.form.input({
        id: opt_data.fieldId ? opt_data.fieldId : opt_data.id ? opt_data.id + '-field' : opt_data.id,
        name: opt_data.fieldName ? opt_data.fieldName : opt_data.id + '-field',
        initialValue: opt_data.ref ? opt_data.ref.id : null,
        type: 'hidden'
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorTriggerWithField.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorTriggerWithField';
}

stash.feature.repository.revisionReferenceSelectorTriggerContent = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + ((opt_data.ref) ? stash.feature.repository.revisionReferenceSelectorRef(opt_data) : '<span class="placeholder">' + soy.$$escapeHtml(opt_data.text ? opt_data.text : "Select revision") + '</span>');
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorTriggerContent.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorTriggerContent';
}

stash.feature.repository.revisionReferenceSelectorRef = function(opt_data, opt_ignored) {
    return ((opt_data.ref.type) ? aui.icons.icon({
        size: 'small',
        useIconFont: true,
        iconFontSet: 'devtools',
        icon: opt_data.ref.type.id,
        accessibilityText: opt_data.ref.type.name
    }) : '') + '<span class="name" title="' + soy.$$escapeHtml(opt_data.ref.displayId) + '" data-id="' + soy.$$escapeHtml(opt_data.ref.id) + '" data-revision-ref="' + soy.$$escapeHtml(JSON.stringify(opt_data.ref).replace(/\//g, '\\/')) + '">' + soy.$$escapeHtml(opt_data.ref.displayId ? opt_data.ref.displayId : opt_data.ref.id) + '</span>';
}
;
if (goog.DEBUG) {
    stash.feature.repository.revisionReferenceSelectorRef.soyTemplateName = 'stash.feature.repository.revisionReferenceSelectorRef';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-branch-selector', location = '/static/feature/repository/branch-selector/branch-selector.js' */
define("feature/repository/branch-selector", ["aui", "jquery", "feature/repository/revision-reference-selector"], function(A, D, B) {
    function C(F, E) {
        E = D.extend({
            show: {
                branches: true,
                tags: false,
                commits: false
            },
            triggerPlaceholder: "Select branch",
            paginationContext: "branch-selector"
        }, E);
        return new B(F,E)
    }
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-branch-selector', location = '/static/feature/repository/branch-selector/branch-selector.soy' */
// This file was automatically generated from branch-selector.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.branchSelectorTrigger = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.revisionReferenceSelectorTrigger({
        id: opt_data.id,
        ref: opt_data.ref,
        text: opt_data.text ? opt_data.text : "Select branch",
        autofocus: opt_data.autofocus,
        extraClasses: opt_data.extraClasses,
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.branchSelectorTrigger.soyTemplateName = 'stash.feature.repository.branchSelectorTrigger';
}

stash.feature.repository.branchSelectorTriggerWithField = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.revisionReferenceSelectorTriggerWithField({
        id: opt_data.id,
        ref: opt_data.ref,
        text: opt_data.text ? opt_data.text : "Select branch",
        fieldName: opt_data.fieldName,
        fieldId: opt_data.fieldId,
        autofocus: opt_data.autofocus,
        extraClasses: opt_data.extraClasses,
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.branchSelectorTriggerWithField.soyTemplateName = 'stash.feature.repository.branchSelectorTriggerWithField';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:project-avatar', location = '/static/feature/project/project-avatar/project-avatar.soy' */
// This file was automatically generated from project-avatar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.project.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.project == 'undefined') {
    stash.feature.project = {};
}

stash.feature.project.avatar = function(opt_data, opt_ignored) {
    return '' + aui.avatar.avatar({
        tagName: opt_data.tagName,
        size: opt_data.size,
        avatarImageUrl: opt_data.imageUrl ? opt_data.imageUrl : opt_data.project ? require('stash/api/util/navbuilder')._avatarUrl(opt_data.project, ({
            XSMALL: 32,
            SMALL: 48,
            MEDIUM: 64,
            LARGE: 96,
            XLARGE: 128,
            XXLARGE: 192,
            XXXLARGE: 256
        })[opt_data.size.toUpperCase()]).build() : '',
        accessibilityText: opt_data.project ? opt_data.project.name : '',
        title: opt_data.tooltip,
        badgeContent: opt_data.badgeContent,
        isProject: !opt_data.project.owner,
        imageClasses: opt_data.imageClasses,
        extraClasses: (opt_data.hideBadge ? ' badge-hidden' : '') + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.feature.project.avatar.soyTemplateName = 'stash.feature.project.avatar';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:base-repository-selector', location = '/static/feature/repository/base-repository-selector/base-repository-selector.js' */
define("feature/repository/base-repository-selector", ["aui", "jquery", "lodash", "util/events", "model/repository", "widget/searchable-selector"], function(C, G, D, F, B, A) {
    function E(I, H) {
        return this.init.apply(this, arguments)
    }
    G.extend(E.prototype, A.prototype);
    E.constructDataPageFromPreloadArray = A.constructDataPageFromPreloadArray;
    E.prototype.defaults = G.extend(true, {}, A.prototype.defaults, {
        searchable: false,
        extraClasses: "base-repository-selector",
        resultsTemplate: stash.feature.repository.baseRepositorySelectorResults,
        triggerContentTemplate: stash.feature.repository.baseRepositorySelectorTriggerContent,
        searchPlaceholder: "Search for a repository",
        namespace: "base-repository-selector",
        itemSelectedEvent: "stash.feature.repository.repositorySelector.repositoryChanged",
        itemDataKey: "repository",
        paginationContext: "base-repository-selector"
    });
    E.prototype._getItemFromTrigger = function() {
        var H = this.$trigger.find(".repository");
        return new B(G.extend({}, this._buildObjectFromElementDataAttributes(H), {
            name: H.children(".name").text() || undefined
        }))
    }
    ;
    E.prototype.setSelectedItem = function(H) {
        if (H instanceof B && !H.isEqual(this._selectedItem)) {
            this._itemSelected(H)
        }
    }
    ;
    E.prototype._itemSelected = function(H) {
        var I;
        if (H instanceof B) {
            I = H;
            H = H.toJSON()
        } else {
            H = D.pick(H, D.keys(B.prototype.namedAttributes));
            I = new B(H)
        }
        this._selectedItem = I;
        if (this._getOptionVal("field")) {
            G(this._getOptionVal("field")).val(H.id)
        }
        this.updateTrigger({
            repository: H
        });
        F.trigger(this._getOptionVal("itemSelectedEvent"), this, I, this._getOptionVal("context"))
    }
    ;
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:base-repository-selector', location = '/static/feature/repository/base-repository-selector/base-repository-selector.soy' */
// This file was automatically generated from base-repository-selector.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.baseRepositorySelectorResults = function(opt_data, opt_ignored) {
    var output = '';
    var repositoryList3 = opt_data.values;
    var repositoryListLen3 = repositoryList3.length;
    for (var repositoryIndex3 = 0; repositoryIndex3 < repositoryListLen3; repositoryIndex3++) {
        var repositoryData3 = repositoryList3[repositoryIndex3];
        output += '<li class="result ' + ((opt_data.isPreload) ? 'preload' : '') + '"><a href="' + soy.$$escapeHtml(require('stash/api/util/navbuilder').project(repositoryData3.project.key).repo(repositoryData3.slug).browse().build()) + '" data-id="' + soy.$$escapeHtml(repositoryData3.id) + '" tabindex="-1">' + stash.feature.repository.baseRepositorySelectorRepository({
            repository: repositoryData3
        }) + '</a></li>';
    }
    output += (opt_data.isLastPage) ? '<li class="no-results">' + soy.$$escapeHtml(opt_data.noMoreResultsText ? opt_data.noMoreResultsText : "No more repositories") + '</li>' : '';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.repository.baseRepositorySelectorResults.soyTemplateName = 'stash.feature.repository.baseRepositorySelectorResults';
}

stash.feature.repository.baseRepositorySelectorTrigger = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + stash.widget.searchableSelectorTriggerGeneric({
        id: opt_data.id,
        content: '' + stash.feature.repository.baseRepositorySelectorTriggerContent(opt_data),
        autofocus: opt_data.autofocus,
        extraClasses: 'base-repository-selector-trigger' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: opt_data.extraAttributes
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.baseRepositorySelectorTrigger.soyTemplateName = 'stash.feature.repository.baseRepositorySelectorTrigger';
}

stash.feature.repository.baseRepositorySelectorTriggerWithField = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.baseRepositorySelectorTrigger(opt_data) + widget.aui.form.input({
        id: opt_data.fieldId ? opt_data.fieldId : opt_data.id ? opt_data.id + '-field' : opt_data.id,
        name: opt_data.fieldName,
        initialValue: opt_data.repository ? opt_data.repository.id : null,
        type: 'hidden'
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.baseRepositorySelectorTriggerWithField.soyTemplateName = 'stash.feature.repository.baseRepositorySelectorTriggerWithField';
}

stash.feature.repository.baseRepositorySelectorTriggerContent = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + ((opt_data.repository) ? stash.feature.repository.baseRepositorySelectorRepository(opt_data) : '<span class="placeholder">' + soy.$$escapeHtml(opt_data.text ? opt_data.text : "Select repository") + '</span>');
}
;
if (goog.DEBUG) {
    stash.feature.repository.baseRepositorySelectorTriggerContent.soyTemplateName = 'stash.feature.repository.baseRepositorySelectorTriggerContent';
}

stash.feature.repository.baseRepositorySelectorRepository = function(opt_data, opt_ignored) {
    return '<span class="repository" title="' + soy.$$escapeHtml(opt_data.repository.project.name) + ' / ' + soy.$$escapeHtml(opt_data.repository.name) + '" data-id="' + soy.$$escapeHtml(opt_data.repository.id) + '" data-repository="' + soy.$$escapeHtml(JSON.stringify(opt_data.repository).replace(/\//g, '\\/')) + '">' + stash.feature.project.avatar({
        size: 'xsmall',
        project: opt_data.repository.project,
        tagName: 'span'
    }) + '<span class="project-and-repo-wrapper"><span class="project-name">' + soy.$$escapeHtml(opt_data.repository.project.name) + '</span><span class="separator">/</span><span class="name">' + soy.$$escapeHtml(opt_data.repository.name) + '</span></span></span>';
}
;
if (goog.DEBUG) {
    stash.feature.repository.baseRepositorySelectorRepository.soyTemplateName = 'stash.feature.repository.baseRepositorySelectorRepository';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:related-repository-selector', location = '/static/feature/repository/related-repository-selector/related-repository-selector.soy' */
// This file was automatically generated from related-repository-selector.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.relatedRepositorySelectorTrigger = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.baseRepositorySelectorTrigger(opt_data);
}
;
if (goog.DEBUG) {
    stash.feature.repository.relatedRepositorySelectorTrigger.soyTemplateName = 'stash.feature.repository.relatedRepositorySelectorTrigger';
}

stash.feature.repository.relatedRepositorySelectorTriggerWithField = function(opt_data, opt_ignored) {
    return '' + stash.feature.repository.baseRepositorySelectorTriggerWithField(opt_data);
}
;
if (goog.DEBUG) {
    stash.feature.repository.relatedRepositorySelectorTriggerWithField.soyTemplateName = 'stash.feature.repository.relatedRepositorySelectorTriggerWithField';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:related-repository-selector', location = '/static/feature/repository/related-repository-selector/related-repository-selector.js' */
define("feature/repository/related-repository-selector", ["jquery", "stash/api/util/navbuilder", "model/page-state", "feature/repository/base-repository-selector"], function(D, E, C, B) {
    function A(G, F) {
        return this.init.apply(this, arguments)
    }
    D.extend(A.prototype, B.prototype);
    A.constructDataPageFromPreloadArray = B.constructDataPageFromPreloadArray;
    A.prototype.defaults = D.extend(true, {}, B.prototype.defaults, {
        repository: function() {
            return C.getRepository()
        },
        preloadData: function() {
            var H = this._getOptionVal("repository") || C.getRepository();
            if (!H) {
                return null
            }
            var G = [H.toJSON()];
            var F = H.getOrigin();
            if (F) {
                G.push(F)
            }
            return A.constructDataPageFromPreloadArray(G)
        },
        url: function() {
            var F = this._getOptionVal("repository") || C.getRepository();
            return E.rest().project(F.getProject()).repo(F).related().withParams({
                avatarSize: stash.widget.avatarSizeInPx({
                    size: "xsmall"
                })
            }).build()
        }
    });
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:abbreviate-commit-message-util', location = '/static/util/abbreviate-commit-message.js' */
define("util/abbreviate-commit-message", [], function() {
    return function A(E, C) {
        C = parseInt(C, 10);
        var D = "...";
        if (E.length <= C) {
            return E
        }
        var B = E.indexOf("\n");
        if (B > 0 && B <= C) {
            return E.substring(0, B + D.length > C ? C - D.length : B) + D
        }
        return E.substring(0, C - D.length) + D
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:lozenge-internal', location = '/static/widget/lozenge/lozenge.soy' */
// This file was automatically generated from lozenge.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.lozenge.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.lozenge == 'undefined') {
    stash.widget.lozenge = {};
}

stash.widget.lozenge.lozenge = function(opt_data, opt_ignored) {
    var output = '';
    var tag__soy3 = opt_data.href ? 'a' : opt_data.htmlElement ? opt_data.htmlElement : opt_data.clickable ? 'button' : 'span';
    output += '<' + soy.$$escapeHtml(tag__soy3) + ' class="aui-lozenge' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + ((opt_data.monospace) ? ' monospace-lozenge' : '') + '"' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + ((opt_data.maxLength) ? soy.$$escapeHtml(soy.$$truncate(opt_data.text, opt_data.maxLength, true)) : soy.$$escapeHtml(opt_data.text)) + '</' + soy.$$escapeHtml(tag__soy3) + '>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.lozenge.lozenge.soyTemplateName = 'stash.widget.lozenge.lozenge';
}

stash.widget.lozenge.htmlLozenge = function(opt_data, opt_ignored) {
    return '<' + ((opt_data.htmlElement) ? soy.$$escapeHtml(opt_data.htmlElement) : 'a') + ' class="aui-lozenge' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + ((opt_data.monospace) ? ' monospace-lozenge' : '') + '"' + ((opt_data.href) ? ' href="' + soy.$$escapeHtml(opt_data.href) + '"' : '') + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + ((opt_data.extraAttributes) ? aui.renderExtraAttributes(opt_data) : '') + '>' + soy.$$filterNoAutoescape(opt_data.content) + '</' + ((opt_data.htmlElement) ? soy.$$escapeHtml(opt_data.htmlElement) : 'a') + '>';
}
;
if (goog.DEBUG) {
    stash.widget.lozenge.htmlLozenge.soyTemplateName = 'stash.widget.lozenge.htmlLozenge';
}

stash.widget.lozenge.merge = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + stash.widget.lozenge.lozenge({
        extraClasses: 'merge-lozenge' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : '') + (opt_data.abbreviated ? ' abbreviated' : ''),
        text: '' + soy.$$escapeHtml(opt_data.abbreviated ? "M" : "Merge"),
        tooltip: '' + soy.$$escapeHtml("This commit is a merge.")
    });
}
;
if (goog.DEBUG) {
    stash.widget.lozenge.merge.soyTemplateName = 'stash.widget.lozenge.merge';
}

stash.widget.lozenge.pullRequestState = function(opt_data, opt_ignored) {
    var output = '';
    var commonClasses__soy84 = opt_data.extraClasses ? opt_data.extraClasses + ' pull-request-state-lozenge' : ' pull-request-state-lozenge';
    switch (opt_data.state) {
    case 'OPEN':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-complete open' + commonClasses__soy84,
            text: "OPEN",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request is in progress.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'OPENED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-complete opened' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "opened" : "OPENED",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request is in progress.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'MERGED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-success merged' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "merged" : "MERGED",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request has been merged.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'DECLINED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-error declined' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "declined" : "DECLINED",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request has been declined.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'REOPENED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-complete reopened' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "reopened" : "REOPENED",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request has been reopened.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'UPDATED':
    case 'RESCOPED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-current updated' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "updated" : "UPDATED",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request has been updated.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'APPROVED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-success approved' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "approved" : "Approved",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "This pull request has been approved.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    case 'UNAPPROVED':
        output += stash.widget.lozenge.lozenge({
            extraClasses: 'aui-lozenge-error unapproved' + commonClasses__soy84,
            text: opt_data.isActivityContext ? "unapproved" : "Unapproved",
            tooltip: opt_data.tooltip ? opt_data.tooltip : "The approval has been withdrawn from this pull request.",
            clickable: opt_data.clickable,
            href: opt_data.href
        });
        break;
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.lozenge.pullRequestState.soyTemplateName = 'stash.widget.lozenge.pullRequestState';
}

stash.widget.lozenge.enabled = function(opt_data, opt_ignored) {
    return '' + stash.widget.lozenge.lozenge({
        extraClasses: opt_data.isEnabled ? 'lozenge-enabled' : 'lozenge-disabled',
        text: opt_data.isEnabled ? "Enabled" : "Disabled",
        tooltip: opt_data.tooltip
    });
}
;
if (goog.DEBUG) {
    stash.widget.lozenge.enabled.soyTemplateName = 'stash.widget.lozenge.enabled';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:changeset-link', location = '/static/feature/changeset/changeset-link/changeset-link.soy' */
// This file was automatically generated from changeset-link.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.changeset.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.changeset == 'undefined') {
    stash.feature.changeset = {};
}

stash.feature.changeset.link = function(opt_data, opt_ignored) {
    return '<' + soy.$$escapeHtml(opt_data.repository ? 'a' : 'span') + '  class="changesetid"  ' + ((opt_data.repository) ? 'href="' + soy.$$escapeHtml(require('stash/api/util/navbuilder').project(opt_data.repository.project).repo(opt_data.repository).changeset(opt_data.changeset.id).withParams(null).withFragment(opt_data.filePath).build()) + '"' : '') + '  ' + ((opt_data.showTooltip && opt_data.changeset.message) ? 'title="' + soy.$$escapeHtml(require('util/abbreviate-commit-message')(opt_data.changeset.message, 100)) + '"' : '') + ' data-changeset-id="' + soy.$$escapeHtml(opt_data.changeset.id) + '">' + soy.$$escapeHtml(opt_data.changeset.displayId) + '</' + soy.$$escapeHtml(opt_data.repository ? 'a' : 'span') + '>';
}
;
if (goog.DEBUG) {
    stash.feature.changeset.link.soyTemplateName = 'stash.feature.changeset.link';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:changeset-badge', location = '/static/feature/changeset/changeset-badge/changeset-badge.js' */
define("feature/changeset/changeset-badge", ["jquery", "exports"], function(B, A) {
    A.create = function(D, C) {
        return B(stash.feature.changeset.changesetBadge.oneline({
            changeset: D,
            repository: C,
            withAvatar: true
        }))
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:changeset-badge', location = '/static/feature/changeset/changeset-badge/changeset-badge.soy' */
// This file was automatically generated from changeset-badge.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.changeset.changesetBadge.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.changeset == 'undefined') {
    stash.feature.changeset = {};
}
if (typeof stash.feature.changeset.changesetBadge == 'undefined') {
    stash.feature.changeset.changesetBadge = {};
}

stash.feature.changeset.changesetBadge.oneline = function(opt_data, opt_ignored) {
    return '<div class="changeset-badge-oneline">' + ((opt_data.withAvatar) ? stash.widget.avatar({
        person: opt_data.changeset.author,
        size: 'small'
    }) : '') + stash.feature.changeset.changesetBadge.changesetSummary({
        authorNameContent: '' + ((opt_data.linkAuthor == false) ? '<span class="changeset-author" title="' + soy.$$escapeHtml(opt_data.changeset.author.displayName || opt_data.changeset.author.name) + '">' + soy.$$escapeHtml(soy.$$truncate(opt_data.changeset.author.displayName || opt_data.changeset.author.name, 100, true)) + '</span>' : stash.widget.userLink({
            user: opt_data.changeset.author,
            extraClasses: 'changeset-author'
        })),
        changesetLinkContent: '' + stash.feature.changeset.link(opt_data) + ((opt_data.changeset.parents.length > 1) ? stash.widget.lozenge.merge({
            abbreviated: opt_data.abbreviatedMerge
        }) : '')
    }) + stash.widget.date.shortAge({
        date: opt_data.changeset.authorTimestamp
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.changeset.changesetBadge.oneline.soyTemplateName = 'stash.feature.changeset.changesetBadge.oneline';
}

stash.feature.changeset.changesetBadge.changesetSummary = function(opt_data, opt_ignored) {
    return '' + soy.$$filterNoAutoescape(AJS.format("{0} committed {1}", opt_data.authorNameContent, opt_data.changesetLinkContent));
}
;
if (goog.DEBUG) {
    stash.feature.changeset.changesetBadge.changesetSummary.soyTemplateName = 'stash.feature.changeset.changesetBadge.changesetSummary';
}

stash.feature.changeset.changesetBadge.detailed = function(opt_data, opt_ignored) {
    return '<div class="changeset-badge-detailed">' + stash.feature.changeset.changesetBadge.oneline({
        changeset: opt_data.changeset,
        repository: opt_data.repository,
        withAvatar: false,
        linkAuthor: opt_data.linkAuthor,
        abbreviatedMerge: true
    }) + '<div class="changeset-message">' + soy.$$escapeHtml(soy.$$truncate(opt_data.changeset.message, opt_data.maxMessageLength ? opt_data.maxMessageLength : 150, true)) + '</div></div>';
}
;
if (goog.DEBUG) {
    stash.feature.changeset.changesetBadge.detailed.soyTemplateName = 'stash.feature.changeset.changesetBadge.detailed';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-source-target-selector', location = '/static/feature/repository/source-target-selector/source-target-selector.js' */
define("feature/repository/source-target-selector", ["jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "util/dom-event", "util/events", "feature/repository/branch-selector", "feature/repository/related-repository-selector"], function(C, H, A, E, D, I, F, B) {
    function G(M, L, N, K, J) {
        this.init.apply(this, arguments)
    }
    G.prototype.defaults = {
        showChangesetBadges: true,
        showTags: false
    };
    G.prototype.init = function(O, N, Q, M, L) {
        var K = this;
        K.refSelectors = {};
        K.options = C.extend({}, K.defaults, L);
        var P = [{
            name: "source",
            repository: N
        }, {
            name: "target",
            repository: Q
        }];
        var J = B.constructDataPageFromPreloadArray(H.chain(P).pluck("repository").union(M).compact().uniq(function(R) {
            return R.getId()
        }).invoke("toJSON").value());
        H.each(P, function(T) {
            var R = C("." + T.name + "Branch", O);
            var U = R.next("input");
            var S = C("." + T.name + "Repo", O);
            var V = S.next("input");
            var W = {
                $headChangesetSpinner: C("<div class='spinner'/>").insertAfter(U),
                branchSelector: new F(R,{
                    id: T.name + "BranchDialog",
                    context: T.name,
                    repository: T.repository,
                    field: U,
                    show: {
                        branches: true,
                        tags: K.options.showTags
                    },
                    paginationContext: "source-target-selector"
                }),
                repoSelector: new B(S,{
                    id: T.name + "RepoDialog",
                    context: T.name,
                    repository: T.repository,
                    field: V,
                    preloadData: J
                }),
                getBranch: function() {
                    return this.branchSelector.getSelectedItem()
                },
                getRepo: function() {
                    return this.repoSelector.getSelectedItem()
                },
                getSelection: function() {
                    return {
                        repository: this.getRepo(),
                        branch: this.getBranch()
                    }
                },
                setSelection: function(X) {
                    if (X.repository) {
                        this.repoSelector.setSelectedItem(X.repository)
                    } else {
                        this.repoSelector.clearSelection()
                    }
                    if (X.branch) {
                        this.branchSelector.setSelectedItem(X.branch)
                    } else {
                        this.branchSelector.clearSelection();
                        this._getChangesetBadge().empty()
                    }
                },
                _getChangesetBadge: function() {
                    return this.branchSelector.$trigger.siblings(".changeset-badge-detailed")
                }
            };
            W._getChangesetBadge().find(".changesetid").tooltip();
            K.refSelectors[T.name] = W
        });
        O.find(".swap-button").on("click", D.preventDefault(this.swap.bind(this)));
        I.on("stash.feature.repository.revisionReferenceSelector.revisionRefChanged", function(R, S) {
            var T = K.refSelectors[S];
            if (K.options.showChangesetBadges) {
                K._updateChangesetBadge(T, R)
            }
            if (S === "source") {
                K.refSelectors.target.repoSelector.$trigger.focus()
            }
            I.trigger("stash.feature.repository.sourceTargetSelector." + S + ".revisionRefChanged", K, R)
        });
        I.on("stash.feature.repository.repositorySelector.repositoryChanged", function(S, R) {
            var T = K.refSelectors[R];
            T.branchSelector.setRepository(S);
            T.branchSelector.$trigger.focus();
            if (K.options.showChangesetBadges) {
                K._updateChangesetBadge(T, null)
            }
            I.trigger("stash.feature.repository.sourceTargetSelector." + R + ".repositoryChanged", K, S)
        });
        I.on("stash.feature.repository.revisionReferenceSelector.revisionRefUnselected", function(R, S) {
            var T = K.refSelectors[S];
            if (K.options.showChangesetBadges) {
                K._updateChangesetBadge(T, R)
            }
            I.trigger("stash.feature.repository.sourceTargetSelector." + S + ".revisionRefUnselected", K, R)
        });
        return K
    }
    ;
    G.prototype.swap = function() {
        var J = this.refSelectors.source;
        var K = this.refSelectors.target;
        var L = J.getSelection();
        J.setSelection(K.getSelection());
        K.setSelection(L)
    }
    ;
    G.prototype._updateChangesetBadge = function(N, J) {
        var K = this
          , M = N._getChangesetBadge();
        M.hide().empty();
        if (J) {
            N.$headChangesetSpinner.show().spin("small");
            var L = N.getRepo();
            E.rest({
                url: A.rest().project(L.getProject()).repo(L).commit(J.getLatestChangeset()).build()
            }).done(function(P) {
                var O = C(stash.feature.changeset.changesetBadge.oneline({
                    changeset: P,
                    linkAuthor: false,
                    messageTooltip: true,
                    repository: L.toJSON()
                }));
                M.append(O);
                M.fadeIn();
                M.find(".changesetid").tooltip()
            }).always(function() {
                N.$headChangesetSpinner.spinStop().hide()
            })
        } else {
            M.empty()
        }
    }
    ;
    G.prototype.branchesSelected = function() {
        return !!(this.refSelectors.source.getBranch() && this.refSelectors.target.getBranch())
    }
    ;
    G.prototype.refsAreEqual = function() {
        var K = this.refSelectors.source.getBranch();
        var J = this.refSelectors.target.getBranch();
        return !!(K && K.isEqual(J))
    }
    ;
    G.prototype.getSourceRepository = function() {
        return this.refSelectors.source.getRepo()
    }
    ;
    G.prototype.getTargetRepository = function() {
        return this.refSelectors.target.getRepo()
    }
    ;
    G.prototype.getSourceBranch = function() {
        return this.refSelectors.source.getBranch()
    }
    ;
    G.prototype.getTargetBranch = function() {
        return this.refSelectors.target.getBranch()
    }
    ;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:paged-table', location = '/static/widget/paged-table/paged-table.js' */
define("widget/paged-table", ["aui", "jquery", "lodash", "util/ajax", "widget/error-dialog", "widget/paged-scrollable"], function(B, F, C, E, A, G) {
    function D(H) {
        H = F.extend(true, {}, D.defaults, H);
        G.call(this, H.scrollPane, H);
        this.$table = F(H.target);
        if (H.filterable) {
            this.$filter = H.filter ? F(H.filter) : this.$table.prev(".paged-table-filter").find(".paged-table-filter-input");
            this._currentFilterText = F.trim(this.$filter.val());
            var I = C.debounce(C.bind(this._onFilterChanged, this), H.filterDebounce);
            this.$filter.on("keyup.paged-table-filter", function(J) {
                if (J.which === B.keyCode.ESCAPE) {
                    F(this).blur()
                } else {
                    I(J)
                }
            }).on("paste.paged-table-filter", I)
        }
        this.$spinner = F("<div class='spinner'/>").hide().insertAfter(this.$table);
        this.spinnerShowing = false;
        this.processedDomData = (this.$table.attr("data-lastpage") == null)
    }
    D.defaults = {
        ajaxDataType: "json",
        spinnerSize: "large",
        filterable: false,
        bufferPixels: 150,
        filterDebounce: 350,
        rowSelector: "> tbody > tr",
        focusOptions: {
            escToCancel: false,
            focusedClass: "focused",
            rowSelector: "> tbody > tr",
            wrapAround: false
        }
    };
    F.extend(D.prototype, G.prototype);
    D.prototype.init = function() {
        return G.prototype.init.apply(this, arguments).done(C.bind(function() {
            if (this.shortcutsInitialised) {
                this.focusInitialRow()
            }
        }, this))
    }
    ;
    D.prototype.getFilterText = function() {
        return this._currentFilterText
    }
    ;
    D.prototype._onFilterChanged = function() {
        var H = F.trim(this.$filter.val());
        if (this._currentFilterText !== H) {
            this._currentFilterText = H;
            this.update()
        }
    }
    ;
    D.prototype.requestData = function(J, H) {
        if (!this.processedDomData) {
            return F.Deferred().resolve(this.createDataFromJQuery(J, H, this.$table))
        }
        var I = this;
        I.spinnerShowing = true;
        I.$spinner.show().spin(I.options.spinnerSize, {
            zIndex: 10
        });
        return I.performAjax(J, H).always(function() {
            I._hideSpinnerTimeout = setTimeout(function() {
                I.spinnerShowing && I.$spinner.spinStop().hide();
                I.spinnerShowing = false
            }, 0)
        })
    }
    ;
    D.prototype.performAjax = function(J, H) {
        var I = this;
        return E.ajax({
            url: I.buildUrl(J, H, I.getFilterText()),
            dataType: I.options.ajaxDataType,
            statusCode: I.options.statusCode
        })
    }
    ;
    D.prototype.cancelRequest = function() {
        G.prototype.cancelRequest.call(this);
        if (this._hideSpinnerTimeout) {
            clearTimeout(this._hideSpinnerTimeout)
        }
    }
    ;
    D.prototype.reset = function() {
        G.prototype.reset.call(this);
        if (this.processedDomData) {
            this.$table.find(this.options.rowSelector).remove().end().next(".paged-table-message").remove().end()
        }
        this.$table.addClass("no-rows")
    }
    ;
    D.prototype.update = function(H) {
        this.reset();
        return this.init(H)
    }
    ;
    D.prototype.createDataFromJQuery = function(N, H, K) {
        var J = K.find(this.options.rowSelector);
        var I = K.attr("data-lastpage") === "true";
        var M = K.attr("data-nextpagestart");
        var L = {
            start: Number(K.attr("data-start")),
            size: Number(K.attr("data-size")),
            values: J,
            isLastPage: I
        };
        if (M != null) {
            L.nextPageStart = Number(M)
        }
        return L
    }
    ;
    D.prototype.attachNewContent = function(I, H) {
        if (I.size) {
            if (this.processedDomData) {
                if (I && I.errors) {
                    this.handleErrors(I.errors);
                    return
                }
                this.handleNewRows(I, H)
            }
            if (I.start > 0 && I.isLastPage) {
                this.handleLastPage()
            }
            this.$table.removeClass("no-rows")
        } else {
            if (I.isLastPage) {
                this.handleNoData()
            }
        }
        this.updateTimestamp();
        this.processedDomData = true
    }
    ;
    D.prototype.updateTimestamp = function() {
        this.$table.attr("data-last-updated", new Date().getTime())
    }
    ;
    D.prototype.focusInitialRow = function() {
        this.$table.find(this.options.focusOptions.rowSelector).first().addClass(this.options.focusOptions.focusedClass)
    }
    ;
    D.prototype.initShortcuts = function() {
        this.shortcutsInitialised = true;
        this.focusInitialRow();
        return {
            destroy: C.bind(this.resetShortcuts, this)
        }
    }
    ;
    D.prototype.resetShortcuts = function() {
        this.shortcutsInitialised = false
    }
    ;
    D.prototype._new$Message = function(H) {
        return F('<div class="paged-table-message"/>').addClass(this.options.tableMessageClass).html(H || "")
    }
    ;
    D.prototype.handleLastPage = function() {
        this.$table.after(this._new$Message(this.options.allFetchedMessageHtml))
    }
    ;
    D.prototype.handleNoData = function() {
        var I = this.getFilterText();
        var H = I && I.length ? this.options.noneMatchingMessageHtml : this.options.noneFoundMessageHtml;
        this.$table.addClass("no-rows").after(this._new$Message(H))
    }
    ;
    D.prototype.handleErrors = function(H) {
        new A({
            panelContent: "<p>" + B.escapeHtml(H[0].message) + "</p>"
        }).show()
    }
    ;
    D.prototype.buildUrl = function(J, H, I) {
        throw new Error("buildUrl is abstract and must be implemented.")
    }
    ;
    D.prototype.handleNewRows = function(I, H) {
        throw new Error("handleNewRows is abstract and must be implemented.")
    }
    ;
    return D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:paged-table', location = '/static/widget/paged-table/paged-table.soy' */
// This file was automatically generated from paged-table.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.pagedTable = function(opt_data, opt_ignored) {
    var output = '' + ((opt_data.filterable) ? stash.widget.pagedTableFilter({
        forId: opt_data.id,
        filter: opt_data.filter,
        filterPlaceholder: opt_data.filterPlaceholder
    }) : '');
    var pageAttributes__soy9 = opt_data.page ? atl_soy.concat({
        start: opt_data.page.start,
        size: opt_data.page.size,
        lastpage: opt_data.page.isLastPage
    }, opt_data.page.nextPageRequest ? {
        nextpagestart: opt_data.page.nextPageRequest.start
    } : {}) : {};
    output += widget.aui.table({
        id: opt_data.id,
        dataAttributes: atl_soy.concat(pageAttributes__soy9, opt_data.extraDataAttributes ? opt_data.extraDataAttributes : {}),
        extraClasses: 'paged-table' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + ((!opt_data.page || opt_data.page.size == 0) ? ' no-rows' : ''),
        theadContent: opt_data.theadContent,
        content: opt_data.content
    }) + ((opt_data.page && opt_data.page.size == 0) ? stash.widget.pagedTableMessage({
        content: opt_data.filterable && opt_data.filter ? (opt_data.noneMatchingMessageContent ? opt_data.noneMatchingMessageContent : '') : opt_data.noneFoundMessageContent ? opt_data.noneFoundMessageContent : ''
    }) : '');
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.pagedTable.soyTemplateName = 'stash.widget.pagedTable';
}

stash.widget.pagedTableMessage = function(opt_data, opt_ignored) {
    return '<div class="paged-table-message">' + soy.$$filterNoAutoescape(opt_data.content) + '</div>';
}
;
if (goog.DEBUG) {
    stash.widget.pagedTableMessage.soyTemplateName = 'stash.widget.pagedTableMessage';
}

stash.widget.pagedTableFilter = function(opt_data, opt_ignored) {
    return '' + aui.group.group({
        extraClasses: 'paged-table-filter',
        content: '' + aui.group.item({
            content: '' + stash.widget.pagedTableFilterField(opt_data)
        })
    });
}
;
if (goog.DEBUG) {
    stash.widget.pagedTableFilter.soyTemplateName = 'stash.widget.pagedTableFilter';
}

stash.widget.pagedTableFilterField = function(opt_data, opt_ignored) {
    return '<label class="assistive" for="paged-table-input-for-' + soy.$$escapeHtml(opt_data.forId) + '">' + soy.$$escapeHtml(opt_data.filterPlaceholder ? opt_data.filterPlaceholder : "Search") + '</label><input type="text" id="paged-table-input-for-' + soy.$$escapeHtml(opt_data.forId) + '" class="paged-table-filter-input" data-for="' + soy.$$escapeHtml(opt_data.forId) + '" autocomplete="off" placeholder="' + soy.$$escapeHtml(opt_data.filterPlaceholder ? opt_data.filterPlaceholder : "Search") + '" value="' + soy.$$escapeHtml(opt_data.filter ? opt_data.filter : '') + '">';
}
;
if (goog.DEBUG) {
    stash.widget.pagedTableFilterField.soyTemplateName = 'stash.widget.pagedTableFilterField';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:submit-spinner', location = '/static/widget/submit-spinner/submit-spinner.js' */
define("widget/submit-spinner", ["jquery"], function(B) {
    function A(D, C) {
        if (!(this instanceof A)) {
            return new A(D)
        }
        this.$button = B(D);
        this.$spinner = B('<div class="submit-spinner invisible" />');
        if (C === "before") {
            this.$spinner.insertBefore(this.$button)
        } else {
            this.$spinner.insertAfter(this.$button)
        }
    }
    A.prototype.show = function() {
        this.$spinner.removeClass("invisible");
        this.$spinner.spin();
        return this
    }
    ;
    A.prototype.hide = function() {
        this.$spinner.addClass("invisible");
        this.$spinner.spinStop();
        return this
    }
    ;
    A.prototype.remove = function() {
        this.$spinner.remove();
        return this
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:backbone', location = '/static/lib/backbone/backbone-sync-shim.js' */
require(["backbone", "lodash", "util/ajax"], function(D, A, C) {
    var B = {
        create: "POST",
        read: "GET",
        update: "PUT",
        "delete": "DELETE"
    };
    D.sync = function(H, F, G) {
        var E = A.extend({
            url: A.isFunction(F.url) ? F.url() : F.url,
            type: B[H],
            data: F.toJSON()
        }, G);
        return C.rest(E)
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:confirm-dialog', location = '/static/widget/confirm-dialog.js' */
define("widget/confirm-dialog", ["aui", "jquery", "lodash", "util/ajax", "widget/submit-spinner"], function(B, F, C, E, D) {
    function A(H, G) {
        this.dialogOptions = F.extend({}, A.dialogDefaults, H);
        this.ajaxOptions = G || {};
        this._selectors = [];
        this._okCallbacks = F.Callbacks();
        this._cancelCallback = F.Callbacks();
        this._detachers = F.Callbacks();
        this._attached = false
    }
    A.prototype.getConfirmButton = function() {
        return F("#" + this.dialogOptions.id + " ." + this.dialogOptions.confirmButtonClass)
    }
    ;
    A.prototype.getButtons = function() {
        var H = this.getConfirmButton()
          , G = this.dialogOptions.id;
        C.each(this._selectors, function(I) {
            H = H.add(F("#" + G + " " + I))
        });
        return H
    }
    ;
    A.prototype.setButtonsDisabled = function(G) {
        this.getButtons().each(function() {
            var H = F(this);
            H.prop("disabled", G).toggleClass("disabled", G);
            if (G) {
                H.attr("aria-disabled", "true")
            } else {
                H.removeAttr("aria-disabled")
            }
        })
    }
    ;
    A.prototype.destroy = function() {
        this._detachers.fire();
        this._detachers = null
    }
    ;
    A.prototype.attachTo = function(G, N, H) {
        var Q = this
          , I = this.dialogOptions
          , K = this.ajaxOptions
          , L = this._okCallbacks
          , J = this._cancelCallback;
        H = H || document;
        var P = F(H);
        this._selectors.push(G);
        var O = function() {
            Q.setButtonsDisabled(false)
        };
        P.on("hideLayer", O);
        var M = function(U) {
            U.preventDefault();
            var S = F(this);
            if (!S.is(":disabled")) {
                var R = function(V) {
                    Q.setButtonsDisabled(false);
                    V.remove()
                }
                  , T = new B.Dialog({
                    width: I.width,
                    height: I.height,
                    id: I.id,
                    focusSelector: I.focusSelector,
                    closeOnOutsideClick: false,
                    keypressListener: function(V) {
                        V.stopImmediatePropagation();
                        if (V.keyCode === B.keyCode.ENTER) {
                            V.preventDefault();
                            Q.getConfirmButton().click()
                        } else {
                            if (V.keyCode === B.keyCode.ESCAPE) {
                                V.preventDefault();
                                R(T)
                            }
                        }
                    }
                });
                T.addHeader(I.titleText, I.titleClass);
                T.addPanel("", I.panelContent, I.panelClass);
                T.addButton(I.submitText, function(V) {
                    Q.setButtonsDisabled(true);
                    var X = null;
                    var W = new D(Q.getConfirmButton(),"before");
                    if (Q.dialogOptions.submitToHref) {
                        W.show();
                        if (S[0].tagName === "A") {
                            X = E.rest(F.extend({
                                url: S.attr("href")
                            }, K)).always(function() {
                                W.hide();
                                R(V)
                            })
                        } else {
                            S.closest("form")[0].submit()
                        }
                    }
                    L.fire(X, S, function() {
                        R(V)
                    }, V, W)
                }, "button " + (I.confirmButtonClass || ""));
                T.addCancel("Cancel", function(V) {
                    R(V);
                    J.fire(S)
                });
                if (N) {
                    N(this, T, Q)
                }
                T.show();
                Q._attached = true
            }
        };
        P.on("click", G, M);
        this._detachers.add(function() {
            P.off("hideLayer", O);
            P.off("click", G, M)
        })
    }
    ;
    A.prototype.addConfirmListener = function(G) {
        this._okCallbacks.add(G)
    }
    ;
    A.prototype.addCancelListener = function(G) {
        this._cancelCallback.add(G)
    }
    ;
    A.dialogDefaults = {
        id: undefined,
        titleText: "Confirm",
        titleClass: "confirm-header",
        confirmButtonClass: "confirm-button",
        panelContent: "<p>" + "Are you sure you want to do that?" + "</p>",
        panelClass: "panel-body",
        submitText: "Confirm",
        submitToHref: true,
        height: 230,
        width: 433,
        focusSelector: ".confirm-button"
    };
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:performance-util', location = '/static/util/performance.js' */
define("util/performance", ["jquery"], function(D) {
    function F(I, L) {
        var G = new D.Callbacks();
        var H = false;
        var J = null;
        function K() {
            J = null;
            H = true;
            G.fire();
            G = new D.Callbacks();
            H = false;
            L()
        }
        return {
            name: I,
            forceExecute: function() {
                if (J) {
                    clearTimeout(J);
                    K()
                }
            },
            queue: function(M) {
                if (H) {
                    M()
                } else {
                    G.add(M);
                    if (!J) {
                        J = setTimeout(K, 0)
                    }
                }
            }
        }
    }
    var A = F("READ", function() {
        C.forceExecute()
    });
    var C = F("WRITE", function() {
        A.forceExecute()
    });
    function B(G, J, I) {
        I = I || 1;
        var K = 0;
        return function H() {
            if (K >= I) {
                return
            }
            K++;
            G(function L() {
                try {
                    return J.apply(this, arguments)
                } finally {
                    K--
                }
            })
        }
    }
    function E(I, G, H) {
        G = D.extend({
            initial: 500,
            min: 10,
            max: Infinity
        }, G);
        H = H || function(K) {
            K()
        }
        ;
        function J(K) {
            return Math.min(G.max, Math.max(G.min, K))
        }
        return function(K) {
            var P = G.initial;
            var M = D.Deferred();
            var O = 0;
            var N = [];
            function Q() {
                for (var R = Math.min(O + P, K.length); O < R; O++) {
                    N[O] = I(K[O])
                }
            }
            requestAnimationFrame(function L() {
                if (M.state() !== "pending") {
                    return
                }
                var T = new Date().getTime();
                H(Q);
                var R = new Date().getTime();
                var S = R - T;
                P = J(Math.ceil(P * (15 / S)));
                if (O === K.length) {
                    M.resolve(N)
                } else {
                    requestAnimationFrame(L)
                }
            });
            return M
        }
    }
    return {
        queueDOMRead: A.queue.bind(A),
        queueDOMWrite: C.queue.bind(C),
        enqueueCapped: B,
        frameBatchedMap: E
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:client-storage', location = '/static/util/client-storage.js' */
define("util/client-storage", ["jquery", "lodash", "util/feature-detect", "model/page-state", "exports"], function(F, Y, P, M, Z) {
    var U = {
        SESSION: "session",
        LOCAL: "local"
    };
    var O = "_flash.";
    var L = "_"
      , R = "lastCleanup"
      , I = "hasCheckedCleanUp"
      , T = 1000 * 60 * 60 * 24 * 30;
    var W = {};
    Z._resetDummy = function() {
        W = {}
    }
    ;
    function A(b, a) {
        if (Y.isString(b)) {
            b = [b]
        }
        if (!Y.isArray(b)) {
            throw new Error("keyBuilder requires an array of components")
        }
        if (a) {
            b.push(a);
            switch (a) {
            case "pull-request":
                b.push(M.getPullRequest() && M.getPullRequest().getId());
            case "repo":
                b.push(M.getRepository() && M.getRepository().getSlug());
            case "project":
                b.push(M.getProject() && M.getProject().getKey());
            case "user":
                b.push(M.getCurrentUser() && M.getCurrentUser().getName());
                break
            }
        }
        return b.join(L)
    }
    function Q(b, c) {
        var e, d;
        if (P.localStorage()) {
            e = window[(c || U.LOCAL) + "Storage"].getItem(b)
        } else {
            e = Y.has(W, b) ? W[b] : null
        }
        try {
            d = JSON.parse(e)
        } catch (a) {
            d = e
        }
        return d
    }
    function K(a, b) {
        var c = Q(a, b);
        return F.isPlainObject(c) && Y.has(c, "data") ? c.data : c
    }
    function N(a) {
        return K(a, U.SESSION)
    }
    function H(a) {
        var b = K(O + a, U.SESSION);
        G(a);
        return b
    }
    function D(a, c, b) {
        if (P.localStorage()) {
            window[(b || U.LOCAL) + "Storage"].setItem(a, JSON.stringify(c))
        } else {
            W[a] = JSON.stringify(c)
        }
    }
    function C(a, e, d, b) {
        var c = Y.extend({}, d, {
            timestamp: new Date().getTime(),
            data: e
        });
        D(a, c, b);
        if (!b || b === U.LOCAL) {
            Y.defer(J)
        }
    }
    function B(a, c, b) {
        C.call(this, a, c, b, U.SESSION)
    }
    function S(a, c, b) {
        C.call(this, O + a, c, b, U.SESSION)
    }
    function V(a, b) {
        if (P.localStorage()) {
            window[(b || U.LOCAL) + "Storage"].removeItem(a)
        } else {
            delete W[a]
        }
    }
    function E(a) {
        V(a, U.SESSION)
    }
    function G(a) {
        V(O + a, U.SESSION)
    }
    function J() {
        if (!!Q(I, U.SESSION)) {
            return
        }
        var a = Q(R);
        if (!a || new Date().getTime() - a > T) {
            X()
        }
        D(I, true, U.SESSION)
    }
    function X() {
        var a = new Date().getTime();
        Y.each(Y.keys(localStorage), function(b) {
            if (b !== R) {
                var c = Q(b);
                if (c && c.timestamp && !c.noCleanup && (a - c.timestamp > T)) {
                    V(b)
                }
            }
        });
        D(R, new Date().getTime())
    }
    Z.LOCAL = U.LOCAL;
    Z.SESSION = U.SESSION;
    Z.buildKey = A;
    Z.getItem = K;
    Z.getFlashItem = H;
    Z.getSessionItem = N;
    Z.setItem = C;
    Z.setFlashItem = S;
    Z.setSessionItem = B;
    Z.removeItem = V;
    Z.removeFlashItem = G;
    Z.removeSessionItem = E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:imagesloaded', location = '/static/bower/imagesloaded/jquery.imagesloaded.js' */
/*
 * jQuery imagesLoaded plugin v2.1.2
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */
(function(A, B) {
    var C = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
    A.fn.imagesLoaded = function(L) {
        var I = this
          , N = A.isFunction(A.Deferred) ? A.Deferred() : 0
          , M = A.isFunction(N.notify)
          , F = I.find("img").add(I.filter("img"))
          , G = []
          , K = []
          , H = [];
        if (A.isPlainObject(L)) {
            A.each(L, function(O, P) {
                if (O === "callback") {
                    L = P
                } else {
                    if (N) {
                        N[O](P)
                    }
                }
            })
        }
        function J() {
            var O = A(K)
              , P = A(H);
            if (N) {
                if (H.length) {
                    N.reject(F, O, P)
                } else {
                    N.resolve(F)
                }
            }
            if (A.isFunction(L)) {
                L.call(I, F, O, P)
            }
        }
        function E(O) {
            D(O.target, O.type === "error")
        }
        function D(O, P) {
            if (O.src === C || A.inArray(O, G) !== -1) {
                return
            }
            G.push(O);
            if (P) {
                H.push(O)
            } else {
                K.push(O)
            }
            A.data(O, "imagesLoaded", {
                isBroken: P,
                src: O.src
            });
            if (M) {
                N.notifyWith(A(O), [P, F, A(K), A(H)])
            }
            if (F.length === G.length) {
                setTimeout(J);
                F.unbind(".imagesLoaded", E)
            }
        }
        if (!F.length) {
            J()
        } else {
            F.bind("load.imagesLoaded error.imagesLoaded", E).each(function(O, Q) {
                var R = Q.src;
                var P = A.data(Q, "imagesLoaded");
                if (P && P.src === R) {
                    D(Q, P.isBroken);
                    return
                }
                if (Q.complete && Q.naturalWidth !== B) {
                    D(Q, Q.naturalWidth === 0 || Q.naturalHeight === 0);
                    return
                }
                if (Q.readyState || Q.complete) {
                    Q.src = C;
                    Q.src = R
                }
            })
        }
        return N ? N.promise(I) : I
    }
})(jQuery);
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:imagesloaded', location = '/static/lib/imagesloaded-AMD.js' */
define("imagesloaded", function() {});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:scroll', location = '/static/util/scroll.js' */
define("util/scroll", ["jquery", "lodash", "util/feature-detect", "exports"], function(G, E, B, D) {
    var H = {
        waitForImages: false,
        cancelIfScrolled: false,
        duration: 400,
        getScrollPadding: function() {
            return document.documentElement.clientHeight / 4
        }
    };
    function A(I, K, J) {
        G("html, body").animate({
            scrollTop: Math.max(0, I - K)
        }, J)
    }
    function C(K, J) {
        var L = G.extend({}, H, J);
        var M = false;
        if (L.cancelIfScrolled) {
            G(document).one("scroll", function() {
                M = true
            })
        }
        function I() {
            if (!M) {
                var N = K.offset();
                if (N) {
                    A(N.top, L.getScrollPadding(), L.duration)
                }
            }
        }
        if (L.waitForImages) {
            G(document).imagesLoaded(I)
        } else {
            I()
        }
    }
    function F(N, M) {
        var K = B.cssTransform();
        var J = {
            left: 0,
            top: 0
        };
        var O = -1;
        if (M && M.withDocument === true) {
            O = 1
        }
        function L(Q, P) {
            J.left = (Q == null ? J.left : Q);
            J.top = (P == null ? J.top : P);
            return (J.left === 0 && J.top === 0) ? null : J
        }
        var I;
        switch (K) {
        case "msTransform":
            I = function(P) {
                N.style[K] = P === null ? "" : "translate(" + (Math.round(P.left) * O) + "px, " + (Math.round(P.top) * O) + "px)"
            }
            ;
            break;
        case undefined:
            I = function(P) {
                N.style.left = P === null ? "" : (Math.round(P.left) * O);
                N.style.top = P === null ? "" : (Math.round(P.top) * O)
            }
            ;
            break;
        default:
            I = function(P) {
                N.style[K] = P === null ? "" : "translate3d(" + (Math.round(P.left) * O) + "px, " + (Math.round(P.top) * O) + "px, 0)"
            }
        }
        return E.compose(I, L)
    }
    D.scrollTo = C;
    D.fakeScroll = F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-segment-types', location = '/static/feature/file-content/diff-view-segment-types.js' */
define("feature/file-content/diff-view-segment-types", [], function() {
    return {
        ADDED: "ADDED",
        REMOVED: "REMOVED",
        CONTEXT: "CONTEXT"
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-file-types', location = '/static/feature/file-content/diff-view-file-types.js' */
define("feature/file-content/diff-view-file-types", [], function() {
    return {
        FROM: "FROM",
        TO: "TO"
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:baconjs', location = '/static/bower/bacon/dist/Bacon.js' */
(function() {
    var U, AJ, P, AN, i, X, Z, c, AC, a, M, f, AE, AB, K, Q, AH, W, d, AL, AG, V, J, p, v, AK, x, S, s, y, l, z, AF, e, H, b, O, B, AM, j, R, E, A, AR, AI, AA, AS, AP, u, g, G, o, t, m, AO, w, AT, I, N, T, D, n, AQ, q, k, Y, L, h, AU, r = {}.hasOwnProperty, F = [].slice, C = function(AY, AW) {
        for (var AV in AW) {
            if (r.call(AW, AV)) {
                AY[AV] = AW[AV]
            }
        }
        function AX() {
            this.constructor = AY
        }
        AX.prototype = AW.prototype;
        AY.prototype = new AX();
        AY.__super__ = AW.prototype;
        return AY
    }, AD = function(AV, AW) {
        return function() {
            return AV.apply(AW, arguments)
        }
    };
    U = {
        toString: function() {
            return "Bacon"
        }
    };
    U.version = "0.7.42";
    f = (typeof global !== "undefined" && global !== null ? global : this).Error;
    h = {
        indexOf: Array.prototype.indexOf ? function(AW, AV) {
            return AW.indexOf(AV)
        }
        : function(AX, AV) {
            var AY, Aa, AZ, AW;
            for (AY = AZ = 0,
            AW = AX.length; AZ < AW; AY = ++AZ) {
                Aa = AX[AY];
                if (AV === Aa) {
                    return AY
                }
            }
            return -1
        }
        ,
        indexWhere: function(AW, AZ) {
            var AX, Aa, AY, AV;
            for (AX = AY = 0,
            AV = AW.length; AY < AV; AX = ++AY) {
                Aa = AW[AX];
                if (AZ(Aa)) {
                    return AX
                }
            }
            return -1
        },
        head: function(AV) {
            return AV[0]
        },
        always: function(AV) {
            return function() {
                return AV
            }
        },
        negate: function(AV) {
            return function(AW) {
                return !AV(AW)
            }
        },
        empty: function(AV) {
            return AV.length === 0
        },
        tail: function(AV) {
            return AV.slice(1, AV.length)
        },
        filter: function(Aa, AY) {
            var AX, AV, AZ, AW;
            AX = [];
            for (AZ = 0,
            AW = AY.length; AZ < AW; AZ++) {
                AV = AY[AZ];
                if (Aa(AV)) {
                    AX.push(AV)
                }
            }
            return AX
        },
        map: function(Aa, AY) {
            var AV, AZ, AX, AW;
            AW = [];
            for (AZ = 0,
            AX = AY.length; AZ < AX; AZ++) {
                AV = AY[AZ];
                AW.push(Aa(AV))
            }
            return AW
        },
        each: function(AV, AY) {
            var AW, AX;
            for (AW in AV) {
                AX = AV[AW];
                AY(AW, AX)
            }
            return void 0
        },
        toArray: function(AV) {
            if (A(AV)) {
                return AV
            } else {
                return [AV]
            }
        },
        contains: function(AW, AV) {
            return h.indexOf(AW, AV) !== -1
        },
        id: function(AV) {
            return AV
        },
        last: function(AV) {
            return AV[AV.length - 1]
        },
        all: function(AX, AZ) {
            var AV, AY, AW;
            if (AZ == null) {
                AZ = h.id
            }
            for (AY = 0,
            AW = AX.length; AY < AW; AY++) {
                AV = AX[AY];
                if (!AZ(AV)) {
                    return false
                }
            }
            return true
        },
        any: function(AX, AZ) {
            var AV, AY, AW;
            if (AZ == null) {
                AZ = h.id
            }
            for (AY = 0,
            AW = AX.length; AY < AW; AY++) {
                AV = AX[AY];
                if (AZ(AV)) {
                    return true
                }
            }
            return false
        },
        without: function(AV, AW) {
            return h.filter((function(AX) {
                return AX !== AV
            }), AW)
        },
        remove: function(AV, AW) {
            var AX;
            AX = h.indexOf(AW, AV);
            if (AX >= 0) {
                return AW.splice(AX, 1)
            }
        },
        fold: function(AY, AX, Aa) {
            var AV, AZ, AW;
            for (AZ = 0,
            AW = AY.length; AZ < AW; AZ++) {
                AV = AY[AZ];
                AX = Aa(AX, AV)
            }
            return AX
        },
        flatMap: function(AW, AV) {
            return h.fold(AV, [], (function(AY, AX) {
                return AY.concat(AW(AX))
            }))
        },
        cached: function(AW) {
            var AV;
            AV = K;
            return function() {
                if (AV === K) {
                    AV = AW();
                    AW = void 0
                }
                return AV
            }
        },
        toString: function(AZ) {
            var AW, AX, AV, AY;
            try {
                AT++;
                if (AZ == null) {
                    return "undefined"
                } else {
                    if (AI(AZ)) {
                        return "function"
                    } else {
                        if (A(AZ)) {
                            if (AT > 5) {
                                return "[..]"
                            }
                            return "[" + h.map(h.toString, AZ).toString() + "]"
                        } else {
                            if (((AZ != null ? AZ.toString : void 0) != null) && AZ.toString !== Object.prototype.toString) {
                                return AZ.toString()
                            } else {
                                if (typeof AZ === "object") {
                                    if (AT > 5) {
                                        return "{..}"
                                    }
                                    AX = (function() {
                                        var Aa;
                                        Aa = [];
                                        for (AV in AZ) {
                                            if (!r.call(AZ, AV)) {
                                                continue
                                            }
                                            AY = (function() {
                                                try {
                                                    return AZ[AV]
                                                } catch (Ab) {
                                                    AW = Ab;
                                                    return AW
                                                }
                                            })();
                                            Aa.push(h.toString(AV) + ":" + h.toString(AY))
                                        }
                                        return Aa
                                    })();
                                    return "{" + AX + "}"
                                } else {
                                    return AZ
                                }
                            }
                        }
                    }
                }
            } finally {
                AT--
            }
        }
    };
    AT = 0;
    U._ = h;
    U.scheduler = {
        setTimeout: function(AV, AW) {
            return setTimeout(AV, AW)
        },
        setInterval: function(AW, AV) {
            return setInterval(AW, AV)
        },
        clearInterval: function(AV) {
            return clearInterval(AV)
        },
        now: function() {
            return new Date().getTime()
        }
    };
    U.fromBinder = function(AV, AW) {
        if (AW == null) {
            AW = h.id
        }
        return new M(H(U, "fromBinder", AV, AW),function(Aa) {
            var Ab, AY, AX, AZ;
            AZ = false;
            Ab = false;
            AY = function() {
                if (!AZ) {
                    if (typeof AX !== "undefined" && AX !== null) {
                        AX();
                        return AZ = true
                    } else {
                        return Ab = true
                    }
                }
            }
            ;
            AX = AV(function() {
                var Ad, Af, Ae, Ah, Ag, Ac;
                Ad = 1 <= arguments.length ? F.call(arguments, 0) : [];
                Ah = AW.apply(this, Ad);
                if (!(A(Ah) && h.last(Ah)instanceof a)) {
                    Ah = [Ah]
                }
                Ae = U.more;
                for (Ag = 0,
                Ac = Ah.length; Ag < Ac; Ag++) {
                    Af = Ah[Ag];
                    Ae = Aa(Af = D(Af));
                    if (Ae === U.noMore || Af.isEnd()) {
                        AY();
                        return Ae
                    }
                }
                return Ae
            });
            if (Ab) {
                AY()
            }
            return AY
        }
        )
    }
    ;
    U.$ = {};
    U.$.asEventStream = function(AW, AV, AX) {
        var AY;
        if (AI(AV)) {
            AY = [AV, void 0],
            AX = AY[0],
            AV = AY[1]
        }
        return Y(this.selector || this, "asEventStream", AW, U.fromBinder((function(AZ) {
            return function(Aa) {
                AZ.on(AW, AV, Aa);
                return function() {
                    return AZ.off(AW, AV, Aa)
                }
            }
        })(this), AX))
    }
    ;
    if ((AU = typeof jQuery !== "undefined" && jQuery !== null ? jQuery : typeof Zepto !== "undefined" && Zepto !== null ? Zepto : void 0) != null) {
        AU.fn.asEventStream = U.$.asEventStream
    }
    U.fromEventTarget = function(Af, Ae, AX) {
        var AV, AZ, Ad, Ac, Ab, Aa, AY, AW;
        AV = (Ad = (Ac = (Ab = Af.addEventListener) != null ? Ab : Af.addListener) != null ? Ac : Af.bind) != null ? Ad : Af.on;
        AZ = (Aa = (AY = (AW = Af.removeEventListener) != null ? AW : Af.removeListener) != null ? AY : Af.unbind) != null ? Aa : Af.off;
        return Y(U, "fromEventTarget", Af, Ae, U.fromBinder(function(Ag) {
            AV.call(Af, Ae, Ag);
            return function() {
                return AZ.call(Af, Ae, Ag)
            }
        }, AX))
    }
    ;
    U.fromPromise = function(AV, AW) {
        return Y(U, "fromPromise", AV, U.fromBinder(function(AX) {
            AV.then(AX, function(AY) {
                return AX(new AC(AY))
            });
            return function() {
                if (AW) {
                    return typeof AV.abort === "function" ? AV.abort() : void 0
                }
            }
        }, (function(AX) {
            return [AX, b()]
        })))
    }
    ;
    U.noMore = ["<no-more>"];
    U.more = ["<more>"];
    U.later = function(AV, AW) {
        return Y(U, "later", AV, AW, U.fromPoll(AV, function() {
            return [AW, b()]
        }))
    }
    ;
    U.sequentially = function(AX, AV) {
        var AW;
        AW = 0;
        return Y(U, "sequentially", AX, AV, U.fromPoll(AX, function() {
            var AY;
            AY = AV[AW++];
            if (AW < AV.length) {
                return AY
            } else {
                if (AW === AV.length) {
                    return [AY, b()]
                } else {
                    return b()
                }
            }
        }))
    }
    ;
    U.repeatedly = function(AX, AV) {
        var AW;
        AW = 0;
        return Y(U, "repeatedly", AX, AV, U.fromPoll(AX, function() {
            return AV[AW++ % AV.length]
        }))
    }
    ;
    U.spy = function(AV) {
        return N.push(AV)
    }
    ;
    N = [];
    I = function(AY) {
        var AW, AX, AV;
        if (N.length) {
            if (!I.running) {
                try {
                    I.running = true;
                    for (AX = 0,
                    AV = N.length; AX < AV; AX++) {
                        AW = N[AX];
                        AW(AY)
                    }
                } finally {
                    delete I.running
                }
            }
        }
        return void 0
    }
    ;
    L = function(AV) {
        return function() {
            var AX, AY, AZ, AW;
            AZ = arguments[0],
            AX = 2 <= arguments.length ? F.call(arguments, 1) : [];
            if (typeof AZ === "object" && AX.length) {
                AY = AZ;
                AW = AX[0];
                AZ = function() {
                    return AY[AW].apply(AY, arguments)
                }
                ;
                AX = AX.slice(1)
            }
            return AV.apply(null, [AZ].concat(F.call(AX)))
        }
    }
    ;
    AP = function(AW, AV) {
        return L(function() {
            var AX, AY, AZ;
            AY = arguments[0],
            AX = 2 <= arguments.length ? F.call(arguments, 1) : [];
            AZ = w(AV, [function(Aa, Ab) {
                return AY.apply(null, F.call(Aa).concat([Ab]))
            }
            ]);
            return Y.apply(null, [U, AW, AY].concat(F.call(AX), [U.combineAsArray(AX).flatMap(AZ)]))
        })
    }
    ;
    U.fromCallback = AP("fromCallback", function() {
        var AV, AW;
        AW = arguments[0],
        AV = 2 <= arguments.length ? F.call(arguments, 1) : [];
        return U.fromBinder(function(AX) {
            u(AW, AV)(AX);
            return AO
        }, (function(AX) {
            return [AX, b()]
        }))
    });
    U.fromNodeCallback = AP("fromNodeCallback", function() {
        var AV, AW;
        AW = arguments[0],
        AV = 2 <= arguments.length ? F.call(arguments, 1) : [];
        return U.fromBinder(function(AX) {
            u(AW, AV)(AX);
            return AO
        }, function(AX, AY) {
            if (AX) {
                return [new AC(AX), b()]
            }
            return [AY, b()]
        })
    });
    U.fromPoll = function(AV, AW) {
        return Y(U, "fromPoll", AV, AW, U.fromBinder((function(AX) {
            var AY;
            AY = U.scheduler.setInterval(AX, AV);
            return function() {
                return U.scheduler.clearInterval(AY)
            }
        }), AW))
    }
    ;
    U.interval = function(AV, AW) {
        if (AW == null) {
            AW = {}
        }
        return Y(U, "interval", AV, AW, U.fromPoll(AV, function() {
            return m(AW)
        }))
    }
    ;
    U.constant = function(AV) {
        return new AH(H(U, "constant", AV),function(AW) {
            AW(E(AV));
            AW(b());
            return AO
        }
        )
    }
    ;
    U.never = function() {
        return new M(H(U, "never"),function(AV) {
            AV(b());
            return AO
        }
        )
    }
    ;
    U.once = function(AV) {
        return new M(H(U, "once", AV),function(AW) {
            AW(D(AV));
            AW(b());
            return AO
        }
        )
    }
    ;
    U.fromArray = function(AV) {
        var AW;
        p(AV);
        if (!AV.length) {
            return Y(U, "fromArray", AV, U.never())
        } else {
            AW = 0;
            return new M(H(U, "fromArray", AV),function(Aa) {
                var AY, AZ, AX;
                AX = false;
                AZ = U.more;
                AY = function() {
                    var Ab;
                    if ((AZ !== U.noMore) && !AX) {
                        Ab = AV[AW++];
                        AZ = Aa(D(Ab));
                        if (AZ !== U.noMore) {
                            if (AW === AV.length) {
                                return Aa(b())
                            } else {
                                return AG.afterTransaction(AY)
                            }
                        }
                    }
                }
                ;
                AY();
                return function() {
                    return AX = true
                }
            }
            )
        }
    }
    ;
    U.mergeAll = function() {
        var AV;
        AV = 1 <= arguments.length ? F.call(arguments, 0) : [];
        if (A(AV[0])) {
            AV = AV[0]
        }
        if (AV.length) {
            return new M(H.apply(null, [U, "mergeAll"].concat(F.call(AV))),function(AZ) {
                var AX, AW, AY;
                AX = 0;
                AY = function(Aa) {
                    return function(Ab) {
                        return Aa.dispatcher.subscribe(function(Ad) {
                            var Ac;
                            if (Ad.isEnd()) {
                                AX++;
                                if (AX === AV.length) {
                                    return AZ(b())
                                } else {
                                    return U.more
                                }
                            } else {
                                Ac = AZ(Ad);
                                if (Ac === U.noMore) {
                                    Ab()
                                }
                                return Ac
                            }
                        })
                    }
                }
                ;
                AW = h.map(AY, AV);
                return l.apply(null, AW)
            }
            )
        } else {
            return U.never()
        }
    }
    ;
    U.zipAsArray = function() {
        var AV;
        AV = 1 <= arguments.length ? F.call(arguments, 0) : [];
        if (A(AV[0])) {
            AV = AV[0]
        }
        return Y.apply(null, [U, "zipAsArray"].concat(F.call(AV), [U.zipWith(AV, function() {
            var AW;
            AW = 1 <= arguments.length ? F.call(arguments, 0) : [];
            return AW
        })]))
    }
    ;
    U.zipWith = function() {
        var AW, AX, AV;
        AW = arguments[0],
        AX = 2 <= arguments.length ? F.call(arguments, 1) : [];
        if (!AI(AW)) {
            AV = [AW, AX[0]],
            AX = AV[0],
            AW = AV[1]
        }
        AX = h.map((function(AY) {
            return AY.toEventStream()
        }), AX);
        return Y.apply(null, [U, "zipWith", AW].concat(F.call(AX), [U.when(AX, AW)]))
    }
    ;
    U.groupSimultaneous = function() {
        var AW, AV, AX;
        AX = 1 <= arguments.length ? F.call(arguments, 0) : [];
        if (AX.length === 1 && A(AX[0])) {
            AX = AX[0]
        }
        AV = (function() {
            var Aa, AZ, AY;
            AY = [];
            for (Aa = 0,
            AZ = AX.length; Aa < AZ; Aa++) {
                AW = AX[Aa];
                AY.push(new AJ(AW))
            }
            return AY
        })();
        return Y.apply(null, [U, "groupSimultaneous"].concat(F.call(AX), [U.when(AV, (function() {
            var AY;
            AY = 1 <= arguments.length ? F.call(arguments, 0) : [];
            return AY
        }))]))
    }
    ;
    U.combineAsArray = function() {
        var AX, AY, AW, Aa, Ab, AZ, AV;
        Ab = 1 <= arguments.length ? F.call(arguments, 0) : [];
        if (Ab.length === 1 && A(Ab[0])) {
            Ab = Ab[0]
        }
        for (AX = AZ = 0,
        AV = Ab.length; AZ < AV; AX = ++AZ) {
            Aa = Ab[AX];
            if (!(AA(Aa))) {
                Ab[AX] = U.constant(Aa)
            }
        }
        if (Ab.length) {
            AW = (function() {
                var Ae, Ad, Ac;
                Ac = [];
                for (Ae = 0,
                Ad = Ab.length; Ae < Ad; Ae++) {
                    AY = Ab[Ae];
                    Ac.push(new AL(AY,true))
                }
                return Ac
            })();
            return Y.apply(null, [U, "combineAsArray"].concat(F.call(Ab), [U.when(AW, (function() {
                var Ac;
                Ac = 1 <= arguments.length ? F.call(arguments, 0) : [];
                return Ac
            })).toProperty()]))
        } else {
            return U.constant([])
        }
    }
    ;
    U.onValues = function() {
        var AW, AX, AV;
        AX = 2 <= arguments.length ? F.call(arguments, 0, AV = arguments.length - 1) : (AV = 0,
        []),
        AW = arguments[AV++];
        return U.combineAsArray(AX).onValues(AW)
    }
    ;
    U.combineWith = function() {
        var AV, AW;
        AV = arguments[0],
        AW = 2 <= arguments.length ? F.call(arguments, 1) : [];
        return Y.apply(null, [U, "combineWith", AV].concat(F.call(AW), [U.combineAsArray(AW).map(function(AX) {
            return AV.apply(null, AX)
        })]))
    }
    ;
    U.combineTemplate = function(Ac) {
        var AX, AY, Ae, Ad, AW, Aa, AV, Ab, AZ, Af;
        AV = [];
        Af = [];
        Aa = function(Ag) {
            return Ag[Ag.length - 1]
        }
        ;
        AZ = function(Ag, Ah, Ai) {
            return Aa(Ag)[Ah] = Ai
        }
        ;
        AX = function(Ah, Ag) {
            return function(Aj, Ai) {
                return AZ(Aj, Ah, Ai[Ag])
            }
        }
        ;
        AW = function(Ag, Ah) {
            return function(Ai) {
                return AZ(Ai, Ag, Ah)
            }
        }
        ;
        Ab = function(Ag) {
            if (A(Ag)) {
                return []
            } else {
                return {}
            }
        }
        ;
        Ae = function(Ah, Ai) {
            var Aj, Ag;
            if (AA(Ai)) {
                Af.push(Ai);
                return AV.push(AX(Ah, Af.length - 1))
            } else {
                if (Ai === Object(Ai) && typeof Ai !== "function" && !(Ai instanceof RegExp) && !(Ai instanceof Date)) {
                    Ag = function(Ak) {
                        return function(Al) {
                            var Am;
                            Am = Ab(Ai);
                            AZ(Al, Ak, Am);
                            return Al.push(Am)
                        }
                    }
                    ;
                    Aj = function(Ak) {
                        return Ak.pop()
                    }
                    ;
                    AV.push(Ag(Ah));
                    Ad(Ai);
                    return AV.push(Aj)
                } else {
                    return AV.push(AW(Ah, Ai))
                }
            }
        }
        ;
        Ad = function(Ag) {
            return h.each(Ag, Ae)
        }
        ;
        Ad(Ac);
        AY = function(Aj) {
            var Ai, Al, Ag, Ak, Ah;
            Ag = Ab(Ac);
            Ai = [Ag];
            for (Ak = 0,
            Ah = AV.length; Ak < Ah; Ak++) {
                Al = AV[Ak];
                Al(Ai, Aj)
            }
            return Ag
        }
        ;
        return Y(U, "combineTemplate", Ac, U.combineAsArray(Af).map(AY))
    }
    ;
    U.retry = function(AY) {
        var AX, Aa, Ab, AW, AV, AZ;
        if (!AI(AY.source)) {
            throw new f("'source' option has to be a function")
        }
        AZ = AY.source;
        AW = AY.retries || 0;
        Ab = AY.maxRetries || AW;
        AX = AY.delay || function() {
            return 0
        }
        ;
        Aa = AY.isRetryable || function() {
            return true
        }
        ;
        AV = function(Ad) {
            var Ae, Ac;
            Ac = {
                source: AZ,
                retries: AW - 1,
                maxRetries: Ab,
                delay: AX,
                isRetryable: Aa
            };
            Ae = function() {
                return U.retry(Ac)
            }
            ;
            return U.later(AX(Ad)).filter(false).concat(U.once().flatMap(Ae))
        }
        ;
        return Y(U, "retry", AY, AZ().flatMapError(function(Ac) {
            if (Aa(Ac) && AW > 0) {
                return AV({
                    error: Ac,
                    retriesDone: Ab - AW
                })
            } else {
                return U.once(new AC(Ac))
            }
        }))
    }
    ;
    O = 0;
    a = (function() {
        function AV() {
            this.id = ++O
        }
        AV.prototype.isEvent = function() {
            return true
        }
        ;
        AV.prototype.isEnd = function() {
            return false
        }
        ;
        AV.prototype.isInitial = function() {
            return false
        }
        ;
        AV.prototype.isNext = function() {
            return false
        }
        ;
        AV.prototype.isError = function() {
            return false
        }
        ;
        AV.prototype.hasValue = function() {
            return false
        }
        ;
        AV.prototype.filter = function() {
            return true
        }
        ;
        AV.prototype.inspect = function() {
            return this.toString()
        }
        ;
        AV.prototype.log = function() {
            return this.toString()
        }
        ;
        return AV
    })();
    AB = (function(AW) {
        C(AV, AW);
        function AV(AY, AX) {
            AV.__super__.constructor.call(this);
            if (!AX && AI(AY) || AY instanceof AV) {
                this.valueF = AY;
                this.valueInternal = void 0
            } else {
                this.valueF = void 0;
                this.valueInternal = AY
            }
        }
        AV.prototype.isNext = function() {
            return true
        }
        ;
        AV.prototype.hasValue = function() {
            return true
        }
        ;
        AV.prototype.value = function() {
            if (this.valueF instanceof AV) {
                this.valueInternal = this.valueF.value();
                this.valueF = void 0
            } else {
                if (this.valueF) {
                    this.valueInternal = this.valueF();
                    this.valueF = void 0
                }
            }
            return this.valueInternal
        }
        ;
        AV.prototype.fmap = function(AZ) {
            var AX, AY;
            if (this.valueInternal) {
                AY = this.valueInternal;
                return this.apply(function() {
                    return AZ(AY)
                })
            } else {
                AX = this;
                return this.apply(function() {
                    return AZ(AX.value())
                })
            }
        }
        ;
        AV.prototype.apply = function(AX) {
            return new AV(AX)
        }
        ;
        AV.prototype.filter = function(AX) {
            return AX(this.value())
        }
        ;
        AV.prototype.toString = function() {
            return h.toString(this.value())
        }
        ;
        AV.prototype.log = function() {
            return this.value()
        }
        ;
        return AV
    })(a);
    AE = (function(AW) {
        C(AV, AW);
        function AV() {
            return AV.__super__.constructor.apply(this, arguments)
        }
        AV.prototype.isInitial = function() {
            return true
        }
        ;
        AV.prototype.isNext = function() {
            return false
        }
        ;
        AV.prototype.apply = function(AX) {
            return new AV(AX)
        }
        ;
        AV.prototype.toNext = function() {
            return new AB(this)
        }
        ;
        return AV
    })(AB);
    c = (function(AV) {
        C(AW, AV);
        function AW() {
            return AW.__super__.constructor.apply(this, arguments)
        }
        AW.prototype.isEnd = function() {
            return true
        }
        ;
        AW.prototype.fmap = function() {
            return this
        }
        ;
        AW.prototype.apply = function() {
            return this
        }
        ;
        AW.prototype.toString = function() {
            return "<end>"
        }
        ;
        return AW
    })(a);
    AC = (function(AV) {
        C(AW, AV);
        function AW(AX) {
            this.error = AX
        }
        AW.prototype.isError = function() {
            return true
        }
        ;
        AW.prototype.fmap = function() {
            return this
        }
        ;
        AW.prototype.apply = function() {
            return this
        }
        ;
        AW.prototype.toString = function() {
            return "<error> " + h.toString(this.error)
        }
        ;
        return AW
    })(a);
    R = 0;
    Q = (function() {
        function AV(AW) {
            this.id = ++R;
            Y(AW, this);
            this.initialDesc = this.desc
        }
        AV.prototype.subscribe = function(AW) {
            return AG.wrappedSubscribe(this, AW)
        }
        ;
        AV.prototype.subscribeInternal = function(AW) {
            return this.dispatcher.subscribe(AW)
        }
        ;
        AV.prototype.onValue = function() {
            var AW;
            AW = g(arguments);
            return this.subscribe(function(AX) {
                if (AX.hasValue()) {
                    return AW(AX.value())
                }
            })
        }
        ;
        AV.prototype.onValues = function(AW) {
            return this.onValue(function(AX) {
                return AW.apply(null, AX)
            })
        }
        ;
        AV.prototype.onError = function() {
            var AW;
            AW = g(arguments);
            return this.subscribe(function(AX) {
                if (AX.isError()) {
                    return AW(AX.error)
                }
            })
        }
        ;
        AV.prototype.onEnd = function() {
            var AW;
            AW = g(arguments);
            return this.subscribe(function(AX) {
                if (AX.isEnd()) {
                    return AW()
                }
            })
        }
        ;
        AV.prototype.errors = function() {
            return Y(this, "errors", this.filter(function() {
                return false
            }))
        }
        ;
        AV.prototype.filter = function() {
            var AW, AX;
            AX = arguments[0],
            AW = 2 <= arguments.length ? F.call(arguments, 1) : [];
            return e(this, AX, AW, function(AY) {
                return Y(this, "filter", AY, this.withHandler(function(AZ) {
                    if (AZ.filter(AY)) {
                        return this.push(AZ)
                    } else {
                        return U.more
                    }
                }))
            })
        }
        ;
        AV.prototype.takeWhile = function() {
            var AW, AX;
            AX = arguments[0],
            AW = 2 <= arguments.length ? F.call(arguments, 1) : [];
            return e(this, AX, AW, function(AY) {
                return Y(this, "takeWhile", AY, this.withHandler(function(AZ) {
                    if (AZ.filter(AY)) {
                        return this.push(AZ)
                    } else {
                        this.push(b());
                        return U.noMore
                    }
                }))
            })
        }
        ;
        AV.prototype.endOnError = function() {
            var AW, AX;
            AX = arguments[0],
            AW = 2 <= arguments.length ? F.call(arguments, 1) : [];
            if (AX == null) {
                AX = true
            }
            return e(this, AX, AW, function(AY) {
                return Y(this, "endOnError", this.withHandler(function(AZ) {
                    if (AZ.isError() && AY(AZ.error)) {
                        this.push(AZ);
                        return this.push(b())
                    } else {
                        return this.push(AZ)
                    }
                }))
            })
        }
        ;
        AV.prototype.take = function(AW) {
            if (AW <= 0) {
                return U.never()
            }
            return Y(this, "take", AW, this.withHandler(function(AX) {
                if (!AX.hasValue()) {
                    return this.push(AX)
                } else {
                    AW--;
                    if (AW > 0) {
                        return this.push(AX)
                    } else {
                        if (AW === 0) {
                            this.push(AX)
                        }
                        this.push(b());
                        return U.noMore
                    }
                }
            }))
        }
        ;
        AV.prototype.map = function() {
            var AW, AX;
            AX = arguments[0],
            AW = 2 <= arguments.length ? F.call(arguments, 1) : [];
            if (AX instanceof AH) {
                return AX.sampledBy(this, j)
            } else {
                return e(this, AX, AW, function(AY) {
                    return Y(this, "map", AY, this.withHandler(function(AZ) {
                        return this.push(AZ.fmap(AY))
                    }))
                })
            }
        }
        ;
        AV.prototype.mapError = function() {
            var AW;
            AW = g(arguments);
            return Y(this, "mapError", AW, this.withHandler(function(AX) {
                if (AX.isError()) {
                    return this.push(m(AW(AX.error)))
                } else {
                    return this.push(AX)
                }
            }))
        }
        ;
        AV.prototype.mapEnd = function() {
            var AW;
            AW = g(arguments);
            return Y(this, "mapEnd", AW, this.withHandler(function(AX) {
                if (AX.isEnd()) {
                    this.push(m(AW(AX)));
                    this.push(b());
                    return U.noMore
                } else {
                    return this.push(AX)
                }
            }))
        }
        ;
        AV.prototype.doAction = function() {
            var AW;
            AW = g(arguments);
            return Y(this, "doAction", AW, this.withHandler(function(AX) {
                if (AX.hasValue()) {
                    AW(AX.value())
                }
                return this.push(AX)
            }))
        }
        ;
        AV.prototype.skip = function(AW) {
            return Y(this, "skip", AW, this.withHandler(function(AX) {
                if (!AX.hasValue()) {
                    return this.push(AX)
                } else {
                    if (AW > 0) {
                        AW--;
                        return U.more
                    } else {
                        return this.push(AX)
                    }
                }
            }))
        }
        ;
        AV.prototype.skipDuplicates = function(AW) {
            if (AW == null) {
                AW = function(AY, AX) {
                    return AY === AX
                }
            }
            return Y(this, "skipDuplicates", this.withStateMachine(K, function(AY, AX) {
                if (!AX.hasValue()) {
                    return [AY, [AX]]
                } else {
                    if (AX.isInitial() || AY === K || !AW(AY.get(), AX.value())) {
                        return [new d(AX.value()), [AX]]
                    } else {
                        return [AY, []]
                    }
                }
            }))
        }
        ;
        AV.prototype.skipErrors = function() {
            return Y(this, "skipErrors", this.withHandler(function(AW) {
                if (AW.isError()) {
                    return U.more
                } else {
                    return this.push(AW)
                }
            }))
        }
        ;
        AV.prototype.withStateMachine = function(AW, AY) {
            var AX;
            AX = AW;
            return Y(this, "withStateMachine", AW, AY, this.withHandler(function(Ad) {
                var Ac, Af, Aa, Ag, Ab, Ae, AZ;
                Ac = AY(AX, Ad);
                Af = Ac[0],
                Ag = Ac[1];
                AX = Af;
                Ab = U.more;
                for (Ae = 0,
                AZ = Ag.length; Ae < AZ; Ae++) {
                    Aa = Ag[Ae];
                    Ab = this.push(Aa);
                    if (Ab === U.noMore) {
                        return Ab
                    }
                }
                return Ab
            }))
        }
        ;
        AV.prototype.scan = function(AX, AZ) {
            var AY, Aa, AW;
            AZ = T(AZ);
            AY = q(AX);
            AW = (function(Ab) {
                return function(Ag) {
                    var Af, Ae, Ad, Ac;
                    Af = false;
                    Ac = AO;
                    Ae = U.more;
                    Ad = function() {
                        if (!Af) {
                            return AY.forEach(function(Ah) {
                                Af = true;
                                Ae = Ag(new AE(function() {
                                    return Ah
                                }
                                ));
                                if (Ae === U.noMore) {
                                    Ac();
                                    return Ac = AO
                                }
                            })
                        }
                    }
                    ;
                    Ac = Ab.dispatcher.subscribe(function(Aj) {
                        var Ah, Ai;
                        if (Aj.hasValue()) {
                            if (Af && Aj.isInitial()) {
                                return U.more
                            } else {
                                if (!Aj.isInitial()) {
                                    Ad()
                                }
                                Af = true;
                                Ai = AY.getOrElse(void 0);
                                Ah = AZ(Ai, Aj.value());
                                AY = new d(Ah);
                                return Ag(Aj.apply(function() {
                                    return Ah
                                }))
                            }
                        } else {
                            if (Aj.isEnd()) {
                                Ae = Ad()
                            }
                            if (Ae !== U.noMore) {
                                return Ag(Aj)
                            }
                        }
                    });
                    AG.whenDoneWith(Aa, Ad);
                    return Ac
                }
            })(this);
            return Aa = new AH(H(this, "scan", AX, AZ),AW)
        }
        ;
        AV.prototype.fold = function(AW, AX) {
            return Y(this, "fold", AW, AX, this.scan(AW, AX).sampledBy(this.filter(false).mapEnd().toProperty()))
        }
        ;
        AV.prototype.zip = function(AW, AX) {
            if (AX == null) {
                AX = Array
            }
            return Y(this, "zip", AW, U.zipWith([this, AW], AX))
        }
        ;
        AV.prototype.diff = function(AX, AW) {
            AW = T(AW);
            return Y(this, "diff", AX, AW, this.scan([AX], function(AY, AZ) {
                return [AZ, AW(AY[0], AZ)]
            }).filter(function(AY) {
                return AY.length === 2
            }).map(function(AY) {
                return AY[1]
            }))
        }
        ;
        AV.prototype.flatMap = function() {
            return AM(this, t(arguments))
        }
        ;
        AV.prototype.flatMapFirst = function() {
            return AM(this, t(arguments), true)
        }
        ;
        AV.prototype.flatMapWithConcurrencyLimit = function() {
            var AX, AW;
            AW = arguments[0],
            AX = 2 <= arguments.length ? F.call(arguments, 1) : [];
            return Y.apply(null, [this, "flatMapWithConcurrencyLimit", AW].concat(F.call(AX), [AM(this, t(AX), false, AW)]))
        }
        ;
        AV.prototype.flatMapLatest = function() {
            var AW, AX;
            AW = t(arguments);
            AX = this.toEventStream();
            return Y(this, "flatMapLatest", AW, AX.flatMap(function(AY) {
                return o(AW(AY)).takeUntil(AX)
            }))
        }
        ;
        AV.prototype.flatMapError = function(AW) {
            return Y(this, "flatMapError", AW, this.mapError(function(AX) {
                return new AC(AX)
            }).flatMap(function(AX) {
                if (AX instanceof AC) {
                    return AW(AX.error)
                } else {
                    return U.once(AX)
                }
            }))
        }
        ;
        AV.prototype.flatMapConcat = function() {
            return Y.apply(null, [this, "flatMapConcat"].concat(F.call(arguments), [this.flatMapWithConcurrencyLimit.apply(this, [1].concat(F.call(arguments)))]))
        }
        ;
        AV.prototype.bufferingThrottle = function(AW) {
            return Y(this, "bufferingThrottle", AW, this.flatMapConcat(function(AX) {
                return U.once(AX).concat(U.later(AW).filter(false))
            }))
        }
        ;
        AV.prototype.not = function() {
            return Y(this, "not", this.map(function(AW) {
                return !AW
            }))
        }
        ;
        AV.prototype.log = function() {
            var AW;
            AW = 1 <= arguments.length ? F.call(arguments, 0) : [];
            this.subscribe(function(AX) {
                return typeof console !== "undefined" && console !== null ? typeof console.log === "function" ? console.log.apply(console, F.call(AW).concat([AX.log()])) : void 0 : void 0
            });
            return this
        }
        ;
        AV.prototype.slidingWindow = function(AX, AW) {
            if (AW == null) {
                AW = 0
            }
            return Y(this, "slidingWindow", AX, AW, this.scan([], (function(AY, AZ) {
                return AY.concat([AZ]).slice(-AX)
            })).filter((function(AY) {
                return AY.length >= AW
            })))
        }
        ;
        AV.prototype.combine = function(AW, AY) {
            var AX;
            AX = T(AY);
            return Y(this, "combine", AW, AY, U.combineAsArray(this, AW).map(function(AZ) {
                return AX(AZ[0], AZ[1])
            }))
        }
        ;
        AV.prototype.decode = function(AW) {
            return Y(this, "decode", AW, this.combine(U.combineTemplate(AW), function(AY, AX) {
                return AX[AY]
            }))
        }
        ;
        AV.prototype.awaiting = function(AW) {
            return Y(this, "awaiting", AW, U.groupSimultaneous(this, AW).map(function(AX) {
                var AY, AZ;
                AY = AX[0],
                AZ = AX[1];
                return AZ.length === 0
            }).toProperty(false).skipDuplicates())
        }
        ;
        AV.prototype.name = function(AW) {
            this._name = AW;
            return this
        }
        ;
        AV.prototype.withDescription = function() {
            return H.apply(null, arguments).apply(this)
        }
        ;
        AV.prototype.toString = function() {
            if (this._name) {
                return this._name
            } else {
                return this.desc.toString()
            }
        }
        ;
        AV.prototype.internalDeps = function() {
            return this.initialDesc.deps()
        }
        ;
        return AV
    })();
    Q.prototype.reduce = Q.prototype.fold;
    Q.prototype.assign = Q.prototype.onValue;
    Q.prototype.inspect = Q.prototype.toString;
    AM = function(AX, Ab, AY, AW) {
        var Aa, AV, AZ;
        AZ = [AX];
        Aa = [];
        AV = new M(H(AX, "flatMap" + (AY ? "First" : ""), Ab),function(Ae) {
            var Ag, Af, Ah, Ac, Ad;
            Ah = new AN();
            Ac = [];
            Ad = function(Ai) {
                var Aj;
                Aj = o(Ab(Ai.value()));
                Aa.push(Aj);
                return Ah.add(function(Al, Ak) {
                    return Aj.dispatcher.subscribe(function(An) {
                        var Am;
                        if (An.isEnd()) {
                            h.remove(Aj, Aa);
                            Af();
                            Ag(Ak);
                            return U.noMore
                        } else {
                            if (An instanceof AE) {
                                An = An.toNext()
                            }
                            Am = Ae(An);
                            if (Am === U.noMore) {
                                Al()
                            }
                            return Am
                        }
                    })
                })
            }
            ;
            Af = function() {
                var Ai;
                Ai = Ac.shift();
                if (Ai) {
                    return Ad(Ai)
                }
            }
            ;
            Ag = function(Ai) {
                Ai();
                if (Ah.empty()) {
                    return Ae(b())
                }
            }
            ;
            Ah.add(function(Aj, Ai) {
                return AX.dispatcher.subscribe(function(Ak) {
                    if (Ak.isEnd()) {
                        return Ag(Ai)
                    } else {
                        if (Ak.isError()) {
                            return Ae(Ak)
                        } else {
                            if (AY && Ah.count() > 1) {
                                return U.more
                            } else {
                                if (Ah.unsubscribed) {
                                    return U.noMore
                                }
                                if (AW && Ah.count() > AW) {
                                    return Ac.push(Ak)
                                } else {
                                    return Ad(Ak)
                                }
                            }
                        }
                    }
                })
            });
            return Ah.unsubscribe
        }
        );
        AV.internalDeps = function() {
            if (Aa.length) {
                return AZ.concat(Aa)
            } else {
                return AZ
            }
        }
        ;
        return AV
    }
    ;
    M = (function(AW) {
        C(AV, AW);
        function AV(AZ, AX, AY) {
            if (AI(AZ)) {
                AY = AX;
                AX = AZ;
                AZ = []
            }
            AV.__super__.constructor.call(this, AZ);
            AK(AX);
            this.dispatcher = new Z(AX,AY);
            I(this)
        }
        AV.prototype.delay = function(AX) {
            return Y(this, "delay", AX, this.flatMap(function(AY) {
                return U.later(AX, AY)
            }))
        }
        ;
        AV.prototype.debounce = function(AX) {
            return Y(this, "debounce", AX, this.flatMapLatest(function(AY) {
                return U.later(AX, AY)
            }))
        }
        ;
        AV.prototype.debounceImmediate = function(AX) {
            return Y(this, "debounceImmediate", AX, this.flatMapFirst(function(AY) {
                return U.once(AY).concat(U.later(AX).filter(false))
            }))
        }
        ;
        AV.prototype.throttle = function(AX) {
            return Y(this, "throttle", AX, this.bufferWithTime(AX).map(function(AY) {
                return AY[AY.length - 1]
            }))
        }
        ;
        AV.prototype.bufferWithTime = function(AX) {
            return Y(this, "bufferWithTime", AX, this.bufferWithTimeOrCount(AX, Number.MAX_VALUE))
        }
        ;
        AV.prototype.bufferWithCount = function(AX) {
            return Y(this, "bufferWithCount", AX, this.bufferWithTimeOrCount(void 0, AX))
        }
        ;
        AV.prototype.bufferWithTimeOrCount = function(AX, AY) {
            var AZ;
            AZ = function(Aa) {
                if (Aa.values.length === AY) {
                    return Aa.flush()
                } else {
                    if (AX !== void 0) {
                        return Aa.schedule()
                    }
                }
            }
            ;
            return Y(this, "bufferWithTimeOrCount", AX, AY, this.buffer(AX, AZ, AZ))
        }
        ;
        AV.prototype.buffer = function(AZ, Ab, AY) {
            var AX, Ac, Aa;
            if (Ab == null) {
                Ab = AO
            }
            if (AY == null) {
                AY = AO
            }
            AX = {
                scheduled: false,
                end: void 0,
                values: [],
                flush: function() {
                    var Ad;
                    this.scheduled = false;
                    if (this.values.length > 0) {
                        Ad = this.push(m(this.values));
                        this.values = [];
                        if (this.end != null) {
                            return this.push(this.end)
                        } else {
                            if (Ad !== U.noMore) {
                                return AY(this)
                            }
                        }
                    } else {
                        if (this.end != null) {
                            return this.push(this.end)
                        }
                    }
                },
                schedule: function() {
                    if (!this.scheduled) {
                        this.scheduled = true;
                        return AZ((function(Ad) {
                            return function() {
                                return Ad.flush()
                            }
                        })(this))
                    }
                }
            };
            Aa = U.more;
            if (!AI(AZ)) {
                Ac = AZ;
                AZ = function(Ad) {
                    return U.scheduler.setTimeout(Ad, Ac)
                }
            }
            return Y(this, "buffer", this.withHandler(function(Ad) {
                AX.push = (function(Ae) {
                    return function(Af) {
                        return Ae.push(Af)
                    }
                })(this);
                if (Ad.isError()) {
                    Aa = this.push(Ad)
                } else {
                    if (Ad.isEnd()) {
                        AX.end = Ad;
                        if (!AX.scheduled) {
                            AX.flush()
                        }
                    } else {
                        AX.values.push(Ad.value());
                        Ab(AX)
                    }
                }
                return Aa
            }))
        }
        ;
        AV.prototype.merge = function(AX) {
            var AY;
            v(AX);
            AY = this;
            return Y(AY, "merge", AX, U.mergeAll(this, AX))
        }
        ;
        AV.prototype.toProperty = function(AX) {
            var AY, AZ;
            AZ = arguments.length === 0 ? K : q(function() {
                return AX
            });
            AY = this.dispatcher;
            return new AH(H(this, "toProperty", AX),function(Ae) {
                var Ad, Ac, Ab, Aa;
                Ad = false;
                Aa = AO;
                Ac = U.more;
                Ab = function() {
                    if (!Ad) {
                        return AZ.forEach(function(Af) {
                            Ad = true;
                            Ac = Ae(new AE(Af));
                            if (Ac === U.noMore) {
                                Aa();
                                return Aa = AO
                            }
                        })
                    }
                }
                ;
                Aa = AY.subscribe(function(Af) {
                    if (Af.hasValue()) {
                        if (Ad && Af.isInitial()) {
                            return U.more
                        } else {
                            if (!Af.isInitial()) {
                                Ab()
                            }
                            Ad = true;
                            AZ = new d(Af);
                            return Ae(Af)
                        }
                    } else {
                        if (Af.isEnd()) {
                            Ac = Ab()
                        }
                        if (Ac !== U.noMore) {
                            return Ae(Af)
                        }
                    }
                });
                Ab();
                return Aa
            }
            )
        }
        ;
        AV.prototype.toEventStream = function() {
            return this
        }
        ;
        AV.prototype.sampledBy = function(AX, AY) {
            return Y(this, "sampledBy", AX, AY, this.toProperty().sampledBy(AX, AY))
        }
        ;
        AV.prototype.concat = function(AX) {
            var AY;
            AY = this;
            return new AV(H(AY, "concat", AX),function(Aa) {
                var Ab, AZ;
                AZ = AO;
                Ab = AY.dispatcher.subscribe(function(Ac) {
                    if (Ac.isEnd()) {
                        return AZ = AX.dispatcher.subscribe(Aa)
                    } else {
                        return Aa(Ac)
                    }
                });
                return function() {
                    Ab();
                    return AZ()
                }
            }
            )
        }
        ;
        AV.prototype.takeUntil = function(AX) {
            var AY;
            AY = {};
            return Y(this, "takeUntil", AX, U.groupSimultaneous(this.mapEnd(AY), AX.skipErrors()).withHandler(function(Ac) {
                var Af, Ab, Ae, Ad, Aa, AZ;
                if (!Ac.hasValue()) {
                    return this.push(Ac)
                } else {
                    AZ = Ac.value(),
                    Af = AZ[0],
                    AX = AZ[1];
                    if (AX.length) {
                        return this.push(b())
                    } else {
                        Ab = U.more;
                        for (Ad = 0,
                        Aa = Af.length; Ad < Aa; Ad++) {
                            Ae = Af[Ad];
                            if (Ae === AY) {
                                Ab = this.push(b())
                            } else {
                                Ab = this.push(m(Ae))
                            }
                        }
                        return Ab
                    }
                }
            }))
        }
        ;
        AV.prototype.skipUntil = function(AY) {
            var AX;
            AX = AY.take(1).map(true).toProperty(false);
            return Y(this, "skipUntil", AY, this.filter(AX))
        }
        ;
        AV.prototype.skipWhile = function() {
            var AX, AZ, AY;
            AZ = arguments[0],
            AX = 2 <= arguments.length ? F.call(arguments, 1) : [];
            AY = false;
            return e(this, AZ, AX, function(Aa) {
                return Y(this, "skipWhile", Aa, this.withHandler(function(Ab) {
                    if (AY || !Ab.hasValue() || !Aa(Ab.value())) {
                        if (Ab.hasValue()) {
                            AY = true
                        }
                        return this.push(Ab)
                    } else {
                        return U.more
                    }
                }))
            })
        }
        ;
        AV.prototype.holdWhen = function(Aa) {
            var AY, AX, AZ;
            AZ = Aa.startWith(false);
            AX = AZ.filter(function(Ab) {
                return !Ab
            });
            AY = AZ.filter(h.id);
            return Y(this, "holdWhen", Aa, this.filter(false).merge(AZ.flatMapConcat((function(Ab) {
                return function(Ac) {
                    if (!Ac) {
                        return Ab.takeUntil(AY)
                    } else {
                        return Ab.scan([], (function(Ae, Ad) {
                            return Ae.concat(Ad)
                        })).sampledBy(AX).take(1).flatMap(U.fromArray)
                    }
                }
            })(this))))
        }
        ;
        AV.prototype.startWith = function(AX) {
            return Y(this, "startWith", AX, U.once(AX).concat(this))
        }
        ;
        AV.prototype.withHandler = function(AX) {
            return new AV(H(this, "withHandler", AX),this.dispatcher.subscribe,AX)
        }
        ;
        return AV
    })(Q);
    AH = (function(AV) {
        C(AW, AV);
        function AW(AZ, AX, AY) {
            if (AI(AZ)) {
                AY = AX;
                AX = AZ;
                AZ = []
            }
            AW.__super__.constructor.call(this, AZ);
            AK(AX);
            this.dispatcher = new W(this,AX,AY);
            I(this)
        }
        AW.prototype.sampledBy = function(AZ, Ac) {
            var AY, AX, Aa, Ad, Ab;
            if (Ac != null) {
                Ac = T(Ac)
            } else {
                AY = true;
                Ac = function(Ae) {
                    return Ae.value()
                }
            }
            Ab = new AL(this,false,AY);
            Aa = new AL(AZ,true,AY);
            Ad = U.when([Ab, Aa], Ac);
            AX = AZ instanceof AW ? Ad.toProperty() : Ad;
            return Y(this, "sampledBy", AZ, Ac, AX)
        }
        ;
        AW.prototype.sample = function(AX) {
            return Y(this, "sample", AX, this.sampledBy(U.interval(AX, {})))
        }
        ;
        AW.prototype.changes = function() {
            return new M(H(this, "changes"),(function(AX) {
                return function(AY) {
                    return AX.dispatcher.subscribe(function(AZ) {
                        if (!AZ.isInitial()) {
                            return AY(AZ)
                        }
                    })
                }
            })(this))
        }
        ;
        AW.prototype.withHandler = function(AX) {
            return new AW(H(this, "withHandler", AX),this.dispatcher.subscribe,AX)
        }
        ;
        AW.prototype.toProperty = function() {
            x(arguments);
            return this
        }
        ;
        AW.prototype.toEventStream = function() {
            return new M(H(this, "toEventStream"),(function(AX) {
                return function(AY) {
                    return AX.dispatcher.subscribe(function(AZ) {
                        if (AZ.isInitial()) {
                            AZ = AZ.toNext()
                        }
                        return AY(AZ)
                    })
                }
            })(this))
        }
        ;
        AW.prototype.and = function(AX) {
            return Y(this, "and", AX, this.combine(AX, function(AY, AZ) {
                return AY && AZ
            }))
        }
        ;
        AW.prototype.or = function(AX) {
            return Y(this, "or", AX, this.combine(AX, function(AY, AZ) {
                return AY || AZ
            }))
        }
        ;
        AW.prototype.delay = function(AX) {
            return this.delayChanges("delay", AX, function(AY) {
                return AY.delay(AX)
            })
        }
        ;
        AW.prototype.debounce = function(AX) {
            return this.delayChanges("debounce", AX, function(AY) {
                return AY.debounce(AX)
            })
        }
        ;
        AW.prototype.throttle = function(AX) {
            return this.delayChanges("throttle", AX, function(AY) {
                return AY.throttle(AX)
            })
        }
        ;
        AW.prototype.delayChanges = function() {
            var AZ, AY, AX;
            AZ = 2 <= arguments.length ? F.call(arguments, 0, AX = arguments.length - 1) : (AX = 0,
            []),
            AY = arguments[AX++];
            return Y.apply(null, [this].concat(F.call(AZ), [V(this, AY(this.changes()))]))
        }
        ;
        AW.prototype.takeUntil = function(AY) {
            var AX;
            AX = this.changes().takeUntil(AY);
            return Y(this, "takeUntil", AY, V(this, AX))
        }
        ;
        AW.prototype.startWith = function(AX) {
            return Y(this, "startWith", AX, this.scan(AX, function(AZ, AY) {
                return AY
            }))
        }
        ;
        AW.prototype.bufferingThrottle = function() {
            var AX;
            return (AX = AW.__super__.bufferingThrottle.apply(this, arguments)).bufferingThrottle.apply(AX, arguments).toProperty()
        }
        ;
        return AW
    })(Q);
    e = function(AZ, AX, AV, AY) {
        var AW;
        if (AX instanceof AH) {
            AW = AX.sampledBy(AZ, function(Ab, Aa) {
                return [Ab, Aa]
            });
            return AY.call(AW, function(Aa) {
                var Ac, Ab;
                Ac = Aa[0],
                Ab = Aa[1];
                return Ac
            }).map(function(Aa) {
                var Ac, Ab;
                Ac = Aa[0],
                Ab = Aa[1];
                return Ab
            })
        } else {
            AX = u(AX, AV);
            return AY.call(AZ, AX)
        }
    }
    ;
    V = function(AW, AX) {
        var AV;
        AV = new M(H(AW, "justInitValue"),function(Aa) {
            var AY, AZ;
            AZ = void 0;
            AY = AW.dispatcher.subscribe(function(Ab) {
                if (!Ab.isEnd()) {
                    AZ = Ab
                }
                return U.noMore
            });
            AG.whenDoneWith(AV, function() {
                if (AZ != null) {
                    Aa(AZ)
                }
                return Aa(b())
            });
            return AY
        }
        );
        return AV.concat(AX).toProperty()
    }
    ;
    Z = (function() {
        function AV(AW, AX) {
            this._subscribe = AW;
            this._handleEvent = AX;
            this.subscribe = AD(this.subscribe, this);
            this.handleEvent = AD(this.handleEvent, this);
            this.subscriptions = [];
            this.queue = [];
            this.pushing = false;
            this.ended = false;
            this.prevError = void 0;
            this.unsubSrc = void 0
        }
        AV.prototype.hasSubscribers = function() {
            return this.subscriptions.length > 0
        }
        ;
        AV.prototype.removeSub = function(AW) {
            return this.subscriptions = h.without(AW, this.subscriptions)
        }
        ;
        AV.prototype.push = function(AW) {
            if (AW.isEnd()) {
                this.ended = true
            }
            return AG.inTransaction(AW, this, this.pushIt, [AW])
        }
        ;
        AV.prototype.pushToSubscriptions = function(Aa) {
            var Ac, AZ, AY, AX, Ab, AW;
            try {
                AX = this.subscriptions;
                for (Ab = 0,
                AW = AX.length; Ab < AW; Ab++) {
                    AY = AX[Ab];
                    AZ = AY.sink(Aa);
                    if (AZ === U.noMore || Aa.isEnd()) {
                        this.removeSub(AY)
                    }
                }
                return true
            } catch (Ad) {
                Ac = Ad;
                this.pushing = false;
                this.queue = [];
                throw Ac
            }
        }
        ;
        AV.prototype.pushIt = function(AW) {
            if (!this.pushing) {
                if (AW === this.prevError) {
                    return
                }
                if (AW.isError()) {
                    this.prevError = AW
                }
                this.pushing = true;
                this.pushToSubscriptions(AW);
                this.pushing = false;
                while (this.queue.length) {
                    AW = this.queue.shift();
                    this.push(AW)
                }
                if (this.hasSubscribers()) {
                    return U.more
                } else {
                    this.unsubscribeFromSource();
                    return U.noMore
                }
            } else {
                this.queue.push(AW);
                return U.more
            }
        }
        ;
        AV.prototype.handleEvent = function(AW) {
            if (this._handleEvent) {
                return this._handleEvent(AW)
            } else {
                return this.push(AW)
            }
        }
        ;
        AV.prototype.unsubscribeFromSource = function() {
            if (this.unsubSrc) {
                this.unsubSrc()
            }
            return this.unsubSrc = void 0
        }
        ;
        AV.prototype.subscribe = function(AX) {
            var AW;
            if (this.ended) {
                AX(b());
                return AO
            } else {
                AK(AX);
                AW = {
                    sink: AX
                };
                this.subscriptions.push(AW);
                if (this.subscriptions.length === 1) {
                    this.unsubSrc = this._subscribe(this.handleEvent);
                    AK(this.unsubSrc)
                }
                return (function(AY) {
                    return function() {
                        AY.removeSub(AW);
                        if (!AY.hasSubscribers()) {
                            return AY.unsubscribeFromSource()
                        }
                    }
                })(this)
            }
        }
        ;
        return AV
    })();
    W = (function(AV) {
        C(AW, AV);
        function AW(AZ, AX, AY) {
            this.property = AZ;
            this.subscribe = AD(this.subscribe, this);
            AW.__super__.constructor.call(this, AX, AY);
            this.current = K;
            this.currentValueRootId = void 0;
            this.propertyEnded = false
        }
        AW.prototype.push = function(AX) {
            if (AX.isEnd()) {
                this.propertyEnded = true
            }
            if (AX.hasValue()) {
                this.current = new d(AX);
                this.currentValueRootId = AG.currentEventId()
            }
            return AW.__super__.push.call(this, AX)
        }
        ;
        AW.prototype.maybeSubSource = function(AY, AX) {
            if (AX === U.noMore) {
                return AO
            } else {
                if (this.propertyEnded) {
                    AY(b());
                    return AO
                } else {
                    return Z.prototype.subscribe.call(this, AY)
                }
            }
        }
        ;
        AW.prototype.subscribe = function(AZ) {
            var Ab, AY, AX, Aa;
            AY = false;
            AX = U.more;
            if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {
                Ab = AG.currentEventId();
                Aa = this.currentValueRootId;
                if (!this.propertyEnded && Aa && Ab && Ab !== Aa) {
                    AG.whenDoneWith(this.property, (function(Ac) {
                        return function() {
                            if (Ac.currentValueRootId === Aa) {
                                return AZ(E(Ac.current.get().value()))
                            }
                        }
                    })(this));
                    return this.maybeSubSource(AZ, AX)
                } else {
                    AG.inTransaction(void 0, this, (function() {
                        return AX = AZ(E(this.current.get().value()))
                    }), []);
                    return this.maybeSubSource(AZ, AX)
                }
            } else {
                return this.maybeSubSource(AZ, AX)
            }
        }
        ;
        return AW
    })(Z);
    P = (function(AV) {
        C(AW, AV);
        function AW() {
            this.guardedSink = AD(this.guardedSink, this);
            this.subscribeAll = AD(this.subscribeAll, this);
            this.unsubAll = AD(this.unsubAll, this);
            this.sink = void 0;
            this.subscriptions = [];
            this.ended = false;
            AW.__super__.constructor.call(this, H(U, "Bus"), this.subscribeAll)
        }
        AW.prototype.unsubAll = function() {
            var AZ, Aa, AY, AX;
            AX = this.subscriptions;
            for (Aa = 0,
            AY = AX.length; Aa < AY; Aa++) {
                AZ = AX[Aa];
                if (typeof AZ.unsub === "function") {
                    AZ.unsub()
                }
            }
            return void 0
        }
        ;
        AW.prototype.subscribeAll = function(AZ) {
            var Aa, Ab, AY, AX;
            this.sink = AZ;
            AX = y(this.subscriptions);
            for (Ab = 0,
            AY = AX.length; Ab < AY; Ab++) {
                Aa = AX[Ab];
                this.subscribeInput(Aa)
            }
            return this.unsubAll
        }
        ;
        AW.prototype.guardedSink = function(AX) {
            return (function(AY) {
                return function(AZ) {
                    if (AZ.isEnd()) {
                        AY.unsubscribeInput(AX);
                        return U.noMore
                    } else {
                        return AY.sink(AZ)
                    }
                }
            })(this)
        }
        ;
        AW.prototype.subscribeInput = function(AX) {
            return AX.unsub = AX.input.dispatcher.subscribe(this.guardedSink(AX.input))
        }
        ;
        AW.prototype.unsubscribeInput = function(AZ) {
            var Aa, Ab, Ac, AY, AX;
            AX = this.subscriptions;
            for (Aa = Ac = 0,
            AY = AX.length; Ac < AY; Aa = ++Ac) {
                Ab = AX[Aa];
                if (Ab.input === AZ) {
                    if (typeof Ab.unsub === "function") {
                        Ab.unsub()
                    }
                    this.subscriptions.splice(Aa, 1);
                    return
                }
            }
        }
        ;
        AW.prototype.plug = function(AX) {
            var AY;
            S(AX);
            if (this.ended) {
                return
            }
            AY = {
                input: AX
            };
            this.subscriptions.push(AY);
            if ((this.sink != null) ) {
                this.subscribeInput(AY)
            }
            return (function(AZ) {
                return function() {
                    return AZ.unsubscribeInput(AX)
                }
            })(this)
        }
        ;
        AW.prototype.end = function() {
            this.ended = true;
            this.unsubAll();
            return typeof this.sink === "function" ? this.sink(b()) : void 0
        }
        ;
        AW.prototype.push = function(AX) {
            return typeof this.sink === "function" ? this.sink(m(AX)) : void 0
        }
        ;
        AW.prototype.error = function(AX) {
            return typeof this.sink === "function" ? this.sink(new AC(AX)) : void 0
        }
        ;
        return AW
    })(M);
    AL = (function() {
        function AV(AY, AX, AW) {
            this.obs = AY;
            this.sync = AX;
            this.lazy = AW != null ? AW : false;
            this.queue = []
        }
        AV.prototype.subscribe = function(AW) {
            return this.obs.dispatcher.subscribe(AW)
        }
        ;
        AV.prototype.toString = function() {
            return this.obs.toString()
        }
        ;
        AV.prototype.markEnded = function() {
            return this.ended = true
        }
        ;
        AV.prototype.consume = function() {
            if (this.lazy) {
                return {
                    value: h.always(this.queue[0])
                }
            } else {
                return this.queue[0]
            }
        }
        ;
        AV.prototype.push = function(AW) {
            return this.queue = [AW]
        }
        ;
        AV.prototype.mayHave = function() {
            return true
        }
        ;
        AV.prototype.hasAtLeast = function() {
            return this.queue.length
        }
        ;
        AV.prototype.flatten = true;
        return AV
    })();
    i = (function(AV) {
        C(AW, AV);
        function AW() {
            return AW.__super__.constructor.apply(this, arguments)
        }
        AW.prototype.consume = function() {
            return this.queue.shift()
        }
        ;
        AW.prototype.push = function(AX) {
            return this.queue.push(AX)
        }
        ;
        AW.prototype.mayHave = function(AX) {
            return !this.ended || this.queue.length >= AX
        }
        ;
        AW.prototype.hasAtLeast = function(AX) {
            return this.queue.length >= AX
        }
        ;
        AW.prototype.flatten = false;
        return AW
    })(AL);
    AJ = (function(AV) {
        C(AW, AV);
        function AW(AX) {
            AW.__super__.constructor.call(this, AX, true)
        }
        AW.prototype.consume = function() {
            var AX;
            AX = this.queue;
            this.queue = [];
            return {
                value: function() {
                    return AX
                }
            }
        }
        ;
        AW.prototype.push = function(AX) {
            return this.queue.push(AX.value())
        }
        ;
        AW.prototype.hasAtLeast = function() {
            return true
        }
        ;
        return AW
    })(AL);
    AL.isTrigger = function(AV) {
        if (AV instanceof AL) {
            return AV.sync
        } else {
            return AV instanceof M
        }
    }
    ;
    AL.fromObservable = function(AV) {
        if (AV instanceof AL) {
            return AV
        } else {
            if (AV instanceof AH) {
                return new AL(AV,false)
            } else {
                return new i(AV,true)
            }
        }
    }
    ;
    H = function() {
        var AV, AW, AX;
        AW = arguments[0],
        AX = arguments[1],
        AV = 3 <= arguments.length ? F.call(arguments, 2) : [];
        if ((AW || AX)instanceof X) {
            return AW || AX
        } else {
            return new X(AW,AX,AV)
        }
    }
    ;
    B = function(AV) {
        if (A(AV)) {
            return h.flatMap(B, AV)
        } else {
            if (AA(AV)) {
                return [AV]
            } else {
                if (AV instanceof AL) {
                    return [AV.obs]
                } else {
                    return []
                }
            }
        }
    }
    ;
    X = (function() {
        function AV(AX, AY, AW) {
            this.context = AX;
            this.method = AY;
            this.args = AW;
            this.cached = void 0
        }
        AV.prototype.deps = function() {
            return this.cached || (this.cached = B([this.context].concat(this.args)))
        }
        ;
        AV.prototype.apply = function(AW) {
            AW.desc = this;
            return AW
        }
        ;
        AV.prototype.toString = function() {
            return h.toString(this.context) + "." + h.toString(this.method) + "(" + h.map(h.toString, this.args) + ")"
        }
        ;
        return AV
    })();
    Y = function() {
        var AW, AX, AV;
        AW = 2 <= arguments.length ? F.call(arguments, 0, AV = arguments.length - 1) : (AV = 0,
        []),
        AX = arguments[AV++];
        return H.apply(null, AW).apply(AX)
    }
    ;
    U.when = function() {
        var Aj, Ah, Ac, Ab, Ai, AZ, Af, Ae, Ad, AY, An, Ag, AV, Ak, Al, AX, AW, Am, Ao, Aa;
        if (arguments.length === 0) {
            return U.never()
        }
        Ai = arguments.length;
        Al = "when: expecting arguments in the form (Observable+,function)+";
        J(Al, Ai % 2 === 0);
        AV = [];
        Ad = [];
        Ah = 0;
        AY = [];
        while (Ah < Ai) {
            AY[Ah] = arguments[Ah];
            AY[Ah + 1] = arguments[Ah + 1];
            Ae = h.toArray(arguments[Ah]);
            Aj = z(arguments[Ah + 1]);
            Af = {
                f: Aj,
                ixs: []
            };
            Ak = false;
            for (AX = 0,
            Am = Ae.length; AX < Am; AX++) {
                Ag = Ae[AX];
                Ac = h.indexOf(AV, Ag);
                if (!Ak) {
                    Ak = AL.isTrigger(Ag)
                }
                if (Ac < 0) {
                    AV.push(Ag);
                    Ac = AV.length - 1
                }
                Aa = Af.ixs;
                for (AW = 0,
                Ao = Aa.length; AW < Ao; AW++) {
                    Ab = Aa[AW];
                    if (Ab.index === Ac) {
                        Ab.count++
                    }
                }
                Af.ixs.push({
                    index: Ac,
                    count: 1
                })
            }
            J("At least one EventStream required", Ak || (!Ae.length));
            if (Ae.length > 0) {
                Ad.push(Af)
            }
            Ah = Ah + 2
        }
        if (!AV.length) {
            return U.never()
        }
        AV = h.map(AL.fromObservable, AV);
        AZ = (h.any(AV, function(Ap) {
            return Ap.flatten
        })) && (AF(h.map((function(Ap) {
            return Ap.obs
        }), AV)));
        return An = new M(H.apply(null, [U, "when"].concat(F.call(AY))),function(Aw) {
            var Av, Au, Ap, Ar, At, Aq, As;
            As = [];
            Ap = false;
            Ar = function(Az) {
                var Ay, Ax, A0;
                A0 = Az.ixs;
                for (Ay = 0,
                Ax = A0.length; Ay < Ax; Ay++) {
                    Ah = A0[Ay];
                    if (!AV[Ah.index].hasAtLeast(Ah.count)) {
                        return false
                    }
                }
                return true
            }
            ;
            Au = function(Ax) {
                return !Ax.sync || Ax.ended
            }
            ;
            Av = function(Az) {
                var Ay, Ax, A0;
                A0 = Az.ixs;
                for (Ay = 0,
                Ax = A0.length; Ay < Ax; Ay++) {
                    Ah = A0[Ay];
                    if (!AV[Ah.index].mayHave(Ah.count)) {
                        return true
                    }
                }
            }
            ;
            At = function(Ax) {
                return !Ax.source.flatten
            }
            ;
            Aq = function(Ax) {
                return function(Az) {
                    var Ay, A1, A0;
                    A1 = function() {
                        return AG.whenDoneWith(An, Ay)
                    }
                    ;
                    A0 = function() {
                        var A4, A7, A6, A3, A5, A2;
                        if (As.length > 0) {
                            A6 = U.more;
                            A3 = As.pop();
                            for (A5 = 0,
                            A2 = Ad.length; A5 < A2; A5++) {
                                A7 = Ad[A5];
                                if (Ar(A7)) {
                                    A4 = (function() {
                                        var A9, BB, BA, A8;
                                        BA = A7.ixs;
                                        A8 = [];
                                        for (A9 = 0,
                                        BB = BA.length; A9 < BB; A9++) {
                                            Ah = BA[A9];
                                            A8.push(AV[Ah.index].consume())
                                        }
                                        return A8
                                    })();
                                    A6 = Aw(A3.e.apply(function() {
                                        var A9, A8;
                                        A8 = (function() {
                                            var BB, BC, BA;
                                            BA = [];
                                            for (BB = 0,
                                            BC = A4.length; BB < BC; BB++) {
                                                A9 = A4[BB];
                                                BA.push(A9.value())
                                            }
                                            return BA
                                        })();
                                        return A7.f.apply(A7, A8)
                                    }));
                                    if (As.length) {
                                        As = h.filter(At, As)
                                    }
                                    if (A6 === U.noMore) {
                                        return A6
                                    } else {
                                        return A0()
                                    }
                                }
                            }
                        } else {
                            return U.more
                        }
                    }
                    ;
                    Ay = function() {
                        var A2;
                        A2 = A0();
                        if (Ap) {
                            Ap = false;
                            if (h.all(AV, Au) || h.all(Ad, Av)) {
                                A2 = U.noMore;
                                Aw(b())
                            }
                        }
                        if (A2 === U.noMore) {
                            Az()
                        }
                        return A2
                    }
                    ;
                    return Ax.subscribe(function(A3) {
                        var A2;
                        if (A3.isEnd()) {
                            Ap = true;
                            Ax.markEnded();
                            A1()
                        } else {
                            if (A3.isError()) {
                                A2 = Aw(A3)
                            } else {
                                Ax.push(A3);
                                if (Ax.sync) {
                                    As.push({
                                        source: Ax,
                                        e: A3
                                    });
                                    if (AZ || AG.hasWaiters()) {
                                        A1()
                                    } else {
                                        Ay()
                                    }
                                }
                            }
                        }
                        if (A2 === U.noMore) {
                            Az()
                        }
                        return A2 || U.more
                    })
                }
            }
            ;
            return l.apply(null, (function() {
                var Az, Ax, Ay;
                Ay = [];
                for (Az = 0,
                Ax = AV.length; Az < Ax; Az++) {
                    Ag = AV[Az];
                    Ay.push(Aq(Ag))
                }
                return Ay
            })())
        }
        )
    }
    ;
    AF = function(AX, AW) {
        var AV;
        if (AW == null) {
            AW = []
        }
        AV = function(AZ) {
            var AY;
            if (h.contains(AW, AZ)) {
                return true
            } else {
                AY = AZ.internalDeps();
                if (AY.length) {
                    AW.push(AZ);
                    return h.any(AY, AV)
                } else {
                    AW.push(AZ);
                    return false
                }
            }
        }
        ;
        return h.any(AX, AV)
    }
    ;
    U.update = function() {
        var AX, AW, AV, AY;
        AW = arguments[0],
        AY = 2 <= arguments.length ? F.call(arguments, 1) : [];
        AV = function(AZ) {
            return function() {
                var Aa;
                Aa = 1 <= arguments.length ? F.call(arguments, 0) : [];
                return function(Ab) {
                    return AZ.apply(null, [Ab].concat(Aa))
                }
            }
        }
        ;
        AX = AY.length - 1;
        while (AX > 0) {
            if (!(AY[AX]instanceof Function)) {
                AY[AX] = (function(AZ) {
                    return function() {
                        return AZ
                    }
                })(AY[AX])
            }
            AY[AX] = AV(AY[AX]);
            AX = AX - 2
        }
        return Y.apply(null, [U, "update", AW].concat(F.call(AY), [U.when.apply(U, AY).scan(AW, (function(AZ, Aa) {
            return Aa(AZ)
        }))]))
    }
    ;
    l = function() {
        var AV;
        AV = 1 <= arguments.length ? F.call(arguments, 0) : [];
        return new AN(AV).unsubscribe
    }
    ;
    AN = (function() {
        function AV(AX) {
            var AY, AZ, AW;
            if (AX == null) {
                AX = []
            }
            this.unsubscribe = AD(this.unsubscribe, this);
            this.unsubscribed = false;
            this.subscriptions = [];
            this.starting = [];
            for (AZ = 0,
            AW = AX.length; AZ < AW; AZ++) {
                AY = AX[AZ];
                this.add(AY)
            }
        }
        AV.prototype.add = function(AY) {
            var AZ, AX, AW;
            if (this.unsubscribed) {
                return
            }
            AZ = false;
            AX = AO;
            this.starting.push(AY);
            AW = (function(Aa) {
                return function() {
                    if (Aa.unsubscribed) {
                        return
                    }
                    AZ = true;
                    Aa.remove(AX);
                    return h.remove(AY, Aa.starting)
                }
            })(this);
            AX = AY(this.unsubscribe, AW);
            if (!(this.unsubscribed || AZ)) {
                this.subscriptions.push(AX)
            }
            h.remove(AY, this.starting);
            return AX
        }
        ;
        AV.prototype.remove = function(AW) {
            if (this.unsubscribed) {
                return
            }
            if ((h.remove(AW, this.subscriptions)) !== void 0) {
                return AW()
            }
        }
        ;
        AV.prototype.unsubscribe = function() {
            var AY, AZ, AX, AW;
            if (this.unsubscribed) {
                return
            }
            this.unsubscribed = true;
            AW = this.subscriptions;
            for (AZ = 0,
            AX = AW.length; AZ < AX; AZ++) {
                AY = AW[AZ];
                AY()
            }
            this.subscriptions = [];
            return this.starting = []
        }
        ;
        AV.prototype.count = function() {
            if (this.unsubscribed) {
                return 0
            }
            return this.subscriptions.length + this.starting.length
        }
        ;
        AV.prototype.empty = function() {
            return this.count() === 0
        }
        ;
        return AV
    })();
    U.CompositeUnsubscribe = AN;
    d = (function() {
        function AV(AW) {
            this.value = AW
        }
        AV.prototype.getOrElse = function() {
            return this.value
        }
        ;
        AV.prototype.get = function() {
            return this.value
        }
        ;
        AV.prototype.filter = function(AW) {
            if (AW(this.value)) {
                return new AV(this.value)
            } else {
                return K
            }
        }
        ;
        AV.prototype.map = function(AW) {
            return new AV(AW(this.value))
        }
        ;
        AV.prototype.forEach = function(AW) {
            return AW(this.value)
        }
        ;
        AV.prototype.isDefined = true;
        AV.prototype.toArray = function() {
            return [this.value]
        }
        ;
        AV.prototype.inspect = function() {
            return "Some(" + this.value + ")"
        }
        ;
        AV.prototype.toString = function() {
            return this.inspect()
        }
        ;
        return AV
    })();
    K = {
        getOrElse: function(AV) {
            return AV
        },
        filter: function() {
            return K
        },
        map: function() {
            return K
        },
        forEach: function() {},
        isDefined: false,
        toArray: function() {
            return []
        },
        inspect: function() {
            return "None"
        },
        toString: function() {
            return this.inspect()
        }
    };
    AG = (function() {
        var Aa, Ah, AW, AX, Ae, Ai, Af, Ag, Ad, AV, AY, AZ, Ab, Ac;
        AV = void 0;
        AY = [];
        AZ = {};
        Ah = [];
        AW = 0;
        Aa = function(Aj) {
            if (AV) {
                return Ah.push(Aj)
            } else {
                return Aj()
            }
        }
        ;
        Ab = function(Al, Aj) {
            var Ak;
            if (AV) {
                Ak = AZ[Al.id];
                if (Ak == null) {
                    Ak = AZ[Al.id] = [Aj];
                    return AY.push(Al)
                } else {
                    return Ak.push(Aj)
                }
            } else {
                return Aj()
            }
        }
        ;
        Ae = function() {
            while (AY.length > 0) {
                Af(0)
            }
            return void 0
        }
        ;
        Af = function(Al) {
            var An, Ap, Ak, Ao, Am, Aj;
            Ap = AY[Al];
            Ak = Ap.id;
            Ao = AZ[Ak];
            AY.splice(Al, 1);
            delete AZ[Ak];
            Ai(Ap);
            for (Am = 0,
            Aj = Ao.length; Am < Aj; Am++) {
                An = Ao[Am];
                An()
            }
            return void 0
        }
        ;
        Ai = function(Ao) {
            var Am, An, Ak, Al, Aj;
            An = Ao.internalDeps();
            for (Al = 0,
            Aj = An.length; Al < Aj; Al++) {
                Am = An[Al];
                Ai(Am);
                if (AZ[Am.id]) {
                    Ak = h.indexOf(AY, Am);
                    Af(Ak)
                }
            }
            return void 0
        }
        ;
        Ad = function(Am, Al, An, Ak) {
            var Ao, Aj;
            if (AV) {
                return An.apply(Al, Ak)
            } else {
                AV = Am;
                try {
                    Aj = An.apply(Al, Ak);
                    Ae()
                } finally {
                    AV = void 0;
                    while (AW < Ah.length) {
                        Ao = Ah[AW];
                        AW++;
                        Ao()
                    }
                    AW = 0;
                    Ah = []
                }
                return Aj
            }
        }
        ;
        AX = function() {
            if (AV) {
                return AV.id
            } else {
                return void 0
            }
        }
        ;
        Ac = function(Ao, An) {
            var Am, Aj, Al, Ak;
            Ak = false;
            Aj = false;
            Am = function() {
                return Aj = true
            }
            ;
            Al = function() {
                Ak = true;
                return Am()
            }
            ;
            Am = Ao.dispatcher.subscribe(function(Ap) {
                return Aa(function() {
                    var Aq;
                    if (!Ak) {
                        Aq = An(Ap);
                        if (Aq === U.noMore) {
                            return Al()
                        }
                    }
                })
            });
            if (Aj) {
                Am()
            }
            return Al
        }
        ;
        Ag = function() {
            return AY.length > 0
        }
        ;
        return {
            whenDoneWith: Ab,
            hasWaiters: Ag,
            inTransaction: Ad,
            currentEventId: AX,
            wrappedSubscribe: Ac,
            afterTransaction: Aa
        }
    })();
    U.EventStream = M;
    U.Property = AH;
    U.Observable = Q;
    U.Bus = P;
    U.Initial = AE;
    U.Next = AB;
    U.End = c;
    U.Error = AC;
    AO = function() {}
    ;
    AS = function(AW, AV) {
        return AV
    }
    ;
    j = function(AV, AW) {
        return AV
    }
    ;
    E = function(AV) {
        return new AE(AV,true)
    }
    ;
    m = function(AV) {
        return new AB(AV,true)
    }
    ;
    b = function() {
        return new c()
    }
    ;
    D = function(AV) {
        if (AV instanceof a) {
            return AV
        } else {
            return m(AV)
        }
    }
    ;
    y = function(AV) {
        return AV.slice(0)
    }
    ;
    J = function(AV, AW) {
        if (!AW) {
            throw new f(AV)
        }
    }
    ;
    v = function(AV) {
        if (!(AV instanceof M)) {
            throw new f("not an EventStream : " + AV)
        }
    }
    ;
    S = function(AV) {
        if (!(AV instanceof Q)) {
            throw new f("not an Observable : " + AV)
        }
    }
    ;
    AK = function(AV) {
        return J("not a function : " + AV, AI(AV))
    }
    ;
    AI = function(AV) {
        return typeof AV === "function"
    }
    ;
    A = function(AV) {
        return AV instanceof Array
    }
    ;
    AA = function(AV) {
        return AV instanceof Q
    }
    ;
    p = function(AV) {
        if (!A(AV)) {
            throw new f("not an array : " + AV)
        }
    }
    ;
    x = function(AV) {
        return J("no arguments supported", AV.length === 0)
    }
    ;
    s = function(AV) {
        if (typeof AV !== "string") {
            throw new f("not a string : " + AV)
        }
    }
    ;
    w = function(AW, AV) {
        return function() {
            var AX;
            AX = 1 <= arguments.length ? F.call(arguments, 0) : [];
            return AW.apply(null, AV.concat(AX))
        }
    }
    ;
    t = function(AV) {
        if (AV.length === 1 && AA(AV[0])) {
            return h.always(AV[0])
        } else {
            return g(AV)
        }
    }
    ;
    g = function(AV) {
        AV = Array.prototype.slice.call(AV);
        return G.apply(null, AV)
    }
    ;
    G = L(function() {
        var AV, AW;
        AW = arguments[0],
        AV = 2 <= arguments.length ? F.call(arguments, 1) : [];
        if (AI(AW)) {
            if (AV.length) {
                return w(AW, AV)
            } else {
                return AW
            }
        } else {
            if (AR(AW)) {
                return n(AW, AV)
            } else {
                return h.always(AW)
            }
        }
    });
    u = function(AW, AV) {
        return G.apply(null, [AW].concat(F.call(AV)))
    }
    ;
    z = function(AV) {
        if (AI(AV)) {
            return AV
        } else {
            return h.always(AV)
        }
    }
    ;
    o = function(AV) {
        if (AA(AV)) {
            return AV
        } else {
            return U.once(AV)
        }
    }
    ;
    AR = function(AV) {
        return (typeof AV === "string") && AV.length > 1 && AV.charAt(0) === "."
    }
    ;
    U.isFieldKey = AR;
    n = function(AX, AV) {
        var AW, AY;
        AY = AX.slice(1).split(".");
        AW = h.map(k(AV), AY);
        return function(Ab) {
            var Aa, AZ;
            for (Aa = 0,
            AZ = AW.length; Aa < AZ; Aa++) {
                AX = AW[Aa];
                Ab = AX(Ab)
            }
            return Ab
        }
    }
    ;
    k = function(AV) {
        return function(AW) {
            return function(AY) {
                var AX;
                if (AY == null) {
                    return void 0
                } else {
                    AX = AY[AW];
                    if (AI(AX)) {
                        return AX.apply(AY, AV)
                    } else {
                        return AX
                    }
                }
            }
        }
    }
    ;
    AQ = function(AV) {
        return AV.slice(1)
    }
    ;
    T = function(AW) {
        var AV;
        if (AI(AW)) {
            return AW
        } else {
            if (AR(AW)) {
                AV = AQ(AW);
                return function(AY, AX) {
                    return AY[AV](AX)
                }
            } else {
                return J("not a function or a field key: " + AW, false)
            }
        }
    }
    ;
    q = function(AV) {
        if (AV instanceof d || AV === K) {
            return AV
        } else {
            return new d(AV)
        }
    }
    ;
    if ((typeof define !== "undefined" && define !== null) && (define.amd != null)) {
        define([], function() {
            return U
        });
        this.Bacon = U
    } else {
        if ((typeof module !== "undefined" && module !== null) && (module.exports != null)) {
            module.exports = U;
            U.Bacon = U
        } else {
            this.Bacon = U
        }
    }
}
).call(this);
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:baconjs', location = '/static/lib/Bacon-AMD.js' */
define("bacon", ["jquery"], function(B) {
    var A = window.Bacon || window.module.exports;
    B.fn.asEventStream = A.$.asEventStream;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:bacon-util', location = '/static/util/bacon.js' */
define("util/bacon", ["aui", "bacon", "jquery", "lodash", "util/events", "util/function", "util/performance", "exports"], function(J, A, E, L, M, I, H, D) {
    D.events = function F(N) {
        return A.fromBinder(function(O) {
            return M.chain().on(N, O).destroy
        })
    }
    ;
    D.keyboardEvents = function K(N, O) {
        var P = A.fromBinder(function(R) {
            var Q = [];
            Q.push(M.chain().on("stash.keyboard.shortcuts." + N, function(T) {
                var S = this.execute ? this : J.whenIType(T);
                S.execute(R);
                if (O) {
                    Q.push(S.unbind)
                }
            }).destroy);
            return L.partial(I.applyAll, Q)
        });
        if (!O) {
            P.onValue(jQuery.noop)
        }
        return P
    }
    ;
    D.split = function G(O, N) {
        return A.fromBinder(function(S) {
            var P = [];
            var Q;
            var R = [];
            R.push(O.onValue(function(T) {
                var U = N(T);
                if (Q && U !== Q) {
                    S(P);
                    P = []
                }
                Q = U;
                P.push(T)
            }));
            R.push(O.onEnd(function() {
                if (P.length > 0) {
                    S(P)
                }
                S(new A.End())
            }));
            return L.partial(I.applyAll, R)
        })
    }
    ;
    D.toArray = function C(O) {
        var N = [];
        O.onValue(function(P) {
            N.push(P)
        });
        return N
    }
    ;
    D.getWindowScrollProperty = L.once(function() {
        var N = E(window);
        function P() {
            return {
                left: N.scrollLeft(),
                top: N.scrollTop()
            }
        }
        var O = A.fromBinder(function(S) {
            var R = H.enqueueCapped(requestAnimationFrame, S);
            var Q = L.debounce(R, 20);
            N.on("scroll", R).on("scroll", Q);
            return function() {
                N.off("scroll", R).off("scroll", Q)
            }
        }).map(P).skipDuplicates(function(R, Q) {
            return R.left === Q.left && R.top === Q.top
        }).toProperty(P());
        O.onValue(E.noop);
        return O
    });
    D.getWindowSizeProperty = L.once(function() {
        var O = E(window);
        var N = A.fromBinder(function(Q) {
            var P = M.chain().on("window.resize", function(R, S) {
                Q(new A.Next({
                    width: R,
                    height: S
                }))
            });
            return function() {
                P.destroy()
            }
        }).toProperty({
            width: O.width(),
            height: O.height()
        });
        N.onValue(E.noop);
        return N
    });
    D.takeBetween = function B(T, V) {
        var N = V.start;
        var Q = V.end;
        var U = V.startInclusive;
        var S = V.endInclusive;
        var O = V.equals || function(X, W) {
            return X === W
        }
        ;
        if (O(N, Q)) {
            if (U || S) {
                return T.skipWhile(function(W) {
                    return !O(W, N)
                }).take(1)
            }
            return A.never()
        }
        var P, R;
        return T.skipWhile(function(W) {
            if (R || P) {
                return false
            }
            if (O(W, N)) {
                P = true;
                return !U
            }
            if (O(W, Q)) {
                R = true;
                return !S
            }
            return true
        }).takeWhile(function(W) {
            if (O(W, N)) {
                P = true;
                return U
            }
            if (O(W, Q)) {
                R = true;
                return S
            }
            return !(R && P)
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-page-data-plugin:page-data-loader', location = '/static/util/page-data-loader.js' */
var _PageDataPlugin = (function() {
    var B = Object.prototype.hasOwnProperty;
    var F = jQuery;
    var E = {};
    var A = {};
    function D(J, I) {
        for (var K in I) {
            if (B.call(I, K)) {
                var L = A[K] || (A[K] = {});
                var M = L[J] || (L[J] = F.Deferred());
                var H = E[K] || (E[K] = {});
                H[J] = I[K];
                if (M.state() !== "pending") {
                    throw new Error("Attempt to set context " + J + " for plugin key " + K + " multiple times.")
                }
                M.resolve(H[J])
            }
        }
    }
    function C(J, I) {
        var H = Array.prototype.slice.call(arguments, 2);
        var K = A[J] || (A[J] = {});
        var L = K[I] || (K[I] = F.Deferred());
        H.forEach(function(M) {
            L.done(M)
        });
        return L
    }
    function G() {
        F.each(A, function(I, H) {
            F.each(H, function(J, K) {
                K.reject(E[I] ? new Error("Provider " + I + " not included with context " + J) : new Error("Provider " + I + " not included on page."))
            })
        })
    }
    F(document).ready(G);
    return {
        load: D,
        data: E,
        ready: C,
        _domReady: G
    }
}());
;;/* module-key = 'com.atlassian.stash.stash-client-web-fragments-plugin:web-fragment-manager', location = '/static/util/web-fragment-manager.js' */
var WebFragments = (function() {
    var M = Object.prototype.hasOwnProperty;
    var N = {
        item: {},
        section: {},
        panel: {}
    };
    var O = function(S) {
        var R = [];
        for (var Q in S) {
            if (M.call(S, Q)) {
                R.push(Q)
            }
        }
        return R
    };
    function J(V) {
        var T = Array.prototype.slice.call(arguments, 1);
        for (var R = 0, X = T.length; R < X; R++) {
            var U = T[R];
            if (U) {
                for (var Y = O(U), Q = 0, S = Y.length; Q < S; Q++) {
                    var W = Y[Q];
                    V[W] = U[W]
                }
            }
        }
        return V
    }
    var K;
    if (!window._PageDataPlugin || !_PageDataPlugin.ready) {
        K = function(Q) {
            return Q
        }
    } else {
        K = function(Q) {
            _PageDataPlugin.ready(Q.completeModuleKey, Q.location, function(R) {
                if (M.call(R, "serverCondition")) {
                    Q.serverCondition = R.serverCondition
                }
                if (M.call(R, "serverContext")) {
                    Q.serverContext = R.serverContext
                }
            })
        }
    }
    var E = {
        item: function(Q, R) {
            return {
                url: "#example-web-item-url",
                pluginKey: "org.example.plugins",
                moduleKey: "example-web-item",
                completeModuleKey: "org.example.plugins:example-web-item",
                linkText: "Client Web Item: " + Q,
                hasTooltip: true,
                tooltip: "Client Context Items: " + O(R).join(", "),
                hasIcon: false,
                iconUrl: null,
                iconWidth: 0,
                iconHeight: 0,
                styleClass: "plugin-point",
                linkId: null,
                description: null,
                params: {},
                type: "ITEM",
                weight: 1000
            }
        },
        section: function(Q, R) {
            return {
                name: "example-web-section",
                key: "example-web-section",
                location: Q,
                labelText: "Client Web Section: " + Q,
                type: "SECTION",
                params: {},
                weight: 1000
            }
        },
        panel: function(Q, R) {
            return {
                view: '<div class="plugin-point web-panel"><strong>Client Web Panel</strong>: ' + Q + "<br /><strong>Client Context Items</strong>: " + O(R).join(", ") + "</div>",
                weight: 1000
            }
        }
    };
    function F(Q) {
        return new RegExp("[\\?&]web\\." + Q + "s(=|&|$)").test(window.location.search)
    }
    function H(R, Q) {
        return typeof R === "function" ? R(J({}, Q)) : R
    }
    function B(Q, R, V) {
        var Y, W, T, X;
        var U = {
            type: V.toUpperCase()
        };
        if (M.call(Q, "serverCondition") && !Q.serverCondition) {
            return null
        }
        R = J({}, R, Q.serverContext, Q.params);
        if (M.call(Q, "condition") && !H(Q.condition, R)) {
            return null
        }
        if (Q["context-provider"] && typeof Q["context-provider"] === "function") {
            R = H(Q["context-provider"], R)
        }
        for (Y = O(Q),
        T = 0,
        X = Y.length; T < X; T++) {
            W = Y[T];
            if (!/con(dition|text-provider)|params/.test(W)) {
                U[W] = H(Q[W], R)
            }
        }
        if (Q.params) {
            var S = U.params = {};
            for (Y = O(Q.params),
            T = 0,
            X = Y.length; T < X; T++) {
                W = Y[T];
                S[W] = H(Q.params[W], R)
            }
        }
        return U
    }
    function I(R) {
        var Q = N[R];
        return function(T, W) {
            var Y = Q[T];
            var S = [];
            if (Y && Y.length) {
                for (var V = 0, X = Y.length; V < X; V++) {
                    var U = B(Y[V], W, R);
                    if (U) {
                        S.push(U)
                    }
                }
            }
            if (F(R)) {
                S.push(E[R](T, W))
            }
            return S
        }
    }
    var L = I("panel");
    function A(Q, T) {
        var R = L(Q, T);
        for (var S = 0, U = R.length; S < U; S++) {
            R[S] = R[S].view
        }
        return R
    }
    var D = I("item");
    function G(Q, T) {
        var R = D(Q, T);
        for (var S = 0, U = R.length; S < U; S++) {
            R[S].hasIcon = !!R[S].iconUrl;
            R[S].hasTooltip = !!R[S].tooltip
        }
        return R
    }
    function P(R) {
        var Q = N[R];
        return function(S) {
            if (!S) {
                throw new Error("No descriptor provided")
            }
            if (typeof S.location !== "string") {
                throw new Error("No location provided, or location was not a string.")
            }
            if (typeof S.completeModuleKey !== "string") {
                throw new Error("No completeModuleKey provided, or completeModuleKey was not a string.")
            }
            K(S);
            if (!Q[S.location]) {
                Q[S.location] = []
            }
            Q[S.location].push(S);
            Q[S.location].sort(C)
        }
    }
    function C(R, Q) {
        return (R.weight >= 0 ? R.weight : 1000) - (Q.weight >= 0 ? Q.weight : 1000)
    }
    return {
        getWebItems: I("item"),
        getWebSections: I("section"),
        getWebPanels: A,
        getWebFragmentDescriptors: function(Q, S) {
            var R = N[S];
            var T = R && R[Q];
            return T && T.slice()
        },
        addWebItemDescriptor: P("item"),
        addWebSectionDescriptor: P("section"),
        addWebPanelDescriptor: P("panel"),
        getWebFragments: function(U, T, R) {
            if (typeof T !== "string") {
                R = T;
                T = U
            }
            var Q = this.getWebItems(U, R);
            var V = this.getWebSections(T, R);
            var S = Q.concat(V);
            S.sort(C);
            return S
        },
        _getValue: H,
        _formatI18n: function(Q, R, T) {
            var S = (Q === R ? T : Q) || R || T || "";
            return function(W) {
                var U = [];
                var Y = O(W);
                Y.sort();
                for (var V = 0, X = Y.length; V < X; V++) {
                    U.push(W[Y[V]])
                }
                return AJS.format(S, U)
            }
        }
    }
}());
;;/* module-key = 'com.atlassian.stash.stash-client-web-fragments-plugin:comment-create-task', location = '/web-fragment-placeholder.config' */
WebFragments.addWebItemDescriptor({
    'pluginKey': 'com.atlassian.stash.stash-client-web-fragments-plugin',
    'key': 'comment-create-task',
    'moduleKey': 'comment-create-task',
    'completeModuleKey': 'com.atlassian.stash.stash-client-web-fragments-plugin:comment-create-task',
    'weight': 40.0,
    'condition': function(ctx) {
        return WebFragments._getValue((require('feature/tasks/taskable-comment').isPullRequest), ctx);
    },
    'params': {},
    'styleClass': WebFragments._formatI18n(null, null, 'task-create'),
    'location': 'stash.comments.actions',
    'url': WebFragments._formatI18n(null, null, '#'),
    'linkText': WebFragments._formatI18n("Create task", 'stash.web.tasks.createTask', '')
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-resources', location = '/static/feature/comments/likes/comment-likes.soy' */
// This file was automatically generated from comment-likes.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.plugin.comment.likes.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.plugin == 'undefined') {
    stash.plugin = {};
}
if (typeof stash.plugin.comment == 'undefined') {
    stash.plugin.comment = {};
}
if (typeof stash.plugin.comment.likes == 'undefined') {
    stash.plugin.comment.likes = {};
}

stash.plugin.comment.likes.likeButton = function(opt_data, opt_ignored) {
    return '' + stash.buttons.linkButton({
        content: '' + ((opt_data.userHasLiked) ? soy.$$escapeHtml("Unlike") : soy.$$escapeHtml("Like")),
        extraClasses: 'comment-likes-button'
    });
}
;
if (goog.DEBUG) {
    stash.plugin.comment.likes.likeButton.soyTemplateName = 'stash.plugin.comment.likes.likeButton';
}

stash.plugin.comment.likes.likeInfo = function(opt_data, opt_ignored) {
    return '<span class="comment-likes-info">' + aui.icons.icon({
        icon: 'like-small',
        useIconFont: true
    }) + ((opt_data.userHasLiked) ? (opt_data.likerCount == 1) ? soy.$$escapeHtml("You like this") : (opt_data.likerCount == 2) ? soy.$$escapeHtml(soydata.VERY_UNSAFE.ordainSanitizedHtml(AJS.format("You and \x3cspan class\x3d\x22comment-liker\x22 title\x3d\x22{0}\x22\x3e{0}\x3c/span\x3e like this", typeof (opt_data.otherLiker.displayName || opt_data.otherLiker.name) === 'number' ? opt_data.otherLiker.displayName || opt_data.otherLiker.name : soy.$$escapeHtml(opt_data.otherLiker.displayName || opt_data.otherLiker.name)))) : soy.$$filterNoAutoescape(AJS.format("You and {1}{0} others{2} like this", opt_data.likerCount - 1, '<button class="stash-link-button">', '</button>')) : (opt_data.likerCount == 1) ? soy.$$escapeHtml(soydata.VERY_UNSAFE.ordainSanitizedHtml(AJS.format("\x3cspan class\x3d\x22comment-liker\x22 title\x3d\x22{0}\x22\x3e{0}\x3c/span\x3e likes this", typeof (opt_data.otherLiker.displayName || opt_data.otherLiker.name) === 'number' ? opt_data.otherLiker.displayName || opt_data.otherLiker.name : soy.$$escapeHtml(opt_data.otherLiker.displayName || opt_data.otherLiker.name)))) : soy.$$filterNoAutoescape(AJS.format("{1}{0} people{2} like this", opt_data.likerCount, '<button class="stash-link-button">', '</button>'))) + '</span>';
}
;
if (goog.DEBUG) {
    stash.plugin.comment.likes.likeInfo.soyTemplateName = 'stash.plugin.comment.likes.likeInfo';
}

stash.plugin.comment.likes.dialog = function(opt_data, opt_ignored) {
    var output = '<div class="comment-likes-dialog"><h5 class="title">' + soy.$$escapeHtml("People who like this") + '</h5><ul class="user-list">';
    var likerList38 = opt_data.otherLikers;
    var likerListLen38 = likerList38.length;
    for (var likerIndex38 = 0; likerIndex38 < likerListLen38; likerIndex38++) {
        var likerData38 = likerList38[likerIndex38];
        output += '<li>' + stash.widget.avatar({
            size: 'small',
            person: likerData38
        }) + stash.widget.userLink({
            user: likerData38
        }) + '</li>';
    }
    output += '</ul></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.plugin.comment.likes.dialog.soyTemplateName = 'stash.plugin.comment.likes.dialog';
}
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-resources', location = '/static/feature/comments/likes/analytics.js' */
define("feature/comments/likes/analytics", ["stash/api/util/events", "stash/api/util/state", "util/analytics", "util/function", "exports"], function(i, g, e, f, c) {
    function h() {
        i.on("stash.feature.comments.likes.like", b.bind(null, "like"));
        i.on("stash.feature.comments.likes.unlike", b.bind(null, "unlike"));
        i.on("stash.feature.comments.likes.actions.like", b.bind(null, "actions.like"))
    }
    var d = "comment.";
    function b(k, j) {
        e.add(d + k, a(j))
    }
    function a(l) {
        var n = g.getPullRequest();
        var m = g.getRepository();
        var o = {
            "comment.id": l.commentId,
            "repository.id": m.id,
            totalLikes: l.likerCount
        };
        if (n) {
            var k = g.getCurrentUser().slug;
            var j = n.reviewers.map(f.dot("user.slug"));
            o.isAuthor = n.author.user.slug === k;
            o.isReviewer = j.indexOf(k) !== -1;
            o["pullRequest.id"] = n.id
        }
        return o
    }
    c.init = h
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-resources', location = '/static/feature/comments/likes/analytics-init.js' */
jQuery(document).ready(function() {
    require("feature/comments/likes/analytics").init()
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-resources', location = '/static/feature/comments/likes/controller.js' */
define("feature/comments/likes/controller", ["aui", "jquery", "lib/jsuri", "lodash", "stash/api/util/events", "stash/api/util/navbuilder", "stash/api/util/server", "stash/api/util/state"], function(k, f, c, l, m, h, d, j) {
    function g(o) {
        l.bindAll(this);
        this.options = o;
        this.$buttonEl = null;
        this.$infoPanel = null;
        this.likes = o.likes;
        this.dialog = null;
        this.$infoPanel = o.$infoPlaceholder.parent();
        this.$infoPanel.on("click", "button", this.onInfoClicked);
        this.updateLikeInfo();
        if (this.likes.canLike) {
            this.$buttonEl = this.$infoPanel.parentsUntil(".content").find(".comment-likes-button");
            this.$buttonEl.on("click", this.onLikeClick);
            this.likeIfDeepLinked()
        } else {
            if (this.likes.likerCount === 0) {
                this.$infoPanel.remove()
            }
        }
    }
    g.prototype.updateLikeButton = function() {
        var o = this.likes.userHasLiked ? "Unlike" : "Like";
        this.$buttonEl.text(o)
    }
    ;
    g.prototype.updateLikeInfo = function() {
        if (this.likes.likerCount === 0) {
            this.$infoPanel.addClass("hidden")
        } else {
            this.$infoPanel.html(stash.plugin.comment.likes.likeInfo(this.likes));
            this.$infoPanel.removeClass("hidden");
            this.dialog = null
        }
    }
    ;
    g.prototype.getLikesURL = function() {
        var o = j.getPullRequest();
        var q = j.getCommit();
        var p = h.rest("comment-likes");
        if (o) {
            p = p.currentPullRequest()
        } else {
            if (q) {
                p = p.project(j.getProject().key).repo(j.getRepository().slug).commit(q.id)
            }
        }
        return p.addPathComponents("comments", this.options.commentId, "likes").build()
    }
    ;
    g.prototype.onInfoClicked = function(p) {
        p.preventDefault();
        var o = this;
        if (!this.dialog) {
            this.dialog = k.InlineDialog(p.target, "likes-info-panel", function(r, q, s) {
                r.html(stash.plugin.comment.likes.dialog(o.likes));
                s()
            }, {
                closeOnTriggerClick: true,
                initCallback: e,
                hideCallback: a
            });
            this.dialog.show()
        }
    }
    ;
    g.prototype.likeIfDeepLinked = function() {
        var o = new c(window.location);
        if (o.getQueryParamValue("action") === "like" && parseInt(o.getQueryParamValue("commentId"), 10) === this.options.commentId && !this.likes.userHasLiked) {
            this.setLike(true);
            this._triggerEvent("actions.like")
        }
    }
    ;
    function n(o) {
        if (this.popup && !this.popup.has(o.target).length) {
            this.hide()
        }
    }
    var b;
    function e() {
        b = n.bind(this);
        f(document).on("mouseup", b)
    }
    function a() {
        f(document).off("mouseup", b);
        b = null
    }
    g.prototype.onLikeClick = function(o) {
        o.preventDefault();
        this.setLike(!this.likes.userHasLiked)
    }
    ;
    g.prototype.setLike = function(o) {
        this._setInteralLikeStatus(o);
        this._syncLike(o)
    }
    ;
    g.prototype._setInteralLikeStatus = function(o) {
        this.likes.userHasLiked = o;
        this.likes.likerCount = o ? this.likes.likerCount + 1 : this.likes.likerCount - 1;
        this.updateLikeButton();
        this.updateLikeInfo()
    }
    ;
    var i = {
        "404": function(t, o, s, r) {
            var p = r && r.errors && r.errors.length && r.errors[0];
            var q = p && p.message;
            return {
                title: "Comment not found",
                message: q,
                shouldReload: true,
                fallbackUrl: undefined
            }
        }
    };
    g.prototype._syncLike = function(o) {
        d.rest({
            type: o ? "POST" : "DELETE",
            url: this.getLikesURL(),
            statusCode: i
        }).done(this._triggerEvent.bind(this, o ? "like" : "unlike")).fail(this._setInteralLikeStatus.bind(this, !o))
    }
    ;
    g.prototype._triggerEvent = function(o) {
        m.trigger("stash.feature.comments.likes." + o, null, l.extend({
            commentId: this.options.commentId
        }, this.likes))
    }
    ;
    return g
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-resources', location = '/static/feature/comments/likes/web-panel.js' */
define("feature/comments/likes/web-panel", ["stash/api/util/state", "feature/comments/comment-async-web-panel", "feature/comments/likes/controller", "exports"], function(e, g, c, b) {
    function d(i) {
        var l = i.comment;
        var k = l.properties && l.properties.likedBy;
        var h = e.getCurrentUser().slug;
        var j = {
            userHasLiked: false,
            otherLiker: null,
            likerCount: 0,
            otherLikers: [],
            canLike: l.author.slug !== h
        };
        if (k) {
            j.userHasLiked = k.total > 0 && k.likers[0].slug === h;
            if (j.userHasLiked) {
                j.otherLiker = k.total > 1 ? k.likers[1] : null
            } else {
                j.otherLiker = k.total > 0 ? k.likers[0] : null
            }
            j.likerCount = k.total;
            j.otherLikers = j.userHasLiked ? k.likers.slice(1) : k.likers
        }
        return j
    }
    function a(h) {
        return d(h).canLike
    }
    function f(h) {
        return g.getWebPanelEl(function(i) {
            new c({
                commentId: h.comment.id,
                likes: d(h),
                $infoPlaceholder: i
            })
        })
    }
    b.contextProvider = d;
    b.buttonPanelCondition = a;
    b.infoPanel = f
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-button', location = '/web-fragment-placeholder.config' */
WebFragments.addWebPanelDescriptor({
    'pluginKey': 'com.atlassian.stash.stash-comment-likes',
    'key': 'comment-likes-button',
    'moduleKey': 'comment-likes-button',
    'completeModuleKey': 'com.atlassian.stash.stash-comment-likes:comment-likes-button',
    'weight': 110.0,
    'condition': function(ctx) {
        return WebFragments._getValue((require('feature/comments/likes/web-panel').buttonPanelCondition), ctx);
    },
    'context-provider': function(ctx) {
        return WebFragments._getValue((require('feature/comments/likes/web-panel').contextProvider), ctx);
    },
    'params': {},
    'location': 'stash.comments.info',
    'view': function(ctx) {
        return WebFragments._getValue((stash.plugin.comment.likes.likeButton), ctx);
    }
});
;;/* module-key = 'com.atlassian.stash.stash-comment-likes:comment-likes-info', location = '/web-fragment-placeholder.config' */
WebFragments.addWebPanelDescriptor({
    'pluginKey': 'com.atlassian.stash.stash-comment-likes',
    'key': 'comment-likes-info',
    'moduleKey': 'comment-likes-info',
    'completeModuleKey': 'com.atlassian.stash.stash-comment-likes:comment-likes-info',
    'weight': 111.0,
    'params': {},
    'location': 'stash.comments.info',
    'view': function(ctx) {
        return WebFragments._getValue((require('feature/comments/likes/web-panel').infoPanel), ctx);
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-model-resources', location = '/static/feature/tasks/model/task-collection.js' */
define("feature/tasks/model/task-collection", ["backbone-brace", "stash/api/util/events", "stash/api/util/navbuilder", "stash/api/util/state", "feature/tasks/model/task", "feature/tasks/model/task-state"], function(A, H, F, E, G, D) {
    var C = A.Collection.extend({
        model: G,
        initialize: function() {
            this.on("remove", function(J) {
                if (!J.isNew()) {
                    var I = J.toJSON();
                    I.lastState = I.state;
                    I.state = D.DEFAULT;
                    H.trigger("stash.feature.pull-request-tasks.deleted", null, {
                        task: I
                    })
                }
            })
        },
        url: F.rest("tasks").addPathComponents("pull-requests").withParams({
            repositoryId: E.getRepository().id,
            pullRequestId: E.getPullRequest().id,
            start: 0,
            limit: 1000
        }).build()
    });
    var B = new C();
    C.getCollection = function() {
        return B
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-model-resources', location = '/static/feature/tasks/model/task-state.js' */
define("feature/tasks/model/task-state", function() {
    var A = {
        DEFAULT: "NONE",
        OPEN: "OPEN",
        RESOLVED: "RESOLVED",
        DELETED: "DELETED"
    };
    A.Transitions = {};
    A.Transitions[A.DEFAULT] = A.OPEN;
    A.Transitions[A.OPEN] = A.RESOLVED;
    A.Transitions[A.RESOLVED] = A.OPEN;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-model-resources', location = '/static/feature/tasks/model/task.js' */
define("feature/tasks/model/task", ["aui", "backbone", "backbone-brace", "lodash", "stash/api/util/events", "stash/api/util/navbuilder", "model/stash-user", "feature/tasks/model/task-state"], function(J, K, I, L, H, A, G, C) {
    var E = {
        COMMENT: "COMMENT"
    };
    var D = A.rest().addPathComponents("tasks");
    function B(M) {
        return M && "stash.feature.pull-request-tasks." + M
    }
    var F = I.Model.extend({
        namedAttributes: {
            id: "number",
            anchor: null,
            state: "string",
            author: G,
            createdDate: "number",
            text: "string",
            html: "string",
            properties: null,
            permittedOperations: null,
            lastState: "string",
            pendingSync: "boolean",
            pullRequestId: "number",
            repositoryId: "number"
        },
        defaults: {
            state: C.OPEN,
            text: "",
            pendingSync: false,
            permittedOperations: {}
        },
        url: function() {
            var M = D;
            if (!this.isNew()) {
                M = M.addPathComponents(this.getId())
            }
            return M.build()
        },
        initialize: function() {
            if (this.getState() === C.OPEN && this.isNew()) {
                this._triggerTaskEvent(this.eventNameForState(this.getState()))
            }
            this.on("destroy", this._onDestroy);
            this.on("sync", this._triggerTaskEvent.bind(this, B("saved")))
        },
        _onDestroy: function() {
            if (this.isNew()) {
                this.changeState(C.DELETED)
            }
        },
        nextState: function() {
            return C.Transitions[this.getState()]
        },
        eventNameForState: function(M) {
            switch (M) {
            case C.OPEN:
                if (this.isNew()) {
                    return B("created")
                } else {
                    return B("reopened")
                }
                break;
            case C.RESOLVED:
                return B("resolved");
            case C.DELETED:
                return B("deleted");
            case C.DEFAULT:
            default:
                return B("default")
            }
        },
        transitionToNextState: function() {
            return this._updateState(this.nextState())
        },
        changeState: function(M) {
            this.set({
                state: M,
                lastState: this.getState()
            }, {
                local: true
            });
            this._triggerTaskEvent(this.eventNameForState(M))
        },
        _updateState: function(O) {
            var P = this.getState();
            var N = this.eventNameForState(O);
            var M = this;
            this.changeState(O);
            return this.save().done(function() {
                if (M.getState() !== O) {
                    N = M.eventNameForState(M.getState());
                    M._triggerTaskEvent(N)
                }
            }).fail(function() {
                M.set({
                    state: P,
                    lastState: O
                });
                M._triggerTaskEvent(B("failed-transition"))
            })
        },
        updateText: function(P) {
            var N = this;
            var M = this.getText();
            var O = F.sanitiseText(P);
            this.setText(O);
            return (this.save() || K.$.Deferred().reject(this.validationError)).fail(function() {
                if (O !== "") {
                    N.setText(M)
                }
            })
        },
        validate: function(N, M) {
            var O = F.sanitiseText(N.text);
            if (O !== N.text) {
                return "Invalid task text"
            }
            if (N.text === "") {
                return "Please enter some text"
            }
        },
        sync: function(P, O, N) {
            this.setPendingSync(true);
            var M = K.sync(P, O, L.extend(N, {
                statusCode: {
                    "404": function(V, Q, U, T) {
                        var R = T && T.errors && T.errors.length && T.errors[0];
                        var S = R && R.message;
                        if (P !== "create") {
                            S = "Stash could not update this task, it has been deleted."
                        }
                        return {
                            title: "Task not found",
                            message: S,
                            shouldReload: true,
                            fallbackUrl: undefined
                        }
                    }
                }
            }));
            M.always(this.setPendingSync.bind(this, false));
            return M
        },
        _triggerTaskEvent: function(M, N) {
            if (N === this) {
                N = {}
            }
            H.trigger(M, null, L.extend({
                task: this.toJSON()
            }, N))
        }
    }, {
        Anchor: E
    });
    F.sanitiseText = function(M) {
        return M.trim().replace(/\s+/gm, " ")
    }
    ;
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-view-resources', location = '/static/feature/tasks/task-view/task-view.js' */
define("feature/tasks/task-view", ["aui", "backbone", "jquery", "lodash", "util/events", "util/function", "feature/tasks/model/task-state"], function(F, G, B, H, I, E, A) {
    var C = {
        VIEW: "view",
        EDIT: "edit"
    };
    var D = G.View.extend({
        events: {
            "click .task-checkbox": "transitionTaskHandler",
            "click .task-edit": "onTaskEditClick",
            "click .task-save": "onTaskSaveClick",
            "click .task-cancel": "onTaskCancelClick",
            "keydown .task-text": "onTaskKeyDown",
            "click .task-delete": "onTaskDeleteClick",
            "keypress textarea": "onTaskTextareaKeypress"
        },
        defaults: {
            showLink: false,
            mode: C.VIEW
        },
        initialize: function(J) {
            H.bindAll(this, "focusEditor", "_onResize");
            this.listenTo(this.model, "change invalid", this.render);
            this.listenToOnce(this.model, "destroy", this._onResize);
            this.options = H.extend({}, this.defaults, J);
            this.mode = this.options.mode;
            if (this.mode === C.EDIT) {
                this.originalText = this.model.getText()
            }
            this._enableExpandingTextareas()
        },
        template: E.dot("stash.feature.tasks.taskView.task")(window),
        render: function() {
            var J = B(this.template({
                task: this.model.toJSON(),
                mode: this.mode,
                showLink: this.options.showLink,
                error: this.model.validationError
            }));
            this.$el.replaceWith(J);
            this.setElement(J);
            this._enableExpandingTextareas();
            if (this.mode === C.EDIT) {
                H.defer(this.focusEditor)
            }
            H.defer(this._onResize);
            return this
        },
        transitionTaskHandler: function() {
            this.model.transitionToNextState()
        },
        saveTask: function() {
            var J = this;
            var K = this.$(".task-text").val();
            J.switchMode(C.VIEW);
            this.model.updateText(K).fail(function() {
                J.switchMode(C.EDIT)
            })
        },
        switchMode: function(J) {
            this.mode = J;
            if (J === C.EDIT) {
                this.originalText = this.model.getText() || this.originalText
            }
            this.render()
        },
        cancelTaskEdit: function() {
            if (this.model.isNew()) {
                this.model.destroy()
            } else {
                this.model.setText(this.originalText);
                this.model.isValid();
                this.originalText = null;
                this.switchMode(C.VIEW)
            }
        },
        onTaskDeleteClick: function(K) {
            var J = this;
            K.preventDefault();
            if (this.model.isNew()) {
                return
            }
            J.model.changeState(A.DELETED);
            J.model.destroy({
                wait: true,
                error: function() {
                    J.model.changeState(J.model.getLastState())
                }
            })
        },
        focusEditor: function() {
            this.$(".task-text").focus()
        },
        getEditorText: function() {
            return this.$(".task-text").val()
        },
        onTaskKeyDown: function(J) {
            if (J.keyCode === F.keyCode.ESCAPE) {
                J.preventDefault();
                J.stopPropagation();
                this.cancelTaskEdit()
            } else {
                if (J.keyCode === F.keyCode.ENTER) {
                    J.preventDefault();
                    this.saveTask()
                }
            }
        },
        onTaskEditClick: function(J) {
            J.preventDefault();
            if (this.model.isNew()) {
                return
            }
            this.switchMode(C.EDIT)
        },
        onTaskSaveClick: function(J) {
            J.preventDefault();
            this.saveTask()
        },
        onTaskCancelClick: function(J) {
            J.preventDefault();
            this.cancelTaskEdit()
        },
        onTaskTextareaKeypress: H.debounce(function(J) {
            B(J.target).removeClass("task-error")
        }, 300),
        _enableExpandingTextareas: function() {
            if (this.mode === C.EDIT) {
                this.$("textarea.expanding").expandingTextarea().on("input.expanding", this._onResize)
            }
        },
        _onResize: function() {
            I.trigger("stash.webpanel.resize", null, {
                location: "internal.stash.comments.extra",
                el: this.$el.get(0)
            })
        }
    }, {
        Mode: C
    });
    return D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-view-resources', location = '/static/feature/tasks/task-view/task-view.soy' */
// This file was automatically generated from task-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.tasks.taskView.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.tasks == 'undefined') {
    stash.feature.tasks = {};
}
if (typeof stash.feature.tasks.taskView == 'undefined') {
    stash.feature.tasks.taskView = {};
}

stash.feature.tasks.taskView.task = function(opt_data, opt_ignored) {
    var output = '<div class="task task-status-' + soy.$$escapeHtml(opt_data.task.state.toLowerCase()) + ((opt_data.error) ? ' task-error' : '') + ((opt_data.task.pendingSync) ? ' task-pending-sync' : '') + ((opt_data.task.text == '' && !opt_data.task.id) ? ' task-blank' : '') + '" data-task-state="' + soy.$$escapeHtml(opt_data.task.state) + '" data-task-id="' + soy.$$escapeHtml([opt_data ? opt_data.task.id : null, ''].filter(function(x) {
        return x != null;
    })[0]) + '" data-comment-id="' + soy.$$escapeHtml(opt_data.task.anchor.id) + '"><div class="task-action task-checkbox-container"><input type="checkbox" class="task-checkbox checkbox"' + ((opt_data.task.state == 'RESOLVED') ? ' checked="checked"' : '') + ((opt_data.mode == 'edit' || !opt_data.task.permittedOperations.transitionable) ? ' disabled=\'disabled\'' : '') + ' /></div>' + ((opt_data.mode == 'edit') ? stash.feature.tasks.taskView.editTaskForm(opt_data) : stash.feature.tasks.taskView.viewTask(opt_data)) + ((opt_data.showLink) ? aui.buttons.button({
        text: '',
        type: 'link',
        extraClasses: 'task-action task-link-button',
        iconType: 'aui',
        iconClass: 'aui-icon-small aui-iconfont-link'
    }) : '') + '<div class="task-footer">';
    var diffAnchorPath__soy45 = opt_data.task.properties && opt_data.task.properties.diffAnchorPath;
    output += ((opt_data.showLink && diffAnchorPath__soy45) ? '<aside class="comment-diff-anchor">' + aui.icons.icon({
        useIconFont: true,
        icon: 'file',
        iconFontSet: 'devtools'
    }) + aui.buttons.button({
        text: new (require('model/path'))(diffAnchorPath__soy45).getName(),
        type: 'link',
        extraAttributes: {
            'data-path': diffAnchorPath__soy45
        }
    }) + '</aside>' : '') + ((opt_data.mode == 'edit' || (opt_data.task.permittedOperations.editable || opt_data.task.permittedOperations.deletable) || opt_data.task.id == null) ? '<ul class="actions">' + ((opt_data.mode == 'edit') ? stash.feature.tasks.taskView.editTaskActions(null) : stash.feature.tasks.taskView.viewTaskActions(opt_data)) + '</ul>' : '') + ((opt_data.mode == 'edit') ? '<div class="task-tip">' + soy.$$escapeHtml("Tip: Try selecting some of the comment before clicking \x22Create task\x22") + '</div>' : '') + '</div></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskView.task.soyTemplateName = 'stash.feature.tasks.taskView.task';
}

stash.feature.tasks.taskView.viewTask = function(opt_data, opt_ignored) {
    return '<div class="task-content message ' + soy.$$escapeHtml(opt_data.task.html ? 'markup' : 'plaintext') + '">' + ((opt_data.task.html) ? soy.$$filterNoAutoescape(opt_data.task.html) : soy.$$escapeHtml(opt_data.task.text)) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskView.viewTask.soyTemplateName = 'stash.feature.tasks.taskView.viewTask';
}

stash.feature.tasks.taskView.viewTaskActions = function(opt_data, opt_ignored) {
    return '' + ((opt_data.task.permittedOperations.editable || opt_data.task.id == null) ? '<li><a href="#" class="task-edit">' + soy.$$escapeHtml("Edit") + '</a></li>' : '') + ((opt_data.task.permittedOperations.deletable || opt_data.task.id == null) ? '<li><a href="#" class="task-delete">' + soy.$$escapeHtml("Delete") + '</a></li>' : '');
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskView.viewTaskActions.soyTemplateName = 'stash.feature.tasks.taskView.viewTaskActions';
}

stash.feature.tasks.taskView.editTaskForm = function(opt_data, opt_ignored) {
    return '' + widget.aui.form.expandingTextarea({
        name: 'task-text',
        initialValue: opt_data.task.text,
        placeholderText: '' + ((opt_data.error) ? soy.$$escapeHtml(opt_data.error) : (opt_data.task.text) ? soy.$$escapeHtml("Please enter some text") : soy.$$escapeHtml("Add new task")),
        extraClasses: 'task-text' + ((opt_data.error) ? ' task-error' : '')
    });
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskView.editTaskForm.soyTemplateName = 'stash.feature.tasks.taskView.editTaskForm';
}

stash.feature.tasks.taskView.editTaskActions = function(opt_data, opt_ignored) {
    return '<li><a href="#" class="task-save">' + soy.$$escapeHtml("Save") + '</a></li><li><a href="#" class="task-cancel">' + soy.$$escapeHtml("Cancel") + '</a></li>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskView.editTaskActions.soyTemplateName = 'stash.feature.tasks.taskView.editTaskActions';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/task-list.js' */
define("feature/tasks/task-list", ["jquery", "stash/api/util/events", "stash/api/util/state", "feature/tasks/model/task-collection", "feature/tasks/task-list/task-list-dialog", "exports"], function(D, G, F, E, B, C) {
    var A;
    var I = {};
    function H(J, L, M, N) {
        var K = {
            projectKey: J,
            repository: L,
            pullRequestId: M
        };
        I.sourceEl = N;
        if (!A) {
            A = new B(E.getCollection());
            A._dialog.on("beforeShow", function() {
                G.trigger("stash.feature.tasks.list.opened", null, I)
            });
            A._dialog.on("close", function() {
                G.trigger("stash.feature.tasks.list.closed")
            })
        }
        A.openDialog(K)
    }
    C.openTaskListDialogForCurrentPullRequest = function() {
        H(F.getProject(), F.getRepository(), F.getPullRequest().id)
    }
    ;
    C.onReady = function() {
        D(document).on("click", ".task-list-dialog-link", function(M) {
            M.preventDefault();
            var J = D(M.currentTarget);
            var K = J.data("project-key") || F.getProject().key;
            var N = J.data("pull-request-id") || F.getPullRequest().id;
            var L = {
                id: J.data("repository-id") || F.getRepository().id,
                slug: J.data("repository-slug") || F.getRepository().slug
            };
            H(K, L, N, M.currentTarget)
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/task-list-dialog.js' */
define("feature/tasks/task-list/task-list-dialog", ["aui", "jquery", "lodash", "stash/api/util/events", "stash/api/util/server", "util/navbuilder", "feature/tasks/model/task-state", "feature/tasks/task-list/task-list-table"], function(L, F, M, J, E, B, D, I) {
    var K = "#task-list-dialog";
    var H = "#task-list-dialog-list";
    var G = B.rest().currentPullRequest().addPathComponents("tasks", "count").build();
    function C(N) {
        this.init.apply(this, arguments)
    }
    C.prototype.init = function(N) {
        M.bindAll(this, "openDialog", "updateDialog", "closeDialog", "_updateTaskCounts");
        var P = stash.feature.tasks.taskList.dialog();
        var O = F(K);
        if (O.length > 0) {
            O.remove()
        }
        F(document.body).append(P);
        this._dialog = L.dialog2(K);
        this._table = null;
        this._taskCollection = N;
        jQuery("#dialog-close-button").click(this.closeDialog);
        J.on("stash.feature.tasks.visit-task", this.closeDialog);
        this._dialog.on("show", function() {
            F(document).on("keydown", A)
        });
        this._dialog.on("hide", function() {
            F(document).off("keydown", A)
        })
    }
    ;
    function A(R) {
        var Q = {
            69: "E",
            74: "J",
            75: "K",
            79: "O",
            32: "SPACE",
            46: "DELETE"
        };
        var P = {
            E: "stash.feature.tasks.dialog.action.edit",
            J: "stash.feature.tasks.dialog.action.moveNext",
            K: "stash.feature.tasks.dialog.action.movePrevious",
            O: "stash.feature.tasks.dialog.action.open",
            SPACE: "stash.feature.tasks.dialog.action.transitionToNextState",
            DELETE: "stash.feature.tasks.dialog.action.delete"
        };
        var O = Q[R.keyCode];
        var N = R.target.nodeName === "TEXTAREA";
        if (!N) {
            if (O) {
                J.trigger(P[O]);
                R.preventDefault()
            }
        }
    }
    C.prototype.updateDialog = function() {
        if (this._table) {
            this._table.update()
        }
    }
    ;
    C.prototype.openDialog = function(P) {
        this._dialog.show();
        if (!this._table) {
            var O = this._dialog.$el.find(".aui-dialog2-content");
            var N = this._dialog.$el.find(H);
            this._table = new I(N,O,this._taskCollection,P);
            this._table.on("dataLoaded", this._updateTaskCounts.bind(this, P))
        }
        this._table.update()
    }
    ;
    C.prototype._updateTaskCounts = function(O, P) {
        var Q;
        var S = new F.Deferred();
        if (!P.isLastPage) {
            S = E.rest({
                url: G
            })
        } else {
            Q = this._taskCollection.groupBy("state");
            var R = Q[D.OPEN];
            var N = Q[D.RESOLVED];
            S.resolve({
                open: R ? R.length : 0,
                resolved: N ? N.length : 0
            })
        }
        S.done(function(T) {
            J.trigger("stash.feature.pull-request-tasks.set-counts", null, {
                openTaskCount: T.open,
                resolvedTaskCount: T.resolved,
                pullRequestId: O.pullRequestId,
                repositoryId: O.repository.id,
                isReset: true
            })
        })
    }
    ;
    C.prototype.closeDialog = function() {
        this._dialog.hide()
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/task-list.soy' */
// This file was automatically generated from task-list.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.tasks.taskList.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.tasks == 'undefined') {
    stash.feature.tasks = {};
}
if (typeof stash.feature.tasks.taskList == 'undefined') {
    stash.feature.tasks.taskList = {};
}

stash.feature.tasks.taskList.dialog = function(opt_data, opt_ignored) {
    return '' + aui.dialog.dialog2({
        id: 'task-list-dialog',
        size: 'medium',
        titleText: "Tasks",
        extraClasses: 'task-list-dialog',
        content: '' + stash.feature.tasks.taskList.dialogContent(null),
        footerHintText: "Tip: Use Shift + T to open the task list.",
        footerActionContent: '' + aui.buttons.button({
            id: 'dialog-close-button',
            text: "Close",
            extraClasses: 'aui-button-link'
        })
    });
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskList.dialog.soyTemplateName = 'stash.feature.tasks.taskList.dialog';
}

stash.feature.tasks.taskList.dialogContent = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<ul id="' + soy.$$escapeHtml([opt_data ? opt_data.id : null, 'task-list-dialog-list'].filter(function(x) {
        return x != null;
    })[0]) + '" class="paged-table task-list"></ul>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskList.dialogContent.soyTemplateName = 'stash.feature.tasks.taskList.dialogContent';
}

stash.feature.tasks.taskList.dialogContentSection = function(opt_data, opt_ignored) {
    return '<li class="task-list-row section-heading"><h6>' + soy.$$escapeHtml(opt_data.title) + '</h6></li>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskList.dialogContentSection.soyTemplateName = 'stash.feature.tasks.taskList.dialogContentSection';
}

stash.feature.tasks.taskList.taskListRow = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<li class="task-list-row' + soy.$$escapeHtml(opt_data.isCollapsed ? ' collapsed' : ' expanded') + ' task-container"></li>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskList.taskListRow.soyTemplateName = 'stash.feature.tasks.taskList.taskListRow';
}

stash.feature.tasks.taskList.dialogEmptyMessage = function(opt_data, opt_ignored) {
    return '<p>' + soy.$$escapeHtml("There are no tasks for this pull request.") + '</p>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskList.dialogEmptyMessage.soyTemplateName = 'stash.feature.tasks.taskList.dialogEmptyMessage';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/task-list-table.js' */
define("feature/tasks/task-list/task-list-table", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/events", "util/function", "widget/paged-table", "feature/tasks/model/task", "feature/tasks/model/task-state", "feature/tasks/task-list/task-list-row-view"], function(I, D, K, B, L, H, E, F, C, A) {
    function G(Q, P, R, O) {
        var M = this;
        this._scrollable = D(P);
        this.$target = D(Q);
        this.collection = R;
        this.context = O;
        this._destroyables = [];
        this._resolvedHeaderOutput = false;
        K.bindAll(this, "_onTaskDestroy", "_handleEdit", "_handleMoveNext", "_handleMovePrevious", "_handleOpen", "_handleTransitionToNextState", "_handleDelete");
        this.collection.on("destroy", this._onTaskDestroy);
        this._taskRowViews = [];
        var N = {
            target: this.$target,
            noneFoundMessageHtml: stash.feature.tasks.taskList.dialogEmptyMessage,
            scrollPane: P,
            rowSelector: "> li",
            taskContainerSelector: ".task-container",
            paginationContext: "task-list",
            focusOptions: {
                rowSelector: "> li",
                focusedClass: "focused"
            },
            statusCode: {
                "*": function(U, X, W, V, S) {
                    if (W === "timeout" || (U.status >= 500 && U.status <= 599)) {
                        var T = stash.widget.paragraph({
                            text: S.message
                        });
                        M._addNoRowsMessage(S.message);
                        return false
                    }
                    return true
                }
            }
        };
        E.call(this, N);
        this.prNavBuilder = B.project(O.projectKey).repo(O.repository).pullRequest(O.pullRequestId);
        this.bindNavigationHandlers()
    }
    K.extend(G.prototype, E.prototype);
    L.addLocalEventMixin(G.prototype);
    G.prototype._addNoRowsMessage = function(M) {
        this.$table.addClass("no-rows").after(this._new$Message(M || this.options.noneFoundMessageHtml()))
    }
    ;
    G.prototype.update = function(M) {
        this._resolvedHeaderOutput = false;
        K.invoke(this._taskRowViews, "remove");
        this._taskRowViews = [];
        E.prototype.update.call(this, M).done(this.trigger.bind(this, "dataLoaded"))
    }
    ;
    G.prototype.buildUrl = function(O, M) {
        var N = B.rest().project(this.context.projectKey).repo(this.context.repository).pullRequest(this.context.pullRequestId).addPathComponents("tasks").withParams({
            start: O,
            limit: M,
            withComments: true
        }).build();
        return N
    }
    ;
    G.prototype.handleNewRows = function(P, O) {
        var M = this;
        var N = [];
        K.each(P.values, function(R) {
            var S = M.collection.get(R.id);
            if (S) {
                S.set(R)
            } else {
                S = new F(R);
                S.setPullRequestId(M.context.pullRequestId);
                M.collection.add(S)
            }
            var Q = new A({
                prNavBuilder: M.prNavBuilder,
                model: S
            });
            M._taskRowViews.push(Q);
            if (S.getState() === C.RESOLVED && !M._resolvedHeaderOutput) {
                var T = stash.feature.tasks.taskList.dialogContentSection({
                    title: "Resolved tasks"
                });
                N.push(T);
                M._resolvedHeaderOutput = true
            }
            N.push(Q.render().$el)
        });
        M.$table.show()[O !== "html" ? O : "append"](N)
    }
    ;
    G.prototype.bindNavigationHandlers = function() {
        this._destroyables.push(L.chain().on("stash.feature.tasks.dialog.action.edit", this._handleEdit).on("stash.feature.tasks.dialog.action.moveNext", this._handleMoveNext).on("stash.feature.tasks.dialog.action.movePrevious", this._handleMovePrevious).on("stash.feature.tasks.dialog.action.open", this._handleOpen).on("stash.feature.tasks.dialog.action.transitionToNextState", this._handleTransitionToNextState).on("stash.feature.tasks.dialog.action.delete", this._handleDelete));
        this._destroyables.push(E.prototype.initShortcuts.call(this))
    }
    ;
    G.prototype.destroy = function() {
        E.prototype.destroy.call(this);
        K.invoke(this._destroyables, "destroy")
    }
    ;
    G.prototype.getTaskListRowViewForTask = function(N) {
        var M = this._taskRowViews.filter(function(O) {
            return O.model.getId() === N.getId()
        });
        return M && M[0]
    }
    ;
    G.prototype.focusInitialRow = function() {
        this._$focusedRow = this.$target.find(this.options.focusOptions.rowSelector + this.options.taskContainerSelector).first().addClass(this.options.focusOptions.focusedClass)
    }
    ;
    G.prototype.scrollToRow = function(M) {
        var P = this._scrollable.offset().top;
        var O = this._scrollable.scrollTop();
        var N = M.offset().top;
        this._scrollable.scrollTop((N - P) + O)
    }
    ;
    var J = {
        UP: "prevAll",
        DOWN: "nextAll"
    };
    G.prototype._handleMoveNext = function() {
        this._focusRow(J.DOWN)
    }
    ;
    G.prototype._handleMovePrevious = function() {
        this._focusRow(J.UP)
    }
    ;
    G.prototype._focusRow = function(N, M) {
        var O = this._$focusedRow[N](this.options.taskContainerSelector);
        if (!O.length) {
            return
        }
        this._$focusedRow.removeClass(this.options.focusOptions.focusedClass);
        this._$focusedRow = O.first().addClass(this.options.focusOptions.focusedClass);
        if (!M) {
            this.scrollToRow(this._$focusedRow)
        }
    }
    ;
    G.prototype._handleOpen = function() {
        this._$focusedRow.find(".task-link-button").trigger("click")
    }
    ;
    G.prototype._handleEdit = function() {
        var M = this.getTaskListRowViewForTask(this.getTaskFromFocusedRow());
        M.setCollapsed(false);
        this._$focusedRow.find(".task-edit").trigger("click")
    }
    ;
    G.prototype._handleTransitionToNextState = function() {
        var M = this.getTaskFromFocusedRow();
        if (M) {
            M.transitionToNextState()
        }
    }
    ;
    G.prototype._handleDelete = function() {
        this._$focusedRow.find(".task-delete").trigger("click")
    }
    ;
    G.prototype.getTaskFromFocusedRow = function() {
        var M = this._$focusedRow.find(".task").data("task-id");
        return M && this.collection.get(M)
    }
    ;
    G.prototype._onTaskDestroy = function(N) {
        var M = K.find(this._taskRowViews, H.dotEq("model", N));
        if (!M) {
            return
        }
        var O = this._$focusedRow.is(this.options.taskContainerSelector + ":last") ? J.UP : J.DOWN;
        this._focusRow(O, true);
        M.remove();
        this._taskRowViews = K.without(this._taskRowViews, M);
        if (N.getLastState() === C.RESOLVED) {
            var P = K.compose(H.eq(C.RESOLVED), H.invoke("model.getState"));
            if (!this._taskRowViews.some(P)) {
                this._resolvedHeaderOutput = false;
                this.$table.find(".section-heading").remove()
            }
        }
        if (this._taskRowViews.length === 0) {
            this._addNoRowsMessage()
        }
    }
    ;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/task-list-row-view.js' */
define("feature/tasks/task-list/task-list-row-view", ["backbone", "jquery", "lodash", "stash/api/util/events", "util/feature-detect", "util/function", "feature/tasks/model/task-state", "feature/tasks/task-view"], function(H, D, A, G, B, C, E, F) {
    return H.View.extend({
        events: {
            "click .task-content": "taskListContentClicked",
            "click .task-link-button": "taskListLinkClicked",
            "click .comment-diff-anchor .aui-button": "taskListDiffAnchorClicked"
        },
        defaults: {
            isCollapsible: true,
            showLink: true,
            initialTaskViewMode: F.Mode.VIEW
        },
        initialize: function(I) {
            this.options = A.extend({}, this.defaults, I);
            this.isCollapsed = this.options.isCollapsible;
            this.taskView = new F({
                model: this.model,
                mode: this.options.initialTaskViewMode,
                prNavBuilder: this.prNavBuilder,
                showLink: this.options.showLink
            });
            this.focusEditor = this.taskView.focusEditor;
            this.getEditorText = this.taskView.getEditorText;
            this.listenTo(this.model, "change:state", this._handleTaskChangeState);
            this.listenTo(this.model, "change:text", this._handleTaskChangeText);
            if (this.options.isCollapsible) {
                A.bindAll(this, "handleTaskExpand");
                G.on("stash.feature.tasks.list.expand", this.handleTaskExpand)
            }
        },
        template: C.dot("stash.feature.tasks.taskList.taskListRow")(window),
        activityUrl: function() {
            var I = this.model.getAnchor();
            return this.options.prNavBuilder.overview().comment(I.id).build()
        },
        diffUrl: function(I) {
            return this.options.prNavBuilder.diff().change(I).build()
        },
        render: function() {
            var I = D(this.template({
                isCollapsed: this.isCollapsed
            }));
            I.append(this.taskView.render().$el);
            this.$el.replaceWith(I);
            this.setElement(I);
            return this
        },
        transitionTaskHandler: function() {
            this.model.transitionToNextState()
        },
        taskListContentClicked: function(J) {
            if (!this.options.isCollapsible) {
                return
            }
            var I = D(J.target);
            if (I.is("a")) {
                return
            }
            this.setCollapsed(!this.isCollapsed)
        },
        setCollapsed: function(L) {
            var I = this;
            this.isCollapsed = L;
            function K(N, Q, P, M) {
                function O() {
                    I.$el.removeClass([Q, M].join(" ")).addClass(P).css({
                        height: ""
                    })
                }
                I.$el.css({
                    height: N
                }).addClass(Q);
                if (B.cssTransition()) {
                    I.$el.one(B.transitionEndEventName(), O)
                } else {
                    O()
                }
            }
            function J() {
                return I.$el.find(".task").get(0).scrollHeight
            }
            if (this.isCollapsed) {
                this.$el.css({
                    height: J()
                }).removeClass("expanded");
                A.defer(K.bind(this, "", "collapsing", "collapsed", "expanded expanding"))
            } else {
                if (this.model.getState() !== E.OPEN) {
                    return
                }
                G.trigger("stash.feature.tasks.list.expand", null, this);
                this.$el.removeClass("collapsed");
                K(J(), "expanding", "expanded", "collapsed collapsing")
            }
        },
        taskListDiffAnchorClicked: function(I) {
            var J = this.model.getProperties().diffAnchorPath;
            this._handleTaskClick(I, "stash.layout.pull-request.urlRequested", this.diffUrl(J));
            this.triggerTaskVisitedEvent({
                location: "diff"
            })
        },
        taskListLinkClicked: function(I) {
            this._handleTaskClick(I, "stash.layout.pull-request.urlRequested", this.activityUrl());
            this.triggerTaskVisitedEvent({
                location: "activity-stream"
            })
        },
        triggerTaskVisitedEvent: function(I) {
            I = A.extend({}, {
                task: this.model.toJSON()
            }, I);
            G.trigger("stash.feature.tasks.visit-task", null, I)
        },
        handleTaskExpand: function(I) {
            if (I === this || this.isCollapsed) {
                return
            }
            if (this.taskView.mode === F.Mode.EDIT) {
                this.taskView.cancelTaskEdit()
            }
            this.setCollapsed(true)
        },
        highlight: function() {
            var I = this.$el.removeClass.bind(this.$el, "task-highlight");
            this.$el.addClass("task-highlight");
            if (B.cssAnimation()) {
                this.$el.one(B.animationEndEventName(), I)
            } else {
                setTimeout(I, 5000)
            }
        },
        _handleTaskClick: function(J, I) {
            J.preventDefault();
            G.trigger.apply(this, [I, null].concat(A.toArray(arguments).slice(2)))
        },
        _handleTaskChangeState: function(I) {
            this.$el.toggleClass("pending-delete", I.getState() === E.DELETED)
        },
        _handleTaskChangeText: function(I) {
            if (I.isNew() && I.getText() !== "") {
                this.highlight()
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-list-resources', location = '/static/feature/tasks/task-list/comment-task-list-view.js' */
define("feature/tasks/task-list/comment-task-list-view", ["backbone", "lodash", "util/events", "util/feature-detect", "util/function", "feature/tasks/model/task", "feature/tasks/task-list/task-list-row-view", "feature/tasks/task-view"], function(F, G, H, I, E, C, A, D) {
    var B = F.View.extend({
        defaults: {
            pullRequestId: null
        },
        initialize: function(K) {
            var J = this;
            this.comment = K.comment;
            ["add", "remove"].forEach(function(L) {
                J.listenTo(J.collection, L, J.render.bind(J, L))
            });
            this.options = G.extend({}, this.defaults, K);
            this.taskRowViews = []
        },
        getCurrentTask: function() {
            return this.collection.find(E.invoke("isNew"))
        },
        getCurrentTaskText: function() {
            return this.getCurrentTaskRowView().getEditorText() || ""
        },
        getCurrentTaskRowView: function() {
            return this._findRowViewForTask(this.getCurrentTask())
        },
        createTask: function(L) {
            var J = this.getCurrentTaskRowView();
            if (J) {
                J.focusEditor();
                return null
            }
            var K = new C({
                anchor: {
                    id: this.comment.id,
                    type: C.Anchor.COMMENT
                },
                pullRequestId: this.options.pullRequestId,
                repositoryId: this.options.repositoryId,
                text: L
            });
            this.collection.unshift(K);
            if (L) {
                K.prefilled = true;
                K.save().fail(this.collection.remove.bind(this.collection, K))
            }
            return K
        },
        render: function(N, J) {
            var U = this;
            var S;
            this.$(".pending-delete").removeClass("pending-delete");
            var K = this.$el.outerHeight(true);
            this.$el.css({
                height: K
            });
            function T(V) {
                return new A({
                    model: V,
                    initialTaskViewMode: (V.isNew() && V.getText() === "") ? D.Mode.EDIT : D.Mode.VIEW,
                    isCollapsible: false,
                    showLink: false
                })
            }
            var R = false;
            switch (N) {
            case "remove":
                S = this._findRowViewForTask(J);
                if (S) {
                    S.$el.addClass("pending-delete").trigger("comment-child-removed");
                    S.remove();
                    this.taskRowViews = G.without(this.taskRowViews, S)
                }
                R = true;
                break;
            case "add":
                var O = arguments[3].at;
                S = T(J);
                this.taskRowViews.splice(O, 0, S);
                var Q = S.render().$el;
                var P = this.$(this.$("li").get(O));
                if (P.length) {
                    P.before(Q)
                } else {
                    this.$el.append(Q)
                }
                if (J.isNew() && J.getText() !== "") {
                    S.highlight()
                }
                Q.trigger("comment-child-added");
                R = true;
                break;
            default:
                G.invoke(this.taskRowViews, "remove");
                this.taskRowViews = this.collection.map(T);
                this.$el.append(this.taskRowViews.map(function(V) {
                    return V.render().$el
                }));
                break
            }
            var L = this.taskRowViews.reduce(function(V, W) {
                return V + W.$el.outerHeight(true)
            }, 0);
            function M(V) {
                U.$el.removeClass("transition-height").css({
                    height: "auto"
                });
                if (V) {
                    H.trigger("stash.webpanel.resize", null, {
                        location: "internal.stash.comments.extra",
                        el: U.$el.get(0)
                    })
                }
            }
            if (I.cssTransition() && R) {
                this.$el.addClass("transition-height").css({
                    height: L
                }).one(I.transitionEndEventName(), M.bind(U, true))
            } else {
                M(false)
            }
            return this
        },
        _findRowViewForTask: function(J) {
            return G.find(this.taskRowViews, {
                model: J
            })
        }
    });
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-analytics-resources', location = '/static/feature/tasks/task-analytics/task-analytics.js' */
define("feature/tasks/task-analytics", ["jquery", "stash/api/util/events", "stash/api/util/state", "util/analytics", "util/text", "feature/tasks/model/task", "feature/tasks/model/task-collection", "feature/tasks/model/task-state", "exports"], function(R, Q, L, W, P, V, h, S, Z) {
    var e = {
        ACTIVITY_STREAM: "activity-stream",
        COMMITS: "commits-tab",
        DIFF: "diff-tab",
        TASK_LIST: "task-list"
    };
    var U = h.getCollection();
    var J = "#task-list-dialog";
    var B = true;
    var b = false;
    var I = "pullRequest.task.";
    var C;
    function d(k, l) {
        W.add(I + k, l)
    }
    function D(k) {
        return Date.now() - k
    }
    function H(k, m) {
        var l;
        if (k) {
            l = {
                "task.text.length": k.text.length,
                "task.id": k.id,
                "task.time.since.created": D(k.createdDate)
            }
        }
        var n = {
            source: j(),
            "pullRequest.id": L.getPullRequest().id,
            "repository.id": L.getRepository().id
        };
        return R.extend({}, n, m, l)
    }
    function c() {
        Q.chain().on("stash.feature.pull-request-tasks.resolved", M).on("stash.feature.pull-request-tasks.reopened", F).on("stash.feature.tasks.list.opened", O).on("stash.feature.tasks.list.closed", g).on("stash.feature.tasks.list.expand", E).on("stash.feature.tasks.visit-task", K);
        U.on("change:id", i).on("change:text", X).on("destroy", A)
    }
    function M(k) {
        d("resolved." + G.taskTransitionAction(k.task), H(k.task))
    }
    function F(k) {
        d("reopened." + G.taskTransitionAction(k.task), H(k.task))
    }
    function O(l) {
        C = Date.now();
        var k = "keyboard-shortcut";
        if (l && l.sourceEl) {
            k = "link"
        }
        d("list.opened." + G.genericAction(), H(null, {
            "source.secondary": k
        }))
    }
    function g() {
        d("list.closed." + G.genericAction(), H(null, {
            age: D(C)
        }))
    }
    function E(k) {
        d("list.expandTask." + G.genericAction(), H(k.model.toJSON()))
    }
    function K(l) {
        var k = "gotoTask";
        if (l.location === "diff") {
            k = "gotoFile"
        }
        d("list." + k + "." + G.genericAction(), H(l.task))
    }
    function i(k) {
        var n = k.toJSON();
        var m;
        if (n.anchor.type === V.Anchor.COMMENT) {
            var l = a(n);
            m = {
                "is.comment.owner": l.author === L.getCurrentUser().name,
                "duplicates.comment": n.text.trim() === l.text.trim()
            }
        }
        d("created." + (k.prefilled ? "prefilled." : "") + G.genericAction(), H(n, m))
    }
    function X(m) {
        if (m.isNew()) {
            return
        }
        var k = m.getState() === S.RESOLVED;
        var l = f() || Y() || N(m.toJSON());
        if (!l || k) {
            return
        }
        if (m.attributes.text !== m._previousAttributes.text) {
            d("edited." + G.taskAction(m.toJSON(), B), H(m.toJSON()))
        }
    }
    function A(k) {
        if (k.isNew()) {
            return
        }
        d("deleted." + G.taskAction(k.toJSON(), B), H(k.toJSON()))
    }
    var G = {
        Type: {
            other: "byOther",
            PRAuthor: "byPRAuthor",
            taskAuthor: "byTaskAuthor",
            admin: "byAdmin",
            reviewer: "byReviewer"
        },
        genericAction: function() {
            var k = this.Type.other;
            if (f()) {
                k = this.Type.PRAuthor
            } else {
                if (T()) {
                    k = this.Type.reviewer
                }
            }
            return k
        },
        taskAction: function(l, k) {
            var m = this.Type.other;
            k = !!k;
            if (Y() && k) {
                m = this.Type.admin
            }
            if (f()) {
                m = this.Type.PRAuthor
            } else {
                if (N(l)) {
                    m = this.Type.taskAuthor
                }
            }
            return m
        },
        taskTransitionAction: function(k) {
            return this.taskAction(k, b)
        }
    };
    function j() {
        var k = R(J);
        if (k.length && k.attr("aria-hidden") === "false") {
            return e.TASK_LIST
        }
        var l = R(".active-tab[data-module-key]").attr("data-module-key");
        if (P.endsWith(l, "diff")) {
            return e.DIFF
        }
        if (P.endsWith(l, "commits")) {
            return e.COMMITS
        }
        return e.ACTIVITY_STREAM
    }
    function f() {
        return L.getCurrentUser().id === L.getPullRequest().author.user.id
    }
    function Y() {
        return L.getCurrentUser().isAdmin
    }
    function T() {
        var k = L.getPullRequest().reviewers;
        return k.length && k.some(function(l) {
            return l.user.id === L.getCurrentUser().id
        })
    }
    function N(k) {
        return L.getCurrentUser().name === k.author.name
    }
    function a(k) {
        if (k.anchor.type !== V.Anchor.COMMENT) {
            return null
        }
        var l = R('.comment[data-id="' + k.anchor.id + '"]');
        return {
            text: l.find("> .content > .message").text(),
            author: l.find("span[data-username]").attr("data-username")
        }
    }
    Z.init = c
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:task-analytics-resources', location = '/static/feature/tasks/task-analytics/task-analytics-init.js' */
jQuery(document).ready(function() {
    require("feature/tasks/task-analytics").init()
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:updating-section', location = '/static/widget/updating-section/updating-section.js' */
define("widget/updating-section", ["jquery", "lodash"], function(C, B) {
    function A(G, F, E, D) {
        this.init.apply(this, arguments)
    }
    A.defaults = {
        context: {},
        isVisibleProperty: null
    };
    A.prototype.init = function(G, F, E, D) {
        this._$el = C(G);
        this._template = E;
        this._options = B.extend({}, A.defaults, D);
        this._$placeholder = this._$el.find(".replacement-placeholder");
        this._currentValue = {};
        B.bindAll(this, "updateValue", "updateVisibility");
        this._destroyCallbacks = [F.onValue(this.updateValue)];
        if (this._options.isVisibleProperty) {
            this._destroyCallbacks.push(this._options.isVisibleProperty.onValue(this.updateVisibility))
        }
    }
    ;
    A.prototype.updateVisibility = function(D) {
        this._$el.toggleClass("hidden", !D)
    }
    ;
    A.prototype.updateValue = function(E) {
        var D = B.extend({}, E, this._options.context);
        if (B.isEqual(D, this._currentValue)) {
            return
        }
        this._currentValue = D;
        var F = this._template(D);
        this._$placeholder.stop().fadeOut(0).html(F).fadeIn()
    }
    ;
    A.prototype.destroy = function() {
        this._destroyCallbacks.forEach(Function.prototype.call, Function.prototype.call)
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:taskable-comment-resources', location = '/static/feature/tasks/taskable-comment/taskable-comment.js' */
define("feature/tasks/taskable-comment", ["jquery", "lodash", "stash/api/util/events", "stash/api/util/state", "feature/comments/comment-async-web-panel", "feature/tasks/model/task", "feature/tasks/model/task-collection", "feature/tasks/task-list/comment-task-list-view", "exports"], function(E, N, L, K, A, G, I, P, D) {
    var H = I.getCollection();
    var O = {};
    L.on("stash.feature.tasks.createTask", F);
    function F(Q) {
        var X = E(Q);
        var R = X.data("id");
        var W = "";
        var U = window.getSelection();
        if (U) {
            var Y = X.find(".message").get(0);
            if (E.contains(Y, U.anchorNode) && (E.contains(Y, U.focusNode) || X.find(".actions").is(U.focusNode))) {
                W = G.sanitiseText(U.toString());
                U.removeAllRanges()
            }
        }
        var V = O[R];
        var T = V.createTask(W);
        if (T) {
            H.add(T)
        } else {
            if (W) {
                T = V.getCurrentTask();
                var S = V.getCurrentTaskText();
                S = S ? S.trim() + " " : "";
                T.setText(S + W)
            }
        }
    }
    L.on("stash.feature.comments.commentDeleted", C);
    function C(R) {
        var Q = H.find(function(S) {
            return S.getAnchor().id === R.id
        });
        if (Q) {
            H.remove(Q)
        }
    }
    function M(S) {
        var T = S.comment;
        var Q = new I();
        N.each(T.tasks, function(V) {
            var U = H.get(V.id);
            if (!U) {
                U = new G(V);
                U.setPullRequestId(K.getPullRequest().id);
                U.setRepositoryId(K.getRepository().id);
                H.add(U)
            }
            Q.add(U)
        });
        var R = {
            comment: T,
            collection: Q
        };
        return A.getWebPanelEl(function(V) {
            var U = E(stash.feature.tasks.taskableComment.taskListPlaceholder());
            V.replaceWith(U);
            B(U, R)
        })
    }
    function B(S, R) {
        var Q = E(S);
        var T = new P({
            collection: R.collection,
            el: Q,
            comment: R.comment,
            pullRequestId: K.getPullRequest().id,
            repositoryId: K.getRepository().id
        });
        T.render();
        O[R.comment.id] = T
    }
    function J(Q) {
        return !!Q.pullRequest
    }
    D.newTaskableCommentView = M;
    D.isPullRequest = J;
    D._commentTaskListViews = O
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:taskable-comment-resources', location = '/static/feature/tasks/taskable-comment/taskable-comment.soy' */
// This file was automatically generated from taskable-comment.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.tasks.taskableComment.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.tasks == 'undefined') {
    stash.feature.tasks = {};
}
if (typeof stash.feature.tasks.taskableComment == 'undefined') {
    stash.feature.tasks.taskableComment = {};
}

stash.feature.tasks.taskableComment.taskListPlaceholder = function(opt_data, opt_ignored) {
    return '<ul class="task-list"></ul>';
}
;
if (goog.DEBUG) {
    stash.feature.tasks.taskableComment.taskListPlaceholder.soyTemplateName = 'stash.feature.tasks.taskableComment.taskListPlaceholder';
}
;;/* module-key = 'com.atlassian.stash.stash-client-web-fragments-plugin:comment-task-list', location = '/web-fragment-placeholder.config' */
WebFragments.addWebPanelDescriptor({
    'pluginKey': 'com.atlassian.stash.stash-client-web-fragments-plugin',
    'key': 'comment-task-list',
    'moduleKey': 'comment-task-list',
    'completeModuleKey': 'com.atlassian.stash.stash-client-web-fragments-plugin:comment-task-list',
    'weight': 100.0,
    'condition': function(ctx) {
        return WebFragments._getValue((require('feature/tasks/taskable-comment').isPullRequest), ctx);
    },
    'params': {},
    'location': 'internal.stash.comments.extra',
    'view': function(ctx) {
        return WebFragments._getValue((require('feature/tasks/taskable-comment').newTaskableCommentView), ctx);
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/activity-comment-context.js' */
define("feature/comments/activity-comment-context", ["lodash", "util/events", "feature/comments/activity-comment-container", "feature/comments/comment-context"], function(B, C, A, D) {
    return D.extend({
        findContainerElements: function() {
            return [this.el]
        },
        _registerContainer: function(F, G, E) {
            this._containers[F] = new A({
                name: F,
                context: this,
                el: G,
                anchor: E
            });
            return this._containers[F]
        },
        getActivityCommentContainer: function() {
            return this._containers[this.getAnchor().getId()]
        },
        restoreDrafts: function() {
            if (this.unrestoredDrafts.length) {
                var E = this.getActivityCommentContainer();
                this.unrestoredDrafts = B.reject(this.unrestoredDrafts, E.restoreDraftComment.bind(E));
                if (this.unrestoredDrafts.length) {
                    C.once("stash.feature.pullRequestActivity.dataLoaded", this.restoreDrafts.bind(this))
                }
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-tips.js' */
define("feature/comments/comment-tips", ["aui", "util/navigator"], function(B, A) {
    return {
        tips: [A.isMac() ? "\u2318 + Enter to post your comment" : "Ctrl + Enter to post your comment", "Type \u0027@\u0027 to mention other users", B.format("You can use {0}Markdown{1} in comments", "<a href='http:\/\/docs.atlassian.com\/stash\/docs-038\/Markdown+syntax+guide' target=\"_blank\">", "</a>")]
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/anchors.js' */
define("feature/comments/anchors", ["jquery", "stash/api/util/navbuilder", "model/page-state"], function(E, F, D) {
    function A(G) {
        G = G || {};
        this._projectKey = G.projectKey || D.getProject().getKey();
        this._repoSlug = G.repoSlug || D.getRepository().getSlug();
        this._pullRequestId = G.pullRequestId || D.getPullRequest().getId()
    }
    A.prototype.getId = function() {
        return "pullrequest-" + this._projectKey + "-" + this._repoSlug + "-" + this._pullRequestId
    }
    ;
    A.prototype.toJSON = function() {
        return undefined
    }
    ;
    A.prototype.urlBuilder = function() {
        return F.rest().project(this._projectKey).repo(this._repoSlug).pullRequest(this._pullRequestId).comments()
    }
    ;
    function C(G) {
        this._path = G.getPath();
        this._srcPath = G.getSrcPath();
        this._commitRange = G.getCommitRange();
        this._projectKey = (G.getRepository() || D).getProject().getKey();
        this._repoSlug = (G || D).getRepository().getSlug()
    }
    C.prototype.getId = function() {
        return "diff-" + this._projectKey + "-" + this._repoSlug + "-" + this._commitRange.getId() + "-" + this._path
    }
    ;
    C.prototype.toJSON = function() {
        var G = {
            path: this._path.toString(),
            commitRange: this._commitRange.toJSON()
        };
        var H = this._srcPath && this._srcPath.toString();
        if (H) {
            G.srcPath = H
        }
        return G
    }
    ;
    C.prototype.urlBuilder = function() {
        var G = F.rest().project(this._projectKey).repo(this._repoSlug);
        var H = this._commitRange.getPullRequest();
        if (H) {
            return G.pullRequest(H.getId()).comments()
        }
        return G.changeset(this._commitRange.getUntilRevision().getId()).comments()
    }
    ;
    function B(J, I, G, H) {
        this._diffAnchor = J;
        this._lineType = I;
        this._line = G;
        this._fileType = H
    }
    B.prototype.getId = function() {
        var G = this._fileType ? this._fileType + "-" : "";
        return "line-" + this._diffAnchor.getId() + "-" + G + this._lineType + "-" + this._line
    }
    ;
    B.prototype.toJSON = function() {
        var G = E.extend(this._diffAnchor.toJSON(), {
            line: this._line,
            lineType: this._lineType
        });
        if (this._fileType) {
            G.fileType = this._fileType
        }
        return G
    }
    ;
    B.prototype.urlBuilder = function() {
        return this._diffAnchor.urlBuilder()
    }
    ;
    return {
        PullRequestAnchor: A,
        DiffAnchor: C,
        LineAnchor: B
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-collection.js' */
define("feature/comments/comment-collection", ["backbone", "feature/comments/comment-model"], function(B, A) {
    return B.Collection.extend({
        initialize: function(D, C) {
            C = C || {};
            this.anchor = C.anchor
        },
        model: A,
        url: function() {
            return this.anchor.urlBuilder().build()
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-container.js' */
define("feature/comments/comment-container", ["aui", "backbone", "jquery", "lib/jsuri", "lodash", "memoir", "util/analytics", "util/dom-event", "util/events", "util/function", "util/syntax-highlight", "model/page-state", "widget/aui/form", "widget/confirm-dialog", "widget/markup-editor", "feature/comments/comment-collection", "feature/comments/comment-model", "feature/comments/comment-tips"], function(H, B, E, N, R, P, F, S, A, I, L, J, C, G, M, K, O, D) {
    var Q = 450;
    return B.View.extend({
        initialize: function() {
            R.bindAll(this, "onCommentEditorResize", "onCommentFocused");
            this.anchor = this.anchor || this.options.anchor;
            this.rootCommentListSelector = this.rootCommentListSelector || this.options.rootCommentListSelector;
            this.context = this.options.context;
            this.pullRequest = this.options.pullRequest || J.getPullRequest();
            if (!this.collection) {
                this.collection = new K([],{
                    anchor: this.anchor
                })
            }
            this.initDeleteButtons();
            this.$el.imagesLoaded(this.onImagesLoaded.bind(this));
            A.trigger("stash.feature.comments.commentContainerAdded", null, this.$el);
            var T = 300;
            this.updateDraftComment = R.debounce(this.updateDraftComment, T);
            this.deleteDraftComment = R.debounce(this.deleteDraftComment, T);
            this.on("comment.saved", L.container.bind(null, this.$el));
            L.container(this.$el);
            A.once("stash.feature.pullRequestActivity.focused", this.onCommentFocused)
        },
        events: {
            "submit form": "onFormSubmit",
            "click a.times": "onDateClicked",
            "click .cancel": "onCancelClicked",
            "click .reply": "onReplyClicked",
            "click .edit": "onEditClicked",
            "click .task-create": "onCreateTaskClicked",
            "keydown form": "onFormKeydown",
            "input textarea": "onTextareaInput",
            "comment-child-added .comment ": "onChildrenChanged",
            "comment-child-removed .comment ": "onChildrenChanged"
        },
        initDeleteButtons: function(T) {
            this.createDeleteDialog().attachTo(".delete", null, this.el)
        },
        createDeleteDialog: function() {
            var T = this;
            var U = new G({
                id: "delete-repository-dialog",
                titleText: "Delete comment",
                titleClass: "warning-header",
                panelContent: "<p>" + "Are you sure that you want to delete this comment?" + "</p>",
                submitText: "Delete",
                submitToHref: false
            });
            U.addConfirmListener(function(X, V, W) {
                W();
                T.deleteComment(V.closest(".comment"))
            });
            return U
        },
        onFormSubmit: function(T) {
            T.preventDefault();
            T.stopPropagation();
            this.submitCommentForm(E(T.target))
        },
        onDateClicked: function(U) {
            U.preventDefault();
            U.stopPropagation();
            E(".comment.focused").removeClass("focused");
            var T = E(U.target).closest("a");
            T.closest(".comment").addClass("focused");
            P.pushState(null, null, T.prop("href"))
        },
        onCancelClicked: function(T) {
            T.preventDefault();
            T.stopPropagation();
            this.cancelCommentForm(E(T.target).closest("form"))
        },
        onReplyClicked: function(T) {
            T.preventDefault();
            T.stopPropagation();
            this.openReplyForm(E(T.target).closest(".comment"))
        },
        onEditClicked: function(T) {
            T.preventDefault();
            T.stopPropagation();
            this.openEditForm(E(T.target).closest(".comment"))
        },
        onCreateTaskClicked: function(U) {
            U.preventDefault();
            U.stopPropagation();
            var T = E(U.target).closest(".comment");
            A.trigger("stash.feature.tasks.createTask", null, T)
        },
        onImagesLoaded: function(T) {
            this.trigger("change")
        },
        onFormKeydown: function(T) {
            if (S.isCtrlish(T) && T.which === H.keyCode.ENTER) {
                T.preventDefault();
                T.stopPropagation();
                E(T.target).closest("form").submit()
            }
        },
        onTextareaInput: function(T) {
            if (E(T.target).closest(".comment-container").is(this.el)) {
                this.updateDraftComment(T.target)
            }
        },
        onChildrenChanged: function(V) {
            if (V.target === V.currentTarget) {
                return
            }
            V.stopPropagation();
            var T = E(V.currentTarget);
            var U = T.find("> .content .task-list-row, > .replies > .comment").not(".pending-delete").length;
            T.find("> .content > .actions > li > .delete").parent().toggleClass("hidden", !!U)
        },
        onCommentFocused: function(U) {
            var V = new N(window.location);
            var W = V.getQueryParamValue("action");
            var T = {
                "comment.id": this.getCommentJSON(U.closest(".comment")).id,
                "pullRequest.id": J.getPullRequest().id,
                "repository.id": J.getRepository().id
            };
            if (W === "reply") {
                U.find(".reply").first().click();
                F.add("stash.client.comment.actions.reply", T)
            } else {
                if (W === "view") {
                    F.add("stash.client.comment.actions.view", T)
                }
            }
        },
        updateDraftComment: function(U) {
            var T = this.getDraftCommentFromForm(E(U).closest("form"));
            this.context && this.context.saveDraftComment(T)
        },
        getDraftCommentFromForm: function(U) {
            var T = this.getCommentFormJSON(U);
            if (T.anchor) {
                delete T.anchor.commitRange
            }
            return E.extend({}, T)
        },
        deleteDraftComment: function(T) {
            this.context && this.context.deleteDraftComment(T)
        },
        getRootCommentList: function() {
            var T = this.$(this.rootCommentListSelector);
            if (!T.length) {
                T = this.$el
            }
            return T
        },
        render: function() {
            var T = stash.feature.comments(E.extend({
                comments: this.collection.toJSON()
            }, this.anchor.toJSON()));
            this.$el.replaceWith(T);
            this.setElement(T[0])
        },
        _toJSON: function(U, V) {
            var X = parseInt(U.parent().closest(".comment").attr("data-id"), 10);
            var W = parseInt(U.attr("data-id"), 10);
            var T = parseInt(U.attr("data-version"), 10);
            return {
                id: !isNaN(W) ? W : undefined,
                version: !isNaN(T) ? T : undefined,
                text: V,
                anchor: this.anchor.toJSON(),
                parent: !isNaN(X) ? {
                    id: X
                } : undefined
            }
        },
        getCommentJSON: function(T) {
            return this._toJSON(T, T.find("> .content > .message").attr("data-text"))
        },
        getCommentFormJSON: function(T) {
            var U = T.parent().is(".comment") ? T.parent() : T;
            return this._toJSON(U, T.find("textarea").val())
        },
        renderContentUpdate: function(T, U) {
            T.children(".content").replaceWith(stash.feature.commentContent({
                pullRequest: this.pullRequest && this.pullRequest.toJSON(),
                comment: U,
                hideDelete: !!T.find("> .replies > .comment").length
            }));
            T.attr("data-version", U.version).data("version", U.version);
            this.$el.imagesLoaded(this.onImagesLoaded.bind(this));
            this.scrollToComment(T);
            this.trigger("change");
            A.trigger("stash.feature.comments.commentEdited", null, U, T)
        },
        insertCommentIntoList: function(V, T, W) {
            var U = T.children(".comment:first");
            while (U.length) {
                if (parseInt(U.data("id"), 10) > W.id) {
                    break
                }
                U = U.next(".comment")
            }
            U = U.length ? U : T.children(".comment-form-container:last");
            if (U.length) {
                V.insertBefore(U)
            } else {
                T.append(V)
            }
        },
        renderComment: function(Y, Z, V) {
            var U;
            if (V && (U = E('.comment[data-id="' + Y.id + '"]')).length) {
                return this.renderContentUpdate(U, Y)
            }
            Y = E.extend({
                isNew: true
            }, Y);
            var X = Z && this.$("[data-id=" + Z + "]");
            var W = (X ? X.children(".replies") : this.getRootCommentList());
            U = E(stash.feature.comment({
                pullRequest: this.pullRequest && this.pullRequest.toJSON(),
                numOfAncestors: W.parents(".comment").length,
                extraClasses: this.getExtraCommentClasses(),
                comment: Y
            }));
            this.insertCommentIntoList(U, W, Y);
            var T = 5000;
            setTimeout(R.bind(U.removeClass, U, "new"), T);
            this.scrollToComment(U);
            U.hide().fadeIn("slow");
            this.$el.imagesLoaded(this.onImagesLoaded.bind(this));
            this.trigger("change");
            A.trigger("stash.feature.comments.commentAdded", null, Y, U);
            U.trigger("comment-child-added")
        },
        getExtraCommentClasses: function() {
            return ""
        },
        showErrorMessage: function(W, V) {
            var U = this;
            var T = U.find(".error");
            if (!T.length) {
                T = E('<div class="error"></div>');
                U.find(".comment-form-footer").before(T)
            }
            T.text(V)
        },
        cancelCommentForm: function(T) {
            this.closeCommentForm(T)
        },
        submitCommentForm: function(U) {
            if (C.isSubmissionPrevented(U)) {
                return
            }
            var T = this;
            var V = U.find(".comment-submit-spinner");
            var Y = this.getCommentFormJSON(U);
            var W = Y.id != null;
            var X = W && this.collection.get(Y.id);
            var a = Y.parent && Y.parent.id;
            var Z = X ? this.collection.get(Y.id) : new O();
            Z.on("invalid", this.showErrorMessage, U);
            if (Z.set(E.extend(Y, {
                avatarSize: stash.widget.avatarSizeInPx({
                    size: "medium"
                })
            }), {
                validate: true
            })) {
                if (!X) {
                    this.collection.push(Z)
                }
                U.addClass("submitting");
                V.spin("medium");
                C.preventSubmission(U);
                Z.save().done(function(b) {
                    b.createdDate = Math.min(b.createdDate, new Date().getTime());
                    b.updatedDate = Math.min(b.updatedDate, new Date().getTime());
                    T.closeCommentForm(U, {
                        doNotDestroy: true
                    });
                    T.renderComment(b, a, W);
                    T.trigger("comment.saved")
                }).fail(function() {
                    if (!X && !W) {
                        T.collection.remove(Y.id)
                    }
                }).always(function() {
                    V.spinStop();
                    U.removeClass("submitting");
                    C.allowSubmission(U)
                })
            }
            Z.off("invalid", this.showErrorMessage)
        },
        deleteComment: function(W) {
            var X = this.getCommentJSON(W);
            var Y;
            if (this.collection.get(X)) {
                Y = this.collection.get(X.id)
            } else {
                Y = new O(X);
                this.collection.push(Y)
            }
            var T = W.find("> .content .delete")
              , V = {
                h: T.height(),
                w: T.width()
            };
            T.height(V.h).width(V.w).css("vertical-align", "middle").empty().spin("small");
            var U = this;
            Y.destroy({
                wait: true
            }).always(function() {
                T.spinStop()
            }).done(function() {
                W.addClass("pending-delete").fadeOut(function() {
                    W.trigger("comment-child-removed").remove();
                    U.onCommentDeleted();
                    U.trigger("change");
                    A.trigger("stash.feature.comments.commentDeleted", null, X)
                })
            }).fail(function() {
                T.css("height", "").css("width", "").css("vertical-align", "").text("Delete")
            })
        },
        onCommentDeleted: function() {},
        onCommentEditorResize: E.noop,
        openEditForm: function(V) {
            var W = this.getCommentJSON(V);
            var T = E(stash.feature.commentForm(E.extend({
                tips: this.$el.width() > Q ? D.tips : [],
                currentUser: J.getCurrentUser() && J.getCurrentUser().toJSON()
            }, W)));
            var U = V.find("> .user-avatar, > .content");
            U.detach();
            V.prepend(T).addClass("comment-form-container");
            T.data("originalContent", U);
            this._bindMarkupEditor(T);
            this.focusCommentForm(T);
            this.trigger("change");
            A.trigger("stash.feature.comments.commentFormShown", null, T);
            return T
        },
        openReplyForm: function(U) {
            var T = U.children(".replies");
            return this.openCommentForm(T, {
                location: "top"
            })
        },
        openNewCommentForm: function() {
            return this.openCommentForm(this.getRootCommentList(), {
                location: "bottom"
            })
        },
        openCommentForm: function(T, W) {
            var X = W && W.location === "top" ? "prependTo" : "appendTo";
            var U = T.children(".comment-form-container").not(".comment");
            if (!U.length) {
                U = E(stash.feature.commentFormListItem({
                    tips: this.$el.width() > Q ? D.tips : [],
                    currentUser: J.getCurrentUser() && J.getCurrentUser().toJSON()
                }))[X](T);
                this._bindMarkupEditor(U.find("form"))
            }
            var V = U.find("form");
            this.focusCommentForm(V);
            this.trigger("change");
            A.trigger("stash.feature.comments.commentFormShown", null, V);
            return V
        },
        closeCommentForm: function(T) {
            T.find(".error").remove();
            this.deleteDraftComment(this.getDraftCommentFromForm(T));
            this._unbindMarkupEditor(T);
            var U = T.data("originalContent");
            var V = T.parent();
            if (U) {
                V.removeClass("comment-form-container");
                T.replaceWith(U)
            } else {
                V.remove()
            }
            this.trigger("change");
            A.trigger("stash.feature.comments.commentFormHidden", null, T)
        },
        focusCommentForm: I.lazyDefer(function(T) {
            this.scrollToComment(T);
            T.find("textarea").focus()
        }),
        scrollToComment: E.noop,
        populateCommentFormFromDraft: function(U, T) {
            E(U).find("textarea").val(T.text).addClass("restored").attr("title", "This comment has been restored from an automatically saved draft.").trigger("input").one("click input", function() {
                E(this).removeClass("restored").removeAttr("title")
            })
        },
        getCommentElById: function(T) {
            return this.$(".comment[data-id=" + T + "]")
        },
        restoreDraftComment: function(T) {
            var U;
            if (T.id) {
                var V = this.getCommentElById(T.id);
                if (V.length) {
                    if (parseInt(T.version, 10) < parseInt(V.attr("data-version"), 10)) {
                        this.context.deleteDraftComment(T);
                        return true
                    }
                    U = this.openEditForm(V)
                }
            } else {
                if (T.parent) {
                    var W = this.getCommentElById(T.parent.id);
                    if (W.length) {
                        U = this.openReplyForm(W)
                    }
                } else {
                    U = this.openNewCommentForm()
                }
            }
            U && this.populateCommentFormFromDraft(U, T);
            return !!U
        },
        _bindMarkupEditor: function(T) {
            M.bindTo(T).on("resize", this.onCommentEditorResize)
        },
        _unbindMarkupEditor: function(T) {
            M.unbindFrom(T)
        },
        destroy: function() {
            this.$("form").each(I.thisToParam(this._unbindMarkupEditor.bind(this)))
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comments.soy' */
// This file was automatically generated from comments.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}

stash.feature.comments = function(opt_data, opt_ignored) {
    var output = '<div class="comment-container' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '"' + ((opt_data.line) ? ' data-line-number="' + soy.$$escapeHtml(opt_data.line) + '"' : '') + ((opt_data.lineType) ? ' data-line-type="' + soy.$$escapeHtml(opt_data.lineType) + '"' : '') + '><div class="panel"><ol class="comment-list">';
    if (opt_data.comments) {
        var commentList22 = opt_data.comments;
        var commentListLen22 = commentList22.length;
        for (var commentIndex22 = 0; commentIndex22 < commentListLen22; commentIndex22++) {
            var commentData22 = commentList22[commentIndex22];
            output += stash.feature.comment({
                comment: commentData22,
                numOfAncestors: 0,
                pullRequest: opt_data.commitRange.pullRequest
            });
        }
    }
    output += '</ol></div></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.comments.soyTemplateName = 'stash.feature.comments';
}

stash.feature.comment = function(opt_data, opt_ignored) {
    var output = '<li class="comment' + ((opt_data.comment.isNew) ? ' new' : '') + ((opt_data.comment.isUnread) ? ' unread' : '') + ((opt_data.comment.isFocused) ? ' focused' : '') + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '" data-id="' + soy.$$escapeHtml(opt_data.comment.id) + '" data-version="' + soy.$$escapeHtml(opt_data.comment.version) + '">' + stash.widget.avatar({
        size: 'medium',
        person: opt_data.comment.author
    }) + stash.feature.commentContent(opt_data) + '<ol class="replies' + ((opt_data.numOfAncestors >= 7) ? ' no-indent' : '') + '">';
    if (opt_data.comment.comments) {
        var replyList62 = opt_data.comment.comments;
        var replyListLen62 = replyList62.length;
        for (var replyIndex62 = 0; replyIndex62 < replyListLen62; replyIndex62++) {
            var replyData62 = replyList62[replyIndex62];
            output += stash.feature.comment({
                comment: replyData62,
                pullRequest: opt_data.pullRequest,
                numOfAncestors: opt_data.numOfAncestors + 1
            });
        }
    }
    output += '</ol></li>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.comment.soyTemplateName = 'stash.feature.comment';
}

stash.feature.commentContent = function(opt_data, opt_ignored) {
    var output = '<div class="content">';
    if (opt_data.comment.deleted) {
        output += soy.$$escapeHtml("This comment has been removed by the author.");
    } else {
        output += stash.widget.userLink({
            user: opt_data.comment.author,
            extraClasses: 'user-name'
        }) + '<div class="message ' + soy.$$escapeHtml(opt_data.comment.html ? 'markup' : 'plaintext') + '" data-text="' + soy.$$escapeHtml(opt_data.comment.text) + '">' + ((opt_data.comment.html) ? soy.$$filterNoAutoescape(opt_data.comment.html) : '<p>' + soy.$$escapeHtml(opt_data.comment.text) + '</p>') + '</div><ul class="actions"><li>' + stash.buttons.linkButton({
            content: '' + soy.$$escapeHtml("Reply"),
            extraClasses: 'reply'
        }) + '</li>' + ((opt_data.comment.permittedOperations.editable) ? '<li>' + stash.buttons.linkButton({
            content: '' + soy.$$escapeHtml("Edit"),
            extraClasses: 'edit'
        }) + '</li>' : '') + ((opt_data.comment.permittedOperations.deletable) ? '<li' + ((opt_data.hideDelete || (opt_data.comment.comments && opt_data.comment.comments.length || opt_data.comment.tasks && opt_data.comment.tasks.length)) ? ' class="hidden"' : '') + '>' + stash.buttons.linkButton({
            content: '' + soy.$$escapeHtml("Delete"),
            extraClasses: 'delete'
        }) + '</li>' : '');
        var itemList117 = WebFragments.getWebItems('stash.comments.actions', {
            comment: opt_data.comment,
            pullRequest: opt_data.pullRequest
        });
        var itemListLen117 = itemList117.length;
        for (var itemIndex117 = 0; itemIndex117 < itemListLen117; itemIndex117++) {
            var itemData117 = itemList117[itemIndex117];
            output += '<li>' + stash.widget.webItem(itemData117) + '</li>';
        }
        output += '</ul><ul class="info">';
        var panelHtmlList123 = WebFragments.getWebPanels('stash.comments.info', {
            comment: opt_data.comment,
            pullRequest: opt_data.pullRequest
        }).map(function(webPanel) {
            return soydata.VERY_UNSAFE.ordainSanitizedHtml(webPanel);
        });
        var panelHtmlListLen123 = panelHtmlList123.length;
        for (var panelHtmlIndex123 = 0; panelHtmlIndex123 < panelHtmlListLen123; panelHtmlIndex123++) {
            var panelHtmlData123 = panelHtmlList123[panelHtmlIndex123];
            output += '<li>' + soy.$$escapeHtml(panelHtmlData123) + '</li>';
        }
        output += '<li>';
        if (opt_data.pullRequest) {
            var pullRequestCommentLink__soy131 = require('stash/api/util/navbuilder').project(opt_data.pullRequest.toRef.repository.project.key).repo(opt_data.pullRequest.toRef.repository.slug).pullRequest(opt_data.pullRequest.id).overview().comment(opt_data.comment.id).withParams(opt_data.comment.id).build();
            output += '<a class="times" href="' + soy.$$escapeHtml(pullRequestCommentLink__soy131) + '">' + stash.feature.commentDate(opt_data) + '</a>';
        } else {
            output += '<span class="times">' + stash.feature.commentDate(opt_data) + '</span>';
        }
        output += '</li></ul><div class="extras">';
        var panelHtmlList144 = WebFragments.getWebPanels('internal.stash.comments.extra', {
            comment: opt_data.comment,
            pullRequest: opt_data.pullRequest
        }).map(function(webPanel) {
            return soydata.VERY_UNSAFE.ordainSanitizedHtml(webPanel);
        });
        var panelHtmlListLen144 = panelHtmlList144.length;
        for (var panelHtmlIndex144 = 0; panelHtmlIndex144 < panelHtmlListLen144; panelHtmlIndex144++) {
            var panelHtmlData144 = panelHtmlList144[panelHtmlIndex144];
            output += (panelHtmlIndex144 == 0) ? soy.$$escapeHtml(panelHtmlData144) : '';
        }
        output += '</div>';
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.commentContent.soyTemplateName = 'stash.feature.commentContent';
}

stash.feature.commentDate = function(opt_data, opt_ignored) {
    return '' + ((opt_data.comment.updatedDate - opt_data.comment.createdDate > 0) ? (require('util/time').format(opt_data.comment.createdDate, 'shortAge') != require('util/time').format(opt_data.comment.updatedDate, 'shortAge')) ? stash.feature.commentEditTimes({
        createdDateContent: '' + stash.widget.date.shortAge({
            date: opt_data.comment.createdDate
        }),
        updatedDateContent: '' + stash.widget.date.shortAge({
            date: opt_data.comment.updatedDate
        })
    }) : stash.widget.date.shortAge({
        date: opt_data.comment.createdDate,
        title: AJS.format("{0} (edited {1})", require('util/time').format(opt_data.comment.createdDate, 'full'), require('util/time').format(opt_data.comment.updatedDate, 'full'))
    }) : stash.widget.date.shortAge({
        date: opt_data.comment.createdDate
    }));
}
;
if (goog.DEBUG) {
    stash.feature.commentDate.soyTemplateName = 'stash.feature.commentDate';
}

stash.feature.commentEditTimes = function(opt_data, opt_ignored) {
    return '' + soy.$$filterNoAutoescape(AJS.format("{0} (edited {1})", opt_data.createdDateContent, opt_data.updatedDateContent));
}
;
if (goog.DEBUG) {
    stash.feature.commentEditTimes.soyTemplateName = 'stash.feature.commentEditTimes';
}

stash.feature.commentFormListItem = function(opt_data, opt_ignored) {
    return '<li class="comment-form-container' + ((opt_data.isHidden) ? ' hidden' : '') + '">' + stash.feature.commentForm({
        id: opt_data.id,
        version: opt_data.version,
        text: opt_data.text,
        tips: opt_data.tips,
        currentUser: opt_data.currentUser,
        extraClasses: opt_data.extraFormClasses
    }) + '</li>';
}
;
if (goog.DEBUG) {
    stash.feature.commentFormListItem.soyTemplateName = 'stash.feature.commentFormListItem';
}

stash.feature.commentForm = function(opt_data, opt_ignored) {
    return '<form' + ((opt_data.id) ? ' data-id="' + soy.$$escapeHtml(opt_data.id) + '" data-version="' + soy.$$escapeHtml(opt_data.version) + '"' : '') + ' class="new-comment-form' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '">' + stash.widget.avatar({
        size: 'medium',
        person: opt_data.currentUser
    }) + '<div class="content">' + ((opt_data.text) ? '<input name="old_text" type="hidden" value="' + soy.$$escapeHtml(opt_data.text) + '" />' : '') + stash.widget.markupEditor.editor({
        text: opt_data.text,
        placeholderText: "What do you want to say?",
        previewButtonTitle: "View a preview of this comment",
        attachmentButtonTitle: "Attach a file to this comment. You can also drag and drop a file to attach it.",
        attachmentButtonAccessibilityText: "Attach file"
    }) + '<div class="comment-form-footer"><div class="buttons">' + stash.buttons.button({
        buttonText: opt_data.id ? "Save" : "Comment"
    }) + widget.aui.form.cancelButton({
        href: '#'
    }) + '</div>' + ((opt_data.tips.length) ? stash.feature.commentFormTip(opt_data) : '') + '</div></div></form>';
}
;
if (goog.DEBUG) {
    stash.feature.commentForm.soyTemplateName = 'stash.feature.commentForm';
}

stash.feature.commentFormTip = function(opt_data, opt_ignored) {
    return '<div class="tip"><span class="tip-label">' + soy.$$escapeHtml("Tip:") + ' </span>' + soy.$$filterNoAutoescape(opt_data.tips[Math.floor(Math.random() * opt_data.tips.length)]) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.commentFormTip.soyTemplateName = 'stash.feature.commentFormTip';
}

stash.feature.addCommentTrigger = function(opt_data, opt_ignored) {
    return '<button class="add-comment-trigger" title="' + soy.$$escapeHtml("Add a comment on this line.") + '">' + aui.icons.icon({
        useIconFont: true,
        icon: 'comment',
        accessibilityText: "This line has a comment."
    }) + aui.icons.icon({
        useIconFont: true,
        icon: 'add-comment',
        accessibilityText: "Add a comment on this line."
    }) + '</button>';
}
;
if (goog.DEBUG) {
    stash.feature.addCommentTrigger.soyTemplateName = 'stash.feature.addCommentTrigger';
}

stash.feature.dummyCommentTrigger = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    var output = '';
    var changeLocation__soy249 = opt_data.relevantContextLines ? AJS.format("Comments can only be added within {0} lines of a change", opt_data.relevantContextLines) : "Comments can only be added near a change";
    output += '<div class="dummy-comment-trigger" title="' + soy.$$escapeHtml(changeLocation__soy249) + '" ></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.dummyCommentTrigger.soyTemplateName = 'stash.feature.dummyCommentTrigger';
}

stash.feature.fileComments = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="file-comments">' + ((opt_data.comments && opt_data.comments.length > 0) ? stash.feature.comments(opt_data) : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileComments.soyTemplateName = 'stash.feature.fileComments';
}

stash.feature.commentCount = function(opt_data, opt_ignored) {
    return '<span class="comment-count" title="' + soy.$$escapeHtml(AJS.format("{0} {0,choice,1#comment|1\x3ccomments}", parseInt(opt_data.count))) + '">' + aui.icons.icon({
        icon: 'comment',
        size: 'small',
        useIconFont: true,
        accessibilityText: AJS.format("{0} {0,choice,1#comment|1\x3ccomments}", parseInt(opt_data.count))
    }) + soy.$$escapeHtml(require('util/text').capInt(opt_data.count, 99)) + '</span>';
}
;
if (goog.DEBUG) {
    stash.feature.commentCount.soyTemplateName = 'stash.feature.commentCount';
}

stash.feature.commentAsyncWebPanelPlaceholder = function(opt_data, opt_ignored) {
    return '<div id="async-web-panel-' + soy.$$escapeHtml(opt_data.webPanelId) + '"></div>';
}
;
if (goog.DEBUG) {
    stash.feature.commentAsyncWebPanelPlaceholder.soyTemplateName = 'stash.feature.commentAsyncWebPanelPlaceholder';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/diff-comment-context.js' */
(function() {
    var A = require("util/bacon").keyboardEvents("requestTertiaryNext");
    var B = require("util/bacon").keyboardEvents("requestTertiaryPrevious");
    define("feature/comments/diff-comment-context", ["jquery", "lodash", "util/events", "util/function", "model/direction", "feature/comments/anchors", "feature/comments/comment-collection", "feature/comments/comment-context", "feature/comments/diff-comment-container", "feature/file-content/diff-view-file-types", "feature/file-content/diff-view-options", "feature/file-content/diff-view-segment-types"], function(I, M, O, L, D, C, F, G, N, J, H, K) {
        var E = C.LineAnchor;
        return G.extend({
            events: {
                "click .add-comment-trigger": "addCommentClicked",
                "mouseenter .dummy-comment-trigger, .add-comment-trigger": "initTooltip"
            },
            initialize: function() {
                this._destroyables = [];
                M.bindAll(this, "onDiffChange", "onFileCommentsResized", "onCommentContainerDestroyed", "onDiffViewOptionsChange");
                this._initFileCommentButton = this._initFileCommentButton.bind(this, this.options.$toolbar);
                this._destroyables.push(O.chain().once("stash.feature.fileContent.requestHandled", this._initFileCommentButton));
                this.setDiffView(this.options.diffView);
                this._dvOptions = this.options.diffViewOptions || H;
                this._commentsById = this.options.lineComments && M.indexBy(this.options.lineComments, L.dot("id"));
                this.$el.toggleClass("commentable", this.options.allowCommenting);
                this.toggleComments(!this._dvOptions.get("hideComments"));
                this._dvOptions.on("change", this.onDiffViewOptionsChange);
                O.on("stash.comment.commentContainerDestroyed", this.onCommentContainerDestroyed);
                this.renderFileComments();
                G.prototype.initialize.apply(this, arguments);
                var P = this._getFileCommentContainer();
                if (P) {
                    this._initializeFileCommentContainer(P)
                }
            },
            _initFileCommentButton: function(P) {
                P.find(".add-file-comment-trigger").on("click", this.addFileCommentClicked.bind(this)).tooltip({
                    gravity: "ne"
                })
            },
            _initializeFileCommentContainer: function(P) {
                P.on("resize", this.onFileCommentsResized)
            },
            _getFileCommentContainer: function() {
                var Q = this.options.anchor;
                var P = Q.getId();
                if (this.includesContainer(P)) {
                    return this._containers[P]
                }
            },
            _registerContainer: function(Q, R, P) {
                this._containers[Q] = new N({
                    anchor: P,
                    context: this,
                    el: R,
                    name: Q
                });
                return this._containers[Q]
            },
            addFileCommentClicked: function() {
                this.forceShowingComments();
                var P = this.addCommentContainerForFile();
                P.openNewCommentForm()
            },
            initTooltip: function(Q) {
                var P = I(Q.currentTarget);
                if (P.data("tooltip-inited")) {
                    return
                }
                P.data("tooltip-inited", true);
                P.tooltip({
                    gravity: "w",
                    delayOut: 200
                }).trigger("mouseenter")
            },
            addCommentClicked: function(R) {
                R.preventDefault();
                this.forceShowingComments();
                var Q = I(R.target).closest(".line");
                var P = this.addCommentContainerForLine(Q);
                P.openNewCommentForm()
            },
            forceShowingComments: function() {
                if (this._dvOptions.get("hideComments")) {
                    this._dvOptions.set("hideComments", false)
                }
            },
            addCommentContainerForFile: function() {
                var Q = this._getFileCommentContainer();
                if (Q) {
                    return Q
                }
                var P = I(stash.feature.comments(this.options.anchor.toJSON()));
                P.appendTo(this.$(".file-comments"));
                this.registerContainer(P[0], this.options.anchor);
                Q = this._getFileCommentContainer();
                this._initializeFileCommentContainer(Q);
                return Q
            },
            addCommentContainerForLine: function(T, P) {
                var S = this.getLineAnchor(T);
                var R = T.lineType ? T : this.diffView.getLineHandle(T);
                var Q = S.getId();
                if (!this.includesContainer(Q)) {
                    this._containers[Q] = new N({
                        anchor: S,
                        collection: P ? new F(P,{
                            anchor: S
                        }) : undefined,
                        context: this,
                        lineHandle: R,
                        name: Q,
                        showComments: !this._dvOptions.get("hideComments")
                    })
                }
                return this._containers[Q]
            },
            destroy: function(P) {
                if (!P) {
                    if (this.diffView) {
                        this.diffView.off("change", this.onDiffChange)
                    }
                    this.$el.removeClass("commentable");
                    this._dvOptions.off("change", this.onDiffViewOptionsChange);
                    this._dvOptions = null;
                    O.off("stash.comment.commentContainerDestroyed", this.onCommentContainerDestroyed);
                    M.invoke(this._destroyables, "destroy");
                    this._destroyables = null
                }
                G.prototype.destroy.apply(this, arguments)
            },
            findContainerElements: function() {
                return this.$(".line .comment-box, .file-comments > .comment-container")
            },
            getAnchor: function(P) {
                if (I(P).closest(".file-comments").length) {
                    return this.options.anchor
                }
                return this.getLineAnchor(I(P).closest(".line"))
            },
            getGutterId: function() {
                return this.options.allowCommenting ? "add-comment-trigger" : null
            },
            getLineAnchor: function(Q) {
                var P = Q.lineType ? Q : this.diffView.getLineHandle(Q);
                return new E(this.options.anchor,P.lineType,P.lineNumber,P.fileType)
            },
            renderFileComments: function() {
                var P = this.options.anchor.toJSON().commitRange;
                this.$el.prepend(stash.feature.fileComments({
                    comments: this.options.fileComments,
                    commitRange: P
                }))
            },
            addAnchoredComments: function() {
                var P = this;
                var S = this.diffView;
                var R = this.options.lineComments;
                if (R && R[0] && !R[0].anchor) {
                    return
                }
                function Q(T) {
                    return M.chain(T).filter(function(U) {
                        return !!(U.anchor && U.anchor.line)
                    }).groupBy(function(U) {
                        return (U.anchor.fileType || "") + U.anchor.line
                    }).value()
                }
                M.forEach(Q(R), function(T) {
                    var U = T[0].anchor;
                    var V = S.getLineHandle({
                        fileType: U.fileType,
                        lineType: U.lineType,
                        lineNumber: U.line
                    });
                    if (V) {
                        P.addCommentContainerForLine(V, T)
                    }
                })
            },
            onFileCommentsResized: function() {
                this.trigger("fileCommentsResized")
            },
            onDiffChange: function(R) {
                if (R.type !== "INITIAL" && R.type !== "INSERT") {
                    return
                }
                if (R.type === "INITIAL") {
                    this.addAnchoredComments()
                }
                var Q = this.diffView;
                var P = this;
                R.eachLine(function(W) {
                    var U = W.line;
                    var V;
                    var S = !W.attributes.expanded && W.line.conflictMarker !== "MARKER";
                    if (S && (P.options.allowCommenting && R.type === "INITIAL")) {
                        V = stash.feature.addCommentTrigger()
                    } else {
                        V = stash.feature.dummyCommentTrigger({
                            relevantContextLines: P.options.relevantContextLines
                        })
                    }
                    if (W.handles.FROM) {
                        Q.setGutterMarker(W.handles.FROM, P.getGutterId(), I(V)[0])
                    }
                    if (W.handles.TO && W.handles.FROM !== W.handles.TO) {
                        Q.setGutterMarker(W.handles.TO, P.getGutterId(), I(V)[0])
                    }
                    if (U.commentIds) {
                        var T = M.chain(U.commentIds).map(L.lookup(P._commentsById)).filter(M.identity).value();
                        if (T.length) {
                            P.addCommentContainerForLine(W.handles.FROM || W.handles.TO, T)
                        }
                    }
                    if (P.unrestoredDrafts.length && R.type === "INITIAL") {
                        M.chain(W.handles).values().compact().uniq().forEach(P.restoreDraftsForLine.bind(P)).value()
                    }
                })
            },
            onCommentContainerDestroyed: function(P) {
                var Q = this._getFileCommentContainer();
                if (Q && P === Q.$el) {
                    M.defer(this.onFileCommentsResized.bind(this))
                }
            },
            onDiffViewOptionsChange: function(P) {
                if (P.key === "hideComments") {
                    this.toggleComments(!P.value)
                }
            },
            restoreDraftsForLine: function(Q) {
                var S = I.extend({
                    line: Q.lineNumber,
                    lineType: Q.lineType
                }, {
                    fileType: Q.fileType
                });
                var R = this.getUnrestoredDraftsForLine(S);
                if (R.length) {
                    var P = this.addCommentContainerForLine(Q);
                    this._restoreDraftsToContainer(P, R);
                    P.destroyIfEmpty()
                }
            },
            _restoreDraftsToContainer: function(P, Q) {
                M.forEach(Q, P.restoreDraftComment.bind(P));
                this.unrestoredDrafts = M.difference(this.unrestoredDrafts, Q)
            },
            restoreDrafts: function() {
                var P = this;
                if (!this.options.allowCommenting) {
                    this.unrestoredDrafts = M.filter(this.unrestoredDrafts, function(Q) {
                        return (Q.id || Q.parent) && (P.$el.is(".file-comment-activity") || Q.anchor.line)
                    })
                }
                this.restoreDraftFileComments()
            },
            restoreDraftFileComments: function() {
                var P = M.reject(this.unrestoredDrafts, L.dot("anchor.line"));
                if (P.length) {
                    this._restoreDraftsToContainer(this.addCommentContainerForFile(), P)
                }
            },
            getUnrestoredDraftsForLine: function(R) {
                var Q = M.compose(L.partialRight(M.omit, "path", "srcPath"), this.unifyAnchorFileTypes);
                var S = M.isEqual.bind(M, Q(R));
                var P = M.compose(S, Q, L.dot("anchor"));
                return M.filter(this.unrestoredDrafts, P)
            },
            unifyAnchorFileTypes: function(Q) {
                var R = ((Q.lineType === K.CONTEXT || Q.lineType === K.REMOVED) && Q.fileType === J.FROM);
                var P = (Q.lineType === K.ADDED && Q.fileType === J.TO);
                if (R || P) {
                    return M.omit(Q, "fileType")
                }
                return Q
            },
            clarifyAmbiguousDraftProps: function(Q) {
                var P = G.prototype.clarifyAmbiguousDraftProps.call(this, Q);
                P.anchor = this.unifyAnchorFileTypes(P.anchor);
                return P
            },
            setDiffView: function(P) {
                if (this.diffView) {
                    this.diffView.off("internal-change", this.onDiffChange)
                }
                this.diffView = P;
                if (P) {
                    this.diffView.on("internal-change", this.onDiffChange);
                    this._destroyables.push({
                        destroy: A.onValue(P._scrollToComment.bind(P, D.DOWN))
                    });
                    this._destroyables.push({
                        destroy: B.onValue(P._scrollToComment.bind(P, D.UP))
                    })
                }
            },
            toggleComments: function(P) {
                this.$el.toggleClass("hide-comments", !P);
                M.invoke(this._containers, "toggleComment", P)
            }
        })
    })
}());
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-model.js' */
define("feature/comments/comment-model", ["aui", "backbone", "backbone-brace", "lodash", "stash/api/util/navbuilder"], function(A, F, C, B, E) {
    var D = C.Model.extend({
        namedAttributes: {
            anchor: null,
            attributes: null,
            author: null,
            avatarSize: null,
            comments: null,
            tasks: null,
            createdDate: "number",
            html: "string",
            id: "number",
            isFocused: "boolean",
            isUnread: "boolean",
            parent: null,
            permittedOperations: null,
            properties: null,
            text: "string",
            updatedDate: "number",
            version: "number"
        },
        validate: function(G) {
            if (!G.text || !/\S/.test(G.text)) {
                return "Please enter some text"
            }
        },
        url: function() {
            var I = E.parse(C.Model.prototype.url.apply(this, arguments));
            var G = this.get("anchor");
            if (G && G.commitRange) {
                var H = G.commitRange.sinceRevision;
                if (H) {
                    I.addQueryParam("since", H.id)
                }
            }
            I.addQueryParam("version", this.get("version")).addQueryParam("avatarSize", this.get("avatarSize")).addQueryParam("markup", true);
            return I.toString()
        },
        forEachCommentInThread: function(G) {
            G(this);
            B.each(this.get("comments"), function(H) {
                H.forEachCommentInThread(G)
            })
        },
        sync: function(I, H, G) {
            return F.sync(I, H, B.extend(G, {
                statusCode: {
                    "404": function(O, J, N, L, M) {
                        var K = L && L.errors && L.errors.length && L.errors[0];
                        if (K && K.message && /comment/i.test(K.message)) {
                            if (I === "create" && H.get("parent") != null) {
                                return {
                                    title: "Comment not found",
                                    message: "The comment you are replying to no longer exists.",
                                    shouldReload: true,
                                    fallbackUrl: undefined
                                }
                            } else {
                                if (I === "update") {
                                    return {
                                        title: "Comment not found",
                                        message: "The comment you are updating no longer exists.",
                                        shouldReload: true,
                                        fallbackUrl: undefined
                                    }
                                }
                            }
                        }
                    }
                }
            }))
        }
    });
    C.Mixins.applyMixin(D, {
        namedAttributes: {
            comments: [D]
        }
    });
    return D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-async-web-panel.js' */
define("feature/comments/comment-async-web-panel", ["jquery", "stash/api/util/events", "util/promise", "exports"], function(F, G, C, B) {
    var A = [document.documentElement];
    G.on("stash.page.pull-request.view.contextRequested", function() {
        A = [document.documentElement]
    });
    G.on("stash.feature.comments.commentContainerAdded", function(H) {
        A.push(H[0])
    });
    var E = 0;
    function D(I) {
        E++;
        var H = "#async-web-panel-" + E;
        C.waitFor({
            predicate: function() {
                var J = F(H, A);
                return J.length ? J : false
            },
            name: "Async web panel " + E,
            interval: 50
        }).then(I);
        return stash.feature.commentAsyncWebPanelPlaceholder({
            webPanelId: E
        })
    }
    B.getWebPanelEl = D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/diff-comment-container.js' */
define("feature/comments/diff-comment-container", ["jquery", "lodash", "util/events", "util/function", "feature/comments/comment-container"], function(E, A, B, C, D) {
    var F;
    B.on("memoir.changestate", function() {
        F = null
    });
    return D.extend({
        rootCommentListSelector: ".comment-list",
        initialize: function() {
            A.bindAll(this, "onResize", "onWebPanelResize");
            if (!this.$el.is(".comment-container")) {
                this.setElement(E(stash.feature.comments(E.extend({
                    extraClasses: "comment-box",
                    comments: this.options.collection && this.options.collection.toJSON()
                }, this.options.anchor.toJSON())))[0])
            }
            if (!this.isFileCommentContainer() && this.options.context.diffView) {
                this.toggleComment(this.options.showComments);
                this.options.context.diffView.addLineClass(this.options.lineHandle, "wrap", "commented")
            }
            this.on("change", this.onResize);
            this.on("comment.saved", this.scrollIntoView);
            B.on("stash.webpanel.resize", this.onWebPanelResize);
            D.prototype.initialize.apply(this, arguments)
        },
        closeCommentForm: function(H, I) {
            if (!I || !I.doNotDestroy) {
                var G = H.parent().parent();
                if (G.is(this.rootCommentListSelector) && G.children(".comment").length === 0) {
                    this.deleteDraftComment(this.getDraftCommentFromForm(H));
                    this._unbindMarkupEditor(H);
                    return this.destroy()
                }
            }
            return D.prototype.closeCommentForm.apply(this, arguments)
        },
        destroyIfEmpty: function() {
            var G = this.$(this.rootCommentListSelector);
            if (G.children(".comment").length === 0 && !G.find("textarea").val()) {
                this.destroy()
            }
        },
        destroy: function(G) {
            D.prototype.destroy.apply(this, arguments);
            F = null;
            if (this._widget) {
                this._widget.clear();
                this._widget = null
            }
            this.off("change", this.onResize);
            if (this.options.lineHandle) {
                this.options.context.diffView.removeLineClass(this.options.lineHandle, "wrap", "commented")
            }
            B.trigger("stash.comment.commentContainerDestroyed", null, this.$el);
            this.context.destroy(this, G)
        },
        focusCommentForm: C.lazyDefer(function(G) {
            this.scrollToComment(G);
            var H = G.find("textarea");
            if (this.isFileCommentContainer()) {
                setTimeout(H.focus.bind(H), 100)
            } else {
                H.focus()
            }
        }),
        onCommentDeleted: function() {
            this.destroyIfEmpty()
        },
        onCommentEditorResize: function() {
            this.onResize()
        },
        onWebPanelResize: function(G) {
            if (G.location === "internal.stash.comments.extra" && E.contains(this.$el.get(0), G.el)) {
                this.onResize()
            }
        },
        onResize: function() {
            if (this._widget) {
                this._widget.changed()
            }
            this.trigger("resize")
        },
        isFileCommentContainer: function() {
            return !!this.$el.closest(".file-comments").length
        },
        isActivityCommentContainer: function() {
            return !!this.$el.closest(".activity-item").length
        },
        scrollToComment: function(G) {
            if (!this.isActivityCommentContainer()) {
                var H = G.offset().top - this.$el.offset().top;
                if (this.isFileCommentContainer()) {
                    if (this.options.context.diffView) {
                        this.options.context.diffView.scrollToFileComments(H, G.height())
                    }
                } else {
                    this.options.context.diffView.scrollToWidgetOffset(this.options.lineHandle, H, G.height())
                }
            }
        },
        toggleComment: function(G) {
            if (this.isFileCommentContainer()) {
                this.options.context.trigger("fileCommentsResized")
            } else {
                if (G && !this._widget) {
                    this._widget = this.options.context.diffView.addLineWidget(this.options.lineHandle, this.el, {
                        noHScroll: true,
                        coverGutter: true,
                        insertAt: 0
                    });
                    var H = A.throttle(function() {
                        var I = this.getHeight();
                        if (this._previousHeight !== I) {
                            this.changed();
                            this._previousHeight = I
                        }
                    }, 200);
                    this._widget.onRedraw(H.bind(this._widget))
                } else {
                    if (!G && this._widget) {
                        this._widget.clear();
                        this._widget = null;
                        this.el.parentElement.removeChild(this.el)
                    }
                }
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/activity-comment-container.js' */
define("feature/comments/activity-comment-container", ["jquery", "lodash", "util/events", "feature/comments/comment-container"], function(D, A, B, C) {
    return C.extend({
        initialize: function() {
            C.prototype.initialize.apply(this, arguments)
        },
        rootCommentListSelector: ".pull-request-activity",
        events: A.extend({}, C.prototype.events, {
            "focus .general-comment-form textarea": "onGeneralFormTextareaFocused"
        }),
        initDeleteButtons: function() {
            this.createDeleteDialog().attachTo(".general-comment-activity .delete", null, this.el)
        },
        insertCommentIntoList: function(G, E, H) {
            if (E.is(this.rootCommentListSelector)) {
                var F = E.children(":first");
                G.insertAfter(F)
            } else {
                C.prototype.insertCommentIntoList.apply(this, arguments)
            }
        },
        closeCommentForm: function(E) {
            E.find(".error").remove();
            if (E.is(".general-comment-form")) {
                this._unbindMarkupEditor(E);
                E.addClass("collapsed");
                E.find("textarea").val("").removeClass("restored").removeAttr("title").blur();
                this.deleteDraftComment(this.getDraftCommentFromForm(E))
            } else {
                C.prototype.closeCommentForm.apply(this, arguments)
            }
        },
        getExtraCommentClasses: function() {
            return "general-comment-activity"
        },
        onGeneralFormTextareaFocused: function(F) {
            var E = D(F.target).closest(".general-comment-form");
            if (E.hasClass("collapsed")) {
                this._bindMarkupEditor(E);
                E.removeClass("collapsed")
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comment-context.js' */
define("feature/comments/comment-context", ["backbone", "jquery", "lodash", "util/client-storage", "util/events", "feature/comments/comment-container"], function(F, E, B, A, C, D) {
    return F.View.extend({
        initialize: function() {
            this._containers = {};
            this.checkForNewContainers();
            var G = this;
            C.on("stash.feature.comments.commentAdded", this._commentAddedHandler = function(I, J) {
                if (G.$el.find(J).length && G.$el.find(".comment").length === 1) {
                    C.trigger("stash.feature.comments.firstCommentAdded", null, G.$el)
                }
            }
            );
            var H = this.getDrafts() || [];
            this.unrestoredDrafts = this.drafts = B.isArray(H) ? H : [H];
            this.restoreDrafts()
        },
        includesContainer: function(G) {
            return B.has(this._containers, G)
        },
        registerContainer: function(I, H) {
            var G = H.getId();
            if (!this.includesContainer(G)) {
                this._registerContainer(G, I, H)
            }
        },
        _registerContainer: function(H, I, G) {
            this._containers[H] = new D({
                name: H,
                context: this,
                el: I,
                anchor: G
            });
            return this._containers[H]
        },
        checkForNewContainers: function() {
            var G = this;
            B.forEach(this.findContainerElements(), function(H) {
                G.registerContainer(H, G.getAnchor(H))
            })
        },
        findContainerElements: function() {
            return this.$(".comment-container")
        },
        getAnchor: function() {
            return this.options.anchor
        },
        clarifyAmbiguousDraftProps: function(G) {
            return B.omit(G, "text")
        },
        deleteDraftComment: function(G, I) {
            I = B.isBoolean(I) ? I : true;
            var H = B.isEqual.bind(B, this.clarifyAmbiguousDraftProps(G));
            this.drafts = B.reject(this.drafts, B.compose(H, this.clarifyAmbiguousDraftProps.bind(this)));
            if (I) {
                this.saveDraftComments()
            }
        },
        getDrafts: function() {
            return A.getSessionItem(this.getDraftsKey())
        },
        getDraftsKey: function() {
            return A.buildKey(["draft-comment", this.options.anchor.getId()], "user")
        },
        restoreDrafts: E.noop,
        saveDraftComment: function(G) {
            this.deleteDraftComment(G, false);
            G.text && this.drafts.push(G);
            this.saveDraftComments()
        },
        saveDraftComments: function() {
            A.setSessionItem(this.getDraftsKey(), this.drafts)
        },
        destroy: function(G, H) {
            if (G) {
                G.remove();
                delete this._containers[G.options.name];
                if (!this.$el.has(".comment").length && !H) {
                    C.trigger("stash.feature.comments.lastCommentDeleted", null, this.$el)
                }
            } else {
                H = true;
                B.invoke(this._containers, "destroy", H);
                this._containers = null;
                if (this._commentAddedHandler) {
                    C.off("stash.feature.comments.commentAdded", this._commentAddedHandler);
                    delete this._commentAddedHandler
                }
            }
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:comments', location = '/static/feature/comments/comments.js' */
define("feature/comments", ["jquery", "feature/comments/activity-comment-context", "feature/comments/anchors", "feature/comments/comment-tips", "feature/comments/diff-comment-context"], function(E, A, D, F, C) {
    var B = {
        CREATE_NEW: "create-new",
        REPLY_ONLY: "reply-only",
        READ: "read",
        NONE: "none"
    };
    return E.extend({
        bindContext: function(L, H, G) {
            if (L.data("comment-context")) {
                throw new Error("Duplicate comment context registered.")
            }
            var K = G && (G.commentMode === B.READ || G.commentMode === B.CREATE_NEW || G.commentMode === B.REPLY_ONLY);
            var J = G && G.commentMode === B.CREATE_NEW;
            G = E.extend({
                el: L[0],
                anchor: H,
                allowCommenting: J,
                showComments: K
            }, G);
            var I = H instanceof D.DiffAnchor ? new C(G) : new A(G);
            L.data("comment-context", I);
            return I
        },
        updateContext: function(H) {
            var G = H.data("comment-context");
            if (G) {
                G.checkForNewContainers()
            }
        },
        unbindContext: function(H) {
            var G = H.data("comment-context");
            if (G) {
                G.destroy()
            }
        },
        commentMode: B
    }, D, F)
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:commits-table', location = '/static/feature/commits/commits-table-clientside.soy' */
// This file was automatically generated from commits-table-clientside.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.commits.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.commits == 'undefined') {
    stash.feature.commits = {};
}

stash.feature.commits.commitsTableImpl = function(opt_data, opt_ignored) {
    var param13 = '';
    if (opt_data.changesetPage) {
        var changesetList16 = opt_data.changesetPage.values;
        var changesetListLen16 = changesetList16.length;
        for (var changesetIndex16 = 0; changesetIndex16 < changesetListLen16; changesetIndex16++) {
            var changesetData16 = changesetList16[changesetIndex16];
            param13 += stash.feature.commits.commitsTableRow({
                changeset: changesetData16,
                cellsContent: '' + stash.feature.commits.commitsTableCells({
                    repository: opt_data.repository,
                    changeset: changesetData16,
                    webSections: opt_data.webSections
                })
            });
        }
    }
    var output = '' + stash.widget.pagedTable({
        id: opt_data.tableId,
        page: opt_data.changesetPage,
        extraClasses: 'commits-table' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        theadContent: '' + ((opt_data.changesetPage && (opt_data.changesetPage.size > 0 || opt_data.changesetPage.start > 0) || !opt_data.changesetPage) ? '<tr>' + stash.feature.commits.commitsTableHeaderCells(opt_data) + '</tr>' : ''),
        content: param13
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.commits.commitsTableImpl.soyTemplateName = 'stash.feature.commits.commitsTableImpl';
}

stash.feature.commits.commitsTableHeaderCells = function(opt_data, opt_ignored) {
    var output = '<th class="author" title="' + soy.$$escapeHtml("Author") + '" scope="col">' + soy.$$escapeHtml("Author") + '</th><th class="changeset" title="' + soy.$$escapeHtml("Commit") + '" scope="col">' + soy.$$escapeHtml("Commit") + '</th><th class="message" title="' + soy.$$escapeHtml("Message") + '" scope="col">' + soy.$$escapeHtml("Message") + '</th><th class="comment-count" scope="col"></th><th class="timestamp" title="' + soy.$$escapeHtml("Commit Date") + '" scope="col">' + soy.$$escapeHtml("Commit Date") + '</th>';
    if (opt_data.webSections) {
        var webSectionList46 = opt_data.webSections;
        var webSectionListLen46 = webSectionList46.length;
        for (var webSectionIndex46 = 0; webSectionIndex46 < webSectionListLen46; webSectionIndex46++) {
            var webSectionData46 = webSectionList46[webSectionIndex46];
            output += '<th class="' + soy.$$escapeHtml(webSectionData46.key) + '" title="' + soy.$$escapeHtml(webSectionData46.labelText) + '" scope="col">' + soy.$$escapeHtml(webSectionData46.labelText) + '</th>';
        }
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.commits.commitsTableHeaderCells.soyTemplateName = 'stash.feature.commits.commitsTableHeaderCells';
}

stash.feature.commits.commitsTableRow = function(opt_data, opt_ignored) {
    return '<tr data-changesetid="' + soy.$$escapeHtml(opt_data.changeset.id) + '" class="commit-row ' + ((opt_data.changeset.parents.length >= 2) ? 'merge' : '') + '">' + soy.$$filterNoAutoescape(opt_data.cellsContent) + '</tr>';
}
;
if (goog.DEBUG) {
    stash.feature.commits.commitsTableRow.soyTemplateName = 'stash.feature.commits.commitsTableRow';
}

stash.feature.commits.commitsTableCells = function(opt_data, opt_ignored) {
    var output = '<td class="author">' + stash.widget.avatarWithName({
        size: 'small',
        person: opt_data.changeset.author,
        link: true,
        linkExtraClasses: 'secondary-link'
    }) + '</td><td class="changeset">' + stash.feature.changeset.link(opt_data) + '<!-- show merge lozenge/icon if is a merge commit, eg has 2+ parents -->' + ((opt_data.changeset.parents.length >= 2) ? stash.widget.lozenge.merge({
        abbreviated: true
    }) : '') + '</td><td class="message">';
    var parsedCommitMessage__soy83 = require('util/parse-commit-message').splitIntoSubjectAndBody(opt_data.changeset.message);
    output += '<span class="message-subject" title="' + soy.$$escapeHtml(soy.$$truncate(opt_data.changeset.message, 800, true)) + '">' + soy.$$escapeHtml(soy.$$truncate(parsedCommitMessage__soy83.subject, 400, true)) + '</span><span class="message-body" title="' + soy.$$escapeHtml(soy.$$truncate(opt_data.changeset.message, 800, true)) + '">' + soy.$$escapeHtml(soy.$$truncate(parsedCommitMessage__soy83.body, 400, true)) + '</span></td><td class="comment-count">';
    if (opt_data.changeset.attributes && opt_data.changeset.attributes.commentCount) {
        var countList103 = opt_data.changeset.attributes.commentCount;
        var countListLen103 = countList103.length;
        for (var countIndex103 = 0; countIndex103 < countListLen103; countIndex103++) {
            var countData103 = countList103[countIndex103];
            output += stash.feature.commentCount({
                count: countData103
            });
        }
    }
    output += '</td><td class="timestamp">' + stash.widget.date.shortAge({
        date: opt_data.changeset.authorTimestamp
    }) + '</td>' + ((opt_data.webSections) ? stash.feature.commits.commitsRowExtras(opt_data) : '');
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.commits.commitsTableCells.soyTemplateName = 'stash.feature.commits.commitsTableCells';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:commits-table', location = '/static/feature/commits/commits-table.js' */
define("feature/commits/commits-table", ["aui", "jquery", "lodash", "util/events", "widget/paged-table"], function(A, E, B, C, D) {
    function F(H, G) {
        this.getCommitsUrlBuilder = H;
        var I = {
            target: "#commits-table",
            ajaxDataType: "html",
            tableMessageClass: "commits-table-message",
            allFetchedMessageHtml: '<p class="no-more-results">' + A.escapeHtml("No more history") + "</p>",
            noneFoundMessageHtml: '<h3 class="no-results entity-empty">' + A.escapeHtml("No history found") + "</h3>",
            paginationContext: "commits-table"
        };
        G = E.extend({}, I, G);
        D.call(this, G);
        this.$spinner.addClass("commits-table-spinner");
        this._destroyables = []
    }
    E.extend(F.prototype, D.prototype);
    F.prototype.buildUrl = function(H, G) {
        return this.getCommitsUrlBuilder().withParams({
            start: H,
            limit: G,
            contents: ""
        }).build()
    }
    ;
    F.prototype.onDataLoaded = function(I, G, H) {
        if (typeof H === "string") {
            H = this.createDataFromJQuery(I, G, E(H))
        }
        return D.prototype.onDataLoaded.call(this, I, G, H)
    }
    ;
    F.prototype.attachNewContent = function(H, G) {
        D.prototype.attachNewContent.call(this, H, G);
        C.trigger("stash.widget.commitsTable.contentAdded", this, H)
    }
    ;
    F.prototype.handleNewRows = function(H, G) {
        this.$table.show().children("tbody")[G !== "html" ? G : "append"](H.values)
    }
    ;
    F.prototype.focusInitialRow = function() {
        this.$table.find("tbody tr.commit-row:first").addClass("focused-commit")
    }
    ;
    F.prototype.bindKeyboardShortcuts = function() {
        var H = this
          , K = this.$table.selector
          , G = false
          , I = {
            focusedClass: "focused-commit",
            wrapAround: false,
            escToCancel: false
        }
          , L = K + " .commit-row." + I.focusedClass
          , J = L + ", " + K + ".show-merges .commit-row, " + K + ":not(.show-merges) .commit-row:not(.merge)";
        this._onDisableOpenItemHandler = function() {
            G = true
        }
        ;
        this._onEnableOpenItemHandler = function() {
            G = false
        }
        ;
        this.bindMoveToNextHandler = function(M) {
            (this.moveToNextItem ? this : A.whenIType(M)).moveToNextItem(J, I).execute(function() {
                if (E(J).last().hasClass(I.focusedClass)) {
                    window.scrollTo(0, document.documentElement.scrollHeight)
                }
            })
        }
        ;
        this.bindMoveToPreviousHandler = function(M) {
            (this.moveToPrevItem ? this : A.whenIType(M)).moveToPrevItem(J, I)
        }
        ;
        this.bindOpenItemHandler = function(M) {
            (this.execute ? this : A.whenIType(M)).execute(function() {
                if (!G) {
                    var N = jQuery(L);
                    if (N.length) {
                        window.location.href = N.find("td.changeset a").attr("href")
                    }
                }
            })
        }
        ;
        this.bindToggleMergesHandler = function(M) {
            (this.execute ? this : A.whenIType(M)).execute(function() {
                H.$table.toggleClass("show-merges")
            })
        }
        ;
        this._destroyables.push(C.chain().on("stash.keyboard.shortcuts.requestMoveToNextHandler", this.bindMoveToNextHandler).on("stash.keyboard.shortcuts.requestMoveToPreviousHandler", this.bindMoveToPreviousHandler).on("stash.keyboard.shortcuts.requestOpenItemHandler", this.bindOpenItemHandler).on("stash.keyboard.shortcuts.requestToggleMergesHandler", this.bindToggleMergesHandler).on("stash.keyboard.shortcuts.disableOpenItemHandler", this._onDisableOpenItemHandler).on("stash.keyboard.shortcuts.enableOpenItemHandler", this._onEnableOpenItemHandler));
        this._destroyables.push(D.prototype.initShortcuts.call(this))
    }
    ;
    F.prototype.destroy = function() {
        D.prototype.destroy.call(this);
        B.invoke(this._destroyables, "destroy")
    }
    ;
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:jstree', location = '/static/bower/jstree/jquery.jstree.js' */
(function() {
    if (jQuery && jQuery.jstree) {
        return
    }
    var C = false
      , B = false
      , A = false;
    (function(G) {
        G.vakata = {};
        G.vakata.css = {
            get_css: function(M, J, K) {
                M = M.toLowerCase();
                var L = K.cssRules || K.rules
                  , I = 0;
                do {
                    if (L.length && I > L.length + 5) {
                        return false
                    }
                    if (L[I].selectorText && L[I].selectorText.toLowerCase() == M) {
                        if (J === true) {
                            if (K.removeRule) {
                                K.removeRule(I)
                            }
                            if (K.deleteRule) {
                                K.deleteRule(I)
                            }
                            return true
                        } else {
                            return L[I]
                        }
                    }
                } while (L[++I]);return false
            },
            add_css: function(J, I) {
                if (G.jstree.css.get_css(J, false, I)) {
                    return false
                }
                if (I.insertRule) {
                    I.insertRule(J + " { }", 0)
                } else {
                    I.addRule(J, null, 0)
                }
                return G.vakata.css.get_css(J)
            },
            remove_css: function(J, I) {
                return G.vakata.css.get_css(J, true, I)
            },
            add_sheet: function(J) {
                var I = false
                  , L = true;
                if (J.str) {
                    if (J.title) {
                        I = G("style[id='" + J.title + "-stylesheet']")[0]
                    }
                    if (I) {
                        L = false
                    } else {
                        I = document.createElement("style");
                        I.setAttribute("type", "text/css");
                        if (J.title) {
                            I.setAttribute("id", J.title + "-stylesheet")
                        }
                    }
                    if (I.styleSheet) {
                        if (L) {
                            document.getElementsByTagName("head")[0].appendChild(I);
                            I.styleSheet.cssText = J.str
                        } else {
                            I.styleSheet.cssText = I.styleSheet.cssText + " " + J.str
                        }
                    } else {
                        I.appendChild(document.createTextNode(J.str));
                        document.getElementsByTagName("head")[0].appendChild(I)
                    }
                    return I.sheet || I.styleSheet
                }
                if (J.url) {
                    if (document.createStyleSheet) {
                        try {
                            I = document.createStyleSheet(J.url)
                        } catch (K) {}
                    } else {
                        I = document.createElement("link");
                        I.rel = "stylesheet";
                        I.type = "text/css";
                        I.media = "all";
                        I.href = J.url;
                        document.getElementsByTagName("head")[0].appendChild(I);
                        return I.styleSheet
                    }
                }
            }
        };
        var H = []
          , F = -1
          , E = {}
          , D = {};
        G.fn.jstree = function(L) {
            var I = (typeof L == "string")
              , J = Array.prototype.slice.call(arguments, 1)
              , K = this;
            if (I) {
                if (L.substring(0, 1) == "_") {
                    return K
                }
                this.each(function() {
                    var M = H[G.data(this, "jstree_instance_id")]
                      , N = (M && G.isFunction(M[L])) ? M[L].apply(M, J) : M;
                    if (typeof N !== "undefined" && (L.indexOf("is_") === 0 || (N !== true && N !== false))) {
                        K = N;
                        return false
                    }
                })
            } else {
                this.each(function() {
                    var Q = G.data(this, "jstree_instance_id")
                      , N = []
                      , M = L ? G.extend({}, true, L) : {}
                      , R = G(this)
                      , P = false
                      , O = [];
                    N = N.concat(J);
                    if (R.data("jstree")) {
                        N.push(R.data("jstree"))
                    }
                    M = N.length ? G.extend.apply(null, [true, M].concat(N)) : M;
                    if (typeof Q !== "undefined" && H[Q]) {
                        H[Q].destroy()
                    }
                    Q = parseInt(H.push({}), 10) - 1;
                    G.data(this, "jstree_instance_id", Q);
                    M.plugins = G.isArray(M.plugins) ? M.plugins : G.jstree.defaults.plugins.slice();
                    M.plugins.unshift("core");
                    M.plugins = M.plugins.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g, "$1$2$4").replace(/,,+/g, ",").replace(/,$/, "").split(",");
                    P = G.extend(true, {}, G.jstree.defaults, M);
                    P.plugins = M.plugins;
                    G.each(E, function(S, T) {
                        if (G.inArray(S, P.plugins) === -1) {
                            P[S] = null;
                            delete P[S]
                        } else {
                            O.push(S)
                        }
                    });
                    P.plugins = O;
                    H[Q] = new G.jstree._instance(Q,G(this).addClass("jstree jstree-" + Q),P);
                    G.each(H[Q]._get_settings().plugins, function(S, T) {
                        H[Q].data[T] = {}
                    });
                    G.each(H[Q]._get_settings().plugins, function(S, T) {
                        if (E[T]) {
                            E[T].__init.apply(H[Q])
                        }
                    });
                    setTimeout(function() {
                        if (H[Q]) {
                            H[Q].init()
                        }
                    }, 0)
                })
            }
            return K
        }
        ;
        G.jstree = {
            defaults: {
                plugins: []
            },
            _focused: function() {
                return H[F] || null
            },
            _reference: function(I) {
                if (H[I]) {
                    return H[I]
                }
                var J = G(I);
                if (!J.length && typeof I === "string") {
                    J = G("#" + I)
                }
                if (!J.length) {
                    return null
                }
                return H[J.closest(".jstree").data("jstree_instance_id")] || null
            },
            _instance: function(J, I, K) {
                this.data = {
                    core: {}
                };
                this.get_settings = function() {
                    return G.extend(true, {}, K)
                }
                ;
                this._get_settings = function() {
                    return K
                }
                ;
                this.get_index = function() {
                    return J
                }
                ;
                this.get_container = function() {
                    return I
                }
                ;
                this.get_container_ul = function() {
                    return I.children("ul:eq(0)")
                }
                ;
                this._set_settings = function(L) {
                    K = G.extend(true, {}, K, L)
                }
            },
            _fn: {},
            plugin: function(I, J) {
                J = G.extend({}, {
                    __init: G.noop,
                    __destroy: G.noop,
                    _fn: {},
                    defaults: false
                }, J);
                E[I] = J;
                G.jstree.defaults[I] = J.defaults;
                G.each(J._fn, function(K, L) {
                    L.plugin = I;
                    L.old = G.jstree._fn[K];
                    G.jstree._fn[K] = function() {
                        var M, O = L, N = Array.prototype.slice.call(arguments), Q = new G.Event("before.jstree"), P = false;
                        if (this.data.core.locked === true && K !== "unlock" && K !== "is_locked") {
                            return
                        }
                        do {
                            if (O && O.plugin && G.inArray(O.plugin, this._get_settings().plugins) !== -1) {
                                break
                            }
                            O = O.old
                        } while (O);if (!O) {
                            return
                        }
                        if (K.indexOf("_") === 0) {
                            M = O.apply(this, N)
                        } else {
                            M = this.get_container().triggerHandler(Q, {
                                func: K,
                                inst: this,
                                args: N,
                                plugin: O.plugin
                            });
                            if (M === false) {
                                return
                            }
                            if (typeof M !== "undefined") {
                                N = M
                            }
                            M = O.apply(G.extend({}, this, {
                                __callback: function(R) {
                                    this.get_container().triggerHandler(K + ".jstree", {
                                        inst: this,
                                        args: N,
                                        rslt: R,
                                        rlbk: P
                                    })
                                },
                                __rollback: function() {
                                    P = this.get_rollback();
                                    return P
                                },
                                __call_old: function(R) {
                                    return O.old.apply(this, (R ? Array.prototype.slice.call(arguments, 1) : N))
                                }
                            }), N)
                        }
                        return M
                    }
                    ;
                    G.jstree._fn[K].old = L.old;
                    G.jstree._fn[K].plugin = I
                })
            },
            rollback: function(I) {
                if (I) {
                    if (!G.isArray(I)) {
                        I = [I]
                    }
                    G.each(I, function(J, K) {
                        H[K.i].set_rollback(K.h, K.d)
                    })
                }
            }
        };
        G.jstree._fn = G.jstree._instance.prototype = {};
        G(function() {
            var K = navigator.userAgent.toLowerCase()
              , J = (K.match(/.+?(?:rv|it|ra|ie)[\/: ]([\d.]+)/) || [0, "0"])[1]
              , I = ".jstree ul, .jstree li { display:block; margin:0 0 0 0; padding:0 0 0 0; list-style-type:none; } .jstree li { display:block; min-height:18px; line-height:18px; white-space:nowrap; margin-left:18px; min-width:18px; } .jstree-rtl li { margin-left:0; margin-right:18px; } .jstree > ul > li { margin-left:0px; } .jstree-rtl > ul > li { margin-right:0px; } .jstree ins { display:inline-block; text-decoration:none; width:18px; height:18px; margin:0 0 0 0; padding:0; } .jstree a { display:inline-block; line-height:16px; height:16px; color:black; white-space:nowrap; text-decoration:none; padding:1px 2px; margin:0; } .jstree a:focus { outline: none; } .jstree a > ins { height:16px; width:16px; } .jstree a > .jstree-icon { margin-right:3px; } .jstree-rtl a > .jstree-icon { margin-left:3px; margin-right:0; } li.jstree-open > ul { display:block; } li.jstree-closed > ul { display:none; } ";
            if (/msie/.test(K) && parseInt(J, 10) == 6) {
                C = true;
                try {
                    document.execCommand("BackgroundImageCache", false, true)
                } catch (L) {}
                I += ".jstree li { height:18px; margin-left:0; margin-right:0; } .jstree li li { margin-left:18px; } .jstree-rtl li li { margin-left:0px; margin-right:18px; } li.jstree-open ul { display:block; } li.jstree-closed ul { display:none !important; } .jstree li a { display:inline; border-width:0 !important; padding:0px 2px !important; } .jstree li a ins { height:16px; width:16px; margin-right:3px; } .jstree-rtl li a ins { margin-right:0px; margin-left:3px; } "
            }
            if (/msie/.test(K) && parseInt(J, 10) == 7) {
                B = true;
                I += ".jstree li a { border-width:0 !important; padding:0px 2px !important; } "
            }
            if (!/compatible/.test(K) && /mozilla/.test(K) && parseFloat(J, 10) < 1.9) {
                A = true;
                I += ".jstree ins { display:-moz-inline-box; } .jstree li { line-height:12px; } .jstree a { display:-moz-inline-box; } .jstree .jstree-no-icons .jstree-checkbox { display:-moz-inline-stack !important; } "
            }
            G.vakata.css.add_sheet({
                str: I,
                title: "jstree"
            })
        });
        G.jstree.plugin("core", {
            __init: function() {
                this.data.core.locked = false;
                this.data.core.to_open = this.get_settings().core.initially_open;
                this.data.core.to_load = this.get_settings().core.initially_load
            },
            defaults: {
                html_titles: false,
                animation: 500,
                initially_open: [],
                initially_load: [],
                open_parents: true,
                notify_plugins: true,
                rtl: false,
                load_open: false,
                strings: {
                    loading: "Loading ...",
                    new_node: "New node",
                    multiple_selection: "Multiple selection"
                }
            },
            _fn: {
                init: function() {
                    this.set_focus();
                    if (this._get_settings().core.rtl) {
                        this.get_container().addClass("jstree-rtl").css("direction", "rtl")
                    }
                    this.get_container().html("<ul><li class='jstree-last jstree-leaf'><ins>&#160;</ins><a class='jstree-loading' href='#'><ins class='jstree-icon'>&#160;</ins>" + this._get_string("loading") + "</a></li></ul>");
                    this.data.core.li_height = this.get_container_ul().find("li.jstree-closed, li.jstree-leaf").eq(0).height() || 18;
                    this.get_container().delegate("li > ins", "click.jstree", G.proxy(function(J) {
                        var I = G(J.target);
                        this.toggle_node(I)
                    }, this)).bind("mousedown.jstree", G.proxy(function() {
                        this.set_focus()
                    }, this)).bind("dblclick.jstree", function(J) {
                        var K;
                        if (document.selection && document.selection.empty) {
                            document.selection.empty()
                        } else {
                            if (window.getSelection) {
                                K = window.getSelection();
                                try {
                                    K.removeAllRanges();
                                    K.collapse()
                                } catch (I) {}
                            }
                        }
                    });
                    if (this._get_settings().core.notify_plugins) {
                        this.get_container().bind("load_node.jstree", G.proxy(function(K, J) {
                            var L = this._get_node(J.rslt.obj)
                              , I = this;
                            if (L === -1) {
                                L = this.get_container_ul()
                            }
                            if (!L.length) {
                                return
                            }
                            L.find("li").each(function() {
                                var M = G(this);
                                if (M.data("jstree")) {
                                    G.each(M.data("jstree"), function(O, N) {
                                        if (I.data[O] && G.isFunction(I["_" + O + "_notify"])) {
                                            I["_" + O + "_notify"].call(I, M, N)
                                        }
                                    })
                                }
                            })
                        }, this))
                    }
                    if (this._get_settings().core.load_open) {
                        this.get_container().bind("load_node.jstree", G.proxy(function(K, J) {
                            var L = this._get_node(J.rslt.obj)
                              , I = this;
                            if (L === -1) {
                                L = this.get_container_ul()
                            }
                            if (!L.length) {
                                return
                            }
                            L.find("li.jstree-open:not(:has(ul))").each(function() {
                                I.load_node(this, G.noop, G.noop)
                            })
                        }, this))
                    }
                    this.__callback();
                    this.load_node(-1, function() {
                        this.loaded();
                        this.reload_nodes()
                    })
                },
                destroy: function() {
                    var I, L = this.get_index(), J = this._get_settings(), K = this;
                    G.each(J.plugins, function(M, O) {
                        try {
                            E[O].__destroy.apply(K)
                        } catch (N) {}
                    });
                    this.__callback();
                    if (this.is_focused()) {
                        for (I in H) {
                            if (H.hasOwnProperty(I) && I != L) {
                                H[I].set_focus();
                                break
                            }
                        }
                    }
                    if (L === F) {
                        F = -1
                    }
                    this.get_container().unbind(".jstree").undelegate(".jstree").removeData("jstree_instance_id").find("[class^='jstree']").andSelf().attr("class", function() {
                        return this.className.replace(/jstree[^ ]*|$/ig, "")
                    });
                    G(document).unbind(".jstree-" + L).undelegate(".jstree-" + L);
                    H[L] = null;
                    delete H[L]
                },
                _core_notify: function(J, I) {
                    if (I.opened) {
                        this.open_node(J, false, true)
                    }
                },
                lock: function() {
                    this.data.core.locked = true;
                    this.get_container().children("ul").addClass("jstree-locked").css("opacity", "0.7");
                    this.__callback({})
                },
                unlock: function() {
                    this.data.core.locked = false;
                    this.get_container().children("ul").removeClass("jstree-locked").css("opacity", "1");
                    this.__callback({})
                },
                is_locked: function() {
                    return this.data.core.locked
                },
                save_opened: function() {
                    var I = this;
                    this.data.core.to_open = [];
                    this.get_container_ul().find("li.jstree-open").each(function() {
                        if (this.id) {
                            I.data.core.to_open.push("#" + this.id.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:"))
                        }
                    });
                    this.__callback(I.data.core.to_open)
                },
                save_loaded: function() {},
                reload_nodes: function(J) {
                    var M = this
                      , I = true
                      , L = []
                      , K = [];
                    if (!J) {
                        this.data.core.reopen = false;
                        this.data.core.refreshing = true;
                        this.data.core.to_open = G.map(G.makeArray(this.data.core.to_open), function(N) {
                            return "#" + N.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:")
                        });
                        this.data.core.to_load = G.map(G.makeArray(this.data.core.to_load), function(N) {
                            return "#" + N.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:")
                        });
                        if (this.data.core.to_open.length) {
                            this.data.core.to_load = this.data.core.to_load.concat(this.data.core.to_open)
                        }
                    }
                    if (this.data.core.to_load.length) {
                        G.each(this.data.core.to_load, function(N, O) {
                            if (O == "#") {
                                return true
                            }
                            if (G(O).length) {
                                L.push(O)
                            } else {
                                K.push(O)
                            }
                        });
                        if (L.length) {
                            this.data.core.to_load = K;
                            G.each(L, function(N, O) {
                                if (!M._is_loaded(O)) {
                                    M.load_node(O, function() {
                                        M.reload_nodes(true)
                                    }, function() {
                                        M.reload_nodes(true)
                                    });
                                    I = false
                                }
                            })
                        }
                    }
                    if (this.data.core.to_open.length) {
                        G.each(this.data.core.to_open, function(N, O) {
                            M.open_node(O, false, true)
                        })
                    }
                    if (I) {
                        if (this.data.core.reopen) {
                            clearTimeout(this.data.core.reopen)
                        }
                        this.data.core.reopen = setTimeout(function() {
                            M.__callback({}, M)
                        }, 50);
                        this.data.core.refreshing = false;
                        this.reopen()
                    }
                },
                reopen: function() {
                    var I = this;
                    if (this.data.core.to_open.length) {
                        G.each(this.data.core.to_open, function(J, K) {
                            I.open_node(K, false, true)
                        })
                    }
                    this.__callback({})
                },
                refresh: function(I) {
                    var J = this;
                    this.save_opened();
                    if (!I) {
                        I = -1
                    }
                    I = this._get_node(I);
                    if (!I) {
                        I = -1
                    }
                    if (I !== -1) {
                        I.children("UL").remove()
                    } else {
                        this.get_container_ul().empty()
                    }
                    this.load_node(I, function() {
                        J.__callback({
                            obj: I
                        });
                        J.reload_nodes()
                    })
                },
                loaded: function() {
                    this.__callback()
                },
                set_focus: function() {
                    if (this.is_focused()) {
                        return
                    }
                    var I = G.jstree._focused();
                    if (I) {
                        I.unset_focus()
                    }
                    this.get_container().addClass("jstree-focused");
                    F = this.get_index();
                    this.__callback()
                },
                is_focused: function() {
                    return F == this.get_index()
                },
                unset_focus: function() {
                    if (this.is_focused()) {
                        this.get_container().removeClass("jstree-focused");
                        F = -1
                    }
                    this.__callback()
                },
                _get_node: function(I) {
                    var J = G(I, this.get_container());
                    if (J.is(".jstree") || I == -1) {
                        return -1
                    }
                    J = J.closest("li", this.get_container());
                    return J.length ? J : false
                },
                _get_next: function(J, I) {
                    J = this._get_node(J);
                    if (J === -1) {
                        return this.get_container().find("> ul > li:first-child")
                    }
                    if (!J.length) {
                        return false
                    }
                    if (I) {
                        return (J.nextAll("li").size() > 0) ? J.nextAll("li:eq(0)") : false
                    }
                    if (J.hasClass("jstree-open")) {
                        return J.find("li:eq(0)")
                    } else {
                        if (J.nextAll("li").size() > 0) {
                            return J.nextAll("li:eq(0)")
                        } else {
                            return J.parentsUntil(".jstree", "li").next("li").eq(0)
                        }
                    }
                },
                _get_prev: function(J, I) {
                    J = this._get_node(J);
                    if (J === -1) {
                        return this.get_container().find("> ul > li:last-child")
                    }
                    if (!J.length) {
                        return false
                    }
                    if (I) {
                        return (J.prevAll("li").length > 0) ? J.prevAll("li:eq(0)") : false
                    }
                    if (J.prev("li").length) {
                        J = J.prev("li").eq(0);
                        while (J.hasClass("jstree-open")) {
                            J = J.children("ul:eq(0)").children("li:last")
                        }
                        return J
                    } else {
                        var K = J.parentsUntil(".jstree", "li:eq(0)");
                        return K.length ? K : false
                    }
                },
                _get_parent: function(I) {
                    I = this._get_node(I);
                    if (I == -1 || !I.length) {
                        return false
                    }
                    var J = I.parentsUntil(".jstree", "li:eq(0)");
                    return J.length ? J : -1
                },
                _get_children: function(I) {
                    I = this._get_node(I);
                    if (I === -1) {
                        return this.get_container().children("ul:eq(0)").children("li")
                    }
                    if (!I.length) {
                        return false
                    }
                    return I.children("ul:eq(0)").children("li")
                },
                get_path: function(K, I) {
                    var J = []
                      , L = this;
                    K = this._get_node(K);
                    if (K === -1 || !K || !K.length) {
                        return false
                    }
                    K.parentsUntil(".jstree", "li").each(function() {
                        J.push(I ? this.id : L.get_text(this))
                    });
                    J.reverse();
                    J.push(I ? K.attr("id") : this.get_text(K));
                    return J
                },
                _get_string: function(I) {
                    return this._get_settings().core.strings[I] || I
                },
                is_open: function(I) {
                    I = this._get_node(I);
                    return I && I !== -1 && I.hasClass("jstree-open")
                },
                is_closed: function(I) {
                    I = this._get_node(I);
                    return I && I !== -1 && I.hasClass("jstree-closed")
                },
                is_leaf: function(I) {
                    I = this._get_node(I);
                    return I && I !== -1 && I.hasClass("jstree-leaf")
                },
                correct_state: function(I) {
                    I = this._get_node(I);
                    if (!I || I === -1) {
                        return false
                    }
                    I.removeClass("jstree-closed jstree-open").addClass("jstree-leaf").children("ul").remove();
                    this.__callback({
                        obj: I
                    })
                },
                open_node: function(L, M, J) {
                    L = this._get_node(L);
                    if (!L.length) {
                        return false
                    }
                    if (!L.hasClass("jstree-closed")) {
                        if (M) {
                            M.call()
                        }
                        return false
                    }
                    var K = J || C ? 0 : this._get_settings().core.animation
                      , I = this;
                    if (!this._is_loaded(L)) {
                        L.children("a").addClass("jstree-loading");
                        this.load_node(L, function() {
                            I.open_node(L, M, J)
                        }, M)
                    } else {
                        if (this._get_settings().core.open_parents) {
                            L.parentsUntil(".jstree", ".jstree-closed").each(function() {
                                I.open_node(this, false, true)
                            })
                        }
                        if (K) {
                            L.children("ul").css("display", "none")
                        }
                        L.removeClass("jstree-closed").addClass("jstree-open").children("a").removeClass("jstree-loading");
                        if (K) {
                            L.children("ul").stop(true, true).slideDown(K, function() {
                                this.style.display = "";
                                I.after_open(L)
                            })
                        } else {
                            I.after_open(L)
                        }
                        this.__callback({
                            obj: L
                        });
                        if (M) {
                            M.call()
                        }
                    }
                },
                after_open: function(I) {
                    this.__callback({
                        obj: I
                    })
                },
                close_node: function(L, J) {
                    L = this._get_node(L);
                    var K = J || C ? 0 : this._get_settings().core.animation
                      , I = this;
                    if (!L.length || !L.hasClass("jstree-open")) {
                        return false
                    }
                    if (K) {
                        L.children("ul").attr("style", "display:block !important")
                    }
                    L.removeClass("jstree-open").addClass("jstree-closed");
                    if (K) {
                        L.children("ul").stop(true, true).slideUp(K, function() {
                            this.style.display = "";
                            I.after_close(L)
                        })
                    } else {
                        I.after_close(L)
                    }
                    this.__callback({
                        obj: L
                    })
                },
                after_close: function(I) {
                    this.__callback({
                        obj: I
                    })
                },
                toggle_node: function(I) {
                    I = this._get_node(I);
                    if (I.hasClass("jstree-closed")) {
                        return this.open_node(I)
                    }
                    if (I.hasClass("jstree-open")) {
                        return this.close_node(I)
                    }
                },
                open_all: function(K, J, I) {
                    K = K ? this._get_node(K) : -1;
                    if (!K || K === -1) {
                        K = this.get_container_ul()
                    }
                    if (I) {
                        K = K.find("li.jstree-closed")
                    } else {
                        I = K;
                        if (K.is(".jstree-closed")) {
                            K = K.find("li.jstree-closed").andSelf()
                        } else {
                            K = K.find("li.jstree-closed")
                        }
                    }
                    var L = this;
                    K.each(function() {
                        var M = this;
                        if (!L._is_loaded(this)) {
                            L.open_node(this, function() {
                                L.open_all(M, J, I)
                            }, !J)
                        } else {
                            L.open_node(this, false, !J)
                        }
                    });
                    if (I.find("li.jstree-closed").length === 0) {
                        this.__callback({
                            obj: I
                        })
                    }
                },
                close_all: function(J, I) {
                    var K = this;
                    J = J ? this._get_node(J) : this.get_container();
                    if (!J || J === -1) {
                        J = this.get_container_ul()
                    }
                    J.find("li.jstree-open").andSelf().each(function() {
                        K.close_node(this, !I)
                    });
                    this.__callback({
                        obj: J
                    })
                },
                clean_node: function(I) {
                    I = I && I != -1 ? G(I) : this.get_container_ul();
                    I = I.is("li") ? I.find("li").andSelf() : I.find("li");
                    I.removeClass("jstree-last").filter("li:last-child").addClass("jstree-last").end().filter(":has(li)").not(".jstree-open").removeClass("jstree-leaf").addClass("jstree-closed");
                    I.not(".jstree-open, .jstree-closed").addClass("jstree-leaf").children("ul").remove();
                    this.__callback({
                        obj: I
                    })
                },
                get_rollback: function() {
                    this.__callback();
                    return {
                        i: this.get_index(),
                        h: this.get_container().children("ul").clone(true),
                        d: this.data
                    }
                },
                set_rollback: function(I, J) {
                    this.get_container().empty().append(I);
                    this.data = J;
                    this.__callback()
                },
                load_node: function(K, I, J) {
                    this.__callback({
                        obj: K
                    })
                },
                _is_loaded: function(I) {
                    return true
                },
                create_node: function(N, I, M, P, J) {
                    N = this._get_node(N);
                    I = typeof I === "undefined" ? "last" : I;
                    var O = G("<li />"), L = this._get_settings().core, K;
                    if (N !== -1 && !N.length) {
                        return false
                    }
                    if (!J && !this._is_loaded(N)) {
                        this.load_node(N, function() {
                            this.create_node(N, I, M, P, true)
                        });
                        return false
                    }
                    this.__rollback();
                    if (typeof M === "string") {
                        M = {
                            data: M
                        }
                    }
                    if (!M) {
                        M = {}
                    }
                    if (M.attr) {
                        O.attr(M.attr)
                    }
                    if (M.metadata) {
                        O.data(M.metadata)
                    }
                    if (M.state) {
                        O.addClass("jstree-" + M.state)
                    }
                    if (!M.data) {
                        M.data = this._get_string("new_node")
                    }
                    if (!G.isArray(M.data)) {
                        K = M.data;
                        M.data = [];
                        M.data.push(K)
                    }
                    G.each(M.data, function(R, Q) {
                        K = G("<a />");
                        if (G.isFunction(Q)) {
                            Q = Q.call(this, M)
                        }
                        if (typeof Q == "string") {
                            K.attr("href", "#")[L.html_titles ? "html" : "text"](Q)
                        } else {
                            if (!Q.attr) {
                                Q.attr = {}
                            }
                            if (!Q.attr.href) {
                                Q.attr.href = "#"
                            }
                            K.attr(Q.attr)[L.html_titles ? "html" : "text"](Q.title);
                            if (Q.language) {
                                K.addClass(Q.language)
                            }
                        }
                        K.prepend("<ins class='jstree-icon'>&#160;</ins>");
                        if (!Q.icon && M.icon) {
                            Q.icon = M.icon
                        }
                        if (Q.icon) {
                            if (Q.icon.indexOf("/") === -1) {
                                K.children("ins").addClass(Q.icon)
                            } else {
                                K.children("ins").css("background", "url('" + Q.icon + "') center center no-repeat")
                            }
                        }
                        O.append(K)
                    });
                    O.prepend("<ins class='jstree-icon'>&#160;</ins>");
                    if (N === -1) {
                        N = this.get_container();
                        if (I === "before") {
                            I = "first"
                        }
                        if (I === "after") {
                            I = "last"
                        }
                    }
                    switch (I) {
                    case "before":
                        N.before(O);
                        K = this._get_parent(N);
                        break;
                    case "after":
                        N.after(O);
                        K = this._get_parent(N);
                        break;
                    case "inside":
                    case "first":
                        if (!N.children("ul").length) {
                            N.append("<ul />")
                        }
                        N.children("ul").prepend(O);
                        K = N;
                        break;
                    case "last":
                        if (!N.children("ul").length) {
                            N.append("<ul />")
                        }
                        N.children("ul").append(O);
                        K = N;
                        break;
                    default:
                        if (!N.children("ul").length) {
                            N.append("<ul />")
                        }
                        if (!I) {
                            I = 0
                        }
                        K = N.children("ul").children("li").eq(I);
                        if (K.length) {
                            K.before(O)
                        } else {
                            N.children("ul").append(O)
                        }
                        K = N;
                        break
                    }
                    if (K === -1 || K.get(0) === this.get_container().get(0)) {
                        K = -1
                    }
                    this.clean_node(K);
                    this.__callback({
                        obj: O,
                        parent: K
                    });
                    if (P) {
                        P.call(this, O)
                    }
                    return O
                },
                get_text: function(J) {
                    J = this._get_node(J);
                    if (!J.length) {
                        return false
                    }
                    var I = this._get_settings().core.html_titles;
                    J = J.children("a:eq(0)");
                    if (I) {
                        J = J.clone();
                        J.children("INS").remove();
                        return J.html()
                    } else {
                        J = J.contents().filter(function() {
                            return this.nodeType == 3
                        })[0];
                        return J.nodeValue
                    }
                },
                set_text: function(J, K) {
                    J = this._get_node(J);
                    if (!J.length) {
                        return false
                    }
                    J = J.children("a:eq(0)");
                    if (this._get_settings().core.html_titles) {
                        var I = J.children("INS").clone();
                        J.html(K).prepend(I);
                        this.__callback({
                            obj: J,
                            name: K
                        });
                        return true
                    } else {
                        J = J.contents().filter(function() {
                            return this.nodeType == 3
                        })[0];
                        this.__callback({
                            obj: J,
                            name: K
                        });
                        return ( J.nodeValue = K)
                    }
                },
                rename_node: function(I, J) {
                    I = this._get_node(I);
                    this.__rollback();
                    if (I && I.length && this.set_text.apply(this, Array.prototype.slice.call(arguments))) {
                        this.__callback({
                            obj: I,
                            name: J
                        })
                    }
                },
                delete_node: function(L) {
                    L = this._get_node(L);
                    if (!L.length) {
                        return false
                    }
                    this.__rollback();
                    var K = this._get_parent(L)
                      , J = G([])
                      , I = this;
                    L.each(function() {
                        J = J.add(I._get_prev(this))
                    });
                    L = L.detach();
                    if (K !== -1 && K.find("> ul > li").length === 0) {
                        K.removeClass("jstree-open jstree-closed").addClass("jstree-leaf")
                    }
                    this.clean_node(K);
                    this.__callback({
                        obj: L,
                        prev: J,
                        parent: K
                    });
                    return L
                },
                prepare_move: function(M, K, N, I, J) {
                    var L = {};
                    L.ot = G.jstree._reference(M) || this;
                    L.o = L.ot._get_node(M);
                    L.r = K === -1 ? -1 : this._get_node(K);
                    L.p = (typeof N === "undefined" || N === false) ? "last" : N;
                    if (!J && D.o && D.o[0] === L.o[0] && D.r[0] === L.r[0] && D.p === L.p) {
                        this.__callback(D);
                        if (I) {
                            I.call(this, D)
                        }
                        return
                    }
                    L.ot = G.jstree._reference(L.o) || this;
                    L.rt = G.jstree._reference(L.r) || this;
                    if (L.r === -1 || !L.r) {
                        L.cr = -1;
                        switch (L.p) {
                        case "first":
                        case "before":
                        case "inside":
                            L.cp = 0;
                            break;
                        case "after":
                        case "last":
                            L.cp = L.rt.get_container().find(" > ul > li").length;
                            break;
                        default:
                            L.cp = L.p;
                            break
                        }
                    } else {
                        if (!/^(before|after)$/.test(L.p) && !this._is_loaded(L.r)) {
                            return this.load_node(L.r, function() {
                                this.prepare_move(M, K, N, I, true)
                            })
                        }
                        switch (L.p) {
                        case "before":
                            L.cp = L.r.index();
                            L.cr = L.rt._get_parent(L.r);
                            break;
                        case "after":
                            L.cp = L.r.index() + 1;
                            L.cr = L.rt._get_parent(L.r);
                            break;
                        case "inside":
                        case "first":
                            L.cp = 0;
                            L.cr = L.r;
                            break;
                        case "last":
                            L.cp = L.r.find(" > ul > li").length;
                            L.cr = L.r;
                            break;
                        default:
                            L.cp = L.p;
                            L.cr = L.r;
                            break
                        }
                    }
                    L.np = L.cr == -1 ? L.rt.get_container() : L.cr;
                    L.op = L.ot._get_parent(L.o);
                    L.cop = L.o.index();
                    if (L.op === -1) {
                        L.op = L.ot ? L.ot.get_container() : this.get_container()
                    }
                    if (!/^(before|after)$/.test(L.p) && L.op && L.np && L.op[0] === L.np[0] && L.o.index() < L.cp) {
                        L.cp++
                    }
                    L.or = L.np.find(" > ul > li:nth-child(" + (L.cp + 1) + ")");
                    D = L;
                    this.__callback(D);
                    if (I) {
                        I.call(this, D)
                    }
                },
                check_move: function() {
                    var K = D
                      , I = true
                      , J = K.r === -1 ? this.get_container() : K.r;
                    if (!K || !K.o || K.or[0] === K.o[0]) {
                        return false
                    }
                    if (K.op && K.np && K.op[0] === K.np[0] && K.cp - 1 === K.o.index()) {
                        return false
                    }
                    K.o.each(function() {
                        if (J.parentsUntil(".jstree", "li").andSelf().index(this) !== -1) {
                            I = false;
                            return false
                        }
                    });
                    return I
                },
                move_node: function(O, L, I, K, J, N) {
                    if (!J) {
                        return this.prepare_move(O, L, I, function(Q) {
                            this.move_node(Q, false, false, K, true, N)
                        })
                    }
                    if (K) {
                        D.cy = true
                    }
                    if (!N && !this.check_move()) {
                        return false
                    }
                    this.__rollback();
                    var P = false;
                    if (K) {
                        P = O.o.clone(true);
                        P.find("*[id]").andSelf().each(function() {
                            if (this.id) {
                                this.id = "copy_" + this.id
                            }
                        })
                    } else {
                        P = O.o
                    }
                    if (O.or.length) {
                        O.or.before(P)
                    } else {
                        if (!O.np.children("ul").length) {
                            G("<ul />").appendTo(O.np)
                        }
                        O.np.children("ul:eq(0)").append(P)
                    }
                    try {
                        O.ot.clean_node(O.op);
                        O.rt.clean_node(O.np);
                        if (!O.op.find("> ul > li").length) {
                            O.op.removeClass("jstree-open jstree-closed").addClass("jstree-leaf").children("ul").remove()
                        }
                    } catch (M) {}
                    if (K) {
                        D.cy = true;
                        D.oc = P
                    }
                    this.__callback(D);
                    return D
                },
                _get_move: function() {
                    return D
                }
            }
        })
    })(jQuery);
    (function(D) {
        var G, F, E;
        D(function() {
            if (/msie/.test(navigator.userAgent.toLowerCase())) {
                F = D('<textarea cols="10" rows="2"></textarea>').css({
                    position: "absolute",
                    top: -1000,
                    left: 0
                }).appendTo("body");
                E = D('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({
                    position: "absolute",
                    top: -1000,
                    left: 0
                }).appendTo("body");
                G = F.width() - E.width();
                F.add(E).remove()
            } else {
                F = D("<div />").css({
                    width: 100,
                    height: 100,
                    overflow: "auto",
                    position: "absolute",
                    top: -1000,
                    left: 0
                }).prependTo("body").append("<div />").find("div").css({
                    width: "100%",
                    height: 200
                });
                G = 100 - F.width();
                F.parent().remove()
            }
        });
        D.jstree.plugin("ui", {
            __init: function() {
                this.data.ui.selected = D();
                this.data.ui.last_selected = false;
                this.data.ui.hovered = null;
                this.data.ui.to_select = this.get_settings().ui.initially_select;
                this.get_container().delegate("a", "click.jstree", D.proxy(function(H) {
                    H.preventDefault();
                    H.currentTarget.blur();
                    if (!D(H.currentTarget).hasClass("jstree-loading")) {
                        this.select_node(H.currentTarget, true, H)
                    }
                }, this)).delegate("a", "mouseenter.jstree", D.proxy(function(H) {
                    if (!D(H.currentTarget).hasClass("jstree-loading")) {
                        this.hover_node(H.target)
                    }
                }, this)).delegate("a", "mouseleave.jstree", D.proxy(function(H) {
                    if (!D(H.currentTarget).hasClass("jstree-loading")) {
                        this.dehover_node(H.target)
                    }
                }, this)).bind("reopen.jstree", D.proxy(function() {
                    this.reselect()
                }, this)).bind("get_rollback.jstree", D.proxy(function() {
                    this.dehover_node();
                    this.save_selected()
                }, this)).bind("set_rollback.jstree", D.proxy(function() {
                    this.reselect()
                }, this)).bind("close_node.jstree", D.proxy(function(I, J) {
                    var H = this._get_settings().ui
                      , K = this._get_node(J.rslt.obj)
                      , L = (K && K.length) ? K.children("ul").find("a.jstree-clicked") : D()
                      , M = this;
                    if (H.selected_parent_close === false || !L.length) {
                        return
                    }
                    L.each(function() {
                        M.deselect_node(this);
                        if (H.selected_parent_close === "select_parent") {
                            M.select_node(K)
                        }
                    })
                }, this)).bind("delete_node.jstree", D.proxy(function(I, J) {
                    var H = this._get_settings().ui.select_prev_on_delete
                      , K = this._get_node(J.rslt.obj)
                      , L = (K && K.length) ? K.find("a.jstree-clicked") : []
                      , M = this;
                    L.each(function() {
                        M.deselect_node(this)
                    });
                    if (H && L.length) {
                        J.rslt.prev.each(function() {
                            if (this.parentNode) {
                                M.select_node(this);
                                return false
                            }
                        })
                    }
                }, this)).bind("move_node.jstree", D.proxy(function(H, I) {
                    if (I.rslt.cy) {
                        I.rslt.oc.find("a.jstree-clicked").removeClass("jstree-clicked")
                    }
                }, this))
            },
            defaults: {
                select_limit: -1,
                select_multiple_modifier: "ctrl",
                select_range_modifier: "shift",
                selected_parent_close: "select_parent",
                selected_parent_open: true,
                select_prev_on_delete: true,
                disable_selecting_children: false,
                initially_select: []
            },
            _fn: {
                _get_node: function(H, I) {
                    if (typeof H === "undefined" || H === null) {
                        return I ? this.data.ui.selected : this.data.ui.last_selected
                    }
                    var J = D(H, this.get_container());
                    if (J.is(".jstree") || H == -1) {
                        return -1
                    }
                    J = J.closest("li", this.get_container());
                    return J.length ? J : false
                },
                _ui_notify: function(I, H) {
                    if (H.selected) {
                        this.select_node(I, false)
                    }
                },
                save_selected: function() {
                    var H = this;
                    this.data.ui.to_select = [];
                    this.data.ui.selected.each(function() {
                        if (this.id) {
                            H.data.ui.to_select.push("#" + this.id.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:"))
                        }
                    });
                    this.__callback(this.data.ui.to_select)
                },
                reselect: function() {
                    var I = this
                      , H = this.data.ui.to_select;
                    H = D.map(D.makeArray(H), function(J) {
                        return "#" + J.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:")
                    });
                    D.each(H, function(J, K) {
                        if (K && K !== "#") {
                            I.select_node(K)
                        }
                    });
                    this.data.ui.selected = this.data.ui.selected.filter(function() {
                        return this.parentNode
                    });
                    this.__callback()
                },
                refresh: function(H) {
                    this.save_selected();
                    return this.__call_old()
                },
                hover_node: function(H) {
                    H = this._get_node(H);
                    if (!H.length) {
                        return false
                    }
                    if (!H.hasClass("jstree-hovered")) {
                        this.dehover_node()
                    }
                    this.data.ui.hovered = H.children("a").addClass("jstree-hovered").parent();
                    this._fix_scroll(H);
                    this.__callback({
                        obj: H
                    })
                },
                dehover_node: function() {
                    var I = this.data.ui.hovered, H;
                    if (!I || !I.length) {
                        return false
                    }
                    H = I.children("a").removeClass("jstree-hovered").parent();
                    if (this.data.ui.hovered[0] === H[0]) {
                        this.data.ui.hovered = null
                    }
                    this.__callback({
                        obj: I
                    })
                },
                select_node: function(K, H, L) {
                    K = this._get_node(K);
                    if (K == -1 || !K || !K.length) {
                        return false
                    }
                    var P = this._get_settings().ui
                      , N = (P.select_multiple_modifier == "on" || (P.select_multiple_modifier !== false && L && L[P.select_multiple_modifier + "Key"]))
                      , I = (P.select_range_modifier !== false && L && L[P.select_range_modifier + "Key"] && this.data.ui.last_selected && this.data.ui.last_selected[0] !== K[0] && this.data.ui.last_selected.parent()[0] === K.parent()[0])
                      , J = this.is_selected(K)
                      , M = true
                      , O = this;
                    if (H) {
                        if (P.disable_selecting_children && N && ((K.parentsUntil(".jstree", "li").children("a.jstree-clicked").length) || (K.children("ul").find("a.jstree-clicked:eq(0)").length))) {
                            return false
                        }
                        M = false;
                        switch (!0) {
                        case (I):
                            this.data.ui.last_selected.addClass("jstree-last-selected");
                            K = K[K.index() < this.data.ui.last_selected.index() ? "nextUntil" : "prevUntil"](".jstree-last-selected").andSelf();
                            if (P.select_limit == -1 || K.length < P.select_limit) {
                                this.data.ui.last_selected.removeClass("jstree-last-selected");
                                this.data.ui.selected.each(function() {
                                    if (this !== O.data.ui.last_selected[0]) {
                                        O.deselect_node(this)
                                    }
                                });
                                J = false;
                                M = true
                            } else {
                                M = false
                            }
                            break;
                        case (J && !N):
                            this.deselect_all();
                            J = false;
                            M = true;
                            break;
                        case (!J && !N):
                            if (P.select_limit == -1 || P.select_limit > 0) {
                                this.deselect_all();
                                M = true
                            }
                            break;
                        case (J && N):
                            this.deselect_node(K);
                            break;
                        case (!J && N):
                            if (P.select_limit == -1 || this.data.ui.selected.length + 1 <= P.select_limit) {
                                M = true
                            }
                            break
                        }
                    }
                    if (M && !J) {
                        if (!I) {
                            this.data.ui.last_selected = K
                        }
                        K.children("a").addClass("jstree-clicked");
                        if (P.selected_parent_open) {
                            K.parents(".jstree-closed").each(function() {
                                O.open_node(this, false, true)
                            })
                        }
                        this.data.ui.selected = this.data.ui.selected.add(K);
                        this._fix_scroll(K.eq(0));
                        this.__callback({
                            obj: K,
                            e: L
                        })
                    }
                },
                _fix_scroll: function(I) {
                    var J = this.get_container()[0], H;
                    if (J.scrollHeight > J.offsetHeight) {
                        I = this._get_node(I);
                        if (!I || I === -1 || !I.length || !I.is(":visible")) {
                            return
                        }
                        H = I.offset().top - this.get_container().offset().top;
                        if (H < 0) {
                            J.scrollTop = J.scrollTop + H - 1
                        }
                        if (H + this.data.core.li_height + (J.scrollWidth > J.offsetWidth ? G : 0) > J.offsetHeight) {
                            J.scrollTop = J.scrollTop + (H - J.offsetHeight + this.data.core.li_height + 1 + (J.scrollWidth > J.offsetWidth ? G : 0))
                        }
                    }
                },
                deselect_node: function(H) {
                    H = this._get_node(H);
                    if (!H.length) {
                        return false
                    }
                    if (this.is_selected(H)) {
                        H.children("a").removeClass("jstree-clicked");
                        this.data.ui.selected = this.data.ui.selected.not(H);
                        if (this.data.ui.last_selected.get(0) === H.get(0)) {
                            this.data.ui.last_selected = this.data.ui.selected.eq(0)
                        }
                        this.__callback({
                            obj: H
                        })
                    }
                },
                toggle_select: function(H) {
                    H = this._get_node(H);
                    if (!H.length) {
                        return false
                    }
                    if (this.is_selected(H)) {
                        this.deselect_node(H)
                    } else {
                        this.select_node(H)
                    }
                },
                is_selected: function(H) {
                    return this.data.ui.selected.index(this._get_node(H)) >= 0
                },
                get_selected: function(H) {
                    return H ? D(H).find("a.jstree-clicked").parent() : this.data.ui.selected
                },
                deselect_all: function(I) {
                    var H = I ? D(I).find("a.jstree-clicked").parent() : this.get_container().find("a.jstree-clicked").parent();
                    H.children("a.jstree-clicked").removeClass("jstree-clicked");
                    this.data.ui.selected = D([]);
                    this.data.ui.last_selected = false;
                    this.__callback({
                        obj: H
                    })
                }
            }
        });
        D.jstree.defaults.plugins.push("ui")
    })(jQuery);
    (function(D) {
        D.jstree.plugin("crrm", {
            __init: function() {
                this.get_container().bind("move_node.jstree", D.proxy(function(G, F) {
                    if (this._get_settings().crrm.move.open_onmove) {
                        var E = this;
                        F.rslt.np.parentsUntil(".jstree").andSelf().filter(".jstree-closed").each(function() {
                            E.open_node(this, false, true)
                        })
                    }
                }, this))
            },
            defaults: {
                input_width_limit: 200,
                move: {
                    always_copy: false,
                    open_onmove: true,
                    default_position: "last",
                    check_move: function(E) {
                        return true
                    }
                }
            },
            _fn: {
                _show_input: function(E, L) {
                    E = this._get_node(E);
                    var J = this._get_settings().core.rtl
                      , K = this._get_settings().crrm.input_width_limit
                      , G = E.children("ins").width()
                      , F = E.find("> a:visible > ins").width() * E.find("> a:visible > ins").length
                      , M = this.get_text(E)
                      , I = D("<div />", {
                        css: {
                            position: "absolute",
                            top: "-200px",
                            left: (J ? "0px" : "-1000px"),
                            visibility: "hidden"
                        }
                    }).appendTo("body")
                      , H = E.css("position", "relative").append(D("<input />", {
                        value: M,
                        "class": "jstree-rename-input",
                        css: {
                            padding: "0",
                            border: "1px solid silver",
                            position: "absolute",
                            left: (J ? "auto" : (G + F + 4) + "px"),
                            right: (J ? (G + F + 4) + "px" : "auto"),
                            top: "0px",
                            height: (this.data.core.li_height - 2) + "px",
                            lineHeight: (this.data.core.li_height - 2) + "px",
                            width: "150px"
                        },
                        blur: D.proxy(function() {
                            var O = E.children(".jstree-rename-input")
                              , N = O.val();
                            if (N === "") {
                                N = M
                            }
                            I.remove();
                            O.remove();
                            this.set_text(E, M);
                            this.rename_node(E, N);
                            L.call(this, E, N, M);
                            E.css("position", "")
                        }, this),
                        keyup: function(O) {
                            var N = O.keyCode || O.which;
                            if (N == 27) {
                                this.value = M;
                                this.blur();
                                return
                            } else {
                                if (N == 13) {
                                    this.blur();
                                    return
                                } else {
                                    H.width(Math.min(I.text("pW" + this.value).width(), K))
                                }
                            }
                        },
                        keypress: function(O) {
                            var N = O.keyCode || O.which;
                            if (N == 13) {
                                return false
                            }
                        }
                    })).children(".jstree-rename-input");
                    this.set_text(E, "");
                    I.css({
                        fontFamily: H.css("fontFamily") || "",
                        fontSize: H.css("fontSize") || "",
                        fontWeight: H.css("fontWeight") || "",
                        fontStyle: H.css("fontStyle") || "",
                        fontStretch: H.css("fontStretch") || "",
                        fontVariant: H.css("fontVariant") || "",
                        letterSpacing: H.css("letterSpacing") || "",
                        wordSpacing: H.css("wordSpacing") || ""
                    });
                    H.width(Math.min(I.text("pW" + H[0].value).width(), K))[0].select()
                },
                rename: function(F) {
                    F = this._get_node(F);
                    this.__rollback();
                    var E = this.__callback;
                    this._show_input(F, function(I, H, G) {
                        E.call(this, {
                            obj: I,
                            new_name: H,
                            old_name: G
                        })
                    })
                },
                create: function(I, F, H, K, E) {
                    var G, J = this;
                    I = this._get_node(I);
                    if (!I) {
                        I = -1
                    }
                    this.__rollback();
                    G = this.create_node(I, F, H, function(L) {
                        var M = this._get_parent(L)
                          , N = D(L).index();
                        if (K) {
                            K.call(this, L)
                        }
                        if (M.length && M.hasClass("jstree-closed")) {
                            this.open_node(M, false, true)
                        }
                        if (!E) {
                            this._show_input(L, function(Q, P, O) {
                                J.__callback({
                                    obj: Q,
                                    name: P,
                                    parent: M,
                                    position: N
                                })
                            })
                        } else {
                            J.__callback({
                                obj: L,
                                name: this.get_text(L),
                                parent: M,
                                position: N
                            })
                        }
                    });
                    return G
                },
                remove: function(G) {
                    G = this._get_node(G, true);
                    var F = this._get_parent(G)
                      , E = this._get_prev(G);
                    this.__rollback();
                    G = this.delete_node(G);
                    if (G !== false) {
                        this.__callback({
                            obj: G,
                            prev: E,
                            parent: F
                        })
                    }
                },
                check_move: function() {
                    if (!this.__call_old()) {
                        return false
                    }
                    var E = this._get_settings().crrm.move;
                    if (!E.check_move.call(this, this._get_move())) {
                        return false
                    }
                    return true
                },
                move_node: function(K, I, E, G, F, J) {
                    var H = this._get_settings().crrm.move;
                    if (!F) {
                        if (typeof E === "undefined") {
                            E = H.default_position
                        }
                        if (E === "inside" && !H.default_position.match(/^(before|after)$/)) {
                            E = H.default_position
                        }
                        return this.__call_old(true, K, I, E, G, false, J)
                    }
                    if (H.always_copy === true || (H.always_copy === "multitree" && K.rt.get_index() !== K.ot.get_index())) {
                        G = true
                    }
                    this.__call_old(true, K, I, E, G, true, J)
                },
                cut: function(E) {
                    E = this._get_node(E, true);
                    if (!E || !E.length) {
                        return false
                    }
                    this.data.crrm.cp_nodes = false;
                    this.data.crrm.ct_nodes = E;
                    this.__callback({
                        obj: E
                    })
                },
                copy: function(E) {
                    E = this._get_node(E, true);
                    if (!E || !E.length) {
                        return false
                    }
                    this.data.crrm.ct_nodes = false;
                    this.data.crrm.cp_nodes = E;
                    this.__callback({
                        obj: E
                    })
                },
                paste: function(F) {
                    F = this._get_node(F);
                    if (!F || !F.length) {
                        return false
                    }
                    var E = this.data.crrm.ct_nodes ? this.data.crrm.ct_nodes : this.data.crrm.cp_nodes;
                    if (!this.data.crrm.ct_nodes && !this.data.crrm.cp_nodes) {
                        return false
                    }
                    if (this.data.crrm.ct_nodes) {
                        this.move_node(this.data.crrm.ct_nodes, F);
                        this.data.crrm.ct_nodes = false
                    }
                    if (this.data.crrm.cp_nodes) {
                        this.move_node(this.data.crrm.cp_nodes, F, false, true)
                    }
                    this.__callback({
                        obj: F,
                        nodes: E
                    })
                }
            }
        })
    })(jQuery);
    (function(D) {
        var E = [];
        D.jstree._themes = false;
        D.jstree.plugin("themes", {
            __init: function() {
                this.get_container().bind("init.jstree", D.proxy(function() {
                    var F = this._get_settings().themes;
                    this.data.themes.dots = F.dots;
                    this.data.themes.icons = F.icons;
                    this.set_theme(F.theme, F.url)
                }, this)).bind("loaded.jstree", D.proxy(function() {
                    if (!this.data.themes.dots) {
                        this.hide_dots()
                    } else {
                        this.show_dots()
                    }
                    if (!this.data.themes.icons) {
                        this.hide_icons()
                    } else {
                        this.show_icons()
                    }
                }, this))
            },
            defaults: {
                theme: "default",
                url: false,
                dots: true,
                icons: true
            },
            _fn: {
                set_theme: function(G, F) {
                    if (!G) {
                        return false
                    }
                    if (!F) {
                        F = D.jstree._themes + G + "/style.css"
                    }
                    if (D.inArray(F, E) == -1) {
                        D.vakata.css.add_sheet({
                            url: F
                        });
                        E.push(F)
                    }
                    if (this.data.themes.theme != G) {
                        this.get_container().removeClass("jstree-" + this.data.themes.theme);
                        this.data.themes.theme = G
                    }
                    this.get_container().addClass("jstree-" + G);
                    if (!this.data.themes.dots) {
                        this.hide_dots()
                    } else {
                        this.show_dots()
                    }
                    if (!this.data.themes.icons) {
                        this.hide_icons()
                    } else {
                        this.show_icons()
                    }
                    this.__callback()
                },
                get_theme: function() {
                    return this.data.themes.theme
                },
                show_dots: function() {
                    this.data.themes.dots = true;
                    this.get_container().children("ul").removeClass("jstree-no-dots")
                },
                hide_dots: function() {
                    this.data.themes.dots = false;
                    this.get_container().children("ul").addClass("jstree-no-dots")
                },
                toggle_dots: function() {
                    if (this.data.themes.dots) {
                        this.hide_dots()
                    } else {
                        this.show_dots()
                    }
                },
                show_icons: function() {
                    this.data.themes.icons = true;
                    this.get_container().children("ul").removeClass("jstree-no-icons")
                },
                hide_icons: function() {
                    this.data.themes.icons = false;
                    this.get_container().children("ul").addClass("jstree-no-icons")
                },
                toggle_icons: function() {
                    if (this.data.themes.icons) {
                        this.hide_icons()
                    } else {
                        this.show_icons()
                    }
                }
            }
        });
        D(function() {
            if (D.jstree._themes === false) {
                D("script").each(function() {
                    if (this.src.toString().match(/jquery\.jstree[^\/]*?\.js(\?.*)?$/)) {
                        D.jstree._themes = this.src.toString().replace(/jquery\.jstree[^\/]*?\.js(\?.*)?$/, "") + "themes/";
                        return false
                    }
                })
            }
            if (D.jstree._themes === false) {
                D.jstree._themes = "themes/"
            }
        });
        D.jstree.defaults.plugins.push("themes")
    })(jQuery);
    (function(F) {
        var E = [];
        function D(H, I) {
            var J = F.jstree._focused(), G;
            if (J && J.data && J.data.hotkeys && J.data.hotkeys.enabled) {
                G = J._get_settings().hotkeys[H];
                if (G) {
                    return G.call(J, I)
                }
            }
        }
        F.jstree.plugin("hotkeys", {
            __init: function() {
                if (typeof F.hotkeys === "undefined") {
                    throw "jsTree hotkeys: jQuery hotkeys plugin not included."
                }
                if (!this.data.ui) {
                    throw "jsTree hotkeys: jsTree UI plugin not included."
                }
                F.each(this._get_settings().hotkeys, function(H, G) {
                    if (G !== false && F.inArray(H, E) == -1) {
                        F(document).bind("keydown", H, function(I) {
                            return D(H, I)
                        });
                        E.push(H)
                    }
                });
                this.get_container().bind("lock.jstree", F.proxy(function() {
                    if (this.data.hotkeys.enabled) {
                        this.data.hotkeys.enabled = false;
                        this.data.hotkeys.revert = true
                    }
                }, this)).bind("unlock.jstree", F.proxy(function() {
                    if (this.data.hotkeys.revert) {
                        this.data.hotkeys.enabled = true
                    }
                }, this));
                this.enable_hotkeys()
            },
            defaults: {
                up: function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_prev(G));
                    return false
                },
                "ctrl+up": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_prev(G));
                    return false
                },
                "shift+up": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_prev(G));
                    return false
                },
                down: function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_next(G));
                    return false
                },
                "ctrl+down": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_next(G));
                    return false
                },
                "shift+down": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected || -1;
                    this.hover_node(this._get_next(G));
                    return false
                },
                left: function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G) {
                        if (G.hasClass("jstree-open")) {
                            this.close_node(G)
                        } else {
                            this.hover_node(this._get_prev(G))
                        }
                    }
                    return false
                },
                "ctrl+left": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G) {
                        if (G.hasClass("jstree-open")) {
                            this.close_node(G)
                        } else {
                            this.hover_node(this._get_prev(G))
                        }
                    }
                    return false
                },
                "shift+left": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G) {
                        if (G.hasClass("jstree-open")) {
                            this.close_node(G)
                        } else {
                            this.hover_node(this._get_prev(G))
                        }
                    }
                    return false
                },
                right: function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G && G.length) {
                        if (G.hasClass("jstree-closed")) {
                            this.open_node(G)
                        } else {
                            this.hover_node(this._get_next(G))
                        }
                    }
                    return false
                },
                "ctrl+right": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G && G.length) {
                        if (G.hasClass("jstree-closed")) {
                            this.open_node(G)
                        } else {
                            this.hover_node(this._get_next(G))
                        }
                    }
                    return false
                },
                "shift+right": function() {
                    var G = this.data.ui.hovered || this.data.ui.last_selected;
                    if (G && G.length) {
                        if (G.hasClass("jstree-closed")) {
                            this.open_node(G)
                        } else {
                            this.hover_node(this._get_next(G))
                        }
                    }
                    return false
                },
                space: function() {
                    if (this.data.ui.hovered) {
                        this.data.ui.hovered.children("a:eq(0)").click()
                    }
                    return false
                },
                "ctrl+space": function(G) {
                    G.type = "click";
                    if (this.data.ui.hovered) {
                        this.data.ui.hovered.children("a:eq(0)").trigger(G)
                    }
                    return false
                },
                "shift+space": function(G) {
                    G.type = "click";
                    if (this.data.ui.hovered) {
                        this.data.ui.hovered.children("a:eq(0)").trigger(G)
                    }
                    return false
                },
                f2: function() {
                    this.rename(this.data.ui.hovered || this.data.ui.last_selected)
                },
                del: function() {
                    this.remove(this.data.ui.hovered || this._get_node(null))
                }
            },
            _fn: {
                enable_hotkeys: function() {
                    this.data.hotkeys.enabled = true
                },
                disable_hotkeys: function() {
                    this.data.hotkeys.enabled = false
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("json_data", {
            __init: function() {
                var E = this._get_settings().json_data;
                if (E.progressive_unload) {
                    this.get_container().bind("after_close.jstree", function(G, F) {
                        F.rslt.obj.children("ul").remove()
                    })
                }
            },
            defaults: {
                data: false,
                ajax: false,
                correct_state: true,
                progressive_render: false,
                progressive_unload: false
            },
            _fn: {
                load_node: function(G, E, F) {
                    var H = this;
                    this.load_node_json(G, function() {
                        H.__callback({
                            obj: H._get_node(G)
                        });
                        E.call(this)
                    }, F)
                },
                _is_loaded: function(F) {
                    var E = this._get_settings().json_data;
                    F = this._get_node(F);
                    return F == -1 || !F || (!E.ajax && !E.progressive_render && !D.isFunction(E.data)) || F.is(".jstree-open, .jstree-leaf") || F.children("ul").children("li").length > 0
                },
                refresh: function(F) {
                    F = this._get_node(F);
                    var E = this._get_settings().json_data;
                    if (F && F !== -1 && E.progressive_unload && (D.isFunction(E.data) || !!E.ajax)) {
                        F.removeData("jstree_children")
                    }
                    return this.__call_old()
                },
                load_node_json: function(I, E, G) {
                    var H = this.get_settings().json_data, K, F = function() {}, J = function() {};
                    I = this._get_node(I);
                    if (I && I !== -1 && (H.progressive_render || H.progressive_unload) && !I.is(".jstree-open, .jstree-leaf") && I.children("ul").children("li").length === 0 && I.data("jstree_children")) {
                        K = this._parse_json(I.data("jstree_children"), I);
                        if (K) {
                            I.append(K);
                            if (!H.progressive_unload) {
                                I.removeData("jstree_children")
                            }
                        }
                        this.clean_node(I);
                        if (E) {
                            E.call(this)
                        }
                        return
                    }
                    if (I && I !== -1) {
                        if (I.data("jstree_is_loading")) {
                            return
                        } else {
                            I.data("jstree_is_loading", true)
                        }
                    }
                    switch (!0) {
                    case (!H.data && !H.ajax):
                        throw "Neither data nor ajax settings supplied.";
                    case (D.isFunction(H.data)):
                        H.data.call(this, I, D.proxy(function(L) {
                            L = this._parse_json(L, I);
                            if (!L) {
                                if (I === -1 || !I) {
                                    if (H.correct_state) {
                                        this.get_container().children("ul").empty()
                                    }
                                } else {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading");
                                    if (H.correct_state) {
                                        this.correct_state(I)
                                    }
                                }
                                if (G) {
                                    G.call(this)
                                }
                            } else {
                                if (I === -1 || !I) {
                                    this.get_container().children("ul").empty().append(L.children())
                                } else {
                                    I.append(L).children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading")
                                }
                                this.clean_node(I);
                                if (E) {
                                    E.call(this)
                                }
                            }
                        }, this));
                        break;
                    case (!!H.data && !H.ajax) || (!!H.data && !!H.ajax && (!I || I === -1)):
                        if (!I || I == -1) {
                            K = this._parse_json(H.data, I);
                            if (K) {
                                this.get_container().children("ul").empty().append(K.children());
                                this.clean_node()
                            } else {
                                if (H.correct_state) {
                                    this.get_container().children("ul").empty()
                                }
                            }
                        }
                        if (E) {
                            E.call(this)
                        }
                        break;
                    case (!H.data && !!H.ajax) || (!!H.data && !!H.ajax && I && I !== -1):
                        F = function(M, N, O) {
                            var L = this.get_settings().json_data.ajax.error;
                            if (L) {
                                L.call(this, M, N, O)
                            }
                            if (I != -1 && I.length) {
                                I.children("a.jstree-loading").removeClass("jstree-loading");
                                I.removeData("jstree_is_loading");
                                if (N === "success" && H.correct_state) {
                                    this.correct_state(I)
                                }
                            } else {
                                if (N === "success" && H.correct_state) {
                                    this.get_container().children("ul").empty()
                                }
                            }
                            if (G) {
                                G.call(this)
                            }
                        }
                        ;
                        J = function(O, M, L) {
                            var N = this.get_settings().json_data.ajax.success;
                            if (N) {
                                O = N.call(this, O, M, L) || O
                            }
                            if (O === "" || (O && O.toString && O.toString().replace(/^[\s\n]+$/, "") === "") || (!D.isArray(O) && !D.isPlainObject(O))) {
                                return F.call(this, L, M, "")
                            }
                            O = this._parse_json(O, I);
                            if (O) {
                                if (I === -1 || !I) {
                                    this.get_container().children("ul").empty().append(O.children())
                                } else {
                                    I.append(O).children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading")
                                }
                                this.clean_node(I);
                                if (E) {
                                    E.call(this)
                                }
                            } else {
                                if (I === -1 || !I) {
                                    if (H.correct_state) {
                                        this.get_container().children("ul").empty();
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                } else {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading");
                                    if (H.correct_state) {
                                        this.correct_state(I);
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                }
                            }
                        }
                        ;
                        H.ajax.context = this;
                        H.ajax.error = F;
                        H.ajax.success = J;
                        if (!H.ajax.dataType) {
                            H.ajax.dataType = "json"
                        }
                        if (D.isFunction(H.ajax.url)) {
                            H.ajax.url = H.ajax.url.call(this, I)
                        }
                        if (D.isFunction(H.ajax.data)) {
                            H.ajax.data = H.ajax.data.call(this, I)
                        }
                        D.ajax(H.ajax);
                        break
                    }
                },
                _parse_json: function(E, I, N) {
                    var K = false, F = this._get_settings(), P = F.json_data, O = F.core.html_titles, J, H, G, M, L;
                    if (!E) {
                        return K
                    }
                    if (P.progressive_unload && I && I !== -1) {
                        I.data("jstree_children", K)
                    }
                    if (D.isArray(E)) {
                        K = D();
                        if (!E.length) {
                            return false
                        }
                        for (H = 0,
                        G = E.length; H < G; H++) {
                            J = this._parse_json(E[H], I, true);
                            if (J.length) {
                                K = K.add(J)
                            }
                        }
                    } else {
                        if (typeof E == "string") {
                            E = {
                                data: E
                            }
                        }
                        if (!E.data && E.data !== "") {
                            return K
                        }
                        K = D("<li />");
                        if (E.attr) {
                            K.attr(E.attr)
                        }
                        if (E.metadata) {
                            K.data(E.metadata)
                        }
                        if (E.state) {
                            K.addClass("jstree-" + E.state)
                        }
                        if (!D.isArray(E.data)) {
                            J = E.data;
                            E.data = [];
                            E.data.push(J)
                        }
                        D.each(E.data, function(R, Q) {
                            J = D("<a />");
                            if (D.isFunction(Q)) {
                                Q = Q.call(this, E)
                            }
                            if (typeof Q == "string") {
                                J.attr("href", "#")[O ? "html" : "text"](Q)
                            } else {
                                if (!Q.attr) {
                                    Q.attr = {}
                                }
                                if (!Q.attr.href) {
                                    Q.attr.href = "#"
                                }
                                J.attr(Q.attr)[O ? "html" : "text"](Q.title);
                                if (Q.language) {
                                    J.addClass(Q.language)
                                }
                            }
                            J.prepend("<ins class='jstree-icon'>&#160;</ins>");
                            if (!Q.icon && E.icon) {
                                Q.icon = E.icon
                            }
                            if (Q.icon) {
                                if (Q.icon.indexOf("/") === -1) {
                                    J.children("ins").addClass(Q.icon)
                                } else {
                                    J.children("ins").css("background", "url('" + Q.icon + "') center center no-repeat")
                                }
                            }
                            K.append(J)
                        });
                        K.prepend("<ins class='jstree-icon'>&#160;</ins>");
                        if (E.children) {
                            if (P.progressive_render && E.state !== "open") {
                                K.addClass("jstree-closed").data("jstree_children", E.children)
                            } else {
                                if (P.progressive_unload) {
                                    K.data("jstree_children", E.children)
                                }
                                if (D.isArray(E.children) && E.children.length) {
                                    J = this._parse_json(E.children, I, true);
                                    if (J.length) {
                                        L = D("<ul />");
                                        L.append(J);
                                        K.append(L)
                                    }
                                }
                            }
                        }
                    }
                    if (!N) {
                        M = D("<ul />");
                        M.append(K);
                        K = M
                    }
                    return K
                },
                get_json: function(J, G, E, N) {
                    var Q = [], P = this._get_settings(), K = this, I, H, M, L, O, F;
                    J = this._get_node(J);
                    if (!J || J === -1) {
                        J = this.get_container().find("> ul > li")
                    }
                    G = D.isArray(G) ? G : ["id", "class"];
                    if (!N && this.data.types) {
                        G.push(P.types.type_attr)
                    }
                    E = D.isArray(E) ? E : [];
                    J.each(function() {
                        M = D(this);
                        I = {
                            data: []
                        };
                        if (G.length) {
                            I.attr = {}
                        }
                        D.each(G, function(S, R) {
                            H = M.attr(R);
                            if (H && H.length && H.replace(/jstree[^ ]*/ig, "").length) {
                                I.attr[R] = (" " + H).replace(/ jstree[^ ]*/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")
                            }
                        });
                        if (M.hasClass("jstree-open")) {
                            I.state = "open"
                        }
                        if (M.hasClass("jstree-closed")) {
                            I.state = "closed"
                        }
                        if (M.data()) {
                            I.metadata = M.data()
                        }
                        L = M.children("a");
                        L.each(function() {
                            O = D(this);
                            if (E.length || D.inArray("languages", P.plugins) !== -1 || O.children("ins").get(0).style.backgroundImage.length || (O.children("ins").get(0).className && O.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig, "").length)) {
                                F = false;
                                if (D.inArray("languages", P.plugins) !== -1 && D.isArray(P.languages) && P.languages.length) {
                                    D.each(P.languages, function(R, S) {
                                        if (O.hasClass(S)) {
                                            F = S;
                                            return false
                                        }
                                    })
                                }
                                H = {
                                    attr: {},
                                    title: K.get_text(O, F)
                                };
                                D.each(E, function(R, S) {
                                    H.attr[S] = (" " + (O.attr(S) || "")).replace(/ jstree[^ ]*/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")
                                });
                                if (D.inArray("languages", P.plugins) !== -1 && D.isArray(P.languages) && P.languages.length) {
                                    D.each(P.languages, function(R, S) {
                                        if (O.hasClass(S)) {
                                            H.language = S;
                                            return true
                                        }
                                    })
                                }
                                if (O.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig, "").replace(/^\s+$/ig, "").length) {
                                    H.icon = O.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")
                                }
                                if (O.children("ins").get(0).style.backgroundImage.length) {
                                    H.icon = O.children("ins").get(0).style.backgroundImage.replace("url(", "").replace(")", "")
                                }
                            } else {
                                H = K.get_text(O)
                            }
                            if (L.length > 1) {
                                I.data.push(H)
                            } else {
                                I.data = H
                            }
                        });
                        M = M.find("> ul > li");
                        if (M.length) {
                            I.children = K.get_json(M, G, E, true)
                        }
                        Q.push(I)
                    });
                    return Q
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("languages", {
            __init: function() {
                this._load_css()
            },
            defaults: [],
            _fn: {
                set_lang: function(G) {
                    var H = this._get_settings().languages
                      , F = false
                      , E = ".jstree-" + this.get_index() + " a";
                    if (!D.isArray(H) || H.length === 0) {
                        return false
                    }
                    if (D.inArray(G, H) == -1) {
                        if (!!H[G]) {
                            G = H[G]
                        } else {
                            return false
                        }
                    }
                    if (G == this.data.languages.current_language) {
                        return true
                    }
                    F = D.vakata.css.get_css(E + "." + this.data.languages.current_language, false, this.data.languages.language_css);
                    if (F !== false) {
                        F.style.display = "none"
                    }
                    F = D.vakata.css.get_css(E + "." + G, false, this.data.languages.language_css);
                    if (F !== false) {
                        F.style.display = ""
                    }
                    this.data.languages.current_language = G;
                    this.__callback(G);
                    return true
                },
                get_lang: function() {
                    return this.data.languages.current_language
                },
                _get_string: function(E, H) {
                    var G = this._get_settings().languages
                      , F = this._get_settings().core.strings;
                    if (D.isArray(G) && G.length) {
                        H = (H && D.inArray(H, G) != -1) ? H : this.data.languages.current_language
                    }
                    if (F[H] && F[H][E]) {
                        return F[H][E]
                    }
                    if (F[E]) {
                        return F[E]
                    }
                    return E
                },
                get_text: function(G, H) {
                    G = this._get_node(G) || this.data.ui.last_selected;
                    if (!G.size()) {
                        return false
                    }
                    var F = this._get_settings().languages
                      , E = this._get_settings().core.html_titles;
                    if (D.isArray(F) && F.length) {
                        H = (H && D.inArray(H, F) != -1) ? H : this.data.languages.current_language;
                        G = G.children("a." + H)
                    } else {
                        G = G.children("a:eq(0)")
                    }
                    if (E) {
                        G = G.clone();
                        G.children("INS").remove();
                        return G.html()
                    } else {
                        G = G.contents().filter(function() {
                            return this.nodeType == 3
                        })[0];
                        return G.nodeValue
                    }
                },
                set_text: function(H, J, I) {
                    H = this._get_node(H) || this.data.ui.last_selected;
                    if (!H.size()) {
                        return false
                    }
                    var G = this._get_settings().languages, F = this._get_settings().core.html_titles, E;
                    if (D.isArray(G) && G.length) {
                        I = (I && D.inArray(I, G) != -1) ? I : this.data.languages.current_language;
                        H = H.children("a." + I)
                    } else {
                        H = H.children("a:eq(0)")
                    }
                    if (F) {
                        E = H.children("INS").clone();
                        H.html(J).prepend(E);
                        this.__callback({
                            obj: H,
                            name: J,
                            lang: I
                        });
                        return true
                    } else {
                        H = H.contents().filter(function() {
                            return this.nodeType == 3
                        })[0];
                        this.__callback({
                            obj: H,
                            name: J,
                            lang: I
                        });
                        return ( H.nodeValue = J)
                    }
                },
                _load_css: function() {
                    var G = this._get_settings().languages, H = "/* languages css */", E = ".jstree-" + this.get_index() + " a", F;
                    if (D.isArray(G) && G.length) {
                        this.data.languages.current_language = G[0];
                        for (F = 0; F < G.length; F++) {
                            H += E + "." + G[F] + " {";
                            if (G[F] != this.data.languages.current_language) {
                                H += " display:none; "
                            }
                            H += " } "
                        }
                        this.data.languages.language_css = D.vakata.css.add_sheet({
                            str: H,
                            title: "jstree-languages"
                        })
                    }
                },
                create_node: function(H, E, G, I) {
                    var F = this.__call_old(true, H, E, G, function(K) {
                        var M = this._get_settings().languages, J = K.children("a"), L;
                        if (D.isArray(M) && M.length) {
                            for (L = 0; L < M.length; L++) {
                                if (!J.is("." + M[L])) {
                                    K.append(J.eq(0).clone().removeClass(M.join(" ")).addClass(M[L]))
                                }
                            }
                            J.not("." + M.join(", .")).remove()
                        }
                        if (I) {
                            I.call(this, K)
                        }
                    });
                    return F
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("cookies", {
            __init: function() {
                if (typeof D.cookie === "undefined") {
                    throw "jsTree cookie: jQuery cookie plugin not included."
                }
                var F = this._get_settings().cookies, E;
                if (!!F.save_loaded) {
                    E = D.cookie(F.save_loaded);
                    if (E && E.length) {
                        this.data.core.to_load = E.split(",")
                    }
                }
                if (!!F.save_opened) {
                    E = D.cookie(F.save_opened);
                    if (E && E.length) {
                        this.data.core.to_open = E.split(",")
                    }
                }
                if (!!F.save_selected) {
                    E = D.cookie(F.save_selected);
                    if (E && E.length && this.data.ui) {
                        this.data.ui.to_select = E.split(",")
                    }
                }
                this.get_container().one((this.data.ui ? "reselect" : "reopen") + ".jstree", D.proxy(function() {
                    this.get_container().bind("open_node.jstree close_node.jstree select_node.jstree deselect_node.jstree", D.proxy(function(G) {
                        if (this._get_settings().cookies.auto_save) {
                            this.save_cookie((G.handleObj.namespace + G.handleObj.type).replace("jstree", ""))
                        }
                    }, this))
                }, this))
            },
            defaults: {
                save_loaded: "jstree_load",
                save_opened: "jstree_open",
                save_selected: "jstree_select",
                auto_save: true,
                cookie_options: {}
            },
            _fn: {
                save_cookie: function(F) {
                    if (this.data.core.refreshing) {
                        return
                    }
                    var E = this._get_settings().cookies;
                    if (!F) {
                        if (E.save_loaded) {
                            this.save_loaded();
                            D.cookie(E.save_loaded, this.data.core.to_load.join(","), E.cookie_options)
                        }
                        if (E.save_opened) {
                            this.save_opened();
                            D.cookie(E.save_opened, this.data.core.to_open.join(","), E.cookie_options)
                        }
                        if (E.save_selected && this.data.ui) {
                            this.save_selected();
                            D.cookie(E.save_selected, this.data.ui.to_select.join(","), E.cookie_options)
                        }
                        return
                    }
                    switch (F) {
                    case "open_node":
                    case "close_node":
                        if (!!E.save_opened) {
                            this.save_opened();
                            D.cookie(E.save_opened, this.data.core.to_open.join(","), E.cookie_options)
                        }
                        if (!!E.save_loaded) {
                            this.save_loaded();
                            D.cookie(E.save_loaded, this.data.core.to_load.join(","), E.cookie_options)
                        }
                        break;
                    case "select_node":
                    case "deselect_node":
                        if (!!E.save_selected && this.data.ui) {
                            this.save_selected();
                            D.cookie(E.save_selected, this.data.ui.to_select.join(","), E.cookie_options)
                        }
                        break
                    }
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("sort", {
            __init: function() {
                this.get_container().bind("load_node.jstree", D.proxy(function(G, E) {
                    var F = this._get_node(E.rslt.obj);
                    F = F === -1 ? this.get_container().children("ul") : F.children("ul");
                    this.sort(F)
                }, this)).bind("rename_node.jstree create_node.jstree create.jstree", D.proxy(function(F, E) {
                    this.sort(E.rslt.obj.parent())
                }, this)).bind("move_node.jstree", D.proxy(function(G, F) {
                    var E = F.rslt.np == -1 ? this.get_container() : F.rslt.np;
                    this.sort(E.children("ul"))
                }, this))
            },
            defaults: function(F, E) {
                return this.get_text(F) > this.get_text(E) ? 1 : -1
            },
            _fn: {
                sort: function(G) {
                    var F = this._get_settings().sort
                      , E = this;
                    G.append(D.makeArray(G.children("li")).sort(D.proxy(F, E)));
                    G.find("> li > ul").each(function() {
                        E.sort(D(this))
                    });
                    this.clean_node(G)
                }
            }
        })
    })(jQuery);
    (function(J) {
        var F = false
          , D = false
          , G = false
          , H = false
          , K = false
          , E = false
          , M = false
          , L = false
          , I = false;
        J.vakata.dnd = {
            is_down: false,
            is_drag: false,
            helper: false,
            scroll_spd: 10,
            init_x: 0,
            init_y: 0,
            threshold: 5,
            helper_left: 5,
            helper_top: 10,
            user_data: {},
            drag_start: function(Q, P, N) {
                if (J.vakata.dnd.is_drag) {
                    J.vakata.drag_stop({})
                }
                try {
                    Q.currentTarget.unselectable = "on";
                    Q.currentTarget.onselectstart = function() {
                        return false
                    }
                    ;
                    if (Q.currentTarget.style) {
                        Q.currentTarget.style.MozUserSelect = "none"
                    }
                } catch (O) {}
                J.vakata.dnd.init_x = Q.pageX;
                J.vakata.dnd.init_y = Q.pageY;
                J.vakata.dnd.user_data = P;
                J.vakata.dnd.is_down = true;
                J.vakata.dnd.helper = J("<div id='vakata-dragged' />").html(N);
                J(document).bind("mousemove", J.vakata.dnd.drag);
                J(document).bind("mouseup", J.vakata.dnd.drag_stop);
                return false
            },
            drag: function(P) {
                if (!J.vakata.dnd.is_down) {
                    return
                }
                if (!J.vakata.dnd.is_drag) {
                    if (Math.abs(P.pageX - J.vakata.dnd.init_x) > 5 || Math.abs(P.pageY - J.vakata.dnd.init_y) > 5) {
                        J.vakata.dnd.helper.appendTo("body");
                        J.vakata.dnd.is_drag = true;
                        J(document).triggerHandler("drag_start.vakata", {
                            event: P,
                            data: J.vakata.dnd.user_data
                        })
                    } else {
                        return
                    }
                }
                if (P.type === "mousemove") {
                    var Q = J(document)
                      , O = Q.scrollTop()
                      , N = Q.scrollLeft();
                    if (P.pageY - O < 20) {
                        if (E && M === "down") {
                            clearInterval(E);
                            E = false
                        }
                        if (!E) {
                            M = "up";
                            E = setInterval(function() {
                                J(document).scrollTop(J(document).scrollTop() - J.vakata.dnd.scroll_spd)
                            }, 150)
                        }
                    } else {
                        if (E && M === "up") {
                            clearInterval(E);
                            E = false
                        }
                    }
                    if (J(window).height() - (P.pageY - O) < 20) {
                        if (E && M === "up") {
                            clearInterval(E);
                            E = false
                        }
                        if (!E) {
                            M = "down";
                            E = setInterval(function() {
                                J(document).scrollTop(J(document).scrollTop() + J.vakata.dnd.scroll_spd)
                            }, 150)
                        }
                    } else {
                        if (E && M === "down") {
                            clearInterval(E);
                            E = false
                        }
                    }
                    if (P.pageX - N < 20) {
                        if (K && L === "right") {
                            clearInterval(K);
                            K = false
                        }
                        if (!K) {
                            L = "left";
                            K = setInterval(function() {
                                J(document).scrollLeft(J(document).scrollLeft() - J.vakata.dnd.scroll_spd)
                            }, 150)
                        }
                    } else {
                        if (K && L === "left") {
                            clearInterval(K);
                            K = false
                        }
                    }
                    if (J(window).width() - (P.pageX - N) < 20) {
                        if (K && L === "left") {
                            clearInterval(K);
                            K = false
                        }
                        if (!K) {
                            L = "right";
                            K = setInterval(function() {
                                J(document).scrollLeft(J(document).scrollLeft() + J.vakata.dnd.scroll_spd)
                            }, 150)
                        }
                    } else {
                        if (K && L === "right") {
                            clearInterval(K);
                            K = false
                        }
                    }
                }
                J.vakata.dnd.helper.css({
                    left: (P.pageX + J.vakata.dnd.helper_left) + "px",
                    top: (P.pageY + J.vakata.dnd.helper_top) + "px"
                });
                J(document).triggerHandler("drag.vakata", {
                    event: P,
                    data: J.vakata.dnd.user_data
                })
            },
            drag_stop: function(N) {
                if (K) {
                    clearInterval(K)
                }
                if (E) {
                    clearInterval(E)
                }
                J(document).unbind("mousemove", J.vakata.dnd.drag);
                J(document).unbind("mouseup", J.vakata.dnd.drag_stop);
                J(document).triggerHandler("drag_stop.vakata", {
                    event: N,
                    data: J.vakata.dnd.user_data
                });
                J.vakata.dnd.helper.remove();
                J.vakata.dnd.init_x = 0;
                J.vakata.dnd.init_y = 0;
                J.vakata.dnd.user_data = {};
                J.vakata.dnd.is_down = false;
                J.vakata.dnd.is_drag = false
            }
        };
        J(function() {
            var N = "#vakata-dragged { display:block; margin:0 0 0 0; padding:4px 4px 4px 24px; position:absolute; top:-2000px; line-height:16px; z-index:10000; } ";
            J.vakata.css.add_sheet({
                str: N,
                title: "vakata"
            })
        });
        J.jstree.plugin("dnd", {
            __init: function() {
                this.data.dnd = {
                    active: false,
                    after: false,
                    inside: false,
                    before: false,
                    off: false,
                    prepared: false,
                    w: 0,
                    to1: false,
                    to2: false,
                    cof: false,
                    cw: false,
                    ch: false,
                    i1: false,
                    i2: false,
                    mto: false
                };
                this.get_container().bind("mouseenter.jstree", J.proxy(function(Q) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        if (this.data.themes) {
                            G.attr("class", "jstree-" + this.data.themes.theme);
                            if (H) {
                                H.attr("class", "jstree-" + this.data.themes.theme)
                            }
                            J.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme)
                        }
                        if (Q.currentTarget === Q.target && J.vakata.dnd.user_data.obj && J(J.vakata.dnd.user_data.obj).length && J(J.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0] !== Q.target) {
                            var P = J.jstree._reference(Q.target), O;
                            if (P.data.dnd.foreign) {
                                O = P._get_settings().dnd.drag_check.call(this, {
                                    o: F,
                                    r: P.get_container(),
                                    is_root: true
                                });
                                if (O === true || O.inside === true || O.before === true || O.after === true) {
                                    J.vakata.dnd.helper.children("ins").attr("class", "jstree-ok")
                                }
                            } else {
                                P.prepare_move(F, P.get_container(), "last");
                                if (P.check_move()) {
                                    J.vakata.dnd.helper.children("ins").attr("class", "jstree-ok")
                                }
                            }
                        }
                    }
                }, this)).bind("mouseup.jstree", J.proxy(function(Q) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree && Q.currentTarget === Q.target && J.vakata.dnd.user_data.obj && J(J.vakata.dnd.user_data.obj).length && J(J.vakata.dnd.user_data.obj).parents(".jstree:eq(0)")[0] !== Q.target) {
                        var P = J.jstree._reference(Q.currentTarget), O;
                        if (P.data.dnd.foreign) {
                            O = P._get_settings().dnd.drag_check.call(this, {
                                o: F,
                                r: P.get_container(),
                                is_root: true
                            });
                            if (O === true || O.inside === true || O.before === true || O.after === true) {
                                P._get_settings().dnd.drag_finish.call(this, {
                                    o: F,
                                    r: P.get_container(),
                                    is_root: true
                                })
                            }
                        } else {
                            P.move_node(F, P.get_container(), "last", Q[P._get_settings().dnd.copy_modifier + "Key"])
                        }
                    }
                }, this)).bind("mouseleave.jstree", J.proxy(function(O) {
                    if (O.relatedTarget && O.relatedTarget.id && O.relatedTarget.id === "jstree-marker-line") {
                        return false
                    }
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        if (this.data.dnd.i1) {
                            clearInterval(this.data.dnd.i1)
                        }
                        if (this.data.dnd.i2) {
                            clearInterval(this.data.dnd.i2)
                        }
                        if (this.data.dnd.to1) {
                            clearTimeout(this.data.dnd.to1)
                        }
                        if (this.data.dnd.to2) {
                            clearTimeout(this.data.dnd.to2)
                        }
                        if (J.vakata.dnd.helper.children("ins").hasClass("jstree-ok")) {
                            J.vakata.dnd.helper.children("ins").attr("class", "jstree-invalid")
                        }
                    }
                }, this)).bind("mousemove.jstree", J.proxy(function(P) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        var O = this.get_container()[0];
                        if (P.pageX + 24 > this.data.dnd.cof.left + this.data.dnd.cw) {
                            if (this.data.dnd.i1) {
                                clearInterval(this.data.dnd.i1)
                            }
                            this.data.dnd.i1 = setInterval(J.proxy(function() {
                                this.scrollLeft += J.vakata.dnd.scroll_spd
                            }, O), 100)
                        } else {
                            if (P.pageX - 24 < this.data.dnd.cof.left) {
                                if (this.data.dnd.i1) {
                                    clearInterval(this.data.dnd.i1)
                                }
                                this.data.dnd.i1 = setInterval(J.proxy(function() {
                                    this.scrollLeft -= J.vakata.dnd.scroll_spd
                                }, O), 100)
                            } else {
                                if (this.data.dnd.i1) {
                                    clearInterval(this.data.dnd.i1)
                                }
                            }
                        }
                        if (P.pageY + 24 > this.data.dnd.cof.top + this.data.dnd.ch) {
                            if (this.data.dnd.i2) {
                                clearInterval(this.data.dnd.i2)
                            }
                            this.data.dnd.i2 = setInterval(J.proxy(function() {
                                this.scrollTop += J.vakata.dnd.scroll_spd
                            }, O), 100)
                        } else {
                            if (P.pageY - 24 < this.data.dnd.cof.top) {
                                if (this.data.dnd.i2) {
                                    clearInterval(this.data.dnd.i2)
                                }
                                this.data.dnd.i2 = setInterval(J.proxy(function() {
                                    this.scrollTop -= J.vakata.dnd.scroll_spd
                                }, O), 100)
                            } else {
                                if (this.data.dnd.i2) {
                                    clearInterval(this.data.dnd.i2)
                                }
                            }
                        }
                    }
                }, this)).bind("scroll.jstree", J.proxy(function(O) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree && G && H) {
                        G.hide();
                        H.hide()
                    }
                }, this)).delegate("a", "mousedown.jstree", J.proxy(function(O) {
                    if (O.which === 1) {
                        this.start_drag(O.currentTarget, O);
                        return false
                    }
                }, this)).delegate("a", "mouseenter.jstree", J.proxy(function(O) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        this.dnd_enter(O.currentTarget)
                    }
                }, this)).delegate("a", "mousemove.jstree", J.proxy(function(O) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        if (!D || !D.length || D.children("a")[0] !== O.currentTarget) {
                            this.dnd_enter(O.currentTarget)
                        }
                        if (typeof this.data.dnd.off.top === "undefined") {
                            this.data.dnd.off = J(O.target).offset()
                        }
                        this.data.dnd.w = (O.pageY - (this.data.dnd.off.top || 0)) % this.data.core.li_height;
                        if (this.data.dnd.w < 0) {
                            this.data.dnd.w += this.data.core.li_height
                        }
                        this.dnd_show()
                    }
                }, this)).delegate("a", "mouseleave.jstree", J.proxy(function(O) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        if (O.relatedTarget && O.relatedTarget.id && O.relatedTarget.id === "jstree-marker-line") {
                            return false
                        }
                        if (G) {
                            G.hide()
                        }
                        if (H) {
                            H.hide()
                        }
                        this.data.dnd.mto = setTimeout((function(P) {
                            return function() {
                                P.dnd_leave(O)
                            }
                        })(this), 0)
                    }
                }, this)).delegate("a", "mouseup.jstree", J.proxy(function(O) {
                    if (J.vakata.dnd.is_drag && J.vakata.dnd.user_data.jstree) {
                        this.dnd_finish(O)
                    }
                }, this));
                J(document).bind("drag_stop.vakata", J.proxy(function() {
                    if (this.data.dnd.to1) {
                        clearTimeout(this.data.dnd.to1)
                    }
                    if (this.data.dnd.to2) {
                        clearTimeout(this.data.dnd.to2)
                    }
                    if (this.data.dnd.i1) {
                        clearInterval(this.data.dnd.i1)
                    }
                    if (this.data.dnd.i2) {
                        clearInterval(this.data.dnd.i2)
                    }
                    this.data.dnd.after = false;
                    this.data.dnd.before = false;
                    this.data.dnd.inside = false;
                    this.data.dnd.off = false;
                    this.data.dnd.prepared = false;
                    this.data.dnd.w = false;
                    this.data.dnd.to1 = false;
                    this.data.dnd.to2 = false;
                    this.data.dnd.i1 = false;
                    this.data.dnd.i2 = false;
                    this.data.dnd.active = false;
                    this.data.dnd.foreign = false;
                    if (G) {
                        G.css({
                            top: "-2000px"
                        })
                    }
                    if (H) {
                        H.css({
                            top: "-2000px"
                        })
                    }
                }, this)).bind("drag_start.vakata", J.proxy(function(Q, O) {
                    if (O.data.jstree) {
                        var P = J(O.event.target);
                        if (P.closest(".jstree").hasClass("jstree-" + this.get_index())) {
                            this.dnd_enter(P)
                        }
                    }
                }, this));
                var N = this._get_settings().dnd;
                if (N.drag_target) {
                    J(document).delegate(N.drag_target, "mousedown.jstree-" + this.get_index(), J.proxy(function(P) {
                        F = P.target;
                        J.vakata.dnd.drag_start(P, {
                            jstree: true,
                            obj: P.target
                        }, "<ins class='jstree-icon'></ins>" + J(P.target).text());
                        if (this.data.themes) {
                            if (G) {
                                G.attr("class", "jstree-" + this.data.themes.theme)
                            }
                            if (H) {
                                H.attr("class", "jstree-" + this.data.themes.theme)
                            }
                            J.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme)
                        }
                        J.vakata.dnd.helper.children("ins").attr("class", "jstree-invalid");
                        var O = this.get_container();
                        this.data.dnd.cof = O.offset();
                        this.data.dnd.cw = parseInt(O.width(), 10);
                        this.data.dnd.ch = parseInt(O.height(), 10);
                        this.data.dnd.foreign = true;
                        P.preventDefault()
                    }, this))
                }
                if (N.drop_target) {
                    J(document).delegate(N.drop_target, "mouseenter.jstree-" + this.get_index(), J.proxy(function(O) {
                        if (this.data.dnd.active && this._get_settings().dnd.drop_check.call(this, {
                            o: F,
                            r: J(O.target),
                            e: O
                        })) {
                            J.vakata.dnd.helper.children("ins").attr("class", "jstree-ok")
                        }
                    }, this)).delegate(N.drop_target, "mouseleave.jstree-" + this.get_index(), J.proxy(function(O) {
                        if (this.data.dnd.active) {
                            J.vakata.dnd.helper.children("ins").attr("class", "jstree-invalid")
                        }
                    }, this)).delegate(N.drop_target, "mouseup.jstree-" + this.get_index(), J.proxy(function(O) {
                        if (this.data.dnd.active && J.vakata.dnd.helper.children("ins").hasClass("jstree-ok")) {
                            this._get_settings().dnd.drop_finish.call(this, {
                                o: F,
                                r: J(O.target),
                                e: O
                            })
                        }
                    }, this))
                }
            },
            defaults: {
                copy_modifier: "ctrl",
                check_timeout: 100,
                open_timeout: 500,
                drop_target: ".jstree-drop",
                drop_check: function(N) {
                    return true
                },
                drop_finish: J.noop,
                drag_target: ".jstree-draggable",
                drag_finish: J.noop,
                drag_check: function(N) {
                    return {
                        after: false,
                        before: false,
                        inside: true
                    }
                }
            },
            _fn: {
                dnd_prepare: function() {
                    if (!D || !D.length) {
                        return
                    }
                    this.data.dnd.off = D.offset();
                    if (this._get_settings().core.rtl) {
                        this.data.dnd.off.right = this.data.dnd.off.left + D.width()
                    }
                    if (this.data.dnd.foreign) {
                        var N = this._get_settings().dnd.drag_check.call(this, {
                            o: F,
                            r: D
                        });
                        this.data.dnd.after = N.after;
                        this.data.dnd.before = N.before;
                        this.data.dnd.inside = N.inside;
                        this.data.dnd.prepared = true;
                        return this.dnd_show()
                    }
                    this.prepare_move(F, D, "before");
                    this.data.dnd.before = this.check_move();
                    this.prepare_move(F, D, "after");
                    this.data.dnd.after = this.check_move();
                    if (this._is_loaded(D)) {
                        this.prepare_move(F, D, "inside");
                        this.data.dnd.inside = this.check_move()
                    } else {
                        this.data.dnd.inside = false
                    }
                    this.data.dnd.prepared = true;
                    return this.dnd_show()
                },
                dnd_show: function() {
                    if (!this.data.dnd.prepared) {
                        return
                    }
                    var P = ["before", "inside", "after"], N = false, O = this._get_settings().core.rtl, Q;
                    if (this.data.dnd.w < this.data.core.li_height / 3) {
                        P = ["before", "inside", "after"]
                    } else {
                        if (this.data.dnd.w <= this.data.core.li_height * 2 / 3) {
                            P = this.data.dnd.w < this.data.core.li_height / 2 ? ["inside", "before", "after"] : ["inside", "after", "before"]
                        } else {
                            P = ["after", "inside", "before"]
                        }
                    }
                    J.each(P, J.proxy(function(R, S) {
                        if (this.data.dnd[S]) {
                            J.vakata.dnd.helper.children("ins").attr("class", "jstree-ok");
                            N = S;
                            return false
                        }
                    }, this));
                    if (N === false) {
                        J.vakata.dnd.helper.children("ins").attr("class", "jstree-invalid")
                    }
                    Q = O ? (this.data.dnd.off.right - 18) : (this.data.dnd.off.left + 10);
                    switch (N) {
                    case "before":
                        G.css({
                            left: Q + "px",
                            top: (this.data.dnd.off.top - 6) + "px"
                        }).show();
                        if (H) {
                            H.css({
                                left: (Q + 8) + "px",
                                top: (this.data.dnd.off.top - 1) + "px"
                            }).show()
                        }
                        break;
                    case "after":
                        G.css({
                            left: Q + "px",
                            top: (this.data.dnd.off.top + this.data.core.li_height - 6) + "px"
                        }).show();
                        if (H) {
                            H.css({
                                left: (Q + 8) + "px",
                                top: (this.data.dnd.off.top + this.data.core.li_height - 1) + "px"
                            }).show()
                        }
                        break;
                    case "inside":
                        G.css({
                            left: Q + (O ? -4 : 4) + "px",
                            top: (this.data.dnd.off.top + this.data.core.li_height / 2 - 5) + "px"
                        }).show();
                        if (H) {
                            H.hide()
                        }
                        break;
                    default:
                        G.hide();
                        if (H) {
                            H.hide()
                        }
                        break
                    }
                    I = N;
                    return N
                },
                dnd_open: function() {
                    this.data.dnd.to2 = false;
                    this.open_node(D, J.proxy(this.dnd_prepare, this), true)
                },
                dnd_finish: function(N) {
                    if (this.data.dnd.foreign) {
                        if (this.data.dnd.after || this.data.dnd.before || this.data.dnd.inside) {
                            this._get_settings().dnd.drag_finish.call(this, {
                                o: F,
                                r: D,
                                p: I
                            })
                        }
                    } else {
                        this.dnd_prepare();
                        this.move_node(F, D, I, N[this._get_settings().dnd.copy_modifier + "Key"])
                    }
                    F = false;
                    D = false;
                    G.hide();
                    if (H) {
                        H.hide()
                    }
                },
                dnd_enter: function(O) {
                    if (this.data.dnd.mto) {
                        clearTimeout(this.data.dnd.mto);
                        this.data.dnd.mto = false
                    }
                    var N = this._get_settings().dnd;
                    this.data.dnd.prepared = false;
                    D = this._get_node(O);
                    if (N.check_timeout) {
                        if (this.data.dnd.to1) {
                            clearTimeout(this.data.dnd.to1)
                        }
                        this.data.dnd.to1 = setTimeout(J.proxy(this.dnd_prepare, this), N.check_timeout)
                    } else {
                        this.dnd_prepare()
                    }
                    if (N.open_timeout) {
                        if (this.data.dnd.to2) {
                            clearTimeout(this.data.dnd.to2)
                        }
                        if (D && D.length && D.hasClass("jstree-closed")) {
                            this.data.dnd.to2 = setTimeout(J.proxy(this.dnd_open, this), N.open_timeout)
                        }
                    } else {
                        if (D && D.length && D.hasClass("jstree-closed")) {
                            this.dnd_open()
                        }
                    }
                },
                dnd_leave: function(N) {
                    this.data.dnd.after = false;
                    this.data.dnd.before = false;
                    this.data.dnd.inside = false;
                    J.vakata.dnd.helper.children("ins").attr("class", "jstree-invalid");
                    G.hide();
                    if (H) {
                        H.hide()
                    }
                    if (D && D[0] === N.target.parentNode) {
                        if (this.data.dnd.to1) {
                            clearTimeout(this.data.dnd.to1);
                            this.data.dnd.to1 = false
                        }
                        if (this.data.dnd.to2) {
                            clearTimeout(this.data.dnd.to2);
                            this.data.dnd.to2 = false
                        }
                    }
                },
                start_drag: function(Q, P) {
                    F = this._get_node(Q);
                    if (this.data.ui && this.is_selected(F)) {
                        F = this._get_node(null, true)
                    }
                    var O = F.length > 1 ? this._get_string("multiple_selection") : this.get_text(F)
                      , N = this.get_container();
                    if (!this._get_settings().core.html_titles) {
                        O = O.replace(/</ig, "&lt;").replace(/>/ig, "&gt;")
                    }
                    J.vakata.dnd.drag_start(P, {
                        jstree: true,
                        obj: F
                    }, "<ins class='jstree-icon'></ins>" + O);
                    if (this.data.themes) {
                        if (G) {
                            G.attr("class", "jstree-" + this.data.themes.theme)
                        }
                        if (H) {
                            H.attr("class", "jstree-" + this.data.themes.theme)
                        }
                        J.vakata.dnd.helper.attr("class", "jstree-dnd-helper jstree-" + this.data.themes.theme)
                    }
                    this.data.dnd.cof = N.offset();
                    this.data.dnd.cw = parseInt(N.width(), 10);
                    this.data.dnd.ch = parseInt(N.height(), 10);
                    this.data.dnd.active = true
                }
            }
        });
        J(function() {
            var N = "#vakata-dragged ins { display:block; text-decoration:none; width:16px; height:16px; margin:0 0 0 0; padding:0; position:absolute; top:4px; left:4px;  -moz-border-radius:4px; border-radius:4px; -webkit-border-radius:4px; } #vakata-dragged .jstree-ok { background:green; } #vakata-dragged .jstree-invalid { background:red; } #jstree-marker { padding:0; margin:0; font-size:12px; overflow:hidden; height:12px; width:8px; position:absolute; top:-30px; z-index:10001; background-repeat:no-repeat; display:none; background-color:transparent; text-shadow:1px 1px 1px white; color:black; line-height:10px; } #jstree-marker-line { padding:0; margin:0; line-height:0%; font-size:1px; overflow:hidden; height:1px; width:100px; position:absolute; top:-30px; z-index:10000; background-repeat:no-repeat; display:none; background-color:#456c43;  cursor:pointer; border:1px solid #eeeeee; border-left:0; -moz-box-shadow: 0px 0px 2px #666; -webkit-box-shadow: 0px 0px 2px #666; box-shadow: 0px 0px 2px #666;  -moz-border-radius:1px; border-radius:1px; -webkit-border-radius:1px; }";
            J.vakata.css.add_sheet({
                str: N,
                title: "jstree"
            });
            G = J("<div />").attr({
                id: "jstree-marker"
            }).hide().html("&raquo;").bind("mouseleave mouseenter", function(O) {
                G.hide();
                H.hide();
                O.preventDefault();
                O.stopImmediatePropagation();
                return false
            }).appendTo("body");
            H = J("<div />").attr({
                id: "jstree-marker-line"
            }).hide().bind("mouseup", function(O) {
                if (D && D.length) {
                    D.children("a").trigger(O);
                    O.preventDefault();
                    O.stopImmediatePropagation();
                    return false
                }
            }).bind("mouseleave", function(P) {
                var O = J(P.relatedTarget);
                if (O.is(".jstree") || O.closest(".jstree").length === 0) {
                    if (D && D.length) {
                        D.children("a").trigger(P);
                        G.hide();
                        H.hide();
                        P.preventDefault();
                        P.stopImmediatePropagation();
                        return false
                    }
                }
            }).appendTo("body");
            J(document).bind("drag_start.vakata", function(P, O) {
                if (O.data.jstree) {
                    G.show();
                    if (H) {
                        H.show()
                    }
                }
            });
            J(document).bind("drag_stop.vakata", function(P, O) {
                if (O.data.jstree) {
                    G.hide();
                    if (H) {
                        H.hide()
                    }
                }
            })
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("checkbox", {
            __init: function() {
                this.data.checkbox.noui = this._get_settings().checkbox.override_ui;
                if (this.data.ui && this.data.checkbox.noui) {
                    this.select_node = this.deselect_node = this.deselect_all = D.noop;
                    this.get_selected = this.get_checked
                }
                this.get_container().bind("open_node.jstree create_node.jstree clean_node.jstree refresh.jstree", D.proxy(function(F, E) {
                    this._prepare_checkboxes(E.rslt.obj)
                }, this)).bind("loaded.jstree", D.proxy(function(E) {
                    this._prepare_checkboxes()
                }, this)).delegate((this.data.ui && this.data.checkbox.noui ? "a" : "ins.jstree-checkbox"), "click.jstree", D.proxy(function(E) {
                    E.preventDefault();
                    if (this._get_node(E.target).hasClass("jstree-checked")) {
                        this.uncheck_node(E.target)
                    } else {
                        this.check_node(E.target)
                    }
                    if (this.data.ui && this.data.checkbox.noui) {
                        this.save_selected();
                        if (this.data.cookies) {
                            this.save_cookie("select_node")
                        }
                    } else {
                        E.stopImmediatePropagation();
                        return false
                    }
                }, this))
            },
            defaults: {
                override_ui: false,
                two_state: false,
                real_checkboxes: false,
                checked_parent_open: true,
                real_checkboxes_names: function(E) {
                    return [("check_" + (E[0].id || Math.ceil(Math.random() * 10000))), 1]
                }
            },
            __destroy: function() {
                this.get_container().find("input.jstree-real-checkbox").removeClass("jstree-real-checkbox").end().find("ins.jstree-checkbox").remove()
            },
            _fn: {
                _checkbox_notify: function(F, E) {
                    if (E.checked) {
                        this.check_node(F, false)
                    }
                },
                _prepare_checkboxes: function(I) {
                    I = !I || I == -1 ? this.get_container().find("> ul > li") : this._get_node(I);
                    if (I === false) {
                        return
                    }
                    var K, J = this, E, G = this._get_settings().checkbox.two_state, H = this._get_settings().checkbox.real_checkboxes, F = this._get_settings().checkbox.real_checkboxes_names;
                    I.each(function() {
                        E = D(this);
                        K = E.is("li") && (E.hasClass("jstree-checked") || (H && E.children(":checked").length)) ? "jstree-checked" : "jstree-unchecked";
                        E.find("li").andSelf().each(function() {
                            var M = D(this), L;
                            M.children("a" + (J.data.languages ? "" : ":eq(0)")).not(":has(.jstree-checkbox)").prepend("<ins class='jstree-checkbox'>&#160;</ins>").parent().not(".jstree-checked, .jstree-unchecked").addClass(G ? "jstree-unchecked" : K);
                            if (H) {
                                if (!M.children(":checkbox").length) {
                                    L = F.call(J, M);
                                    M.prepend("<input type='checkbox' class='jstree-real-checkbox' id='" + L[0] + "' name='" + L[0] + "' value='" + L[1] + "' />")
                                } else {
                                    M.children(":checkbox").addClass("jstree-real-checkbox")
                                }
                            }
                            if (!G) {
                                if (K === "jstree-checked" || M.hasClass("jstree-checked") || M.children(":checked").length) {
                                    M.find("li").andSelf().addClass("jstree-checked").children(":checkbox").prop("checked", true)
                                }
                            } else {
                                if (M.hasClass("jstree-checked") || M.children(":checked").length) {
                                    M.addClass("jstree-checked").children(":checkbox").prop("checked", true)
                                }
                            }
                        })
                    });
                    if (!G) {
                        I.find(".jstree-checked").parent().parent().each(function() {
                            J._repair_state(this)
                        })
                    }
                },
                change_state: function(H, G) {
                    H = this._get_node(H);
                    var E = false
                      , F = this._get_settings().checkbox.real_checkboxes;
                    if (!H || H === -1) {
                        return false
                    }
                    G = (G === false || G === true) ? G : H.hasClass("jstree-checked");
                    if (this._get_settings().checkbox.two_state) {
                        if (G) {
                            H.removeClass("jstree-checked").addClass("jstree-unchecked");
                            if (F) {
                                H.children(":checkbox").prop("checked", false)
                            }
                        } else {
                            H.removeClass("jstree-unchecked").addClass("jstree-checked");
                            if (F) {
                                H.children(":checkbox").prop("checked", true)
                            }
                        }
                    } else {
                        if (G) {
                            E = H.find("li").andSelf();
                            if (!E.filter(".jstree-checked, .jstree-undetermined").length) {
                                return false
                            }
                            E.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");
                            if (F) {
                                E.children(":checkbox").prop("checked", false)
                            }
                        } else {
                            E = H.find("li").andSelf();
                            if (!E.filter(".jstree-unchecked, .jstree-undetermined").length) {
                                return false
                            }
                            E.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");
                            if (F) {
                                E.children(":checkbox").prop("checked", true)
                            }
                            if (this.data.ui) {
                                this.data.ui.last_selected = H
                            }
                            this.data.checkbox.last_selected = H
                        }
                        H.parentsUntil(".jstree", "li").each(function() {
                            var I = D(this);
                            if (G) {
                                if (I.children("ul").children("li.jstree-checked, li.jstree-undetermined").length) {
                                    I.parentsUntil(".jstree", "li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
                                    if (F) {
                                        I.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false)
                                    }
                                    return false
                                } else {
                                    I.removeClass("jstree-checked jstree-undetermined").addClass("jstree-unchecked");
                                    if (F) {
                                        I.children(":checkbox").prop("checked", false)
                                    }
                                }
                            } else {
                                if (I.children("ul").children("li.jstree-unchecked, li.jstree-undetermined").length) {
                                    I.parentsUntil(".jstree", "li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
                                    if (F) {
                                        I.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false)
                                    }
                                    return false
                                } else {
                                    I.removeClass("jstree-unchecked jstree-undetermined").addClass("jstree-checked");
                                    if (F) {
                                        I.children(":checkbox").prop("checked", true)
                                    }
                                }
                            }
                        })
                    }
                    if (this.data.ui && this.data.checkbox.noui) {
                        this.data.ui.selected = this.get_checked()
                    }
                    this.__callback(H);
                    return true
                },
                check_node: function(F) {
                    if (this.change_state(F, false)) {
                        F = this._get_node(F);
                        if (this._get_settings().checkbox.checked_parent_open) {
                            var E = this;
                            F.parents(".jstree-closed").each(function() {
                                E.open_node(this, false, true)
                            })
                        }
                        this.__callback({
                            obj: F
                        })
                    }
                },
                uncheck_node: function(E) {
                    if (this.change_state(E, true)) {
                        this.__callback({
                            obj: this._get_node(E)
                        })
                    }
                },
                check_all: function() {
                    var F = this
                      , E = this._get_settings().checkbox.two_state ? this.get_container_ul().find("li") : this.get_container_ul().children("li");
                    E.each(function() {
                        F.change_state(this, false)
                    });
                    this.__callback()
                },
                uncheck_all: function() {
                    var F = this
                      , E = this._get_settings().checkbox.two_state ? this.get_container_ul().find("li") : this.get_container_ul().children("li");
                    E.each(function() {
                        F.change_state(this, true)
                    });
                    this.__callback()
                },
                is_checked: function(E) {
                    E = this._get_node(E);
                    return E.length ? E.is(".jstree-checked") : false
                },
                get_checked: function(F, E) {
                    F = !F || F === -1 ? this.get_container() : this._get_node(F);
                    return E || this._get_settings().checkbox.two_state ? F.find(".jstree-checked") : F.find("> ul > .jstree-checked, .jstree-undetermined > ul > .jstree-checked")
                },
                get_unchecked: function(F, E) {
                    F = !F || F === -1 ? this.get_container() : this._get_node(F);
                    return E || this._get_settings().checkbox.two_state ? F.find(".jstree-unchecked") : F.find("> ul > .jstree-unchecked, .jstree-undetermined > ul > .jstree-unchecked")
                },
                show_checkboxes: function() {
                    this.get_container().children("ul").removeClass("jstree-no-checkboxes")
                },
                hide_checkboxes: function() {
                    this.get_container().children("ul").addClass("jstree-no-checkboxes")
                },
                _repair_state: function(H) {
                    H = this._get_node(H);
                    if (!H.length) {
                        return
                    }
                    if (this._get_settings().checkbox.two_state) {
                        H.find("li").andSelf().not(".jstree-checked").removeClass("jstree-undetermined").addClass("jstree-unchecked").children(":checkbox").prop("checked", true);
                        return
                    }
                    var G = this._get_settings().checkbox.real_checkboxes
                      , F = H.find("> ul > .jstree-checked").length
                      , E = H.find("> ul > .jstree-undetermined").length
                      , I = H.find("> ul > li").length;
                    if (I === 0) {
                        if (H.hasClass("jstree-undetermined")) {
                            this.change_state(H, false)
                        }
                    } else {
                        if (F === 0 && E === 0) {
                            this.change_state(H, true)
                        } else {
                            if (F === I) {
                                this.change_state(H, false)
                            } else {
                                H.parentsUntil(".jstree", "li").andSelf().removeClass("jstree-checked jstree-unchecked").addClass("jstree-undetermined");
                                if (G) {
                                    H.parentsUntil(".jstree", "li").andSelf().children(":checkbox").prop("checked", false)
                                }
                            }
                        }
                    }
                },
                reselect: function() {
                    if (this.data.ui && this.data.checkbox.noui) {
                        var F = this
                          , E = this.data.ui.to_select;
                        E = D.map(D.makeArray(E), function(G) {
                            return "#" + G.toString().replace(/^#/, "").replace(/\\\//g, "/").replace(/\//g, "\\/").replace(/\\\./g, ".").replace(/\./g, "\\.").replace(/\:/g, "\\:")
                        });
                        this.deselect_all();
                        D.each(E, function(G, H) {
                            F.check_node(H)
                        });
                        this.__callback()
                    } else {
                        this.__call_old()
                    }
                },
                save_loaded: function() {
                    var E = this;
                    this.data.core.to_load = [];
                    this.get_container_ul().find("li.jstree-closed.jstree-undetermined").each(function() {
                        if (this.id) {
                            E.data.core.to_load.push("#" + this.id)
                        }
                    })
                }
            }
        });
        D(function() {
            var E = ".jstree .jstree-real-checkbox { display:none; } ";
            D.vakata.css.add_sheet({
                str: E,
                title: "jstree"
            })
        })
    })(jQuery);
    (function(F) {
        F.vakata.xslt = function(I, J, N) {
            var G = "", M, H, L, K;
            if (document.recalc) {
                M = document.createElement("xml");
                H = document.createElement("xml");
                M.innerHTML = I;
                H.innerHTML = J;
                F("body").append(M).append(H);
                setTimeout((function(P, O, Q) {
                    return function() {
                        Q.call(null, P.transformNode(O.XMLDocument));
                        setTimeout((function(S, R) {
                            return function() {
                                F(S).remove();
                                F(R).remove()
                            }
                        })(P, O), 200)
                    }
                })(M, H, N), 100);
                return true
            }
            if (typeof window.DOMParser !== "undefined" && typeof window.XMLHttpRequest !== "undefined" && typeof window.XSLTProcessor === "undefined") {
                I = new DOMParser().parseFromString(I, "text/xml");
                J = new DOMParser().parseFromString(J, "text/xml")
            }
            if (typeof window.DOMParser !== "undefined" && typeof window.XMLHttpRequest !== "undefined" && typeof window.XSLTProcessor !== "undefined") {
                L = new XSLTProcessor();
                K = F.isFunction(L.transformDocument) ? (typeof window.XMLSerializer !== "undefined") : true;
                if (!K) {
                    return false
                }
                I = new DOMParser().parseFromString(I, "text/xml");
                J = new DOMParser().parseFromString(J, "text/xml");
                if (F.isFunction(L.transformDocument)) {
                    G = document.implementation.createDocument("", "", null);
                    L.transformDocument(I, J, G, null);
                    N.call(null, new XMLSerializer().serializeToString(G));
                    return true
                } else {
                    L.importStylesheet(J);
                    G = L.transformToFragment(I, document);
                    N.call(null, F("<div />").append(G).html());
                    return true
                }
            }
            return false
        }
        ;
        var E = {
            nest: '<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/html" /><xsl:template match="/"> <xsl:call-template name="nodes">    <xsl:with-param name="node" select="/root" /> </xsl:call-template></xsl:template><xsl:template name="nodes">  <xsl:param name="node" /> <ul>  <xsl:for-each select="$node/item">    <xsl:variable name="children" select="count(./item) &gt; 0" />    <li>      <xsl:attribute name="class">        <xsl:if test="position() = last()">jstree-last </xsl:if>        <xsl:choose>          <xsl:when test="@state = \'open\'">jstree-open </xsl:when>          <xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>         <xsl:otherwise>jstree-leaf </xsl:otherwise>       </xsl:choose>       <xsl:value-of select="@class" />      </xsl:attribute>      <xsl:for-each select="@*">        <xsl:if test="name() != \'class\' and name() != \'state\' and name() != \'hasChildren\'">         <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>        </xsl:if>     </xsl:for-each> <ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>      <xsl:for-each select="content/name">        <a>       <xsl:attribute name="href">         <xsl:choose>          <xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>         <xsl:otherwise>#</xsl:otherwise>          </xsl:choose>       </xsl:attribute>        <xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>        <xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>        <xsl:for-each select="@*">          <xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">            <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>          </xsl:if>       </xsl:for-each>         <ins>           <xsl:attribute name="class">jstree-icon               <xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>           </xsl:attribute>            <xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>           <xsl:text>&#xa0;</xsl:text>         </ins>          <xsl:copy-of select="./child::node()" />        </a>      </xsl:for-each>     <xsl:if test="$children or @hasChildren"><xsl:call-template name="nodes"><xsl:with-param name="node" select="current()" /></xsl:call-template></xsl:if>   </li> </xsl:for-each> </ul></xsl:template></xsl:stylesheet>',
            flat: '<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" /><xsl:template match="/">  <ul>  <xsl:for-each select="//item[not(@parent_id) or @parent_id=0 or not(@parent_id = //item/@id)]">   <xsl:call-template name="nodes">      <xsl:with-param name="node" select="." />     <xsl:with-param name="is_last" select="number(position() = last())" />    </xsl:call-template>  </xsl:for-each> </ul></xsl:template><xsl:template name="nodes"> <xsl:param name="node" /> <xsl:param name="is_last" />  <xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" />  <li>  <xsl:attribute name="class">    <xsl:if test="$is_last = true()">jstree-last </xsl:if>    <xsl:choose>      <xsl:when test="@state = \'open\'">jstree-open </xsl:when>      <xsl:when test="$children or @hasChildren or @state = \'closed\'">jstree-closed </xsl:when>     <xsl:otherwise>jstree-leaf </xsl:otherwise>   </xsl:choose>   <xsl:value-of select="@class" />  </xsl:attribute>  <xsl:for-each select="@*">    <xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'">   <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>    </xsl:if> </xsl:for-each> <ins class="jstree-icon"><xsl:text>&#xa0;</xsl:text></ins>  <xsl:for-each select="content/name">    <a>   <xsl:attribute name="href">     <xsl:choose>      <xsl:when test="@href"><xsl:value-of select="@href" /></xsl:when>     <xsl:otherwise>#</xsl:otherwise>      </xsl:choose>   </xsl:attribute>    <xsl:attribute name="class"><xsl:value-of select="@lang" /> <xsl:value-of select="@class" /></xsl:attribute>    <xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute>    <xsl:for-each select="@*">      <xsl:if test="name() != \'style\' and name() != \'class\' and name() != \'href\'">        <xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute>      </xsl:if>   </xsl:for-each>     <ins>       <xsl:attribute name="class">jstree-icon           <xsl:if test="string-length(attribute::icon) > 0 and not(contains(@icon,\'/\'))"><xsl:value-of select="@icon" /></xsl:if>       </xsl:attribute>        <xsl:if test="string-length(attribute::icon) > 0 and contains(@icon,\'/\')"><xsl:attribute name="style">background:url(<xsl:value-of select="@icon" />) center center no-repeat;</xsl:attribute></xsl:if>       <xsl:text>&#xa0;</xsl:text>     </ins>      <xsl:copy-of select="./child::node()" />    </a>  </xsl:for-each> <xsl:if test="$children">   <ul>    <xsl:for-each select="//item[@parent_id=$node/attribute::id]">      <xsl:call-template name="nodes">        <xsl:with-param name="node" select="." />       <xsl:with-param name="is_last" select="number(position() = last())" />      </xsl:call-template>    </xsl:for-each>   </ul> </xsl:if> </li></xsl:template></xsl:stylesheet>'
        }
          , D = function(G) {
            return G.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&apos;")
        };
        F.jstree.plugin("xml_data", {
            defaults: {
                data: false,
                ajax: false,
                xsl: "flat",
                clean_node: false,
                correct_state: true,
                get_skip_empty: false,
                get_include_preamble: true
            },
            _fn: {
                load_node: function(I, G, H) {
                    var J = this;
                    this.load_node_xml(I, function() {
                        J.__callback({
                            obj: J._get_node(I)
                        });
                        G.call(this)
                    }, H)
                },
                _is_loaded: function(H) {
                    var G = this._get_settings().xml_data;
                    H = this._get_node(H);
                    return H == -1 || !H || (!G.ajax && !F.isFunction(G.data)) || H.is(".jstree-open, .jstree-leaf") || H.children("ul").children("li").size() > 0
                },
                load_node_xml: function(K, G, I) {
                    var J = this.get_settings().xml_data
                      , H = function() {}
                      , L = function() {};
                    K = this._get_node(K);
                    if (K && K !== -1) {
                        if (K.data("jstree_is_loading")) {
                            return
                        } else {
                            K.data("jstree_is_loading", true)
                        }
                    }
                    switch (!0) {
                    case (!J.data && !J.ajax):
                        throw "Neither data nor ajax settings supplied.";
                    case (F.isFunction(J.data)):
                        J.data.call(this, K, F.proxy(function(M) {
                            this.parse_xml(M, F.proxy(function(N) {
                                if (N) {
                                    N = N.replace(/ ?xmlns="[^"]*"/ig, "");
                                    if (N.length > 10) {
                                        N = F(N);
                                        if (K === -1 || !K) {
                                            this.get_container().children("ul").empty().append(N.children())
                                        } else {
                                            K.children("a.jstree-loading").removeClass("jstree-loading");
                                            K.append(N);
                                            K.removeData("jstree_is_loading")
                                        }
                                        if (J.clean_node) {
                                            this.clean_node(K)
                                        }
                                        if (G) {
                                            G.call(this)
                                        }
                                    } else {
                                        if (K && K !== -1) {
                                            K.children("a.jstree-loading").removeClass("jstree-loading");
                                            K.removeData("jstree_is_loading");
                                            if (J.correct_state) {
                                                this.correct_state(K);
                                                if (G) {
                                                    G.call(this)
                                                }
                                            }
                                        } else {
                                            if (J.correct_state) {
                                                this.get_container().children("ul").empty();
                                                if (G) {
                                                    G.call(this)
                                                }
                                            }
                                        }
                                    }
                                }
                            }, this))
                        }, this));
                        break;
                    case (!!J.data && !J.ajax) || (!!J.data && !!J.ajax && (!K || K === -1)):
                        if (!K || K == -1) {
                            this.parse_xml(J.data, F.proxy(function(M) {
                                if (M) {
                                    M = M.replace(/ ?xmlns="[^"]*"/ig, "");
                                    if (M.length > 10) {
                                        M = F(M);
                                        this.get_container().children("ul").empty().append(M.children());
                                        if (J.clean_node) {
                                            this.clean_node(K)
                                        }
                                        if (G) {
                                            G.call(this)
                                        }
                                    }
                                } else {
                                    if (J.correct_state) {
                                        this.get_container().children("ul").empty();
                                        if (G) {
                                            G.call(this)
                                        }
                                    }
                                }
                            }, this))
                        }
                        break;
                    case (!J.data && !!J.ajax) || (!!J.data && !!J.ajax && K && K !== -1):
                        H = function(N, O, P) {
                            var M = this.get_settings().xml_data.ajax.error;
                            if (M) {
                                M.call(this, N, O, P)
                            }
                            if (K !== -1 && K.length) {
                                K.children("a.jstree-loading").removeClass("jstree-loading");
                                K.removeData("jstree_is_loading");
                                if (O === "success" && J.correct_state) {
                                    this.correct_state(K)
                                }
                            } else {
                                if (O === "success" && J.correct_state) {
                                    this.get_container().children("ul").empty()
                                }
                            }
                            if (I) {
                                I.call(this)
                            }
                        }
                        ;
                        L = function(P, N, M) {
                            P = M.responseText;
                            var O = this.get_settings().xml_data.ajax.success;
                            if (O) {
                                P = O.call(this, P, N, M) || P
                            }
                            if (P === "" || (P && P.toString && P.toString().replace(/^[\s\n]+$/, "") === "")) {
                                return H.call(this, M, N, "")
                            }
                            this.parse_xml(P, F.proxy(function(Q) {
                                if (Q) {
                                    Q = Q.replace(/ ?xmlns="[^"]*"/ig, "");
                                    if (Q.length > 10) {
                                        Q = F(Q);
                                        if (K === -1 || !K) {
                                            this.get_container().children("ul").empty().append(Q.children())
                                        } else {
                                            K.children("a.jstree-loading").removeClass("jstree-loading");
                                            K.append(Q);
                                            K.removeData("jstree_is_loading")
                                        }
                                        if (J.clean_node) {
                                            this.clean_node(K)
                                        }
                                        if (G) {
                                            G.call(this)
                                        }
                                    } else {
                                        if (K && K !== -1) {
                                            K.children("a.jstree-loading").removeClass("jstree-loading");
                                            K.removeData("jstree_is_loading");
                                            if (J.correct_state) {
                                                this.correct_state(K);
                                                if (G) {
                                                    G.call(this)
                                                }
                                            }
                                        } else {
                                            if (J.correct_state) {
                                                this.get_container().children("ul").empty();
                                                if (G) {
                                                    G.call(this)
                                                }
                                            }
                                        }
                                    }
                                }
                            }, this))
                        }
                        ;
                        J.ajax.context = this;
                        J.ajax.error = H;
                        J.ajax.success = L;
                        if (!J.ajax.dataType) {
                            J.ajax.dataType = "xml"
                        }
                        if (F.isFunction(J.ajax.url)) {
                            J.ajax.url = J.ajax.url.call(this, K)
                        }
                        if (F.isFunction(J.ajax.data)) {
                            J.ajax.data = J.ajax.data.call(this, K)
                        }
                        F.ajax(J.ajax);
                        break
                    }
                },
                parse_xml: function(G, I) {
                    var H = this._get_settings().xml_data;
                    F.vakata.xslt(G, E[H.xsl], I)
                },
                get_xml: function(O, L, I, G, Q) {
                    var S = "", R = this._get_settings(), M = this, K, J, P, N, H;
                    if (!O) {
                        O = "flat"
                    }
                    if (!Q) {
                        Q = 0
                    }
                    L = this._get_node(L);
                    if (!L || L === -1) {
                        L = this.get_container().find("> ul > li")
                    }
                    I = F.isArray(I) ? I : ["id", "class"];
                    if (!Q && this.data.types && F.inArray(R.types.type_attr, I) === -1) {
                        I.push(R.types.type_attr)
                    }
                    G = F.isArray(G) ? G : [];
                    if (!Q) {
                        if (R.xml_data.get_include_preamble) {
                            S += '<?xml version="1.0" encoding="UTF-8"?>'
                        }
                        S += "<root>"
                    }
                    L.each(function() {
                        S += "<item";
                        P = F(this);
                        F.each(I, function(V, T) {
                            var U = P.attr(T);
                            if (!R.xml_data.get_skip_empty || typeof U !== "undefined") {
                                S += " " + T + '="' + D((" " + (U || "")).replace(/ jstree[^ ]*/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")) + '"'
                            }
                        });
                        if (P.hasClass("jstree-open")) {
                            S += ' state="open"'
                        }
                        if (P.hasClass("jstree-closed")) {
                            S += ' state="closed"'
                        }
                        if (O === "flat") {
                            S += ' parent_id="' + D(Q) + '"'
                        }
                        S += ">";
                        S += "<content>";
                        N = P.children("a");
                        N.each(function() {
                            K = F(this);
                            H = false;
                            S += "<name";
                            if (F.inArray("languages", R.plugins) !== -1) {
                                F.each(R.languages, function(T, U) {
                                    if (K.hasClass(U)) {
                                        S += ' lang="' + D(U) + '"';
                                        H = U;
                                        return false
                                    }
                                })
                            }
                            if (G.length) {
                                F.each(G, function(T, V) {
                                    var U = K.attr(V);
                                    if (!R.xml_data.get_skip_empty || typeof U !== "undefined") {
                                        S += " " + V + '="' + D((" " + U || "").replace(/ jstree[^ ]*/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")) + '"'
                                    }
                                })
                            }
                            if (K.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig, "").replace(/^\s+$/ig, "").length) {
                                S += ' icon="' + D(K.children("ins").get(0).className.replace(/jstree[^ ]*|$/ig, "").replace(/\s+$/ig, " ").replace(/^ /, "").replace(/ $/, "")) + '"'
                            }
                            if (K.children("ins").get(0).style.backgroundImage.length) {
                                S += ' icon="' + D(K.children("ins").get(0).style.backgroundImage.replace("url(", "").replace(")", "").replace(/'/ig, "").replace(/"/ig, "")) + '"'
                            }
                            S += ">";
                            S += "<![CDATA[" + M.get_text(K, H) + "]]>";
                            S += "</name>"
                        });
                        S += "</content>";
                        J = P[0].id || true;
                        P = P.find("> ul > li");
                        if (P.length) {
                            J = M.get_xml(O, P, I, G, J)
                        } else {
                            J = ""
                        }
                        if (O == "nest") {
                            S += J
                        }
                        S += "</item>";
                        if (O == "flat") {
                            S += J
                        }
                    });
                    if (!Q) {
                        S += "</root>"
                    }
                    return S
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.expr[":"].jstree_contains = function(F, G, E) {
            return (F.textContent || F.innerText || "").toLowerCase().indexOf(E[3].toLowerCase()) >= 0
        }
        ;
        D.expr[":"].jstree_title_contains = function(F, G, E) {
            return (F.getAttribute("title") || "").toLowerCase().indexOf(E[3].toLowerCase()) >= 0
        }
        ;
        D.jstree.plugin("search", {
            __init: function() {
                this.data.search.str = "";
                this.data.search.result = D();
                if (this._get_settings().search.show_only_matches) {
                    this.get_container().bind("search.jstree", function(F, E) {
                        D(this).children("ul").find("li").hide().removeClass("jstree-last");
                        E.rslt.nodes.parentsUntil(".jstree").andSelf().show().filter("ul").each(function() {
                            D(this).children("li:visible").eq(-1).addClass("jstree-last")
                        })
                    }).bind("clear_search.jstree", function() {
                        D(this).children("ul").find("li").css("display", "").end().end().jstree("clean_node", -1)
                    })
                }
            },
            defaults: {
                ajax: false,
                search_method: "jstree_contains",
                show_only_matches: false
            },
            _fn: {
                search: function(J, E) {
                    if (D.trim(J) === "") {
                        this.clear_search();
                        return
                    }
                    var H = this.get_settings().search
                      , G = this
                      , F = function() {}
                      , I = function() {};
                    this.data.search.str = J;
                    if (!E && H.ajax !== false && this.get_container_ul().find("li.jstree-closed:not(:has(ul)):eq(0)").length > 0) {
                        this.search.supress_callback = true;
                        F = function() {}
                        ;
                        I = function(N, L, K) {
                            var M = this.get_settings().search.ajax.success;
                            if (M) {
                                N = M.call(this, N, L, K) || N
                            }
                            this.data.search.to_open = N;
                            this._search_open()
                        }
                        ;
                        H.ajax.context = this;
                        H.ajax.error = F;
                        H.ajax.success = I;
                        if (D.isFunction(H.ajax.url)) {
                            H.ajax.url = H.ajax.url.call(this, J)
                        }
                        if (D.isFunction(H.ajax.data)) {
                            H.ajax.data = H.ajax.data.call(this, J)
                        }
                        if (!H.ajax.data) {
                            H.ajax.data = {
                                search_string: J
                            }
                        }
                        if (!H.ajax.dataType || /^json/.exec(H.ajax.dataType)) {
                            H.ajax.dataType = "json"
                        }
                        D.ajax(H.ajax);
                        return
                    }
                    if (this.data.search.result.length) {
                        this.clear_search()
                    }
                    this.data.search.result = this.get_container().find("a" + (this.data.languages ? "." + this.get_lang() : "") + ":" + (H.search_method) + "(" + this.data.search.str + ")");
                    this.data.search.result.addClass("jstree-search").parent().parents(".jstree-closed").each(function() {
                        G.open_node(this, false, true)
                    });
                    this.__callback({
                        nodes: this.data.search.result,
                        str: J
                    })
                },
                clear_search: function(E) {
                    this.data.search.result.removeClass("jstree-search");
                    this.__callback(this.data.search.result);
                    this.data.search.result = D()
                },
                _search_open: function(F) {
                    var I = this
                      , E = true
                      , H = []
                      , G = [];
                    if (this.data.search.to_open.length) {
                        D.each(this.data.search.to_open, function(J, K) {
                            if (K == "#") {
                                return true
                            }
                            if (D(K).length && D(K).is(".jstree-closed")) {
                                H.push(K)
                            } else {
                                G.push(K)
                            }
                        });
                        if (H.length) {
                            this.data.search.to_open = G;
                            D.each(H, function(J, K) {
                                I.open_node(K, function() {
                                    I._search_open(true)
                                })
                            });
                            E = false
                        }
                    }
                    if (E) {
                        this.search(this.data.search.str, true)
                    }
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.vakata.context = {
            hide_on_mouseleave: false,
            cnt: D("<div id='vakata-contextmenu' />"),
            vis: false,
            tgt: false,
            par: false,
            func: false,
            data: false,
            rtl: false,
            show: function(N, M, K, I, H, E, J) {
                D.vakata.context.rtl = !!J;
                var G = D.vakata.context.parse(N), F, L;
                if (!G) {
                    return
                }
                D.vakata.context.vis = true;
                D.vakata.context.tgt = M;
                D.vakata.context.par = E || M || null;
                D.vakata.context.data = H || null;
                D.vakata.context.cnt.html(G).css({
                    visibility: "hidden",
                    display: "block",
                    left: 0,
                    top: 0
                });
                if (D.vakata.context.hide_on_mouseleave) {
                    D.vakata.context.cnt.one("mouseleave", function(O) {
                        D.vakata.context.hide()
                    })
                }
                F = D.vakata.context.cnt.height();
                L = D.vakata.context.cnt.width();
                if (K + L > D(document).width()) {
                    K = D(document).width() - (L + 5);
                    D.vakata.context.cnt.find("li > ul").addClass("right")
                }
                if (I + F > D(document).height()) {
                    I = I - (F + M[0].offsetHeight);
                    D.vakata.context.cnt.find("li > ul").addClass("bottom")
                }
                D.vakata.context.cnt.css({
                    left: K,
                    top: I
                }).find("li:has(ul)").bind("mouseenter", function(R) {
                    var O = D(document).width()
                      , Q = D(document).height()
                      , P = D(this).children("ul").show();
                    if (O !== D(document).width()) {
                        P.toggleClass("right")
                    }
                    if (Q !== D(document).height()) {
                        P.toggleClass("bottom")
                    }
                }).bind("mouseleave", function(O) {
                    D(this).children("ul").hide()
                }).end().css({
                    visibility: "visible"
                }).show();
                D(document).triggerHandler("context_show.vakata")
            },
            hide: function() {
                D.vakata.context.vis = false;
                D.vakata.context.cnt.attr("class", "").css({
                    visibility: "hidden"
                });
                D(document).triggerHandler("context_hide.vakata")
            },
            parse: function(H, G) {
                if (!H) {
                    return false
                }
                var I = ""
                  , F = false
                  , E = true;
                if (!G) {
                    D.vakata.context.func = {}
                }
                I += "<ul>";
                D.each(H, function(J, K) {
                    if (!K) {
                        return true
                    }
                    D.vakata.context.func[J] = K.action;
                    if (!E && K.separator_before) {
                        I += "<li class='vakata-separator vakata-separator-before'></li>"
                    }
                    E = false;
                    I += "<li class='" + (K._class || "") + (K._disabled ? " jstree-contextmenu-disabled " : "") + "'><ins ";
                    if (K.icon && K.icon.indexOf("/") === -1) {
                        I += " class='" + K.icon + "' "
                    }
                    if (K.icon && K.icon.indexOf("/") !== -1) {
                        I += " style='background:url(" + K.icon + ") center center no-repeat;' "
                    }
                    I += ">&#160;</ins><a href='#' rel='" + J + "'>";
                    if (K.submenu) {
                        I += "<span style='float:" + (D.vakata.context.rtl ? "left" : "right") + ";'>&raquo;</span>"
                    }
                    I += K.label + "</a>";
                    if (K.submenu) {
                        F = D.vakata.context.parse(K.submenu, true);
                        if (F) {
                            I += F
                        }
                    }
                    I += "</li>";
                    if (K.separator_after) {
                        I += "<li class='vakata-separator vakata-separator-after'></li>";
                        E = true
                    }
                });
                I = I.replace(/<li class\='vakata-separator vakata-separator-after'\><\/li\>$/, "");
                I += "</ul>";
                D(document).triggerHandler("context_parse.vakata");
                return I.length > 10 ? I : false
            },
            exec: function(E) {
                if (D.isFunction(D.vakata.context.func[E])) {
                    D.vakata.context.func[E].call(D.vakata.context.data, D.vakata.context.par);
                    return true
                } else {
                    return false
                }
            }
        };
        D(function() {
            var E = "#vakata-contextmenu { display:block; visibility:hidden; left:0; top:-200px; position:absolute; margin:0; padding:0; min-width:180px; background:#ebebeb; border:1px solid silver; z-index:10000; *width:180px; } #vakata-contextmenu ul { min-width:180px; *width:180px; } #vakata-contextmenu ul, #vakata-contextmenu li { margin:0; padding:0; list-style-type:none; display:block; } #vakata-contextmenu li { line-height:20px; min-height:20px; position:relative; padding:0px; } #vakata-contextmenu li a { padding:1px 6px; line-height:17px; display:block; text-decoration:none; margin:1px 1px 0 1px; } #vakata-contextmenu li ins { float:left; width:16px; height:16px; text-decoration:none; margin-right:2px; } #vakata-contextmenu li a:hover, #vakata-contextmenu li.vakata-hover > a { background:gray; color:white; } #vakata-contextmenu li ul { display:none; position:absolute; top:-2px; left:100%; background:#ebebeb; border:1px solid gray; } #vakata-contextmenu .right { right:100%; left:auto; } #vakata-contextmenu .bottom { bottom:-1px; top:auto; } #vakata-contextmenu li.vakata-separator { min-height:0; height:1px; line-height:1px; font-size:1px; overflow:hidden; margin:0 2px; background:silver; /* border-top:1px solid #fefefe; */ padding:0; } ";
            D.vakata.css.add_sheet({
                str: E,
                title: "vakata"
            });
            D.vakata.context.cnt.delegate("a", "click", function(F) {
                F.preventDefault()
            }).delegate("a", "mouseup", function(F) {
                if (!D(this).parent().hasClass("jstree-contextmenu-disabled") && D.vakata.context.exec(D(this).attr("rel"))) {
                    D.vakata.context.hide()
                } else {
                    D(this).blur()
                }
            }).delegate("a", "mouseover", function() {
                D.vakata.context.cnt.find(".vakata-hover").removeClass("vakata-hover")
            }).appendTo("body");
            D(document).bind("mousedown", function(F) {
                if (D.vakata.context.vis && !D.contains(D.vakata.context.cnt[0], F.target)) {
                    D.vakata.context.hide()
                }
            });
            if (typeof D.hotkeys !== "undefined") {
                D(document).bind("keydown", "up", function(F) {
                    if (D.vakata.context.vis) {
                        var G = D.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").prevAll("li:not(.vakata-separator)").first();
                        if (!G.length) {
                            G = D.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").last()
                        }
                        G.addClass("vakata-hover");
                        F.stopImmediatePropagation();
                        F.preventDefault()
                    }
                }).bind("keydown", "down", function(F) {
                    if (D.vakata.context.vis) {
                        var G = D.vakata.context.cnt.find("ul:visible").last().children(".vakata-hover").removeClass("vakata-hover").nextAll("li:not(.vakata-separator)").first();
                        if (!G.length) {
                            G = D.vakata.context.cnt.find("ul:visible").last().children("li:not(.vakata-separator)").first()
                        }
                        G.addClass("vakata-hover");
                        F.stopImmediatePropagation();
                        F.preventDefault()
                    }
                }).bind("keydown", "right", function(F) {
                    if (D.vakata.context.vis) {
                        D.vakata.context.cnt.find(".vakata-hover").children("ul").show().children("li:not(.vakata-separator)").removeClass("vakata-hover").first().addClass("vakata-hover");
                        F.stopImmediatePropagation();
                        F.preventDefault()
                    }
                }).bind("keydown", "left", function(F) {
                    if (D.vakata.context.vis) {
                        D.vakata.context.cnt.find(".vakata-hover").children("ul").hide().children(".vakata-separator").removeClass("vakata-hover");
                        F.stopImmediatePropagation();
                        F.preventDefault()
                    }
                }).bind("keydown", "esc", function(F) {
                    D.vakata.context.hide();
                    F.preventDefault()
                }).bind("keydown", "space", function(F) {
                    D.vakata.context.cnt.find(".vakata-hover").last().children("a").click();
                    F.preventDefault()
                })
            }
        });
        D.jstree.plugin("contextmenu", {
            __init: function() {
                this.get_container().delegate("a", "contextmenu.jstree", D.proxy(function(E) {
                    E.preventDefault();
                    if (!D(E.currentTarget).hasClass("jstree-loading")) {
                        this.show_contextmenu(E.currentTarget, E.pageX, E.pageY)
                    }
                }, this)).delegate("a", "click.jstree", D.proxy(function(E) {
                    if (this.data.contextmenu) {
                        D.vakata.context.hide()
                    }
                }, this)).bind("destroy.jstree", D.proxy(function() {
                    if (this.data.contextmenu) {
                        D.vakata.context.hide()
                    }
                }, this));
                D(document).bind("context_hide.vakata", D.proxy(function() {
                    this.data.contextmenu = false
                }, this))
            },
            defaults: {
                select_node: false,
                show_at_node: true,
                items: {
                    create: {
                        separator_before: false,
                        separator_after: true,
                        label: "Create",
                        action: function(E) {
                            this.create(E)
                        }
                    },
                    rename: {
                        separator_before: false,
                        separator_after: false,
                        label: "Rename",
                        action: function(E) {
                            this.rename(E)
                        }
                    },
                    remove: {
                        separator_before: false,
                        icon: false,
                        separator_after: false,
                        label: "Delete",
                        action: function(E) {
                            if (this.is_selected(E)) {
                                this.remove()
                            } else {
                                this.remove(E)
                            }
                        }
                    },
                    ccp: {
                        separator_before: true,
                        icon: false,
                        separator_after: false,
                        label: "Edit",
                        action: false,
                        submenu: {
                            cut: {
                                separator_before: false,
                                separator_after: false,
                                label: "Cut",
                                action: function(E) {
                                    this.cut(E)
                                }
                            },
                            copy: {
                                separator_before: false,
                                icon: false,
                                separator_after: false,
                                label: "Copy",
                                action: function(E) {
                                    this.copy(E)
                                }
                            },
                            paste: {
                                separator_before: false,
                                icon: false,
                                separator_after: false,
                                label: "Paste",
                                action: function(E) {
                                    this.paste(E)
                                }
                            }
                        }
                    }
                }
            },
            _fn: {
                show_contextmenu: function(I, E, K) {
                    I = this._get_node(I);
                    var H = this.get_settings().contextmenu
                      , F = I.children("a:visible:eq(0)")
                      , J = false
                      , G = false;
                    if (H.select_node && this.data.ui && !this.is_selected(I)) {
                        this.deselect_all();
                        this.select_node(I, true)
                    }
                    if (H.show_at_node || typeof E === "undefined" || typeof K === "undefined") {
                        J = F.offset();
                        E = J.left;
                        K = J.top + this.data.core.li_height
                    }
                    G = I.data("jstree") && I.data("jstree").contextmenu ? I.data("jstree").contextmenu : H.items;
                    if (D.isFunction(G)) {
                        G = G.call(this, I)
                    }
                    this.data.contextmenu = true;
                    D.vakata.context.show(G, F, E, K, this, I, this._get_settings().core.rtl);
                    if (this.data.themes) {
                        D.vakata.context.cnt.attr("class", "jstree-" + this.data.themes.theme + "-context")
                    }
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("types", {
            __init: function() {
                var E = this._get_settings().types;
                this.data.types.attach_to = [];
                this.get_container().bind("init.jstree", D.proxy(function() {
                    var H = E.types
                      , G = E.type_attr
                      , F = ""
                      , I = this;
                    D.each(H, function(J, K) {
                        D.each(K, function(M, L) {
                            if (!/^(max_depth|max_children|icon|valid_children)$/.test(M)) {
                                I.data.types.attach_to.push(M)
                            }
                        });
                        if (!K.icon) {
                            return true
                        }
                        if (K.icon.image || K.icon.position) {
                            if (J == "default") {
                                F += ".jstree-" + I.get_index() + " a > .jstree-icon { "
                            } else {
                                F += ".jstree-" + I.get_index() + " li[" + G + '="' + J + '"] > a > .jstree-icon { '
                            }
                            if (K.icon.image) {
                                F += " background-image:url(" + K.icon.image + "); "
                            }
                            if (K.icon.position) {
                                F += " background-position:" + K.icon.position + "; "
                            } else {
                                F += " background-position:0 0; "
                            }
                            F += "} "
                        }
                    });
                    if (F !== "") {
                        D.vakata.css.add_sheet({
                            str: F,
                            title: "jstree-types"
                        })
                    }
                }, this)).bind("before.jstree", D.proxy(function(I, H) {
                    var G, F, K = this._get_settings().types.use_data ? this._get_node(H.args[0]) : false, J = K && K !== -1 && K.length ? K.data("jstree") : false;
                    if (J && J.types && J.types[H.func] === false) {
                        I.stopImmediatePropagation();
                        return false
                    }
                    if (D.inArray(H.func, this.data.types.attach_to) !== -1) {
                        if (!H.args[0] || (!H.args[0].tagName && !H.args[0].jquery)) {
                            return
                        }
                        G = this._get_settings().types.types;
                        F = this._get_type(H.args[0]);
                        if (((G[F] && typeof G[F][H.func] !== "undefined") || (G["default"] && typeof G["default"][H.func] !== "undefined")) && this._check(H.func, H.args[0]) === false) {
                            I.stopImmediatePropagation();
                            return false
                        }
                    }
                }, this));
                if (C) {
                    this.get_container().bind("load_node.jstree set_type.jstree", D.proxy(function(I, H) {
                        var G = H && H.rslt && H.rslt.obj && H.rslt.obj !== -1 ? this._get_node(H.rslt.obj).parent() : this.get_container_ul()
                          , J = false
                          , F = this._get_settings().types;
                        D.each(F.types, function(K, L) {
                            if (L.icon && (L.icon.image || L.icon.position)) {
                                J = K === "default" ? G.find("li > a > .jstree-icon") : G.find("li[" + F.type_attr + "='" + K + "'] > a > .jstree-icon");
                                if (L.icon.image) {
                                    J.css("backgroundImage", "url(" + L.icon.image + ")")
                                }
                                J.css("backgroundPosition", L.icon.position || "0 0")
                            }
                        })
                    }, this))
                }
            },
            defaults: {
                max_children: -1,
                max_depth: -1,
                valid_children: "all",
                use_data: false,
                type_attr: "rel",
                types: {
                    "default": {
                        max_children: -1,
                        max_depth: -1,
                        valid_children: "all"
                    }
                }
            },
            _fn: {
                _types_notify: function(F, E) {
                    if (E.type && this._get_settings().types.use_data) {
                        this.set_type(E.type, F)
                    }
                },
                _get_type: function(E) {
                    E = this._get_node(E);
                    return (!E || !E.length) ? false : E.attr(this._get_settings().types.type_attr) || "default"
                },
                set_type: function(G, F) {
                    F = this._get_node(F);
                    var E = (!F.length || !G) ? false : F.attr(this._get_settings().types.type_attr, G);
                    if (E) {
                        this.__callback({
                            obj: F,
                            type: G
                        })
                    }
                    return E
                },
                _check: function(J, G, E) {
                    G = this._get_node(G);
                    var K = false
                      , L = this._get_type(G)
                      , I = 0
                      , H = this
                      , M = this._get_settings().types
                      , F = false;
                    if (G === -1) {
                        if (!!M[J]) {
                            K = M[J]
                        } else {
                            return
                        }
                    } else {
                        if (L === false) {
                            return
                        }
                        F = M.use_data ? G.data("jstree") : false;
                        if (F && F.types && typeof F.types[J] !== "undefined") {
                            K = F.types[J]
                        } else {
                            if (!!M.types[L] && typeof M.types[L][J] !== "undefined") {
                                K = M.types[L][J]
                            } else {
                                if (!!M.types["default"] && typeof M.types["default"][J] !== "undefined") {
                                    K = M.types["default"][J]
                                }
                            }
                        }
                    }
                    if (D.isFunction(K)) {
                        K = K.call(this, G)
                    }
                    if (J === "max_depth" && G !== -1 && E !== false && M.max_depth !== -2 && K !== 0) {
                        G.children("a:eq(0)").parentsUntil(".jstree", "li").each(function(N) {
                            if (M.max_depth !== -1 && M.max_depth - (N + 1) <= 0) {
                                K = 0;
                                return false
                            }
                            I = (N === 0) ? K : H._check(J, this, false);
                            if (I !== -1 && I - (N + 1) <= 0) {
                                K = 0;
                                return false
                            }
                            if (I >= 0 && (I - (N + 1) < K || K < 0)) {
                                K = I - (N + 1)
                            }
                            if (M.max_depth >= 0 && (M.max_depth - (N + 1) < K || K < 0)) {
                                K = M.max_depth - (N + 1)
                            }
                        })
                    }
                    return K
                },
                check_move: function() {
                    if (!this.__call_old()) {
                        return false
                    }
                    var E = this._get_move(), I = E.rt._get_settings().types, K = E.rt._check("max_children", E.cr), J = E.rt._check("max_depth", E.cr), G = E.rt._check("valid_children", E.cr), H = 0, L = 1, F;
                    if (G === "none") {
                        return false
                    }
                    if (D.isArray(G) && E.ot && E.ot._get_type) {
                        E.o.each(function() {
                            if (D.inArray(E.ot._get_type(this), G) === -1) {
                                L = false;
                                return false
                            }
                        });
                        if (L === false) {
                            return false
                        }
                    }
                    if (I.max_children !== -2 && K !== -1) {
                        H = E.cr === -1 ? this.get_container().find("> ul > li").not(E.o).length : E.cr.find("> ul > li").not(E.o).length;
                        if (H + E.o.length > K) {
                            return false
                        }
                    }
                    if (I.max_depth !== -2 && J !== -1) {
                        L = 0;
                        if (J === 0) {
                            return false
                        }
                        if (typeof E.o.d === "undefined") {
                            F = E.o;
                            while (F.length > 0) {
                                F = F.find("> ul > li");
                                L++
                            }
                            E.o.d = L
                        }
                        if (J - E.o.d < 0) {
                            return false
                        }
                    }
                    return true
                },
                create_node: function(H, I, F, O, K, N) {
                    if (!N && (K || this._is_loaded(H))) {
                        var G = (typeof I == "string" && I.match(/^before|after$/i) && H !== -1) ? this._get_parent(H) : this._get_node(H), P = this._get_settings().types, M = this._check("max_children", G), L = this._check("max_depth", G), J = this._check("valid_children", G), E;
                        if (typeof F === "string") {
                            F = {
                                data: F
                            }
                        }
                        if (!F) {
                            F = {}
                        }
                        if (J === "none") {
                            return false
                        }
                        if (D.isArray(J)) {
                            if (!F.attr || !F.attr[P.type_attr]) {
                                if (!F.attr) {
                                    F.attr = {}
                                }
                                F.attr[P.type_attr] = J[0]
                            } else {
                                if (D.inArray(F.attr[P.type_attr], J) === -1) {
                                    return false
                                }
                            }
                        }
                        if (P.max_children !== -2 && M !== -1) {
                            E = G === -1 ? this.get_container().find("> ul > li").length : G.find("> ul > li").length;
                            if (E + 1 > M) {
                                return false
                            }
                        }
                        if (P.max_depth !== -2 && L !== -1 && (L - 1) < 0) {
                            return false
                        }
                    }
                    return this.__call_old(true, H, I, F, O, K, N)
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("html_data", {
            __init: function() {
                this.data.html_data.original_container_html = this.get_container().find(" > ul > li").clone(true);
                this.data.html_data.original_container_html.find("li").andSelf().contents().filter(function() {
                    return this.nodeType == 3
                }).remove()
            },
            defaults: {
                data: false,
                ajax: false,
                correct_state: true
            },
            _fn: {
                load_node: function(G, E, F) {
                    var H = this;
                    this.load_node_html(G, function() {
                        H.__callback({
                            obj: H._get_node(G)
                        });
                        E.call(this)
                    }, F)
                },
                _is_loaded: function(E) {
                    E = this._get_node(E);
                    return E == -1 || !E || (!this._get_settings().html_data.ajax && !D.isFunction(this._get_settings().html_data.data)) || E.is(".jstree-open, .jstree-leaf") || E.children("ul").children("li").size() > 0
                },
                load_node_html: function(I, E, G) {
                    var K, H = this.get_settings().html_data, F = function() {}, J = function() {};
                    I = this._get_node(I);
                    if (I && I !== -1) {
                        if (I.data("jstree_is_loading")) {
                            return
                        } else {
                            I.data("jstree_is_loading", true)
                        }
                    }
                    switch (!0) {
                    case (D.isFunction(H.data)):
                        H.data.call(this, I, D.proxy(function(L) {
                            if (L && L !== "" && L.toString && L.toString().replace(/^[\s\n]+$/, "") !== "") {
                                L = D(L);
                                if (!L.is("ul")) {
                                    L = D("<ul />").append(L)
                                }
                                if (I == -1 || !I) {
                                    this.get_container().children("ul").empty().append(L.children()).find("li, a").filter(function() {
                                        return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                                    }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon")
                                } else {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.append(L).children("ul").find("li, a").filter(function() {
                                        return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                                    }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
                                    I.removeData("jstree_is_loading")
                                }
                                this.clean_node(I);
                                if (E) {
                                    E.call(this)
                                }
                            } else {
                                if (I && I !== -1) {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading");
                                    if (H.correct_state) {
                                        this.correct_state(I);
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                } else {
                                    if (H.correct_state) {
                                        this.get_container().children("ul").empty();
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                }
                            }
                        }, this));
                        break;
                    case (!H.data && !H.ajax):
                        if (!I || I == -1) {
                            this.get_container().children("ul").empty().append(this.data.html_data.original_container_html).find("li, a").filter(function() {
                                return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                            }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
                            this.clean_node()
                        }
                        if (E) {
                            E.call(this)
                        }
                        break;
                    case (!!H.data && !H.ajax) || (!!H.data && !!H.ajax && (!I || I === -1)):
                        if (!I || I == -1) {
                            K = D(H.data);
                            if (!K.is("ul")) {
                                K = D("<ul />").append(K)
                            }
                            this.get_container().children("ul").empty().append(K.children()).find("li, a").filter(function() {
                                return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                            }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
                            this.clean_node()
                        }
                        if (E) {
                            E.call(this)
                        }
                        break;
                    case (!H.data && !!H.ajax) || (!!H.data && !!H.ajax && I && I !== -1):
                        I = this._get_node(I);
                        F = function(M, N, O) {
                            var L = this.get_settings().html_data.ajax.error;
                            if (L) {
                                L.call(this, M, N, O)
                            }
                            if (I != -1 && I.length) {
                                I.children("a.jstree-loading").removeClass("jstree-loading");
                                I.removeData("jstree_is_loading");
                                if (N === "success" && H.correct_state) {
                                    this.correct_state(I)
                                }
                            } else {
                                if (N === "success" && H.correct_state) {
                                    this.get_container().children("ul").empty()
                                }
                            }
                            if (G) {
                                G.call(this)
                            }
                        }
                        ;
                        J = function(O, M, L) {
                            var N = this.get_settings().html_data.ajax.success;
                            if (N) {
                                O = N.call(this, O, M, L) || O
                            }
                            if (O === "" || (O && O.toString && O.toString().replace(/^[\s\n]+$/, "") === "")) {
                                return F.call(this, L, M, "")
                            }
                            if (O) {
                                O = D(O);
                                if (!O.is("ul")) {
                                    O = D("<ul />").append(O)
                                }
                                if (I == -1 || !I) {
                                    this.get_container().children("ul").empty().append(O.children()).find("li, a").filter(function() {
                                        return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                                    }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon")
                                } else {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.append(O).children("ul").find("li, a").filter(function() {
                                        return !this.firstChild || !this.firstChild.tagName || this.firstChild.tagName !== "INS"
                                    }).prepend("<ins class='jstree-icon'>&#160;</ins>").end().filter("a").children("ins:first-child").not(".jstree-icon").addClass("jstree-icon");
                                    I.removeData("jstree_is_loading")
                                }
                                this.clean_node(I);
                                if (E) {
                                    E.call(this)
                                }
                            } else {
                                if (I && I !== -1) {
                                    I.children("a.jstree-loading").removeClass("jstree-loading");
                                    I.removeData("jstree_is_loading");
                                    if (H.correct_state) {
                                        this.correct_state(I);
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                } else {
                                    if (H.correct_state) {
                                        this.get_container().children("ul").empty();
                                        if (E) {
                                            E.call(this)
                                        }
                                    }
                                }
                            }
                        }
                        ;
                        H.ajax.context = this;
                        H.ajax.error = F;
                        H.ajax.success = J;
                        if (!H.ajax.dataType) {
                            H.ajax.dataType = "html"
                        }
                        if (D.isFunction(H.ajax.url)) {
                            H.ajax.url = H.ajax.url.call(this, I)
                        }
                        if (D.isFunction(H.ajax.data)) {
                            H.ajax.data = H.ajax.data.call(this, I)
                        }
                        D.ajax(H.ajax);
                        break
                    }
                }
            }
        });
        D.jstree.defaults.plugins.push("html_data")
    })(jQuery);
    (function(D) {
        D.jstree.plugin("themeroller", {
            __init: function() {
                var E = this._get_settings().themeroller;
                this.get_container().addClass("ui-widget-content").addClass("jstree-themeroller").delegate("a", "mouseenter.jstree", function(F) {
                    if (!D(F.currentTarget).hasClass("jstree-loading")) {
                        D(this).addClass(E.item_h)
                    }
                }).delegate("a", "mouseleave.jstree", function() {
                    D(this).removeClass(E.item_h)
                }).bind("init.jstree", D.proxy(function(G, F) {
                    F.inst.get_container().find("> ul > li > .jstree-loading > ins").addClass("ui-icon-refresh");
                    this._themeroller(F.inst.get_container().find("> ul > li"))
                }, this)).bind("open_node.jstree create_node.jstree", D.proxy(function(G, F) {
                    this._themeroller(F.rslt.obj)
                }, this)).bind("loaded.jstree refresh.jstree", D.proxy(function(F) {
                    this._themeroller()
                }, this)).bind("close_node.jstree", D.proxy(function(G, F) {
                    this._themeroller(F.rslt.obj)
                }, this)).bind("delete_node.jstree", D.proxy(function(G, F) {
                    this._themeroller(F.rslt.parent)
                }, this)).bind("correct_state.jstree", D.proxy(function(G, F) {
                    F.rslt.obj.children("ins.jstree-icon").removeClass(E.opened + " " + E.closed + " ui-icon").end().find("> a > ins.ui-icon").filter(function() {
                        return this.className.toString().replace(E.item_clsd, "").replace(E.item_open, "").replace(E.item_leaf, "").indexOf("ui-icon-") === -1
                    }).removeClass(E.item_open + " " + E.item_clsd).addClass(E.item_leaf || "jstree-no-icon")
                }, this)).bind("select_node.jstree", D.proxy(function(G, F) {
                    F.rslt.obj.children("a").addClass(E.item_a)
                }, this)).bind("deselect_node.jstree deselect_all.jstree", D.proxy(function(G, F) {
                    this.get_container().find("a." + E.item_a).removeClass(E.item_a).end().find("a.jstree-clicked").addClass(E.item_a)
                }, this)).bind("dehover_node.jstree", D.proxy(function(G, F) {
                    F.rslt.obj.children("a").removeClass(E.item_h)
                }, this)).bind("hover_node.jstree", D.proxy(function(G, F) {
                    this.get_container().find("a." + E.item_h).not(F.rslt.obj).removeClass(E.item_h);
                    F.rslt.obj.children("a").addClass(E.item_h)
                }, this)).bind("move_node.jstree", D.proxy(function(G, F) {
                    this._themeroller(F.rslt.o);
                    this._themeroller(F.rslt.op)
                }, this))
            },
            __destroy: function() {
                var E = this._get_settings().themeroller
                  , F = ["ui-icon"];
                D.each(E, function(H, G) {
                    G = G.split(" ");
                    if (G.length) {
                        F = F.concat(G)
                    }
                });
                this.get_container().removeClass("ui-widget-content").find("." + F.join(", .")).removeClass(F.join(" "))
            },
            _fn: {
                _themeroller: function(F) {
                    var E = this._get_settings().themeroller;
                    F = !F || F == -1 ? this.get_container_ul() : this._get_node(F).parent();
                    F.find("li.jstree-closed").children("ins.jstree-icon").removeClass(E.opened).addClass("ui-icon " + E.closed).end().children("a").addClass(E.item).children("ins.jstree-icon").addClass("ui-icon").filter(function() {
                        return this.className.toString().replace(E.item_clsd, "").replace(E.item_open, "").replace(E.item_leaf, "").indexOf("ui-icon-") === -1
                    }).removeClass(E.item_leaf + " " + E.item_open).addClass(E.item_clsd || "jstree-no-icon").end().end().end().end().find("li.jstree-open").children("ins.jstree-icon").removeClass(E.closed).addClass("ui-icon " + E.opened).end().children("a").addClass(E.item).children("ins.jstree-icon").addClass("ui-icon").filter(function() {
                        return this.className.toString().replace(E.item_clsd, "").replace(E.item_open, "").replace(E.item_leaf, "").indexOf("ui-icon-") === -1
                    }).removeClass(E.item_leaf + " " + E.item_clsd).addClass(E.item_open || "jstree-no-icon").end().end().end().end().find("li.jstree-leaf").children("ins.jstree-icon").removeClass(E.closed + " ui-icon " + E.opened).end().children("a").addClass(E.item).children("ins.jstree-icon").addClass("ui-icon").filter(function() {
                        return this.className.toString().replace(E.item_clsd, "").replace(E.item_open, "").replace(E.item_leaf, "").indexOf("ui-icon-") === -1
                    }).removeClass(E.item_clsd + " " + E.item_open).addClass(E.item_leaf || "jstree-no-icon")
                }
            },
            defaults: {
                opened: "ui-icon-triangle-1-se",
                closed: "ui-icon-triangle-1-e",
                item: "ui-state-default",
                item_h: "ui-state-hover",
                item_a: "ui-state-active",
                item_open: "ui-icon-folder-open",
                item_clsd: "ui-icon-folder-collapsed",
                item_leaf: "ui-icon-document"
            }
        });
        D(function() {
            var E = ".jstree-themeroller .ui-icon { overflow:visible; } .jstree-themeroller a { padding:0 2px; } .jstree-themeroller .jstree-no-icon { display:none; }";
            D.vakata.css.add_sheet({
                str: E,
                title: "jstree"
            })
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("unique", {
            __init: function() {
                this.get_container().bind("before.jstree", D.proxy(function(J, H) {
                    var E = [], G = true, I, F;
                    if (H.func == "move_node") {
                        if (H.args[4] === true) {
                            if (H.args[0].o && H.args[0].o.length) {
                                H.args[0].o.children("a").each(function() {
                                    E.push(D(this).text().replace(/^\s+/g, ""))
                                });
                                G = this._check_unique(E, H.args[0].np.find("> ul > li").not(H.args[0].o), "move_node")
                            }
                        }
                    }
                    if (H.func == "create_node") {
                        if (H.args[4] || this._is_loaded(H.args[0])) {
                            I = this._get_node(H.args[0]);
                            if (H.args[1] && (H.args[1] === "before" || H.args[1] === "after")) {
                                I = this._get_parent(H.args[0]);
                                if (!I || I === -1) {
                                    I = this.get_container()
                                }
                            }
                            if (typeof H.args[2] === "string") {
                                E.push(H.args[2])
                            } else {
                                if (!H.args[2] || !H.args[2].data) {
                                    E.push(this._get_string("new_node"))
                                } else {
                                    E.push(H.args[2].data)
                                }
                            }
                            G = this._check_unique(E, I.find("> ul > li"), "create_node")
                        }
                    }
                    if (H.func == "rename_node") {
                        E.push(H.args[1]);
                        F = this._get_node(H.args[0]);
                        I = this._get_parent(F);
                        if (!I || I === -1) {
                            I = this.get_container()
                        }
                        G = this._check_unique(E, I.find("> ul > li").not(F), "rename_node")
                    }
                    if (!G) {
                        J.stopPropagation();
                        return false
                    }
                }, this))
            },
            defaults: {
                error_callback: D.noop
            },
            _fn: {
                _check_unique: function(F, H, G) {
                    var E = [];
                    H.children("a").each(function() {
                        E.push(D(this).text().replace(/^\s+/g, ""))
                    });
                    if (!E.length || !F.length) {
                        return true
                    }
                    E = E.sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g, "$1$2$4").replace(/,,+/g, ",").replace(/,$/, "").split(",");
                    if ((E.length + F.length) != E.concat(F).sort().join(",,").replace(/(,|^)([^,]+)(,,\2)+(,|$)/g, "$1$2$4").replace(/,,+/g, ",").replace(/,$/, "").split(",").length) {
                        this._get_settings().unique.error_callback.call(null, F, H, G);
                        return false
                    }
                    return true
                },
                check_move: function() {
                    if (!this.__call_old()) {
                        return false
                    }
                    var F = this._get_move()
                      , E = [];
                    if (F.o && F.o.length) {
                        F.o.children("a").each(function() {
                            E.push(D(this).text().replace(/^\s+/g, ""))
                        });
                        return this._check_unique(E, F.np.find("> ul > li").not(F.o), "check_move")
                    }
                    return true
                }
            }
        })
    })(jQuery);
    (function(D) {
        D.jstree.plugin("wholerow", {
            __init: function() {
                if (!this.data.ui) {
                    throw "jsTree wholerow: jsTree UI plugin not included."
                }
                this.data.wholerow.html = false;
                this.data.wholerow.to = false;
                this.get_container().bind("init.jstree", D.proxy(function(F, E) {
                    this._get_settings().core.animation = 0
                }, this)).bind("open_node.jstree create_node.jstree clean_node.jstree loaded.jstree", D.proxy(function(F, E) {
                    this._prepare_wholerow_span(E && E.rslt && E.rslt.obj ? E.rslt.obj : -1)
                }, this)).bind("search.jstree clear_search.jstree reopen.jstree after_open.jstree after_close.jstree create_node.jstree delete_node.jstree clean_node.jstree", D.proxy(function(F, E) {
                    if (this.data.to) {
                        clearTimeout(this.data.to)
                    }
                    this.data.to = setTimeout((function(G, H) {
                        return function() {
                            G._prepare_wholerow_ul(H)
                        }
                    })(this, E && E.rslt && E.rslt.obj ? E.rslt.obj : -1), 0)
                }, this)).bind("deselect_all.jstree", D.proxy(function(F, E) {
                    this.get_container().find(" > .jstree-wholerow .jstree-clicked").removeClass("jstree-clicked " + (this.data.themeroller ? this._get_settings().themeroller.item_a : ""))
                }, this)).bind("select_node.jstree deselect_node.jstree ", D.proxy(function(F, E) {
                    E.rslt.obj.each(function() {
                        var G = E.inst.get_container().find(" > .jstree-wholerow li:visible:eq(" + (parseInt(((D(this).offset().top - E.inst.get_container().offset().top + E.inst.get_container()[0].scrollTop) / E.inst.data.core.li_height), 10)) + ")");
                        G.children("a").attr("class", E.rslt.obj.children("a").attr("class"))
                    })
                }, this)).bind("hover_node.jstree dehover_node.jstree", D.proxy(function(G, F) {
                    this.get_container().find(" > .jstree-wholerow .jstree-hovered").removeClass("jstree-hovered " + (this.data.themeroller ? this._get_settings().themeroller.item_h : ""));
                    if (G.type === "hover_node") {
                        var E = this.get_container().find(" > .jstree-wholerow li:visible:eq(" + (parseInt(((F.rslt.obj.offset().top - this.get_container().offset().top + this.get_container()[0].scrollTop) / this.data.core.li_height), 10)) + ")");
                        E.children("a").attr("class", F.rslt.obj.children(".jstree-hovered").attr("class"))
                    }
                }, this)).delegate(".jstree-wholerow-span, ins.jstree-icon, li", "click.jstree", function(E) {
                    var F = D(E.currentTarget);
                    if (E.target.tagName === "A" || (E.target.tagName === "INS" && F.closest("li").is(".jstree-open, .jstree-closed"))) {
                        return
                    }
                    F.closest("li").children("a:visible:eq(0)").click();
                    E.stopImmediatePropagation()
                }).delegate("li", "mouseover.jstree", D.proxy(function(E) {
                    E.stopImmediatePropagation();
                    if (D(E.currentTarget).children(".jstree-hovered, .jstree-clicked").length) {
                        return false
                    }
                    this.hover_node(E.currentTarget);
                    return false
                }, this)).delegate("li", "mouseleave.jstree", D.proxy(function(E) {
                    if (D(E.currentTarget).children("a").hasClass("jstree-hovered").length) {
                        return
                    }
                    this.dehover_node(E.currentTarget)
                }, this));
                if (B || C) {
                    D.vakata.css.add_sheet({
                        str: ".jstree-" + this.get_index() + " { position:relative; } ",
                        title: "jstree"
                    })
                }
            },
            defaults: {},
            __destroy: function() {
                this.get_container().children(".jstree-wholerow").remove();
                this.get_container().find(".jstree-wholerow-span").remove()
            },
            _fn: {
                _prepare_wholerow_span: function(E) {
                    E = !E || E == -1 ? this.get_container().find("> ul > li") : this._get_node(E);
                    if (E === false) {
                        return
                    }
                    E.each(function() {
                        D(this).find("li").andSelf().each(function() {
                            var F = D(this);
                            if (F.children(".jstree-wholerow-span").length) {
                                return true
                            }
                            F.prepend("<span class='jstree-wholerow-span' style='width:" + (F.parentsUntil(".jstree", "li").length * 18) + "px;'>&#160;</span>")
                        })
                    })
                },
                _prepare_wholerow_ul: function() {
                    var F = this.get_container().children("ul").eq(0)
                      , E = F.html();
                    F.addClass("jstree-wholerow-real");
                    if (this.data.wholerow.last_html !== E) {
                        this.data.wholerow.last_html = E;
                        this.get_container().children(".jstree-wholerow").remove();
                        this.get_container().append(F.clone().removeClass("jstree-wholerow-real").wrapAll("<div class='jstree-wholerow' />").parent().width(F.parent()[0].scrollWidth).css("top", (F.height() + (B ? 5 : 0)) * -1).find("li[id]").each(function() {
                            this.removeAttribute("id")
                        }).end())
                    }
                }
            }
        });
        D(function() {
            var E = ".jstree .jstree-wholerow-real { position:relative; z-index:1; } .jstree .jstree-wholerow-real li { cursor:pointer; } .jstree .jstree-wholerow-real a { border-left-color:transparent !important; border-right-color:transparent !important; } .jstree .jstree-wholerow { position:relative; z-index:0; height:0; } .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { width:100%; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li, .jstree .jstree-wholerow a { margin:0 !important; padding:0 !important; } .jstree .jstree-wholerow, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow li { background:transparent !important; }.jstree .jstree-wholerow ins, .jstree .jstree-wholerow span, .jstree .jstree-wholerow input { display:none !important; }.jstree .jstree-wholerow a, .jstree .jstree-wholerow a:hover { text-indent:-9999px; !important; width:100%; padding:0 !important; border-right-width:0px !important; border-left-width:0px !important; } .jstree .jstree-wholerow-span { position:absolute; left:0; margin:0px; padding:0; height:18px; border-width:0; padding:0; z-index:0; }";
            if (A) {
                E += ".jstree .jstree-wholerow a { display:block; height:18px; margin:0; padding:0; border:0; } .jstree .jstree-wholerow-real a { border-color:transparent !important; } "
            }
            if (B || C) {
                E += ".jstree .jstree-wholerow, .jstree .jstree-wholerow li, .jstree .jstree-wholerow ul, .jstree .jstree-wholerow a { margin:0; padding:0; line-height:18px; } .jstree .jstree-wholerow a { display:block; height:18px; line-height:18px; overflow:hidden; } "
            }
            D.vakata.css.add_sheet({
                str: E,
                title: "jstree"
            })
        })
    })(jQuery);
    (function(D) {
        var E = ["getChildren", "getChildrenCount", "getAttr", "getName", "getProps"]
          , F = function(I, G) {
            var H = true;
            I = I || {};
            G = [].concat(G);
            D.each(G, function(K, J) {
                if (!D.isFunction(I[J])) {
                    H = false;
                    return false
                }
            });
            return H
        };
        D.jstree.plugin("model", {
            __init: function() {
                if (!this.data.json_data) {
                    throw "jsTree model: jsTree json_data plugin not included."
                }
                this._get_settings().json_data.data = function(I, G) {
                    var H = (I == -1) ? this._get_settings().model.object : I.data("jstree_model");
                    if (!F(H, E)) {
                        return G.call(null, false)
                    }
                    if (this._get_settings().model.async) {
                        H.getChildren(D.proxy(function(J) {
                            this.model_done(J, G)
                        }, this))
                    } else {
                        this.model_done(H.getChildren(), G)
                    }
                }
            },
            defaults: {
                object: false,
                id_prefix: false,
                async: false
            },
            _fn: {
                model_done: function(I, K) {
                    var G = []
                      , H = this._get_settings()
                      , J = this;
                    if (!D.isArray(I)) {
                        I = [I]
                    }
                    D.each(I, function(L, N) {
                        var M = N.getProps() || {};
                        M.attr = N.getAttr() || {};
                        if (N.getChildrenCount()) {
                            M.state = "closed"
                        }
                        M.data = N.getName();
                        if (!D.isArray(M.data)) {
                            M.data = [M.data]
                        }
                        if (J.data.types && D.isFunction(N.getType)) {
                            M.attr[H.types.type_attr] = N.getType()
                        }
                        if (M.attr.id && H.model.id_prefix) {
                            M.attr.id = H.model.id_prefix + M.attr.id
                        }
                        if (!M.metadata) {
                            M.metadata = {}
                        }
                        M.metadata.jstree_model = N;
                        G.push(M)
                    });
                    K.call(null, G)
                }
            }
        })
    })(jQuery)
})();
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:content-tree-node-types', location = '/static/model/content-tree-node-types.js' */
define("model/content-tree-node-types", function() {
    return {
        DIRECTORY: "DIRECTORY",
        FILE: "FILE",
        SUBMODULE: "SUBMODULE"
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:path-and-line', location = '/static/model/path-and-line.js' */
define("model/path-and-line", ["model/path"], function(A) {
    function B(F, D, G) {
        this.path = new A((F && F.path) || F);
        if (D) {
            this.line = {
                no: D,
                type: G || "TO"
            }
        } else {
            if (F && F.line) {
                this.line = F.line
            } else {
                var H = this.path.getComponents();
                var E = H.length - 1;
                if (E >= 0) {
                    var C = H[E];
                    var I = Math.max(C.lastIndexOf("?F"), C.lastIndexOf("?T"));
                    if (I > 0) {
                        D = Number(C.substring(I + 2)) || undefined;
                        if (D) {
                            this.line = {
                                no: D,
                                type: C[I + 1] === "F" ? "FROM" : "TO"
                            };
                            H[E] = C.substring(0, I);
                            this.path = new A(H)
                        }
                    }
                }
            }
        }
    }
    B.prototype.toString = function() {
        return this.path.toString() + (this.line ? (this.line.type === "FROM" ? "?F" : "?T") + this.line.no : "")
    }
    ;
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:difftree', location = '/static/feature/changeset/difftree/difftree.js' */
define("feature/changeset/difftree", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "util/events", "model/content-tree-node-types", "model/path-and-line", "feature/changeset/difftree/difftree-search", "exports"], function(J, F, a, I, Q, B, P, R, M, b) {
    var D = "/";
    var O = 1000;
    var H = 200;
    var U = 50;
    function T(c, e) {
        e = e >= 0 ? e : H;
        var f = 0;
        function d(j) {
            if (j.metadata.isDirectory) {
                j.state = "open";
                j.data.icon = "aui-icon aui-icon-small aui-iconfont-devtools-folder-open";
                for (var h = 0, g = j.children.length, k; h < g && f < e; h++) {
                    k = j.children[h];
                    d(k)
                }
            } else {
                if (j.metadata.isFile) {
                    if (j.children && j.children.length > 0) {
                        j.state = "open"
                    }
                    f += (j.children ? j.children.length : 1)
                }
            }
        }
        d(c);
        return c
    }
    function S(d, c) {
        return d.children ? (c.children ? (d.data.title.toLowerCase() < c.data.title.toLowerCase() ? -1 : 1) : -1) : (!c.children ? (d.data.title.toLowerCase() < c.data.title.toLowerCase() ? -1 : 1) : 1)
    }
    function Z(c) {
        c.childrenByTypeAndComponent = undefined;
        for (var e = 0, d = c.children.length, g, f; e < d; e++) {
            g = c.children[e];
            if (g.metadata.isDirectory) {
                f = [g.data.title];
                while (g.children.length === 1 && g.children[0].metadata.isDirectory) {
                    g = g.children[0];
                    f.push(g.data.title)
                }
                g.data.title = J.escapeHtml(f.join(D));
                c.children[e] = g;
                Z(g)
            }
        }
        c.children.sort(S)
    }
    function E(q, n) {
        var t = {
            data: {
                icon: "aui-icon aui-icon-small aui-iconfont-devtools-folder-closed"
            },
            state: "closed",
            metadata: {
                isDirectory: true
            },
            children: [],
            childrenByTypeAndComponent: {}
        };
        for (var m = 0, e = q.length, p, d; m < e; m++) {
            p = q[m];
            d = t;
            for (var h = 0, f = p.path.components.length, o, s, c; h < f; h++) {
                o = p.path.components[h];
                s = (h + 1 === f ? "F" : "D") + o;
                if (Object.prototype.hasOwnProperty.call(d.childrenByTypeAndComponent, s)) {
                    d = d.childrenByTypeAndComponent[s]
                } else {
                    var g = h + 1 === f;
                    if (g) {
                        var r = !!(p.properties && p.properties.activeComments);
                        c = {
                            data: {
                                title: J.escapeHtml(o),
                                icon: "aui-icon aui-icon-small " + (p.nodeType === P.SUBMODULE ? "aui-iconfont-devtools-submodule" : r ? "aui-iconfont-devtools-file-commented" : "aui-iconfont-devtools-file"),
                                attr: {
                                    id: "change" + m,
                                    "class": "difftree-file change-type-" + p.type + (p.conflict ? " conflict" : ""),
                                    href: "#" + p.path.toString,
                                    title: p.conflict ? "Merge conflict" : r ? "This file has comments" : undefined
                                }
                            },
                            metadata: {
                                isFile: true,
                                changeType: p.type,
                                nodeType: p.nodeType,
                                path: p.path,
                                srcPath: p.srcPath,
                                conflict: p.conflict,
                                contentId: p.contentId,
                                executable: p.executable,
                                srcExecutable: p.srcExecutable
                            }
                        }
                    } else {
                        c = {
                            data: {
                                title: J.escapeHtml(o),
                                icon: "aui-icon aui-icon-small aui-iconfont-devtools-folder-closed"
                            },
                            state: "closed",
                            metadata: {
                                isDirectory: true
                            },
                            children: [],
                            childrenByTypeAndComponent: {}
                        }
                    }
                    d.children.push(c);
                    d = d.childrenByTypeAndComponent[s] = c
                }
            }
        }
        Z(t);
        T(t, n);
        return t
    }
    function V(e, d, c) {
        return I.rest().currentRepo().changes(c).withParams({
            start: e,
            limit: d
        })
    }
    function L(f, e, c, d) {
        d = d || {};
        this._fileLimit = d.maxChanges || O;
        this._$wrapper = F(f);
        this._$toolbar = F(e);
        this._commitRange = c;
        this._hasOtherParents = !!d.hasOtherParents;
        this._urlBuilder = d.urlBuilder || V;
        this._searchUrlBuilder = d.searchUrlBuilder
    }
    a.extend(L.prototype, B.createEventMixin("diffTree", {
        localOnly: true
    }));
    L.prototype.init = function(c) {
        this._destroyables = [];
        this._initiallySelectedPathComponents = c;
        this._firstCommentAddedHandler = a.bind(this._firstCommentAddedHandler, this);
        this._lastCommentDeletedHandler = a.bind(this._lastCommentDeletedHandler, this);
        this._destroyables.push(B.chain().on("stash.feature.comments.firstCommentAdded", this._firstCommentAddedHandler).on("stash.feature.comments.lastCommentDeleted", this._lastCommentDeletedHandler));
        if (this._searchUrlBuilder) {
            this._destroyables.push(this._addSearch())
        }
        if (!this.data) {
            return this.requestData()
        } else {
            return this.dataReceived(this.data)
        }
    }
    ;
    L.prototype._addSearch = function() {
        var f = F(stash.feature.difftree.searchWrapper());
        this._$toolbar.find("h4").replaceWith(f);
        var e = new M.DiffTreeSearch();
        f.prepend(e.input.$el);
        var c = [];
        var d = this;
        c.push(e);
        c.push(B.chainWith(f.find(".search-button-when-collapsed")).on("click", function() {
            e.focusSearch()
        }));
        c.push(B.chainWith(e).on("search-focus", a.bind(this.trigger, this, "search-focus")));
        c.push({
            destroy: e.register(function(h) {
                function g() {
                    return d._getFileCount(d.data, U) < U
                }
                return Q.rest({
                    url: d._searchUrlBuilder({
                        path: "",
                        commitRange: d._commitRange.toJSON()
                    }).withParams({
                        withComments: false
                    }).withParams(h && (d._commitRange.getPullRequest() || !g()) ? {
                        filter: h
                    } : {}).build()
                })
            }, function() {
                return d.data
            }).onValue(function(g) {
                d.data_copy = d.data;
                d._searchEmpty = g.data.children.length === 0;
                B.trigger("internal.stash.feature.diffView.highlightSearch", null, g.search);
                d.dataReceived(T(g.data)).done(function() {
                    d.data = d.data_copy;
                    d._searchEmpty = null
                })
            })
        });
        return {
            destroy: function() {
                a.invoke(c, "destroy");
                e.input.$el.remove()
            }
        }
    }
    ;
    L.prototype._getFileCount = function(e, c) {
        function d(f) {
            return a.reduce(f.children, function(h, g) {
                if (h < c) {
                    return h + (g.metadata.isFile ? 1 : d(g))
                } else {
                    return h
                }
            }, 0)
        }
        return d(e)
    }
    ;
    L.prototype._firstCommentAddedHandler = function() {
        var c = this.getSelectedFile().find("a > ins");
        c.hide().removeClass("aui-iconfont-devtools-file").addClass("aui-iconfont-devtools-file-commented").fadeIn("slow")
    }
    ;
    L.prototype._lastCommentDeletedHandler = function() {
        var c = this.getSelectedFile().find("a > ins");
        c.hide().removeClass("aui-iconfont-devtools-file-commented").addClass("aui-iconfont-devtools-file").fadeIn("slow")
    }
    ;
    L.prototype.reset = function() {
        if (this._request) {
            this._request.abort();
            this._request = null;
            this._interrupted = true
        }
        if (this._rendering) {
            this._rendering = false;
            this._interrupted = true
        }
        a.invoke(this._destroyables, "destroy")
    }
    ;
    L.prototype.requestData = function() {
        var c = this;
        if (this._request) {
            this._request.abort();
            this._request = null
        }
        this._request = Q.rest({
            url: c._urlBuilder(0, c._fileLimit, c._commitRange).build()
        });
        return this._request.always(function() {
            c._request = null
        }).then(function(d) {
            if (!d) {
                var e = J.escapeHtml("This pull request returned no data to display");
                c.prependMessage(e, "error");
                return F.Deferred().reject()
            } else {
                c._rendering = true;
                c._interrupted = false;
                c.isTruncated = !d.isLastPage;
                return c.dataReceived(E(d.values)).done(function() {
                    c._rendering = false
                })
            }
        })
    }
    ;
    function W(d, c) {
        return d.substring(0, c.length) === c
    }
    function Y(d, c) {
        return C(d, c) || X(d)
    }
    function C(g, j) {
        if (!j) {
            return null
        }
        j = j.slice(0);
        while (g && g.children) {
            var d = j.shift()
              , c = !j.length;
            var e = g.children.length;
            while (e--) {
                var f = g.children[e]
                  , h = f.data.title;
                if (d === h && c === Boolean(f.metadata.isFile)) {
                    g = f;
                    break
                }
                if (!c && W(h, d + D)) {
                    while (j.length > 1 && W(h, d + D + j[0])) {
                        d += D;
                        d += j.shift()
                    }
                    if (h !== d) {
                        return null
                    }
                    g = f;
                    break
                }
            }
            if (e < 0) {
                return null
            }
        }
        return g && g.metadata && g.metadata.isFile ? g : null
    }
    function X(c) {
        while (c && c.children) {
            c = c.children[0]
        }
        return c && c.metadata && c.metadata.isFile ? c : null
    }
    function G(d, f) {
        if (d === f) {
            return [f]
        }
        var e = d.children ? d.children.length : 0;
        while (e--) {
            var c = G(d.children[e], f);
            if (c) {
                c.unshift(d);
                return c
            }
        }
        return null
    }
    L.prototype.prependMessage = function(d, c) {
        this._$wrapper.find(".aui-message").remove();
        c = c || "warning";
        this._$wrapper.find(".file-tree").before(aui.message[c]({
            extraClasses: "diff-tree-scm-message",
            content: d
        }))
    }
    ;
    L.prototype.dataReceived = function(g) {
        var o = this;
        this.data = g;
        var p = F.Deferred();
        function h() {
            if (!o._interrupted) {
                p.resolve(o)
            } else {
                p.reject(o)
            }
        }
        var j = Y(this.data, this._initiallySelectedPathComponents);
        var f;
        if (j) {
            f = [j.data.attr.id];
            var l = G(this.data, j) || [];
            l.pop();
            while (l.length) {
                l.pop().state = "open"
            }
        } else {
            f = []
        }
        var d = true;
        var i;
        this._$wrapper.find(".aui-message").remove();
        if (this.isTruncated) {
            var e = "";
            if (this._commitRange.getPullRequest()) {
                e = J.escapeHtml(J.format("This pull request is too large to render. Showing the first {0} files.", this._fileLimit))
            } else {
                var m, k = this._commitRange.getUntilRevision(), c = this._commitRange.getSinceRevision();
                if (c) {
                    m = "git diff-tree -C -r " + c.getId() + " " + k.getId()
                } else {
                    m = "git diff-tree -r --root " + k.getId()
                }
                e = J.escapeHtml(J.format("This changeset is too large to render. Showing the first {0} files. You can still retrieve it manually with the following Git command.", this._fileLimit)) + '<p class="scm-command">' + J.escapeHtml(m) + "</p>"
            }
            this.prependMessage(e, "warning")
        }
        if (this.data.children.length) {
            this.$tree = this._$wrapper.children(".file-tree");
            this.$tree.fadeOut("fast", function() {
                o.$tree.empty().off(".jstree").jstree("destroy").on("loaded.jstree", function() {
                    setTimeout(function() {
                        d = false;
                        h()
                    }, 0)
                }).jstree({
                    json_data: {
                        data: o.data.children,
                        progressive_render: true
                    },
                    core: {
                        html_titles: true,
                        animation: 200
                    },
                    ui: {
                        select_limit: 1,
                        selected_parent_close: false,
                        initially_select: f
                    },
                    plugins: ["json_data", "ui"]
                }).on("before.jstree", function(s, r) {
                    if (r.func === "select_node") {
                        var q = F(r.args[0]).parent();
                        if (q.hasClass("jstree-leaf") && (!i || i[0] !== q[0])) {
                            i = q;
                            B.trigger("stash.feature.changeset.difftree.selectedNodeChanged", o, q, d)
                        } else {
                            if (q.length > 0) {
                                o.$tree.jstree("toggle_node", q);
                                return false
                            }
                        }
                    }
                }).on("open_node.jstree", function(r, q) {
                    var s = q.args[0];
                    if (s.data().isDirectory) {
                        var t = s.children("a").children("ins");
                        t.removeClass("aui-iconfont-devtools-folder-closed");
                        t.addClass("aui-iconfont-devtools-folder-open")
                    }
                    B.trigger("stash.feature.changeset.difftree.nodeOpening", o, s)
                }).on("after_open.jstree", function(r, q) {
                    var s = q.args[0];
                    B.trigger("stash.feature.changeset.difftree.nodeOpened", o, s)
                }).on("close_node.jstree", function(s, r) {
                    var q = r.args[0];
                    if (q.data().isDirectory) {
                        var t = q.children("a").children("ins");
                        t.removeClass("aui-iconfont-devtools-folder-open");
                        t.addClass("aui-iconfont-devtools-folder-closed")
                    }
                    B.trigger("stash.feature.changeset.difftree.nodeClosing", o, q)
                }).on("after_close.jstree", function(s, r) {
                    var q = r.args[0];
                    B.trigger("stash.feature.changeset.difftree.nodeClosed", o, q)
                }).on("loaded.jstree", function(r, q) {
                    B.trigger("stash.feature.changeset.difftree.treeInitialised", o, o)
                }).fadeIn("fast")
            })
        } else {
            this.$tree = undefined;
            var n = this._$wrapper.children(".file-tree");
            n.fadeOut("fast", function() {
                n.empty().off(".jstree").jstree("destroy");
                var q = J.escapeHtml(o._searchEmpty ? "No matching lines found" : o._hasOtherParents ? "There are no changes to this parent. Use the selector above to switch the parent." : "There are no changes");
                o.prependMessage(q, "info");
                setTimeout(h, 0)
            })
        }
        return p.promise().always(function() {
            o._$wrapper.attr("data-last-updated", new Date().getTime())
        })
    }
    ;
    L.prototype.getSelectedFile = function() {
        return this.$tree ? this.$tree.jstree("get_selected") : null
    }
    ;
    L.prototype._getSelectedFileOrTree = function() {
        var c = this.getSelectedFile();
        return c && c.length > 0 ? c : this.$tree
    }
    ;
    L.prototype.selectFile = function(f) {
        if (!this.$tree) {
            return
        }
        var c = Y(this.data, f)
          , d = this.getSelectedFile()
          , g = d && d.data("path")
          , e = g && Y(this.data, new R(g).path.getComponents());
        if (c && c !== e) {
            this.$tree.jstree("deselect_all").jstree("select_node", "#" + c.data.attr.id)
        }
    }
    ;
    L.prototype.openNextFile = function() {
        if (this.$tree) {
            var c = F.jstree._reference(this.$tree)
              , e = this._getSelectedFileOrTree()
              , d = N(c, c._get_next, c._get_next(e));
            if (d && d.length) {
                d.find("a").focus().click()
            }
        }
    }
    ;
    L.prototype.openPrevFile = function() {
        if (this.$tree) {
            var c = F.jstree._reference(this.$tree)
              , e = this._getSelectedFileOrTree()
              , d = K(c, c._get_prev(e));
            if (d && d.length) {
                d.find("a").focus().click()
            }
        }
    }
    ;
    function N(d, e, c) {
        if (c && c.length && !c.hasClass("jstree-leaf")) {
            d.open_node(c);
            c = N(d, e, e.call(d, c))
        }
        return c
    }
    function K(d, c) {
        if (c && !c.hasClass("jstree-leaf")) {
            if (c.hasClass("jstree-closed")) {
                d.open_node(c);
                c = N(d, A, A.call(d, c))
            } else {
                if (c.length) {
                    c = K(d, d._get_prev(c))
                }
            }
        }
        return c
    }
    function A(c) {
        return this._get_children(c).filter(".jstree-last")
    }
    b.DiffTree = L;
    b.computeTree = E;
    b.flattenTree = Z;
    b._openTree = T;
    b.compareTreeNodes = S;
    b.getNodeToSelect = Y;
    b.getPathFromRoot = G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:difftree', location = '/static/feature/changeset/difftree/difftree-search-input.js' */
define("feature/changeset/difftree/difftree-search-input", ["aui", "bacon", "jquery", "lodash", "util/events", "util/function"], function(A, G, F, B, C, D) {
    G;
    function E(H) {
        this.$el = F(stash.feature.difftree.searchInput(H));
        this._destroyables = [];
        var J = this.$el.find("input");
        var I = this.$el.find(".delete-button");
        this._destroyables.push(C.chainWith(I).on("click", function(K) {
            K.preventDefault();
            J.val("").trigger("input")
        }));
        this._destroyables.push(C.chainWith(J).on("input", function(K) {
            I.toggle(!!this.value)
        }))
    }
    E.prototype.getInputs = function() {
        var L = this.$el.find(".delete-button").asEventStream("click");
        var K = this.$el.find("input").asEventStream("keyup");
        var J = D.dotEq.bind(null, "keyCode");
        var I = K.filter(J(A.keyCode.ESCAPE));
        var H = J(A.keyCode.ENTER);
        return K.filter(H).merge(I).doAction(".preventDefault").doAction(".currentTarget.blur").filter(H).flatMap(function(M) {
            return M.target.value
        }).merge(L.map(D.constant(""))).skipDuplicates()
    }
    ;
    E.prototype.destroy = function() {
        B.invoke(this._destroyables, "destroy")
    }
    ;
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:difftree', location = '/static/feature/changeset/difftree/difftree-search.js' */
define("feature/changeset/difftree/difftree-search", ["aui", "bacon", "jquery", "lodash", "util/bacon", "util/events", "util/function", "util/promise", "model/path", "model/path-and-line", "feature/changeset/difftree/difftree-search-input", "exports"], function(F, H, E, Q, D, B, G, O, N, M, L, R) {
    function C(T, S) {
        return {
            length: T.length,
            indexOf: function(U, V) {
                return S ? U.indexOf(T, V) : U.toLowerCase().indexOf(T.toLowerCase(), V)
            }
        }
    }
    function J(S, X) {
        var U = 30;
        var W = X.indexOf(S);
        S = W > U ? "..." + S.substring(W - U) : S;
        var Y = 0;
        var V = "";
        for (var T = 0; Y < S.length && T < 100; T++) {
            W = X.indexOf(S, Y);
            W = W < 0 ? S.length : W;
            V += F.escapeHtml(S.substring(Y, W));
            if (W < S.length) {
                V += "<strong>" + F.escapeHtml(S.substring(W, W + X.length)) + "</strong>"
            }
            Y = W + X.length
        }
        return V
    }
    function A(S) {
        var T = {};
        function U(V) {
            if (V.metadata.isDirectory) {
                V.children.forEach(U)
            } else {
                T[V.data.attr.href.substring(1)] = V
            }
        }
        U(S);
        return T
    }
    function P(S) {
        return H.fromBinder(function(T) {
            S.diffs.forEach(function(V) {
                var U = new N(V.destination || V.source);
                (V.hunks || []).forEach(function(W) {
                    W.segments.forEach(function(X) {
                        X.lines.forEach(function(Y) {
                            T({
                                path: U.toString(),
                                type: X.type,
                                lineNumber: X.type === "ADDED" ? Y.destination : Y.source,
                                line: Y.line
                            })
                        })
                    })
                })
            });
            T(new H.End());
            return E.noop
        })
    }
    function K(S, V, T) {
        var U = A(S);
        D.split(P(T).filter(function(X) {
            return V.indexOf(X.line) >= 0
        }), G.dot("path")).onValue(function(Y) {
            var X = Q.reduce(Y, function(a, Z) {
                return Math.max(a, Z.lineNumber.toString().length)
            }, 0);
            Y.forEach(function(c) {
                var Z = U[c.path];
                if (!Z) {
                    return
                }
                Z.children = Z.children || [];
                var a = new M(c.path,c.lineNumber,c.type === "ADDED" ? "TO" : "FROM");
                var b = stash.feature.difftree.searchTreeNode({
                    changeType: c.type,
                    lineNumber: c.lineNumber.toString(),
                    padding: X,
                    titleContent: J(c.line.trim(), V)
                });
                Z.children.push({
                    data: {
                        title: b,
                        attr: {
                            "class": "jstree-search-leaf",
                            title: c.line.trim(),
                            href: "#" + a.toString()
                        }
                    },
                    metadata: Q.extend({}, Z.metadata, {
                        path: a
                    })
                })
            })
        });
        function W(X) {
            X.children = X.children.filter(function(Y) {
                if (Y.metadata.isDirectory) {
                    return W(Y)
                } else {
                    return Y.children && Y.children.length > 0
                }
            });
            return X.children.length > 0
        }
        W(S);
        return S
    }
    function I(S) {
        this.input = new L({
            placeholder: "Find text in diff and context lines"
        });
        this.caseSensitive = S;
        this._destroyables = [];
        this._destroyables.push(this.input);
        this._destroyables.push(B.chainWith(this.input.$el.closest("form")).on("submit", G.invoke("preventDefault")));
        this._destroyables.push({
            destroy: D.keyboardEvents("requestDiffTreeSearch").onValue(this.focusSearch.bind(this))
        })
    }
    I.prototype.register = function(V, U) {
        var T = this;
        var S = this.input.getInputs();
        return S.flatMap(function(Z) {
            if (!Z) {
                return H.fromArray([{
                    data: U(),
                    search: Z
                }])
            }
            var X = E('<div class="difftree-search-spinner"></div>').prependTo(T.input.$el);
            var W = T.input.$el.parent().find(".search-icon");
            W.addClass("invisible");
            var Y = O.spinner(X, V(Z)).always(function() {
                W.removeClass("invisible")
            });
            return H.fromPromise(Y, true).takeUntil(S).map(Q.partial(K, E.extend(true, {}, U()), new C(Z,T.caseSensitive))).map(function(a) {
                return {
                    data: a,
                    search: Z
                }
            })
        })
    }
    ;
    I.prototype.focusSearch = function() {
        this.trigger("search-focus");
        this.input.$el.find("input").focus()
    }
    ;
    Q.extend(I.prototype, B.createEventMixin("diffTreeSearch", {
        localOnly: true
    }));
    I.prototype.destroy = function() {
        Q.invoke(this._destroyables, "destroy")
    }
    ;
    R.DiffTreeSearch = I;
    R._filterDiffTree = K;
    R._Text = C;
    R._decorateTitle = J
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:difftree', location = '/static/feature/changeset/difftree/difftree-search.soy' */
// This file was automatically generated from difftree-search.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.difftree.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.difftree == 'undefined') {
    stash.feature.difftree = {};
}

stash.feature.difftree.searchTreeNode = function(opt_data, opt_ignored) {
    var output = '<span class="change-type change-type-' + soy.$$escapeHtml(opt_data.changeType) + '">';
    switch (opt_data.changeType) {
    case 'ADDED':
        output += '+';
        break;
    case 'REMOVED':
        output += '-';
        break;
    default:
        output += ' ';
    }
    output += ' ' + soy.$$escapeHtml(require('util/text')['padLeft'](opt_data.lineNumber, opt_data.padding, ' ')) + '</span> ' + soy.$$filterNoAutoescape(opt_data.titleContent);
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.difftree.searchTreeNode.soyTemplateName = 'stash.feature.difftree.searchTreeNode';
}

stash.feature.difftree.searchWrapper = function(opt_data, opt_ignored) {
    return '<div class="diff-tree-search-wrapper">' + aui.buttons.button({
        type: 'subtle',
        extraClasses: 'search-button-when-collapsed',
        text: '',
        iconType: 'aui',
        iconClass: 'aui-icon-small aui-iconfont-search',
        iconText: "Find text in diff and context lines",
        extraAttributes: {
            title: "Find text in diff and context lines"
        }
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.difftree.searchWrapper.soyTemplateName = 'stash.feature.difftree.searchWrapper';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:difftree', location = '/static/feature/changeset/difftree/difftree-search-input.soy' */
// This file was automatically generated from difftree-search-input.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.difftree.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.difftree == 'undefined') {
    stash.feature.difftree = {};
}

stash.feature.difftree.searchInput = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<form class="aui search">' + aui.icons.icon({
        icon: 'search-small',
        useIconFont: true,
        size: 'small',
        extraClasses: 'search-icon'
    }) + aui.form.input({
        type: 'text',
        id: 'diff-search',
        extraClasses: opt_data.extraClasses,
        extraAttributes: '' + ((opt_data.placeholder) ? ' placeholder="' + soy.$$escapeHtml(opt_data.placeholder) + '"' : '')
    }) + stash.buttons.deleteButton({
        title: "Delete"
    }) + '</form>';
}
;
if (goog.DEBUG) {
    stash.feature.difftree.searchInput.soyTemplateName = 'stash.feature.difftree.searchInput';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-toolbar', location = '/static/feature/file-toolbar/file-toolbar.soy' */
// This file was automatically generated from file-toolbar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.file.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.file == 'undefined') {
    stash.feature.file = {};
}

stash.feature.file.fileToolbar = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="file-toolbar' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '"><div class="secondary">' + ((opt_data.secondaryToolbarContent) ? soy.$$filterNoAutoescape(opt_data.secondaryToolbarContent) : '') + '</div><div class="primary">' + ((opt_data.fileIcon) ? aui.icons.icon({
        icon: 'file',
        size: 'small',
        useIconFont: true,
        iconFontSet: 'devtools'
    }) : '') + ((opt_data.breadcrumbs) ? stash.widget.breadcrumbs.breadcrumbs({
        pathComponents: []
    }) : '') + ((opt_data.primaryToolbarContent) ? soy.$$filterNoAutoescape(opt_data.primaryToolbarContent) : '') + '</div></div>';
}
;
if (goog.DEBUG) {
    stash.feature.file.fileToolbar.soyTemplateName = 'stash.feature.file.fileToolbar';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-change-type-lozenge', location = '/static/feature/file-content/file-change-type-lozenge/file-change-type-lozenge.soy' */
// This file was automatically generated from file-change-type-lozenge.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}

stash.feature.fileContent.fileChangeTypeLozenge = function(opt_data, opt_ignored) {
    var param4 = 'change-type-lozenge change-type-' + soy.$$escapeHtml(opt_data.changeType) + ' ';
    switch (opt_data.changeType) {
    case 'ADD':
        param4 += 'aui-lozenge-success';
        break;
    case 'COPY':
        param4 += 'aui-lozenge-current';
        break;
    case 'DELETE':
        param4 += 'aui-lozenge-error';
        break;
    case 'MOVE':
    case 'RENAME':
        param4 += 'aui-lozenge-moved';
        break;
    default:
        param4 += 'aui-lozenge-complete';
    }
    var param19 = '';
    if (opt_data.previousPathContent) {
        switch (opt_data.changeType) {
        case 'MOVE':
            param19 += soy.$$filterNoAutoescape(AJS.format("{0} \x26rarr;\x3cbr\x3e{1}", opt_data.previousPathContent, opt_data.pathContent));
            break;
        case 'COPY':
            param19 += soy.$$filterNoAutoescape(AJS.format("{0} \x26rarr;\x3cbr\x3e{1}", opt_data.previousPathContent, opt_data.pathContent));
            break;
        case 'RENAME':
            param19 += soy.$$filterNoAutoescape(AJS.format("Renamed from \x27\x27{0}\x27\x27", opt_data.previousPathContent));
            break;
        }
    }
    var param32 = '';
    switch (opt_data.changeType) {
    case 'ADD':
        param32 += soy.$$escapeHtml("Added");
        break;
    case 'COPY':
        param32 += soy.$$escapeHtml("Copied");
        break;
    case 'DELETE':
        param32 += soy.$$escapeHtml("Deleted");
        break;
    case 'MOVE':
        param32 += soy.$$escapeHtml("Moved");
        break;
    case 'RENAME':
        param32 += soy.$$escapeHtml("Renamed");
        break;
    default:
        param32 += soy.$$escapeHtml("Modified");
    }
    var output = '' + stash.widget.lozenge.lozenge({
        htmlElement: 'span',
        extraClasses: param4,
        tooltip: param19,
        text: param32
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.fileChangeTypeLozenge.soyTemplateName = 'stash.feature.fileContent.fileChangeTypeLozenge';
}

stash.feature.fileContent.fileChangeModeLozenge = function(opt_data, opt_ignored) {
    return '' + stash.widget.lozenge.lozenge({
        htmlElement: 'span',
        extraClasses: 'change-mode-lozenge change-mode-' + soy.$$escapeHtml(opt_data.added ? 'added aui-lozenge-success' : 'removed aui-lozenge-error'),
        tooltip: '' + ((opt_data.added) ? soy.$$escapeHtml("This file is now executable") : soy.$$escapeHtml("This file is no longer executable")),
        text: '' + ((opt_data.added) ? soy.$$escapeHtml("+x") : soy.$$escapeHtml("-x"))
    });
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.fileChangeModeLozenge.soyTemplateName = 'stash.feature.fileContent.fileChangeModeLozenge';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-change-types', location = '/static/model/file-change-types.js' */
define("model/file-change-types", function() {
    return {
        ADD: "ADD",
        DELETE: "DELETE",
        MODIFY: "MODIFY",
        COPY: "COPY",
        MOVE: "MOVE",
        RENAME: "RENAME",
        UNKNOWN: "UNKNOWN",
        changeTypeFromId: function(A) {
            if (Object.prototype.hasOwnProperty.call(this, A) && typeof this[A] === "string") {
                return this[A]
            }
            return undefined
        },
        guessChangeTypeFromDiff: function(B) {
            if (B.binary) {
                if (B.source === null) {
                    return this.ADD
                } else {
                    if (B.destination === null) {
                        return this.DELETE
                    } else {
                        return this.MODIFY
                    }
                }
            }
            var A = B.hunks[0];
            if (A) {
                if (A.sourceLine === 0) {
                    return this.ADD
                } else {
                    if (A.destinationLine === 0) {
                        return this.DELETE
                    } else {
                        return this.MODIFY
                    }
                }
            }
            return this.UNKNOWN
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-content-modes', location = '/static/model/file-content-modes.js' */
define("model/file-content-modes", function() {
    return {
        SOURCE: "source",
        DIFF: "diff"
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:breadcrumbs', location = '/static/widget/breadcrumbs/breadcrumbs.js' */
define("widget/breadcrumbs", ["jquery", "lodash", "memoir", "stash/api/util/navbuilder", "util/dom-event", "util/events", "model/page-state"], function(E, I, H, A, C, K, G) {
    function F(L) {
        this.$container = E(L);
        if (H.nativeSupport()) {
            var M = this;
            this.$container.on("click", "a", function(N) {
                if (C.openInSameTab(N)) {
                    K.trigger("stash.widget.breadcrumbs.urlChanged", M, E(this).attr("href"));
                    N.preventDefault()
                }
            })
        }
    }
    var D = A.currentRepo().browse()
      , J = function(L, M) {
        if (!M.isDefault()) {
            return D.path(L).at(M.getId()).build()
        } else {
            return D.path(L).build()
        }
    };
    function B(O, N) {
        var M = []
          , L = I.map(N, function(P) {
            M = M.slice(0);
            M.push(P);
            return {
                text: P,
                url: J(M, O)
            }
        });
        L.unshift({
            text: G.getRepository().getName(),
            url: J([], O)
        });
        return L
    }
    F.prototype.update = function(N, M, L) {
        this.$container.empty().append(stash.widget.breadcrumbs.crumbs({
            pathComponents: B(N, M.getComponents()),
            trailingSlash: L
        }))
    }
    ;
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:breadcrumbs', location = '/static/widget/breadcrumbs/breadcrumbs.soy' */
// This file was automatically generated from breadcrumbs.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.breadcrumbs.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.breadcrumbs == 'undefined') {
    stash.widget.breadcrumbs = {};
}

stash.widget.breadcrumbs.back = function(opt_data, opt_ignored) {
    return '<li><a id="' + soy.$$escapeHtml(opt_data.id) + '" class="breadcrumbs" href="' + soy.$$escapeHtml(opt_data.href) + '">' + aui.icons.icon({
        icon: 'back-page',
        useIconFont: true
    }) + soy.$$escapeHtml(opt_data.text) + '</a></li>' + ((opt_data.crumb) ? '<li>' + soy.$$escapeHtml(opt_data.crumb) + ((opt_data.state) ? stash.widget.lozenge.pullRequestState(opt_data) : '') + '</li>' : '');
}
;
if (goog.DEBUG) {
    stash.widget.breadcrumbs.back.soyTemplateName = 'stash.widget.breadcrumbs.back';
}

stash.widget.breadcrumbs.crumbs = function(opt_data, opt_ignored) {
    var output = '';
    var pathComponentList23 = opt_data.pathComponents;
    var pathComponentListLen23 = pathComponentList23.length;
    for (var pathComponentIndex23 = 0; pathComponentIndex23 < pathComponentListLen23; pathComponentIndex23++) {
        var pathComponentData23 = pathComponentList23[pathComponentIndex23];
        output += stash.widget.breadcrumbs.breadcrumbFragment({
            isLast: pathComponentIndex23 == pathComponentListLen23 - 1,
            url: pathComponentIndex23 == pathComponentListLen23 - 1 ? opt_data.primaryLink : pathComponentData23.url,
            text: pathComponentData23.text
        }) + ((!(pathComponentIndex23 == pathComponentListLen23 - 1) || opt_data.trailingSlash) ? stash.widget.breadcrumbs.sep(null) : '');
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.breadcrumbs.crumbs.soyTemplateName = 'stash.widget.breadcrumbs.crumbs';
}

stash.widget.breadcrumbs.breadcrumbs = function(opt_data, opt_ignored) {
    return '<div class="breadcrumbs">' + stash.widget.breadcrumbs.crumbs(opt_data) + '</div>';
}
;
if (goog.DEBUG) {
    stash.widget.breadcrumbs.breadcrumbs.soyTemplateName = 'stash.widget.breadcrumbs.breadcrumbs';
}

stash.widget.breadcrumbs.breadcrumbFragment = function(opt_data, opt_ignored) {
    return '' + ((opt_data.url) ? '<a' + ((opt_data.isLast) ? ' class="stub"' : '') + ' href="' + soy.$$escapeHtml(opt_data.url) + '">' + soy.$$escapeHtml(opt_data.text) + '</a>' : '<span' + ((opt_data.isLast) ? ' class="stub"' : '') + '>' + soy.$$escapeHtml(opt_data.text) + '</span>');
}
;
if (goog.DEBUG) {
    stash.widget.breadcrumbs.breadcrumbFragment.soyTemplateName = 'stash.widget.breadcrumbs.breadcrumbFragment';
}

stash.widget.breadcrumbs.sep = function(opt_data, opt_ignored) {
    return '<span class="sep">/</span>';
}
;
if (goog.DEBUG) {
    stash.widget.breadcrumbs.sep.soyTemplateName = 'stash.widget.breadcrumbs.sep';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:web-fragment-templates', location = '/static/widget/web-fragment.soy' */
// This file was automatically generated from web-fragment.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.webItem = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<' + soy.$$escapeHtml(opt_data.url || opt_data.forceLink ? 'a' : 'span') + ((opt_data.url) ? ' href="' + soy.$$escapeHtml(opt_data.url) + '"' : '') + ((opt_data.linkId) ? ' id="' + soy.$$escapeHtml(opt_data.linkId) + '"' : '') + ((opt_data.styleClass) ? ' class="' + soy.$$escapeHtml(opt_data.styleClass) + '"' : '') + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + ((opt_data.pluginKey && opt_data.moduleKey) ? ' data-web-item-key="' + soy.$$escapeHtml(opt_data.pluginKey) + ':' + soy.$$escapeHtml(opt_data.moduleKey) + '"' : '') + '>' + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : (opt_data.params && opt_data.params['stashIconClass']) ? '<span class="aui-icon ' + soy.$$escapeHtml(opt_data.params['stashIconClass']) + '">' + soy.$$escapeHtml(opt_data.linkText) + '</span>' : soy.$$escapeHtml(opt_data.linkText)) + '</' + soy.$$escapeHtml(opt_data.url || opt_data.forceLink ? 'a' : 'span') + '>';
}
;
if (goog.DEBUG) {
    stash.widget.webItem.soyTemplateName = 'stash.widget.webItem';
}

stash.widget.webItemButton = function(opt_data, opt_ignored) {
    return '' + stash.buttons.button({
        buttonText: opt_data.linkText ? opt_data.linkText : '',
        id: opt_data.linkId,
        title: opt_data.tooltip,
        extraClasses: opt_data.styleClass && opt_data.extraClasses ? opt_data.styleClass + ' ' + opt_data.extraClasses : opt_data.styleClass ? opt_data.styleClass : opt_data.extraClasses,
        href: opt_data.url,
        iconType: opt_data.params['stashIconClass'] ? 'custom' : '',
        iconClass: opt_data.params['stashIconClass'],
        iconText: !opt_data.linkText ? opt_data.tooltip : ''
    });
}
;
if (goog.DEBUG) {
    stash.widget.webItemButton.soyTemplateName = 'stash.widget.webItemButton';
}

stash.widget.webItemtabMenuItem = function(opt_data, opt_ignored) {
    return '' + widget.aui.tabMenuItem({
        id: opt_data.linkId,
        tooltip: opt_data.tooltip,
        text: opt_data.linkText,
        url: opt_data.url,
        extraClasses: opt_data.styleClass,
        isActive: opt_data.isActive
    });
}
;
if (goog.DEBUG) {
    stash.widget.webItemtabMenuItem.soyTemplateName = 'stash.widget.webItemtabMenuItem';
}

stash.widget.webItemDropdownItem = function(opt_data, opt_ignored) {
    return '' + stash.widget.webItem(soy.$$augmentMap(opt_data, {
        forceLink: true
    }));
}
;
if (goog.DEBUG) {
    stash.widget.webItemDropdownItem.soyTemplateName = 'stash.widget.webItemDropdownItem';
}

stash.widget.headerDropdownWebItems = function(opt_data, opt_ignored) {
    return '<li class="' + ((opt_data.isActive) ? 'selected' : '') + ((opt_data.styleClass) ? ' ' + soy.$$escapeHtml(opt_data.styleClass) : '') + '"' + ((opt_data.tooltip) ? 'title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + ((opt_data.dropdownWebSections.length > 0) ? aui.dropdown2.trigger({
        menu: {
            id: opt_data.pluginKey + '-' + opt_data.moduleKey
        },
        id: opt_data.linkId ? opt_data.linkId : '',
        text: opt_data.params['stashIconClass'] ? null : opt_data.linkText,
        content: '' + ((opt_data.iconUrl) ? '<img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" class="aui-icon"' + ((opt_data.iconWidth) ? ' width="' + soy.$$escapeHtml(opt_data.iconWidth) + '"' : '') + ((opt_data.iconHeight) ? ' height="' + soy.$$escapeHtml(opt_data.iconHeight) + '"' : '') + '/>' : '') + ((opt_data.params['stashIconClass']) ? '<span class="aui-icon ' + soy.$$escapeHtml(opt_data.params['stashIconClass']) + '">' + soy.$$escapeHtml(opt_data.linkText) + '</span>' : '')
    }) + aui.dropdown2.contents({
        id: opt_data.pluginKey + '-' + opt_data.moduleKey,
        extraClasses: 'aui-style-default',
        content: '' + stash.widget.headerDropdownWebSections({
            dropdownWebSections: opt_data.dropdownWebSections,
            locationPrefix: opt_data.moduleKey + '/'
        })
    }) : stash.widget.webItem(opt_data)) + '</li>';
}
;
if (goog.DEBUG) {
    stash.widget.headerDropdownWebItems.soyTemplateName = 'stash.widget.headerDropdownWebItems';
}

stash.widget.headerDropdownWebSections = function(opt_data, opt_ignored) {
    var output = '';
    var dropdownWebSectionList126 = opt_data.dropdownWebSections;
    var dropdownWebSectionListLen126 = dropdownWebSectionList126.length;
    for (var dropdownWebSectionIndex126 = 0; dropdownWebSectionIndex126 < dropdownWebSectionListLen126; dropdownWebSectionIndex126++) {
        var dropdownWebSectionData126 = dropdownWebSectionList126[dropdownWebSectionIndex126];
        var param129 = '<ul class="aui-list-truncate" role="presentation">';
        var sectionItemList131 = WebFragments.getWebItems((opt_data.locationPrefix ? opt_data.locationPrefix : '') + dropdownWebSectionData126.key, opt_data.context ? opt_data.context : {});
        var sectionItemListLen131 = sectionItemList131.length;
        for (var sectionItemIndex131 = 0; sectionItemIndex131 < sectionItemListLen131; sectionItemIndex131++) {
            var sectionItemData131 = sectionItemList131[sectionItemIndex131];
            param129 += '<li role="presentation">' + stash.widget.webItem(sectionItemData131) + '</li>';
        }
        param129 += '</ul>';
        output += aui.dropdown2.section({
            extraClasses: dropdownWebSectionData126.key,
            label: dropdownWebSectionData126.labelText,
            content: param129
        });
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.headerDropdownWebSections.soyTemplateName = 'stash.widget.headerDropdownWebSections';
}

stash.widget.webFragmentButtons = function(opt_data, opt_ignored) {
    var output = '';
    var webFragmentList140 = opt_data.isReverse ? WebFragments.getWebFragments(opt_data.location, opt_data.context).reverse() : WebFragments.getWebFragments(opt_data.location, opt_data.context);
    var webFragmentListLen140 = webFragmentList140.length;
    for (var webFragmentIndex140 = 0; webFragmentIndex140 < webFragmentListLen140; webFragmentIndex140++) {
        var webFragmentData140 = webFragmentList140[webFragmentIndex140];
        switch (webFragmentData140.type) {
        case 'ITEM':
            output += stash.buttons.buttons({
                content: '' + stash.widget.webItemButton(webFragmentData140)
            });
            break;
        case 'SECTION':
            var param148 = '';
            var webItemList149 = opt_data.isReverse ? WebFragments.getWebItems(opt_data.location + '/' + webFragmentData140.key, opt_data.context).reverse() : WebFragments.getWebItems(opt_data.location + '/' + webFragmentData140.key, opt_data.context);
            var webItemListLen149 = webItemList149.length;
            for (var webItemIndex149 = 0; webItemIndex149 < webItemListLen149; webItemIndex149++) {
                var webItemData149 = webItemList149[webItemIndex149];
                param148 += stash.widget.webItemButton(webItemData149);
            }
            output += stash.buttons.buttons({
                extraClasses: webFragmentData140.styleClass,
                content: param148
            });
            break;
        }
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.webFragmentButtons.soyTemplateName = 'stash.widget.webFragmentButtons';
}

stash.widget.webItemTabs = function(opt_data, opt_ignored) {
    var param155 = '' + ((opt_data.tabItemsContent) ? soy.$$filterNoAutoescape(opt_data.tabItemsContent) : '');
    var itemList160 = opt_data.webItems ? opt_data.webItems : WebFragments.getWebItems(opt_data.location, opt_data.context ? opt_data.context : null);
    var itemListLen160 = itemList160.length;
    for (var itemIndex160 = 0; itemIndex160 < itemListLen160; itemIndex160++) {
        var itemData160 = itemList160[itemIndex160];
        var param168 = '';
        var subPanelList169 = WebFragments.getWebPanels(itemData160.moduleKey + '.meta', opt_data.context ? opt_data.context : null).map(function(webPanel) {
            return soydata.VERY_UNSAFE.ordainSanitizedHtml(webPanel);
        });
        var subPanelListLen169 = subPanelList169.length;
        for (var subPanelIndex169 = 0; subPanelIndex169 < subPanelListLen169; subPanelIndex169++) {
            var subPanelData169 = subPanelList169[subPanelIndex169];
            param168 += soy.$$escapeHtml(subPanelData169);
        }
        param155 += widget.aui.tabMenuItem({
            url: itemData160.url,
            text: itemData160.linkText,
            id: itemData160.linkId,
            extraLinkClasses: itemData160.styleClass,
            tooltip: itemData160.tooltip,
            isActive: opt_data.showFirstTab ? itemIndex160 == 0 : opt_data.activeTab ? itemData160.moduleKey == opt_data.activeTab : false,
            extraAttributes: {
                'data-module-key': itemData160.moduleKey
            },
            extraLinkContent: param168
        });
    }
    var output = '' + widget.aui.tabChrome(soy.$$augmentMap(opt_data, {
        tabItemsContent: param155
    }));
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.webItemTabs.soyTemplateName = 'stash.widget.webItemTabs';
}

stash.widget.sidebarWebFragmentNavigation = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.primaryNavContent || opt_data.secondaryNavContent || opt_data.webFragments.length > 0) {
        var param182 = '<ul class="aui-nav">' + ((opt_data.primaryNavContent) ? soy.$$filterNoAutoescape(opt_data.primaryNavContent) : '');
        var fragmentList188 = opt_data.webFragments;
        var fragmentListLen188 = fragmentList188.length;
        for (var fragmentIndex188 = 0; fragmentIndex188 < fragmentListLen188; fragmentIndex188++) {
            var fragmentData188 = fragmentList188[fragmentIndex188];
            param182 += (fragmentData188.type == 'ITEM') ? stash.widget.sidebarNavItemWebItem({
                context: opt_data.context,
                isActive: fragmentData188.moduleKey == opt_data.activeNavItem,
                isTierOne: opt_data.isTierOne,
                webItem: fragmentData188
            }) : (fragmentData188.type == 'SECTION') ? stash.widget.sidebarNavWebSection({
                activeNavItem: opt_data.activeNavItem,
                context: opt_data.context,
                fragment: fragmentData188,
                isTierOne: opt_data.isTierOne
            }) : '';
        }
        param182 += '</ul>';
        output += widget.aui.sidebarNavGroup({
            extraClasses: opt_data.extraClasses,
            isTierOne: opt_data.isTierOne,
            isActions: opt_data.isActions,
            title: opt_data.title,
            navContent: param182,
            secondaryNavContent: '' + ((opt_data.secondaryNavContent) ? '<ul class="aui-nav">' + soy.$$filterNoAutoescape(opt_data.secondaryNavContent) + '</ul>' : '')
        });
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.sidebarWebFragmentNavigation.soyTemplateName = 'stash.widget.sidebarWebFragmentNavigation';
}

stash.widget.sidebarNavWebSection = function(opt_data, opt_ignored) {
    return '' + stash.widget.sidebarNavSectionWithItems({
        activeNavItem: opt_data.activeNavItem,
        context: opt_data.context,
        heading: opt_data.fragment.labelText,
        isTierOne: opt_data.isTierOne,
        webItems: WebFragments.getWebItems(opt_data.fragment.location + '/' + opt_data.fragment.key, opt_data.context ? opt_data.context : null)
    });
}
;
if (goog.DEBUG) {
    stash.widget.sidebarNavWebSection.soyTemplateName = 'stash.widget.sidebarNavWebSection';
}

stash.widget.sidebarNavSectionWithItems = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.webItems.length) {
        output += widget.aui.navHeading({
            text: opt_data.heading
        }) + '<ul class="aui-nav">';
        var webItemList225 = opt_data.webItems;
        var webItemListLen225 = webItemList225.length;
        for (var webItemIndex225 = 0; webItemIndex225 < webItemListLen225; webItemIndex225++) {
            var webItemData225 = webItemList225[webItemIndex225];
            output += stash.widget.sidebarNavItemWebItem({
                context: opt_data.context,
                isActive: webItemData225.moduleKey == opt_data.activeNavItem || webItemData225.linkId == opt_data.activeNavItem,
                isTierOne: opt_data.isTierOne,
                webItem: webItemData225
            });
        }
        output += '</ul>';
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.sidebarNavSectionWithItems.soyTemplateName = 'stash.widget.sidebarNavSectionWithItems';
}

stash.widget.sidebarNavItemWebItem = function(opt_data, opt_ignored) {
    var param243 = '';
    if (opt_data.webItem.moduleKey) {
        var badgeContentList246 = WebFragments.getWebPanels(opt_data.webItem.moduleKey + '.badge', opt_data.context ? opt_data.context : null).map(function(webPanel) {
            return soydata.VERY_UNSAFE.ordainSanitizedHtml(webPanel);
        });
        var badgeContentListLen246 = badgeContentList246.length;
        for (var badgeContentIndex246 = 0; badgeContentIndex246 < badgeContentListLen246; badgeContentIndex246++) {
            var badgeContentData246 = badgeContentList246[badgeContentIndex246];
            param243 += ' ' + soy.$$escapeHtml(badgeContentData246);
        }
    }
    var output = '' + widget.aui.sidebarNavItem({
        extraClasses: opt_data.webItem.styleClass,
        iconClass: opt_data.webItem.params['stashIconClass'],
        id: opt_data.webItem.linkId,
        webItemKey: opt_data.webItem.pluginKey + ':' + opt_data.webItem.moduleKey,
        isActive: opt_data.isActive,
        isTierOne: opt_data.isTierOne,
        text: opt_data.webItem.linkText,
        tooltip: opt_data.webItem.tooltip,
        url: opt_data.webItem.url,
        badgeContent: param243
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.sidebarNavItemWebItem.soyTemplateName = 'stash.widget.sidebarNavItemWebItem';
}
;;/* module-key = 'com.atlassian.plugins.atlassian-chaperone:internals', location = '/internals/syncing.js' */
var Chaperone = {
    _internal: {}
};
Chaperone._internal.syncing = (function() {
    function a(c, d) {
        return (d || AJS.$).ajax({
            url: AJS.contextPath() + "/rest/chaperone/1/chaperone/" + c
        })
    }
    function b(c, e, d) {
        return (d || AJS.$).ajax({
            url: AJS.contextPath() + "/rest/chaperone/1/chaperone/" + c,
            type: "POST",
            data: {
                json: e
            }
        })
    }
    return {
        syncToServer: b,
        syncFromServer: a
    }
})();
;;/* module-key = 'com.atlassian.plugins.atlassian-chaperone:feature-discovery', location = '/feature-discovery/feature-discovery.js' */
(function(i, g, k, e, f) {
    var j = e.syncFromServer;
    var h = e.syncToServer;
    var c = g.Callbacks();
    g(document).on("ajaxStop", function() {
        c.fire()
    });
    var b = g.Callbacks();
    g(window).on("resize", function() {
        b.fire()
    });
    function a(l) {
        var m = g.Deferred();
        function n() {
            var o = g(l);
            if (o.length) {
                m.resolve(o);
                c.remove(n)
            }
        }
        c.add(n);
        n();
        return m
    }
    function d(p, r, m, o) {
        var l = g.Callbacks();
        var n = g.Callbacks();
        var s = g.Callbacks();
        function q(u) {
            var w;
            function t(y) {
                return function() {
                    g(document).off("hideLayer", v);
                    u.off(".chaperone");
                    w.remove();
                    b.remove(w.refresh);
                    c.remove(x);
                    if (y) {
                        y.fire()
                    }
                }
            }
            function x() {
                if (!u.is(":visible")) {
                    t()()
                }
            }
            var v = t(l);
            w = new i.InlineDialog(u,"feature-discovery-" + p,function(A, y, D) {
                A.html(chaperone.featureDiscovery.content({
                    step: r,
                    paging: m
                }));
                var C = A.find(".feature-discovery-action");
                var z = A.find(".feature-discovery-next");
                var B = A.find(".feature-discovery-close");
                if (r.action && r.action.click) {
                    C.click(r.action.click)
                }
                u.on("click.chaperone", t(s));
                z.click(t(n));
                B.click(v);
                C.click(t(s));
                D();
                if (!o.modal) {
                    k.delay(function() {
                        g(document).on("showLayer", v)
                    }, 100)
                }
            }
            ,{
                closeOthers: false,
                hideDelay: null,
                noBind: true,
                gravity: r.gravity || (r.dir || "s").replace(/[nswe]/g, function(y) {
                    return {
                        n: "s",
                        s: "n",
                        e: "w",
                        w: "e"
                    }[y]
                }),
                offsetX: r.offsetX,
                offsetY: r.offsetY,
                persistent: true,
                width: r.width || 300,
                addActiveClass: false
            });
            b.add(w.refresh);
            c.add(x);
            w.show()
        }
        return {
            showWhenTargetVisible: function() {
                return a(r.selector).then(q)
            },
            on: function(t, u) {
                switch (t) {
                case "close":
                    l.add(u);
                    break;
                case "next":
                    n.add(u);
                    break;
                case "action":
                    s.add(u);
                    break
                }
            }
        }
    }
    f.registerFeature = function(n, l, m) {
        m = m || {};
        var p = j(n).pipe(function(q) {
            q = q || {};
            if (q.isAllDismissed) {
                return g.Deferred().reject()
            }
            return q
        });
        function o(t, r, q) {
            var s = r.stepInfoById[t.id || t.selector];
            switch (m.dismissalMode) {
            case "progressive":
                s.isDismissed = true;
                h(n, JSON.stringify(r));
                break;
            default:
                if (q && !r.isAllDismissed) {
                    r.isAllDismissed = true;
                    h(n, JSON.stringify(r))
                }
                break
            }
        }
        k.reduce(l, function(r, q) {
            return r.then(function(x) {
                var D = x.stepInfoById = x.stepInfoById || {};
                var w = q.id || q.selector;
                var s = D[w] = D[w] || {};
                if (s.isDismissed) {
                    return r
                }
                var B = l.length;
                var v = k.indexOf(l, q);
                var t = v < B - 1;
                var y = new d(n,q,{
                    numSteps: B,
                    stepIndex: v,
                    hasNext: t
                },m);
                var C = g.Deferred();
                y.on("close", C.reject);
                y.on("next", k.bind(C.resolve, C, x));
                y.on("action", k.bind(C.resolve, C, x));
                var z = y.showWhenTargetVisible();
                var A = k.bind(o, null, q, x, !t);
                var u = k.bind(o, null, q, x, "all");
                if (q.once) {
                    z.then(A)
                } else {
                    y.on("close", u);
                    y.on("next", A);
                    y.on("action", A)
                }
                return C
            })
        }, p)
    }
    ;
    f.checkFeatureVisibility = function() {
        c.fire()
    }
    ;
    f.checkFeatureAlignment = function() {
        b.fire()
    }
})(AJS, AJS.$, _, Chaperone._internal.syncing, Chaperone);
;;/* module-key = 'com.atlassian.plugins.atlassian-chaperone:feature-discovery', location = '/feature-discovery/feature-discovery.soy' */
// This file was automatically generated from feature-discovery.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace chaperone.featureDiscovery.
 */

if (typeof chaperone == 'undefined') {
    var chaperone = {};
}
if (typeof chaperone.featureDiscovery == 'undefined') {
    chaperone.featureDiscovery = {};
}

chaperone.featureDiscovery.content = function(opt_data, opt_ignored) {
    return '' + ((opt_data.step.title) ? '<h2>' + soy.$$escapeHtml(opt_data.step.title) + '</h2>' : '') + ((opt_data.step.content) ? soy.$$filterNoAutoescape(opt_data.step.content) : '') + aui.form.form({
        action: '',
        content: '' + ((opt_data.step.action && opt_data.step.action.text) ? aui.buttons.button(soy.$$augmentMap(opt_data.step.action, {
            extraClasses: aui.renderExtraClasses(opt_data.step.action) + ' feature-discovery-action',
            extraAttributes: aui.renderExtraAttributes(opt_data.step.action) + ' type="button"'
        })) : '') + ((opt_data.paging && opt_data.paging.hasNext) ? aui.buttons.button({
            text: "Next",
            type: opt_data.step.action && opt_data.step.action.text ? 'link' : null,
            extraClasses: 'feature-discovery-next',
            extraAttributes: {
                type: 'button'
            }
        }) : '') + aui.buttons.button({
            text: "Close",
            type: opt_data.step.action && opt_data.step.action.text || opt_data.paging && opt_data.paging.hasNext ? 'link' : null,
            extraClasses: 'feature-discovery-close',
            extraAttributes: {
                type: 'button'
            }
        }) + ((opt_data.step.moreInfo) ? aui.buttons.button(soy.$$augmentMap(opt_data.step.moreInfo, {
            text: opt_data.step.moreInfo.text ? opt_data.step.moreInfo.text : "Learn more",
            type: 'link'
        })) : '') + ((opt_data.paging && opt_data.paging.numSteps > 1) ? '<span class="multi-step-trigger">' + soy.$$escapeHtml(AJS.format("{0}/{1}", opt_data.paging.stepIndex + 1, opt_data.paging.numSteps)) + '</span>' : '')
    });
}
;
if (goog.DEBUG) {
    chaperone.featureDiscovery.content.soyTemplateName = 'chaperone.featureDiscovery.content';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:chaperone-feature-discovery', location = '/static/lib/chaperone-AMD.js' */
define("chaperone", function() {
    return Chaperone
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-options', location = '/static/feature/file-content/diff-view-options.js' */
define("feature/file-content/diff-view-options", ["jquery", "lodash", "util/client-storage", "util/events"], function(E, B, A, D) {
    var F = B.once(function() {
        return A.buildKey(["diff-view", "options"], "user")
    });
    function C() {}
    D.addLocalEventMixin(C.prototype);
    C.prototype.getOptions = B.memoize(function() {
        return B.extend({}, this.defaults, A.getItem(F()))
    });
    C.prototype.defaults = {
        ignoreWhitespace: false,
        hideComments: false,
        hideEdiff: false,
        diffType: "unified"
    };
    C.prototype.triggerUpdate = function(G, I) {
        var H = {
            key: G,
            value: I
        };
        this.trigger("change", H);
        D.trigger("stash.feature.fileContent.optionsChanged", null, H)
    }
    ;
    C.prototype.set = function(G, H, I) {
        this.getOptions()[G] = H;
        A.setItem(F(), this.getOptions());
        if (I !== false) {
            this.triggerUpdate(G, H)
        }
    }
    ;
    C.prototype.get = function(G) {
        return this.getOptions()[G]
    }
    ;
    C.prototype.proxy = function(I) {
        var H = this;
        var G = new C();
        G.getOptions = function() {
            return E.extend({}, H.getOptions(), I)
        }
        ;
        G.set = function(J, K, L) {
            if (I[J] === undefined) {
                H.set(J, K, L)
            }
        }
        ;
        G.destroy = D.chainWith(H).on("change", function(J) {
            if (I[J.key] === undefined) {
                G.trigger("change", J)
            }
        }).destroy;
        return G
    }
    ;
    return new C()
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-options-panel', location = '/static/feature/file-content/diff-view-options-panel/diff-view-options-panel.js' */
(function() {
    var A = require("util/bacon").keyboardEvents("requestIgnoreWhitespace");
    var B = require("util/bacon").keyboardEvents("requestHideComments");
    var D = require("util/bacon").keyboardEvents("requestHideEdiff");
    var C = require("util/bacon").keyboardEvents("changeDiffTypeRequested");
    define("feature/file-content/diff-view-options-panel", ["aui", "chaperone", "jquery", "lodash", "util/events", "util/function"], function(E, J, K, F, G, I) {
        var H = "#diff-options-dropdown-trigger";
        J.registerFeature("side-by-side-diff-discovery", [{
            id: "side-by-side-diff-discovery",
            selector: H,
            title: "Side-by-side diff",
            content: E.escapeHtml("Stash has a new way to view diffs. Use this menu to try it."),
            once: true
        }]);
        return function(O, P) {
            var U = "#diff-options-dropdown";
            var M = "#diff-options-core .aui-dropdown2-checkbox, #diff-options-core .aui-dropdown2-radio";
            var T = [];
            function R(Z) {
                L();
                var X = K(this);
                var W = X.attr("data-key");
                var a = X.attr("data-value");
                var Y = (Z.type === "aui-dropdown2-item-check");
                if (!Y && X.hasClass("aui-dropdown2-radio")) {
                    return
                }
                P.set(W, a || Y)
            }
            function N(W) {
                K(this).find(M).each(function() {
                    var Y = K(this);
                    var X = Y.attr("data-key");
                    var a = Y.attr("data-value");
                    var Z = P.get(X);
                    var b = (Z && (Z === a || Z === true));
                    Y.toggleClass("aui-dropdown2-checked", b).attr("aria-checked", b)
                });
                T.push(G.chain().on("window.scroll.throttled", L).destroy)
            }
            function Q(W) {
                G.off("window.scroll.throttled", L)
            }
            function L(W) {
                if (O.find(U).attr("aria-hidden") === "false") {
                    O.find(H).trigger("aui-button-invoke")
                }
            }
            function V(W) {
                L();
                P.set(W, !P.get(W))
            }
            function S() {
                L();
                P.set("diffType", P.get("diffType") === "unified" ? "side-by-side" : "unified")
            }
            T.push(A.onValue(V.bind(null, "ignoreWhitespace")));
            T.push(B.onValue(V.bind(null, "hideComments")));
            T.push(D.onValue(V.bind(null, "hideEdiff")));
            T.push(C.onValue(S));
            T.push(G.chainWith(O).on("aui-dropdown2-item-check aui-dropdown2-item-uncheck", M, R).on("aui-dropdown2-show", U, N).on("aui-dropdown2-hide", U, Q).destroy);
            return {
                destroy: F.partial(I.applyAll, T)
            }
        }
    })
})();
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-options-panel', location = '/static/feature/file-content/diff-view-options-panel/diff-view-options-panel.soy' */
// This file was automatically generated from diff-view-options-panel.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.diffViewOptionsPanel.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.diffViewOptionsPanel == 'undefined') {
    stash.feature.fileContent.diffViewOptionsPanel = {};
}

stash.feature.fileContent.diffViewOptionsPanel.main = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    var output = stash.buttons.button({
        id: 'diff-options-dropdown-trigger',
        buttonText: '',
        extraClasses: 'aui-dropdown2-trigger aui-button-subtle aui-dropdown2-trigger-arrowless',
        extraAttributes: 'data-container=".diff-view-secondary-panel" aria-owns="diff-options-dropdown" aria-haspopup="true"',
        iconType: 'aui',
        iconText: "Diff options",
        iconClass: 'aui-icon-small aui-iconfont-more'
    }) + '<div id="diff-options-dropdown-container">';
    var param14 = '<div id="diff-options-core">' + aui.dropdown2.section({
        extraClasses: 'binary-options',
        extraAttributes: {
            role: 'presentation'
        },
        content: '<div role="group"><ul class="aui-list-truncate" role="presentation"><li role="presentation">' + aui.dropdown2.menuCheckbox({
            text: "Ignore whitespace",
            extraAttributes: {
                'data-key': 'ignoreWhitespace',
                title: "Ignore whitespace for all diffs. (Type \x27Shift + w\x27)"
            },
            extraClasses: 'diff-options-ignore-whitespace'
        }) + '</li>' + ((!!(require('model/page-state').getCurrentUser()) && opt_data.commentMode != 'none') ? '<li role="presentation">' + aui.dropdown2.menuCheckbox({
            text: "Hide comments",
            extraAttributes: {
                'data-key': 'hideComments',
                title: "Hide comments for all diffs. (Type \x27Shift + c\x27)"
            },
            extraClasses: 'diff-options-hide-comments'
        }) + '</li>' : '') + '<li role="presentation">' + aui.dropdown2.menuCheckbox({
            text: "Hide e-diff",
            extraAttributes: {
                'data-key': 'hideEdiff',
                title: "Hide e-diff for all diffs. (Type \x27Shift + e\x27)"
            },
            extraClasses: 'diff-options-hide-ediff'
        }) + '</li></ul></div>'
    }) + aui.dropdown2.itemGroup({
        extraClasses: 'diff-type-options',
        isTruncated: true,
        items: [{
            itemType: 'radio',
            isChecked: true,
            text: "Unified diff",
            extraAttributes: {
                'data-key': 'diffType',
                'data-value': 'unified',
                title: "Show diffs in one continuous column. (Type \x27Shift + d\x27)"
            }
        }, {
            itemType: 'radio',
            isDisabled: true,
            text: "Side-by-side diff",
            extraAttributes: {
                'data-key': 'diffType',
                'data-value': 'side-by-side',
                'data-file-type-compatibility': "Side-by-side diff is not available for added or deleted files",
                title: "Show diffs split into two columns. (Type \x27Shift + d\x27)"
            }
        }]
    }) + '</div>';
    var param46 = '';
    var webItemsDiffViewOptions__soy47 = WebFragments.getWebItems('stash.file-content.diff-view.options', {
        displayType: opt_data.displayType,
        fileChange: opt_data.fileChange
    });
    if (webItemsDiffViewOptions__soy47.length > 0) {
        param46 += '<ul>';
        var itemList51 = webItemsDiffViewOptions__soy47;
        var itemListLen51 = itemList51.length;
        for (var itemIndex51 = 0; itemIndex51 < itemListLen51; itemIndex51++) {
            var itemData51 = itemList51[itemIndex51];
            param46 += '<li>' + stash.widget.webItemDropdownItem(itemData51) + '</li>';
        }
        param46 += '</ul>';
    }
    param14 += aui.dropdown2.section({
        id: 'diff-options-pluggable',
        content: param46
    });
    output += aui.dropdown2.contents({
        id: 'diff-options-dropdown',
        extraClasses: 'aui-style-default diff-options-dropdown',
        content: param14
    });
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffViewOptionsPanel.main.soyTemplateName = 'stash.feature.fileContent.diffViewOptionsPanel.main';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:require-amd-context', location = '/static/util/require-amd-context.js' */
define("util/require-amd-context", ["jquery"], function(A) {
    return function B(D, C) {
        return WRM.require("wrc!" + D).pipe(function() {
            var E = A.Deferred();
            require(C, function() {
                E.resolve.apply(E, arguments)
            });
            return E.promise()
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:binary-view', location = '/static/feature/file-content/binary-view/binary-view.soy' */
// This file was automatically generated from binary-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.binaryView.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.binaryView == 'undefined') {
    stash.feature.fileContent.binaryView = {};
}

stash.feature.fileContent.binaryView.container = function(opt_data, opt_ignored) {
    return '<div class="binary-container"></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.binaryView.container.soyTemplateName = 'stash.feature.fileContent.binaryView.container';
}

stash.feature.fileContent.binaryView.cell = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="' + soy.$$escapeHtml(opt_data.extraClasses ? opt_data.extraClasses + ' ' : '') + 'binary">' + ((opt_data.titleText) ? '<h5>' + soy.$$escapeHtml(opt_data.titleText) + '</h5>' : '') + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.binaryView.cell.soyTemplateName = 'stash.feature.fileContent.binaryView.cell';
}

stash.feature.fileContent.binaryView.unrenderable = function(opt_data, opt_ignored) {
    return '<p><b>' + soy.$$escapeHtml("This file cannot be rendered in your browser.") + '</b><br/><a href="' + soy.$$escapeHtml(opt_data.rawUrl) + '">' + soy.$$escapeHtml("Download this file") + '</a></p>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.binaryView.unrenderable.soyTemplateName = 'stash.feature.fileContent.binaryView.unrenderable';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:binary-view', location = '/static/feature/file-content/binary-view/binary-view.js' */
define("feature/file-content/binary-view", ["jquery", "lodash", "stash/api/util/navbuilder", "util/deprecation", "util/events", "exports"], function(G, L, B, I, O, F) {
    function D(Q, P) {
        return B.currentRepo().browse().path(Q.components).at(P).raw().build()
    }
    function C(P) {
        return {
            $elem: G(stash.feature.fileContent.binaryView.unrenderable({
                rawUrl: P
            })),
            type: "link"
        }
    }
    function K(Q) {
        var P = G("<img />");
        P.attr("src", Q);
        return {
            $elem: P,
            type: "image"
        }
    }
    var J = {
        png: K,
        jpg: K,
        jpeg: K,
        bmp: K,
        ico: K,
        gif: K,
        svg: K
    };
    function E(S, Q) {
        var T = S.extension && S.extension.toLowerCase();
        var P = D(S, Q)
          , R = J[T] || C;
        return R(P)
    }
    function H(T, S, Q) {
        var R = Q.getUntilRevision();
        var P = E(S, R && R.getId());
        T.empty().addClass("binary").append(P.$elem);
        I.triggerDeprecated("stash.feature.sourceview.onBinary", null, {
            path: S,
            type: P.type,
            revision: R
        }, "stash.feature.fileContent.binaryShown", "3.3", "4.0");
        O.trigger("stash.feature.fileContent.binaryShown", null, {
            containerEl: T.get(0),
            path: S,
            type: P.type,
            commit: R.toJSON()
        });
        return T
    }
    var A = ["svg"];
    function N(P) {
        var Q = P.destination && P.destination.extension;
        return !!(P && (P.binary || M(Q)))
    }
    function M(P) {
        return P && (L.indexOf(A, P) >= 0)
    }
    F.renderBinaryFile = I.fn(H, null, "3.3", "4.0");
    F.shouldRenderBinary = I.fn(N, null, "3.3", "4.0");
    F.getRenderedBinary = E;
    F.treatTextAsBinary = M
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:content-message', location = '/static/feature/file-content/content-message/content-message.js' */
define("feature/file-content/content-message", ["aui", "lodash", "util/deprecation", "util/events", "exports"], function(G, I, E, J, C) {
    function A(L, K) {
        L.append(stash.feature.fileContent.contentMessage.conflict({
            titleContent: G.escapeHtml(K.getConflict().getConflictMessage()),
            nodeType: K.getNodeType()
        }))
    }
    function D(O, N, K) {
        O.append(stash.feature.fileContent.contentMessage.emptyDiff({
            fileChangeType: K.getType()
        }));
        var L = K.getCommitRange().getSinceRevision();
        var M = K.getCommitRange().getUntilRevision();
        J.trigger("stash.feature.fileContent.emptyDiffShown", {
            containerEl: O.get(0),
            sourcePath: N.source,
            sinceRevision: L && L.toJSON(),
            destinationPath: N.destination,
            untilRevision: M && M.toJSON()
        })
    }
    function H(N, M, K) {
        N.append(stash.feature.fileContent.contentMessage.emptyFile());
        var L = K.commitRange.untilRevision;
        E.triggerDeprecated("stash.feature.sourceview.onEmptyFile", {}, M, "stash.feature.fileContent.emptyFileShown", "3.3", "4.0");
        J.trigger("stash.feature.fileContent.emptyFileShown", {
            containerEl: N.get(0),
            path: M.path,
            commit: L
        })
    }
    function F(L, K) {
        var M = K && K.errors && K.errors.length ? K.errors : [{
            message: "An unknown error has occurred"
        }];
        L.append(I.map(M, stash.feature.fileContent.contentMessage.error).join(""))
    }
    function B(P, O, L, M) {
        var K = L.getCommitRange();
        var N = K.getPullRequest();
        P.append(stash.feature.fileContent.contentMessage.tooLargeDiff({
            filePath: O.destination.toString,
            revisionId: !N && K.getUntilRevision() && K.getUntilRevision().getId(),
            parentRevisionId: !N && K.getSinceRevision() && K.getSinceRevision().getId(),
            sideBySideDiffEnabled: M
        }))
    }
    C.renderConflict = A;
    C.renderEmptyDiff = D;
    C.renderEmptyFile = H;
    C.renderErrors = F;
    C.renderTooLargeDiff = B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:content-message', location = '/static/feature/file-content/content-message/content-message.soy' */
// This file was automatically generated from content-message.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.contentMessage.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.contentMessage == 'undefined') {
    stash.feature.fileContent.contentMessage = {};
}

stash.feature.fileContent.contentMessage.emptyFile = function(opt_data, opt_ignored) {
    return '' + stash.widget.focusMessage.message({
        extraClasses: 'content-view source-view empty-file',
        iconClass: 'icon-empty-file',
        accessibilityText: "Empty file",
        title: "This file is empty"
    });
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.contentMessage.emptyFile.soyTemplateName = 'stash.feature.fileContent.contentMessage.emptyFile';
}

stash.feature.fileContent.contentMessage.error = function(opt_data, opt_ignored) {
    return '<div class="content-message-container">' + aui.message.warning({
        extraClasses: 'content-message',
        content: '' + soy.$$escapeHtml(opt_data.message)
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.contentMessage.error.soyTemplateName = 'stash.feature.fileContent.contentMessage.error';
}

stash.feature.fileContent.contentMessage.tooLargeDiff = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="content-message-container">' + aui.message.warning({
        extraClasses: 'content-message',
        content: '' + ((opt_data.filePath && opt_data.revisionId) ? soy.$$escapeHtml("The diff for this file is too large to render. You can still retrieve it manually with the following Git command.") + '<p class="scm-command">' + ((opt_data.parentRevisionId) ? 'git diff -C -M ' + soy.$$escapeHtml(opt_data.parentRevisionId) + ' ' + soy.$$escapeHtml(opt_data.revisionId) + ' -- "' + soy.$$escapeHtml(opt_data.filePath) + '"' : 'git log -p ' + soy.$$escapeHtml(opt_data.revisionId) + ' -- "' + soy.$$escapeHtml(opt_data.filePath) + '"') + '</p>' : '<p>' + soy.$$escapeHtml("The diff for this file is too large to render") + '</p>' + ((opt_data.sideBySideDiffEnabled) ? '<p>' + soy.$$escapeHtml("It might be possible to view this diff using unified diff. You can switch to unified diff via the options menu.") + '</p>' : ''))
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.contentMessage.tooLargeDiff.soyTemplateName = 'stash.feature.fileContent.contentMessage.tooLargeDiff';
}

stash.feature.fileContent.contentMessage.emptyDiff = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    var param54 = '';
    switch (opt_data.fileChangeType) {
    case 'ADD':
        param54 += soy.$$escapeHtml("The added file is empty");
        break;
    case 'DELETE':
        param54 += soy.$$escapeHtml("The removed file is empty");
        break;
    default:
        param54 += soy.$$escapeHtml("The contents for this file have not changed");
    }
    var output = '' + stash.widget.focusMessage.message({
        extraClasses: 'content-view diff-view empty-file',
        iconClass: 'icon-empty-file',
        accessibilityText: "No diff",
        title: param54
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.contentMessage.emptyDiff.soyTemplateName = 'stash.feature.fileContent.contentMessage.emptyDiff';
}

stash.feature.fileContent.contentMessage.conflict = function(opt_data, opt_ignored) {
    var output = '<div class="diff-conflict-message-container">';
    var param66 = '';
    if (opt_data.messageContent) {
        param66 += soy.$$filterNoAutoescape(opt_data.messageContent);
    } else {
        switch (opt_data.nodeType) {
        case 'SUBMODULE':
            param66 += soy.$$escapeHtml("This submodule is in a conflicted state. You will need to resolve the conflict manually before you can merge this pull request.");
            break;
        default:
            param66 += soy.$$escapeHtml("This file is in a conflicted state. You will need to resolve the conflict manually before you can merge this pull request.");
        }
    }
    output += aui.message.warning({
        titleContent: opt_data.titleContent,
        content: param66
    });
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.contentMessage.conflict.soyTemplateName = 'stash.feature.fileContent.contentMessage.conflict';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:request-diff', location = '/static/feature/file-content/request-diff.js' */
define("feature/file-content/request-diff", ["jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "model/path", "feature/file-content/diff-view-options"], function(F, K, A, J, E, D) {
    var B = {};
    var C = -1;
    function G(L, M) {
        if (F.isArray(M.diffs) && M.diffs.length) {
            M = K.find(M.diffs, function(N) {
                if (N.destination) {
                    return N.destination.toString === new E(L.path).toString()
                } else {
                    if (L.srcPath) {
                        return N.source.toString === new E(L.srcPath).toString()
                    }
                }
                return false
            }) || M.diffs[0]
        }
        return M
    }
    function I(L) {
        var M = A.rest().project(L.repository.project.key).repo(L.repository.slug);
        var O = L.commitRange.pullRequest;
        var N = O ? M.pullRequest(O.id) : M.changeset(L.commitRange);
        return N.diff(L)
    }
    function H(N, T) {
        var O = N.toJSON ? N.toJSON() : N;
        if (O.diff) {
            return F.Deferred().resolve(F.extend({
                lineComments: T.lineComments || [],
                fileComments: T.fileComments || []
            }, O.diff))
        }
        T = T || {};
        var P = T.hasOwnProperty("ignoreWhitespace") ? T.ignoreWhitespace : D.get("ignoreWhitespace");
        var M = isNaN(Number(T.contextLines)) ? C : Math.floor(T.contextLines);
        var S = (T.diffUrlBuilder || I)(O);
        var L = S.withParams({
            avatarSize: stash.widget.avatarSizeInPx({
                size: T.avatarSize || "medium"
            }),
            markup: true,
            whitespace: P ? "ignore-all" : "",
            contextLines: M,
            withComments: T.withComments
        }).build();
        if (B.hasOwnProperty(L) && B[L].state() !== "rejected") {
            return B[L]
        }
        var R = J.rest({
            url: L,
            statusCode: T.statusCode || J.ignore404WithinRepository()
        });
        var Q = R.then(function(U) {
            if (U.errors && U.errors.length) {
                return F.Deferred().rejectWith(this, [this, null, null, U])
            } else {
                U = G(O, U)
            }
            setTimeout(function() {
                delete B[L]
            });
            return U
        });
        B[L] = Q.promise(R);
        return B[L]
    }
    return H
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:revision', location = '/static/model/revision.js' */
define("model/revision", ["backbone-brace", "model/repository", "model/revision-reference"], function(C, A, D) {
    var B = C.Model.extend({
        namedAttributes: {
            id: null,
            displayId: null,
            repository: A,
            message: null,
            author: null,
            authorTimestamp: null,
            parents: null,
            attributes: null,
            properties: null
        },
        hasParents: function() {
            return this.getParents() && this.getParents().length
        },
        getRevisionReference: function() {
            return new D({
                id: this.getId(),
                displayId: this.getDisplayId(),
                type: D.type.COMMIT,
                repository: this.getRepository(),
                latestChangeset: this.getId()
            })
        }
    });
    C.Mixins.applyMixin(B, {
        namedAttributes: {
            parents: [B]
        }
    });
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:participant-model', location = '/static/model/participant.js' */
define("model/participant", ["backbone-brace", "model/stash-user"], function(B, A) {
    return B.Model.extend({
        namedAttributes: {
            approved: "boolean",
            role: "string",
            user: A
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:participant-model', location = '/static/model/participant-collection.js' */
define("model/participant-collection", ["backbone-brace", "lodash", "model/participant"], function(C, A, B) {
    return C.Collection.extend({
        model: B,
        comparator: function(E, D) {
            return (E.getApproved() === D.getApproved()) ? (E.getUser().getDisplayName()).localeCompare(D.getUser().getDisplayName()) : E.getApproved() ? -1 : 1
        },
        findByUser: function(D) {
            return A.find(this.models, function(E) {
                return E.getUser().getName() === D.getName()
            })
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:pull-request-model', location = '/static/model/pull-request.js' */
define("model/pull-request", ["backbone-brace", "model/participant", "model/participant-collection", "model/revision-reference"], function(C, B, A, D) {
    return C.Model.extend({
        namedAttributes: {
            id: null,
            link: null,
            links: Object,
            fromRef: D,
            toRef: D,
            author: B,
            reviewers: A,
            participants: A,
            state: null,
            open: "boolean",
            closed: "boolean",
            locked: "boolean",
            title: null,
            createdDate: Date,
            updatedDate: Date,
            version: null,
            description: null,
            descriptionAsHtml: null,
            attributes: null,
            properties: null
        },
        addParticipant: function(E) {
            var F = this.getParticipants().findByUser(E.getUser());
            if (!F) {
                this.getParticipants().add(E)
            }
        }
    }, {
        state: {
            OPEN: "OPEN",
            MERGED: "MERGED",
            DECLINED: "DECLINED"
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:commit-range', location = '/static/model/commit-range.js' */
define("model/commit-range", ["backbone-brace", "model/pull-request", "model/revision"], function(B, E, A) {
    var D = "ROOT";
    function C(F) {
        if (F.getPullRequest()) {
            return F.getPullRequest().getId()
        }
        return F.getUntilRevision().getId() + "_" + (F.getSinceRevision() ? F.getSinceRevision().getId() : D)
    }
    return B.Model.extend({
        namedAttributes: {
            pullRequest: E,
            untilRevision: A,
            sinceRevision: A
        },
        initialize: function() {
            if (!this.getUntilRevision()) {
                if (this.getPullRequest()) {
                    var F = this.getPullRequest().getFromRef();
                    this.setUntilRevision(F && new A({
                        id: F.getLatestChangeset()
                    }));
                    var G = this.getPullRequest().getToRef();
                    this.setSinceRevision(G && new A({
                        id: G.getLatestChangeset()
                    }))
                } else {
                    throw new Error("Commits range requires either a pull request or revision(s)")
                }
            }
            if (this.getSinceRevision() && this.getSinceRevision().getId() === D) {
                this.setSinceRevision(undefined)
            }
            this.setId(C(this))
        }
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:conflict-change-model', location = '/static/model/conflict-change.js' */
define("model/conflict-change", ["backbone-brace", "util/deprecation", "model/file-change-types", "model/path"], function(A, D, C, B) {
    var E = A.Model.extend({
        namedAttributes: {
            srcPath: B,
            path: B,
            type: null
        },
        initialize: function() {
            this.setType(E._mapChangeType(this.getType(), this.getSrcPath(), this.getPath()))
        }
    }, {
        _mapChangeType: function(F, H, G) {
            return (F === C.MOVE && H && H.isSameDirectory(G)) ? C.RENAME : C.changeTypeFromId(F)
        }
    });
    (function(F) {
        E.prototype.toJSON = function() {
            var G = F.apply(this, arguments);
            if (this.getPath()) {
                G.path = D.jsonAsBrace(this.getPath(), "3.2", "4.0")
            }
            if (this.getSrcPath()) {
                G.srcPath = D.jsonAsBrace(this.getSrcPath(), "3.2", "4.0")
            }
            return G
        }
    })(E.prototype.toJSON);
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:conflict-model', location = '/static/model/conflict.js' */
define("model/conflict", ["aui", "backbone-brace", "model/conflict-change", "model/file-change-types"], function(A, C, F, D) {
    var B = {};
    B[D.ADD] = {};
    B[D.ADD][D.ADD] = "Conflict: Added file to Source, Added same file to Target";
    B[D.ADD][D.RENAME] = "Conflict: Added file to Source, Renamed to same on Target";
    B[D.ADD][D.MOVE] = "Conflict: Added file to Source, Moved to same on Target";
    B[D.MODIFY] = {};
    B[D.MODIFY][D.MODIFY] = "Conflict: Modified on Source, Modified on Target";
    B[D.MODIFY][D.RENAME] = "Conflict: Modified on Source, Renamed on Target";
    B[D.MODIFY][D.MOVE] = "Conflict: Modified on Source, Moved on Target";
    B[D.MODIFY][D.DELETE] = "Conflict: Modified on Source, Deleted on Target";
    B[D.RENAME] = {};
    B[D.RENAME][D.ADD] = "Conflict: Renamed on Source, Added same to Target";
    B[D.RENAME][D.RENAME] = "Conflict: Renamed on Source, Renamed on Target";
    B[D.RENAME][D.MOVE] = "Conflict: Renamed on Source, Moved on Target";
    B[D.RENAME][D.DELETE] = "Conflict: Renamed on Source, Deleted on Target";
    B[D.MOVE] = {};
    B[D.MOVE][D.ADD] = "Conflict: Moved on Source, Added same to Target";
    B[D.MOVE][D.RENAME] = "Conflict: Moved on Source, Renamed on Target";
    B[D.MOVE][D.MOVE] = "Conflict: Moved on Source, Moved on Target";
    B[D.MOVE][D.DELETE] = "Conflict: Moved on Source, Deleted on Target";
    B[D.DELETE] = {};
    B[D.DELETE][D.MODIFY] = "Conflict: Deleted on Source, Modified on Target";
    B[D.DELETE][D.RENAME] = "Conflict: Deleted on Source, Renamed on Target";
    B[D.DELETE][D.MOVE] = "Conflict: Deleted on Source, Moved on Target";
    var E = C.Model.extend({
        namedAttributes: {
            ourChange: F,
            theirChange: F
        },
        getConflictMessage: function() {
            var H = this.getOurChange() && this.getOurChange().getType()
              , G = this.getTheirChange() && this.getTheirChange().getType();
            return (B[G] && B[G][H]) || ""
        }
    });
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-change', location = '/static/model/file-change.js' */
define("model/file-change", ["backbone-brace", "util/deprecation", "model/commit-range", "model/conflict", "model/file-change-types", "model/path", "model/repository"], function(C, F, B, H, E, D, A) {
    var G = C.Model.extend({
        namedAttributes: {
            repository: A,
            commitRange: B,
            srcPath: D,
            path: D,
            line: null,
            search: null,
            type: null,
            nodeType: null,
            conflict: H,
            diff: null,
            srcExecutable: null,
            executable: null
        },
        initialize: function() {
            if (this.getPath()) {
                this.setPath(new D(this.getPath()))
            }
            if (this.getSrcPath()) {
                this.setSrcPath(new D(this.getSrcPath()))
            }
            this.setType(G._mapChangeType(this.getType(), this.getSrcPath(), this.getPath()))
        }
    }, {
        fromDiff: function(J, I, K) {
            return new G({
                repository: K,
                commitRange: I,
                srcPath: J.source,
                path: J.destination,
                diff: J,
                type: E.guessChangeTypeFromDiff(J)
            })
        },
        _mapChangeType: function(I, K, J) {
            return (I === E.MOVE && K && K.isSameDirectory(J)) ? E.RENAME : E.changeTypeFromId(I)
        }
    });
    (function(I) {
        G.prototype.toJSON = function() {
            var K = this.getPath();
            var L = this.getSrcPath();
            this.setPath(null);
            this.setSrcPath(null);
            var J = I.apply(this, arguments);
            if (K) {
                J.path = F.jsonAsBrace(K, "3.2", "4.0")
            }
            if (L) {
                J.srcPath = F.jsonAsBrace(L, "3.2", "4.0")
            }
            this.setPath(K);
            this.setSrcPath(L);
            return J
        }
    })(G.prototype.toJSON);
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-api:file-handlers', location = '/static/util/handler-registry.js' */
define("util/handler-registry", ["jquery", "lodash"], function(C, A) {
    function B() {
        this.handlers = []
    }
    B.prototype.register = function(E) {
        if (!A.isFunction(E.handle)) {
            throw new Error("Handler must have a handle function")
        }
        E.weight = typeof E.weight === "number" && !isNaN(E.weight) ? E.weight : 1000;
        this.handlers.push(E);
        this.handlers = A.sortBy(this.handlers, function(G) {
            return G.weight
        });
        var F = this;
        return function D() {
            var G = F.handlers.indexOf(E);
            if (G >= 0) {
                F.handlers.splice(G, 1)
            }
        }
    }
    ;
    B.prototype._handle = function(G) {
        var F = C.Deferred();
        var I;
        var D;
        var E = this.handlers;
        var J = [];
        function H(K) {
            if (I) {
                return F.reject(new Error("Handling aborted."))
            }
            if (K < E.length) {
                D = E[K].handle(G) || C.Deferred().reject();
                return C.when(D).done(function(L) {
                    F.resolve(L || {}, J)
                }).fail(function(L) {
                    L && J.push(L);
                    H(K + 1)
                })
            } else {
                F.reject(new Error("No registered handlers were able to handle file"))
            }
        }
        H(0);
        return F.promise({
            abort: function() {
                if (!I && D && D.abort) {
                    D.abort()
                }
                I = true
            }
        })
    }
    ;
    B.prototype._clear = function() {
        this.handlers = []
    }
    ;
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-api:file-handlers', location = '/static/stash/api/feature/files/file-handlers.js' */
define("stash/api/feature/files/file-handlers", ["util/handler-registry", "util/object"], function(B, A) {
    var D = new B();
    function C(E) {}
    D.builtInHandlers = {
        ERROR: "error",
        SOURCE_TEXT: "source-text",
        SOURCE_EMPTY: "source-empty",
        SOURCE_IMAGE: "source-image",
        SOURCE_BINARY: "source-binary",
        DIFF_TEXT_SIDE_BY_SIDE: "diff-text-side-by-side",
        DIFF_TEXT_UNIFIED: "diff-text-unified",
        DIFF_EMPTY: "diff-empty",
        DIFF_TOO_LARGE: "diff-too-large",
        DIFF_IMAGE: "diff-image",
        DIFF_BINARY: "diff-binary"
    };
    A.freeze(D.builtInHandlers);
    return D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:eevee', location = '/static/bower/eevee/lib/eevee.js' */
define("eevee", ["backbone", "eve", "underscore"], function(D, B, A) {
    var C = {
        trigger: function(E, F) {
            return B.apply(this, arguments)
        },
        on: function(E, F) {
            return B.on(E, F)
        },
        off: function(E, F) {
            return B.off(E, F)
        },
        once: function(E, F) {
            return B.once(E, F)
        },
        listeners: function(E) {
            return B.listeners(E)
        },
        name: function(E) {
            return B.nt(E)
        },
        chain: function() {
            return this.chainWith(this)
        },
        chainWith: function(G) {
            var E = [];
            var F = {
                on: function(I, H) {
                    var J = arguments;
                    G.on.apply(G, J);
                    E.push(function() {
                        G.off.apply(G, J)
                    });
                    return this
                },
                destroy: function() {
                    for (var H = 0; H < E.length; H++) {
                        E[H]()
                    }
                    E = []
                }
            };
            return F
        },
        stop: function() {
            return B.stop()
        },
        createEventMixin: function(F, E) {
            E = E || {};
            return A.extend({}, D.Events, {
                trigger: function(H) {
                    var G = D.Events.trigger.apply(this, arguments);
                    if (!E.localOnly) {
                        C.trigger.apply(C, [F + "/" + H, this].concat(Array.prototype.slice.call(arguments, 1)))
                    }
                    return G
                },
                retriggerFrom: function(G) {
                    var I = Array.prototype.slice.call(arguments, 1);
                    function H(K, J) {
                        return K.on(J, this.trigger.bind(this, J))
                    }
                    return I.reduce(H.bind(this), C.chainWith(G))
                }
            })
        },
        createLocalEventMixin: function() {
            return this.createEventMixin(null, {
                localOnly: true
            })
        },
        addEventMixin: function(F, G, E) {
            A.extend(F, this.createEventMixin(G, E))
        },
        addLocalEventMixin: function(E) {
            A.extend(E, this.createLocalEventMixin())
        }
    };
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:image-diff-toolbar', location = '/static/bower/image-differ/lib/image-diff-toolbar.js' */
define("image-diff-toolbar", ["aui", "eevee", "jquery"], function(B, C, D) {
    function A(E) {
        this._$toolbar = D(E);
        this._$toggle = this._$toolbar.find(".image-diff-toggle")
    }
    C.addLocalEventMixin(A.prototype);
    A.prototype.init = function(J) {
        var M = this;
        var F = this._$toggle.find(".image-diff-two-up");
        var I = this._$toggle.find(".image-diff-blend");
        var E = this._$toggle.find(".image-diff-split");
        var L = this._$toggle.find(".image-diff-pixeldiff");
        E.attr("aria-disabled", !J).prop("disabled", !J);
        if (J) {
            E.attr("title", "Compare the image changes by moving your mouse cursor left or right over the image")
        }
        L.attr("aria-disabled", !J).prop("disabled", !J);
        if (J) {
            L.attr("title", "Compare the image changes by seeing which pixels have changed")
        }
        I.attr("aria-disabled", !J).prop("disabled", !J);
        if (J) {
            I.attr("title", "Compare the image changes by fading in the differences")
        }
        function K(N) {
            M.trigger("modeChanged", N, M._mode);
            M._mode = N
        }
        var G = this._$toggle.find(".aui-button");
        var H = function(N) {
            return function(P) {
                var O = D(this);
                if (O.attr("aria-disabled") !== "true" && O.attr("aria-pressed") !== "true") {
                    G.attr("aria-pressed", "false");
                    O.attr("aria-pressed", "true");
                    K(N)
                }
                P.preventDefault()
            }
        };
        F.click(H("two-up"));
        I.click(H("blend"));
        E.click(H("split"));
        L.click(H("pixeldiff"));
        F.add(I).add(E).add(L).tooltip({
            gravity: "s"
        });
        K("two-up")
    }
    ;
    A.prototype.getMode = function() {
        return this._mode
    }
    ;
    A.prototype.destroy = function() {
        if (this._$toolbar) {
            this._$toolbar.remove();
            this._$toolbar = null
        }
        this._$toggle = null
    }
    ;
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:image-diff-toolbar', location = '/static/bower/image-differ/lib/image-diff-toolbar.soy' */
// This file was automatically generated from image-diff-toolbar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace imageDiffer.imageDiffToolbar.
 */

if (typeof imageDiffer == 'undefined') {
    var imageDiffer = {};
}
if (typeof imageDiffer.imageDiffToolbar == 'undefined') {
    imageDiffer.imageDiffToolbar = {};
}

imageDiffer.imageDiffToolbar.main = function(opt_data, opt_ignored) {
    return '' + aui.toolbar2.toolbar2({
        content: '' + aui.toolbar2.item({
            item: 'primary',
            extraClasses: 'image-diff-toggle',
            content: '' + imageDiffer.imageDiffToolbar.toggleButtons(null)
        }),
        extraClasses: 'image-diff-toolbar'
    });
}
;
if (goog.DEBUG) {
    imageDiffer.imageDiffToolbar.main.soyTemplateName = 'imageDiffer.imageDiffToolbar.main';
}

imageDiffer.imageDiffToolbar.toggleButtons = function(opt_data, opt_ignored) {
    return '' + aui.buttons.buttons({
        content: '' + aui.buttons.button({
            extraClasses: 'image-diff-two-up',
            isPressed: true,
            text: "Two-up",
            extraAttributes: {
                title: "Compare images alongside each other"
            }
        }) + aui.buttons.button({
            extraClasses: 'image-diff-blend',
            isDisabled: true,
            text: "Blend",
            extraAttributes: {
                title: "Blend mode image diff is not available because images are not of the same dimension"
            }
        }) + aui.buttons.button({
            extraClasses: 'image-diff-split',
            isDisabled: true,
            text: "Split",
            extraAttributes: {
                title: "Split mode image diff is not available because images are not of the same dimension"
            }
        }) + aui.buttons.button({
            extraClasses: 'image-diff-pixeldiff',
            isDisabled: true,
            text: "Pixel diff",
            extraAttributes: {
                title: "Pixel diff mode image diff is not available because images are not of the same dimension"
            }
        })
    });
}
;
if (goog.DEBUG) {
    imageDiffer.imageDiffToolbar.toggleButtons.soyTemplateName = 'imageDiffer.imageDiffToolbar.toggleButtons';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:fd-slider', location = '/static/bower/fd-slider/js/fd-slider.js' */
/* Unobtrusive Slider Control / HTML5 Input Range polyfill - MIT/GPL2 @freqdec */
var fdSlider = (function() {
    var sliders = {}
      , uniqueid = 0
      , mouseWheelEnabled = true
      , fullARIA = true
      , describedBy = "fd-slider-describedby"
      , varSetRules = {
        onfocus: true,
        onvalue: true
    }
      , noRangeBar = false
      , html5Animation = "jump"
      , isOpera = Object.prototype.toString.call(window.opera) === "[object Opera]"
      , fpRegExp = /^([\-]{0,1}[0-9]+(\.[0-9]+){0,1})$/
      , stepRegExp = /^([0-9]+(\.[0-9]+){0,1})$/;
    var parseJSON = function(str) {
        if (typeof str !== "string" || str === "") {
            return {}
        }
        try {
            if (typeof JSON === "object" && typeof (JSON.parse) === "function") {
                return JSON.parse(str)
            } else {
                if (/mousewheelenabled|fullaria|describedby|norangebar|html5animation|varsetrules/.test(str.toLowerCase())) {
                    var f = Function(["var document,top,self,window,parent,Number,Date,Object,Function,", "Array,String,Math,RegExp,Image,ActiveXObject;", "return (", str.replace(/<\!--.+-->/gim, "").replace(/\bfunction\b/g, "function-"), ");"].join(""));
                    return f()
                }
            }
        } catch (e) {}
        return {
            err: "Could not parse the JSON object"
        }
    };
    var affectJSON = function(json) {
        if (typeof json !== "object") {
            return
        }
        for (var key in json) {
            value = json[key];
            switch (key.toLowerCase()) {
            case "mousewheelenabled":
                mouseWheelEnabled = !!value;
                break;
            case "fullaria":
                fullARIA = !!value;
                break;
            case "describedby":
                describedBy = String(value);
                break;
            case "norangebar":
                noRangeBar = !!value;
                break;
            case "html5animation":
                html5Animation = String(value).search(/^(jump|tween|timed)$/i) != -1 ? String(value).toLowerCase() : "jump";
                break;
            case "varsetrules":
                if ("onfocus"in value) {
                    varSetRules.onfocus = !!value.onfocus
                }
                if ("onvalue"in value) {
                    varSetRules.onvalue = !!value.onvalue
                }
                break
            }
        }
    };
    var addEvent = function(obj, type, fn) {
        if (obj.addEventListener) {
            obj.addEventListener(type, fn, true)
        } else {
            if (obj.attachEvent) {
                obj.attachEvent("on" + type, fn)
            }
        }
    };
    var removeEvent = function(obj, type, fn) {
        try {
            if (obj.removeEventListener) {
                obj.removeEventListener(type, fn, true)
            } else {
                if (obj.detachEvent) {
                    obj.detachEvent("on" + type, fn)
                }
            }
        } catch (err) {}
    };
    var stopEvent = function(e) {
        e = e || window.event;
        if (e.stopPropagation) {
            e.stopPropagation();
            e.preventDefault();
            /*@cc_on@*/
            /*@if(@_win32)
        e.cancelBubble = true;
        e.returnValue = false;
        /*@end@*/
        }
        return false
    };
    var preventDefault = function(e) {
        e = e || window.event;
        if (e.preventDefault) {
            e.preventDefault();
            return
        }
        e.returnValue = false
    };
    var addClass = function(e, c) {
        if (new RegExp("(^|\\s)" + c + "(\\s|$)").test(e.className)) {
            return
        }
        e.className += (e.className ? " " : "") + c
    };
    var removeClass = function(e, c) {
        e.className = !c ? "" : e.className.replace(new RegExp("(^|\\s)" + c + "(\\s|$)"), " ").replace(/^\s\s*/, "").replace(/\s\s*$/, "")
    };
    var getValueSet = function() {
        var obj = {};
        for (var id in sliders) {
            obj[id] = sliders[id].getValueSet()
        }
        return obj
    };
    var setValueSet = function(sliderId, tf) {
        sliders[sliderId].setValueSet(!!tf)
    };
    var sliderExists = function(slider) {
        return !!(slider in sliders && sliders.hasOwnProperty(slider))
    };
    var createSlider = function(options) {
        if (!options || !options.inp || !options.inp.tagName || options.inp.tagName.search(/^input|select/i) == -1) {
            return false
        }
        options.html5Shim = false;
        if (options.inp.tagName.toLowerCase() == "select") {
            if (options.inp.options.length < 2) {
                return false
            }
            options.min = 0;
            options.max = options.inp.options.length - 1;
            options.step = 1;
            options.precision = 0;
            options.scale = false;
            options.forceValue = true
        } else {
            if (String(options.inp.type).search(/^(text|range)$/i) == -1) {
                return false
            }
            options.min = options.min && String(options.min).search(fpRegExp) != -1 ? +options.min : 0;
            options.max = options.max && String(options.max).search(fpRegExp) != -1 ? +options.max : 100;
            options.step = options.step && String(options.step).search(stepRegExp) != -1 ? options.step : 1;
            options.precision = options.precision && String(options.precision).search(/^[0-9]+$/) != -1 ? options.precision : (String(options.step).search(/\.([0-9]+)$/) != -1 ? String(options.step).match(/\.([0-9]+)$/)[1].length : 0);
            options.scale = options.scale || false;
            options.forceValue = ("forceValue"in options) ? !!options.forceValue : false;
            options.userSnap = ("userSnap"in options) ? !!options.userSnap : false
        }
        options.ariaFormat = ("ariaFormat"in options) && typeof options.ariaFormat == "function" ? options.ariaFormat : false;
        options.maxStep = options.maxStep && String(options.maxStep).search(stepRegExp) != -1 ? +options.maxStep : +options.step * 2;
        options.classNames = options.classNames || "";
        options.callbacks = options.callbacks || false;
        destroySingleSlider(options.inp.id);
        sliders[options.inp.id] = new fdRange(options);
        return true
    };
    var getAttribute = function(elem, att) {
        return elem.getAttribute(att) || ""
    };
    var init = function() {
        var inputs = document.getElementsByTagName("input"), options;
        for (var i = 0, inp; inp = inputs[i]; i++) {
            if (inp.tagName.toLowerCase() == "input" && inp.type.toLowerCase() == "text" && (getAttribute(inp, "min") && getAttribute(inp, "min").search(fpRegExp) != -1 || getAttribute(inp, "max") && getAttribute(inp, "max").search(fpRegExp) != -1 || getAttribute(inp, "step") && getAttribute(inp, "step").search(/^(any|([0-9]+(\.[0-9]+){0,1}))$/i) != -1)) {
                if (inp.id && document.getElementById("fd-slider-" + inp.id)) {
                    continue
                } else {
                    if (inp.id && !document.getElementById("fd-slider-" + inp.id)) {
                        destroySingleSlider(inp.id)
                    }
                }
                if (!inp.id) {
                    inp.id = "fd-slider-form-elem-" + uniqueid++
                }
                options = {
                    inp: inp,
                    callbacks: [],
                    animation: html5Animation,
                    vertical: getAttribute(inp, "data-fd-slider-vertical") ? true : (inp.offsetHeight > inp.offsetWidth),
                    classNames: getAttribute(inp, "data-fd-slider-vertical"),
                    html5Shim: true
                };
                if (options.vertical && !getAttribute(inp, "data-fd-slider-vertical")) {
                    options.inpHeight = inp.offsetHeight
                }
                options.min = getAttribute(inp, "min") || 0;
                options.max = getAttribute(inp, "max") || 100;
                options.step = getAttribute(inp, "step").search(/^any$/i) != -1 ? options.max - options.min : getAttribute(inp, "step").search(stepRegExp) != -1 ? inp.getAttribute("step") : 1;
                options.precision = String(options.step).search(/\.([0-9]+)$/) != -1 ? String(options.step).match(/\.([0-9]+)$/)[1].length : 0;
                options.maxStep = options.step * 2;
                destroySingleSlider(options.inp.id);
                sliders[options.inp.id] = new fdRange(options)
            }
        }
        return true
    };
    var destroySingleSlider = function(id) {
        if (id in sliders && sliders.hasOwnProperty(id)) {
            sliders[id].destroy();
            delete sliders[id];
            return true
        }
        return false
    };
    var destroyAllsliders = function(e) {
        for (var slider in sliders) {
            if (sliders.hasOwnProperty(slider)) {
                sliders[slider].destroy()
            }
        }
        sliders = []
    };
    var unload = function(e) {
        destroyAllsliders();
        sliders = null
    };
    var resize = function(e) {
        for (var slider in sliders) {
            if (sliders.hasOwnProperty(slider)) {
                sliders[slider].onResize()
            }
        }
    };
    var onDomReady = function() {
        removeOnLoadEvent();
        init()
    };
    var removeOnLoadEvent = function() {
        removeEvent(window, "load", init)
    };
    function fdRange(options) {
        var inp = options.inp, disabled = false, tagName = inp.tagName.toLowerCase(), min = +options.min, max = +options.max, rMin = +options.min, rMax = +options.max, range = Math.abs(max - min), step = tagName == "select" ? 1 : +options.step, maxStep = options.maxStep ? +options.maxStep : step * 2, precision = options.precision || 0, steps = Math.ceil(range / step), scale = options.scale || false, hideInput = !!options.hideInput, animation = options.animation || "", vertical = !!options.vertical, callbacks = options.callbacks || {}, classNames = options.classNames || "", html5Shim = !!options.html5Shim, defaultVal = max < min ? min : min + ((max - min) / 2), resetDef = tagName == "select" ? inp.selectedIndex : inp.defaultValue || defaultVal, forceValue = html5Shim || !!options.forceValue, inpHeight = html5Shim && vertical && ("inpHeight"in options) ? options.inpHeight : false, ariaFormat = !html5Shim && options.ariaFormat ? options.ariaFormat : false, userSnap = !html5Shim && !(tagName == "select") && ("userSnap"in options) ? !!options.userSnap : false, userInput = false, timer = null, kbEnabled = true, initialVal = tagName == "select" ? inp.selectedIndex : inp.value, sliderH = 0, sliderW = 0, tweenX = 0, tweenB = 0, tweenC = 0, tweenD = 0, frame = 0, x = 0, y = 0, rMaxPx = 0, rMinPx = 0, handlePos = 0, destPos = 0, mousePos = 0, stepPx = 0, userSet = false, touchEvents = false, outerWrapper, innerWrapper, ieBlur, handle, rangeBar, bar;
        if (tagName == "input" && forceValue && !inp.defaultValue) {
            inp.defaultValue = getWorkingValueFromInput()
        }
        if (max < min) {
            step = -Math.abs(step);
            maxStep = -Math.abs(maxStep)
        }
        if (scale) {
            scale[100] = max
        }
        function valueSet(tf) {
            tf = !!tf;
            if (tf != userSet) {
                userSet = tf;
                valueToPixels(getWorkingValueFromInput())
            }
        }
        function disableSlider(noCallback) {
            if (disabled && !noCallback) {
                return
            }
            try {
                setTabIndex(handle, -1);
                removeEvent(handle, "focus", onFocus);
                removeEvent(handle, "blur", onBlur);
                if (!isOpera) {
                    removeEvent(handle, "keydown", onKeyDown);
                    removeEvent(handle, "keypress", onKeyPress)
                } else {
                    removeEvent(handle, "keypress", onKeyDown)
                }
                removeEvent(outerWrapper, "mouseover", onMouseOver);
                removeEvent(outerWrapper, "mouseout", onMouseOut);
                removeEvent(outerWrapper, "mousedown", onMouseDown);
                removeEvent(outerWrapper, "touchstart", onMouseDown);
                if (mouseWheelEnabled) {
                    if (window.addEventListener && !window.devicePixelRatio) {
                        window.removeEventListener("DOMMouseScroll", trackMouseWheel, false)
                    } else {
                        removeEvent(document, "mousewheel", trackMouseWheel);
                        removeEvent(window, "mousewheel", trackMouseWheel)
                    }
                }
            } catch (err) {}
            removeClass(innerWrapper, "fd-slider-focused");
            removeClass(innerWrapper, "fd-slider-active");
            addClass(innerWrapper, "fd-slider-disabled");
            outerWrapper.setAttribute("aria-disabled", true);
            inp.disabled = disabled = true;
            clearTimeout(timer);
            if (!noCallback) {
                callback("disable")
            }
        }
        function enableSlider(noCallback) {
            if (!disabled && !noCallback) {
                return
            }
            setTabIndex(handle, 0);
            addEvent(handle, "focus", onFocus);
            addEvent(handle, "blur", onBlur);
            if (!isOpera) {
                addEvent(handle, "keydown", onKeyDown);
                addEvent(handle, "keypress", onKeyPress)
            } else {
                addEvent(handle, "keypress", onKeyDown)
            }
            addEvent(outerWrapper, "touchstart", onMouseDown);
            addEvent(outerWrapper, "mousedown", onMouseDown);
            addEvent(outerWrapper, "mouseover", onMouseOver);
            addEvent(outerWrapper, "mouseout", onMouseOut);
            removeClass(innerWrapper, "fd-slider-disabled");
            outerWrapper.setAttribute("aria-disabled", false);
            inp.disabled = disabled = touchEvents = false;
            if (!noCallback) {
                callback("enable")
            }
        }
        function destroySlider() {
            clearTimeout(timer);
            ieBlur = bar = handle = outerWrapper = innerWrapper = timer = null;
            callback("destroy");
            callbacks = null
        }
        function redraw() {
            locate();
            try {
                var sW = outerWrapper.offsetWidth
                  , sH = outerWrapper.offsetHeight
                  , hW = handle.offsetWidth
                  , hH = handle.offsetHeight
                  , bH = bar.offsetHeight
                  , bW = bar.offsetWidth
                  , mPx = vertical ? sH - hH : sW - hW;
                stepPx = mPx / steps;
                rMinPx = Math.max(scale ? percentToPixels(valueToPercent(rMin)) : Math.abs((rMin - min) / step) * stepPx, 0);
                rMaxPx = Math.min(scale ? percentToPixels(valueToPercent(rMax)) : Math.abs((rMax - min) / step) * stepPx, Math.floor(vertical ? sH - hH : sW - hW));
                sliderW = sW;
                sliderH = sH;
                valueToPixels(forceValue ? getWorkingValueFromInput() : (tagName == "select" ? inp.selectedIndex : parseFloat(inp.value)), false)
            } catch (err) {}
            callback("redraw")
        }
        function callback(type) {
            if (!html5Shim) {
                if (callbacks.hasOwnProperty(type)) {
                    var cbObj = {
                        userSet: userSet,
                        disabled: disabled,
                        elem: inp,
                        value: tagName == "select" ? inp.options[inp.selectedIndex].value : inp.value
                    };
                    for (var i = 0, func; func = callbacks[type][i]; i++) {
                        func.call(inp, cbObj)
                    }
                }
            } else {
                if (type.match(/^(blur|focus|change)$/i)) {
                    var e;
                    if (typeof (document.createEvent) != "undefined") {
                        e = document.createEvent("HTMLEvents");
                        e.initEvent(type, true, true);
                        inp.dispatchEvent(e)
                    } else {
                        if (typeof (document.createEventObject) != "undefined") {
                            try {
                                e = document.createEventObject();
                                inp.fireEvent("on" + type.toLowerCase(), e)
                            } catch (err) {}
                        }
                    }
                }
            }
        }
        function onFocus(e) {
            addClass(innerWrapper, "fd-slider-focused");
            if (varSetRules.onfocus) {
                userSet = true;
                valueToPixels(getWorkingValueFromInput())
            }
            if (mouseWheelEnabled) {
                addEvent(window, "DOMMouseScroll", trackMouseWheel);
                addEvent(document, "mousewheel", trackMouseWheel);
                if (!isOpera) {
                    addEvent(window, "mousewheel", trackMouseWheel)
                }
            }
            callback("focus");
            return true
        }
        function onBlur(e) {
            removeClass(innerWrapper, "fd-slider-focused");
            if (mouseWheelEnabled) {
                removeEvent(document, "mousewheel", trackMouseWheel);
                removeEvent(window, "DOMMouseScroll", trackMouseWheel);
                if (!isOpera) {
                    removeEvent(window, "mousewheel", trackMouseWheel)
                }
            }
            kbEnabled = true;
            callback("blur")
        }
        function trackMouseWheel(e) {
            if (!kbEnabled) {
                return
            }
            e = e || window.event;
            var delta = 0, value;
            if (e.wheelDelta) {
                delta = e.wheelDelta / 120;
                if (isOpera && window.opera.version() < 9.2) {
                    delta = -delta
                }
            } else {
                if (e.detail) {
                    delta = -e.detail / 3
                }
            }
            if (vertical) {
                delta = -delta
            }
            if (delta) {
                value = getWorkingValueFromInput();
                value += (delta < 0) ? -step : step;
                userSet = true;
                valueToPixels(getValidValue(value))
            }
            preventDefault(e)
        }
        function onKeyPress(e) {
            e = e || window.event;
            if ((e.keyCode >= 33 && e.keyCode <= 40) || !kbEnabled || e.keyCode == 45 || e.keyCode == 46) {
                return stopEvent(e)
            }
            return true
        }
        function onKeyDown(e) {
            if (!kbEnabled) {
                return true
            }
            e = e || window.event;
            var kc = e.keyCode !== null ? e.keyCode : e.charCode, value;
            if (kc < 33 || (kc > 40 && (kc != 45 && kc != 46))) {
                return true
            }
            value = getWorkingValueFromInput();
            if (kc == 37 || kc == 40 || kc == 46 || kc == 34) {
                value -= (e.ctrlKey || kc == 34 ? +maxStep : +step)
            } else {
                if (kc == 39 || kc == 38 || kc == 45 || kc == 33) {
                    value += (e.ctrlKey || kc == 33 ? +maxStep : +step)
                } else {
                    if (kc == 35) {
                        value = rMax
                    } else {
                        if (kc == 36) {
                            value = rMin
                        }
                    }
                }
            }
            userSet = true;
            valueToPixels(getValidValue(value));
            callback("update");
            preventDefault(e)
        }
        function onMouseOver(e) {
            addClass(innerWrapper, "fd-slider-hover")
        }
        function onMouseOut(e) {
            removeClass(innerWrapper, "fd-slider-hover")
        }
        function onMouseDown(e) {
            e = e || window.event;
            preventDefault(e);
            var targ;
            if (e.target) {
                targ = e.target
            } else {
                if (e.srcElement) {
                    targ = e.srcElement
                }
            }
            if (targ && targ.nodeType == 3) {
                targ = targ.parentNode
            }
            if (e.touches) {
                if (e.targetTouches && e.targetTouches.length != 1) {
                    return false
                }
                e = e.touches[0];
                touchEvents = true
            }
            clearTimeout(timer);
            timer = null;
            kbEnabled = false;
            userSet = true;
            if (targ.className.search("fd-slider-handle") != -1) {
                mousePos = vertical ? e.clientY : e.clientX;
                handlePos = parseInt(vertical ? handle.offsetTop : handle.offsetLeft) || 0;
                trackMouse(e);
                if (!touchEvents) {
                    addEvent(document, "mousemove", trackMouse);
                    addEvent(document, "mouseup", stopDrag)
                } else {
                    addEvent(document, "touchmove", trackMouse);
                    addEvent(document, "touchend", stopDrag);
                    removeEvent(outerWrapper, "mousedown", onMouseDown)
                }
                addClass(innerWrapper, "fd-slider-active");
                addClass(document.body, "fd-slider-drag-" + (vertical ? "vertical" : "horizontal"));
                callback("dragstart")
            } else {
                locate();
                var posx = 0;
                if (e.pageX || e.pageY) {
                    posx = vertical ? e.pageY : e.pageX
                } else {
                    if (e.clientX || e.clientY) {
                        posx = vertical ? e.clientY + document.body.scrollTop + document.documentElement.scrollTop : e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft
                    }
                }
                posx -= vertical ? y + Math.round(handle.offsetHeight / 2) : x + Math.round(handle.offsetWidth / 2);
                posx = snapToPxValue(posx);
                if (animation == "tween") {
                    addClass(innerWrapper, "fd-slider-active");
                    tweenTo(posx)
                } else {
                    if (animation == "timed") {
                        addClass(innerWrapper, "fd-slider-active");
                        addEvent(document, touchEvents ? "touchend" : "mouseup", onDocMouseUp);
                        destPos = posx;
                        onTimer()
                    } else {
                        pixelsToValue(posx)
                    }
                }
            }
            return false
        }
        function onDocMouseUp(e) {
            e = e || window.event;
            preventDefault(e);
            removeEvent(document, touchEvents ? "touchend" : "mouseup", onDocMouseUp);
            removeClass(innerWrapper, "fd-slider-active");
            clearTimeout(timer);
            timer = null;
            kbEnabled = true;
            return false
        }
        function stopDrag(e) {
            e = e || window.event;
            preventDefault(e);
            if (touchEvents) {
                removeEvent(document, "touchmove", trackMouse);
                removeEvent(document, "touchend", stopDrag)
            } else {
                removeEvent(document, "mousemove", trackMouse);
                removeEvent(document, "mouseup", stopDrag)
            }
            kbEnabled = true;
            removeClass(document.body, "fd-slider-drag-" + (vertical ? "vertical" : "horizontal"));
            removeClass(innerWrapper, "fd-slider-active");
            callback("dragend");
            return false
        }
        function trackMouse(e) {
            e = e || window.event;
            preventDefault(e);
            if (e.touches) {
                if (e.targetTouches && e.targetTouches.length != 1) {
                    return false
                }
                e = e.touches[0]
            }
            pixelsToValue(snapToPxValue(handlePos + (vertical ? e.clientY - mousePos : e.clientX - mousePos)));
            return false
        }
        function increment(inc) {
            var value = getWorkingValueFromInput();
            userSet = true;
            value += inc * step;
            valueToPixels(getValidValue(value))
        }
        function locate() {
            var curleft = 0
              , curtop = 0
              , obj = outerWrapper;
            try {
                do {
                    curleft += obj.offsetLeft;
                    curtop += obj.offsetTop
                } while (obj = obj.offsetParent)
            } catch (err) {}
            x = curleft;
            y = curtop
        }
        function onTimer() {
            var xtmp = parseInt(vertical ? handle.offsetTop : handle.offsetLeft, 10);
            xtmp = Math.round((destPos < xtmp) ? Math.max(destPos, Math.floor(xtmp - stepPx)) : Math.min(destPos, Math.ceil(xtmp + stepPx)));
            pixelsToValue(snapToPxValue(xtmp));
            if (xtmp != destPos) {
                timer = setTimeout(onTimer, steps > 20 ? 50 : 100)
            } else {
                kbEnabled = true;
                removeClass(innerWrapper, "fd-slider-active");
                callback("finalise")
            }
        }
        var tween = function() {
            frame++;
            var c = tweenC
              , d = 20
              , t = frame
              , b = tweenB
              , x = Math.ceil((t == d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b);
            pixelsToValue(t == d ? tweenX : x);
            if (t != d) {
                callback("move");
                timer = setTimeout(tween, 20)
            } else {
                clearTimeout(timer);
                timer = null;
                kbEnabled = true;
                removeClass(innerWrapper, "fd-slider-focused");
                removeClass(innerWrapper, "fd-slider-active");
                callback("finalise")
            }
        };
        function tweenTo(tx) {
            kbEnabled = false;
            tweenX = parseInt(tx, 10);
            tweenB = parseInt(vertical ? handle.offsetTop : handle.offsetLeft, 10);
            tweenC = tweenX - tweenB;
            tweenD = 20;
            frame = 0;
            if (!timer) {
                timer = setTimeout(tween, 20)
            }
        }
        function checkValue(value) {
            if (isNaN(value) || value === "" || typeof value == "undefined") {
                userSet = false;
                return defaultVal
            } else {
                if (value < Math.min(rMin, rMax)) {
                    userSet = false;
                    return Math.min(rMin, rMax)
                } else {
                    if (value > Math.max(rMin, rMax)) {
                        userSet = false;
                        return Math.max(rMin, rMax)
                    }
                }
            }
            userSet = true;
            return value
        }
        function getWorkingValueFromInput() {
            return getValidValue(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex)
        }
        function getValidValue(value) {
            return (isNaN(value) || value === "" || typeof value == "undefined") ? defaultVal : Math.min(Math.max(value, Math.min(rMin, rMax)), Math.max(rMin, rMax))
        }
        function pixelsToValue(px) {
            var val = getValidValue(scale ? percentToValue(pixelsToPercent(px)) : vertical ? max - (Math.round(px / stepPx) * step) : min + (Math.round(px / stepPx) * step));
            handle.style[vertical ? "top" : "left"] = (px || 0) + "px";
            redrawRange();
            setInputValue((tagName == "select" || step == 1) ? Math.round(val) : val)
        }
        function valueToPixels(val, updateInputValue) {
            var clearVal = false, value;
            if ((typeof val === "undefined" || isNaN(val) || val === "") && tagName == "input" && !forceValue) {
                value = defaultVal;
                clearVal = true;
                userSet = false
            } else {
                value = checkValue(val)
            }
            handle.style[vertical ? "top" : "left"] = (scale ? percentToPixels(valueToPercent(value)) : vertical ? Math.round(((max - value) / step) * stepPx) : Math.round(((value - min) / step) * stepPx)) + "px";
            redrawRange();
            if (typeof updateInputValue !== false) {
                setInputValue(clearVal ? "" : value)
            }
        }
        function snapToPxValue(px) {
            if (scale) {
                return Math.max(Math.min(rMaxPx, px), rMinPx)
            } else {
                var rem = px % stepPx;
                if (rem && rem >= (stepPx / 2)) {
                    px += (stepPx - rem)
                } else {
                    px -= rem
                }
                if (px < Math.min(Math.abs(rMinPx), Math.abs(rMaxPx))) {
                    px = Math.min(Math.abs(rMinPx), Math.abs(rMaxPx))
                } else {
                    if (px > Math.max(Math.abs(rMinPx), Math.abs(rMaxPx))) {
                        px = Math.max(Math.abs(rMinPx), Math.abs(rMaxPx))
                    }
                }
                return Math.min(Math.max(px, 0), rMaxPx)
            }
        }
        function percentToValue(pct) {
            var st = 0, fr = min, value;
            for (var s in scale) {
                if (!scale.hasOwnProperty(s)) {
                    continue
                }
                if (pct >= st && pct <= +s) {
                    value = fr + ((pct - st) * (+scale[s] - fr)) / (+s - st)
                }
                st = +s;
                fr = +scale[s]
            }
            return value
        }
        function valueToPercent(value) {
            var st = 0
              , fr = min
              , pct = 0;
            for (var s in scale) {
                if (!scale.hasOwnProperty(s)) {
                    continue
                }
                if (value >= fr && value <= +scale[s]) {
                    pct = st + (value - fr) * (+s - st) / (+scale[s] - fr)
                }
                st = +s;
                fr = +scale[s]
            }
            return pct
        }
        function percentToPixels(percent) {
            return ((outerWrapper[vertical ? "offsetHeight" : "offsetWidth"] - handle[vertical ? "offsetHeight" : "offsetWidth"]) / 100) * percent
        }
        function pixelsToPercent(pixels) {
            return pixels / ((outerWrapper[vertical ? "offsetHeight" : "offsetWidth"] - outerWrapper[handle ? "offsetHeight" : "offsetWidth"]) / 100)
        }
        function setInputValue(val) {
            callback("update");
            if (!userSet) {
                addClass(innerWrapper, "fd-slider-no-value")
            } else {
                removeClass(innerWrapper, "fd-slider-no-value")
            }
            if (tagName == "select") {
                try {
                    val = parseInt(val, 10);
                    if (inp.selectedIndex === val) {
                        updateAriaValues();
                        return
                    }
                    inp.options[val].selected = true
                } catch (err) {}
            } else {
                if (val !== "" && !userInput) {
                    val = (min + (Math.round((val - min) / step) * step)).toFixed(precision)
                }
                if (inp.value === val) {
                    updateAriaValues();
                    return
                }
                inp.value = val
            }
            updateAriaValues();
            callback("change")
        }
        function checkInputValue(value) {
            return !(isNaN(value) || value === "" || value < Math.min(rMin, rMax) || value > Math.max(rMin, rMax))
        }
        function setSliderRange(newMin, newMax) {
            if (rMin > rMax) {
                newMin = Math.min(min, Math.max(newMin, newMax));
                newMax = Math.max(max, Math.min(newMin, newMax));
                rMin = Math.max(newMin, newMax);
                rMax = Math.min(newMin, newMax)
            } else {
                newMin = Math.max(min, Math.min(newMin, newMax));
                newMax = Math.min(max, Math.max(newMin, newMax));
                rMin = Math.min(newMin, newMax);
                rMax = Math.max(newMin, newMax)
            }
            if (defaultVal < Math.min(rMin, rMax)) {
                defaultVal = Math.min(rMin, rMax)
            } else {
                if (defaultVal > Math.max(rMin, rMax)) {
                    defaultVal = Math.max(rMin, rMax)
                }
            }
            handle.setAttribute("aria-valuemin", rMin);
            handle.setAttribute("aria-valuemax", rMax);
            checkValue(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex);
            redraw()
        }
        function redrawRange() {
            if (noRangeBar) {
                return
            }
            if (vertical) {
                rangeBar.style.height = Math.max(1, (bar.offsetHeight - handle.offsetTop)) + "px"
            } else {
                rangeBar.style.width = Math.max(1, handle.offsetLeft) + "px"
            }
        }
        function findLabel() {
            var label = false
              , labelList = document.getElementsByTagName("label");
            for (var i = 0, lbl; lbl = labelList[i]; i++) {
                if ((lbl.htmlFor && lbl.htmlFor == inp.id) || (lbl.getAttribute("for") == inp.id)) {
                    label = lbl;
                    break
                }
            }
            if (label && !label.id) {
                label.id = inp.id + "_label"
            }
            return label
        }
        function updateAriaValues() {
            var val = tagName == "select" ? inp.options[inp.selectedIndex].value : inp.value
              , valTxt = ariaFormat ? ariaFormat(val) : tagName == "select" ? (inp.options[inp.selectedIndex].text ? inp.options[inp.selectedIndex].text : val) : val;
            handle.setAttribute("aria-valuenow", val);
            handle.setAttribute("aria-valuetext", valTxt)
        }
        function onInputChange(e) {
            userSet = true;
            userInput = userSnap;
            valueToPixels(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex);
            updateAriaValues();
            userInput = false
        }
        function onReset(e) {
            if (tagName == "input") {
                inp.value = inp.defaultValue
            } else {
                inp.selectedIndex = resetDef
            }
            checkValue(tagName == "select" ? inp.options[inp.selectedIndex].value : inp.value);
            redraw();
            updateAriaValues()
        }
        function valueSet(tf) {
            userSet = !!tf
        }
        function setTabIndex(e, i) {
            e.setAttribute(!/*@cc_on!@*/
            false ? "tabIndex" : "tabindex", i);
            e.tabIndex = i
        }
        (function() {
            if (html5Shim || hideInput) {
                addClass(inp, "fd-form-element-hidden")
            } else {
                addEvent(inp, "change", onInputChange)
            }
            if (html5Shim) {
                inp.stepUp = function(n) {
                    increment(n || 1)
                }
                ;
                inp.stepDown = function(n) {
                    increment(n || -1)
                }
            }
            outerWrapper = document.createElement("span");
            outerWrapper.className = "fd-slider" + (vertical ? "-vertical " : " ") + classNames;
            outerWrapper.id = "fd-slider-" + inp.id;
            if (vertical && inpHeight) {
                outerWrapper.style.height = inpHeight + "px"
            }
            innerWrapper = document.createElement("span");
            innerWrapper.className = "fd-slider-wrapper" + (!html5Shim ? " fd-slider-no-value" : "");
            ieBlur = document.createElement("span");
            ieBlur.className = "fd-slider-inner";
            bar = document.createElement("span");
            bar.className = "fd-slider-bar";
            if (fullARIA) {
                handle = document.createElement("span")
            } else {
                handle = document.createElement("a");
                handle.setAttribute("href", "#");
                addEvent(handle, "click", stopEvent)
            }
            setTabIndex(handle, 0);
            handle.className = "fd-slider-handle";
            handle.appendChild(document.createTextNode(String.fromCharCode(160)));
            innerWrapper.appendChild(ieBlur);
            if (!noRangeBar) {
                rangeBar = document.createElement("span");
                rangeBar.className = "fd-slider-range";
                innerWrapper.appendChild(rangeBar)
            }
            innerWrapper.appendChild(bar);
            innerWrapper.appendChild(handle);
            outerWrapper.appendChild(innerWrapper);
            inp.parentNode.insertBefore(outerWrapper, inp);
            if (isOpera || /*@cc_on!@*/
            !true) {
                handle.unselectable = "on";
                bar.unselectable = "on";
                ieBlur.unselectable = "on";
                outerWrapper.unselectable = "on";
                innerWrapper.unselectable = "on";
                if (!noRangeBar) {
                    rangeBar.unselectable = "on"
                }
            }
            outerWrapper.setAttribute("role", "application");
            handle.setAttribute("role", "slider");
            handle.setAttribute("aria-valuemin", tagName == "select" ? inp.options[0].value : min);
            handle.setAttribute("aria-valuemax", tagName == "select" ? inp.options[inp.options.length - 1].value : max);
            var lbl = findLabel();
            if (lbl) {
                handle.setAttribute("aria-labelledby", lbl.id);
                handle.id = "fd-slider-handle-" + inp.id;
                /*@cc_on@*/
                /*@if(@_win32)
                lbl.setAttribute("htmlFor", handle.id);
                @else @*/
                lbl.setAttribute("for", handle.id);
                /*@end@*/
            }
            if (document.getElementById(describedBy)) {
                handle.setAttribute("aria-describedby", describedBy)
            }
            if (inp.getAttribute("disabled") == true || inp.getAttribute("disabled") == "disabled") {
                disableSlider(true)
            } else {
                enableSlider(true)
            }
            if (varSetRules.onvalue) {
                userSet = true;
                checkValue(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex)
            }
            if (inp.form) {
                addEvent(inp.form, "reset", onReset)
            }
            updateAriaValues();
            callback("create");
            redraw()
        })();
        return {
            onResize: function(e) {
                if (outerWrapper.offsetHeight != sliderH || outerWrapper.offsetWidth != sliderW) {
                    redraw()
                }
            },
            destroy: function() {
                destroySlider()
            },
            reset: function() {
                valueToPixels(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex)
            },
            stepUp: function(n) {
                increment(Math.abs(n) || 1)
            },
            stepDown: function(n) {
                increment(-Math.abs(n) || -1)
            },
            increment: function(n) {
                increment(n)
            },
            disable: function() {
                disableSlider()
            },
            enable: function() {
                enableSlider()
            },
            setRange: function(mi, mx) {
                setSliderRange(mi, mx)
            },
            getValueSet: function() {
                return !!userSet
            },
            setValueSet: function(tf) {
                valueSet(tf)
            },
            checkValue: function() {
                if (varSetRules.onvalue) {
                    userSet = true;
                    checkValue(tagName == "input" ? parseFloat(inp.value) : inp.selectedIndex)
                }
                updateAriaValues();
                redraw()
            }
        }
    }
    addEvent(window, "load", init);
    addEvent(window, "load", function() {
        setTimeout(function() {
            var slider;
            for (slider in sliders) {
                sliders[slider].checkValue()
            }
        }, 0)
    });
    addEvent(window, "resize", resize);
    addEvent(window, "unload", unload);
    (function() {
        var scriptFiles = document.getElementsByTagName("script")
          , scriptInner = String(scriptFiles[scriptFiles.length - 1].innerHTML).replace(/[\n\r\s\t]+/g, " ").replace(/^\s+/, "").replace(/\s+$/, "")
          , json = parseJSON(scriptInner);
        if (typeof json === "object" && !("err"in json)) {
            affectJSON(json)
        }
    })();
    /*@cc_on@*/
    /*@if (@_jscript_version < 9)
    addClass(document.documentElement, "oldie");
    /*@end@*/
    return {
        rescanDocument: init,
        createSlider: function(opts) {
            return createSlider(opts)
        },
        onDomReady: function() {
            onDomReady()
        },
        destroyAll: function() {
            destroyAllsliders()
        },
        destroySlider: function(id) {
            return destroySingleSlider(id)
        },
        redrawAll: function() {
            resize()
        },
        addEvent: addEvent,
        removeEvent: removeEvent,
        stopEvent: stopEvent,
        increment: function(id, numSteps) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].increment(numSteps)
        },
        stepUp: function(id, n) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].stepUp(Math.abs(n) || 1)
        },
        stepDown: function(id, n) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].stepDown(-Math.abs(n) || -1)
        },
        setRange: function(id, newMin, newMax) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].setRange(newMin, newMax)
        },
        updateSlider: function(id) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].onResize();
            sliders[id].reset()
        },
        disable: function(id) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].disable()
        },
        enable: function(id) {
            if (!sliderExists(id)) {
                return false
            }
            sliders[id].enable()
        },
        getValueSet: function() {
            return getValueSet()
        },
        setValueSet: function(a, tf) {
            if (!sliderExists(id)) {
                return false
            }
            setValueSet(a, tf)
        },
        setGlobalVariables: function(json) {
            affectJSON(json)
        },
        removeOnload: function() {
            removeOnLoadEvent()
        }
    }
})();
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:fd-slider', location = '/static/lib/fdslider-AMD.js' */
define("fd-slider", ["util/deprecation"], function(B) {
    var A = window.fdSlider.updateSlider;
    var C = window.fdSlider.onDomReady;
    B.obj(window.fdSlider, "fdSlider", null, "3.7", "4.0");
    window.fdSlider._deprecatedUpdateSlider = A;
    window.fdSlider._deprecatedOnDomReady = C;
    return window.fdSlider
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:resemblejs', location = '/static/bower/resemblejs/resemble.js' */
(function(G) {
    var I = 1;
    var H = {
        red: 255,
        green: 0,
        blue: 255,
        alpha: 255
    };
    function F(K, J) {
        return (Math.abs(K.r - J.r) + Math.abs(K.g - J.g) + Math.abs(K.b - J.b)) / 3
    }
    var E = {
        flat: function(K, J) {
            return {
                r: H.red,
                g: H.green,
                b: H.blue,
                a: H.alpha
            }
        },
        movement: function(K, J) {
            return {
                r: ((J.r * (H.red / 255)) + H.red) / 2,
                g: ((J.g * (H.green / 255)) + H.green) / 2,
                b: ((J.b * (H.blue / 255)) + H.blue) / 2,
                a: J.a
            }
        },
        flatDifferenceIntensity: function(K, J) {
            return {
                r: H.red,
                g: H.green,
                b: H.blue,
                a: F(K, J)
            }
        },
        movementDifferenceIntensity: function(L, K) {
            var J = F(L, K) / 255 * 0.8;
            return {
                r: ((1 - J) * (K.r * (H.red / 255)) + J * H.red),
                g: ((1 - J) * (K.g * (H.green / 255)) + J * H.green),
                b: ((1 - J) * (K.b * (H.blue / 255)) + J * H.blue),
                a: K.a
            }
        }
    };
    var A = E.flat;
    var C = 1200;
    var B = /^https?:\/\//;
    var D = new RegExp("^https?://" + document.domain);
    G.resemble = function(l) {
        var n = {};
        var W = [];
        var T = [];
        var f = {
            red: 16,
            green: 16,
            blue: 16,
            alpha: 16,
            minBrightness: 16,
            maxBrightness: 240
        };
        var Z = false;
        var Y = false;
        function O() {
            var o = T.length;
            var p;
            for (p = 0; p < o; p++) {
                if (typeof T[p] === "function") {
                    T[p](n)
                }
            }
        }
        function j(o, s, r) {
            var q, p;
            for (q = 0; q < o; q++) {
                for (p = 0; p < s; p++) {
                    r(q, p)
                }
            }
        }
        function b(s, v, q) {
            var p = 0;
            var r = 0;
            var u = 0;
            var t = 0;
            var o = 0;
            j(q, v, function(x, AC) {
                var AB = (x * v + AC) * 4;
                var AA = s[AB];
                var y = s[AB + 1];
                var w = s[AB + 2];
                var z = L(AA, y, w);
                p++;
                r += AA / 255 * 100;
                u += y / 255 * 100;
                t += w / 255 * 100;
                o += z / 255 * 100
            });
            n.red = Math.floor(r / p);
            n.green = Math.floor(u / p);
            n.blue = Math.floor(t / p);
            n.brightness = Math.floor(o / p);
            O()
        }
        function e(q, r) {
            var p;
            var o = new Image();
            if (B.test(q) && !D.test(q)) {
                o.setAttribute("crossorigin", "anonymous")
            }
            o.onload = function() {
                var u = document.createElement("canvas");
                var v;
                var t = o.width;
                var s = o.height;
                u.width = t;
                u.height = s;
                u.getContext("2d").drawImage(o, 0, 0, t, s);
                v = u.getContext("2d").getImageData(0, 0, t, s);
                W.push(v);
                r(v, t, s)
            }
            ;
            if (typeof q === "string") {
                o.src = q;
                if (o.complete) {
                    o.onload()
                }
            } else {
                if (typeof q.data !== "undefined" && typeof q.width === "number" && typeof q.height === "number") {
                    W.push(q);
                    r(q, q.width, q.height)
                } else {
                    p = new FileReader();
                    p.onload = function(s) {
                        o.src = s.target.result
                    }
                    ;
                    p.readAsDataURL(q)
                }
            }
        }
        function g(p, o, q) {
            var r = Math.abs(p - o);
            if (typeof p === "undefined") {
                return false
            }
            if (typeof o === "undefined") {
                return false
            }
            if (p === o) {
                return true
            } else {
                if (r < f[q]) {
                    return true
                } else {
                    return false
                }
            }
        }
        function X(o) {
            return !isNaN(parseFloat(o))
        }
        function c(p, o) {
            var r = g(p.a, o.a, "alpha");
            var q = g(p.brightness, o.brightness, "minBrightness");
            return q && r
        }
        function L(q, p, o) {
            return 0.3 * q + 0.59 * p + 0.11 * o
        }
        function k(r, p) {
            var s = r.r === p.r;
            var q = r.g === p.g;
            var o = r.b === p.b;
            return s && q && o
        }
        function V(r, p) {
            var t = g(r.r, p.r, "red");
            var q = g(r.g, p.g, "green");
            var o = g(r.b, p.b, "blue");
            var s = g(r.a, p.a, "alpha");
            return t && q && o && s
        }
        function S(p, o) {
            return Math.abs(p.brightness - o.brightness) > f.maxBrightness
        }
        function d(u, t, p) {
            u = u / 255;
            t = t / 255;
            p = p / 255;
            var o = Math.max(u, t, p)
              , q = Math.min(u, t, p);
            var s;
            var v;
            if (o == q) {
                s = 0
            } else {
                v = o - q;
                switch (o) {
                case u:
                    s = (t - p) / v + (t < p ? 6 : 0);
                    break;
                case t:
                    s = (p - u) / v + 2;
                    break;
                case p:
                    s = (u - t) / v + 4;
                    break
                }
                s /= 6
            }
            return s
        }
        function K(o, u, w, v, y, q) {
            var s;
            var z;
            var p = 1;
            var t;
            var r;
            var AB = 0;
            var AA = 0;
            var x = 0;
            h(o);
            for (t = p * -1; t <= p; t++) {
                for (r = p * -1; r <= p; r++) {
                    if (t === 0 && r === 0) {} else {
                        s = ((v + r) * q + (y + t)) * 4;
                        z = R(u, s, w);
                        if (z === null) {
                            continue
                        }
                        M(z);
                        h(z);
                        if (S(o, z)) {
                            AB++
                        }
                        if (k(o, z)) {
                            x++
                        }
                        if (Math.abs(z.h - o.h) > 0.3) {
                            AA++
                        }
                        if (AA > 1 || AB > 1) {
                            return true
                        }
                    }
                }
            }
            if (x < 2) {
                return true
            }
            return false
        }
        function i(p, r, o, s) {
            var q = A(o, s);
            p[r] = q.r;
            p[r + 1] = q.g;
            p[r + 2] = q.b;
            p[r + 3] = q.a
        }
        function a(o, q, p) {
            o[q] = p.r;
            o[q + 1] = p.g;
            o[q + 2] = p.b;
            o[q + 3] = p.a * I
        }
        function N(o, q, p) {
            o[q] = p.brightness;
            o[q + 1] = p.brightness;
            o[q + 2] = p.brightness;
            o[q + 3] = p.a * I
        }
        function R(u, w, q) {
            var t;
            var s;
            var o;
            var v;
            var p;
            t = u[w];
            if (typeof t !== "undefined") {
                s = u[w + 1];
                o = u[w + 2];
                p = u[w + 3];
                v = {
                    r: t,
                    g: s,
                    b: o,
                    a: p
                };
                return v
            } else {
                return null
            }
        }
        function M(o) {
            o.brightness = L(o.r, o.g, o.b)
        }
        function h(o) {
            o.h = d(o.r, o.g, o.b)
        }
        function J(v, u, q, AA) {
            var y = document.createElement("canvas");
            var w = v.data;
            var t = u.data;
            y.width = q;
            y.height = AA;
            var r = y.getContext("2d");
            var p = r.createImageData(q, AA);
            var x = p.data;
            var o = 0;
            var s = Date.now();
            var z;
            if (!!C && Z && (q > C || AA > C)) {
                z = 6
            }
            j(AA, q, function(AB, AF) {
                if (z) {
                    if (AB % z === 0 || AF % z === 0) {
                        return
                    }
                }
                var AD = (AB * q + AF) * 4;
                var AE = R(w, AD, 1);
                var AC = R(t, AD, 2);
                if (AE === null || AC === null) {
                    return
                }
                if (Y) {
                    M(AE);
                    M(AC);
                    if (c(AE, AC)) {
                        N(x, AD, AC)
                    } else {
                        i(x, AD, AE, AC);
                        o++
                    }
                    return
                }
                if (V(AE, AC)) {
                    a(x, AD, AE, AC)
                } else {
                    if (Z && (M(AE),
                    M(AC),
                    K(AE, w, 1, AB, AF, q) || K(AC, t, 2, AB, AF, q))) {
                        if (c(AE, AC)) {
                            N(x, AD, AC)
                        } else {
                            i(x, AD, AE, AC);
                            o++
                        }
                    } else {
                        i(x, AD, AE, AC);
                        o++
                    }
                }
            });
            n.misMatchPercentage = (o / (AA * q) * 100).toFixed(2);
            n.analysisTime = Date.now() - s;
            n.getImageDataUrl = function(AC) {
                var AB = 0;
                if (AC) {
                    AB = Q(AC, r, y)
                }
                r.putImageData(p, 0, AB);
                return y.toDataURL("image/png")
            }
        }
        function Q(t, o, s) {
            var q = 2;
            o.font = "12px sans-serif";
            var r = o.measureText(t).width + q * 2;
            var p = 22;
            if (r > s.width) {
                s.width = r
            }
            s.height += p;
            o.fillStyle = "#666";
            o.fillRect(0, 0, s.width, p - 4);
            o.fillStyle = "#fff";
            o.fillRect(0, p - 4, s.width, 4);
            o.fillStyle = "#fff";
            o.textBaseline = "top";
            o.font = "12px sans-serif";
            o.fillText(t, q, 1);
            return p
        }
        function P(p, o, r) {
            var s;
            var q;
            if (p.height < r || p.width < o) {
                s = document.createElement("canvas");
                s.width = o;
                s.height = r;
                q = s.getContext("2d");
                q.putImageData(p, 0, 0);
                return q.getImageData(0, 0, o, r)
            }
            return p
        }
        function m(p, o) {
            function q() {
                var s;
                var r;
                if (W.length === 2) {
                    s = W[0].width > W[1].width ? W[0].width : W[1].width;
                    r = W[0].height > W[1].height ? W[0].height : W[1].height;
                    if ((W[0].width === W[1].width) && (W[0].height === W[1].height)) {
                        n.isSameDimensions = true
                    } else {
                        n.isSameDimensions = false
                    }
                    n.dimensionDifference = {
                        width: W[0].width - W[1].width,
                        height: W[0].height - W[1].height
                    };
                    J(P(W[0], s, r), P(W[1], s, r), s, r);
                    O()
                }
            }
            W = [];
            e(p, q);
            e(o, q)
        }
        function U(r) {
            var q, p = typeof r === "function";
            if (!p) {
                q = r
            }
            var o = {
                ignoreNothing: function() {
                    f.red = 16;
                    f.green = 16;
                    f.blue = 16;
                    f.alpha = 16;
                    f.minBrightness = 16;
                    f.maxBrightness = 240;
                    Z = false;
                    Y = false;
                    if (p) {
                        r()
                    }
                    return o
                },
                ignoreAntialiasing: function() {
                    f.red = 32;
                    f.green = 32;
                    f.blue = 32;
                    f.alpha = 32;
                    f.minBrightness = 64;
                    f.maxBrightness = 96;
                    Z = true;
                    Y = false;
                    if (p) {
                        r()
                    }
                    return o
                },
                ignoreColors: function() {
                    f.alpha = 16;
                    f.minBrightness = 16;
                    f.maxBrightness = 240;
                    Z = false;
                    Y = true;
                    if (p) {
                        r()
                    }
                    return o
                },
                repaint: function() {
                    if (p) {
                        r()
                    }
                    return o
                },
                onComplete: function(t) {
                    T.push(t);
                    var s = function() {
                        m(l, q)
                    };
                    s();
                    return U(s)
                }
            };
            return o
        }
        return {
            onComplete: function(o) {
                T.push(o);
                e(l, function(r, q, p) {
                    b(r.data, q, p)
                })
            },
            compareTo: function(o) {
                return U(o)
            }
        }
    }
    ;
    G.resemble.outputSettings = function(J) {
        var K;
        var L;
        if (J.errorColor) {
            for (K in J.errorColor) {
                H[K] = J.errorColor[K] === L ? H[K] : J.errorColor[K]
            }
        }
        if (J.errorType && E[J.errorType]) {
            A = E[J.errorType]
        }
        I = isNaN(Number(J.transparency)) ? I : J.transparency;
        if (J.largeImageThreshold !== L) {
            C = J.largeImageThreshold
        }
        return this
    }
}(this));
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:resemblejs', location = '/static/lib/resemblejs/resemble-AMD.js' */
define("resemble", function() {
    return resemble
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:image-differ', location = '/static/bower/image-differ/lib/image-differ.js' */
define("image-differ", ["eevee", "fd-slider", "imagesloaded", "jquery", "resemble"], function(K, C, E, D, H) {
    function B(L) {
        this._$container = L
    }
    B.modes = {
        TWO_UP: "two-up",
        BLEND: "blend",
        SPLIT: "split",
        PIXEL_DIFF: "pixeldiff"
    };
    Object.freeze && Object.freeze(B.modes);
    B.prototype.init = function() {
        var M = this;
        var O;
        var L;
        var N = this._$imgs = this._$container.find("img");
        this._$sinceImg = N.eq(0);
        this._$untilImg = N.eq(1);
        this._$untilRevision = this._$untilImg.parent();
        this._$sinceRevision = this._$sinceImg.parent();
        this._$revisions = this._$untilRevision.add(this._$sinceRevision);
        this._$untilRevisionLabel = M._$untilRevision.find("h5");
        this._$sinceRevisionLabel = M._$sinceRevision.find("h5");
        M.setMode(B.modes.TWO_UP);
        var P = D.Deferred();
        N.imagesLoaded().always(function() {
            var Q = A(M._$sinceImg).done(function(S) {
                O = S
            });
            var R = A(M._$untilImg).done(function(S) {
                L = S
            });
            D.when(Q, R).done(function() {
                var T = (O.width === L.width) && (O.height === L.height);
                var S = T && O.width > 0;
                P.resolve(S)
            }).fail(function() {
                P.reject()
            })
        });
        return P
    }
    ;
    B.prototype.destroy = function() {
        this._cleanOldMode(this._mode);
        this._mode = null
    }
    ;
    B.prototype.setMode = function(L) {
        if (this._mode !== L) {
            this._onDiffModeChanged(L, this._mode);
            this._mode = L
        }
    }
    ;
    function I(M, L) {
        M.onchange = L;
        M.oninput = L
    }
    function F(L) {
        L.onchange = null;
        L.oninput = null
    }
    function A(M) {
        if (M.data("natural-size")) {
            return D.Deferred().resolve(M.data("natural-size"))
        }
        if (M[0].naturalWidth) {
            var L = {
                width: M[0].naturalWidth,
                height: M[0].naturalHeight
            };
            M.data("natural-size", L);
            return D.Deferred().resolve(L)
        }
        var O = new Image()
          , Q = D.Deferred()
          , N = false
          , P = function() {
            if (!N) {
                var R = {
                    width: O.width,
                    height: O.height
                };
                M.data("natural-size", R);
                Q.resolve(R);
                N = true
            }
        };
        O.onload = P;
        O.src = M[0].src;
        if (O.complete) {
            P()
        }
        return Q
    }
    B.prototype._cleanOldMode = function(L) {
        switch (L) {
        case B.modes.TWO_UP:
            this._cleanTwoUpDiff();
            break;
        case B.modes.BLEND:
            this._cleanBlendDiff();
            break;
        case B.modes.SPLIT:
            this._cleanSplitDiff();
            break;
        case B.modes.PIXEL_DIFF:
            this._cleanPixelDiff();
            break
        }
    }
    ;
    B.prototype._onDiffModeChanged = function(M, L) {
        this._$container.removeClass("two-up blend split pixeldiff").addClass(M);
        this._cleanOldMode(L);
        switch (M) {
        case B.modes.TWO_UP:
            this._setupTwoUpDiff();
            break;
        case B.modes.BLEND:
            this._setupBlendDiff();
            break;
        case B.modes.SPLIT:
            this._setupSplitDiff();
            break;
        case B.modes.PIXEL_DIFF:
            this._setupPixelDiff();
            break
        }
        K.trigger("imageDiffer.modeChanged", null, M, L)
    }
    ;
    B.prototype._cleanTwoUpDiff = D.noop;
    B.prototype._setupTwoUpDiff = D.noop;
    B.prototype._cleanBlendDiff = function() {
        var L = this._$container.children(".opacity-slider-container");
        var M = L.find("input");
        L.remove();
        this._$untilImg.css("opacity", "");
        F(M[0])
    }
    ;
    B.prototype._setupBlendDiff = function() {
        var L = this;
        var M = D('<input type="range" min="0" max="1" step="0.01" value="1" />');
        this._$container.children(".image-diff-toolbar").after(D('<div class="opacity-slider-container" />').append(M));
        if (C._deprecatedOnDomReady) {
            C._deprecatedOnDomReady()
        } else {
            C.onDomReady()
        }
        I(M[0], function() {
            L._$untilImg.css("opacity", parseFloat(D(this).val()))
        })
    }
    ;
    B.prototype._cleanSplitDiff = function() {
        this._$imgs.css("width", "").css("height", "");
        this._$revisions.css("width", "");
        this._$untilRevision.css("margin-left", "");
        this._$untilRevisionLabel.add(this._$sinceRevisionLabel).css("margin-left", "").css("margin-right", "");
        this._$untilImg.unwrap();
        this._$untilRevisionImageContainer.remove();
        delete this._$untilRevisionImageContainer;
        this._$revisions.unwrap();
        this._$splitContainer.remove();
        delete this._$splitContainer;
        if (this._onResize) {
            K.off("window.resize.debounced", this._onResize);
            delete this._onResize
        }
    }
    ;
    function J(L, M) {
        var N = L.data("margin_border_padding");
        if (N == null) {
            N = L.outerWidth(true) - L.width();
            L.data("margin_border_padding", N)
        }
        return M - N
    }
    B.prototype._setSplitDiffElementProperties = function(T, N, L) {
        var P = J(this._$container, this._$container.parent().width());
        var M = J(N, P);
        var O = J(this._$sinceRevision, M);
        var R = J(this._$sinceImg, O);
        var Q = Math.min(L.width, R);
        this._$imgs.width(Q);
        this._$imgs.height(Math.floor((Q / L.width) * L.height));
        T.height(this._$imgs.outerHeight(true));
        var S = Q + (O - R);
        this._$revisions.width(S);
        this._$untilRevision.css("margin-left", -S)
    }
    ;
    B.prototype._setupSplitDiff = function() {
        var L = this;
        return A(this._$imgs).done(function(N) {
            L._$untilImg.wrap('<div class="image-container" />');
            L._$revisions.wrapAll('<div class="split-container" />');
            L._$untilRevisionImageContainer = L._$untilImg.parent();
            L._$splitContainer = L._$container.find(".split-container");
            var M;
            L._onResize = function() {
                L._setSplitDiffElementProperties(L._$untilRevisionImageContainer, L._$splitContainer, N);
                M = L._$sinceImg.outerWidth(true)
            }
            ;
            L._onResize();
            K.on("window.resize.debounced", L._onResize);
            if (N.width < 50) {
                L._$untilRevisionLabel.css("margin-left", "-50px");
                L._$sinceRevisionLabel.css("margin-right", "-50px")
            } else {
                if (N.width < 100) {
                    L._$untilRevisionLabel.css("margin-left", -N.width);
                    L._$sinceRevisionLabel.css("margin-right", -N.width)
                }
            }
            var O;
            L._$splitContainer.on("mouseenter", function() {
                O = L._$untilRevision.offset();
                L._$revisions.on("mousemove", P)
            });
            L._$splitContainer.on("mouseleave", function() {
                L._$revisions.off("mousemove", P)
            });
            var P = function(Q) {
                L._$untilRevisionImageContainer.css("width", Math.min(Q.pageX - O.left, M))
            }
        })
    }
    ;
    B.prototype._cleanPixelDiff = function() {
        if (this._$pixelDiffImg) {
            this._$pixelDiffImg.remove()
        }
        this._$revisions.unwrap();
        this._$pixelDiffContainer.remove();
        delete this._$pixelDiffContainer
    }
    ;
    B.prototype._setupPixelDiff = function() {
        var L = this;
        L._$revisions.wrapAll('<div class="pixeldiff-container" />');
        L._$pixelDiffContainer = L._$container.find(".pixeldiff-container");
        if (L._$pixelDiffImg) {
            L._$pixelDiffContainer.append(L._$pixelDiffImg);
            return
        }
        var M = D("<div class='spinner' />");
        L._$pixelDiffContainer.append(M);
        M.spin("large");
        _.defer(function() {
            var N = G(L._$sinceImg);
            var O = G(L._$untilImg);
            D.when(N, O).done(function(P, Q) {
                H.outputSettings({
                    errorColor: {
                        red: 208,
                        green: 68,
                        blue: 55
                    },
                    errorType: "flat",
                    transparency: 0.1
                });
                H(P).compareTo(Q).onComplete(function(R) {
                    M.remove();
                    L._$pixelDiffImg = D("<div />").addClass("pixeldiff binary").append(D("<img />").attr("src", R.getImageDataUrl()));
                    L._$pixelDiffContainer.append(L._$pixelDiffImg)
                })
            }).fail(function() {
                M.remove()
            })
        })
    }
    ;
    function G(N) {
        var M = document.createElement("canvas");
        var L = M.getContext("2d");
        return A(N).then(function(O) {
            M.height = O.height;
            M.width = O.width;
            L.drawImage(N[0], 0, 0);
            return L.getImageData(0, 0, M.width, M.height)
        })
    }
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:binary-diff-view', location = '/static/feature/file-content/binary-diff-view/binary-diff-view.js' */
define("feature/file-content/binary-diff-view", ["aui", "image-diff-toolbar", "image-differ", "jquery", "util/deprecation", "util/events", "model/file-change", "feature/file-content/binary-view"], function(I, D, B, E, H, J, F, C) {
    function G(L, K) {
        this._init(L, K)
    }
    G.prototype.isDiffingImages = function() {
        return this._isDiffingImages
    }
    ;
    G.prototype._init = function(Q, N) {
        var K = new F(N.fileChange).getCommitRange();
        var M = K.getUntilRevision();
        var O = K.getSinceRevision();
        this._$container = E(stash.feature.fileContent.binaryView.container()).appendTo(N.$container);
        var L = A(Q.source, O);
        var R = A(Q.destination, M);
        this._renderBinaryDiff(L, R).done(function() {
            N.$container.addClass("fully-loaded")
        });
        var P = {
            containerEl: this._$container.get(0),
            sourcePath: Q.source,
            sourceType: L && L.type,
            sinceRevision: O && O.toJSON(),
            destinationPath: Q.destination,
            destinationType: R && R.type,
            untilRevision: M && M.toJSON()
        };
        H.triggerDeprecated("stash.feature.fileContent.onBinaryDiffShown", null, P, "stash.feature.fileContent.binaryDiffShown", "3.3", "4.0");
        J.trigger("stash.feature.fileContent.binaryDiffShown", null, P);
        J.on("imageDiffer.modeChanged", function(T, S) {
            H.triggerDeprecated("stash.feature.fileContent.imageDiffer.modeChanged", null, T, S, "imageDiffer.modeChanged", "3.4", "4.0")
        })
    }
    ;
    function A(L, K) {
        if (L && K) {
            return C.getRenderedBinary(L, K.getId())
        }
    }
    G.prototype._renderBinaryDiff = function(L, M) {
        var N = this._isDiffingImages = L && M && L.type === M.type && L.type === "image";
        if (N) {
            this._toolbar = new D(E(imageDiffer.imageDiffToolbar.main()).appendTo(this._$container));
            this._differ = new B(this._$container)
        }
        if (L) {
            E(stash.feature.fileContent.binaryView.cell({
                extraClasses: "since-revision",
                titleText: "Old"
            })).append(L.$elem).appendTo(this._$container)
        }
        if (M) {
            E(stash.feature.fileContent.binaryView.cell({
                extraClasses: "until-revision",
                titleText: "New"
            })).append(M.$elem).appendTo(this._$container)
        }
        if (N) {
            var K = this;
            this._toolbar.on("modeChanged", function(O) {
                K._differ.setMode(O)
            });
            return this._differ.init().done(function(O) {
                if (K._toolbar) {
                    K._toolbar.init(O)
                }
            })
        }
        return E.Deferred().resolve()
    }
    ;
    G.prototype.destroy = function() {
        if (this._toolbar) {
            this._toolbar.destroy();
            this._toolbar = null
        }
        if (this._differ) {
            this._differ.destroy();
            this._differ = null
        }
        if (this._$container) {
            this._$container.remove();
            this._$container = null
        }
    }
    ;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-line-info', location = '/static/feature/file-content/diff-line-info.js' */
define("feature/file-content/diff-line-info", ["lodash", "util/deprecation", "feature/file-content/diff-view-segment-types", "exports"], function(D, H, G, C) {
    var B = {
        ADDED: "destination",
        REMOVED: "source",
        CONTEXT: "source"
    };
    function A(O, I, J, M, L, N, K) {
        this.lineType = O;
        this.lineNumber = I;
        this.line = J;
        this.segment = M;
        this.hunk = L;
        this.diff = N;
        this.handles = {
            FROM: null,
            TO: null,
            all: []
        };
        this.attributes = K
    }
    A.prototype._setHandle = function(I, J) {
        this.handles[I] = J;
        this.handles.all.push(J);
        this.handles.all = D.uniq(this.handles.all)
    }
    ;
    function E(N, L, K, I) {
        var M = N[K - 1];
        var O = N[K + 1];
        if (L.type !== G.CONTEXT) {
            return null
        }
        var P = 0;
        var J = L.lines.length;
        if (M && (M.type === G.ADDED || M.type === G.REMOVED)) {
            P = I
        }
        if (O && (O.type === G.ADDED || O.type === G.REMOVED)) {
            J = J - I
        }
        if (J > P) {
            return {
                start: P - 1,
                end: J
            }
        }
        return null
    }
    function F(J, I) {
        return D.chain(J.hunks).map(function(K) {
            return D.map(K.segments, function(N, M) {
                var L = E(K.segments, N, M, I.relevantContextLines);
                return {
                    hunk: K,
                    segment: N,
                    expandedRange: L
                }
            })
        }).flatten().map(function(L) {
            var K = L.segment;
            return D.map(K.lines, function(N, P) {
                var Q = K.type;
                var M = N[B[K.type]];
                N.lineType = Q;
                N.lineNumber = M;
                H.prop(N, "lineType", "info.line.lineType", "info.lineType", "3.4", "4.0");
                H.prop(N, "lineNumber", "info.line.lineNumber", "info.lineNumber", "3.4", "4.0");
                var O = {
                    expanded: L.expandedRange && P < L.expandedRange.end && P > L.expandedRange.start
                };
                return new A(Q,M,N,K,L.hunk,J,O)
            })
        }).flatten().value()
    }
    C.convertToLineInfos = F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:array-util', location = '/static/util/array.js' */
define("util/array", ["lodash", "util/function", "exports"], function(D, F, A) {
    function C(G) {
        return function(I) {
            for (var H = 0; H < I.length; H++) {
                if (G(I[H], H, I)) {
                    return H
                }
            }
            return -1
        }
    }
    function E(G) {
        return function(I) {
            var H = C(G)(I);
            return H === -1 ? [] : I.slice(H)
        }
    }
    function B(G) {
        return function(I) {
            var H = C(G)(I);
            return H === -1 ? I : I.slice(0, H)
        }
    }
    A.findIndex = C;
    A.skipUntil = E;
    A.skipWhile = D.compose(E, F.not);
    A.takeUntil = B;
    A.takeWhile = D.compose(B, F.not)
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:object-util', location = '/static/util/object.js' */
define("util/object", ["lodash", "exports"], function(F, D) {
    function C(G) {
        return G
    }
    var E = Object.prototype.hasOwnProperty;
    function B(G) {
        if (typeof G === "object") {
            return JSON.stringify(G)
        } else {
            return String(G)
        }
    }
    D.uniqueFromArray = function(M, J, H) {
        var G;
        var I;
        var L = J.length;
        var K = H ? B : C;
        return F.uniq(M, function(N) {
            for (G = 0,
            I = ""; G < L; G++) {
                I += K(N[J[G]])
            }
            return I
        })
    }
    ;
    D.freeze = Object.freeze || C;
    D.deepFreeze = !Object.freeze ? C : function A(J, G) {
        if (J !== null && typeof J === "object") {
            var I = Object.isFrozen(J);
            if (!I) {
                Object.freeze(J)
            }
            if (!I || G) {
                for (var H in J) {
                    if (E.call(J, H)) {
                        A(J[H])
                    }
                }
            }
        }
        return J
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:mixin-util', location = '/static/util/mixin.js' */
define("util/mixin", ["lodash"], function(A) {
    function B() {
        var C = [].slice.call(arguments);
        return {
            into: function(D) {
                return A.extend.apply(A, [D].concat(C))
            }
        }
    }
    return B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:widget-util', location = '/static/util/widget.js' */
define("util/widget", ["lodash", "util/mixin"], function(C, E) {
    function B(H, G) {
        if (!H._listeners) {
            H._listeners = {}
        }
        if (!H._listeners[G]) {
            H._listeners[G] = []
        }
        return H._listeners[G]
    }
    var D = {
        on: function(G, I) {
            var H = B(this, G);
            if (!C.contains(H, I)) {
                H.push(I)
            }
            return this
        },
        off: function(G, J) {
            var I = B(this, G);
            var H = I.length;
            while (H--) {
                if (I[H] === J || I[H]._handler === J) {
                    I.splice(H, 1)
                }
            }
            return this
        },
        once: function(H, I) {
            var G = this.off.bind(this, H, I);
            G._handler = I;
            this.on(H, I);
            this.on(H, G);
            return this
        },
        trigger: function(H) {
            var J = B(this, H).slice();
            var I = [].slice.call(arguments, 1);
            var G = this;
            J.forEach(function(K) {
                try {
                    K.apply(G, I)
                } catch (L) {
                    C.defer(function() {
                        throw L
                    })
                }
            });
            return this
        }
    };
    var A = {
        _init: function(G, H) {
            C.bindAll.apply(C, [this].concat(C.functions(this)));
            this._options = C.extend({}, H || this.constructor && this.constructor.defaults, G);
            return this
        },
        _addDestroyable: function(G) {
            if (!this._destroyables) {
                this._destroyables = []
            }
            if (C.isFunction(G)) {
                G = {
                    destroy: G
                }
            }
            if (!G.destroy) {
                throw new Error("Argument is not destroyable")
            }
            this._destroyables.push(G);
            return this
        },
        destroy: function() {
            if (this._destroyables) {
                C.invoke(this._destroyables, "destroy");
                this._destroyables = null
            }
            if (this.trigger) {
                this.trigger("destroy")
            }
            if (this._listeners) {
                this._listeners = null
            }
        }
    };
    var F = E(D, A).into({});
    return {
        mixInto: E(F).into
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/common-modes.js' */
(function(A) {
    if (typeof exports === "object" && typeof module === "object") {
        exports.commonModes = A()
    } else {
        define("feature/file-content/text-view/common-modes", [], A)
    }
})(function() {
    return ["clike", "commonlisp", "css", "htmlmixed", "javascript", "markdown", "perl", "php", "python", "ruby", "sass", "shell", "sql", "vbscript", "xml", "yaml"]
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/text-view.js' */
define("feature/file-content/text-view", ["jquery", "lodash", "util/determine-language", "util/events", "util/function", "util/object", "util/performance", "util/widget", "feature/file-content/stash-codemirror", "feature/file-content/text-view/common-modes", "feature/file-content/text-view/text-view-api", "feature/file-content/text-view/text-view-scrolling"], function(E, N, J, O, L, D, K, F, B, C, M, H) {
    function G(R, Q) {
        var P = this;
        M.setupAPI(this);
        this._init(Q);
        this._internalLines = {
            ADDED: {},
            REMOVED: {},
            CONTEXT: {}
        };
        this._editors = [];
        this._gutters = [];
        this._$container = R;
        this._$fileToolbar = this._$container.siblings(".file-toolbar");
        this._$container.addClass("text-view");
        this.registerGutter("CodeMirror-linewidget", {
            weight: 0
        });
        this._addDestroyable(function() {
            P._$container.removeClass("text-view");
            P._editors.forEach(function(S) {
                E(S.getWrapperElement()).remove()
            });
            P._editors = null;
            P._gutters = null;
            P._$container = null
        })
    }
    F.mixInto(G.prototype);
    M.mixInto(G.prototype);
    H.mixInto(G.prototype);
    G.defaults = {
        focusPoint: 0.2
    };
    G.prototype.init = function() {
        O.trigger("stash.feature.fileContent.textViewInitializing", null, this._api, this._options)
    }
    ;
    function I(Q) {
        var P = Q.view;
        Q.eachLine(function(R) {
            R.handles.all.forEach(function(S) {
                P.addLineClass(S, "wrap", "line")
            })
        })
    }
    G.prototype.markText = function(P, T, S, R) {
        var Q = this;
        return P.handles.all.map(function(U) {
            var V = Q._editorForHandle(U);
            var W = V.getLineNumber(U._handle);
            return V.markText({
                line: W + T.lineOffset,
                ch: T.ch
            }, {
                line: W + S.lineOffset,
                ch: S.ch
            }, {
                className: R.className
            })
        })
    }
    ;
    G.prototype.refresh = function() {
        N.invoke(this._editors, "refresh");
        this.trigger("resize")
    }
    ;
    G.prototype._createEditor = function(P, R) {
        P = P || {};
        var Q = new B(R && R.length ? R[0] : this._$container[0],E.extend({}, P, {
            autoResizing: this._options.autoResizing,
            gutters: this._getGutters(P.gutterFilter),
            value: ""
        }));
        Q._gutterFilter = P.gutterFilter;
        this._editors.push(Q);
        if (!this._$firstEditor) {
            this._$firstEditor = E(Q.getWrapperElement())
        }
        return Q
    }
    ;
    G.prototype._editorForHandle = function(P) {
        throw new Error("TextView implementation must define _editorForHandle.")
    }
    ;
    G.prototype._editorInnerOffset = function A() {
        return this._$firstEditor[0].getBoundingClientRect().top - this._$container[0].getBoundingClientRect().top
    }
    ;
    G.prototype._getChangeAttributes = function() {
        return {}
    }
    ;
    G.prototype._getGutters = function(Q) {
        var P = this._gutters;
        if (Q) {
            P = P.filter(Q)
        }
        P = P.sort(function(S, R) {
            return S.weight - R.weight
        });
        return N.chain(P).pluck("name").uniq().value()
    }
    ;
    G.prototype._modify = function(P, T, Q) {
        var R = this;
        var S = [].slice.call(arguments);
        N.forEach(Q, function(U) {
            R._internalLines[U.lineType || "CONTEXT"][U.lineNumber] = U
        });
        this.operation(function() {
            R._acceptModification.apply(R, S);
            R.trigger("internal.acceptedModification", S);
            var U = E.extend({
                type: P,
                linesAdded: Q.length,
                eachLine: function(W) {
                    var X;
                    if (!R._options.asyncDiffModifications) {
                        X = function(Y) {
                            var Z = E.Deferred();
                            Z.resolve(Y.map(W));
                            return Z
                        }
                    } else {
                        X = K.frameBatchedMap(W, {
                            min: 500,
                            initial: 200
                        }, R.operation.bind(R))
                    }
                    var V = X(Q);
                    R._addDestroyable(V.reject.bind(V));
                    return V.promise()
                },
                view: R._api
            }, R._getChangeAttributes.apply(R, S));
            N.chain(Q).pluck("handles").values().flatten().compact().forEach(D.freeze).value();
            N.chain(Q).pluck("handle").compact().forEach(D.freeze).value();
            N.chain(Q).pluck("line").compact().forEach(D.freeze).value();
            D.deepFreeze(Q, !"refreezeFrozen");
            D.deepFreeze(U, !"refreezeFrozen");
            I(U);
            if (P === "INITIAL") {
                R.trigger("internal-load", U)
            }
            R.trigger("internal-change", U);
            R.trigger("resize")
        })
    }
    ;
    G.prototype._highlight = function(P) {
        if (!this._editors) {
            return
        }
        this._editors.forEach(function(Q) {
            Q._highlight(P)
        })
    }
    ;
    G.prototype._syntaxHighlighting = function(P, Q, S) {
        var T = J.fromFileInfo({
            firstLine: Q,
            path: P
        });
        var R;
        if (T.wrmKey) {
            R = WRM.require("wr!" + T.wrmKey)
        } else {
            if (T.builtIn && C.indexOf(T.mode) === -1) {
                R = WRM.require("wr!com.atlassian.stash.stash-highlight-plugin:" + T.mode)
            } else {
                R = E.Deferred().resolve()
            }
        }
        R.done(function() {
            S.setOption("mode", T.mime)
        })
    }
    ;
    G.prototype._whenOpDone = function(P) {
        if (this._opCallbacks) {
            this._opCallbacks.push(P)
        } else {
            P()
        }
    }
    ;
    return G
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/text-view-api.js' */
define("feature/file-content/text-view/text-view-api", ["jquery", "lodash", "util/array", "util/function", "util/mixin", "util/object", "exports"], function(E, K, I, J, L, D, B) {
    function F(M) {
        E(M).addClass("stash-gutter-marker");
        return M
    }
    var H = {
        addLineClass: function(M, N, O) {
            this._editorForHandle(M).addLineClass(M._handle, N, O);
            return M
        },
        addLineWidget: function(M, P, O) {
            var Q = this._editorForHandle(M).addLineWidget(M._handle, P, O);
            var N = this;
            N.trigger("widgetAdded");
            return {
                clear: function() {
                    Q.off("redraw");
                    Q.clear();
                    N.trigger("widgetCleared")
                },
                changed: function() {
                    Q.changed();
                    N.trigger("widgetChanged")
                },
                onRedraw: function(R) {
                    Q.on("redraw", R)
                },
                getHeight: function() {
                    return Q.height
                }
            }
        },
        getLine: function(M) {
            return M._handle.text
        },
        getLineHandle: function(M) {
            if (M && M.lineNumber == null) {
                var O = E(M);
                if (!O.is(".line-locator")) {
                    O = O.closest(".line").find(".line-locator")
                }
                M = {
                    fileType: O.attr("data-file-type"),
                    lineType: O.attr("data-line-type"),
                    lineNumber: O.attr("data-line-number")
                }
            }
            var N = M && this._internalLines[M.lineType || "CONTEXT"][M.lineNumber] && this._internalLines[M.lineType || "CONTEXT"][M.lineNumber].handles;
            return N && (N[M.fileType] || N.all[0])
        },
        operation: function(M) {
            if (!this._editors) {
                return
            }
            var O = this._editors.reduce(function(Q, P) {
                return P.operation.bind(P, Q)
            }, J.arity(M.bind(null), 0));
            try {
                if (!this._inOp) {
                    this._opCallbacks = [];
                    this._inOp = 0
                }
                this._inOp++;
                return O()
            } finally {
                this._inOp--;
                if (!this._inOp) {
                    try {
                        J.applyAll(this._opCallbacks)
                    } catch (N) {
                        setTimeout(function() {
                            throw N
                        }, 0)
                    }
                    this._opCallbacks = null
                }
            }
        },
        registerGutter: function(O, N) {
            N = N || {};
            if (!this._editors) {
                return
            }
            var P = {
                name: O,
                weight: N.weight || 0,
                fileType: N.fileType
            };
            this._gutters.push(P);
            this._gutters = D.uniqueFromArray(this._gutters, ["name", "fileType"]).sort(function(R, Q) {
                return R.weight - Q.weight || R.name.localeCompare(Q.name)
            });
            var M = this;
            this._editors.forEach(function(Q) {
                var R = M._getGutters(Q._gutterFilter);
                if (!K.isEqual(Q.getOption("gutters"), R)) {
                    Q.setOption("gutters", R)
                }
            })
        },
        removeLineClass: function(M, N, O) {
            this._editorForHandle(M).removeLineClass(M._handle, N, O);
            return M
        },
        setGutterMarker: function(M, O, N) {
            this._editorForHandle(M).setGutterMarker(M._handle, O, F(N));
            return M
        },
        addContainerClass: function(M) {
            this._$container.addClass(M);
            this.refresh()
        },
        removeContainerClass: function(M) {
            this._$container.removeClass(M);
            this.refresh()
        }
    };
    var A = Object.keys(H);
    var G = {
        destroy: 0,
        load: 1,
        change: 1
    };
    function C(N) {
        var P = {};
        N._api = {};
        var O = {
            on: function(R, S) {
                if (K.has(G, R)) {
                    if (!P[R]) {
                        P[R] = []
                    }
                    var Q = J.arity(S.bind(N._api), G[R]);
                    P[R].push({
                        f: S,
                        wrappedF: Q
                    });
                    N.on(R, Q)
                }
            },
            off: function(Q, S) {
                if (P[Q]) {
                    var R = I.findIndex(J.dotEq("f", S))(P[Q] || []);
                    if (R !== -1) {
                        N.off(Q, P[Q][R].wrappedF);
                        P[Q].splice(R, 1)
                    }
                }
            }
        };
        var M = [N].concat(A);
        K.bindAll.apply(K, M);
        K.extend(N._api, O, K.pick.apply(K, M))
    }
    B.setupAPI = C;
    B.mixInto = L(H).into
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/request-window-scrolls.js' */
define("feature/file-content/text-view/request-window-scrolls", ["bacon", "jquery", "lodash", "util/bacon", "util/performance", "util/region-scroll-forwarder", "util/request-page-scrolling", "util/scroll"], function(B, C, H, I, G, E, A, D) {
    function F(K, J) {
        return A().done(function(W) {
            var M = new B.Bus();
            var a = K._$container.addClass("full-window-scrolling");
            var N = a.closest(".file-content");
            var S;
            var Z = D.fakeScroll(a[0]);
            var Q = ["stash.feature.sidebar.expandEnd", "stash.feature.sidebar.collapseEnd", "stash.feature.changeset.difftree.collapseAnimationFinished", "internal.stash.layout.body.resize"];
            var P = B.mergeAll(Q.map(I.events).concat(I.getWindowSizeProperty().toEventStream()));
            var R = P.toProperty();
            function V(b) {
                return b && b.hasOwnProperty("width") && b.hasOwnProperty("height")
            }
            K._addDestroyable(W);
            K._addDestroyable(R.scan(0, function(c, b) {
                return (V(b) && b) || c
            }).filter(H.identity).onValue(function(b) {
                S = b.height - K._$fileToolbar.outerHeight();
                J.resize(K._$container.width(), S)
            }));
            var U = G.enqueueCapped(K._whenOpDone.bind(K), function() {
                if (!K._$container) {
                    return
                }
                W.refresh()
            });
            J.onSizeChange(U);
            K.on("widgetAdded", U);
            K.on("widgetChanged", U);
            K.on("widgetCleared", U);
            K.on("internal-change", U);
            if (K._options.commentContext) {
                K._options.commentContext.on("fileCommentsResized", U)
            }
            var T = new E(M,[{
                id: "file-comments-and-messages",
                getHeight: function() {
                    return K._editorInnerOffset() || 0
                },
                setScrollTop: function(b) {
                    Z(0, b)
                }
            }, {
                id: "editors",
                getHeight: function() {
                    return Infinity
                },
                setScrollTop: function(b) {
                    J.scroll(null, b)
                }
            }]);
            K._addDestroyable(T);
            if (K._options.commentContext) {
                K._options.commentContext.on("fileCommentsResized", T.heightsChanged.bind(T))
            }
            W.setTarget({
                scrollSizing: function() {
                    var b = J.scrollSizing();
                    return {
                        height: b.height + K._editorInnerOffset(),
                        clientHeight: b.clientHeight
                    }
                },
                offset: function() {
                    return N.offset()
                },
                scroll: function(b, c) {
                    if (c != null) {
                        M.push({
                            top: c
                        })
                    }
                }
            });
            var L = /Chrome\//.test(window.navigator.userAgent);
            var Y = /Apple Computer/.test(window.navigator.vendor);
            var X = 1;
            if (L) {
                X = -0.7
            } else {
                if (Y) {
                    X = -1 / 3
                }
            }
            var O = C(window);
            (L || Y) && K._$container[0].addEventListener("mousewheel", function(b) {
                if (b.wheelDeltaX && b.wheelDeltaY) {
                    if (Math.abs(b.wheelDeltaX) > Math.abs(b.wheelDeltaY)) {
                        var c = J.scrollSizing();
                        J.scroll(c.left - b.wheelDeltaX * X, null)
                    } else {
                        O.scrollTop(O.scrollTop() + b.wheelDeltaY * X)
                    }
                    b.stopImmediatePropagation();
                    b.preventDefault()
                }
            }, true)
        })
    }
    return F
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/text-view-scrolling.js' */
define("feature/file-content/text-view/text-view-scrolling", ["jquery", "util/mixin", "feature/file-content/text-view/request-window-scrolls"], function(C, B, A) {
    var D = {
        scrollHandleIntoFocus: function(G) {
            var E = this._editorForHandle(G);
            var F = E.getScrollInfo();
            var I = F.height > F.clientHeight;
            var H = I ? E.heightAtLine(G._handle.lineNo(), "local") : 0;
            this._scrollToFocusedOffset(H, F, E)
        },
        scrollHandleIntoView: function(F) {
            var E = this._editorForHandle(F);
            if (E.lastLine() === F._handle.lineNo()) {
                E.scrollTo(null, E.heightAtLine(E.lastLine() + 1));
                return
            }
            E.scrollIntoView(F._handle.lineNo() + 1)
        },
        scrollToFileComments: function(G, I) {
            var E = this._editors[0];
            var F = E.getScrollInfo();
            var H = C("#page").offset().top;
            if (I != null) {
                if (G > H && (G + I) < (H + F.clientHeight)) {
                    return
                }
            }
            this._scrollToFocusedOffset(G - this._editorInnerOffset(), F, E)
        },
        scrollToTop: function() {
            this._scrollToSourcePosition(null, 0)
        },
        scrollToWidgetOffset: function(G, F, I) {
            var H = this._editorForHandle(G);
            var M = H.getScrollInfo();
            var E = M.height > M.clientHeight;
            var L;
            if (E) {
                var J = H.heightAtLine(G._handle.lineNo(), "local");
                L = Math.max(0, J + F);
                if (I != null) {
                    var K = L - M.top;
                    if (K >= 0 && K < M.clientHeight - I) {
                        return
                    }
                }
            } else {
                L = 0
            }
            this._scrollToFocusedOffset(L, M, H)
        },
        _requestWindowScrolls: function(E) {
            var F = this;
            return A(this, E).done(function(G) {
                F._scrollToSourcePosition = function(H, I) {
                    G.scroll(H, I != null ? Math.max(0, I + F._editorInnerOffset()) : null)
                }
            }).fail(function(G) {
                F._scrollToSourcePosition = function(H, I) {
                    throw new Error("Not implemented")
                }
            })
        },
        _scrollToFocusedOffset: function(H, G, F) {
            F.getInputField().blur();
            var E = G.clientHeight * this._options.focusPoint;
            this._scrollToSourcePosition(null, H - E)
        },
        _scrollToSourcePosition: function() {
            throw new Error("_scrollToSourcePosition can't be called until _requestWindowScrolls returns.")
        }
    };
    return {
        mixInto: B(D).into
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:text-view', location = '/static/feature/file-content/text-view/attach-simple-scroll-behavior.js' */
define("feature/file-content/text-view/attach-simple-scroll-behavior", ["jquery"], function(A) {
    return function B(C, D, E) {
        if (!D) {
            return A.Deferred().reject()
        }
        return C._requestWindowScrolls({
            scrollSizing: function() {
                return D.getScrollInfo()
            },
            scroll: function(F, G) {
                D.scrollTo(null, G)
            },
            resize: function(I, F) {
                var G = E.data("height");
                var H = E.data("width");
                if (F !== G) {
                    E.height(F);
                    E.data("height", F)
                }
                if (I !== H) {
                    E.data("width", I)
                }
                if (F !== G || I !== H) {
                    C.refresh()
                }
            },
            onSizeChange: function(F) {
                C.on("resize", F)
            }
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:direction-enum', location = '/static/model/direction.js' */
define("model/direction", function() {
    var A = {
        UP: "UP",
        DOWN: "DOWN"
    };
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:region-scroll-forwarder', location = '/static/util/region-scroll-forwarder.js' */
define("util/region-scroll-forwarder", ["bacon", "jquery", "lodash", "util/bacon", "util/function"], function(D, C, A, F, B) {
    function E(H, N) {
        var L = new D.Bus();
        N = N.map(function(P) {
            var O = null;
            return C.extend({}, P, {
                getCachedHeight: function() {
                    if (O == null) {
                        O = P.getHeight()
                    }
                    return O
                },
                invalidateCache: function() {
                    O = null
                }
            })
        });
        var G;
        H.subscribe(function(Q) {
            if (!Q.isInitial()) {
                return
            }
            var O = Q.value().top;
            var R = 0;
            var P;
            A.forEach(N, function(U) {
                var S = U.getCachedHeight();
                var T = R + S >= O;
                if (!P && T) {
                    P = U;
                    U.setScrollTop(O - R)
                } else {
                    U.setScrollTop(T ? 0 : S)
                }
                R += S
            })
        })();
        var M = H.takeUntil(L).slidingWindow(2, 2).map(B.spread(function(O, V) {
            var U = 0;
            var Q;
            var T = V.top - O.top;
            var S;
            var P = 0;
            A.some(N, function(X) {
                var W = X.getCachedHeight();
                if (!S && P + W >= V.top) {
                    S = X;
                    U = P
                }
                if (!Q && P + W >= O.top) {
                    Q = X
                }
                P += W;
                return S && Q
            });
            if (!S) {
                throw new Error("No forwardee handles " + V.top)
            }
            var R = {
                scrollInfo: V,
                localTop: V.top - U,
                diff: T,
                forwardTo: S,
                previousRegion: Q
            };
            return R
        }));
        function K(P, O) {
            A.chain(P).filter(function(R, Q, S) {
                return !A.some(S.slice(0, Q), function(T) {
                    return R.groupId && R.groupId === T.groupId
                })
            }).forEach(function(Q) {
                Q.setScrollTop(O(Q) === "bottom" ? Q.getCachedHeight() : 0)
            }).value()
        }
        var I = M.onValue(function(R) {
            G = R;
            var O = R.previousRegion;
            if (O !== R.forwardTo) {
                var P = F.toArray(F.takeBetween(D.fromArray(N), {
                    start: O,
                    end: R.forwardTo,
                    startInclusive: true,
                    endInclusive: false
                }));
                var Q = R.diff > 0;
                K(Q ? P.reverse() : P, B.constant(Q ? "bottom" : "top"))
            }
            R.forwardTo.setScrollTop(R.localTop)
        });
        function J() {
            A.invoke(N, "invalidateCache");
            if (G) {
                var O = A.indexOf(N, G.forwardTo);
                K(A.reject(N, function(P) {
                    return P === G.forwardTo || (P.groupId && P.groupId === G.forwardTo.groupId)
                }), function(P) {
                    return A.indexOf(N, P) < O ? "bottom" : "top"
                });
                G.forwardTo.setScrollTop(Math.min(G.localTop, G.forwardTo.getCachedHeight()))
            }
        }
        return {
            regionChanges: M.map(".forwardTo").skipDuplicates(),
            forwardingInfo: M,
            heightsChanged: J,
            destroy: function() {
                I();
                L.push(true);
                L.end()
            }
        }
    }
    return E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:page-scrolling-manager', location = '/static/layout/page-scrolling-manager.js' */
define("layout/page-scrolling-manager", ["aui", "bacon", "jquery", "util/bacon", "util/events", "util/function", "util/region-scroll-forwarder", "util/scroll", "exports"], function(N, B, H, O, P, M, J, I, G) {
    var D = H(window);
    function F() {
        var T = H(window);
        var g = document.body;
        var W = H(g);
        var Z = H("#page");
        var U = Z[0];
        var e = H(".aui-sidebar");
        var R = N.sidebar(e);
        var X = g.style.height;
        W.addClass("scrolling-forwarded");
        var d = new B.Bus();
        var Y = new B.Bus();
        var Q = new B.Bus();
        var c = new B.Bus();
        var f = c.sampledBy(B.mergeAll(c, Y, B.interval(1000).takeUntil(d), O.getWindowSizeProperty().changes())).filter(function(h) {
            return !!h
        }).takeUntil(d).map(".offset").map(function(i) {
            var h = Z.offset();
            return {
                top: Math.round(i.top - h.top)
            }
        }).skipDuplicates(function(i, h) {
            return i.top === h.top
        }).toProperty();
        var V = c.sampledBy(B.mergeAll(c, Y)).filter(function(h) {
            return !!h
        }).takeUntil(d).map(".scrollSizing").skipDuplicates(function(i, h) {
            return i.height === h.height && i.clientHeight === h.clientHeight
        }).toProperty();
        B.combineWith(function(j, i, h) {
            return j.top + Math.max(i.height, i.clientHeight) + (h.height - i.clientHeight)
        }, f, V, O.getWindowSizeProperty()).takeUntil(d).onValue(function(h) {
            W.height(h);
            P.trigger("internal.stash.layout.body.resize")
        });
        var b = I.fakeScroll(U);
        O.getWindowScrollProperty().takeUntil(d).onValue(function(h) {
            b(h.left, null)
        });
        B.combineAsArray(Q, f.sampledBy(Q), V.sampledBy(Q)).map(M.spread(function(h, j, i) {
            return {
                scrollTop: h.scrollTop != null ? j.top + Math.max(0, Math.min(h.scrollTop, i.height - i.clientHeight)) : null
            }
        })).onValue(function(h) {
            if (h.scrollTop != null) {
                T.scrollTop(h.scrollTop)
            }
        });
        function a(i) {
            var h = null;
            var k = i;
            c.takeUntil(d).onValue(function(l) {
                k = l
            });
            var j = new J(O.getWindowScrollProperty(),[{
                id: "pre",
                groupId: "outside",
                setScrollTop: function(l) {
                    if (h === null) {
                        h = e.offset().top
                    }
                    b(null, l);
                    R.$wrapper.css("top", Math.max(0, l - h));
                    if (!R.$wrapper.hasClass("aui-is-docked") || l === 0) {
                        R.reflow()
                    }
                },
                getHeight: function() {
                    var m = k.offset().top;
                    var l = Z.offset().top;
                    return m - l
                }
            }, {
                id: "in",
                groupId: "inside",
                setScrollTop: function(l) {
                    k.scroll(null, l)
                },
                getHeight: function() {
                    return Infinity
                }
            }]);
            f.takeUntil(d).onValue(j, "heightsChanged");
            return j
        }
        var S = c.onValue(function(h) {
            d.onValue(a(h), "destroy");
            S()
        });
        return {
            setTarget: function(h) {
                c.push(h)
            },
            scroll: function(i, h) {
                Q.push({
                    scrollTop: h
                })
            },
            refresh: function() {
                Y.push(true)
            },
            destroy: function() {
                W.removeClass("scrolling-forwarded");
                b(0, 0);
                R.$wrapper.css("top", "");
                g.style.height = X || null;
                Q.end();
                d.push(true);
                d.end();
                Y.end();
                c.end()
            }
        }
    }
    var A = false;
    var C;
    var K;
    function L() {
        if (A) {
            throw new Error("acceptScrollForwardingRequests has already been called. It must be unregistered before it can be called again.")
        }
        A = true;
        C = null;
        return function() {
            if (K) {
                N.log("Scroll control is not yet destroyed. Ongoing scroll requests will be ignored.");
                K.scrollTo = H.noop;
                K.destroy()
            }
            A = false
        }
    }
    function E() {
        var Q;
        if (!A) {
            return H.Deferred().reject({
                reason: "NOT_ACCEPTING"
            })
        }
        if (K) {
            return H.Deferred().reject({
                reason: "CONTROL_TAKEN"
            })
        }
        H("#footer").hide();
        K = F();
        function R() {
            D.scrollTop(Math.min(C, Q.offset().top - H("#page").offset().top))
        }
        K.setTarget = (function(S) {
            return function T(V) {
                var U = S.apply(this, arguments);
                Q = V;
                var W = !K;
                if (C != null && !W) {
                    R();
                    C = null
                }
                return U
            }
        })(K.setTarget);
        K.destroy = (function(S) {
            return function T() {
                if (Q) {
                    C = D.scrollTop();
                    R()
                }
                H("#footer").show();
                K = null;
                return S.apply(this, arguments)
            }
        })(K.destroy);
        return H.Deferred().resolve(K)
    }
    G.acceptScrollForwardingRequests = L;
    G._requestScrollControl = E
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:request-page-scrolling', location = '/static/util/request-page-scrolling.js' */
define("util/request-page-scrolling", ["layout/page-scrolling-manager"], function(A) {
    return function() {
        return A._requestScrollControl()
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:ediff', location = '/static/feature/file-content/ediff/ediff.js' */
define("feature/file-content/ediff", ["util/html"], function(R) {
    var O = /\w+|\s+|./gim
      , C = /\n[ \u00a0\t\r]+/mg
      , U = /\s/m
      , Q = "add"
      , V = "delete"
      , I = "change"
      , E = R.NodeStream
      , D = R.NodeType
      , J = D.OPEN
      , H = D.CLOSE;
    function P(Y) {
        var W = [], X;
        O.lastIndex = 0;
        while (X = O.exec(Y)) {
            W.push({
                start: X.index,
                value: X[0],
                end: O.lastIndex
            })
        }
        return W
    }
    function L(W) {
        var Y = W.comparableValue, X;
        if (typeof Y !== "string") {
            X = Y = W.value;
            U.lastIndex = 0;
            if (U.test(X)) {
                if (W.start === 0) {
                    X = "\n" + X
                }
                if (X.indexOf("\n") !== -1) {
                    Y = X.replace(C, "\n")
                }
            }
            W.comparableValue = Y
        }
        return Y
    }
    function F(W, c) {
        var Y = [];
        if (W.length !== 0 || c.length !== 0) {
            var e = A(W, c);
            if (e.snake) {
                e = e.prev
            }
            while (e && e.prev && e.prev.j >= 0) {
                if (e.snake) {
                    throw "bad diffpath: found snake when looking for diff"
                }
                var a = e.i;
                var Z = e.j;
                e = e.prev;
                var X = e.i;
                var f = e.j;
                var b = a - X;
                var d = Z - f;
                Y.unshift({
                    from: X,
                    fromCount: b,
                    to: f,
                    toCount: d,
                    type: (b === 0 && Q) || (d === 0 && V) || I
                });
                if (e.snake) {
                    e = e.prev
                }
            }
        }
        return Y
    }
    function A(Y, n) {
        var h = Y.length
          , m = n.length
          , c = h + m + 1
          , p = 1 + 2 * c
          , q = (p + 1) / 2
          , X = [];
        X.length = p;
        X[q + 1] = N(0, -1, null);
        for (var l = 0; l < c; l++) {
            for (var e = -l; e <= l; e += 2) {
                var o = q + e, a = o + 1, W = o - 1, b, g;
                if ((e === -l) || (e !== l && X[W].i < X[a].i)) {
                    g = X[a].i;
                    b = X[a]
                } else {
                    g = X[W].i + 1;
                    b = X[W]
                }
                X[W] = null;
                var f = g - e;
                var Z = M(g, f, b);
                while (g < h && f < m && (L(Y[g]) === L(n[f]))) {
                    g++;
                    f++
                }
                if (g > Z.i) {
                    Z = N(g, f, Z)
                }
                X[o] = Z;
                if (g >= h && f >= m) {
                    return X[o]
                }
            }
            X[q + l - 1] = null
        }
        throw "could not find a diff path"
    }
    function N(X, W, Y) {
        return {
            i: X,
            j: W,
            prev: Y,
            snake: true
        }
    }
    function M(X, W, Y) {
        return {
            i: X,
            j: W,
            prev: B(Y)
        }
    }
    function B(W) {
        while (W && W.i !== 0 && W.j !== 0 && !W.snake) {
            if (!W.prev) {
                return W
            }
            W = W.prev
        }
        return W
    }
    function T(c, Z, W, b, d) {
        for (var a = W; a < W + b; a++) {
            var e = Z.length - 1;
            var Y = Z.length && Z[e];
            var X = c[a];
            if (Y && Y.end === X.start) {
                Z[e] = {
                    start: Y.start,
                    end: X.end,
                    type: Y.type
                }
            } else {
                Z.push({
                    start: X.start,
                    end: X.end,
                    type: d
                })
            }
        }
    }
    function S(X, c, W) {
        var d = []
          , e = [];
        for (var b = 0, Y = W.length, a, Z; b < Y; b++) {
            a = W[b];
            Z = a.type;
            if (Z === I || Z === V) {
                T(X, d, a.from, a.fromCount, Z)
            }
            if (Z === I || Z === Q) {
                T(c, e, a.to, a.toCount, Z)
            }
        }
        return {
            originalRegions: d,
            revisedRegions: e
        }
    }
    function K(W, X) {
        var Y = F(W, X);
        return S(W, X, Y)
    }
    function G(W) {
        this._regions = W.slice(0);
        this._regionsLength = this._regions.length;
        this._opened = false;
        this._nextPosition = 0;
        this._current = undefined
    }
    G.prototype = new E();
    G.prototype.hasNext = function() {
        return this._opened || this._nextPosition < this._regionsLength
    }
    ;
    G.prototype.next = function() {
        if (!this.hasNext()) {
            return null
        } else {
            if (this._opened) {
                this._opened = false;
                return {
                    type: H,
                    textPosition: this._current.end,
                    value: "</span>"
                }
            } else {
                this._opened = true;
                var W = this._current = this._regions[this._nextPosition];
                this._nextPosition++;
                return {
                    type: J,
                    textPosition: W.start,
                    value: '<span class="ediff-' + W.type + '">',
                    close: {
                        type: H,
                        value: "</span>"
                    }
                }
            }
        }
    }
    ;
    G.prototype.getNextType = function() {
        return this.hasNext() ? (this._opened ? H : J) : null
    }
    ;
    G.prototype.getNextTextPosition = function() {
        return this.hasNext() ? (this._opened ? this._current.end : this._regions[this._nextPosition].start) : null
    }
    ;
    return {
        tokenizeString: P,
        getTokensComparableValue: L,
        diff: K,
        DiffRegionNodeStream: G
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:ediff', location = '/static/feature/file-content/ediff/ediff-markers.js' */
define("feature/file-content/ediff/ediff-markers", ["bacon", "jquery", "lodash", "util/bacon", "util/function", "feature/file-content/diff-view-segment-types", "feature/file-content/ediff"], function(B, F, O, Q, K, E, A) {
    var C = 750;
    function M(R) {
        return O.pluck(R.lines, "line").join("\n")
    }
    function H(R, S) {
        return ( (R.length < C) && (S.length < C))
    }
    function L(S, T) {
        var R = B.fromBinder(function(U) {
            T.eachLine(U).done(O.partial(U, new B.End()));
            return F.noop
        });
        J(R).onValue(function(U) {
            S.markText(U.line, U.from, U.to, U.options)
        })
    }
    function J(R) {
        function T(U) {
            return U[0].segment
        }
        var S = K.dot("0.line.conflictMarker");
        return Q.split(R, K.dot("segment")).slidingWindow(2, 2).filter(K.partialRight(O.every, K.not(S))).filter(K.spread(function(V, U) {
            return T(V).type === E.REMOVED && T(U).type === E.ADDED
        })).flatMap(K.spread(function(W, U) {
            function V(Y, Z) {
                return B.fromArray(Z).map(function(a) {
                    return O.extend({}, a, {
                        line: Y[a.line]
                    })
                })
            }
            var X = D(T(W), T(U));
            return V(W, X.from).merge(V(U, X.to))
        }))
    }
    function D(X, U) {
        function W(Z) {
            var Y = M(Z);
            return {
                text: Y,
                tokens: A.tokenizeString(Y)
            }
        }
        var R = W(U);
        var T = W(X);
        if (!H(R.tokens, T.tokens)) {
            return {
                to: [],
                from: []
            }
        }
        function S(Z, Y) {
            return O.map(Z, O.partial(I, Y.text))
        }
        var V = A.diff(T.tokens, R.tokens);
        return {
            from: S(V.originalRegions, T),
            to: S(V.revisedRegions, R)
        }
    }
    function I(S, a) {
        var W = S.slice(0, a.start);
        var T = S.slice(a.start, a.end);
        var X = W.lastIndexOf("\n") + 1;
        var U = T.lastIndexOf("\n") + 1;
        var Z = U ? U + a.start : X;
        var V = a.start - X;
        var R = a.end - Z;
        var b = W.split("\n").length - 1;
        var Y = T.split("\n").length - 1;
        return {
            line: b,
            from: {
                lineOffset: 0,
                ch: V
            },
            to: {
                lineOffset: Y,
                ch: R
            },
            options: {
                className: "ediff-" + a.type
            }
        }
    }
    var G;
    function P(R) {
        G = O.partial(L, R.diffView);
        R.diffView.on("internal-change", G);
        return {
            destroy: O.partial(N, R.diffView)
        }
    }
    function N(R) {
        R.off("internal-change", G)
    }
    return {
        init: P,
        _convertLinesToMarkers: J
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view', location = '/static/feature/file-content/diff-view/diff-view.js' */
(function() {
    var C = require("util/bacon");
    var A = C.keyboardEvents("requestSecondaryNext");
    var B = C.keyboardEvents("requestSecondaryPrevious");
    define("feature/file-content/diff-view", ["jquery", "lodash", "util/array", "util/events", "util/function", "util/navigator", "util/object", "model/direction", "feature/comments/anchors", "feature/file-content/diff-view-options", "feature/file-content/diff-view-segment-types", "feature/file-content/ediff/ediff-markers", "feature/file-content/text-view"], function(c, m, G, U, Z, e, E, b, M, N, g, I, k) {
        var D = g.ADDED;
        var l = g.REMOVED;
        var R = g.CONTEXT;
        function f(n, o) {
            return n.concat(o).sort(function(s, r) {
                var p = m.first(s.lines);
                var q = m.first(r.lines);
                var t = m.last(s.lines);
                var u = m.last(r.lines);
                return p.destination - q.destination || p.source - q.source || t.destination - u.destination || t.source - u.source
            })
        }
        function P(n) {
            return m.chain(n.hunks).pluck("segments").flatten(true).value()
        }
        function X(n) {
            return n && n.type !== g.CONTEXT
        }
        function F(n) {
            return Boolean(n.lines[0].conflictMarker)
        }
        var J = c(stash.feature.fileContent.diffView.lineNumber());
        var Y = c(stash.feature.fileContent.diffView.lineNumberMarker());
        function Q(o, p) {
            var n = [];
            return p.eachLine(function(v) {
                var s = v.line;
                var t = v.handles.FROM;
                var q = v.handles.TO;
                var u = J.clone();
                var r = J.clone();
                u.addClass("line-number-from");
                r.addClass("line-number-to");
                u.html(v.lineType !== D ? s.source : "&nbsp;");
                r.html(v.lineType !== l ? s.destination : "&nbsp;");
                n.push([t || q, "line-number-from", u[0]]);
                n.push([q || t, "line-number-to", r[0]]);
                v.handles.all.forEach(function(x) {
                    var w = Y.clone();
                    w.attr("data-file-type", x.fileType);
                    w.attr("data-line-type", v.lineType);
                    w.attr("data-line-number", v.lineNumber);
                    w.html(x.lineType === D ? "+" : x.lineType === l ? "-" : "&nbsp;");
                    n.push([x, "line-number-marker", w[0]])
                })
            }).done(function() {
                o.operation(function() {
                    n.forEach(function(r) {
                        o.setGutterMarker.apply(o, r)
                    })
                });
                o._$container.addClass("fully-loaded diff-api-ready");
                var q = V(p);
                h(o, q);
                if (p.type === "INITIAL") {
                    j(o, q)
                }
            })
        }
        var H = {};
        H[D] = "added";
        H[l] = "removed";
        H[R] = "context";
        function L(q, p, o, r) {
            var n = H[q];
            if (q !== R) {
                n += " modified"
            }
            if (r === true || o === true) {
                n += " expanded"
            }
            n += (p ? " conflict conflict-" + p.toLowerCase() : "");
            n += o ? " new" : "";
            return n
        }
        function i(p, q) {
            var n = q.type === "INSERT";
            var o = [];
            q.eachLine(function(s) {
                var r = L(s.lineType, s.line.conflictMarker, n, s.attributes.expanded);
                s.handles.all.forEach(function(t) {
                    p.addLineClass(t, "wrap", r);
                    if (n) {
                        o.push(t)
                    }
                })
            }).done(function() {
                if (o.length) {
                    S(p, o)
                }
            })
        }
        function S(o, n) {
            setTimeout(function() {
                if (!o._editor) {
                    return
                }
                o.operation(function() {
                    m.each(n, function(p, q) {
                        o.removeLineClass(p, "wrap", "new")
                    })
                })
            }, 1500)
        }
        function V(o) {
            var n = c.extend({}, o);
            delete n.fileChange;
            return E.freeze(n)
        }
        function h(n, o) {
            n.trigger("change", o);
            U.trigger("stash.feature.fileContent.diffViewContentChanged", null, o)
        }
        function j(n, o) {
            n.trigger("load", o);
            U.trigger("stash.feature.fileContent.diffViewContentLoaded", null, o)
        }
        function K(o, n) {
            k.call(this, n.$container, n);
            this._data = o;
            this._scrollingReady = c.Deferred()
        }
        m.extend(K.prototype, k.prototype);
        K.defaults = k.defaults;
        K.contentChangeType = {
            INITIAL: "INITIAL",
            INSERT: "INSERT"
        };
        K.prototype.init = function() {
            k.prototype.init.call(this);
            var q = this._options.diffViewOptions || N;
            var o = !e.isIE() || e.majorVersion() >= 11;
            this.registerGutter("line-number-marker", {
                weight: 1000
            });
            this._$container.addClass("diff-type-" + this._options.fileChange.type).toggleClass("hide-ediff", q.get("hideEdiff")).toggleClass("animated", o);
            c("html").toggleClass("no-cssanimations", !o);
            var p = this._data;
            var n = this;
            U.trigger("stash.feature.fileContent.diffViewDataLoaded", null, this._data);
            this.on("internal-change", function(r) {
                Q(n, r).done(function() {
                    n._selectLine(n._options.anchor);
                    var s = n._options.fileChange.search;
                    if (s) {
                        n._highlight(s)
                    }
                })
            });
            this._addDestroyable(I.init({
                diffView: this
            }));
            this._addDestroyable(U.chainWith(c(window)).on("scroll", function() {
                if (!n._expectFocusScroll) {
                    n._invalidateFocus()
                }
                n._expectFocusScroll = false
            }));
            this._addDestroyable(U.chainWith(q).on("change", function(r) {
                if (r.key === "hideEdiff") {
                    n._$container.toggleClass("hide-ediff", r.value)
                }
            }));
            this.on("internal.acceptedModification", Z.spread(function(r, t, s) {
                i(this, {
                    type: r,
                    eachLine: function(u) {
                        return c.Deferred().resolve(m.map(s, u))
                    }
                })
            }));
            if (this._options.attachScroll) {
                m.defer(function() {
                    n._attachScrollBehavior().then(n._scrollingReady.resolve.bind(n._scrollingReady), n._scrollingReady.reject.bind(n._scrollingReady))
                })
            } else {
                this._scrollingReady.resolve()
            }
            this._addDestroyable(U.chain().on("internal.stash.feature.diffView.lineChange", this._selectLine.bind(this)).on("internal.stash.feature.diffView.highlightSearch", this._highlight.bind(this)));
            this._addDestroyable(A.onValue(this._scrollToChange.bind(this, b.DOWN)));
            this._addDestroyable(B.onValue(this._scrollToChange.bind(this, b.UP)))
        }
        ;
        function T() {
            throw new Error("DiffView implementation must define this.")
        }
        K.prototype._findNextChange = function(p, v, z) {
            var AC = this;
            var q = false;
            var y = -1;
            if (p == null) {
                z = b.DOWN;
                q = true
            }
            for (var r = 0, x = v.length; r < x; r++) {
                var u = (z === b.DOWN) ? r : x - r - 1;
                var w = v[u];
                if (q) {
                    var t = v[u - 1];
                    var AA = X(w) && !(F(w) && t && F(t)) && !(AC._options.combineLinkedSegments && t && X(t));
                    if (AA) {
                        y = u;
                        break
                    }
                } else {
                    if (w === p) {
                        q = true
                    }
                }
            }
            function s(n) {
                return F(n) || (AC._options.combineLinkedSegments && X(n))
            }
            if (y > -1) {
                var AB = y;
                var o = y + 1;
                while (o < v.length && s(v[o])) {
                    o++
                }
                return v.slice(AB, o)
            }
            return null
        }
        ;
        K.prototype._selectLine = function(o) {
            if (!o) {
                return
            }
            var n = this.getLineHandleFromNumber(o.no, o.type);
            if (n) {
                this.scrollHandleIntoFocus(n);
                this._markLinesFocused([{
                    editor: this._editorForHandle(n),
                    handles: [n]
                }])
            }
        }
        ;
        K.prototype._scrollToChange = function(q) {
            var p = this._focusedSegments && this._focusedSegments[0];
            if (!p) {
                var n = this._$fileToolbar.outerHeight();
                var r = this._$container[0].getBoundingClientRect().top - n;
                p = this._getFocusSegment(r)
            }
            var o = this._findNextChange(p, this._allSegments, q);
            if (o) {
                this._setFocusSegment(o);
                this._expectFocusScroll = true;
                this._focusedSegments = o
            }
        }
        ;
        K.prototype._scrollToComment = function(p) {
            N.set("hideComments", false);
            var o = m.chain(this._options.commentContext._containers).pluck("anchor").filter(function(q) {
                return q instanceof M.LineAnchor
            }).uniq(Z.invoke("getId")).value();
            var n = this._findNextAnchor(p, o, this._focusedComment);
            if (!n) {
                return
            }
            this._expectFocusScroll = true;
            this._focusedComment = n;
            if (!n.handle) {
                this._scrollToSourcePosition(null, -this._editorInnerOffset());
                return
            }
            this._highlightCommentForLine(n.handle);
            this.scrollHandleIntoFocus(n.handle)
        }
        ;
        K.prototype._invalidateFocus = function() {
            this._focusedSegments = null;
            this._focusedComment = null
        }
        ;
        function W(q, n, o) {
            var r;
            if (o._line !== undefined) {
                var p = n[o._lineType][o._line].handles;
                r = p[o._fileType] || p.FROM || p.TO
            }
            return {
                anchor: o,
                handle: r,
                offset: r ? q.heightAtLine(r._handle.lineNo(), "local") : 0
            }
        }
        K.prototype._findNextAnchorInEditor = function(s, o, v, r) {
            if (o.length === 0) {
                return null
            }
            o = m.sortBy(o, Z.dot("_line"));
            if (r) {
                var q = G.findIndex(Z.propEqual(m.pick(r.anchor, "_line", "_lineType", "_fileType")))(o);
                if (q !== -1) {
                    var x = o[q + (v === b.UP ? -1 : 1)];
                    return x && W(s, this._internalLines, x)
                }
            }
            var n;
            if (r) {
                n = r.offset
            } else {
                var w = this._$fileToolbar.outerHeight();
                var u = this._$container[0].getBoundingClientRect().top - w;
                var p = s.getScrollInfo();
                n = p.top + (this._options.focusPoint * p.clientHeight) - u
            }
            var t = o.map(W.bind(null, s, this._internalLines));
            if (v === b.UP) {
                return m.find(t.reverse(), function(y) {
                    return y.offset < n
                })
            } else {
                return m.find(t, function(y) {
                    return y.offset > n
                })
            }
        }
        ;
        K.prototype._highlightCommentForLine = function(n) {
            this._markLineCommentsFocused([{
                editor: this._editorForHandle(n),
                handles: [n]
            }])
        }
        ;
        K.prototype.getLineHandleFromNumber = function(n, o) {
            var p = (o === "TO" ? this._internalLines[D][n] : this._internalLines[l][n]);
            var q = (o === "TO" ? "line.destination" : "line.source");
            p = p || m.find(this._internalLines[R], Z.dotEq(q, n));
            p = p && p.handles;
            return p && (p[o] || p.all[0])
        }
        ;
        K.prototype._acceptModification = T;
        K._combineTexts = function(n) {
            return m.chain(n).pluck("line").pluck("line").value().join("\n")
        }
        ;
        K.prototype._getChangeAttributes = function(n, o) {
            return {
                diff: o,
                fileChange: this._options.fileChange
            }
        }
        ;
        K.prototype._getLineClasses = L;
        K.prototype._modifyDiff = function(n, q, p) {
            var o = [].slice.call(arguments, 3);
            this._allSegments = f(this._allSegments || [], P(q));
            this._modify.apply(this, [n, q, p].concat(o))
        }
        ;
        function d(r, o, p, q) {
            var n = this;
            if (!this._currAnimationPromise) {
                this._currAnimationPromise = {}
            }
            if (this._currAnimationPromise[r]) {
                m.invoke(this._currAnimationPromise[r], "abort")
            }
            this._currAnimationPromise[r] = q.map(function(v) {
                var w = v.handles;
                var y = v.editor;
                if (!w || !w.length) {
                    return c.Deferred().reject().promise({
                        abort: c.noop
                    })
                }
                function u(AB, AA) {
                    var AC = AB ? "addLineClass" : "removeLineClass";
                    y.operation(function() {
                        w.forEach(function(AD) {
                            y[AC](AD._handle, "wrap", AA)
                        })
                    })
                }
                var z = false;
                var t = c.Deferred();
                var x = c.Deferred();
                t.done(x.resolve.bind(x));
                var s = m.once(function() {
                    y.off("scroll", s);
                    if (z) {
                        return
                    }
                    if (n._$container) {
                        n._$container.attr("data-last-updated", new Date().getTime())
                    }
                    u(true, o);
                    t.always(u.bind(null, false, o));
                    u(true, r);
                    x.always(u.bind(null, false, r));
                    setTimeout(x.resolve.bind(x), p)
                });
                y.on("scroll", s);
                setTimeout(s, 100);
                return t.promise({
                    abort: function() {
                        z = true;
                        t.resolve()
                    }
                })
            })
        }
        var a = 1000;
        var O = 1000;
        K.prototype._markLinesFocused = m.partial(d, "line-focused", "last-focus", a);
        K.prototype._markLineCommentsFocused = m.partial(d, "line-comment-focused", "last-comment-focus", O);
        return K
    })
}());
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view', location = '/static/feature/file-content/diff-view/diff-view.soy' */
// This file was automatically generated from diff-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.diffView.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.diffView == 'undefined') {
    stash.feature.fileContent.diffView = {};
}

stash.feature.fileContent.diffView.editor = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="diff-editor' + ((opt_data.editorClass) ? ' ' + soy.$$escapeHtml(opt_data.editorClass) : '') + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffView.editor.soyTemplateName = 'stash.feature.fileContent.diffView.editor';
}

stash.feature.fileContent.diffView.lineNumber = function(opt_data, opt_ignored) {
    return '<div class="line-number"></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffView.lineNumber.soyTemplateName = 'stash.feature.fileContent.diffView.lineNumber';
}

stash.feature.fileContent.diffView.lineNumberMarker = function(opt_data, opt_ignored) {
    return '<div class="line-number-marker line-locator" data-file-type="" data-line-type="" data-line-number=""></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffView.lineNumberMarker.soyTemplateName = 'stash.feature.fileContent.diffView.lineNumberMarker';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:math', location = '/static/util/math.js' */
define("util/math", ["lodash", "exports"], function(K, F) {
    function C(O, N) {
        return O * N
    }
    function M(O, N) {
        return O + N
    }
    function J(O, N) {
        return O < N
    }
    function E(O, N) {
        return O > N
    }
    function L(N) {
        return N > 0
    }
    function A(N) {
        return N < 0
    }
    function I(N) {
        return function(O) {
            return Math.min(N, O)
        }
    }
    function B(N) {
        return function(O) {
            return Math.max(N, O)
        }
    }
    function G(O, N) {
        return K.compose(B(O), I(N))
    }
    function H(N, O) {
        if (!(this instanceof H)) {
            return new H(N,O)
        }
        this.x = N;
        this.y = O
    }
    function D(O, N) {
        if (!(this instanceof D)) {
            return new D(O,N)
        }
        this.width = O;
        this.height = N
    }
    F.add = M;
    F.clamp = G;
    F.greaterThan = E;
    F.highPass = B;
    F.isNegative = A;
    F.isPositive = L;
    F.lowPass = I;
    F.lessThan = J;
    F.multiply = C;
    F.Point = H;
    F.Size = D
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-hunk-map', location = '/static/feature/file-content/diff-hunk-map/diff-hunk-map.soy' */
// This file was automatically generated from diff-hunk-map.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}

stash.feature.fileContent.diffHunkMap = function(opt_data, opt_ignored) {
    return '<div class="diff-hunk-map"></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffHunkMap.soyTemplateName = 'stash.feature.fileContent.diffHunkMap';
}

stash.feature.fileContent.diffHunkMapCanvas = function(opt_data, opt_ignored) {
    return '<canvas width="' + soy.$$escapeHtml(opt_data.size.width) + '" height="' + soy.$$escapeHtml(opt_data.size.height) + '"></canvas>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffHunkMapCanvas.soyTemplateName = 'stash.feature.fileContent.diffHunkMapCanvas';
}

stash.feature.fileContent.diffHunkMapViewportIndicator = function(opt_data, opt_ignored) {
    return '<div class="viewport-indicator hidden"></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.diffHunkMapViewportIndicator.soyTemplateName = 'stash.feature.fileContent.diffHunkMapViewportIndicator';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-hunk-map', location = '/static/feature/file-content/diff-hunk-map/diff-hunk-map.js' */
define("feature/file-content/diff-hunk-map", ["jquery", "lodash", "util/function", "util/math", "util/scroll"], function(G, B, C, E, A) {
    var F = {
        CONTEXT: "#ffffff",
        ADDED: "#97f295",
        REMOVED: "#ffb6ba",
        CONFLICT: "#FFF986"
    };
    function H(I, K, J) {
        this.init.apply(this, arguments)
    }
    H.prototype.init = function(I, K, J) {
        this.regions = K;
        this.options = G.extend({}, J);
        this.$hunkMap = G(stash.feature.fileContent.diffHunkMap()).appendTo(I);
        this.hunkMapWidth = this.$hunkMap.width();
        this.$indicator = G(stash.feature.fileContent.diffHunkMapViewportIndicator()).appendTo(this.$hunkMap);
        this.indicatorScroll = A.fakeScroll(this.$indicator[0], {
            withDocument: true
        });
        this.addCanvas(E.Size(this.hunkMapWidth, this.$hunkMap.height()));
        this.redraw();
        if (typeof this.options.scrollToFn === "function") {
            this.$hunkMap.on("click", this._hunkMapClicked.bind(this, this.options.scrollToFn))
        }
    }
    ;
    H.prototype.setIndicator = function() {
        var I = this.hunkMapHeight * (this.hunkMapHeight / this.totalHeight);
        var J = this.hunkMapHeight === 0 || I === this.hunkMapHeight;
        this.$indicator.toggleClass("hidden", J);
        if (J) {
            return
        }
        this.$indicator.height(I)
    }
    ;
    H.prototype.diffScrolled = function(J) {
        var I = J.top / J.height;
        this.indicatorScroll(0, (I * this.hunkMapHeight))
    }
    ;
    H.prototype._hunkMapClicked = function(K, J) {
        var I = J.pageY - this.$hunkMap.offset().top;
        K(I / this.hunkMapHeight)
    }
    ;
    H.prototype.mapHeights = function() {
        var J = B.invoke(this.regions, "getHeight");
        var I = this;
        this.totalHeight = J.reduce(E.add, 0);
        this.hunkMapHeight = Math.min(this.$hunkMap.height(), this.totalHeight);
        B.chain(this.regions).zip(J).forEach(C.spread(function(L, K) {
            L.fraction = K / I.totalHeight
        })).value()
    }
    ;
    function D(I) {
        if (I._seg.lines[0].conflictMarker) {
            return F.CONFLICT
        }
        return F[I._seg.type] || F.CONTEXT
    }
    H.prototype.addHunkToMap = function(K, J) {
        if (J.fraction === 0) {
            return K
        }
        var I = this.getHunkHeight(J);
        this.setFillStyle(D(J));
        this.drawHunk(E.Point(0, K), E.Size(this.hunkMapWidth, I));
        return K + I
    }
    ;
    H.prototype.getHunkHeight = function(I) {
        return Math.max(I.fraction * this.hunkMapHeight, 1)
    }
    ;
    H.prototype.clear = function() {
        this.canvasContext.clearRect(0, 0, this.hunkMapWidth, this.hunkMapHeight)
    }
    ;
    H.prototype.draw = function() {
        this.$canvas.attr("height", this.hunkMapHeight);
        this.regions.reduce(this.addHunkToMap.bind(this), 0);
        this.setIndicator()
    }
    ;
    H.prototype.redraw = function() {
        this.clear();
        this.mapHeights();
        this.draw()
    }
    ;
    H.prototype.addCanvas = function(I) {
        this.$canvas = G(stash.feature.fileContent.diffHunkMapCanvas({
            size: I
        })).appendTo(this.$hunkMap);
        this.canvasContext = this.$canvas[0].getContext("2d")
    }
    ;
    H.prototype.setFillStyle = function(I) {
        this.canvasContext.fillStyle = I
    }
    ;
    H.prototype.drawHunk = function(I, J) {
        this.canvasContext.fillRect(I.x, I.y, J.width, J.height)
    }
    ;
    H.prototype.destroy = function() {
        this.$hunkMap.remove()
    }
    ;
    return H
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:line-handle', location = '/static/feature/file-content/line-handle.js' */
define("feature/file-content/line-handle", function() {
    function A(C, E, B, D) {
        this.fileType = C;
        this.lineType = E;
        this.lineNumber = B;
        this._handle = D;
        D._stashHandle = this
    }
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:synchronized-scroll', location = '/static/util/synchronized-scroll.js' */
define("util/synchronized-scroll", ["lodash", "util/function", "util/math", "util/performance", "model/direction", "exports"], function(X, P, J, Q, A, Y) {
    var O = P.spread(J.multiply);
    function H(a, b) {
        return X.chain(X.zip(a, b)).map(O).reduce(J.add, 0).value()
    }
    function S(a) {
        if (a instanceof S) {
            return a
        }
        if (!(this instanceof S)) {
            return new S(a)
        }
        this._el = a;
        this._programmatic = false;
        return this
    }
    S.prototype.getScrollInfo = function() {
        return {
            top: this._el.scrollTop,
            left: this._el.scrollLeft,
            width: this._el.scrollWidth,
            height: this._el.scrollHeight,
            clientWidth: this._el.clientWidth,
            clientHeight: this._el.clientHeight
        }
    }
    ;
    S.prototype.scrollTo = function(a, b) {
        if (b != null) {
            this._programmatic = true;
            this._el.scrollTop = b
        }
        if (a != null) {
            this._programmatic = true;
            this._el.scrollLeft = a
        }
    }
    ;
    S.prototype.getAndUnsetProgrammaticScrollMarker = function() {
        var a = this._programmatic;
        this._programmatic = false;
        return a
    }
    ;
    function D(b, a) {
        if (!(this instanceof D)) {
            return new D(b,a)
        }
        this._el = a;
        this._parentScrollable = b;
        if (!this._parentScrollable._el) {
            throw new Error("Regions can't (yet) be created for custom Scrollables. We would need to solve the API problem of where to put a function to get the offset relative to the top of the scrollable.")
        }
        return this
    }
    D.prototype.getHeight = function() {
        return this._el.offsetHeight
    }
    ;
    D.prototype.getOffsetTop = function() {
        return this._el.getBoundingClientRect().top - this._parentScrollable._el.getBoundingClientRect().top
    }
    ;
    function R(a, b) {
        return b
    }
    function B(a, b) {
        return a.scrollHeight - a.clientHeight - b
    }
    var T = P.dot("scrollTop");
    function Z(a) {
        return a.scrollHeight - a.clientHeight - a.scrollTop
    }
    function G(b, c, s, i, r, l) {
        var q = (c.scrollTop !== b.scrollTop);
        var j = (c.scrollLeft !== b.scrollLeft);
        s = X.filter(s, function(w) {
            return (q && w.canScrollVertically) || (j && w.canScrollHorizontally)
        });
        if (!s.length) {
            return []
        }
        if (!q) {
            return X.map(s, function(w) {
                return L(w, null, c.scrollLeft)
            })
        }
        var p = c.scrollTop > b.scrollTop ? A.DOWN : A.UP;
        var u = s.concat(c);
        var k = X.filter(u, P.dot("canScrollVertically"));
        var g = P.binary(Math.max);
        function v(w, x) {
            return X.chain(w).pluck(x).reduce(g, 0).value()
        }
        var d = v(k, "topness") * (p === A.UP ? 1 : 0);
        var f = v(k, "bottomness") * (p === A.UP ? 0 : 1);
        var t = U(d * d, f * f, p);
        var o = t[0];
        var a = t[1];
        var e = t[2];
        var h = o > 0 ? V(l, c, s, i, r) : [];
        var m = a > 0 ? X.map(s, p === A.UP ? M(b, c, T, R) : W(b, c, T, R)) : [];
        var n = e > 0 ? X.map(s, p === A.DOWN ? M(b, c, Z, B) : W(b, c, Z, B)) : [];
        return X.chain(s).zip(X.zip(h, m, n)).map(P.spread(function(w, y) {
            var AB = w.scrollLeft !== c.scrollLeft;
            if (!w.canScrollVertically) {
                return L(w, null, AB && w.canScrollHorizontally ? c.scrollLeft : null)
            }
            var AA = y.map(P.defaultValue(0)).map(J.clamp(0, w.scrollHeight));
            var AC = H(AA, t);
            var z = AC - w.scrollTop;
            var x = 0 < (p === A.UP ? -1 : 1) * z;
            if (!x && !AB) {
                return null
            }
            return L(w, x ? AC : null, AB ? c.scrollLeft : null)
        })).filter(X.identity).value()
    }
    function U(e, a, d) {
        var c = Math.max(e, a);
        var b = Math.min(e, a);
        var f = (1 - c) / (1 + b);
        var h = (1 - c) * b / (1 + b);
        var g = e > a || (e === a && d === A.UP);
        return [f, g ? c : h, g ? h : c]
    }
    function L(a, b, c) {
        return {
            scrollable: a.scrollable,
            scrollTop: b,
            scrollLeft: c
        }
    }
    function M(a, d, g, f) {
        var b = 1;
        var c = Math.max(g(a), b);
        var e = (c - g(d)) / c;
        return function(j) {
            var h = Math.max(g(j), b);
            var i = h - e * h;
            if (i < 1) {
                i = 0
            }
            return f(j, i)
        }
    }
    function W(a, c, f, d) {
        var b = f(a);
        var e = f(c) - b;
        return function(h) {
            var g = f(h) + e;
            return d(h, g)
        }
    }
    function V(i, j, f, a, e) {
        var b = j.clientHeight * i;
        var h = a(j.scrollable);
        var d = N(b, h);
        var c = f.map(function(k) {
            if (!k.canScrollVertically) {
                return null
            }
            return K(e(d.region, k.scrollable))
        });
        var g = F(b, d);
        return X.zip(c, f).map(P.spread(function(m, k) {
            if (!k.canScrollVertically) {
                return null
            }
            var l = k.clientHeight * i;
            var o = I(l, g, m);
            var n = k.scrollTop;
            return Math.max(0, n + m.offsetTop - o)
        }))
    }
    function F(d, b) {
        var a = b.offsetTop + b.height;
        var c = (a - d) / b.height;
        return Math.max(0, Math.min(1, c))
    }
    function I(c, b, a) {
        return (b * a.height) + c - a.height
    }
    function N(b, c) {
        var a;
        X.some(c, function(g) {
            var f = K(g);
            var e = f.offsetTop;
            var d = f.height;
            if (b > e && b <= e + d) {
                a = f;
                return true
            }
            return false
        });
        return a
    }
    function K(a) {
        return {
            region: a,
            offsetTop: a.getOffsetTop(),
            height: a.getHeight()
        }
    }
    function C(b) {
        var c = b.getScrollInfo();
        c = {
            scrollable: b,
            clientWidth: c.clientWidth,
            clientHeight: c.clientHeight,
            scrollWidth: c.width,
            scrollHeight: c.height,
            scrollTop: c.top,
            scrollLeft: c.left,
            canScrollHorizontally: c.clientWidth < c.width,
            canScrollVertically: c.clientHeight < c.height
        };
        var a = c.clientHeight / 2;
        c.topness = a ? Math.max(0, (a - c.scrollTop) / a) : 0;
        c.bottomness = a ? Math.max(0, 1 - (c.scrollHeight - (c.scrollTop + c.clientHeight)) / a) : 0;
        return c
    }
    function E(c) {
        c = X.extend({}, Y.getScrollHandler.defaults, c);
        var e = C(c.self);
        var d;
        var b = Q.enqueueCapped(requestAnimationFrame, function a() {
            var g = C(c.self);
            var h = X.map(c.others, C);
            var f = G(d, g, h, c.getRegions, c.getLinkedRegion, c.focusHeightFraction);
            e = g;
            if (f.length) {
                c.executeCommands(f)
            }
        });
        return {
            handle: function() {
                if (c.self.getAndUnsetProgrammaticScrollMarker()) {
                    e = C(c.self);
                    return
                }
                d = e;
                b()
            },
            reset: function() {
                e = C(c.self)
            }
        }
    }
    Y.createScrollable = S;
    Y.createRegion = D;
    Y.getScrollHandler = E;
    Y.getScrollHandler.defaults = {
        self: null,
        others: null,
        getRegions: null,
        getLinkedRegion: null,
        focusHeightFraction: 0.5,
        executeCommands: function(a) {
            X.forEach(a, function(b) {
                b.scrollable.scrollTo(b.scrollLeft, b.scrollTop)
            })
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:svg-util', location = '/static/util/svg.js' */
define("util/svg", ["lodash", "exports"], function(B, A) {
    var E = "http://www.w3.org/2000/svg";
    function D(G, F) {
        var H = document.createElementNS(E, G);
        B.forEach(F || [], function(J, I) {
            H.setAttribute(I, J)
        });
        return H
    }
    function C() {
        this._buffer = []
    }
    C.prototype.moveTo = function(F, G) {
        this._buffer.push("M", F, G);
        return this
    }
    ;
    C.prototype.curve = function(I, K, G, J, F, H) {
        this._buffer.push("C", I, K, G, J, F, H);
        return this
    }
    ;
    C.prototype.lineTo = function(F, G) {
        this._buffer.push("L", F, G);
        return this
    }
    ;
    C.prototype.close = function() {
        this._buffer.push("Z");
        return this
    }
    ;
    C.prototype.build = function() {
        return this._buffer.join(" ")
    }
    ;
    A.svgNS = E;
    A.createElement = D;
    A.PathBuilder = C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:side-by-side-diff-view', location = '/static/feature/file-content/side-by-side-diff-view/side-by-side-diff-view.soy' */
// This file was automatically generated from side-by-side-diff-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.sideBySideDiffView.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.sideBySideDiffView == 'undefined') {
    stash.feature.fileContent.sideBySideDiffView = {};
}

stash.feature.fileContent.sideBySideDiffView.layout = function(opt_data, opt_ignored) {
    return stash.feature.fileContent.diffView.editor({
        editorClass: 'side-by-side-diff-editor-from'
    }) + '<div class="segment-connector-column" ></div>' + stash.feature.fileContent.diffView.editor({
        editorClass: 'side-by-side-diff-editor-to'
    });
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.sideBySideDiffView.layout.soyTemplateName = 'stash.feature.fileContent.sideBySideDiffView.layout';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:side-by-side-diff-view', location = '/static/feature/file-content/side-by-side-diff-view/synchronized-scroll.js' */
define("feature/file-content/side-by-side-diff-view/synchronized-scroll", ["jquery", "lodash", "util/events", "util/function", "util/math", "util/synchronized-scroll", "feature/file-content/diff-view-segment-types", "exports"], function(E, K, N, H, I, C, A, D) {
    function P(T) {
        var W = null;
        var S = 0;
        var U = 0;
        var V = 0;
        var R = [];
        function Q() {
            if (W) {
                W.end = S;
                W.from.end = U;
                W.to.end = V;
                R.push(W)
            }
        }
        K.forEach(T, function(X) {
            if (!W || X.segment !== W.segment) {
                Q();
                W = {
                    segment: X.segment,
                    lineInfos: [],
                    start: S,
                    end: -1,
                    from: {
                        start: U,
                        end: -1,
                        lineInfos: []
                    },
                    to: {
                        start: V,
                        end: -1,
                        lineInfos: []
                    }
                }
            }
            S++;
            W.lineInfos.push(X);
            if (X.segment.type !== A.ADDED) {
                U++;
                W.from.lineInfos.push(X)
            }
            if (X.segment.type !== A.REMOVED) {
                V++;
                W.to.lineInfos.push(X)
            }
        });
        Q();
        return R
    }
    function M(R, Q) {
        this._id = R;
        this._editor = Q;
        this._programmatic = false
    }
    M.prototype.getScrollInfo = function() {
        return this._editor.getScrollInfo()
    }
    ;
    M.prototype.scrollTo = function(Q, R) {
        this._programmatic = this._programmatic || Q != null || R != null;
        this._editor.scrollTo(Q, R)
    }
    ;
    M.prototype.getAndUnsetProgrammaticScrollMarker = function() {
        var Q = this._programmatic;
        this._programmatic = false;
        return Q
    }
    ;
    function G(R, U, T, V, S, Q) {
        this._editor = R;
        this._startIndex = U;
        this._endIndex = T;
        this._numLines = T - U;
        this._id = V;
        this._seg = S;
        this._cachedInfo = null;
        this._lineInfos = Q
    }
    G.prototype.getHeight = function() {
        return this._getCachedInfo().height
    }
    ;
    G.prototype.getOffsetTop = function() {
        return this._getCachedInfo().offsetTop - this._editor.getScrollInfo().top
    }
    ;
    G.prototype._getCachedInfo = function() {
        if (!this._cachedInfo) {
            this._cachedInfo = {
                height: 0,
                offsetTop: this._editor.heightAtLine(this._startIndex, "local")
            };
            if (!this._numLines) {
                return this._cachedInfo
            }
            var Q = this._editor.heightAtLine(this._endIndex, "local");
            this._cachedInfo.height = Q - this._cachedInfo.offsetTop
        }
        return this._cachedInfo
    }
    ;
    G.prototype._invalidateCache = function() {
        this._cachedInfo = null
    }
    ;
    function L(T, S) {
        var Q, U, R;
        return {
            _linkedRegions: T,
            _seg: T[0]._seg,
            _id: "combined_" + K.pluck(T, "_id").join("_"),
            _scrollable: R,
            _setCombinedScrollable: function(V) {
                R = V;
                this._scrollable = V
            },
            getHeight: function() {
                if (Q == null) {
                    Q = T.map(function(V) {
                        return V.getHeight()
                    }).reduce(H.binary(Math.max), 0)
                }
                return Q
            },
            _getOffset: function() {
                if (U == null) {
                    U = S()
                }
                return U
            },
            getOffsetTop: function() {
                return this._getOffset() - R._getScrollTop()
            },
            _invalidateCache: function() {
                Q = null;
                U = null
            }
        }
    }
    function J(Q, Y) {
        this._id = Q;
        var U = H.constant(0);
        Y = E.extend({
            initialScrollTop: 0,
            getClientHeight: U,
            getScrollHeight: U
        }, Y);
        var V = false;
        var T = Y.initialScrollTop;
        var S;
        var X = E.Callbacks();
        this._getScrollTop = function W() {
            return I.clamp(0, Y.getScrollHeight() - Y.getClientHeight())(T)
        }
        ;
        function R(Z) {
            T = I.clamp(0, Y.getScrollHeight() - Y.getClientHeight())(Z)
        }
        this.scrollToNative = function(Z, a) {
            if (a != null) {
                R(a);
                if (S) {
                    S()
                }
                X.fire(Z, a, "native")
            }
        }
        ;
        this._setScrollHandler = function(Z) {
            S = Z
        }
        ;
        this.getScrollInfo = function() {
            return {
                top: this._getScrollTop(),
                left: 0,
                height: Y.getScrollHeight(),
                width: 0,
                clientHeight: Y.getClientHeight(),
                clientWidth: 0
            }
        }
        ;
        this.scrollTo = function(Z, a) {
            if (a != null) {
                V = true;
                R(a);
                X.fire(Z, a, "sync")
            }
        }
        ;
        this.on = function(a, Z) {
            if (a === "scroll") {
                X.add(Z)
            }
        }
        ;
        this.getAndUnsetProgrammaticScrollMarker = function() {
            var Z = V;
            V = false;
            return Z
        }
    }
    function O(W, V, S, Z, T) {
        var U = [];
        var X = [];
        function h(k, i, m, j, l) {
            return new G(k,i.start,i.end,l + "_" + i.start + "_" + i.end,m,j)
        }
        function d(k, l) {
            var j = h(S, k.from, k.segment, k.from.lineInfos, "from");
            var i = h(Z, l.to, l.segment, l.to.lineInfos, "to");
            U.push(j);
            X.push(i)
        }
        var g = P(V);
        var f = K.reduce(g, function(j, i) {
            if (j && i.segment.type === A.ADDED) {
                d(j, i);
                return null
            }
            if (j) {
                d(j, j)
            }
            if (i.segment.type === A.REMOVED) {
                return i
            }
            d(i, i);
            return null
        }, null);
        if (f) {
            d(f, f)
        }
        var e = K.zip(U, X);
        var a = K.compose(H.partialRight(K.reduce, I.add, 0), H.partialRight(K.invoke, "getHeight"), K.take);
        var Q = T.includeCombinedRegions ? K.reduce(e, function(i, j, k) {
            var l = K.partial(a, i, k);
            i.push(L(j, l));
            return i
        }, []) : [];
        var c = {};
        if (Q.length) {
            K.chain(U).zip(X, Q).forEach(H.spread(function(j, i, k) {
                c[j._id] = [i, k];
                c[i._id] = [j, k];
                c[k._id] = [j, i]
            })).value()
        } else {
            K.forEach(e, H.spread(function(j, i) {
                c[j._id] = [i];
                c[i._id] = [j]
            }))
        }
        function Y(i) {
            return K.invoke.bind(K, i, "_invalidateCache")
        }
        S.on("change", Y(U.concat(Q)));
        Z.on("change", Y(X.concat(Q)));
        var b = Y(U.concat(X, Q));
        E(window).on("resize", b);
        W.on("widgetAdded", b);
        W.on("widgetChanged", b);
        W.on("widgetCleared", b);
        W.on("internal.acceptedModification", b);
        var R = N.chain().on("stash.feature.changeset.difftree.collapseAnimationFinished", b);
        return {
            combinedSegments: g,
            fromRegions: U,
            toRegions: X,
            combinedRegions: Q,
            linkedFromAndToRegions: e,
            linkedRegionsByRegionId: c,
            destroy: function() {
                R.destroy();
                E(window).off("resize", b)
            }
        }
    }
    function F(Y, R, U, Q, Z, e) {
        var X = {};
        X[R._id] = Z.fromRegions;
        X[U._id] = Z.toRegions;
        if (Q) {
            X[Q._id] = Z.combinedRegions
        }
        var d = K.compose(H.lookup(X), H.dot("_id"));
        var S = K.compose(H.lookup(Z.linkedRegionsByRegionId), H.dot("_id"));
        function T(h, g) {
            var f = S(h) || [];
            return K.find(f, H.dotEq("_editor", g._editor))
        }
        function a(f) {
            f.scrollable.scrollTo(f.scrollLeft, f.scrollTop)
        }
        function W(f) {
            Y.operation(K.forEach.bind(K, f, a));
            Y.trigger("sync-scroll")
        }
        function c(f, i, g) {
            var j;
            if (g.includeHorizontal) {
                j = W
            } else {
                var h = H.partialRight(K.map, H.unary(H.partialRight(K.omit, "scrollLeft")));
                j = K.compose(W, h)
            }
            return C.getScrollHandler({
                self: f,
                others: i,
                getRegions: d,
                getLinkedRegion: T,
                executeCommands: j,
                focusHeightFraction: g.focusHeightFraction
            })
        }
        var b = {
            includeHorizontal: true,
            focusHeightFraction: e.focusHeightFraction
        };
        var V = {
            fromHandler: c(R, K.compact([U, Q]), b),
            toHandler: c(U, K.compact([R, Q]), b)
        };
        if (Q) {
            V.combinedHandler = c(Q, [R, U], {
                includeHorizontal: false,
                focusHeightFraction: e.focusHeightFraction
            })
        }
        return V
    }
    function B(X, S, Q, c, e) {
        e = e || {};
        var W = O(X, S, Q, c, {
            includeCombinedRegions: e.includeCombinedScrollable
        });
        var T = new M("from",Q);
        var U = new M("to",c);
        var a = 0;
        var R;
        if (e.includeCombinedScrollable) {
            R = new J("combined",{
                getScrollHeight: function Z() {
                    return K.chain(W.combinedRegions).invoke("getHeight").reduce(I.add, 0).value()
                },
                getClientHeight: function b() {
                    return a
                }
            })
        }
        var V = F(X, T, U, R, W, e);
        Q.on("scroll", V.fromHandler.handle);
        c.on("scroll", V.toHandler.handle);
        var Y = {
            combinedSegments: W.combinedSegments,
            combinedRegions: W.combinedRegions,
            combinedScrollable: R,
            linkedFromAndToRegions: W.linkedFromAndToRegions,
            destroy: function() {
                Q.off("scroll", V.fromHandler.handle);
                c.off("scroll", V.toHandler.handle);
                W.destroy()
            }
        };
        if (R) {
            R._setScrollHandler(V.combinedHandler.handle);
            R.setClientHeight = function(f) {
                R.clientHeight = f;
                a = f;
                V.combinedHandler.reset()
            }
            ;
            K.invoke(W.combinedRegions, "_setCombinedScrollable", R);
            Y.combinedScrollable = R
        }
        var d = K.invoke.bind(K, V, "reset");
        X.on("widgetCleared", d);
        X.on("widgetChanged", d);
        X.on("widgetAdded", d);
        return Y
    }
    D.setupScrolling = B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:side-by-side-diff-view', location = '/static/feature/file-content/side-by-side-diff-view/side-by-side-diff-view.js' */
define("feature/file-content/side-by-side-diff-view", ["jquery", "lodash", "util/events", "util/feature-enabled", "util/function", "util/math", "util/performance", "util/svg", "model/direction", "feature/file-content/diff-hunk-map", "feature/file-content/diff-line-info", "feature/file-content/diff-view", "feature/file-content/diff-view-file-types", "feature/file-content/diff-view-segment-types", "feature/file-content/line-handle", "feature/file-content/side-by-side-diff-view/synchronized-scroll", "feature/file-content/stash-codemirror/search"], function(H, a, C, D, M, E, P, T, B, F, I, L, G, N, W, K) {
    var Y = N.ADDED;
    var U = N.CONTEXT;
    var O = N.REMOVED;
    function Q(c, b) {
        b.combineLinkedSegments = true;
        L.apply(this, arguments)
    }
    a.extend(Q.prototype, L.prototype);
    Q.defaults = L.defaults;
    Q.prototype.init = function() {
        var c = this;
        if (!this._$container) {
            return
        }
        this._$container.addClass("side-by-side-diff");
        this._$container.append(stash.feature.fileContent.sideBySideDiffView.layout());
        this.fromEditorEl = this._$container.find(".side-by-side-diff-editor-from");
        this.toEditorEl = this._$container.find(".side-by-side-diff-editor-to");
        var d = this._options.commentContext && this._options.commentContext.getGutterId();
        if (d) {
            this.registerGutter(d, {
                weight: 100
            })
        }
        this.registerGutter("line-number-from", {
            weight: 200,
            fileType: G.FROM
        });
        this.registerGutter("line-number-to", {
            weight: 200,
            fileType: G.TO
        });
        this._fromEditor = this._createEditor({
            gutterFilter: function(e) {
                return !e.fileType || e.fileType === G.FROM
            }
        }, this.fromEditorEl);
        this._toEditor = this._createEditor({
            gutterFilter: function(e) {
                return !e.fileType || e.fileType === G.TO
            }
        }, this.toEditorEl);
        D.getFromProvider("source.codemirror").then(function(j) {
            if (!j) {
                return
            }
            var l = M.dot("hunks.0.segments.0")(c._data);
            var k = M.dot("hunks.0.segments.0.lines.0.line")(c._data);
            var i = M.dot("hunks.0.segments.1.lines.0.line")(c._data);
            var e = l.type === Y ? i : k;
            var g = c._options.fileChange.srcPath !== null ? c._options.fileChange.srcPath.name : c._options.fileChange.path.name;
            c._syntaxHighlighting(g, e, c._fromEditor);
            var h = l.type === O ? i : k;
            var f = c._options.fileChange.path.name;
            c._syntaxHighlighting(f, h, c._toEditor)
        });
        this._lineInfos = I.convertToLineInfos(this._data, this._options);
        this._scrollingReady.always(function() {
            c._modifyDiff("INITIAL", c._data, c._lineInfos);
            c._setupFindScrollIntoViewFunction(c._fromEditor, G.FROM);
            c._setupFindScrollIntoViewFunction(c._toEditor, G.TO)
        });
        this.on("internal-load", function() {
            if (!this._syncScrollingInfo) {
                return
            }
            this.setupHunkmaps(this._syncScrollingInfo.linkedFromAndToRegions);
            this._initSegmentLinking(this._syncScrollingInfo.linkedFromAndToRegions);
            this.on("internal-change", function e() {
                this._whenOpDone(this._scrollEditorToFirstChange.bind(this));
                this.off("internal-change", e)
            })
        });
        var b = c.refresh.bind(c);
        C.on("stash.feature.sidebar.expandEnd", b);
        C.on("stash.feature.sidebar.collapseEnd", b);
        C.on("stash.feature.changeset.difftree.collapseAnimationFinished", b);
        L.prototype.init.call(this)
    }
    ;
    Q.prototype.destroy = function() {
        L.prototype.destroy.call(this);
        this._fromEditor = null;
        this._toEditor = null
    }
    ;
    Q.prototype._acceptModification = function(c, h, e) {
        if (c !== "INITIAL") {
            throw new Error("Unrecognized change type: " + c)
        }
        var d = a.filter(e, function(i) {
            return i.lineType !== Y
        });
        var f = a.filter(e, function(i) {
            return i.lineType !== O
        });
        this._fromEditor.setValue(L._combineTexts(d));
        this._toEditor.setValue(L._combineTexts(f));
        function g(j, i) {
            return j.segment !== i.segment && j.lineType === N.CONTEXT && i.lineType === N.CONTEXT
        }
        function b(i, j, k) {
            var l;
            a.forEach(i, function(m, n) {
                var o = j.getLineHandle(n);
                m._setHandle(k, new W(k,m.lineType,m.lineNumber,o));
                if (l && g(l, m)) {
                    j.addLineClass(o, "wrap", "paired-with-change")
                }
                l = m
            })
        }
        b(d, this._fromEditor, G.FROM);
        b(f, this._toEditor, G.TO)
    }
    ;
    var S = {};
    S[G.FROM] = "_fromEditor";
    S[G.TO] = "_toEditor";
    Q.prototype._editorForHandle = function(b) {
        return this[S[b.fileType]]
    }
    ;
    Q.prototype._getFocusSegment = function(d) {
        var b = this._fromEditor.getScrollInfo().clientHeight * this._options.focusPoint;
        if (d > b) {
            return null
        }
        var e = 1;
        var f = b + this._syncScrollingInfo.combinedScrollable._getScrollTop() - d + e;
        f = Math.ceil(f);
        var c = a.find(this._syncScrollingInfo.combinedRegions, function(g) {
            return g._getOffset() <= f && (g._getOffset() + g.getHeight()) > f
        });
        return (c || a.last(this._syncScrollingInfo.combinedRegions))._seg
    }
    ;
    Q.prototype._setFocusSegment = function(d) {
        var g = a.filter(this._syncScrollingInfo.combinedRegions, function(h) {
            return a.contains(d, h._seg)
        });
        var b = this._fromEditor.getScrollInfo().clientHeight * this._options.focusPoint;
        this._scrollToSourcePosition(null, g[0]._getOffset() - b);
        var f = a.chain(g).pluck("_linkedRegions").flatten().pluck("_lineInfos").flatten().uniq().value();
        function e(i, h) {
            return a.compact(i.map(function(j) {
                return j.handles[h]
            }))
        }
        var c = this;
        this.operation(function() {
            c._markLinesFocused([{
                editor: c._fromEditor,
                handles: e(f, G.FROM)
            }, {
                editor: c._toEditor,
                handles: e(f, G.TO)
            }])
        })
    }
    ;
    Q.prototype._findNextAnchor = function(g, f, b) {
        var d = a.groupBy(f, M.dot("_fileType"));
        var c = d.FROM && this._findNextAnchorInEditor(this._fromEditor, d.FROM, g, b);
        var e = d.TO && this._findNextAnchorInEditor(this._toEditor, d.TO, g, b);
        if (!c || !e) {
            return c || e || null
        } else {
            if ((g === B.UP && e.offset < c.offset) || (g === B.DOWN && e.offset >= c.offset)) {
                return c
            } else {
                return e
            }
        }
    }
    ;
    Q.prototype.setupHunkmaps = function(h) {
        var k = this;
        var f = h.map(a.first);
        var c = h.map(a.last);
        var e = this._options.focusPoint;
        function g(s, p, y) {
            var o = s.getScrollInfo();
            var x = o.height;
            var r = o.clientHeight;
            var m = Math.max(0, (x * y) - (r * e));
            var v = a.findIndex(p, function(AA) {
                var z = o.top + AA.getOffsetTop();
                return z <= m && z + AA.getHeight() > m
            });
            var w = p[v];
            var l = k._syncScrollingInfo.combinedRegions[v];
            var u = k._syncScrollingInfo.combinedScrollable.getScrollInfo();
            var t = m - (o.top + w.getOffsetTop());
            var q = t / w.getHeight();
            var n = (u.top + l.getOffsetTop()) + q * l.getHeight();
            k._scrollToSourcePosition(0, n)
        }
        var b = new F(this.fromEditorEl,f,{
            scrollToFn: a.partial(g, this._fromEditor, f)
        });
        var i = new F(this.toEditorEl,c,{
            scrollToFn: a.partial(g, this._toEditor, c)
        });
        var d = [b, i];
        var j = a.debounce(a.invoke.bind(a, d, "redraw"), 100);
        this._addDestroyable(b);
        this._addDestroyable(i);
        this.on("widgetAdded", j);
        this.on("widgetChanged", j);
        this.on("widgetCleared", j);
        this.on("resize", j);
        this._fromEditor.on("scroll", function(l) {
            b.diffScrolled(l.getScrollInfo())
        });
        this._toEditor.on("scroll", function(l) {
            i.diffScrolled(l.getScrollInfo())
        });
        this._addDestroyable(function() {
            k._fromEditor = null;
            k._toEditor = null
        })
    }
    ;
    Q.prototype._attachScrollBehavior = function() {
        var b = this;
        var i = this._fromEditor;
        var g = this._toEditor;
        var f = this._lineInfos;
        if (!i) {
            return H.Deferred().reject()
        }
        var e = K.setupScrolling(this, f, i, g, {
            includeCombinedScrollable: true,
            focusHeightFraction: b._options.focusPoint
        });
        this._syncScrollingInfo = e;
        var d = b._$container.children(".diff-editor, .segment-connector-column");
        var c;
        var h = this._requestWindowScrolls({
            scrollSizing: function() {
                return e.combinedScrollable.getScrollInfo()
            },
            scroll: function(j, k) {
                if (k != null) {
                    e.combinedScrollable.scrollToNative(null, k)
                }
            },
            resize: function(k, j) {
                if (c !== j) {
                    c = j;
                    e.combinedScrollable.setClientHeight(j);
                    d.height(j);
                    b.refresh()
                }
            },
            onSizeChange: function(j) {
                b.on("resize", j)
            }
        });
        this._addDestroyable(e);
        return h
    }
    ;
    Q.prototype._initSegmentLinking = function(e) {
        var g = H(".segment-connector-column");
        var f = T.createElement("svg", {});
        g.append(f);
        var b = V.bind(null, A(e), f, this._getLineClasses);
        var c = P.enqueueCapped(requestAnimationFrame, function c() {
            f.setAttribute("height", g.height());
            f.setAttribute("width", g.width());
            b()
        });
        var d = P.enqueueCapped(requestAnimationFrame, b);
        this.on("sync-scroll", b);
        this.on("widgetAdded", d);
        this.on("widgetChanged", d);
        this.on("widgetCleared", d);
        this.on("resize", c);
        c()
    }
    ;
    Q.prototype.scrollHandleIntoFocus = function(d) {
        var e = this._editorForHandle(d);
        var k = e.getScrollInfo();
        var j = d.fileType === G.FROM ? 0 : 1;
        if (d.lineType === U && d.fileType === G.TO) {
            e = this._fromEditor;
            j = 0
        }
        var h = a.findIndex(this._syncScrollingInfo.linkedFromAndToRegions, function(l) {
            return l[j]._startIndex <= d.lineNumber && l[j]._endIndex > d.lineNumber
        });
        var i = this._syncScrollingInfo.linkedFromAndToRegions[h][j];
        var b = this._syncScrollingInfo.combinedRegions[h];
        var g = e.heightAtLine(d.lineNumber) - e.heightAtLine(i._startIndex);
        var f = this._syncScrollingInfo.combinedScrollable.getScrollInfo();
        var c = (f.top + b.getOffsetTop()) + g;
        this._scrollToFocusedOffset(c, k, e)
    }
    ;
    Q.prototype._setupFindScrollIntoViewFunction = function(d, b) {
        var c = this;
        d.setOption("scrollLineIntoViewFunc", function(e) {
            c.scrollHandleIntoFocus(c.getLineHandleFromNumber(e.from.line, b))
        })
    }
    ;
    function R(b) {
        return b && b.type !== N.CONTEXT
    }
    function J(b) {
        return R(b && b._seg) && b._numLines > 0
    }
    function X(b) {
        return Boolean(b.lines[0].conflictMarker)
    }
    function Z(b) {
        return b.conflicted || X(b._seg)
    }
    Q.prototype._scrollEditorToFirstChange = function() {
        var b = this._findNextChange(null, this._allSegments);
        if (b) {
            this._setFocusSegment(b)
        }
    }
    ;
    function A(d) {
        function c(f) {
            if (!(this instanceof c)) {
                return new c(f)
            }
            this._regions = [f];
            this.conflicted = true;
            this.classesInfo = {
                lineType: f._seg.type,
                conflictMarker: f._seg.lines[0].conflictMarker
            };
            this.getOffsetTop = function() {
                return this._regions[0].getOffsetTop()
            }
            ;
            this.getHeight = function() {
                return a.chain(this._regions).invoke("getHeight").reduce(E.add).value()
            }
            ;
            this.push = function(g) {
                this._regions.push(g)
            }
        }
        return d.reduce(function e(f, h) {
            var i = f.previous;
            var j = i && a.some(i, Z);
            var g = a.some(h, Z);
            if (g && j) {
                a.forEach(i, function(k, l) {
                    k.push(h[l])
                });
                return f
            }
            if (g) {
                h = a.map(h, c)
            }
            f.previous = h;
            f.regions.push(h);
            return f
        }, {
            previous: null,
            regions: []
        }).regions.filter(function b(f) {
            return f.some(M.or(J, Z))
        })
    }
    function V(o, t, p) {
        var u;
        var m = t.offsetHeight || parseFloat((u = window.getComputedStyle(t)).height);
        var r = t.offsetWidth || parseFloat(u.width);
        var l = r + 1;
        var k = r * 0.4;
        var g = r * 0.6;
        var j = o.map(function i(w) {
            return w.map(function(y) {
                var z = y.getOffsetTop();
                var x = z + y.getHeight();
                return {
                    region: y,
                    top: z + 0.5,
                    bottom: x + 0.5,
                    above: z < 0,
                    inside: x > 0 && z < m,
                    below: x > m
                }
            })
        });
        var n = j.filter(function s(w) {
            return w.some(M.dot("inside")) || (w.some(M.dot("above")) && w.some(M.dot("below")))
        });
        function e(w, x) {
            return new T.PathBuilder().moveTo(-1, w.top).curve(k, w.top, g, x.top, l, x.top).lineTo(l, x.bottom).curve(g, x.bottom, k, w.bottom, -1, w.bottom).close().build()
        }
        function v(w, x) {
            if (w.region.classesInfo) {
                return w.region.classesInfo
            }
            var z = w.region._lineInfos[0];
            var y = x.region._lineInfos[0];
            return z ? {
                conflictMarker: z.line.conflictMarker,
                lineType: z.lineType
            } : {
                conflictMarker: null,
                lineType: y.lineType
            }
        }
        function d(y, AA) {
            var z = v(y, AA);
            var x = v(AA, y);
            var w = p(z.lineType, z.conflictMarker, false) + " " + p(x.lineType, x.conflictMarker, false);
            return a.unique(w.split(/\s+/)).join(" ")
        }
        var f = n.map(M.spread(function(w, x) {
            return {
                path: e(w, x),
                extraClasses: d(w, x)
            }
        }));
        while (t.hasChildNodes()) {
            t.removeChild(t.firstChild)
        }
        var q = function(w) {
            return (w.indexOf("added") !== -1) && (w.indexOf("removed") !== -1)
        };
        var c = a.once(function(x) {
            var w = [{
                "class": "removed",
                offset: "0%"
            }, {
                "class": "removed",
                offset: "30%"
            }, {
                "class": "added",
                offset: "70%"
            }, {
                "class": "added",
                offset: "100%"
            }];
            w = a.map(w, T.createElement.bind(T, "stop"));
            return a.reduce(w, function(z, y) {
                z.appendChild(y);
                return z
            }, T.createElement("linearGradient", {
                id: x
            }))
        });
        var h = "added-and-removed-svg-gradient";
        var b = f.map(function(x) {
            var w = {
                "class": "segment-connector " + x.extraClasses,
                d: x.path
            };
            if (q(x.extraClasses)) {
                w.fill = "url(#" + h + ")"
            }
            return T.createElement("path", w)
        }).concat(c(h)).reduce(function(x, w) {
            x.appendChild(w);
            return x
        }, document.createDocumentFragment());
        t.appendChild(b)
    }
    return Q
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:skipped-container', location = '/static/feature/file-content/skipped-container/skipped-container.soy' */
// This file was automatically generated from skipped-container.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}

stash.feature.fileContent.skippedContainer = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="skipped-container' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.hasContentAbove) ? '<div class="content-above"></div>' : '') + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + ((opt_data.canShowMore) ? '<div class="showmore" title="' + soy.$$escapeHtml(opt_data.showMoreTooltip) + '">' + ((opt_data.hasContentAbove && opt_data.hasContentBelow) ? '<span>' + soy.$$escapeHtml("Show more") + '</span>' : '') + '</div>' : '') + ((opt_data.hasContentBelow) ? '<div class="content-below"></div>' : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.skippedContainer.soyTemplateName = 'stash.feature.fileContent.skippedContainer';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-context', location = '/static/feature/file-content/diff-view-context/diff-view-context-internal.js' */
define("feature/file-content/diff-view-context/diff-view-context-internal", ["jquery", "lodash", "util/function", "model/file-change-types", "feature/file-content/diff-view-segment-types", "exports"], function(E, I, H, B, A, D) {
    var C = {
        destinationLine: 1,
        destinationSpan: 0,
        sourceLine: 1,
        sourceSpan: 0
    };
    var G = H.eq(A.ADDED);
    D.isAdded = G;
    D.getSeparatedHunkHtml = function(R, N, L) {
        function M(S) {
            switch (S) {
            case B.ADD:
                return A.ADDED;
            case B.DELETE:
                return A.REMOVED;
            default:
                return A.CONTEXT
            }
        }
        var K = M(N);
        var O = G(K);
        function Q(S) {
            return {
                line: O ? S.destinationLine : S.sourceLine,
                span: O ? S.destinationSpan : S.sourceSpan
            }
        }
        function P(S) {
            return (S.sourceLine + S.sourceSpan) - (S.destinationLine + S.destinationSpan)
        }
        return I.map(I.zip([C].concat(R), R.concat({})), function(V) {
            var U = Q(V[0]);
            var Z = Q(V[1]);
            var S = Z.line > 1;
            var T = U.span > 0;
            var W = U.line + U.span;
            var X = Z.line - 1;
            var Y = O ? 0 : P(V[0]);
            return L(W, X, Y, K, S, T)
        })
    }
    ;
    D.fetchContext = function F(R, Q, P, K, N) {
        var L = !isNaN(Q) ? Q - R + 1 : N.maxLimit;
        function O(T, U, S) {
            return T && I.extend({}, T, {
                lines: T.lines.slice(U, S)
            })
        }
        var M = function(S) {
            return E.when(R === 0 ? null : S(R, K + (!Q ? 1 : 0)), !Q ? null : S(R + L - K, K)).then(function(U, T) {
                if (!T) {
                    var V = U.lines.length > K;
                    return {
                        startSep: U.start + U.lines.length + (V ? -1 : 0),
                        contexts: V ? [O(U, 0, -1), null] : [U]
                    }
                } else {
                    if (!U) {
                        return {
                            startSep: 0,
                            endSep: T.start,
                            contexts: [null, T]
                        }
                    } else {
                        return {
                            startSep: U.start + K,
                            endSep: T.start,
                            contexts: [U, T]
                        }
                    }
                }
            })
        };
        if (L < N.maxLimit) {
            return P(R, L).then(function(S) {
                if (L <= K * 2) {
                    return E.Deferred().resolve({
                        startSep: 0,
                        endSep: 0,
                        contexts: [S]
                    })
                } else {
                    return M(function(T) {
                        return E.Deferred().resolve({
                            start: T,
                            lines: S.lines
                        })
                    }).then(function(T) {
                        return I.extend({}, T, {
                            contexts: [O(T.contexts[0], 0, K), O(T.contexts[1], -K)]
                        })
                    })
                }
            })
        } else {
            return M(P)
        }
    }
    ;
    D.toHunks = function J(N, K) {
        function L(O) {
            return O + 1
        }
        return function M(O) {
            var Q = [];
            I.each(O.contexts, function P(R) {
                if (R) {
                    Q.push({
                        segments: [{
                            type: K,
                            lines: I.map(R.lines, function(S) {
                                return {
                                    line: S.text
                                }
                            })
                        }],
                        sourceLine: L(R.start),
                        destinationLine: L(R.start) - N,
                        isLastPage: R.isLastPage
                    })
                }
            });
            return Q.length ? Q : ""
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-context', location = '/static/feature/file-content/diff-view-context/diff-view-context.soy' */
// This file was automatically generated from diff-view-context.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}

stash.feature.fileContent.hunkSeparator = function(opt_data, opt_ignored) {
    return '' + stash.feature.fileContent.skippedContainer({
        hasContentAbove: opt_data.isAbove,
        hasContentBelow: opt_data.isBelow,
        canShowMore: true,
        showMoreTooltip: opt_data.tooltip,
        extraAttributes: 'data-line-start="' + soy.$$escapeHtml(opt_data.lineStart) + '"' + ((opt_data.lineEnd) ? ' data-line-end="' + soy.$$escapeHtml(opt_data.lineEnd) + '"' : '') + ' data-dest-offset="' + soy.$$escapeHtml(opt_data.destOffset) + '" data-change-type="' + soy.$$escapeHtml(opt_data.changeType) + '" data-below="' + soy.$$escapeHtml(opt_data.isBelow) + '" data-above="' + soy.$$escapeHtml(opt_data.isAbove) + '"'
    });
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.hunkSeparator.soyTemplateName = 'stash.feature.fileContent.hunkSeparator';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-view-context', location = '/static/feature/file-content/diff-view-context/diff-view-context.js' */
define("feature/file-content/diff-view-context", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/ajax", "util/dom-event", "util/navigator", "model/file-change", "feature/file-content/diff-view-context/diff-view-context-internal", "exports"], function(L, E, M, A, K, C, J, F, G, D) {
    var N = J.isMac() ? "Click to reveal a few more lines\nCmd + Click to reveal them all" : "Click to reveal a few more lines\nCtrl + Click to reveal them all";
    var I = A.parse(location.href).getQueryParamValue("context");
    var B = {
        maxLimit: J.isIE() ? 1000 : 5000,
        maxContext: (I && parseInt(I, 10)) || 10
    };
    function H(R, S, T, O, P, Q) {
        return (P || Q) ? stash.feature.fileContent.hunkSeparator({
            tooltip: N,
            lineStart: R,
            lineEnd: S,
            destOffset: T,
            changeType: O,
            isBelow: P,
            isAbove: Q
        }) : ""
    }
    D.attachExpandContext = function(P, O, Q) {
        O = new F(O);
        return P.on("click", ".skipped-container:not(.loading)", function(U) {
            U.preventDefault();
            var Z = E(U.currentTarget);
            Z.addClass("loading");
            Z.find(".showmore span").html("&nbsp;");
            var R = Z.find(".showmore").spin("small");
            var Y = Z.data("change-type");
            function V(c, a) {
                var b = O.getDiff() && O.getDiff().properties || {};
                return K.rest({
                    statusCode: {
                        "200": function(g, d, f, e) {
                            if (e && e.message && e.message.replace(/,/g, "").indexOf(" " + c + " ") > 0) {
                                return {
                                    promise: function() {
                                        return {
                                            lines: []
                                        }
                                    }
                                }
                            }
                        }
                    },
                    url: A.currentRepo().browse().path((O.getSrcPath() && O.getSrcPath().toString() !== "") ? O.getSrcPath() : O.getPath()).at(G.isAdded(Y) ? b.toHash || O.getCommitRange().getUntilRevision().getId() : b.fromHash || O.getCommitRange().getSinceRevision().getId()).withParams({
                        start: c,
                        limit: a
                    }).build()
                }).then(M.identity).always(function() {
                    R.spinStop()
                }).fail(function() {
                    Z.removeClass("loading")
                })
            }
            var S = Z.data("dest-offset");
            var W = C.isCtrlish(U) ? B.maxLimit - 1 : B.maxContext;
            var X = Z.data("line-start") - 1;
            var T = Z.data("line-end") - 1;
            G.fetchContext(X, T, V, W, B).then(G.toHunks(S, Y)).then(M.bind(Q, null, O, Z))
        })
    }
    ;
    D.getSeparatedHunkHtml = function(P, O) {
        return G.getSeparatedHunkHtml(P, O, H)
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:unified-diff-view', location = '/static/feature/file-content/unified-diff-view/unified-diff-view.js' */
define("feature/file-content/unified-diff-view", ["jquery", "lodash", "util/events", "util/feature-enabled", "util/function", "model/file-change-types", "feature/file-content/diff-line-info", "feature/file-content/diff-view", "feature/file-content/diff-view-context", "feature/file-content/diff-view-file-types", "feature/file-content/diff-view-options", "feature/file-content/diff-view-segment-types", "feature/file-content/line-handle", "feature/file-content/text-view/attach-simple-scroll-behavior", "feature/file-content/stash-codemirror/search"], function(F, S, A, B, J, N, G, I, L, D, M, K, Q, R) {
    function P(T) {
        var V = T.destinationLine;
        var U = T.sourceLine;
        T.segments[0].lines = S.map(T.segments[0].lines, function(W) {
            W.destination = V++;
            W.source = U++;
            return W
        });
        return T
    }
    function O(Z, a) {
        if (!a.linesAdded) {
            return
        }
        var X = a.diff;
        var V = L.getSeparatedHunkHtml(X.hunks, Z._options.fileChange.type);
        var U;
        var T = [];
        var W;
        var Y;
        a.eachLine(function(c) {
            var b = c.handles.FROM || c.handles.TO;
            if (c.hunk !== Y) {
                Y = c.hunk;
                T.push(b)
            }
            W = b
        }).done(function() {
            switch (a.type) {
            case "INSERT":
                var f = T[0];
                var b = Z._editor.getLineNumber(f._handle);
                var c = b === 0;
                var d = Z._editor.lastLine() - a.linesAdded;
                var e = b > d;
                if (X.hunks.length > 1) {
                    T.shift();
                    V.shift();
                    V.pop();
                    W = undefined
                } else {
                    if (!c) {
                        T.shift();
                        V.shift()
                    }
                    if (!e) {
                        V.pop();
                        W = undefined
                    } else {
                        U = V.pop()
                    }
                }
                break;
            case "INITIAL":
                if (T.length === V.length - 1) {
                    U = V.pop()
                }
                break;
            default:
                throw new Error("Unrecognized change type: " + a.type)
            }
            Z.operation(function() {
                S.each(S.zip(V, T), J.spread(S.partial(C, Z, !!"isAbove")));
                if (U && !Z._isEntireFile()) {
                    C(Z, !"isAbove", U, W)
                }
            })
        })
    }
    function C(Y, U, T, X) {
        if (!T) {
            return
        }
        var V = F(T);
        var W = Y.addLineWidget(X, V[0], {
            coverGutter: true,
            noHScroll: true,
            above: U
        });
        if (U) {
            Y.addLineClass(X, "wrap", "first-line-of-hunk")
        }
        V.data("widget", W)
    }
    function E(T) {
        T && T.clear()
    }
    function H(U, T) {
        I.apply(this, arguments)
    }
    S.extend(H.prototype, I.prototype);
    H.defaults = I.defaults;
    H.prototype.init = function() {
        if (!this._$container) {
            return
        }
        var U = this;
        this._$container.addClass("unified-diff");
        this.on("internal-change", S.partial(O, this));
        if (!this._options.isExcerpt) {
            L.attachExpandContext(this._$container, this._options.fileChange, this._expandContextLines)
        }
        this._$container.append(stash.feature.fileContent.unifiedDiffView.layout());
        var V = this._options.commentContext && this._options.commentContext.getGutterId();
        if (V) {
            this.registerGutter(V, {
                weight: 100
            })
        }
        this.registerGutter("line-number-from", {
            weight: 200
        });
        this.registerGutter("line-number-to", {
            weight: 300
        });
        this.registerGutter("gutter-border", {
            weight: 1500
        });
        this._editor = this._createEditor({}, this._$container.children(".diff-editor"));
        var T = M.getOptions().diffType === "side-by-side";
        if (this._isEntireFile() && T) {
            B.getFromProvider("source.codemirror").then(function(X) {
                if (!X) {
                    return
                }
                var W = J.dot("hunks.0.segments.0.lines.0.line")(U._data);
                U._syntaxHighlighting(U._options.fileChange.path.name, W, U._editor)
            })
        }
        this._addDestroyable(function() {
            U._editor = null
        });
        this._scrollingReady.always(function() {
            U._editor.setOption("scrollLineIntoViewFunc", function(W) {
                var X = U._editor.getLineHandle(W.from.line)._stashHandle;
                U.scrollHandleIntoFocus(X)
            });
            U._modifyDiff("INITIAL", U._data, G.convertToLineInfos(U._data, U._options))
        });
        I.prototype.init.call(this)
    }
    ;
    H.prototype._acceptModification = function(U, X, V, T) {
        T = T || 0;
        var W = this._editor;
        var Y = I._combineTexts(V);
        switch (U) {
        case "INITIAL":
            W.setValue(Y);
            break;
        case "INSERT":
            W._insert(Y, T, true);
            break;
        default:
            throw new Error("Unrecognized change type: " + U)
        }
        S.each(V, function(Z, a) {
            var b = new Q(undefined,Z.lineType,Z.lineNumber,W.getLineHandle(a + T));
            if (Z.lineType !== K.ADDED) {
                Z._setHandle(D.FROM, b)
            }
            if (Z.lineType !== K.REMOVED) {
                Z._setHandle(D.TO, b)
            }
        })
    }
    ;
    H.prototype._getFocusSegment = function(X) {
        var W = this._editor;
        var a = W.getScrollInfo();
        var Z = Math.ceil(a.clientHeight * this._options.focusPoint) - Math.floor(X);
        if (Z < 0) {
            return null
        }
        var Y = 1;
        var V = Math.min(W.lastLine(), W.lineAtHeight(a.top + Z + Y, "local"));
        var U = W.getLineHandle(V);
        var T = this._internalLines[U._stashHandle.lineType][U._stashHandle.lineNumber];
        return T && T.segment
    }
    ;
    H.prototype._setFocusSegment = function(T) {
        var V = T[0];
        this.scrollHandleIntoFocus(this.getLineHandle(V.lines && V.lines[0]));
        var U = S.chain(T).pluck("lines").flatten().map(this.getLineHandle).value();
        this._markLinesFocused([{
            editor: this._editor,
            handles: U
        }])
    }
    ;
    H.prototype._getFocusLine = function() {
        var X = this._editor;
        var U = X.getScrollInfo();
        var b = this._$fileToolbar && this._$fileToolbar.outerHeight();
        var Y = this._$container[0].getBoundingClientRect().top - b;
        var W = Math.ceil(U.clientHeight * this._options.focusPoint) - (this._editorInnerOffset() - Math.abs(Y));
        var V = Y <= 0 ? W : 0;
        var a = 1;
        var Z = Math.min(X.lastLine(), X.lineAtHeight(U.top + V + a, "local"));
        var T = X.getLineHandle(Z);
        return T._stashHandle
    }
    ;
    H.prototype._findNextAnchor = function(V, U, T) {
        return this._findNextAnchorInEditor(this._editor, U, V, T)
    }
    ;
    H.prototype._attachScrollBehavior = function() {
        return R(this, this._editor, this._$container.children(".diff-editor"))
    }
    ;
    H.prototype._editorForHandle = function() {
        return this._editor
    }
    ;
    H.prototype._isEntireFile = function() {
        var T = this._options.fileChange.type === N.ADD || this._options.fileChange.type === N.DELETE;
        return T && !this._options.isExcerpt
    }
    ;
    H.prototype._expandContextLines = function(T, U, Z) {
        if (!this._editor) {
            return
        }
        var X = this.getLineHandle(U);
        var W = this._editor.getLineNumber(X._handle);
        var V = this._editor.lastLine() === W ? W + 1 : W;
        this.removeLineClass(X, "wrap", "first-line-of-hunk");
        Z.forEach(function(a) {
            a.sourceSpan = a.destinationSpan = a.segments[0].lines.length;
            P(a)
        });
        if (Z.length && Z[0].segments.length && Z[0].segments[0].lines.length) {
            var Y = {
                hunks: Z
            };
            this._modifyDiff("INSERT", Y, G.convertToLineInfos(Y, this._options), V)
        }
        E(U.data("widget"));
        A.trigger("stash.feature.fileContent.diffViewExpanded", null, {
            $context: U,
            hunk: Z,
            at: W
        })
    }
    ;
    return H
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:unified-diff-view', location = '/static/feature/file-content/unified-diff-view/unified-diff-view.soy' */
// This file was automatically generated from unified-diff-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.unifiedDiffView.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}
if (typeof stash.feature.fileContent.unifiedDiffView == 'undefined') {
    stash.feature.fileContent.unifiedDiffView = {};
}

stash.feature.fileContent.unifiedDiffView.layout = function(opt_data, opt_ignored) {
    return '' + stash.feature.fileContent.diffView.editor(null);
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.unifiedDiffView.layout.soyTemplateName = 'stash.feature.fileContent.unifiedDiffView.layout';
}

stash.feature.fileContent.unifiedDiffView.lineNumbers = function(opt_data, opt_ignored) {
    return '<div class="diff-line-numbers" data-line-type="' + soy.$$escapeHtml(opt_data.lineType) + '" data-line-number="' + soy.$$escapeHtml(opt_data.lineNum) + '"><span class="from">' + soy.$$escapeHtml(opt_data.fromLine) + '</span><span class="to">' + soy.$$escapeHtml(opt_data.toLine) + '</span>' + ((opt_data.marker) ? '<span class="diff-change-marker">' + soy.$$escapeHtml(opt_data.marker) + '</span>' : '') + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.unifiedDiffView.lineNumbers.soyTemplateName = 'stash.feature.fileContent.unifiedDiffView.lineNumbers';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-handler', location = '/static/feature/file-content/handlers/diff-handler.js' */
require("stash/api/feature/files/file-handlers").register({
    weight: 5000,
    handle: function(A) {
        return require("feature/file-content/handlers/diff-handler").handler.apply(this, arguments)
    }
});
define("feature/file-content/handlers/diff-handler", ["jquery", "lodash", "stash/api/feature/files/file-handlers", "stash/api/util/navbuilder", "util/ajax", "util/function", "util/promise", "model/file-change", "model/file-change-types", "model/file-content-modes", "model/path", "feature/comments", "feature/file-content/binary-diff-view", "feature/file-content/binary-view", "feature/file-content/content-message", "feature/file-content/diff-view-options", "feature/file-content/diff-view-options-panel", "feature/file-content/handlers/diff-handler/diff-handler-internal", "feature/file-content/request-diff", "feature/file-content/side-by-side-diff-view", "feature/file-content/unified-diff-view", "exports"], function(H, X, B, K, P, M, U, N, Q, F, T, J, A, G, R, S, E, C, L, O, I, W) {
    function V(Z, b, a) {
        var c = Z.$container;
        var Y = new N(Z.fileChange);
        if (Z.commentMode !== J.commentMode.NONE) {
            var d = a ? X.groupBy(a.values, function(e) {
                return e.anchor.line ? "line" : "file"
            }) : {
                line: b.lineComments || [],
                file: b.fileComments || []
            };
            return J.bindContext(c, new J.DiffAnchor(Y), {
                lineComments: d.line,
                fileComments: d.file,
                commentMode: Z.commentMode,
                relevantContextLines: Z.relevantContextLines,
                diffViewOptions: Z.diffViewOptions,
                $toolbar: Z.$toolbar
            })
        }
        return null
    }
    function D(h, a, d, b) {
        var Y = B.builtInHandlers;
        var g = h.$container;
        var e = new N(h.fileChange);
        if (a.binary || G.treatTextAsBinary(a.destination && a.destination.extension)) {
            var c = new A(a,h);
            c.handlerID = c.isDiffingImages() ? Y.DIFF_IMAGE : Y.DIFF_BINARY;
            return c
        }
        if (!a || !a.hunks || !a.hunks.length) {
            R.renderEmptyDiff(g, a, e);
            return {
                handlerID: Y.DIFF_EMPTY,
                extraClasses: "empty-diff message-content"
            }
        }
        if (a.hunks[a.hunks.length - 1].truncated) {
            R.renderTooLargeDiff(g, a, e, b);
            return {
                handlerID: Y.DIFF_TOO_LARGE,
                extraClasses: "too-large-diff message-content"
            }
        }
        var f = b ? O : I;
        var Z = new f(a,H.extend({
            commentContext: d
        }, h));
        if (d) {
            d.setDiffView(Z)
        }
        X.defer(Z.init.bind(Z));
        Z.handlerID = b ? Y.DIFF_TEXT_SIDE_BY_SIDE : Y.DIFF_TEXT_UNIFIED;
        return Z
    }
    W.handler = function(n) {
        if (n.contentMode !== F.DIFF) {
            return false
        }
        var i = 10;
        var Z = 10000;
        var m = n.$container;
        var d = H('.diff-type-options .aui-dropdown2-radio[data-value="side-by-side"]');
        var g = new N(n.fileChange);
        var l = g.getType();
        var h = !(l === Q.ADD || l === Q.DELETE || n.isExcerpt);
        function f() {
            return S.get("diffType") === "side-by-side" && h
        }
        n.withComments = n.commentMode !== J.commentMode.NONE;
        if (f()) {
            n.contextLines = Z;
            n.withComments = false
        }
        function Y(w) {
            var s = new N(w.fileChange);
            var q = s.getRepository();
            var o = s.getCommitRange();
            var r = K.rest().project(q.getProject().getKey()).repo(q.getSlug());
            if (o.getPullRequest()) {
                r = r.pullRequest(o.getPullRequest().getId())
            } else {
                r = r.commit(o)
            }
            var u = r.comments().withParams({
                avatarSize: stash.widget.avatarSizeInPx({
                    size: w.avatarSize || "medium"
                }),
                path: new T(w.fileChange.path).toString(),
                markup: true
            }).build();
            var p = w.statusCode || P.ignore404WithinRepository();
            H.extend(p, {
                "401": function() {
                    return H.Deferred().resolve({
                        start: 0,
                        size: 0,
                        values: [],
                        isLastPage: true,
                        filter: null
                    }).promise()
                }
            });
            var v = P.rest({
                url: u,
                statusCode: p
            });
            var t = v.then(function(x) {
                if (x.errors && x.errors.length) {
                    return H.Deferred().rejectWith(this, [this, null, null, x])
                }
                return x
            });
            return t.promise(v)
        }
        var e = f() ? Y : H.noop;
        var a = X.compact([L(g, n), e(n)]);
        var c = U.whenAbortable.apply(U, a);
        function b() {
            if (h) {
                d.removeClass("aui-dropdown2-disabled").attr("aria-disabled", false);
                return
            }
            if (!h) {
                d.tooltip({
                    gravity: "e",
                    delayIn: 0,
                    title: "data-file-type-compatibility"
                })
            }
        }
        function k(s, p) {
            if (!g.getType() || g.getType === Q.UNKNOWN) {
                g.setType(Q.guessChangeTypeFromDiff(s));
                n.fileChange = g.toJSON()
            }
            h = l ? h : !C.isAddedOrRemoved(s);
            b();
            var t = C.optionsOverride(S, h, n.isExcerpt);
            n.relevantContextLines = n.relevantContextLines || i;
            n.diffViewOptions = t;
            if (g.getConflict()) {
                R.renderConflict(m, g)
            }
            var q = new E(H(document),t);
            var o = V(n, s, p);
            var r = D(n, s, o, f());
            return {
                handlerID: r.handlerID,
                extraClasses: r.extraClasses,
                destroy: function() {
                    J.unbindContext(n.$container);
                    X.chain([r, q, t]).compact().filter(M.dot("destroy")).invoke("destroy").value()
                }
            }
        }
        function j(q, r, p, o) {
            if (p === "abort") {
                return H.Deferred().resolve()
            }
            R.renderErrors(m, o);
            return H.Deferred().resolve({
                extraClasses: "diff-error message-content"
            })
        }
        return c.thenAbortable(k, j)
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:diff-handler', location = '/static/feature/file-content/handlers/diff-handler/diff-handler-internal.js' */
define("feature/file-content/handlers/diff-handler/diff-handler-internal", ["lodash", "feature/file-content/diff-view-segment-types", "exports"], function(B, C, A) {
    A.isAddedOrRemoved = function(E) {
        function D(F) {
            return B.all(E.hunks, function(G) {
                return B.all(G.segments, function(H) {
                    return H.type === F
                })
            })
        }
        return D(C.ADDED) || D(C.REMOVED)
    }
    ;
    A.optionsOverride = function(D, F, E) {
        return D.proxy({
            diffType: F ? undefined : "unified",
            hideComments: E ? false : undefined
        })
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-content', location = '/static/feature/file-content/file-content.js' */
define("feature/file-content", ["aui", "jquery", "lodash", "memoir", "require", "stash/api/feature/files/file-handlers", "stash/api/util/navbuilder", "util/deprecation", "util/dom-event", "util/events", "util/promise", "model/content-tree-node-types", "model/file-change-types", "model/file-content-modes", "feature/comments", "feature/file-content/ediff"], function(I, E, S, N, J, D, H, R, F, B, M, L, O, C, G, Q) {
    function A(W, U) {
        var V = H.currentRepo().browse().path(W);
        if (U && !U.isDefault()) {
            V = V.at(U.getId())
        }
        return V.raw().build()
    }
    function K(U, W) {
        var V = this;
        this._id = W || undefined;
        this._containerSelector = U;
        B.on("stash.feature.filehistory.revisionSelected", function(X) {
            if (this === V.untilRevisionPicker) {
                B.trigger("stash.feature.filecontent.untilRevisionChanged", V, X)
            }
        });
        this._lastInitPromise = M.thenAbortable(E.Deferred().resolve())
    }
    K.commentMode = G.commentMode;
    K.diffPreset = {
        contentMode: C.DIFF,
        untilRevisionPicker: true,
        rawLink: false,
        sourceLink: false,
        modeToggle: true,
        changeTypeLozenge: false,
        changeModeLozenge: false,
        breadcrumbs: false,
        commentMode: K.commentMode.NONE
    };
    K.sourcePreset = {
        contentMode: C.SOURCE,
        untilRevisionPicker: true,
        rawLink: true,
        sourceLink: false,
        modeToggle: true,
        changeTypeLozenge: false,
        changeModeLozenge: false,
        breadcrumbs: false,
        commentMode: K.commentMode.NONE
    };
    K.defaults = {
        contentMode: C.SOURCE,
        untilRevisionPicker: false,
        rawLink: false,
        sourceLink: false,
        modeToggle: false,
        changeTypeLozenge: false,
        changeModeLozenge: false,
        fileIcon: false,
        breadcrumbs: false,
        scrollPaneSelector: undefined,
        commentMode: K.commentMode.REPLY_ONLY,
        pullRequestDiffLink: false,
        toolbarWebFragmentLocationPrimary: null,
        toolbarWebFragmentLocationSecondary: null,
        asyncDiffModifications: true,
        attachScroll: true
    };
    K.prototype.initToolbarItems = function(X, U) {
        var Z = E(this._containerSelector);
        var W = U.getCommitRange().getUntilRevision();
        var Y = E(stash.feature.fileContent.main(E.extend({
            id: this._id,
            preloaded: !!U.getDiff(),
            sourceUrl: this._options.sourceUrl || this._options.modeToggle ? H.currentRepo().browse().path(U.getPath()).at(X.getDisplayId()).until(W && W.getId()).build() : "",
            diffUrl: this._options.modeToggle ? H.currentRepo().diff(U).at(X.getDisplayId()).build() : "",
            fileChange: U.toJSON()
        }, this._options)));
        this.$self && this.$self.remove();
        this.$self = Y.appendTo(Z);
        var V = this.$toolbar = Y.children(".file-toolbar");
        this.$contentView = Y.children(".content-view");
        this._initCommands();
        if (this._options.breadcrumbs) {
            this.$breadcrumbs = V.find(".breadcrumbs")
        } else {
            this.$breadcrumbs = null
        }
        if (this._options.changeTypeLozenge) {
            this.$changeTypeLozenge = V.find(".change-type-placeholder")
        } else {
            this.$changeTypeLozenge = null
        }
        if (this._options.changeModeLozenge) {
            this.$changeModeLozenge = V.find(".change-mode-placeholder")
        } else {
            this.$changeModeLozenge = null
        }
        if (this._options.sourceLink) {
            this.$viewSource = V.find(".source-view-link").tooltip({
                gravity: "ne"
            })
        } else {
            this.$viewSource = null
        }
        if (this._options.pullRequestDiffLink) {
            V.find(".pull-request-diff-outdated-lozenge").tooltip({
                gravity: "ne"
            })
        }
    }
    ;
    K.prototype._initCommands = function() {
        var U = this.$contentView;
        var V = this.$toolbar;
        if (this._options.scrollPaneSelector === "self") {
            U.addClass("scroll-x")
        }
        if (this.untilRevisionPicker) {
            this.untilRevisionPicker.destroy()
        }
        if (this._options.untilRevisionPicker) {
            var W = J("feature/file-content/file-history");
            this.untilRevisionPicker = new W(V.find(".until-changeset-button"),"until-changeset")
        } else {
            this.untilRevisionPicker = null
        }
        if (this._options.rawLink) {
            this.$viewRaw = V.find(".raw-view-link")
        } else {
            this.$viewRaw = null
        }
        if (this._options.modeToggle) {
            this.$modeToggle = V.find(".mode-toggle").tooltip({
                gravity: "ne"
            })
        } else {
            this.$modeToggle = null
        }
    }
    ;
    K.prototype.initForContent = function(X, d, b) {
        var V = d.getCommitRange().getUntilRevision();
        if (this.$viewSource) {
            if (d.getType() === O.DELETE || d.getNodeType() === L.SUBMODULE) {
                this.$viewSource.addClass("hidden")
            } else {
                this.$viewSource.attr("href", H.currentRepo().browse().path(d.getPath()).at(V && V.getId()).build())
            }
        }
        if (this.$viewRaw) {
            this.$viewRaw.attr("href", A(d.getPath(), V && V.getRevisionReference()))
        }
        if (this.untilRevisionPicker) {
            this.untilRevisionPicker.init(d.getPath(), V && V.getRevisionReference(), X)
        }
        if (this.$breadcrumbs) {
            this.$breadcrumbs.html(this.renderBreadCrumbs(d.getPath()))
        }
        if (this.$changeTypeLozenge) {
            var W;
            var h;
            var j = d.getPath();
            var Y = d.getSrcPath();
            if (d.getType() === O.RENAME) {
                W = I.escapeHtml(Y.getName());
                h = I.escapeHtml(j.toString())
            } else {
                if (Y) {
                    var U = Y.toString();
                    var e = j.toString();
                    var g = Q.diff(Q.tokenizeString(U), Q.tokenizeString(e));
                    W = T(U, g.originalRegions, "deleted");
                    h = T(e, g.revisedRegions, "added")
                }
            }
            this.$changeTypeLozenge.append(stash.feature.fileContent.fileChangeTypeLozenge({
                changeType: d.getType(),
                previousPathContent: W,
                pathContent: h
            }));
            var i = function() {
                var l = E(document).width() - E(this).offset().left - (E(this).width() / 2);
                var k = E(".tipsy").outerWidth();
                return (l > ((k / 2) + 10)) ? "n" : "ne"
            };
            this.$changeTypeLozenge.find(".change-type-lozenge").tooltip({
                html: true,
                className: "change-type-lozenge-tooltip",
                gravity: i
            })
        }
        if (this.$changeModeLozenge) {
            var c = this.getFileChangedModeLozenge(d);
            if (c) {
                this.$changeModeLozenge.append(E(c).tooltip())
            }
        }
        if (this.$modeToggle && N.nativeSupport()) {
            this.$modeToggle.on("click", "a:not(.active,.disabled)", function(k) {
                if (!F.openInSameTab(k)) {
                    return
                }
                k.preventDefault();
                B.trigger("stash.feature.filecontent.requestedModeChange", this, E(this).hasClass("mode-diff") ? C.DIFF : C.SOURCE)
            })
        }
        var a = S.isString(b) && b.match(/^(\d+)/);
        if (a) {
            a = (a[1] > 0 ? a[1] - 1 : undefined)
        }
        var f = {
            $toolbar: this.$toolbar,
            $container: this.$contentView,
            asyncDiffModifications: this._options.asyncDiffModifications,
            attachScroll: this._options.attachScroll,
            autoResizing: this._options.autoResizing,
            contentMode: this._options.contentMode,
            commentMode: this._options.commentMode,
            diffUrlBuilder: this._options.diffUrlBuilder,
            disable: R.fn(this.toggleToolbarDisable.bind(this, true), "FileHandlingContext.disable()", "handler-specific events", "3.5", "4.0"),
            enable: R.fn(this.toggleToolbarDisable.bind(this, false), "FileHandlingContext.enable()", "handler-specific events", "3.5", "4.0"),
            fileChange: d.toJSON(),
            isExcerpt: !!this._options.isExcerpt,
            lineComments: this._options.lineComments,
            relevantContextLines: this._options.relevantContextLines,
            targetLine: a,
            anchor: b
        };
        R.prop(f, "targetLine", "FileHandlingContext.targetLine", "FileHandlingContext.anchor", "3.8", "4.0");
        var Z = E("<div />").addClass("file-content-spinner").appendTo(this.$self);
        return M.spinner(Z, D._handle(f).done(S.bind(function(l, m) {
            this.renderErrors(m);
            this.handler = l;
            this.$self.addClass(l.extraClasses);
            var k = {
                handlerID: l.handlerID,
                displayType: this._options.contentMode,
                fileChange: f.fileChange,
                commentMode: this._options.commentMode
            };
            if (this._options.toolbarWebFragmentLocationPrimary) {
                this.$toolbar.children(".primary").append(stash.widget.webFragmentButtons({
                    location: this._options.toolbarWebFragmentLocationPrimary,
                    context: k
                }))
            }
            if (this._options.toolbarWebFragmentLocationSecondary) {
                this.$toolbar.children(".secondary").prepend(stash.widget.webFragmentButtons({
                    location: this._options.toolbarWebFragmentLocationSecondary,
                    context: k,
                    isReverse: true
                }))
            }
        }, this)), "large", {
            zIndex: 10
        }).done(S.defer.bind(S, function() {
            B.trigger("stash.feature.fileContent.requestHandled", null, f)
        }))
    }
    ;
    K.prototype.renderErrors = function(U) {
        this.$self.parent().find(".file-content-errors").remove();
        if (U.length > 0) {
            this.$self.before(stash.feature.fileContent.errors({
                errors: S.map(U, function(V) {
                    return V.message || V
                })
            }))
        }
    }
    ;
    K.prototype.toggleToolbarDisable = function(U) {
        this.$self.find(".file-toolbar .aui-button").toggleClass("disabled", U).prop("disabled", U).attr("aria-disabled", U);
        if (U) {
            R.triggerDeprecated("stash.feature.filecontent.disabled", this, this.$self, "handler-specific events", "3.5", "4.0")
        } else {
            R.triggerDeprecated("stash.feature.filecontent.enabled", this, this.$self, "handler-specific events", "3.5", "4.0")
        }
    }
    ;
    K.prototype.renderBreadCrumbs = function(V) {
        var U = S.map(V.getComponents(), function(W) {
            return {
                text: W
            }
        });
        return stash.widget.breadcrumbs.crumbs({
            pathComponents: U,
            primaryLink: this._options.pullRequestDiffLinkUrl
        })
    }
    ;
    K.prototype.getFileChangedModeLozenge = function(U) {
        var X = U.getSrcExecutable()
          , V = U.getExecutable();
        var W = null;
        if ((X == null && V === true) || (X === false && V === true)) {
            W = true
        } else {
            if (X === true && V === false) {
                W = false
            }
        }
        if (W !== null) {
            return E(stash.feature.fileContent.fileChangeModeLozenge({
                added: W
            }))
        }
        return null
    }
    ;
    K.prototype.init = function(U, V) {
        var W = this._initInternal.bind(this, U, V);
        this._lastInitPromise = this.reset().thenAbortable(W, W);
        return this._lastInitPromise
    }
    ;
    K.prototype._initInternal = function(V, W) {
        W = this._options = E.extend({}, K.defaults, W);
        var U = V.getCommitRange()
          , X = W.headRef || U.getUntilRevision() && U.getUntilRevision().getRevisionReference();
        if (W.changeTypeLozenge && !V.getType()) {
            throw new Error("Change type is required to show the change type lozenge.")
        }
        if (!U.getUntilRevision() && (W.sourceLink || W.rawLink || W.untilRevisionPicker)) {
            throw new Error("Revision info is required to show a link to the source or raw file, or a revision picker.")
        }
        this.initToolbarItems(X, V);
        return this.initForContent(X, V, W.anchor)
    }
    ;
    K.prototype.reset = function() {
        if (this._lastInitPromise) {
            this._lastInitPromise.abort()
        }
        var U = this._resetInternal.bind(this);
        return M.thenAbortable(this._lastInitPromise.then(U, U))
    }
    ;
    K.prototype._resetInternal = function P() {
        if (this.handler) {
            if (this.handler.extraClasses) {
                this.$self.removeClass(this.handler.extraClasses)
            }
            if (S.isFunction(this.handler.destroy)) {
                this.handler.destroy()
            }
            delete this.handler
        }
        return E.Deferred().resolve()
    }
    ;
    K.prototype.destroy = function() {
        this.reset()
    }
    ;
    function T(W, a, Y) {
        var U = "";
        var Z = 0;
        for (var V = 0; V < a.length; V++) {
            var X = a[V];
            U += I.escapeHtml(W.substring(Z, X.start)) + '<span class="' + Y + '">' + I.escapeHtml(W.substring(X.start, X.end)) + "</span>";
            Z = X.end
        }
        if (Z < W.length) {
            U += I.escapeHtml(W.substring(Z))
        }
        return U
    }
    return K
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:file-content', location = '/static/feature/file-content/file-content.soy' */
// This file was automatically generated from file-content.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.fileContent.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.fileContent == 'undefined') {
    stash.feature.fileContent = {};
}

stash.feature.fileContent.main = function(opt_data, opt_ignored) {
    return '<div' + ((opt_data.id) ? ' id="' + soy.$$escapeHtml(opt_data.id) + '"' : '') + ' class="file-content' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '">' + stash.feature.file.fileToolbar({
        fileIcon: opt_data.fileIcon,
        breadcrumbs: opt_data.breadcrumbs,
        primaryToolbarContent: '' + ((opt_data.changeTypeLozenge) ? '<div class="change-type-placeholder"></div>' : '') + ((opt_data.changeModeLozenge) ? '<div class="change-mode-placeholder"></div>' : '') + ((opt_data.modeToggle) ? stash.buttons.buttons({
            extraClasses: 'mode-toggle',
            content: '' + stash.buttons.button({
                extraClasses: 'mode-source',
                isPressed: opt_data.contentMode == 'source',
                href: opt_data.sourceUrl,
                buttonText: "Source view",
                title: "View the full source of this file"
            }) + stash.buttons.button({
                extraClasses: 'mode-diff',
                isPressed: opt_data.contentMode == 'diff',
                href: opt_data.diffUrl,
                buttonText: "Diff to previous",
                title: "View the changes made in this revision"
            })
        }) : '') + ((opt_data.untilRevisionPicker) ? stash.buttons.button({
            extraClasses: 'aui-dd-trigger until-changeset-button',
            buttonText: "History",
            title: "View the history of this file"
        }) : ''),
        secondaryToolbarContent: '' + ((opt_data.sourceLink) ? stash.buttons.button({
            href: '#',
            extraClasses: 'aui-button-subtle source-view-link',
            title: "View the full source of this file",
            iconType: 'custom',
            iconClass: 'aui-icon aui-icon-small aui-iconfont-devtools-file',
            iconText: "View the full source of this file",
            buttonText: ''
        }) : '') + ((opt_data.rawLink) ? stash.buttons.button({
            href: '#',
            buttonText: "Raw file",
            extraClasses: 'aui-button-link raw-view-link'
        }) : '') + ((opt_data.pullRequestDiffLink) ? (opt_data.pullRequestDiffCurrent == false) ? stash.widget.lozenge.lozenge({
            text: "Outdated",
            htmlElement: 'span',
            extraClasses: 'aui-lozenge-current aui-lozenge-subtle pull-request-diff-outdated-lozenge',
            tooltip: "This diff has changed in more recent commits"
        }) : '' : (opt_data.contentMode == 'diff') ? '<div class="diff-view-options">' + stash.feature.fileContent.diffViewOptionsPanel.main({
            commentMode: opt_data.commentMode,
            displayType: opt_data.contentMode,
            fileChange: opt_data.fileChange
        }) + '</div>' : '')
    }) + '<div class="content-view ' + soy.$$escapeHtml(opt_data.contentMode) + '-view' + ((opt_data.preloaded) ? ' fully-loaded' : '') + '"></div></div>';
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.main.soyTemplateName = 'stash.feature.fileContent.main';
}

stash.feature.fileContent.errors = function(opt_data, opt_ignored) {
    var output = '<div class="file-content-errors">';
    var errorList90 = opt_data.errors;
    var errorListLen90 = errorList90.length;
    for (var errorIndex90 = 0; errorIndex90 < errorListLen90; errorIndex90++) {
        var errorData90 = errorList90[errorIndex90];
        output += aui.message.warning({
            content: '' + soy.$$escapeHtml(errorData90),
            isCloseable: true
        });
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.fileContent.errors.soyTemplateName = 'stash.feature.fileContent.errors';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:faux-scrollbar', location = '/static/widget/faux-scrollbar/faux-scrollbar.js' */
define("widget/faux-scrollbar", ["jquery", "lodash", "util/dom-event", "util/events", "util/function", "util/navigator"], function(G, D, A, E, F, B) {
    function C() {
        this._destroyables = [];
        this._scroller = document.createElement("div");
        this._scrollee = document.createElement("div");
        this._scroller.appendChild(this._scrollee);
        this._scroller.className = "faux-scrollbar";
        this._scrollee.className = "scrollee";
        this._scrollerHeight = 17;
        if (B.isIE()) {
            this._scroller.style.height = "18px"
        }
        document.body.appendChild(this._scroller);
        this._userActivatedScroll = true;
        this._firstInit = true;
        this._contentWidth = 0
    }
    C.prototype._onFirstInit = function() {
        var K = this;
        C._bind(this._scroller, "scroll", function() {
            if (K._userActivatedScroll) {
                K._userActivatedScroll = false;
                K._puppet.scrollLeft = K._scroller.scrollLeft * K._scrollLeftRatio
            } else {
                K._userActivatedScroll = true
            }
        });
        var M = false;
        var J = 16
          , L = 37
          , I = 39;
        C._bind(document, "keydown", function(P) {
            var O = P.keyCode
              , Q = D.any([I, L], F.eq(O));
            if (Q && !A.modifiersPreventScroll(P)) {
                var N = P.target
                  , R = N && /INPUT|SELECT|TEXTAREA/i.test(N.tagName);
                if (!R) {
                    if (O === I) {
                        K._scroller.scrollLeft += 40
                    } else {
                        if (O === L) {
                            K._scroller.scrollLeft -= 40
                        }
                    }
                }
            } else {
                if (O === J) {
                    M = true
                }
            }
        });
        C._bind(document, "keyup", function(N) {
            if (N.keyCode === J) {
                M = false
            }
        });
        if (B.isMozilla()) {
            C._bind(document, "DOMMouseScroll", function(O) {
                O = O.originalEvent;
                var N = M || (O.axis === O.HORIZONTAL_AXIS) ? O.detail : 0;
                if (N) {
                    K._scroller.scrollLeft += N * 100
                }
            })
        } else {
            C._bind(document, "mousewheel", function(O) {
                O = O.originalEvent;
                var P = O.wheelDeltaX || (M && O.wheelDelta) || 0
                  , N = (P / 120) || (M && O.detail);
                if (N) {
                    if (B.isChrome() && O.webkitDirectionInvertedFromDevice) {
                        N = -N
                    }
                    K._scroller.scrollLeft -= N * 100
                }
            })
        }
        this._destroyables.push(E.chain().on("stash.feature.sidebar.collapseEnd", this.containerSizeChanged.bind(this)).on("stash.feature.sidebar.expandEnd", this.containerSizeChanged.bind(this)));
        C._bind(window, "resize", this.containerSizeChanged.bind(this));
        C._bind(window, "scroll", function() {
            K._hideIfAbovePuppet(true)
        })
    }
    ;
    C.prototype.containerSizeChanged = function(I) {
        this._hideIfAbovePuppet(false);
        this._setContentWidthIfKnown(I);
        this._updateContainerWidths();
        this._updateScrollLeftRatio()
    }
    ;
    C.prototype.init = function(J, L) {
        var I = this;
        if (this._firstInit) {
            this._onFirstInit();
            this._firstInit = false
        }
        if (this._puppet) {
            C._unbindAll(this._puppet, ".fauxscrollbar")
        }
        this._puppet = J;
        this._contentWidth = 0;
        this._setContentWidthIfKnown(true);
        if (L) {
            this.setOptions(L)
        } else {
            this._updateContainerWidths();
            this._updateScrollLeftRatio()
        }
        function K() {
            if (I._userActivatedScroll) {
                I._userActivatedScroll = false;
                I._scroller.scrollLeft = I._puppet.scrollLeft / I._scrollLeftRatio
            } else {
                I._userActivatedScroll = true
            }
        }
        C._bind(this._puppet, "scroll", K);
        K();
        I._userActivatedScroll = true
    }
    ;
    var H = ["top", "left", "bottom", "right"];
    C.prototype.setOptions = function(I) {
        var J = G(this._scroller);
        var K = D.some(H, D.has.bind(D, I));
        if (K) {
            D.each(H, function(L) {
                J.css(L, I[L] != null ? I[L] : "auto")
            })
        }
        if (D.has(I, "hideAbove")) {
            this._hideAbove = I.hideAbove
        }
        this._updateContainerWidths();
        this._updateScrollLeftRatio()
    }
    ;
    C.prototype.destroy = function() {
        C._unbindAll(document, ".fauxscrollbar");
        C._unbindAll(window, ".fauxscrollbar");
        if (this._puppet) {
            C._unbindAll(this._puppet, ".fauxscrollbar")
        }
        C._unbindAll(this._scroller);
        this._scroller.parentNode.removeChild(this._scroller);
        this._puppet = this._scroller = this._scrollee = null;
        D.invoke(this._destroyables, "destroy")
    }
    ;
    C.prototype._setContentWidthIfKnown = function(J) {
        var K, I;
        var L = this._contentIsClipped;
        if (J || !L) {
            this._contentIsClipped = (K = this._puppet.clientWidth) && (I = this._puppet.scrollWidth) > K;
            if (this._contentIsClipped) {
                I = I || this._puppet.scrollWidth;
                this._contentWidth = I;
                return true
            } else {
                if (J) {
                    this._contentWidth = 0;
                    return false
                }
            }
        }
        return this._contentIsClipped
    }
    ;
    C.prototype._updateScrollLeftRatio = function() {
        this._scrollLeftRatio = (this._contentWidth - this._puppetWidth) / (this._scrolleeWidth - this._scrollerWidth)
    }
    ;
    C.prototype._updateContainerWidths = function() {
        this._scrollerWidth = this._scroller.clientWidth;
        this._puppetWidth = this._puppet.clientWidth;
        this._scrolleeWidth = Math.round(this._contentWidth * this._scrollerWidth / this._puppetWidth);
        this._scrollee.style.width = isNaN(this._scrolleeWidth) ? "0px" : (this._scrolleeWidth + "px");
        E.trigger("stash.widget.faux.scrollbar.visibilityChanged", null, (this._scrolleeWidth >= this._scrollerWidth))
    }
    ;
    C.prototype._hideIfAbovePuppet = function(J) {
        if (this._hideAbove === false) {
            return
        }
        var M = G(window)
          , K = G(this._puppet)
          , L = G(this._scroller);
        var I = M.scrollTop() + M.height() < (this._hideAbove || K.offset().top) + this._scrollerHeight;
        if (I !== this._isHidden) {
            this._isHidden = I;
            L.toggleClass("hidden", I);
            if (!I && J) {
                this._setContentWidthIfKnown();
                this._updateContainerWidths();
                this._updateScrollLeftRatio()
            }
        }
    }
    ;
    C.prototype.getScrollLeft = function() {
        return this._scroller.scrollLeft
    }
    ;
    C.prototype.setScrollLeft = function(I) {
        this._userActivatedScroll = true;
        this._scroller.scrollLeft = I
    }
    ;
    C.prototype.isShowing = function() {
        return this._scroller.scrollWidth > this._scroller.clientWidth
    }
    ;
    C._bind = function(J, I, K) {
        G(J).on(I + ".fauxscrollbar", K)
    }
    ;
    C._unbindAll = function(I) {
        G(I).off(".fauxscrollbar")
    }
    ;
    return C
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:tree-and-diff-view', location = '/static/feature/changeset/tree-and-diff-view/tree-and-diff-view.js' */
define("feature/changeset/tree-and-diff-view", ["aui", "jquery", "lodash", "util/dom-event", "util/events", "util/feature-detect", "util/function", "util/navigator", "model/conflict", "model/file-change", "model/file-content-modes", "model/page-state", "model/path-and-line", "feature/changeset/difftree", "feature/file-content", "exports"], function(b, t, AN, E, f, M, m, s, A, e, w, a, Q, J, d, AE) {
    var l = J.DiffTree
      , AF = "ROOT";
    var AJ;
    var h, p, D, N, AH = false, k = [];
    var I, AB = {}, Y;
    var AG = t(window), S, B, G, Z, AK, F, T, L, R, AL, AC, x;
    function o(AR) {
        var AU = i(AR)
          , AV = C(AR)
          , AO = K(AR)
          , AP = y(AR)
          , AS = AD(AR)
          , AQ = v(AR)
          , AT = j(AR);
        return new e({
            repository: a.getRepository(),
            commitRange: h,
            srcPath: AV && AV.path,
            path: AU.path,
            type: AO,
            nodeType: AP,
            line: AU.line,
            search: N,
            conflict: AS,
            srcExecutable: AT,
            executable: AQ
        })
    }
    function AM(AO) {
        return AA(o(AO))
    }
    function AA(AO, AP) {
        if (!Y) {
            Y = new d(G,"changeset-file-content")
        }
        if (!AP) {
            AP = AO.getLine()
        }
        p = AO;
        D = new Q(AO.getPath(),AO.getLine());
        a.setFilePath(AO.getPath());
        G.height(G.height());
        var AQ = AG.scrollTop();
        return Y.init(AO, t.extend(AJ, {
            anchor: AP
        })).done(function() {
            T = t("#changeset-file-content");
            if (T.length === 0) {
                return
            }
            x = T.find(".file-toolbar");
            AC = T.find(".content-view");
            AQ = u(AQ);
            AG.scrollTop(AQ)
        })
    }
    function c() {
        var AO = t.Deferred();
        D = null;
        p = null;
        if (Y) {
            Y.destroy();
            Y = null
        }
        t("#changeset-file-content").remove();
        return AO.resolve()
    }
    function i(AO) {
        return new Q(AO.data("path"))
    }
    function K(AO) {
        return AO.data("changeType")
    }
    function y(AO) {
        return AO.data("nodeType")
    }
    function C(AO) {
        return AO.data("srcPath") && new Q(AO.data("srcPath"))
    }
    function AD(AO) {
        return AO.data("conflict") && new A(AO.data("conflict"))
    }
    function j(AO) {
        return AO.data("srcExecutable")
    }
    function v(AO) {
        return AO.data("executable")
    }
    function P() {
        AK = AG.height();
        F = AK - t(".diff-tree-toolbar").outerHeight();
        R.css({
            "max-height": F + "px",
            "border-bottom-width": 0
        })
    }
    function u(AP) {
        var AO = T.offset();
        if (AO) {
            return Math.min(AP, AO.top)
        }
        return AP
    }
    f.on("stash.feature.fileContent.optionsChanged", function(AP) {
        var AO = ["hideComments", "hideEdiff"];
        if (!AN.contains(AO, AP.key)) {
            X()
        }
    });
    f.on("internal.stash.feature.diffView.highlightSearch", function(AO) {
        N = AO
    });
    function n() {
        AH = true;
        var AP = O();
        var AO = (Boolean(AP) ^ Boolean(D)) || (AP && AP.path.toString() !== D.path.toString());
        if (AO && I) {
            I.selectFile(AP.path.getComponents());
            X();
            if (AP.line) {
                f.once("stash.feature.fileContent.diffViewContentChanged", function() {
                    f.trigger("internal.stash.feature.diffView.lineChange", null, AP.line)
                })
            }
        } else {
            if (AP.toString() !== D.toString()) {
                f.trigger("internal.stash.feature.diffView.lineChange", null, AP.line);
                D = AP
            }
        }
        AH = false
    }
    function X() {
        var AO = I.getSelectedFile();
        if (AO && AO.length > 0) {
            AM(AO)
        } else {
            if (p) {
                AA(p)
            }
        }
    }
    function z(AO) {
        if (!Z) {
            Z = t("<div class='spinner'/>")
        }
        Z.appendTo("#content .file-tree-wrapper").spin("large", {
            zIndex: 10
        });
        return I.init(AO).always(function() {
            if (Z) {
                Z.spinStop().remove();
                Z = null
            }
        }).done(function() {
            AL = t(".file-tree");
            F = AK - t(".diff-tree-toolbar").outerHeight();
            R.css("max-height", F)
        })
    }
    function O() {
        return new Q(window.location.hash.substring(1))
    }
    var AI;
    function W() {
        var AO = t(".collapse-file-tree");
        var AV = t(".changeset-files");
        var AY = t(".file-tree-container");
        var AS;
        function AX() {
            f.trigger("stash.feature.changeset.difftree.collapseAnimationFinished", null, AS)
        }
        AY.on("transitionend", E.filterByTarget(AY, AX));
        var AQ;
        var AP = false;
        var AW = 200;
        var AR = function() {
            clearTimeout(AQ);
            if (!AV.hasClass("collapsed")) {
                return
            }
            AQ = setTimeout(function() {
                AP = true;
                AU(false)
            }, AW)
        };
        var AT = function() {
            clearTimeout(AQ);
            if (AP) {
                AP = false;
                AI(true)
            }
        };
        AY.on("mouseleave", AT).find(".file-tree-wrapper").on("mouseenter", AR).end().find(".diff-tree-toolbar").on("focus", "input", function() {
            AI(false)
        });
        var AU = function(Aa) {
            var AZ = AV.hasClass("collapsed");
            if (typeof Aa === "undefined") {
                Aa = !AZ
            }
            AV.toggleClass("collapsed", Aa).toggleClass("quick-reveal-mode", AP);
            AS = AV.hasClass("collapsed");
            if (AS !== AZ) {
                f.trigger("stash.feature.changeset.difftree.toggleCollapse", null, AS);
                if (!M.cssTransition()) {
                    AX()
                }
            }
        };
        AI = function(AZ) {
            AZ = AP ? false : AZ;
            if (typeof AZ === "object") {
                AZ = undefined
            }
            AP = false;
            clearTimeout(AQ);
            AU(AZ)
        }
        ;
        AO.on("click", E.preventDefault(AI))
    }
    function V() {
        t(".no-changes-placeholder").remove();
        var AO = D ? D : O();
        return z(AO.path.getComponents()).then(function(AQ) {
            var AP = AQ.getSelectedFile();
            if (AP && AP.length) {
                return AA(o(AP), AO.line)
            } else {
                return c().done(function() {
                    t(".changeset-files").append(t("<div class='message no-changes-placeholder'></div>").text("No changes to show"))
                })
            }
        })
    }
    function r(AO) {
        return new l(".file-tree-wrapper",".diff-tree-toolbar .aui-toolbar2-primary",h,{
            maxChanges: AO.maxChanges,
            hasOtherParents: AO.numberOfParents > 1,
            urlBuilder: AO.changesUrlBuilder,
            searchUrlBuilder: AO.diffUrlBuilder
        })
    }
    AE.updateCommitRange = function(AO) {
        if (AO.getId() === h.getId()) {
            return
        }
        h = AO;
        I.reset();
        if (Object.prototype.hasOwnProperty.call(AB, h.getId())) {
            I = AB[h.getId()]
        } else {
            I = r(AJ);
            AB[h.getId()] = I
        }
        V()
    }
    ;
    function H(AO, AP) {
        if (!AH && !AP) {
            window.location.hash = AO ? i(AO).toString() : ""
        }
    }
    function g(AO) {
        if (s.isIE() && s.majorVersion() === 9) {
            return
        }
        (this.execute ? this : b.whenIType(AO)).execute(m.arity(AI, 0))
    }
    function q(AO) {
        (this.execute ? this : b.whenIType(AO)).execute(function() {
            I.openNextFile()
        })
    }
    function U(AO) {
        (this.execute ? this : b.whenIType(AO)).execute(function() {
            I.openPrevFile()
        })
    }
    AE.init = function(AO, AP) {
        AJ = t.extend({}, AE.defaults, AP);
        S = t("#footer");
        B = t("#content");
        G = B.find(".changeset-files");
        L = t(".file-tree-container");
        R = L.children(".file-tree-wrapper");
        AK = AG.height();
        T = t("#changeset-file-content");
        h = AO;
        I = r(AJ);
        AB[h.getId()] = I;
        D = O();
        AG.on("hashchange", n);
        k.push(f.chain().on("window.resize", P).on("stash.feature.fileContent.diffViewExpanded", P).on("stash.feature.changeset.difftree.selectedNodeChanged", H));
        W();
        V();
        k.push(f.chain().on("stash.keyboard.shortcuts.requestToggleDiffTreeHandler", g).on("stash.keyboard.shortcuts.requestMoveToNextHandler", q).on("stash.keyboard.shortcuts.requestMoveToPreviousHandler", U));
        k.push(f.chainWith(I).on("search-focus", AN.partial(AI, false)))
    }
    ;
    AE._initDiffTreeToggle = W;
    AE.reset = function() {
        if (I) {
            I.reset()
        }
        h = undefined;
        I = undefined;
        AB = {};
        D = undefined;
        N = undefined;
        AG.off("hashchange", n);
        AN.invoke(this._destroyables, "destroy");
        return c()
    }
    ;
    AE.defaults = {
        breadcrumbs: true,
        sourceLink: true,
        changeTypeLozenge: true,
        changeModeLozenge: true,
        contentMode: w.DIFF,
        toolbarWebFragmentLocationPrimary: null,
        toolbarWebFragmentLocationSecondary: null
    };
    AE.commentMode = d.commentMode
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:tree-and-diff-view', location = '/static/feature/changeset/tree-and-diff-view/tree-and-diff-view.soy' */
// This file was automatically generated from tree-and-diff-view.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}

stash.feature.treeAndDiffView = function(opt_data, opt_ignored) {
    var output = '<div class="changeset-files' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '"><div class="file-tree-container">';
    var param10 = '' + aui.toolbar2.item({
        item: 'primary',
        content: '<h4>' + soy.$$escapeHtml("Changed files") + '</h4>'
    });
    var param18 = '';
    var webItemList19 = opt_data.diffTreeHeaderWebItems;
    var webItemListLen19 = webItemList19.length;
    for (var webItemIndex19 = 0; webItemIndex19 < webItemListLen19; webItemIndex19++) {
        var webItemData19 = webItemList19[webItemIndex19];
        param18 += stash.widget.webItemButton(webItemData19);
    }
    param10 += aui.toolbar2.item({
        item: 'secondary',
        content: param18
    });
    output += aui.toolbar2.toolbar2({
        extraClasses: 'diff-tree-toolbar',
        content: param10
    });
    output += '<div class="file-tree-wrapper"><div class="file-tree"></div></div></div></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.treeAndDiffView.soyTemplateName = 'stash.feature.treeAndDiffView';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:ref-lozenge', location = '/static/feature/repository/ref-lozenge/ref-lozenge.soy' */
// This file was automatically generated from ref-lozenge.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.refLozenge = function(opt_data, opt_ignored) {
    return '' + stash.widget.lozenge.htmlLozenge({
        extraClasses: (opt_data.extraClasses ? opt_data.extraClasses + ' ' : '') + 'ref-lozenge',
        monospace: true,
        htmlElement: 'span',
        content: ((opt_data.repository) ? '<span class="repository">' + stash.feature.project.avatar({
            size: 'xsmall',
            project: opt_data.repository.project,
            tagName: 'span'
        }) + '<span class="name">' + soy.$$escapeHtml(opt_data.repository.name) + '</span></span>' : '') + '<span class="ref ' + soy.$$escapeHtml(opt_data.ref.type && opt_data.ref.type.id ? opt_data.ref.type.id.toLowerCase() : 'branch') + '">' + aui.icons.icon({
            size: 'small',
            useIconFont: true,
            iconFontSet: 'devtools',
            icon: opt_data.ref.type && opt_data.ref.type.id.toLowerCase() == 'tag' ? 'tag' : 'branch-small'
        }) + '<span class="name" aria-label="' + ((opt_data.refAccessibilityText) ? soy.$$escapeHtml(opt_data.refAccessibilityText) : soy.$$escapeHtml(AJS.format("branch {0}", opt_data.ref.displayId))) + '">' + soy.$$escapeHtml(opt_data.ref.displayId) + '</span></span>',
        extraAttributes: {
            'data-ref-tooltip': opt_data.tooltip ? opt_data.tooltip : (opt_data.repository ? opt_data.repository.project.name + ' / ' + opt_data.repository.name + ' : ' : '') + opt_data.ref.displayId
        }
    });
}
;
if (goog.DEBUG) {
    stash.feature.repository.refLozenge.soyTemplateName = 'stash.feature.repository.refLozenge';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:ref-lozenge', location = '/static/feature/repository/ref-lozenge/ref-lozenge.js' */
define("feature/repository/ref-lozenge", ["jquery"], function(A) {
    A(".ref-lozenge").tooltip({
        live: true,
        title: "data-ref-tooltip",
        hoverable: true,
        gravity: function() {
            return A.fn.tipsy.autoNS.call(this) + A.fn.tipsy.autoWE.call(this)
        },
        delayIn: 500,
        className: function() {
            var K = A(".tipsy");
            var C = K[0];
            var L = K.prop("className");
            var D = /tipsy-[ns]?e/.test(L);
            var J = /tipsy-s/.test(L);
            var E = D ? C.offsetWidth : undefined;
            var N = J ? C.offsetHeight : undefined;
            K.addClass("ref-lozenge-tooltip");
            if (D) {
                var G = C.offsetWidth;
                var I = G - E;
                var H = parseFloat(K.css("left"), 10);
                K.css("left", (H - I) + "px")
            }
            if (J) {
                var B = C.offsetHeight;
                var F = B - N;
                var M = parseFloat(K.css("top"), 10);
                K.css("top", (M - F) + "px")
            }
            return "ref-lozenge-tooltip"
        }
    })
});
require("feature/repository/ref-lozenge");
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare.js' */
define("feature/compare", ["aui", "bacon", "jquery", "lodash", "memoir", "stash/api/util/navbuilder", "util/bacon", "util/dom-event", "util/events", "util/function", "model/repository", "model/revision-reference", "widget/keyboard-shortcuts", "feature/pull-request/pull-request-create", "feature/repository/source-target-selector", "exports"], function(O, Q, L, a, X, N, F, d, D, P, K, c, A, M, B, b) {
    var V = L(".tabs-menu");
    function Z(f, i, h, e) {
        var g = N.project(e.sourceRepo.getProject()).repo(e.sourceRepo);
        if (i || f) {
            g = g.createPullRequest()
        } else {
            g = g.compare()[h]()
        }
        if (e.target && !e.target.isDefault()) {
            g = g.targetBranch(e.target.getId())
        }
        if (e.source && !e.source.isDefault()) {
            g = g.sourceBranch(e.source.getId())
        }
        if (!e.sourceRepo.isEqual(e.targetRepo)) {
            g = g.targetRepo(e.targetRepo.getId())
        }
        return g.build()
    }
    function J(e) {
        if (e.targetRepo) {
            return N.project(e.targetRepo.getProject()).repo(e.targetRepo).createPullRequest().build()
        }
        return ""
    }
    function I(f, h, g, e) {
        var i = e.sourceRepo;
        return {
            url: Z(f, h, g, e),
            formURL: J(e),
            title: h || f ? O.format("Create Pull Request {0} / {1}", i.getProject().getName(), i.getName()) : O.format("Compare {0} / {1}", i.getProject().getName(), i.getName()),
            selector: e,
            prShowing: h,
            tab: g
        }
    }
    function R(e) {
        return e.branchesSelected()
    }
    function C(e) {
        var f = function() {
            return {
                source: e.getSourceBranch(),
                sourceRepo: e.getSourceRepository(),
                target: e.getTargetBranch(),
                targetRepo: e.getTargetRepository()
            }
        };
        var g = ["source.repositoryChanged", "source.revisionRefChanged", "source.revisionRefUnselected", "target.repositoryChanged", "target.revisionRefChanged", "target.revisionRefUnselected"].map(function(h) {
            return F.events("stash.feature.repository.sourceTargetSelector." + h)
        });
        return Q.mergeAll.apply(Q, g).map(f).toProperty(f())
    }
    function Y(f) {
        var e = a.reduce(f, function(l, k) {
            l["compare-" + k.pathSegment + "-tab"] = k;
            return l
        }, {});
        var j = L.noop;
        function i(l) {
            l.addClass("active-tab").siblings().removeClass("active-tab");
            j();
            var k = e[l.attr("data-module-key")];
            j = k.init();
            A.resetContexts();
            return k.pathSegment
        }
        var h = i(V.find(".active-tab"));
        var g = V.asEventStream("click", "a").filter(d.openInSameTab).doAction(d.preventDefault()).flatMap(function(l) {
            var k = L(l.currentTarget).parent();
            if (!k.is(".active-tab")) {
                return Q.constant(i(k))
            }
            return Q.never()
        });
        return g.toProperty(h)
    }
    function E(i, e) {
        var h = L("#compare-content");
        var g = L.noop;
        var f = F.events("stash.feature.repository.sourceTargetSelector.source.revisionRefChanged").merge(F.events("stash.feature.repository.sourceTargetSelector.target.revisionRefChanged")).merge(Q.fromArray([0])).map(P.constant(i)).filter(R).onValue(function() {
            g();
            h.empty();
            g = e(h)
        });
        return function() {
            g();
            f()
        }
    }
    function H() {
        F.keyboardEvents("requestBranchCompareSectionHandler").onValue(function(h) {
            var f = parseInt(String.fromCharCode(h.which), 10);
            var g = V.children().eq(f - 1).children("a");
            if (X.nativeSupport()) {
                g.click()
            } else {
                window.location.href = g.prop("href")
            }
        });
        F.events("stash.widget.keyboard-shortcuts.register-contexts").onValue(function(e) {
            e.enableContext("branch-compare")
        })
    }
    function S(j, g, f, h, m, i) {
        var l = L(".aui-page-header-main h2");
        var k = i.find(".expanded-branches");
        var n = i.find("#sourceRepo");
        var e = i.find("#pull-request-description");
        j.doAction(h, "toggleClass", "hidden").doAction(k, "toggleClass", "hidden").not().doAction(m.toggleClass.bind(m, "hidden")).doAction(function(p) {
            var o = p ? ["pullRequest", "compare"] : ["compare", "pullRequest"];
            D.trigger("stash.feature.compare.form.state", null, {
                oldForm: o[0],
                newForm: o[1]
            })
        }).doAction(function(o) {
            (o ? n : e).focus()
        }).map(function(o) {
            return o && !f ? "Compare" : "Create pull request"
        }).onValue(l.text.bind(l));
        j.combine(g, function(p, o) {
            return {
                prShowing: p,
                selector: o
            }
        }).onValue(function(o) {
            if (o.prShowing) {
                var p = stash.feature.compare.collapsedBranches({
                    sourceBranch: o.selector.source.toJSON(),
                    targetBranch: o.selector.target.toJSON()
                });
                L(p).insertBefore(k)
            } else {
                i.find(".collapsed-branches").remove()
            }
        })
    }
    function T(e) {
        return L(document).asEventStream("click", ".show-hide-button").map(function(f) {
            return L(f.target).is(e)
        }).toProperty(e.hasClass("hidden"))
    }
    function W(h, m) {
        var i = {
            REF_UNSELECTED: "REF_UNSELECTED",
            TAG_SELECTED: "TAG_SELECTED",
            REFS_EQUAL: "REFS_EQUAL"
        };
        var k = h.debounce(0).map(function(o) {
            var n = {
                canCreate: false
            };
            if (!o.source || !o.target) {
                n.reason = i.REF_UNSELECTED
            } else {
                if (o.source.isTag() || o.target.isTag()) {
                    n.reason = i.TAG_SELECTED
                } else {
                    if (o.source.isEqual(o.target)) {
                        n.reason = i.REFS_EQUAL
                    } else {
                        n.canCreate = true
                    }
                }
            }
            return n
        }).skipDuplicates().toProperty();
        var e = m.find("#show-create-pr-button");
        var f = m.find(".refs-equal-warning");
        var l = m.find(".tags-warning");
        var j = m.find(".aui-tabs");
        var g = k.doAction(function(n) {
            f.toggleClass("hidden", n.reason !== i.REFS_EQUAL);
            l.toggleClass("hidden", n.reason !== i.TAG_SELECTED);
            j.toggleClass("hidden", n.reason === i.REF_UNSELECTED)
        }).map(P.dot("canCreate"));
        g.doAction(e, "enable").not().onValue(e, "attr", "aria-disabled");
        return g
    }
    function G(i, j, h, g) {
        var e = h.find("#cancel-button");
        var f = F.events("memoir.popstate").filter(P.not(P.dotEq("state", null)));
        return Q.combineAsArray(i, f).sampledBy(f).filter(function(k) {
            return a.keys(k[1].state).length !== 0
        }).map(function(l) {
            var k = l[0];
            var m = l[1];
            return {
                prShowing: k[0],
                tab: k[1],
                selector: k[2],
                oldState: m.state
            }
        }).onValue(function(l) {
            if (l.prShowing !== l.oldState.prShowing) {
                if (l.prShowing) {
                    e.click()
                } else {
                    j.click()
                }
            }
            if (l.tab !== l.oldState.tab) {
                h.find("li.menu-item[data-module-key=compare-" + l.oldState.tab + "-tab] > a").click()
            }
            var k = l.oldState.selector;
            g.refSelectors.source.setSelection({
                repository: k.sourceRepo ? new K(k.sourceRepo) : null,
                branch: k.source ? new c(k.source) : null
            });
            g.refSelectors.target.setSelection({
                repository: k.targetRepo ? new K(k.targetRepo) : null,
                branch: k.target ? new c(k.target) : null
            })
        })
    }
    function U(e) {
        var f = a.clone(e);
        f.selector = {};
        a.each(e.selector, function(h, g) {
            f.selector[g] = h ? h.toJSON() : null
        });
        return f
    }
    b.onReady = function(p, e) {
        var m = L(p);
        e.prCreateMode = !!e.prCreateMode;
        var f = a.map(e.additionalPreloadRepositories, P.create(K));
        var g = new B(m.find(".compare-selector"),new K(e.sourceRepositoryJson),new K(e.targetRepositoryJson),f,{
            showTags: true
        });
        var q = Y(a.map(e.tabs, function(t, s) {
            return {
                pathSegment: s,
                init: a.partial(E, g, a.partial(t, g))
            }
        }));
        var k = C(g);
        var i = W(k, m);
        var r = m.find(".pull-request-create-form");
        var l = m.find("#show-create-pr-button");
        var o = m.find("form.aui");
        M.init(r, e.submittedReviewers || [], k, q, i);
        var n = T(l);
        S(n, k, e.prCreateMode, l, r, m);
        var h = true;
        var j = Q.combineAsArray(n, q, k);
        G(j, l, m, g);
        j.map(Function.apply.bind(a.partial(I, e.prCreateMode)), null).onValue(function(s) {
            o.attr("action", s.formURL);
            if (X.nativeSupport()) {
                if (h) {
                    X.initialState(U(s));
                    h = false
                } else {
                    if (window.location.href.indexOf(s.url) === -1) {
                        X.pushState(U(s), s.title, s.url)
                    }
                }
            }
        });
        H()
    }
});
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare-diffs.js' */
define("feature/compare/compare-diffs", ["jquery", "stash/api/util/navbuilder", "util/bacon", "model/commit-range", "model/revision", "feature/changeset/tree-and-diff-view", "feature/comments", "layout/page-scrolling-manager"], function(F, A, E, G, H, J, L, D) {
    function B(O, S, Q) {
        var R = O.toJSON ? O.toJSON() : O;
        var N = R.untilRevision;
        var P = R.sinceRevision;
        return A.rest().project(P.repository.project.key).repo(P.repository.slug).compare()[S](Q).from(N.id).fromRepo(N.repository.id).to(P.id)
    }
    function I(P, O, N) {
        return B(N, "changes").withParams({
            start: P,
            limit: O
        })
    }
    function M(O) {
        var N = O.toJSON ? O.toJSON() : O;
        return B(N.commitRange, "diff", N)
    }
    function C(N) {
        return new H({
            id: N.getLatestChangeset(),
            repository: N.getRepository()
        })
    }
    return function K(Q, N) {
        var P = E.events("stash.widget.keyboard-shortcuts.register-contexts");
        return function O(T, S) {
            var U = F(stash.feature.compare.diff({
                diffTreeHeaderWebItems: Q
            }));
            S.append(U);
            J.init(new G({
                untilRevision: C(T.getSourceBranch()),
                sinceRevision: C(T.getTargetBranch())
            }), {
                changesUrlBuilder: I,
                diffUrlBuilder: M,
                commentMode: L.commentMode.NONE,
                maxChanges: N,
                numberOfParents: 0,
                toolbarWebFragmentLocationPrimary: "stash.changeset.diff.toolbar.primary",
                toolbarWebFragmentLocationSecondary: "stash.changeset.diff.toolbar.secondary"
            });
            var R = D.acceptScrollForwardingRequests();
            var V = P.onValue(function(W) {
                W.enableContext("diff-view");
                W.enableContext("diff-tree")
            });
            return function() {
                V();
                J.reset();
                R()
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare.soy' */
// This file was automatically generated from compare.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.compare.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.compare == 'undefined') {
    stash.feature.compare = {};
}

stash.feature.compare.panel = function(opt_data, opt_ignored) {
    var output = '';
    var refsAreEqual__soy3 = opt_data.targetBranch.id == opt_data.sourceBranch.id;
    var bothSelected__soy4 = opt_data.sourceBranch && opt_data.targetBranch;
    var showPRForm__soy5 = opt_data.prCreateMode && bothSelected__soy4 && !refsAreEqual__soy3 && !(opt_data.targetBranch.id.indexOf('refs/tags/') !== -1 || opt_data.sourceBranch.id.indexOf('refs/tags/') !== -1);
    output += '<div id="branch-compare">' + stash.widget.xsrfProtectedForm({
        action: require('stash/api/util/navbuilder').project(opt_data.targetRepository.project.key).repo(opt_data.targetRepository.slug).createPullRequest().build(),
        errors: opt_data.formErrors,
        detailedErrors: opt_data.detailedErrors,
        additionalErrorContent: '' + ((opt_data.existingPullRequest) ? aui.message.error({
            content: soy.$$escapeHtml(AJS.format("There is already a pull request open between {0} and {1}.", opt_data.sourceBranch.displayId, opt_data.targetBranch.displayId)) + ' <a title="' + soy.$$escapeHtml(opt_data.existingPullRequest.title) + '" href="' + soy.$$escapeHtml(require('stash/api/util/navbuilder').project(opt_data.targetRepository.project).repo(opt_data.targetRepository).pullRequest(opt_data.existingPullRequest.id).build()) + '">' + soy.$$escapeHtml("View the pull request.") + '</a>'
        }) : ''),
        content: '' + stash.feature.compare.expandedBranches(opt_data) + ((!!(require('model/page-state').getCurrentUser())) ? '<div class="continue-button-row">' + aui.form.buttons({
            content: '' + aui.form.button({
                id: 'show-create-pr-button',
                inputType: 'button',
                tagName: 'input',
                text: opt_data.prCreateMode ? "Continue" : "Create pull request",
                isDisabled: refsAreEqual__soy3,
                extraClasses: 'show-hide-button ' + ((showPRForm__soy5) ? 'hidden' : '')
            })
        }) + '<div class="refs-equal-warning pr-create-warning hidden">' + aui.icons.icon({
            icon: 'warning',
            useIconFont: true
        }) + '<span>' + soy.$$escapeHtml("You cannot merge a branch with itself") + '</span></div><div class="tags-warning pr-create-warning hidden">' + aui.icons.icon({
            icon: 'warning',
            useIconFont: true
        }) + '<span>' + soy.$$escapeHtml("You cannot create a pull request with a tag") + '</span></div></div>' : '') + '<div class="pull-request-create-form ' + ((!showPRForm__soy5) ? 'hidden' : '') + '">' + stash.feature.pullRequest.create({
            repository: opt_data.targetRepository,
            sourceRepository: opt_data.sourceRepository,
            sourceBranch: opt_data.sourceBranch,
            targetBranch: opt_data.targetBranch,
            title: opt_data.prTitle,
            description: opt_data.prDescription,
            fieldErrors: opt_data.fieldErrors,
            pluginFieldsContent: opt_data.pluginFieldsContent
        }) + '</div>'
    }) + stash.widget.webItemTabs({
        location: 'stash.repositories.compare.nav',
        context: {
            sourceRepository: opt_data.sourceRepository,
            targetRepository: opt_data.targetRepository
        },
        extraClasses: bothSelected__soy4 ? '' : 'hidden',
        activeTab: opt_data.activeTab,
        isDisabled: true,
        tabPanesContent: '' + widget.aui.tabPane({
            id: 'compare-content',
            isActive: true,
            content: ''
        })
    }) + '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.compare.panel.soyTemplateName = 'stash.feature.compare.panel';
}

stash.feature.compare.collapsedBranches = function(opt_data, opt_ignored) {
    return '<div class=\'collapsed-branches\'>' + stash.feature.repository.refLozenge({
        repository: opt_data.sourceBranch.repository,
        ref: opt_data.sourceBranch,
        extraClasses: 'source-branch',
        refAccessibilityText: AJS.format("Source branch {0}", opt_data.sourceBranch.displayId)
    }) + aui.icons.icon({
        icon: 'arrow-right',
        useIconFont: true,
        iconFontSet: 'devtools'
    }) + stash.feature.repository.refLozenge({
        repository: opt_data.targetBranch.repository,
        ref: opt_data.targetBranch,
        extraClasses: 'target-branch',
        refAccessibilityText: AJS.format("Target branch {0}", opt_data.targetBranch.displayId)
    }) + aui.buttons.button({
        text: "Change",
        type: 'link',
        extraClasses: 'branch-change show-hide-button',
        extraAttributes: {
            type: 'button'
        }
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.compare.collapsedBranches.soyTemplateName = 'stash.feature.compare.collapsedBranches';
}

stash.feature.compare.expandedBranches = function(opt_data, opt_ignored) {
    return '<div class=\'expanded-branches\'><h3 class="instructions">' + soy.$$escapeHtml("Select source and destination") + '</h3>' + stash.feature.repository.sourceTargetSelector({
        extraClasses: 'compare-selector',
        isHorizontal: false,
        sourceRepository: opt_data.sourceRepository,
        sourceBranch: opt_data.sourceBranch.id,
        sourceHeadChangeset: opt_data.sourceChangeset,
        targetRepository: opt_data.targetRepository,
        targetBranch: opt_data.targetBranch.id,
        targetHeadChangeset: opt_data.targetChangeset
    }) + '</div>';
}
;
if (goog.DEBUG) {
    stash.feature.compare.expandedBranches.soyTemplateName = 'stash.feature.compare.expandedBranches';
}

stash.feature.compare.tabDetailsJS = function(opt_data, opt_ignored) {
    return '{commits: require(\'feature/compare/compare-commits\')(' + soy.$$filterNoAutoescape(JSON.stringify(WebFragments.getWebSections('stash.commits.extras', {
        repository: opt_data.sourceRepository
    })).replace(/\//g, '\\/')) + '), diff: require(\'feature/compare/compare-diffs\')(' + soy.$$filterNoAutoescape(JSON.stringify(WebFragments.getWebItems('stash.repository.difftree.header')).replace(/\//g, '\\/')) + ',' + soy.$$escapeHtml(opt_data.maxChanges) + ')}';
}
;
if (goog.DEBUG) {
    stash.feature.compare.tabDetailsJS.soyTemplateName = 'stash.feature.compare.tabDetailsJS';
}
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare-commits.soy' */
// This file was automatically generated from compare-commits.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.compare.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.compare == 'undefined') {
    stash.feature.compare = {};
}

stash.feature.compare.commits = function(opt_data, opt_ignored) {
    return '' + stash.feature.commits.commitsTableImpl({
        repository: opt_data.sourceRepository,
        changesetPage: opt_data.changesetPage,
        tableId: 'compare-commits-table',
        webSections: opt_data.commitsTableWebSections
    });
}
;
if (goog.DEBUG) {
    stash.feature.compare.commits.soyTemplateName = 'stash.feature.compare.commits';
}
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare-diffs.soy' */
// This file was automatically generated from compare-diffs.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.compare.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.compare == 'undefined') {
    stash.feature.compare = {};
}

stash.feature.compare.diff = function(opt_data, opt_ignored) {
    return '' + stash.feature.treeAndDiffView({
        diffTreeHeaderWebItems: opt_data.diffTreeHeaderWebItems,
        extraClasses: 'tabbed'
    });
}
;
if (goog.DEBUG) {
    stash.feature.compare.diff.soyTemplateName = 'stash.feature.compare.diff';
}
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-resources', location = '/static/feature/compare/compare-commits.js' */
define("feature/compare/compare-commits", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/bacon", "feature/commits/commits-table"], function(C, F, E, H, B, A) {
    function D(J) {
        var I = J.getSourceRepository();
        return H.project(I.getProject()).repo(I).commits().withParams({
            until: J.getSourceBranch().getLatestChangeset(),
            since: J.getTargetBranch().getLatestChangeset(),
            secondaryRepositoryId: J.getTargetRepository().getId()
        })
    }
    return function G(I) {
        var J = B.events("stash.widget.keyboard-shortcuts.register-contexts");
        return function K(O, N) {
            var M = F(stash.feature.compare.commits({
                repository: O.getSourceRepository().toJSON(),
                commitsTableWebSections: I
            }));
            N.append(M);
            var L = new A(E.partial(D, O),{
                target: M,
                webSections: I,
                allFetchedMessageHtml: "No more commits found",
                noneFoundMessageHtml: "No commits found"
            });
            L.init({
                suspended: true
            }).done(function() {
                L.resume()
            });
            var P = J.onValue(function(Q) {
                Q.enableContext("commits")
            });
            L.bindKeyboardShortcuts();
            return function() {
                P();
                L.destroy()
            }
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-compare-plugin:compare-page-resources', location = '/static/page/compare/compare.js' */
define("page/compare", ["jquery", "feature/compare", "exports"], function(C, B, A) {
    A.onReady = function(G, F, D) {
        var E = {
            targetRepositoryJson: G,
            sourceRepositoryJson: F,
            tabs: D
        };
        return B.onReady(C("#branch-compare"), E)
    }
});
;;/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = 'templates/status.soy' */
// This file was automatically generated from status.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace JIRA.Template.Util.Issue.Status.
 */

if (typeof JIRA == 'undefined') {
    var JIRA = {};
}
if (typeof JIRA.Template == 'undefined') {
    JIRA.Template = {};
}
if (typeof JIRA.Template.Util == 'undefined') {
    JIRA.Template.Util = {};
}
if (typeof JIRA.Template.Util.Issue == 'undefined') {
    JIRA.Template.Util.Issue = {};
}
if (typeof JIRA.Template.Util.Issue.Status == 'undefined') {
    JIRA.Template.Util.Issue.Status = {};
}

JIRA.Template.Util.Issue.Status.issueStatusResolver = function(opt_data, opt_ignored) {
    return '' + ((!opt_data.issueStatus) ? '<span class="aui-icon aui-icon-small aui-iconfont-help jira-issue-status-render-error" title="' + soy.$$escapeHtml("no.issue.status.info") + '"></span>' : (opt_data.issueStatus.statusCategory) ? JIRA.Template.Util.Issue.Status.issueStatus(opt_data) : JIRA.Template.Util.Issue.Status.iconStatus({
        name: opt_data.issueStatus.name,
        iconUrl: opt_data.issueStatus.iconUrl,
        description: opt_data.issueStatus.description,
        isCompact: opt_data.isCompact
    }));
}
;
if (goog.DEBUG) {
    JIRA.Template.Util.Issue.Status.issueStatusResolver.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatusResolver';
}

JIRA.Template.Util.Issue.Status.iconStatus = function(opt_data, opt_ignored) {
    return '<img src="' + soy.$$escapeHtml(opt_data.iconUrl) + '" width="16" height="16" alt="' + soy.$$escapeHtml(opt_data.name) + '" title="' + soy.$$escapeHtml(opt_data.name) + ((opt_data.description) ? ' - ' + soy.$$escapeHtml(opt_data.description) : '') + '" class="jira-issue-status-icon">' + ((!opt_data.isCompact) ? ' ' + soy.$$escapeHtml(opt_data.name) : '');
}
;
if (goog.DEBUG) {
    JIRA.Template.Util.Issue.Status.iconStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.iconStatus';
}

JIRA.Template.Util.Issue.Status.issueStatus = function(opt_data, opt_ignored) {
    return '' + JIRA.Template.Util.Issue.Status.statusLozenge({
        name: opt_data.issueStatus.name,
        categoryKey: opt_data.issueStatus.statusCategory.key,
        colorName: opt_data.issueStatus.statusCategory.colorName,
        description: opt_data.issueStatus.description,
        isSubtle: opt_data.isSubtle,
        isCompact: opt_data.isCompact,
        maxWidth: opt_data.maxWidth
    });
}
;
if (goog.DEBUG) {
    JIRA.Template.Util.Issue.Status.issueStatus.soyTemplateName = 'JIRA.Template.Util.Issue.Status.issueStatus';
}

JIRA.Template.Util.Issue.Status.statusLozenge = function(opt_data, opt_ignored) {
    var output = '';
    var maxWidth__soy46 = opt_data.maxWidth ? opt_data.maxWidth : 'medium';
    var tooltipContent__soy47 = '<span class="jira-issue-status-tooltip-title">' + soy.$$escapeHtml(opt_data.name) + '</span>' + ((opt_data.description) ? '<br><span class="jira-issue-status-tooltip-desc">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '');
    output += '<span class=" jira-issue-status-lozenge aui-lozenge ' + JIRA.Template.Util.Issue.Status.statusLozengeClasses(opt_data) + ((opt_data.isSubtle && !opt_data.isCompact) ? ' aui-lozenge-subtle' : '') + ((opt_data.isCompact) ? ' jira-issue-status-lozenge-compact' : '') + ' jira-issue-status-lozenge-max-width-' + soy.$$escapeHtml(maxWidth__soy46) + '" data-tooltip="' + soy.$$escapeHtml(tooltipContent__soy47) + '">' + soy.$$escapeHtml(opt_data.name) + '</span>';
    return output;
}
;
if (goog.DEBUG) {
    JIRA.Template.Util.Issue.Status.statusLozenge.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozenge';
}

JIRA.Template.Util.Issue.Status.statusLozengeClasses = function(opt_data, opt_ignored) {
    return 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.colorName ? opt_data.colorName : 'medium-gray') + ' ' + ((opt_data.categoryKey) ? 'jira-issue-status-lozenge-' + soy.$$escapeHtml(opt_data.categoryKey) : '');
}
;
if (goog.DEBUG) {
    JIRA.Template.Util.Issue.Status.statusLozengeClasses.soyTemplateName = 'JIRA.Template.Util.Issue.Status.statusLozengeClasses';
}
;;/* module-key = 'com.atlassian.plugins.issue-status-plugin:issue-status-resources', location = '/js/issue-status-plugin.js' */
AJS.$(function() {
    if (AJS.$.fn.tooltip) {
        AJS.$(".jira-issue-status-lozenge[data-tooltip]").tooltip({
            aria: true,
            gravity: AJS.$.fn.tipsy.autoWE,
            delayIn: 100,
            html: true,
            live: true,
            title: "data-tooltip",
            className: "jira-issue-status-tooltip"
        })
    }
});
;;/* module-key = 'com.atlassian.auiplugin:internal-jquery-ui-datepicker', location = 'js-vendor/jquery/jquery-ui/jquery.ui.datepicker.js' */
(function(d) {
    function B() {
        this.debug = !1;
        this._curInst = null;
        this._keyEvent = !1;
        this._disabledInputs = [];
        this._inDialog = this._datepickerShowing = !1;
        this._mainDivId = "ui-datepicker-div";
        this._inlineClass = "ui-datepicker-inline";
        this._appendClass = "ui-datepicker-append";
        this._triggerClass = "ui-datepicker-trigger";
        this._dialogClass = "ui-datepicker-dialog";
        this._disableClass = "ui-datepicker-disabled";
        this._unselectableClass = "ui-datepicker-unselectable";
        this._currentClass = "ui-datepicker-current-day";
        this._dayOverClass = "ui-datepicker-days-cell-over";
        this.regional = [];
        this.regional[""] = {
            closeText: "Done",
            prevText: "Prev",
            nextText: "Next",
            currentText: "Today",
            monthNames: "January February March April May June July August September October November December".split(" "),
            monthNamesShort: "Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),
            dayNames: "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
            dayNamesShort: "Sun Mon Tue Wed Thu Fri Sat".split(" "),
            dayNamesMin: "Su Mo Tu We Th Fr Sa".split(" "),
            weekHeader: "Wk",
            dateFormat: "mm/dd/yy",
            firstDay: 0,
            isRTL: !1,
            showMonthAfterYear: !1,
            yearSuffix: ""
        };
        this._defaults = {
            showOn: "focus",
            showAnim: "fadeIn",
            showOptions: {},
            defaultDate: null,
            appendText: "",
            buttonText: "...",
            buttonImage: "",
            buttonImageOnly: !1,
            hideIfNoPrevNext: !1,
            navigationAsDateFormat: !1,
            gotoCurrent: !1,
            changeMonth: !1,
            changeYear: !1,
            yearRange: "c-10:c+10",
            showOtherMonths: !1,
            selectOtherMonths: !1,
            showWeek: !1,
            calculateWeek: this.iso8601Week,
            shortYearCutoff: "+10",
            minDate: null,
            maxDate: null,
            duration: "fast",
            beforeShowDay: null,
            beforeShow: null,
            onSelect: null,
            onChangeMonthYear: null,
            onClose: null,
            numberOfMonths: 1,
            showCurrentAtPos: 0,
            stepMonths: 1,
            stepBigMonths: 12,
            altField: "",
            altFormat: "",
            constrainInput: !0,
            showButtonPanel: !1,
            autoSize: !1,
            disabled: !1
        };
        d.extend(this._defaults, this.regional[""]);
        this.dpDiv = C(d('<div id="' + this._mainDivId + '" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))
    }
    function C(a) {
        return a.bind("mouseout", function(a) {
            a = d(a.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");
            a.length && a.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")
        }).bind("mouseover", function(b) {
            b = d(b.target).closest("button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a");
            if (!d.datepicker._isDisabledDatepicker(D.inline ? a.parent()[0] : D.input[0]) && b.length)
                b.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),
                b.addClass("ui-state-hover"),
                b.hasClass("ui-datepicker-prev") && b.addClass("ui-datepicker-prev-hover"),
                b.hasClass("ui-datepicker-next") && b.addClass("ui-datepicker-next-hover")
        })
    }
    function z(a, b) {
        d.extend(a, b);
        for (var c in b)
            if (null == b[c] || void 0 == b[c])
                a[c] = b[c];
        return a
    }
    d.extend(d.ui, {
        datepicker: {
            version: "1.8.24"
        }
    });
    var x = (new Date).getTime(), D;
    d.extend(B.prototype, {
        markerClassName: "hasDatepicker",
        maxRows: 4,
        log: function() {
            this.debug && console.log.apply("", arguments)
        },
        _widgetDatepicker: function() {
            return this.dpDiv
        },
        setDefaults: function(a) {
            z(this._defaults, a || {});
            return this
        },
        _attachDatepicker: function(a, b) {
            var c = null, e;
            for (e in this._defaults) {
                var f = a.getAttribute("date:" + e);
                if (f) {
                    c = c || {};
                    try {
                        c[e] = eval(f)
                    } catch (h) {
                        c[e] = f
                    }
                }
            }
            e = a.nodeName.toLowerCase();
            f = "div" == e || "span" == e;
            a.id || (this.uuid += 1,
            a.id = "dp" + this.uuid);
            var j = this._newInst(d(a), f);
            j.settings = d.extend({}, b || {}, c || {});
            "input" == e ? this._connectDatepicker(a, j) : f && this._inlineDatepicker(a, j)
        },
        _newInst: function(a, b) {
            return {
                id: a[0].id.replace(/([^A-Za-z0-9_-])/g, "\\\\$1"),
                input: a,
                selectedDay: 0,
                selectedMonth: 0,
                selectedYear: 0,
                drawMonth: 0,
                drawYear: 0,
                inline: b,
                dpDiv: !b ? this.dpDiv : C(d('<div class="' + this._inlineClass + ' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))
            }
        },
        _connectDatepicker: function(a, b) {
            var c = d(a);
            b.append = d([]);
            b.trigger = d([]);
            c.hasClass(this.markerClassName) || (this._attachments(c, b),
            c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker", function(a, c, d) {
                b.settings[c] = d
            }).bind("getData.datepicker", function(a, c) {
                return this._get(b, c)
            }),
            this._autoSize(b),
            d.data(a, "datepicker", b),
            b.settings.disabled && this._disableDatepicker(a))
        },
        _attachments: function(a, b) {
            var c = this._get(b, "appendText")
              , e = this._get(b, "isRTL");
            b.append && b.append.remove();
            c && (b.append = d('<span class="' + this._appendClass + '">' + c + "</span>"),
            a[e ? "before" : "after"](b.append));
            a.unbind("focus", this._showDatepicker);
            b.trigger && b.trigger.remove();
            c = this._get(b, "showOn");
            ("focus" == c || "both" == c) && a.focus(this._showDatepicker);
            if ("button" == c || "both" == c) {
                var c = this._get(b, "buttonText")
                  , f = this._get(b, "buttonImage");
                b.trigger = d(this._get(b, "buttonImageOnly") ? d("<img/>").addClass(this._triggerClass).attr({
                    src: f,
                    alt: c,
                    title: c
                }) : d('<button type="button"></button>').addClass(this._triggerClass).html("" == f ? c : d("<img/>").attr({
                    src: f,
                    alt: c,
                    title: c
                })));
                a[e ? "before" : "after"](b.trigger);
                b.trigger.click(function() {
                    if (d.datepicker._datepickerShowing && d.datepicker._lastInput == a[0])
                        d.datepicker._hideDatepicker();
                    else {
                        d.datepicker._datepickerShowing && d.datepicker._lastInput != a[0] && d.datepicker._hideDatepicker();
                        d.datepicker._showDatepicker(a[0])
                    }
                    return false
                })
            }
        },
        _autoSize: function(a) {
            if (this._get(a, "autoSize") && !a.inline) {
                var b = new Date(2009,11,20)
                  , c = this._get(a, "dateFormat");
                if (c.match(/[DM]/)) {
                    var d = function(a) {
                        for (var b = 0, c = 0, d = 0; d < a.length; d++)
                            a[d].length > b && (b = a[d].length,
                            c = d);
                        return c
                    };
                    b.setMonth(d(this._get(a, c.match(/MM/) ? "monthNames" : "monthNamesShort")));
                    b.setDate(d(this._get(a, c.match(/DD/) ? "dayNames" : "dayNamesShort")) + 20 - b.getDay())
                }
                a.input.attr("size", this._formatDate(a, b).length)
            }
        },
        _inlineDatepicker: function(a, b) {
            var c = d(a);
            c.hasClass(this.markerClassName) || (c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker", function(a, c, d) {
                b.settings[c] = d
            }).bind("getData.datepicker", function(a, c) {
                return this._get(b, c)
            }),
            d.data(a, "datepicker", b),
            this._setDate(b, this._getDefaultDate(b), !0),
            this._updateDatepicker(b),
            this._updateAlternate(b),
            b.settings.disabled && this._disableDatepicker(a),
            b.dpDiv.css("display", "block"))
        },
        _dialogDatepicker: function(a, b, c, e, f) {
            a = this._dialogInst;
            a || (this.uuid += 1,
            this._dialogInput = d('<input type="text" id="dp' + this.uuid + '" style="position: absolute; top: -100px; width: 0px;"/>'),
            this._dialogInput.keydown(this._doKeyDown),
            d("body").append(this._dialogInput),
            a = this._dialogInst = this._newInst(this._dialogInput, !1),
            a.settings = {},
            d.data(this._dialogInput[0], "datepicker", a));
            z(a.settings, e || {});
            b = b && b.constructor == Date ? this._formatDate(a, b) : b;
            this._dialogInput.val(b);
            this._pos = f ? f.length ? f : [f.pageX, f.pageY] : null;
            this._pos || (this._pos = [document.documentElement.clientWidth / 2 - 100 + (document.documentElement.scrollLeft || document.body.scrollLeft), document.documentElement.clientHeight / 2 - 150 + (document.documentElement.scrollTop || document.body.scrollTop)]);
            this._dialogInput.css("left", this._pos[0] + 20 + "px").css("top", this._pos[1] + "px");
            a.settings.onSelect = c;
            this._inDialog = !0;
            this.dpDiv.addClass(this._dialogClass);
            this._showDatepicker(this._dialogInput[0]);
            d.blockUI && d.blockUI(this.dpDiv);
            d.data(this._dialogInput[0], "datepicker", a);
            return this
        },
        _destroyDatepicker: function(a) {
            var b = d(a)
              , c = d.data(a, "datepicker");
            if (b.hasClass(this.markerClassName)) {
                var e = a.nodeName.toLowerCase();
                d.removeData(a, "datepicker");
                "input" == e ? (c.append.remove(),
                c.trigger.remove(),
                b.removeClass(this.markerClassName).unbind("focus", this._showDatepicker).unbind("keydown", this._doKeyDown).unbind("keypress", this._doKeyPress).unbind("keyup", this._doKeyUp)) : ("div" == e || "span" == e) && b.removeClass(this.markerClassName).empty()
            }
        },
        _enableDatepicker: function(a) {
            var b = d(a)
              , c = d.data(a, "datepicker");
            if (b.hasClass(this.markerClassName)) {
                var e = a.nodeName.toLowerCase();
                if ("input" == e)
                    a.disabled = !1,
                    c.trigger.filter("button").each(function() {
                        this.disabled = !1
                    }).end().filter("img").css({
                        opacity: "1.0",
                        cursor: ""
                    });
                else if ("div" == e || "span" == e)
                    b = b.children("." + this._inlineClass),
                    b.children().removeClass("ui-state-disabled"),
                    b.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled");
                this._disabledInputs = d.map(this._disabledInputs, function(b) {
                    return b == a ? null : b
                })
            }
        },
        _disableDatepicker: function(a) {
            var b = d(a)
              , c = d.data(a, "datepicker");
            if (b.hasClass(this.markerClassName)) {
                var e = a.nodeName.toLowerCase();
                if ("input" == e)
                    a.disabled = !0,
                    c.trigger.filter("button").each(function() {
                        this.disabled = !0
                    }).end().filter("img").css({
                        opacity: "0.5",
                        cursor: "default"
                    });
                else if ("div" == e || "span" == e)
                    b = b.children("." + this._inlineClass),
                    b.children().addClass("ui-state-disabled"),
                    b.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled", "disabled");
                this._disabledInputs = d.map(this._disabledInputs, function(b) {
                    return b == a ? null : b
                });
                this._disabledInputs[this._disabledInputs.length] = a
            }
        },
        _isDisabledDatepicker: function(a) {
            if (!a)
                return !1;
            for (var b = 0; b < this._disabledInputs.length; b++)
                if (this._disabledInputs[b] == a)
                    return !0;
            return !1
        },
        _getInst: function(a) {
            try {
                return d.data(a, "datepicker")
            } catch (b) {
                throw "Missing instance data for this datepicker";
            }
        },
        _optionDatepicker: function(a, b, c) {
            var e = this._getInst(a);
            if (2 == arguments.length && "string" == typeof b)
                return "defaults" == b ? d.extend({}, d.datepicker._defaults) : e ? "all" == b ? d.extend({}, e.settings) : this._get(e, b) : null;
            var f = b || {};
            "string" == typeof b && (f = {},
            f[b] = c);
            if (e) {
                this._curInst == e && this._hideDatepicker();
                var h = this._getDateDatepicker(a, !0)
                  , j = this._getMinMaxDate(e, "min")
                  , g = this._getMinMaxDate(e, "max");
                z(e.settings, f);
                null !== j && (void 0 !== f.dateFormat && void 0 === f.minDate) && (e.settings.minDate = this._formatDate(e, j));
                null !== g && (void 0 !== f.dateFormat && void 0 === f.maxDate) && (e.settings.maxDate = this._formatDate(e, g));
                this._attachments(d(a), e);
                this._autoSize(e);
                this._setDate(e, h);
                this._updateAlternate(e);
                this._updateDatepicker(e)
            }
        },
        _changeDatepicker: function(a, b, c) {
            this._optionDatepicker(a, b, c)
        },
        _refreshDatepicker: function(a) {
            (a = this._getInst(a)) && this._updateDatepicker(a)
        },
        _setDateDatepicker: function(a, b) {
            var c = this._getInst(a);
            c && (this._setDate(c, b),
            this._updateDatepicker(c),
            this._updateAlternate(c))
        },
        _getDateDatepicker: function(a, b) {
            var c = this._getInst(a);
            c && !c.inline && this._setDateFromField(c, b);
            return c ? this._getDate(c) : null
        },
        _doKeyDown: function(a) {
            var b = d.datepicker._getInst(a.target)
              , c = !0
              , e = b.dpDiv.is(".ui-datepicker-rtl");
            b._keyEvent = !0;
            if (d.datepicker._datepickerShowing)
                switch (a.keyCode) {
                case 9:
                    d.datepicker._hideDatepicker();
                    c = !1;
                    break;
                case 13:
                    return c = d("td." + d.datepicker._dayOverClass + ":not(." + d.datepicker._currentClass + ")", b.dpDiv),
                    c[0] && d.datepicker._selectDay(a.target, b.selectedMonth, b.selectedYear, c[0]),
                    (a = d.datepicker._get(b, "onSelect")) ? (c = d.datepicker._formatDate(b),
                    a.apply(b.input ? b.input[0] : null, [c, b])) : d.datepicker._hideDatepicker(),
                    !1;
                case 27:
                    d.datepicker._hideDatepicker();
                    break;
                case 33:
                    d.datepicker._adjustDate(a.target, a.ctrlKey ? -d.datepicker._get(b, "stepBigMonths") : -d.datepicker._get(b, "stepMonths"), "M");
                    break;
                case 34:
                    d.datepicker._adjustDate(a.target, a.ctrlKey ? +d.datepicker._get(b, "stepBigMonths") : +d.datepicker._get(b, "stepMonths"), "M");
                    break;
                case 35:
                    (a.ctrlKey || a.metaKey) && d.datepicker._clearDate(a.target);
                    c = a.ctrlKey || a.metaKey;
                    break;
                case 36:
                    (a.ctrlKey || a.metaKey) && d.datepicker._gotoToday(a.target);
                    c = a.ctrlKey || a.metaKey;
                    break;
                case 37:
                    if (a.ctrlKey || a.metaKey)
                        d.datepicker._adjustDate(a.target, e ? 1 : -1, "D");
                    c = a.ctrlKey || a.metaKey;
                    a.originalEvent.altKey && d.datepicker._adjustDate(a.target, a.ctrlKey ? -d.datepicker._get(b, "stepBigMonths") : -d.datepicker._get(b, "stepMonths"), "M");
                    break;
                case 38:
                    (a.ctrlKey || a.metaKey) && d.datepicker._adjustDate(a.target, -7, "D");
                    c = a.ctrlKey || a.metaKey;
                    break;
                case 39:
                    if (a.ctrlKey || a.metaKey)
                        d.datepicker._adjustDate(a.target, e ? -1 : 1, "D");
                    c = a.ctrlKey || a.metaKey;
                    a.originalEvent.altKey && d.datepicker._adjustDate(a.target, a.ctrlKey ? +d.datepicker._get(b, "stepBigMonths") : +d.datepicker._get(b, "stepMonths"), "M");
                    break;
                case 40:
                    (a.ctrlKey || a.metaKey) && d.datepicker._adjustDate(a.target, 7, "D");
                    c = a.ctrlKey || a.metaKey;
                    break;
                default:
                    c = !1
                }
            else
                36 == a.keyCode && a.ctrlKey ? d.datepicker._showDatepicker(this) : c = !1;
            c && (a.preventDefault(),
            a.stopPropagation())
        },
        _doKeyPress: function(a) {
            var b = d.datepicker._getInst(a.target);
            if (d.datepicker._get(b, "constrainInput")) {
                var b = d.datepicker._possibleChars(d.datepicker._get(b, "dateFormat"))
                  , c = String.fromCharCode(void 0 == a.charCode ? a.keyCode : a.charCode);
                return a.ctrlKey || a.metaKey || " " > c || !b || -1 < b.indexOf(c)
            }
        },
        _doKeyUp: function(a) {
            a = d.datepicker._getInst(a.target);
            if (a.input.val() != a.lastVal)
                try {
                    if (d.datepicker.parseDate(d.datepicker._get(a, "dateFormat"), a.input ? a.input.val() : null, d.datepicker._getFormatConfig(a)))
                        d.datepicker._setDateFromField(a),
                        d.datepicker._updateAlternate(a),
                        d.datepicker._updateDatepicker(a)
                } catch (b) {
                    d.datepicker.log(b)
                }
            return !0
        },
        _showDatepicker: function(a) {
            a = a.target || a;
            "input" != a.nodeName.toLowerCase() && (a = d("input", a.parentNode)[0]);
            if (!(d.datepicker._isDisabledDatepicker(a) || d.datepicker._lastInput == a)) {
                var b = d.datepicker._getInst(a);
                d.datepicker._curInst && d.datepicker._curInst != b && (d.datepicker._curInst.dpDiv.stop(!0, !0),
                b && d.datepicker._datepickerShowing && d.datepicker._hideDatepicker(d.datepicker._curInst.input[0]));
                var c = d.datepicker._get(b, "beforeShow")
                  , c = c ? c.apply(a, [a, b]) : {};
                if (!1 !== c) {
                    z(b.settings, c);
                    b.lastVal = null;
                    d.datepicker._lastInput = a;
                    d.datepicker._setDateFromField(b);
                    d.datepicker._inDialog && (a.value = "");
                    d.datepicker._pos || (d.datepicker._pos = d.datepicker._findPos(a),
                    d.datepicker._pos[1] += a.offsetHeight);
                    var e = !1;
                    d(a).parents().each(function() {
                        e = e | d(this).css("position") == "fixed";
                        return !e
                    });
                    e && d.browser.opera && (d.datepicker._pos[0] -= document.documentElement.scrollLeft,
                    d.datepicker._pos[1] -= document.documentElement.scrollTop);
                    c = {
                        left: d.datepicker._pos[0],
                        top: d.datepicker._pos[1]
                    };
                    d.datepicker._pos = null;
                    b.dpDiv.empty();
                    b.dpDiv.css({
                        position: "absolute",
                        display: "block",
                        top: "-1000px"
                    });
                    d.datepicker._updateDatepicker(b);
                    c = d.datepicker._checkOffset(b, c, e);
                    b.dpDiv.css({
                        position: d.datepicker._inDialog && d.blockUI ? "static" : e ? "fixed" : "absolute",
                        display: "none",
                        left: c.left + "px",
                        top: c.top + "px"
                    });
                    if (!b.inline) {
                        var c = d.datepicker._get(b, "showAnim")
                          , f = d.datepicker._get(b, "duration")
                          , h = function() {
                            var a = b.dpDiv.find("iframe.ui-datepicker-cover");
                            if (a.length) {
                                var c = d.datepicker._getBorders(b.dpDiv);
                                a.css({
                                    left: -c[0],
                                    top: -c[1],
                                    width: b.dpDiv.outerWidth(),
                                    height: b.dpDiv.outerHeight()
                                })
                            }
                        };
                        b.dpDiv.zIndex(d(a).zIndex() + 1);
                        d.datepicker._datepickerShowing = !0;
                        if (d.effects && d.effects[c])
                            b.dpDiv.show(c, d.datepicker._get(b, "showOptions"), f, h);
                        else
                            b.dpDiv[c || "show"](c ? f : null, h);
                        (!c || !f) && h();
                        b.input.is(":visible") && !b.input.is(":disabled") && b.input.focus();
                        d.datepicker._curInst = b
                    }
                }
            }
        },
        _updateDatepicker: function(a) {
            this.maxRows = 4;
            var b = d.datepicker._getBorders(a.dpDiv);
            D = a;
            a.dpDiv.empty().append(this._generateHTML(a));
            this._attachHandlers(a);
            var c = a.dpDiv.find("iframe.ui-datepicker-cover");
            c.length && c.css({
                left: -b[0],
                top: -b[1],
                width: a.dpDiv.outerWidth(),
                height: a.dpDiv.outerHeight()
            });
            a.dpDiv.find("." + this._dayOverClass + " a").mouseover();
            b = this._getNumberOfMonths(a);
            c = b[1];
            a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width("");
            1 < c && a.dpDiv.addClass("ui-datepicker-multi-" + c).css("width", 17 * c + "em");
            a.dpDiv[(1 != b[0] || 1 != b[1] ? "add" : "remove") + "Class"]("ui-datepicker-multi");
            a.dpDiv[(this._get(a, "isRTL") ? "add" : "remove") + "Class"]("ui-datepicker-rtl");
            a == d.datepicker._curInst && (d.datepicker._datepickerShowing && a.input && a.input.is(":visible") && !a.input.is(":disabled") && a.input[0] != document.activeElement) && a.input.focus();
            if (a.yearshtml) {
                var e = a.yearshtml;
                setTimeout(function() {
                    e === a.yearshtml && a.yearshtml && a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml);
                    e = a.yearshtml = null
                }, 0)
            }
        },
        _getBorders: function(a) {
            var b = function(a) {
                return {
                    thin: 1,
                    medium: 2,
                    thick: 3
                }[a] || a
            };
            return [parseFloat(b(a.css("border-left-width"))), parseFloat(b(a.css("border-top-width")))]
        },
        _checkOffset: function(a, b, c) {
            var e = a.dpDiv.outerWidth()
              , f = a.dpDiv.outerHeight()
              , h = a.input ? a.input.outerWidth() : 0
              , j = a.input ? a.input.outerHeight() : 0
              , g = document.documentElement.clientWidth + (c ? 0 : d(document).scrollLeft())
              , i = document.documentElement.clientHeight + (c ? 0 : d(document).scrollTop());
            b.left -= this._get(a, "isRTL") ? e - h : 0;
            b.left -= c && b.left == a.input.offset().left ? d(document).scrollLeft() : 0;
            b.top -= c && b.top == a.input.offset().top + j ? d(document).scrollTop() : 0;
            b.left -= Math.min(b.left, b.left + e > g && g > e ? Math.abs(b.left + e - g) : 0);
            b.top -= Math.min(b.top, b.top + f > i && i > f ? Math.abs(f + j) : 0);
            return b
        },
        _findPos: function(a) {
            for (var b = this._getInst(a), b = this._get(b, "isRTL"); a && ("hidden" == a.type || 1 != a.nodeType || d.expr.filters.hidden(a)); )
                a = a[b ? "previousSibling" : "nextSibling"];
            a = d(a).offset();
            return [a.left, a.top]
        },
        _hideDatepicker: function(a) {
            var b = this._curInst;
            if (b && !(a && b != d.data(a, "datepicker")) && this._datepickerShowing) {
                var a = this._get(b, "showAnim")
                  , c = this._get(b, "duration")
                  , e = function() {
                    d.datepicker._tidyDialog(b)
                };
                if (d.effects && d.effects[a])
                    b.dpDiv.hide(a, d.datepicker._get(b, "showOptions"), c, e);
                else
                    b.dpDiv["slideDown" == a ? "slideUp" : "fadeIn" == a ? "fadeOut" : "hide"](a ? c : null, e);
                a || e();
                this._datepickerShowing = !1;
                (a = this._get(b, "onClose")) && a.apply(b.input ? b.input[0] : null, [b.input ? b.input.val() : "", b]);
                this._lastInput = null;
                this._inDialog && (this._dialogInput.css({
                    position: "absolute",
                    left: "0",
                    top: "-100px"
                }),
                d.blockUI && (d.unblockUI(),
                d("body").append(this.dpDiv)));
                this._inDialog = !1
            }
        },
        _tidyDialog: function(a) {
            a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")
        },
        _checkExternalClick: function(a) {
            if (d.datepicker._curInst) {
                var a = d(a.target)
                  , b = d.datepicker._getInst(a[0]);
                (a[0].id != d.datepicker._mainDivId && 0 == a.parents("#" + d.datepicker._mainDivId).length && !a.hasClass(d.datepicker.markerClassName) && !a.closest("." + d.datepicker._triggerClass).length && d.datepicker._datepickerShowing && (!d.datepicker._inDialog || !d.blockUI) || a.hasClass(d.datepicker.markerClassName) && d.datepicker._curInst != b) && d.datepicker._hideDatepicker()
            }
        },
        _adjustDate: function(a, b, c) {
            var a = d(a)
              , e = this._getInst(a[0]);
            this._isDisabledDatepicker(a[0]) || (this._adjustInstDate(e, b + ("M" == c ? this._get(e, "showCurrentAtPos") : 0), c),
            this._updateDatepicker(e))
        },
        _gotoToday: function(a) {
            var a = d(a)
              , b = this._getInst(a[0]);
            if (this._get(b, "gotoCurrent") && b.currentDay)
                b.selectedDay = b.currentDay,
                b.drawMonth = b.selectedMonth = b.currentMonth,
                b.drawYear = b.selectedYear = b.currentYear;
            else {
                var c = new Date;
                b.selectedDay = c.getDate();
                b.drawMonth = b.selectedMonth = c.getMonth();
                b.drawYear = b.selectedYear = c.getFullYear()
            }
            this._notifyChange(b);
            this._adjustDate(a)
        },
        _selectMonthYear: function(a, b, c) {
            var a = d(a)
              , e = this._getInst(a[0]);
            e["selected" + ("M" == c ? "Month" : "Year")] = e["draw" + ("M" == c ? "Month" : "Year")] = parseInt(b.options[b.selectedIndex].value, 10);
            this._notifyChange(e);
            this._adjustDate(a)
        },
        _selectDay: function(a, b, c, e) {
            var f = d(a);
            !d(e).hasClass(this._unselectableClass) && !this._isDisabledDatepicker(f[0]) && (f = this._getInst(f[0]),
            f.selectedDay = f.currentDay = d("a", e).html(),
            f.selectedMonth = f.currentMonth = b,
            f.selectedYear = f.currentYear = c,
            this._selectDate(a, this._formatDate(f, f.currentDay, f.currentMonth, f.currentYear)))
        },
        _clearDate: function(a) {
            a = d(a);
            this._getInst(a[0]);
            this._selectDate(a, "")
        },
        _selectDate: function(a, b) {
            var c = d(a)
              , c = this._getInst(c[0])
              , b = null != b ? b : this._formatDate(c);
            c.input && c.input.val(b);
            this._updateAlternate(c);
            var e = this._get(c, "onSelect");
            e ? e.apply(c.input ? c.input[0] : null, [b, c]) : c.input && c.input.trigger("change");
            c.inline ? this._updateDatepicker(c) : (this._hideDatepicker(),
            this._lastInput = c.input[0],
            "object" != typeof c.input[0] && c.input.focus(),
            this._lastInput = null)
        },
        _updateAlternate: function(a) {
            var b = this._get(a, "altField");
            if (b) {
                var c = this._get(a, "altFormat") || this._get(a, "dateFormat")
                  , e = this._getDate(a)
                  , f = this.formatDate(c, e, this._getFormatConfig(a));
                d(b).each(function() {
                    d(this).val(f)
                })
            }
        },
        noWeekends: function(a) {
            a = a.getDay();
            return [0 < a && 6 > a, ""]
        },
        iso8601Week: function(a) {
            a = new Date(a.getTime());
            a.setDate(a.getDate() + 4 - (a.getDay() || 7));
            var b = a.getTime();
            a.setMonth(0);
            a.setDate(1);
            return Math.floor(Math.round((b - a) / 864E5) / 7) + 1
        },
        parseDate: function(a, b, c) {
            if (null == a || null == b)
                throw "Invalid arguments";
            b = "object" == typeof b ? b.toString() : b + "";
            if ("" == b)
                return null;
            for (var e = (c ? c.shortYearCutoff : null) || this._defaults.shortYearCutoff, e = "string" != typeof e ? e : (new Date).getFullYear() % 100 + parseInt(e, 10), f = (c ? c.dayNamesShort : null) || this._defaults.dayNamesShort, h = (c ? c.dayNames : null) || this._defaults.dayNames, j = (c ? c.monthNamesShort : null) || this._defaults.monthNamesShort, g = (c ? c.monthNames : null) || this._defaults.monthNames, i = c = -1, p = -1, r = -1, k = !1, m = function(b) {
                (b = y + 1 < a.length && a.charAt(y + 1) == b) && y++;
                return b
            }, l = function(a) {
                var c = m(a)
                  , a = RegExp("^\\d{1," + ("@" == a ? 14 : "!" == a ? 20 : "y" == a && c ? 4 : "o" == a ? 3 : 2) + "}")
                  , a = b.substring(u).match(a);
                if (!a)
                    throw "Missing number at position " + u;
                u += a[0].length;
                return parseInt(a[0], 10)
            }, n = function(a, c, e) {
                var a = d.map(m(a) ? e : c, function(a, b) {
                    return [[b, a]]
                }).sort(function(a, b) {
                    return -(a[1].length - b[1].length)
                })
                  , f = -1;
                d.each(a, function(a, c) {
                    var d = c[1];
                    if (b.substr(u, d.length).toLowerCase() == d.toLowerCase())
                        return f = c[0],
                        u += d.length,
                        !1
                });
                if (-1 != f)
                    return f + 1;
                throw "Unknown name at position " + u;
            }, s = function() {
                if (b.charAt(u) != a.charAt(y))
                    throw "Unexpected literal at position " + u;
                u++
            }, u = 0, y = 0; y < a.length; y++)
                if (k)
                    "'" == a.charAt(y) && !m("'") ? k = !1 : s();
                else
                    switch (a.charAt(y)) {
                    case "d":
                        p = l("d");
                        break;
                    case "D":
                        n("D", f, h);
                        break;
                    case "o":
                        r = l("o");
                        break;
                    case "m":
                        i = l("m");
                        break;
                    case "M":
                        i = n("M", j, g);
                        break;
                    case "y":
                        c = l("y");
                        break;
                    case "@":
                        var v = new Date(l("@"))
                          , c = v.getFullYear()
                          , i = v.getMonth() + 1
                          , p = v.getDate();
                        break;
                    case "!":
                        v = new Date((l("!") - this._ticksTo1970) / 1E4);
                        c = v.getFullYear();
                        i = v.getMonth() + 1;
                        p = v.getDate();
                        break;
                    case "'":
                        m("'") ? s() : k = !0;
                        break;
                    default:
                        s()
                    }
            if (u < b.length)
                throw "Extra/unparsed characters found in date: " + b.substring(u);
            -1 == c ? c = (new Date).getFullYear() : 100 > c && (c += (new Date).getFullYear() - (new Date).getFullYear() % 100 + (c <= e ? 0 : -100));
            if (-1 < r) {
                i = 1;
                p = r;
                do {
                    e = this._getDaysInMonth(c, i - 1);
                    if (p <= e)
                        break;
                    i++;
                    p -= e
                } while (1)
            }
            v = this._daylightSavingAdjust(new Date(c,i - 1,p));
            if (v.getFullYear() != c || v.getMonth() + 1 != i || v.getDate() != p)
                throw "Invalid date";
            return v
        },
        ATOM: "yy-mm-dd",
        COOKIE: "D, dd M yy",
        ISO_8601: "yy-mm-dd",
        RFC_822: "D, d M y",
        RFC_850: "DD, dd-M-y",
        RFC_1036: "D, d M y",
        RFC_1123: "D, d M yy",
        RFC_2822: "D, d M yy",
        RSS: "D, d M y",
        TICKS: "!",
        TIMESTAMP: "@",
        W3C: "yy-mm-dd",
        _ticksTo1970: 864E9 * (718685 + Math.floor(492.5) - Math.floor(19.7) + Math.floor(4.925)),
        formatDate: function(a, b, c) {
            if (!b)
                return "";
            var d = (c ? c.dayNamesShort : null) || this._defaults.dayNamesShort
              , f = (c ? c.dayNames : null) || this._defaults.dayNames
              , h = (c ? c.monthNamesShort : null) || this._defaults.monthNamesShort
              , c = (c ? c.monthNames : null) || this._defaults.monthNames
              , j = function(b) {
                (b = r + 1 < a.length && a.charAt(r + 1) == b) && r++;
                return b
            }
              , g = function(a, b, c) {
                b = "" + b;
                if (j(a))
                    for (; b.length < c; )
                        b = "0" + b;
                return b
            }
              , i = ""
              , p = !1;
            if (b)
                for (var r = 0; r < a.length; r++)
                    if (p)
                        "'" == a.charAt(r) && !j("'") ? p = !1 : i += a.charAt(r);
                    else
                        switch (a.charAt(r)) {
                        case "d":
                            i += g("d", b.getDate(), 2);
                            break;
                        case "D":
                            var k;
                            k = b.getDay();
                            var m = d
                              , l = f;
                            k = j("D") ? l[k] : m[k];
                            i += k;
                            break;
                        case "o":
                            i += g("o", Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime() - (new Date(b.getFullYear(),0,0)).getTime()) / 864E5), 3);
                            break;
                        case "m":
                            i += g("m", b.getMonth() + 1, 2);
                            break;
                        case "M":
                            k = b.getMonth();
                            m = h;
                            l = c;
                            k = j("M") ? l[k] : m[k];
                            i += k;
                            break;
                        case "y":
                            i += j("y") ? b.getFullYear() : (10 > b.getYear() % 100 ? "0" : "") + b.getYear() % 100;
                            break;
                        case "@":
                            i += b.getTime();
                            break;
                        case "!":
                            i += 1E4 * b.getTime() + this._ticksTo1970;
                            break;
                        case "'":
                            j("'") ? i += "'" : p = !0;
                            break;
                        default:
                            i += a.charAt(r)
                        }
            return i
        },
        _possibleChars: function(a) {
            for (var b = "", c = !1, d = function(b) {
                (b = f + 1 < a.length && a.charAt(f + 1) == b) && f++;
                return b
            }, f = 0; f < a.length; f++)
                if (c)
                    "'" == a.charAt(f) && !d("'") ? c = !1 : b += a.charAt(f);
                else
                    switch (a.charAt(f)) {
                    case "d":
                    case "m":
                    case "y":
                    case "@":
                        b += "0123456789";
                        break;
                    case "D":
                    case "M":
                        return null;
                    case "'":
                        d("'") ? b += "'" : c = !0;
                        break;
                    default:
                        b += a.charAt(f)
                    }
            return b
        },
        _get: function(a, b) {
            return void 0 !== a.settings[b] ? a.settings[b] : this._defaults[b]
        },
        _setDateFromField: function(a, b) {
            if (a.input.val() != a.lastVal) {
                var c = this._get(a, "dateFormat"), d = a.lastVal = a.input ? a.input.val() : null, f, h;
                f = h = this._getDefaultDate(a);
                var j = this._getFormatConfig(a);
                try {
                    f = this.parseDate(c, d, j) || h
                } catch (g) {
                    this.log(g),
                    d = b ? "" : d
                }
                a.selectedDay = f.getDate();
                a.drawMonth = a.selectedMonth = f.getMonth();
                a.drawYear = a.selectedYear = f.getFullYear();
                a.currentDay = d ? f.getDate() : 0;
                a.currentMonth = d ? f.getMonth() : 0;
                a.currentYear = d ? f.getFullYear() : 0;
                this._adjustInstDate(a)
            }
        },
        _getDefaultDate: function(a) {
            return this._restrictMinMax(a, this._determineDate(a, this._get(a, "defaultDate"), new Date))
        },
        _determineDate: function(a, b, c) {
            if (null == b || "" === b)
                b = c;
            else {
                var e;
                if ("string" == typeof b)
                    a: {
                        try {
                            e = d.datepicker.parseDate(d.datepicker._get(a, "dateFormat"), b, d.datepicker._getFormatConfig(a));
                            break a
                        } catch (f) {}
                        var h = (b.toLowerCase().match(/^c/) ? d.datepicker._getDate(a) : null) || new Date
                          , a = h.getFullYear();
                        e = h.getMonth();
                        for (var h = h.getDate(), j = /([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g, g = j.exec(b); g; ) {
                            switch (g[2] || "d") {
                            case "d":
                            case "D":
                                h += parseInt(g[1], 10);
                                break;
                            case "w":
                            case "W":
                                h += 7 * parseInt(g[1], 10);
                                break;
                            case "m":
                            case "M":
                                e += parseInt(g[1], 10);
                                h = Math.min(h, d.datepicker._getDaysInMonth(a, e));
                                break;
                            case "y":
                            case "Y":
                                a += parseInt(g[1], 10),
                                h = Math.min(h, d.datepicker._getDaysInMonth(a, e))
                            }
                            g = j.exec(b)
                        }
                        e = new Date(a,e,h)
                    }
                else
                    "number" == typeof b ? isNaN(b) ? b = c : (a = new Date,
                    a.setDate(a.getDate() + b),
                    b = a) : b = new Date(b.getTime()),
                    e = b;
                b = e
            }
            if (b = b && "Invalid Date" == b.toString() ? c : b)
                b.setHours(0),
                b.setMinutes(0),
                b.setSeconds(0),
                b.setMilliseconds(0);
            return this._daylightSavingAdjust(b)
        },
        _daylightSavingAdjust: function(a) {
            if (!a)
                return null;
            a.setHours(12 < a.getHours() ? a.getHours() + 2 : 0);
            return a
        },
        _setDate: function(a, b, c) {
            var d = !b
              , f = a.selectedMonth
              , h = a.selectedYear
              , b = this._restrictMinMax(a, this._determineDate(a, b, new Date));
            a.selectedDay = a.currentDay = b.getDate();
            a.drawMonth = a.selectedMonth = a.currentMonth = b.getMonth();
            a.drawYear = a.selectedYear = a.currentYear = b.getFullYear();
            (f != a.selectedMonth || h != a.selectedYear) && !c && this._notifyChange(a);
            this._adjustInstDate(a);
            a.input && a.input.val(d ? "" : this._formatDate(a))
        },
        _getDate: function(a) {
            return !a.currentYear || a.input && "" == a.input.val() ? null : this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay))
        },
        _attachHandlers: function(a) {
            var b = this._get(a, "stepMonths")
              , c = "#" + a.id.replace(/\\\\/g, "\\");
            a.dpDiv.find("[data-handler]").map(function() {
                d(this).bind(this.getAttribute("data-event"), {
                    prev: function() {
                        window["DP_jQuery_" + x].datepicker._adjustDate(c, -b, "M")
                    },
                    next: function() {
                        window["DP_jQuery_" + x].datepicker._adjustDate(c, +b, "M")
                    },
                    hide: function() {
                        window["DP_jQuery_" + x].datepicker._hideDatepicker()
                    },
                    today: function() {
                        window["DP_jQuery_" + x].datepicker._gotoToday(c)
                    },
                    selectDay: function() {
                        window["DP_jQuery_" + x].datepicker._selectDay(c, +this.getAttribute("data-month"), +this.getAttribute("data-year"), this);
                        return !1
                    },
                    selectMonth: function() {
                        window["DP_jQuery_" + x].datepicker._selectMonthYear(c, this, "M");
                        return !1
                    },
                    selectYear: function() {
                        window["DP_jQuery_" + x].datepicker._selectMonthYear(c, this, "Y");
                        return !1
                    }
                }[this.getAttribute("data-handler")])
            })
        },
        _generateHTML: function(a) {
            var b = new Date
              , b = this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate()))
              , c = this._get(a, "isRTL")
              , e = this._get(a, "showButtonPanel")
              , f = this._get(a, "hideIfNoPrevNext")
              , h = this._get(a, "navigationAsDateFormat")
              , j = this._getNumberOfMonths(a)
              , g = this._get(a, "showCurrentAtPos")
              , i = this._get(a, "stepMonths")
              , p = 1 != j[0] || 1 != j[1]
              , r = this._daylightSavingAdjust(!a.currentDay ? new Date(9999,9,9) : new Date(a.currentYear,a.currentMonth,a.currentDay))
              , k = this._getMinMaxDate(a, "min")
              , m = this._getMinMaxDate(a, "max")
              , g = a.drawMonth - g
              , l = a.drawYear;
            0 > g && (g += 12,
            l--);
            if (m)
                for (var n = this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth() - j[0] * j[1] + 1,m.getDate())), n = k && n < k ? k : n; this._daylightSavingAdjust(new Date(l,g,1)) > n; )
                    g--,
                    0 > g && (g = 11,
                    l--);
            a.drawMonth = g;
            a.drawYear = l;
            var n = this._get(a, "prevText")
              , n = !h ? n : this.formatDate(n, this._daylightSavingAdjust(new Date(l,g - i,1)), this._getFormatConfig(a))
              , n = this._canAdjustMonth(a, -1, l, g) ? '<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="' + n + '"><span class="ui-icon ui-icon-circle-triangle-' + (c ? "e" : "w") + '">' + n + "</span></a>" : f ? "" : '<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="' + n + '"><span class="ui-icon ui-icon-circle-triangle-' + (c ? "e" : "w") + '">' + n + "</span></a>"
              , s = this._get(a, "nextText")
              , s = !h ? s : this.formatDate(s, this._daylightSavingAdjust(new Date(l,g + i,1)), this._getFormatConfig(a))
              , f = this._canAdjustMonth(a, 1, l, g) ? '<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="' + s + '"><span class="ui-icon ui-icon-circle-triangle-' + (c ? "w" : "e") + '">' + s + "</span></a>" : f ? "" : '<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="' + s + '"><span class="ui-icon ui-icon-circle-triangle-' + (c ? "w" : "e") + '">' + s + "</span></a>"
              , i = this._get(a, "currentText")
              , s = this._get(a, "gotoCurrent") && a.currentDay ? r : b
              , i = !h ? i : this.formatDate(i, s, this._getFormatConfig(a))
              , h = !a.inline ? '<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">' + this._get(a, "closeText") + "</button>" : ""
              , e = e ? '<div class="ui-datepicker-buttonpane ui-widget-content">' + (c ? h : "") + (this._isInRange(a, s) ? '<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">' + i + "</button>" : "") + (c ? "" : h) + "</div>" : ""
              , h = parseInt(this._get(a, "firstDay"), 10)
              , h = isNaN(h) ? 0 : h
              , i = this._get(a, "showWeek")
              , s = this._get(a, "dayNames");
            this._get(a, "dayNamesShort");
            var u = this._get(a, "dayNamesMin")
              , y = this._get(a, "monthNames")
              , v = this._get(a, "monthNamesShort")
              , x = this._get(a, "beforeShowDay")
              , z = this._get(a, "showOtherMonths")
              , D = this._get(a, "selectOtherMonths");
            this._get(a, "calculateWeek");
            for (var B = this._getDefaultDate(a), E = "", F = 0; F < j[0]; F++) {
                var I = "";
                this.maxRows = 4;
                for (var G = 0; G < j[1]; G++) {
                    var C = this._daylightSavingAdjust(new Date(l,g,a.selectedDay))
                      , t = " ui-corner-all"
                      , q = "";
                    if (p) {
                        q += '<div class="ui-datepicker-group';
                        if (1 < j[1])
                            switch (G) {
                            case 0:
                                q += " ui-datepicker-group-first";
                                t = " ui-corner-" + (c ? "right" : "left");
                                break;
                            case j[1] - 1:
                                q += " ui-datepicker-group-last";
                                t = " ui-corner-" + (c ? "left" : "right");
                                break;
                            default:
                                q += " ui-datepicker-group-middle",
                                t = ""
                            }
                        q += '">'
                    }
                    for (var q = q + ('<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix' + t + '">' + (/all|left/.test(t) && 0 == F ? c ? f : n : "") + (/all|right/.test(t) && 0 == F ? c ? n : f : "") + this._generateMonthYearHeader(a, g, l, k, m, 0 < F || 0 < G, y, v) + '</div><table class="ui-datepicker-calendar"><thead><tr>'), w = i ? '<th class="ui-datepicker-week-col">' + this._get(a, "weekHeader") + "</th>" : "", t = 0; 7 > t; t++)
                        var o = (t + h) % 7
                          , w = w + ("<th" + (5 <= (t + h + 6) % 7 ? ' class="ui-datepicker-week-end"' : "") + '><span title="' + s[o] + '">' + u[o] + "</span></th>");
                    q += w + "</tr></thead><tbody>";
                    w = this._getDaysInMonth(l, g);
                    l == a.selectedYear && g == a.selectedMonth && (a.selectedDay = Math.min(a.selectedDay, w));
                    t = (this._getFirstDayOfMonth(l, g) - h + 7) % 7;
                    w = Math.ceil((t + w) / 7);
                    this.maxRows = w = p ? this.maxRows > w ? this.maxRows : w : w;
                    for (var o = this._daylightSavingAdjust(new Date(l,g,1 - t)), L = 0; L < w; L++) {
                        for (var q = q + "<tr>", J = !i ? "" : '<td class="ui-datepicker-week-col">' + this._get(a, "calculateWeek")(o) + "</td>", t = 0; 7 > t; t++) {
                            var H = x ? x.apply(a.input ? a.input[0] : null, [o]) : [!0, ""]
                              , A = o.getMonth() != g
                              , K = A && !D || !H[0] || k && o < k || m && o > m
                              , J = J + ('<td class="' + (5 <= (t + h + 6) % 7 ? " ui-datepicker-week-end" : "") + (A ? " ui-datepicker-other-month" : "") + (o.getTime() == C.getTime() && g == a.selectedMonth && a._keyEvent || B.getTime() == o.getTime() && B.getTime() == C.getTime() ? " " + this._dayOverClass : "") + (K ? " " + this._unselectableClass + " ui-state-disabled" : "") + (A && !z ? "" : " " + H[1] + (o.getTime() == r.getTime() ? " " + this._currentClass : "") + (o.getTime() == b.getTime() ? " ui-datepicker-today" : "")) + '"' + ((!A || z) && H[2] ? ' title="' + H[2] + '"' : "") + (K ? "" : ' data-handler="selectDay" data-event="click" data-month="' + o.getMonth() + '" data-year="' + o.getFullYear() + '"') + ">" + (A && !z ? "&#xa0;" : K ? '<span class="ui-state-default">' + o.getDate() + "</span>" : '<a class="ui-state-default' + (o.getTime() == b.getTime() ? " ui-state-highlight" : "") + (o.getTime() == r.getTime() ? " ui-state-active" : "") + (A ? " ui-priority-secondary" : "") + '" href="#">' + o.getDate() + "</a>") + "</td>");
                            o.setDate(o.getDate() + 1);
                            o = this._daylightSavingAdjust(o)
                        }
                        q += J + "</tr>"
                    }
                    g++;
                    11 < g && (g = 0,
                    l++);
                    q += "</tbody></table>" + (p ? "</div>" + (0 < j[0] && G == j[1] - 1 ? '<div class="ui-datepicker-row-break"></div>' : "") : "");
                    I += q
                }
                E += I
            }
            E += e + (d.browser.msie && 7 > parseInt(d.browser.version, 10) && !a.inline ? '<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>' : "");
            a._keyEvent = !1;
            return E
        },
        _generateMonthYearHeader: function(a, b, c, d, f, h, j, g) {
            var i = this._get(a, "changeMonth")
              , p = this._get(a, "changeYear")
              , r = this._get(a, "showMonthAfterYear")
              , k = '<div class="ui-datepicker-title">'
              , m = "";
            if (h || !i)
                m += '<span class="ui-datepicker-month">' + j[b] + "</span>";
            else {
                for (var j = d && d.getFullYear() == c, l = f && f.getFullYear() == c, m = m + '<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">', n = 0; 12 > n; n++)
                    if ((!j || n >= d.getMonth()) && (!l || n <= f.getMonth()))
                        m += '<option value="' + n + '"' + (n == b ? ' selected="selected"' : "") + ">" + g[n] + "</option>";
                m += "</select>"
            }
            r || (k += m + (h || !i || !p ? "&#xa0;" : ""));
            if (!a.yearshtml)
                if (a.yearshtml = "",
                h || !p)
                    k += '<span class="ui-datepicker-year">' + c + "</span>";
                else {
                    var g = this._get(a, "yearRange").split(":")
                      , s = (new Date).getFullYear()
                      , j = function(a) {
                        a = a.match(/c[+-].*/) ? c + parseInt(a.substring(1), 10) : a.match(/[+-].*/) ? s + parseInt(a, 10) : parseInt(a, 10);
                        return isNaN(a) ? s : a
                    }
                      , b = j(g[0])
                      , g = Math.max(b, j(g[1] || ""))
                      , b = d ? Math.max(b, d.getFullYear()) : b
                      , g = f ? Math.min(g, f.getFullYear()) : g;
                    for (a.yearshtml += '<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">'; b <= g; b++)
                        a.yearshtml += '<option value="' + b + '"' + (b == c ? ' selected="selected"' : "") + ">" + b + "</option>";
                    a.yearshtml += "</select>";
                    k += a.yearshtml;
                    a.yearshtml = null
                }
            k += this._get(a, "yearSuffix");
            r && (k += (h || !i || !p ? "&#xa0;" : "") + m);
            return k + "</div>"
        },
        _adjustInstDate: function(a, b, c) {
            var d = a.drawYear + ("Y" == c ? b : 0)
              , f = a.drawMonth + ("M" == c ? b : 0)
              , b = Math.min(a.selectedDay, this._getDaysInMonth(d, f)) + ("D" == c ? b : 0)
              , d = this._restrictMinMax(a, this._daylightSavingAdjust(new Date(d,f,b)));
            a.selectedDay = d.getDate();
            a.drawMonth = a.selectedMonth = d.getMonth();
            a.drawYear = a.selectedYear = d.getFullYear();
            ("M" == c || "Y" == c) && this._notifyChange(a)
        },
        _restrictMinMax: function(a, b) {
            var c = this._getMinMaxDate(a, "min")
              , d = this._getMinMaxDate(a, "max")
              , c = c && b < c ? c : b;
            return d && c > d ? d : c
        },
        _notifyChange: function(a) {
            var b = this._get(a, "onChangeMonthYear");
            b && b.apply(a.input ? a.input[0] : null, [a.selectedYear, a.selectedMonth + 1, a])
        },
        _getNumberOfMonths: function(a) {
            a = this._get(a, "numberOfMonths");
            return null == a ? [1, 1] : "number" == typeof a ? [1, a] : a
        },
        _getMinMaxDate: function(a, b) {
            return this._determineDate(a, this._get(a, b + "Date"), null)
        },
        _getDaysInMonth: function(a, b) {
            return 32 - this._daylightSavingAdjust(new Date(a,b,32)).getDate()
        },
        _getFirstDayOfMonth: function(a, b) {
            return (new Date(a,b,1)).getDay()
        },
        _canAdjustMonth: function(a, b, c, d) {
            var f = this._getNumberOfMonths(a)
              , c = this._daylightSavingAdjust(new Date(c,d + (0 > b ? b : f[0] * f[1]),1));
            0 > b && c.setDate(this._getDaysInMonth(c.getFullYear(), c.getMonth()));
            return this._isInRange(a, c)
        },
        _isInRange: function(a, b) {
            var c = this._getMinMaxDate(a, "min")
              , d = this._getMinMaxDate(a, "max");
            return (!c || b.getTime() >= c.getTime()) && (!d || b.getTime() <= d.getTime())
        },
        _getFormatConfig: function(a) {
            var b = this._get(a, "shortYearCutoff")
              , b = "string" != typeof b ? b : (new Date).getFullYear() % 100 + parseInt(b, 10);
            return {
                shortYearCutoff: b,
                dayNamesShort: this._get(a, "dayNamesShort"),
                dayNames: this._get(a, "dayNames"),
                monthNamesShort: this._get(a, "monthNamesShort"),
                monthNames: this._get(a, "monthNames")
            }
        },
        _formatDate: function(a, b, c, d) {
            b || (a.currentDay = a.selectedDay,
            a.currentMonth = a.selectedMonth,
            a.currentYear = a.selectedYear);
            b = b ? "object" == typeof b ? b : this._daylightSavingAdjust(new Date(d,c,b)) : this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));
            return this.formatDate(this._get(a, "dateFormat"), b, this._getFormatConfig(a))
        }
    });
    d.fn.datepicker = function(a) {
        if (!this.length)
            return this;
        d.datepicker.initialized || (d(document).mousedown(d.datepicker._checkExternalClick).find("body").append(d.datepicker.dpDiv),
        d.datepicker.initialized = !0);
        var b = Array.prototype.slice.call(arguments, 1);
        return "string" == typeof a && ("isDisabled" == a || "getDate" == a || "widget" == a) || "option" == a && 2 == arguments.length && "string" == typeof arguments[1] ? d.datepicker["_" + a + "Datepicker"].apply(d.datepicker, [this[0]].concat(b)) : this.each(function() {
            typeof a == "string" ? d.datepicker["_" + a + "Datepicker"].apply(d.datepicker, [this].concat(b)) : d.datepicker._attachDatepicker(this, a)
        })
    }
    ;
    d.datepicker = new B;
    d.datepicker.initialized = !1;
    d.datepicker.uuid = (new Date).getTime();
    d.datepicker.version = "1.8.24";
    window["DP_jQuery_" + x] = d
})(jQuery);
;;/* module-key = 'com.atlassian.auiplugin:aui-date-picker', location = 'js/aui-date-picker.js' */
(function(d) {
    var u = 0;
    AJS.DatePicker = function(g, b) {
        var c, i, a, q, j;
        c = {};
        q = u++;
        a = d(g);
        a.attr("data-aui-dp-uuid", q);
        b = d.extend(void 0, AJS.DatePicker.prototype.defaultOptions, b);
        c.getField = function() {
            return a
        }
        ;
        c.getOptions = function() {
            return b
        }
        ;
        i = function() {
            var e, m, n, g, r, i, o, p, h, k;
            c.hide = function() {
                h.hide()
            }
            ;
            c.show = function() {
                h.show()
            }
            ;
            c.setDate = function(a) {
                "undefined" !== typeof e && e.datepicker("setDate", a)
            }
            ;
            c.getDate = function() {
                if ("undefined" !== typeof e)
                    return e.datepicker("getDate")
            }
            ;
            i = function(v) {
                k.off();
                if (b.hint) {
                    var f = d("<div/>").addClass("aui-datepicker-hint");
                    f.append("<span/>").text(b.hint);
                    k.append(f)
                }
                e = d("<div/>");
                e.attr("data-aui-dp-popup-uuid", q);
                k.append(e);
                f = {
                    dateFormat: b.dateFormat,
                    defaultDate: a.val(),
                    maxDate: a.attr("max"),
                    minDate: a.attr("min"),
                    nextText: ">",
                    onSelect: function(d) {
                        a.val(d);
                        a.change();
                        c.hide();
                        o = !0;
                        a.focus();
                        b.onSelect && b.onSelect.call(this, d)
                    },
                    onChangeMonthYear: function() {
                        setTimeout(h.refresh, 0)
                    },
                    prevText: "<"
                };
                d.extend(f, v);
                -1 < b.firstDay && (f.firstDay = b.firstDay);
                "undefined" !== typeof a.attr("step") && AJS.log("WARNING: The AJS date picker polyfill currently does not support the step attribute!");
                e.datepicker(f);
                d("body").on("keydown", m);
                a.on("focusout keydown", n);
                a.on("propertychange keyup input paste", r)
            }
            ;
            m = function(b) {
                var f = d(b.target)
                  , e = f.closest(k).length || f.is(a)
                  , g = f.closest(".ui-datepicker-header").length;
                !e && !g || b.keyCode === AJS.keyCode.ESCAPE ? c.hide() : f[0] !== a[0] && b.preventDefault()
            }
            ;
            n = function() {
                p || (d("body").on("focus blur click mousedown", "*", m),
                p = !0)
            }
            ;
            g = function() {
                o ? o = !1 : c.show()
            }
            ;
            r = function() {
                d(this).val() && (e.datepicker("setDate", a.val()),
                e.datepicker("option", {
                    maxDate: a.attr("max"),
                    minDate: a.attr("min")
                }))
            }
            ;
            c.destroyPolyfill = function() {
                c.hide();
                a.attr("placeholder", null);
                a.off("propertychange keyup input paste", r);
                a.off("focus click", g);
                a.off("focusout keydown", n);
                d("body").off("keydown", n);
                AJS.DatePicker.prototype.browserSupportsDateField && (a[0].type = "date");
                "undefined" !== typeof e && e.datepicker("destroy");
                delete c.destroyPolyfill;
                delete c.show;
                delete c.hide
            }
            ;
            p = o = !1;
            b.languageCode in AJS.DatePicker.prototype.localisations || (b.languageCode = "");
            var s = AJS.DatePicker.prototype.localisations[b.languageCode]
              , t = ""
              , l = 240;
            "large" === s.size && (l = 325,
            t = "aui-datepicker-dialog-large");
            l = {
                hideCallback: function() {
                    d("body").off("focus blur click mousedown", "*", m);
                    p = false;
                    j && j._datePickerPopup && delete j._datePickerPopup
                },
                hideDelay: null,
                noBind: !0,
                persistent: !0,
                closeOthers: !1,
                width: l
            };
            b.position && (l.calculatePositions = function(a, c) {
                var e = d(a[0]);
                return b.position.call(this, e, c)
            }
            );
            h = AJS.InlineDialog(a, void 0, function(a, b, c) {
                if (typeof e === "undefined") {
                    k = a;
                    i(s)
                }
                if (j = d(b).closest(".aui-inline-dialog").get(0))
                    j._datePickerPopup = h;
                c()
            }, l);
            h.addClass("aui-datepicker-dialog");
            h.addClass(t);
            a.on("focus click", g);
            a.attr("placeholder", b.dateFormat);
            b.overrideBrowserDefault && AJS.DatePicker.prototype.browserSupportsDateField && (a[0].type = "text")
        }
        ;
        c.reset = function() {
            "function" === typeof c.destroyPolyfill && c.destroyPolyfill();
            (!AJS.DatePicker.prototype.browserSupportsDateField || b.overrideBrowserDefault) && i()
        }
        ;
        c.reset();
        return c
    }
    ;
    AJS.DatePicker.prototype.browserSupportsDateField = "date" === d('<input type="date" />')[0].type;
    AJS.DatePicker.prototype.defaultOptions = {
        overrideBrowserDefault: !1,
        firstDay: -1,
        languageCode: AJS.$("html").attr("lang") || "en-AU",
        dateFormat: d.datepicker.W3C
    };
    AJS.DatePicker.prototype.localisations = {
        "": {
            dayNames: "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
            dayNamesMin: "Sun Mon Tue Wed Thu Fri Sat".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "January February March April May June July August September October November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        af: {
            dayNames: "Sondag Maandag Dinsdag Woensdag Donderdag Vrydag Saterdag".split(" "),
            dayNamesMin: "Son Maa Din Woe Don Vry Sat".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januarie Februarie Maart April Mei Junie Julie Augustus September Oktober November Desember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "ar-DZ": {
            dayNames: "\u0627\u0644\u0623\u062d\u062f \u0627\u0644\u0627\u062b\u0646\u064a\u0646 \u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621 \u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621 \u0627\u0644\u062e\u0645\u064a\u0633 \u0627\u0644\u062c\u0645\u0639\u0629 \u0627\u0644\u0633\u0628\u062a".split(" "),
            dayNamesMin: "\u0627\u0644\u0623\u062d\u062f \u0627\u0644\u0627\u062b\u0646\u064a\u0646 \u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621 \u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621 \u0627\u0644\u062e\u0645\u064a\u0633 \u0627\u0644\u062c\u0645\u0639\u0629 \u0627\u0644\u0633\u0628\u062a".split(" "),
            firstDay: 6,
            isRTL: !0,
            monthNames: "\u062c\u0627\u0646\u0641\u064a \u0641\u064a\u0641\u0631\u064a \u0645\u0627\u0631\u0633 \u0623\u0641\u0631\u064a\u0644 \u0645\u0627\u064a \u062c\u0648\u0627\u0646 \u062c\u0648\u064a\u0644\u064a\u0629 \u0623\u0648\u062a \u0633\u0628\u062a\u0645\u0628\u0631 \u0623\u0643\u062a\u0648\u0628\u0631 \u0646\u0648\u0641\u0645\u0628\u0631 \u062f\u064a\u0633\u0645\u0628\u0631".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ar: {
            dayNames: "\u0627\u0644\u0623\u062d\u062f \u0627\u0644\u0627\u062b\u0646\u064a\u0646 \u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621 \u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621 \u0627\u0644\u062e\u0645\u064a\u0633 \u0627\u0644\u062c\u0645\u0639\u0629 \u0627\u0644\u0633\u0628\u062a".split(" "),
            dayNamesMin: "\u0627\u0644\u0623\u062d\u062f \u0627\u0644\u0627\u062b\u0646\u064a\u0646 \u0627\u0644\u062b\u0644\u0627\u062b\u0627\u0621 \u0627\u0644\u0623\u0631\u0628\u0639\u0627\u0621 \u0627\u0644\u062e\u0645\u064a\u0633 \u0627\u0644\u062c\u0645\u0639\u0629 \u0627\u0644\u0633\u0628\u062a".split(" "),
            firstDay: 6,
            isRTL: !0,
            monthNames: "\u0643\u0627\u0646\u0648\u0646 \u0627\u0644\u062b\u0627\u0646\u064a;\u0634\u0628\u0627\u0637;\u0622\u0630\u0627\u0631;\u0646\u064a\u0633\u0627\u0646;\u0645\u0627\u064a\u0648;\u062d\u0632\u064a\u0631\u0627\u0646;\u062a\u0645\u0648\u0632;\u0622\u0628;\u0623\u064a\u0644\u0648\u0644;\u062a\u0634\u0631\u064a\u0646 \u0627\u0644\u0623\u0648\u0644;\u062a\u0634\u0631\u064a\u0646 \u0627\u0644\u062b\u0627\u0646\u064a;\u0643\u0627\u0646\u0648\u0646 \u0627\u0644\u0623\u0648\u0644".split(";"),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        az: {
            dayNames: "Bazar;Bazar ert\u0259si;\u00c7\u0259r\u015f\u0259nb\u0259 ax\u015fam\u0131;\u00c7\u0259r\u015f\u0259nb\u0259;C\u00fcm\u0259 ax\u015fam\u0131;C\u00fcm\u0259;\u015e\u0259nb\u0259".split(";"),
            dayNamesMin: "B Be \u00c7a \u00c7 Ca C \u015e".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Yanvar Fevral Mart Aprel May \u0130yun \u0130yul Avqust Sentyabr Oktyabr Noyabr Dekabr".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        bg: {
            dayNames: "\u041d\u0435\u0434\u0435\u043b\u044f \u041f\u043e\u043d\u0435\u0434\u0435\u043b\u043d\u0438\u043a \u0412\u0442\u043e\u0440\u043d\u0438\u043a \u0421\u0440\u044f\u0434\u0430 \u0427\u0435\u0442\u0432\u044a\u0440\u0442\u044a\u043a \u041f\u0435\u0442\u044a\u043a \u0421\u044a\u0431\u043e\u0442\u0430".split(" "),
            dayNamesMin: "\u041d\u0435\u0434 \u041f\u043e\u043d \u0412\u0442\u043e \u0421\u0440\u044f \u0427\u0435\u0442 \u041f\u0435\u0442 \u0421\u044a\u0431".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u042f\u043d\u0443\u0430\u0440\u0438 \u0424\u0435\u0432\u0440\u0443\u0430\u0440\u0438 \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0438\u043b \u041c\u0430\u0439 \u042e\u043d\u0438 \u042e\u043b\u0438 \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043f\u0442\u0435\u043c\u0432\u0440\u0438 \u041e\u043a\u0442\u043e\u043c\u0432\u0440\u0438 \u041d\u043e\u0435\u043c\u0432\u0440\u0438 \u0414\u0435\u043a\u0435\u043c\u0432\u0440\u0438".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        bs: {
            dayNames: "Nedelja Ponedeljak Utorak Srijeda \u010cetvrtak Petak Subota".split(" "),
            dayNamesMin: "Ned Pon Uto Sri \u010cet Pet Sub".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januar Februar Mart April Maj Juni Juli August Septembar Oktobar Novembar Decembar".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ca: {
            dayNames: "Diumenge Dilluns Dimarts Dimecres Dijous Divendres Dissabte".split(" "),
            dayNamesMin: "Dug Dln Dmt Dmc Djs Dvn Dsb".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Gener Febrer Mar&ccedil; Abril Maig Juny Juliol Agost Setembre Octubre Novembre Desembre".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        cs: {
            dayNames: "ned\u011ble pond\u011bl\u00ed \u00fater\u00fd st\u0159eda \u010dtvrtek p\u00e1tek sobota".split(" "),
            dayNamesMin: "ne po \u00fat st \u010dt p\u00e1 so".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "leden \u00fanor b\u0159ezen duben kv\u011bten \u010derven \u010dervenec srpen z\u00e1\u0159\u00ed \u0159\u00edjen listopad prosinec".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        da: {
            dayNames: "S\u00f8ndag Mandag Tirsdag Onsdag Torsdag Fredag L\u00f8rdag".split(" "),
            dayNamesMin: "S\u00f8n Man Tir Ons Tor Fre L\u00f8r".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januar Februar Marts April Maj Juni Juli August September Oktober November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        de: {
            dayNames: "Sonntag Montag Dienstag Mittwoch Donnerstag Freitag Samstag".split(" "),
            dayNamesMin: "So Mo Di Mi Do Fr Sa".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januar Februar M\u00e4rz April Mai Juni Juli August September Oktober November Dezember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        el: {
            dayNames: "\u039a\u03c5\u03c1\u03b9\u03b1\u03ba\u03ae \u0394\u03b5\u03c5\u03c4\u03ad\u03c1\u03b1 \u03a4\u03c1\u03af\u03c4\u03b7 \u03a4\u03b5\u03c4\u03ac\u03c1\u03c4\u03b7 \u03a0\u03ad\u03bc\u03c0\u03c4\u03b7 \u03a0\u03b1\u03c1\u03b1\u03c3\u03ba\u03b5\u03c5\u03ae \u03a3\u03ac\u03b2\u03b2\u03b1\u03c4\u03bf".split(" "),
            dayNamesMin: "\u039a\u03c5\u03c1 \u0394\u03b5\u03c5 \u03a4\u03c1\u03b9 \u03a4\u03b5\u03c4 \u03a0\u03b5\u03bc \u03a0\u03b1\u03c1 \u03a3\u03b1\u03b2".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0399\u03b1\u03bd\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2 \u03a6\u03b5\u03b2\u03c1\u03bf\u03c5\u03ac\u03c1\u03b9\u03bf\u03c2 \u039c\u03ac\u03c1\u03c4\u03b9\u03bf\u03c2 \u0391\u03c0\u03c1\u03af\u03bb\u03b9\u03bf\u03c2 \u039c\u03ac\u03b9\u03bf\u03c2 \u0399\u03bf\u03cd\u03bd\u03b9\u03bf\u03c2 \u0399\u03bf\u03cd\u03bb\u03b9\u03bf\u03c2 \u0391\u03cd\u03b3\u03bf\u03c5\u03c3\u03c4\u03bf\u03c2 \u03a3\u03b5\u03c0\u03c4\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2 \u039f\u03ba\u03c4\u03ce\u03b2\u03c1\u03b9\u03bf\u03c2 \u039d\u03bf\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2 \u0394\u03b5\u03ba\u03ad\u03bc\u03b2\u03c1\u03b9\u03bf\u03c2".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "en-AU": {
            dayNames: "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
            dayNamesMin: "Sun Mon Tue Wed Thu Fri Sat".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "January February March April May June July August September October November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "en-GB": {
            dayNames: "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
            dayNamesMin: "Sun Mon Tue Wed Thu Fri Sat".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "January February March April May June July August September October November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "en-NZ": {
            dayNames: "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),
            dayNamesMin: "Sun Mon Tue Wed Thu Fri Sat".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "January February March April May June July August September October November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        eo: {
            dayNames: "Diman\u0109o Lundo Mardo Merkredo \u0134a\u016ddo Vendredo Sabato".split(" "),
            dayNamesMin: "Dim Lun Mar Mer \u0134a\u016d Ven Sab".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Januaro Februaro Marto Aprilo Majo Junio Julio A\u016dgusto Septembro Oktobro Novembro Decembro".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        es: {
            dayNames: "Domingo Lunes Martes Mi&eacute;rcoles Jueves Viernes S&aacute;bado".split(" "),
            dayNamesMin: "Dom Lun Mar Mi&eacute; Juv Vie S&aacute;b".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        et: {
            dayNames: "P\u00fchap\u00e4ev Esmasp\u00e4ev Teisip\u00e4ev Kolmap\u00e4ev Neljap\u00e4ev Reede Laup\u00e4ev".split(" "),
            dayNamesMin: "P\u00fchap Esmasp Teisip Kolmap Neljap Reede Laup".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Jaanuar Veebruar M\u00e4rts Aprill Mai Juuni Juuli August September Oktoober November Detsember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: "",
            size: "large"
        },
        eu: {
            dayNames: "Igandea Astelehena Asteartea Asteazkena Osteguna Ostirala Larunbata".split(" "),
            dayNamesMin: "Iga Ast Ast Ast Ost Ost Lar".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Urtarrila Otsaila Martxoa Apirila Maiatza Ekaina Uztaila Abuztua Iraila Urria Azaroa Abendua".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        fa: {
            dayNames: "\u064a\u06a9\u0634\u0646\u0628\u0647 \u062f\u0648\u0634\u0646\u0628\u0647 \u0633\u0647\u0634\u0646\u0628\u0647 \u0686\u0647\u0627\u0631\u0634\u0646\u0628\u0647 \u067e\u0646\u062c\u0634\u0646\u0628\u0647 \u062c\u0645\u0639\u0647 \u0634\u0646\u0628\u0647".split(" "),
            dayNamesMin: "\u064a\u062f\u0633\u0686\u067e\u062c\u0634".split(""),
            firstDay: 6,
            isRTL: !0,
            monthNames: "\u0641\u0631\u0648\u0631\u062f\u064a\u0646 \u0627\u0631\u062f\u064a\u0628\u0647\u0634\u062a \u062e\u0631\u062f\u0627\u062f \u062a\u064a\u0631 \u0645\u0631\u062f\u0627\u062f \u0634\u0647\u0631\u064a\u0648\u0631 \u0645\u0647\u0631 \u0622\u0628\u0627\u0646 \u0622\u0630\u0631 \u062f\u064a \u0628\u0647\u0645\u0646 \u0627\u0633\u0641\u0646\u062f".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        fi: {
            dayNames: "Sunnuntai Maanantai Tiistai Keskiviikko Torstai Perjantai Lauantai".split(" "),
            dayNamesMin: "Su Ma Ti Ke To Pe Su".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Tammikuu Helmikuu Maaliskuu Huhtikuu Toukokuu Kes&auml;kuu Hein&auml;kuu Elokuu Syyskuu Lokakuu Marraskuu Joulukuu".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        fo: {
            dayNames: "Sunnudagur M\u00e1nadagur T\u00fdsdagur Mikudagur H\u00f3sdagur Fr\u00edggjadagur Leyardagur".split(" "),
            dayNamesMin: "Sun M\u00e1n T\u00fds Mik H\u00f3s Fr\u00ed Ley".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Januar Februar Mars Apr\u00edl Mei Juni Juli August September Oktober November Desember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "fr-CH": {
            dayNames: "Dimanche Lundi Mardi Mercredi Jeudi Vendredi Samedi".split(" "),
            dayNamesMin: "Dim Lun Mar Mer Jeu Ven Sam".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        fr: {
            dayNames: "Dimanche Lundi Mardi Mercredi Jeudi Vendredi Samedi".split(" "),
            dayNamesMin: "Dim. Lun. Mar. Mer. Jeu. Ven. Sam.".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janvier F\u00e9vrier Mars Avril Mai Juin Juillet Ao\u00fbt Septembre Octobre Novembre D\u00e9cembre".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        gl: {
            dayNames: "Domingo Luns Martes M&eacute;rcores Xoves Venres S&aacute;bado".split(" "),
            dayNamesMin: "Dom Lun Mar M&eacute;r Xov Ven S&aacute;b".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Xaneiro Febreiro Marzo Abril Maio Xu\u00f1o Xullo Agosto Setembro Outubro Novembro Decembro".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        he: {
            dayNames: "\u05e8\u05d0\u05e9\u05d5\u05df \u05e9\u05e0\u05d9 \u05e9\u05dc\u05d9\u05e9\u05d9 \u05e8\u05d1\u05d9\u05e2\u05d9 \u05d7\u05de\u05d9\u05e9\u05d9 \u05e9\u05d9\u05e9\u05d9 \u05e9\u05d1\u05ea".split(" "),
            dayNamesMin: "\u05d0' \u05d1' \u05d2' \u05d3' \u05d4' \u05d5' \u05e9\u05d1\u05ea".split(" "),
            firstDay: 0,
            isRTL: !0,
            monthNames: "\u05d9\u05e0\u05d5\u05d0\u05e8 \u05e4\u05d1\u05e8\u05d5\u05d0\u05e8 \u05de\u05e8\u05e5 \u05d0\u05e4\u05e8\u05d9\u05dc \u05de\u05d0\u05d9 \u05d9\u05d5\u05e0\u05d9 \u05d9\u05d5\u05dc\u05d9 \u05d0\u05d5\u05d2\u05d5\u05e1\u05d8 \u05e1\u05e4\u05d8\u05de\u05d1\u05e8 \u05d0\u05d5\u05e7\u05d8\u05d5\u05d1\u05e8 \u05e0\u05d5\u05d1\u05de\u05d1\u05e8 \u05d3\u05e6\u05de\u05d1\u05e8".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        hr: {
            dayNames: "Nedjelja Ponedjeljak Utorak Srijeda \u010cetvrtak Petak Subota".split(" "),
            dayNamesMin: "Ned Pon Uto Sri \u010cet Pet Sub".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Sije\u010danj Velja\u010da O\u017eujak Travanj Svibanj Lipanj Srpanj Kolovoz Rujan Listopad Studeni Prosinac".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        hu: {
            dayNames: "Vas\u00e1rnap H\u00e9tf\u00f6 Kedd Szerda Cs\u00fct\u00f6rt\u00f6k P\u00e9ntek Szombat".split(" "),
            dayNamesMin: "Vas H\u00e9t Ked Sze Cs\u00fc P\u00e9n Szo".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janu\u00e1r Febru\u00e1r M\u00e1rcius \u00c1prilis M\u00e1jus J\u00fanius J\u00falius Augusztus Szeptember Okt\u00f3ber November December".split(" "),
            showMonthAfterYear: !0,
            yearSuffix: ""
        },
        hy: {
            dayNames: "\u056f\u056b\u0580\u0561\u056f\u056b \u0565\u056f\u0578\u0582\u0577\u0561\u0562\u0569\u056b \u0565\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b \u0579\u0578\u0580\u0565\u0584\u0577\u0561\u0562\u0569\u056b \u0570\u056b\u0576\u0563\u0577\u0561\u0562\u0569\u056b \u0578\u0582\u0580\u0562\u0561\u0569 \u0577\u0561\u0562\u0561\u0569".split(" "),
            dayNamesMin: "\u056f\u056b\u0580 \u0565\u0580\u056f \u0565\u0580\u0584 \u0579\u0580\u0584 \u0570\u0576\u0563 \u0578\u0582\u0580\u0562 \u0577\u0562\u0569".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0540\u0578\u0582\u0576\u057e\u0561\u0580 \u0553\u0565\u057f\u0580\u057e\u0561\u0580 \u0544\u0561\u0580\u057f \u0531\u057a\u0580\u056b\u056c \u0544\u0561\u0575\u056b\u057d \u0540\u0578\u0582\u0576\u056b\u057d \u0540\u0578\u0582\u056c\u056b\u057d \u0555\u0563\u0578\u057d\u057f\u0578\u057d \u054d\u0565\u057a\u057f\u0565\u0574\u0562\u0565\u0580 \u0540\u0578\u056f\u057f\u0565\u0574\u0562\u0565\u0580 \u0546\u0578\u0575\u0565\u0574\u0562\u0565\u0580 \u0534\u0565\u056f\u057f\u0565\u0574\u0562\u0565\u0580".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        id: {
            dayNames: "Minggu Senin Selasa Rabu Kamis Jumat Sabtu".split(" "),
            dayNamesMin: "Min Sen Sel Rab kam Jum Sab".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Januari Februari Maret April Mei Juni Juli Agustus September Oktober Nopember Desember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        is: {
            dayNames: "Sunnudagur M&aacute;nudagur &THORN;ri&eth;judagur Mi&eth;vikudagur Fimmtudagur F&ouml;studagur Laugardagur".split(" "),
            dayNamesMin: "Sun M&aacute;n &THORN;ri Mi&eth; Fim F&ouml;s Lau".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Jan&uacute;ar Febr&uacute;ar Mars Apr&iacute;l Ma&iacute J&uacute;n&iacute; J&uacute;l&iacute; &Aacute;g&uacute;st September Okt&oacute;ber N&oacute;vember Desember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        it: {
            dayNames: "Domenica Luned&#236 Marted&#236 Mercoled&#236 Gioved&#236 Venerd&#236 Sabato".split(" "),
            dayNamesMin: "Dom Lun Mar Mer Gio Ven Sab".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Gennaio Febbraio Marzo Aprile Maggio Giugno Luglio Agosto Settembre Ottobre Novembre Dicembre".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ja: {
            dayNames: "\u65e5\u66dc\u65e5 \u6708\u66dc\u65e5 \u706b\u66dc\u65e5 \u6c34\u66dc\u65e5 \u6728\u66dc\u65e5 \u91d1\u66dc\u65e5 \u571f\u66dc\u65e5".split(" "),
            dayNamesMin: "\u65e5\u6708\u706b\u6c34\u6728\u91d1\u571f".split(""),
            firstDay: 0,
            isRTL: !1,
            monthNames: "1\u6708 2\u6708 3\u6708 4\u6708 5\u6708 6\u6708 7\u6708 8\u6708 9\u6708 10\u6708 11\u6708 12\u6708".split(" "),
            showMonthAfterYear: !0,
            yearSuffix: "\u5e74"
        },
        ko: {
            dayNames: "\uc77c\uc6d4\ud654\uc218\ubaa9\uae08\ud1a0".split(""),
            dayNamesMin: "\uc77c\uc6d4\ud654\uc218\ubaa9\uae08\ud1a0".split(""),
            firstDay: 0,
            isRTL: !1,
            monthNames: "1\uc6d4(JAN) 2\uc6d4(FEB) 3\uc6d4(MAR) 4\uc6d4(APR) 5\uc6d4(MAY) 6\uc6d4(JUN) 7\uc6d4(JUL) 8\uc6d4(AUG) 9\uc6d4(SEP) 10\uc6d4(OCT) 11\uc6d4(NOV) 12\uc6d4(DEC)".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: "\ub144"
        },
        kz: {
            dayNames: "\u0416\u0435\u043a\u0441\u0435\u043d\u0431\u0456 \u0414\u04af\u0439\u0441\u0435\u043d\u0431\u0456 \u0421\u0435\u0439\u0441\u0435\u043d\u0431\u0456 \u0421\u04d9\u0440\u0441\u0435\u043d\u0431\u0456 \u0411\u0435\u0439\u0441\u0435\u043d\u0431\u0456 \u0416\u04b1\u043c\u0430 \u0421\u0435\u043d\u0431\u0456".split(" "),
            dayNamesMin: "\u0436\u043a\u0441 \u0434\u0441\u043d \u0441\u0441\u043d \u0441\u0440\u0441 \u0431\u0441\u043d \u0436\u043c\u0430 \u0441\u043d\u0431".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u049a\u0430\u04a3\u0442\u0430\u0440 \u0410\u049b\u043f\u0430\u043d \u041d\u0430\u0443\u0440\u044b\u0437 \u0421\u04d9\u0443\u0456\u0440 \u041c\u0430\u043c\u044b\u0440 \u041c\u0430\u0443\u0441\u044b\u043c \u0428\u0456\u043b\u0434\u0435 \u0422\u0430\u043c\u044b\u0437 \u049a\u044b\u0440\u043a\u04af\u0439\u0435\u043a \u049a\u0430\u0437\u0430\u043d \u049a\u0430\u0440\u0430\u0448\u0430 \u0416\u0435\u043b\u0442\u043e\u049b\u0441\u0430\u043d".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        lt: {
            dayNames: "sekmadienis pirmadienis antradienis tre\u010diadienis ketvirtadienis penktadienis \u0161e\u0161tadienis".split(" "),
            dayNamesMin: "sek pir ant tre ket pen \u0161e\u0161".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Sausis Vasaris Kovas Balandis Gegu\u017e\u0117 Bir\u017eelis Liepa Rugpj\u016btis Rugs\u0117jis Spalis Lapkritis Gruodis".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        lv: {
            dayNames: "sv\u0113tdiena pirmdiena otrdiena tre\u0161diena ceturtdiena piektdiena sestdiena".split(" "),
            dayNamesMin: "svt prm otr tre ctr pkt sst".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janv\u0101ris Febru\u0101ris Marts Apr\u012blis Maijs J\u016bnijs J\u016blijs Augusts Septembris Oktobris Novembris Decembris".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ml: {
            dayNames: "\u0d1e\u0d3e\u0d2f\u0d30\u0d4d \u0d24\u0d3f\u0d19\u0d4d\u0d15\u0d33\u0d4d \u0d1a\u0d4a\u0d35\u0d4d\u0d35 \u0d2c\u0d41\u0d27\u0d28\u0d4d \u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d02 \u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f \u0d36\u0d28\u0d3f".split(" "),
            dayNamesMin: "\u0d1e\u0d3e\u0d2f \u0d24\u0d3f\u0d19\u0d4d\u0d15 \u0d1a\u0d4a\u0d35\u0d4d\u0d35 \u0d2c\u0d41\u0d27 \u0d35\u0d4d\u0d2f\u0d3e\u0d34\u0d02 \u0d35\u0d46\u0d33\u0d4d\u0d33\u0d3f \u0d36\u0d28\u0d3f".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0d1c\u0d28\u0d41\u0d35\u0d30\u0d3f \u0d2b\u0d46\u0d2c\u0d4d\u0d30\u0d41\u0d35\u0d30\u0d3f \u0d2e\u0d3e\u0d30\u0d4d\u0d1a\u0d4d\u0d1a\u0d4d \u0d0f\u0d2a\u0d4d\u0d30\u0d3f\u0d32\u0d4d \u0d2e\u0d47\u0d2f\u0d4d \u0d1c\u0d42\u0d23\u0d4d \u0d1c\u0d42\u0d32\u0d48 \u0d06\u0d17\u0d38\u0d4d\u0d31\u0d4d\u0d31\u0d4d \u0d38\u0d46\u0d2a\u0d4d\u0d31\u0d4d\u0d31\u0d02\u0d2c\u0d30\u0d4d \u0d12\u0d15\u0d4d\u0d1f\u0d4b\u0d2c\u0d30\u0d4d \u0d28\u0d35\u0d02\u0d2c\u0d30\u0d4d \u0d21\u0d3f\u0d38\u0d02\u0d2c\u0d30\u0d4d".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ms: {
            dayNames: "Ahad Isnin Selasa Rabu Khamis Jumaat Sabtu".split(" "),
            dayNamesMin: "Aha Isn Sel Rab kha Jum Sab".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Januari Februari Mac April Mei Jun Julai Ogos September Oktober November Disember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        nl: {
            dayNames: "zondag maandag dinsdag woensdag donderdag vrijdag zaterdag".split(" "),
            dayNamesMin: "zon maa din woe don vri zat".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "januari februari maart april mei juni juli augustus september oktober november december".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        no: {
            dayNames: "s\u00f8ndag mandag tirsdag onsdag torsdag fredag l\u00f8rdag".split(" "),
            dayNamesMin: "s\u00f8n man tir ons tor fre l\u00f8r".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "januar februar mars april mai juni juli august september oktober november desember".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        pl: {
            dayNames: "Niedziela Poniedzia\u0142ek Wtorek \u015aroda Czwartek Pi\u0105tek Sobota".split(" "),
            dayNamesMin: "Nie Pn Wt \u015ar Czw Pt So".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Stycze\u0144 Luty Marzec Kwiecie\u0144 Maj Czerwiec Lipiec Sierpie\u0144 Wrzesie\u0144 Pa\u017adziernik Listopad Grudzie\u0144".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "pt-BR": {
            dayNames: "Domingo Segunda-feira Ter&ccedil;a-feira Quarta-feira Quinta-feira Sexta-feira S&aacute;bado".split(" "),
            dayNamesMin: "Dom Seg Ter Qua Qui Sex S&aacute;b".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Janeiro Fevereiro Mar&ccedil;o Abril Maio Junho Julho Agosto Setembro Outubro Novembro Dezembro".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        pt: {
            dayNames: "Domingo Segunda-feira Ter&ccedil;a-feira Quarta-feira Quinta-feira Sexta-feira S&aacute;bado".split(" "),
            dayNamesMin: "Dom Seg Ter Qua Qui Sex S&aacute;b".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Janeiro Fevereiro Mar&ccedil;o Abril Maio Junho Julho Agosto Setembro Outubro Novembro Dezembro".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        rm: {
            dayNames: "Dumengia Glindesdi Mardi Mesemna Gievgia Venderdi Sonda".split(" "),
            dayNamesMin: "Dum Gli Mar Mes Gie Ven Som".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Schaner Favrer Mars Avrigl Matg Zercladur Fanadur Avust Settember October November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ro: {
            dayNames: "Duminic\u0103 Luni Mar\u0163i Miercuri Joi Vineri S\u00e2mb\u0103t\u0103".split(" "),
            dayNamesMin: "Dum Lun Mar Mie Joi Vin S\u00e2m".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Ianuarie Februarie Martie Aprilie Mai Iunie Iulie August Septembrie Octombrie Noiembrie Decembrie".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ru: {
            dayNames: "\u0432\u043e\u0441\u043a\u0440\u0435\u0441\u0435\u043d\u044c\u0435 \u043f\u043e\u043d\u0435\u0434\u0435\u043b\u044c\u043d\u0438\u043a \u0432\u0442\u043e\u0440\u043d\u0438\u043a \u0441\u0440\u0435\u0434\u0430 \u0447\u0435\u0442\u0432\u0435\u0440\u0433 \u043f\u044f\u0442\u043d\u0438\u0446\u0430 \u0441\u0443\u0431\u0431\u043e\u0442\u0430".split(" "),
            dayNamesMin: "\u0432\u0441\u043a \u043f\u043d\u0434 \u0432\u0442\u0440 \u0441\u0440\u0434 \u0447\u0442\u0432 \u043f\u0442\u043d \u0441\u0431\u0442".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        sk: {
            dayNames: "Nede\u013ea Pondelok Utorok Streda \u0160tvrtok Piatok Sobota".split(" "),
            dayNamesMin: "Ned Pon Uto Str \u0160tv Pia Sob".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janu\u00e1r Febru\u00e1r Marec Apr\u00edl M\u00e1j J\u00fan J\u00fal August September Okt\u00f3ber November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        sl: {
            dayNames: "Nedelja Ponedeljek Torek Sreda &#x10C;etrtek Petek Sobota".split(" "),
            dayNamesMin: "Ned Pon Tor Sre &#x10C;et Pet Sob".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januar Februar Marec April Maj Junij Julij Avgust September Oktober November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        sq: {
            dayNames: "E Diel;E H\u00ebn\u00eb;E Mart\u00eb;E M\u00ebrkur\u00eb;E Enjte;E Premte;E Shtune".split(";"),
            dayNamesMin: "Di H\u00eb Ma M\u00eb En Pr Sh".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Janar Shkurt Mars Prill Maj Qershor Korrik Gusht Shtator Tetor N\u00ebntor Dhjetor".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "sr-SR": {
            dayNames: "Nedelja Ponedeljak Utorak Sreda \u010cetvrtak Petak Subota".split(" "),
            dayNamesMin: "Ned Pon Uto Sre \u010cet Pet Sub".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januar Februar Mart April Maj Jun Jul Avgust Septembar Oktobar Novembar Decembar".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        sr: {
            dayNames: "\u041d\u0435\u0434\u0435\u0459\u0430 \u041f\u043e\u043d\u0435\u0434\u0435\u0459\u0430\u043a \u0423\u0442\u043e\u0440\u0430\u043a \u0421\u0440\u0435\u0434\u0430 \u0427\u0435\u0442\u0432\u0440\u0442\u0430\u043a \u041f\u0435\u0442\u0430\u043a \u0421\u0443\u0431\u043e\u0442\u0430".split(" "),
            dayNamesMin: "\u041d\u0435\u0434 \u041f\u043e\u043d \u0423\u0442\u043e \u0421\u0440\u0435 \u0427\u0435\u0442 \u041f\u0435\u0442 \u0421\u0443\u0431".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0408\u0430\u043d\u0443\u0430\u0440 \u0424\u0435\u0431\u0440\u0443\u0430\u0440 \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0438\u043b \u041c\u0430\u0458 \u0408\u0443\u043d \u0408\u0443\u043b \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043f\u0442\u0435\u043c\u0431\u0430\u0440 \u041e\u043a\u0442\u043e\u0431\u0430\u0440 \u041d\u043e\u0432\u0435\u043c\u0431\u0430\u0440 \u0414\u0435\u0446\u0435\u043c\u0431\u0430\u0440".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        sv: {
            dayNames: "S\u00f6ndag M\u00e5ndag Tisdag Onsdag Torsdag Fredag L\u00f6rdag".split(" "),
            dayNamesMin: "S\u00f6n M\u00e5n Tis Ons Tor Fre L\u00f6r".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Januari Februari Mars April Maj Juni Juli Augusti September Oktober November December".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        ta: {
            dayNames: "\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bcd\u0bb1\u0bc1\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0b9f\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0baa\u0bc1\u0ba4\u0ba9\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8 \u0b9a\u0ba9\u0bbf\u0b95\u0bcd\u0b95\u0bbf\u0bb4\u0bae\u0bc8".split(" "),
            dayNamesMin: "\u0b9e\u0bbe\u0baf\u0bbf\u0bb1\u0bc1 \u0ba4\u0bbf\u0b99\u0bcd\u0b95\u0bb3\u0bcd \u0b9a\u0bc6\u0bb5\u0bcd\u0bb5\u0bbe\u0baf\u0bcd \u0baa\u0bc1\u0ba4\u0ba9\u0bcd \u0bb5\u0bbf\u0baf\u0bbe\u0bb4\u0ba9\u0bcd \u0bb5\u0bc6\u0bb3\u0bcd\u0bb3\u0bbf \u0b9a\u0ba9\u0bbf".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0ba4\u0bc8 \u0bae\u0bbe\u0b9a\u0bbf \u0baa\u0b99\u0bcd\u0b95\u0bc1\u0ba9\u0bbf \u0b9a\u0bbf\u0ba4\u0bcd\u0ba4\u0bbf\u0bb0\u0bc8 \u0bb5\u0bc8\u0b95\u0bbe\u0b9a\u0bbf \u0b86\u0ba9\u0bbf \u0b86\u0b9f\u0bbf \u0b86\u0bb5\u0ba3\u0bbf \u0baa\u0bc1\u0bb0\u0b9f\u0bcd\u0b9f\u0bbe\u0b9a\u0bbf \u0b90\u0baa\u0bcd\u0baa\u0b9a\u0bbf \u0b95\u0bbe\u0bb0\u0bcd\u0ba4\u0bcd\u0ba4\u0bbf\u0b95\u0bc8 \u0bae\u0bbe\u0bb0\u0bcd\u0b95\u0bb4\u0bbf".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        th: {
            dayNames: "\u0e2d\u0e32\u0e17\u0e34\u0e15\u0e22\u0e4c \u0e08\u0e31\u0e19\u0e17\u0e23\u0e4c \u0e2d\u0e31\u0e07\u0e04\u0e32\u0e23 \u0e1e\u0e38\u0e18 \u0e1e\u0e24\u0e2b\u0e31\u0e2a\u0e1a\u0e14\u0e35 \u0e28\u0e38\u0e01\u0e23\u0e4c \u0e40\u0e2a\u0e32\u0e23\u0e4c".split(" "),
            dayNamesMin: "\u0e2d\u0e32. \u0e08. \u0e2d. \u0e1e. \u0e1e\u0e24. \u0e28. \u0e2a.".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "\u0e21\u0e01\u0e23\u0e32\u0e04\u0e21 \u0e01\u0e38\u0e21\u0e20\u0e32\u0e1e\u0e31\u0e19\u0e18\u0e4c \u0e21\u0e35\u0e19\u0e32\u0e04\u0e21 \u0e40\u0e21\u0e29\u0e32\u0e22\u0e19 \u0e1e\u0e24\u0e29\u0e20\u0e32\u0e04\u0e21 \u0e21\u0e34\u0e16\u0e38\u0e19\u0e32\u0e22\u0e19 \u0e01\u0e23\u0e01\u0e0e\u0e32\u0e04\u0e21 \u0e2a\u0e34\u0e07\u0e2b\u0e32\u0e04\u0e21 \u0e01\u0e31\u0e19\u0e22\u0e32\u0e22\u0e19 \u0e15\u0e38\u0e25\u0e32\u0e04\u0e21 \u0e1e\u0e24\u0e28\u0e08\u0e34\u0e01\u0e32\u0e22\u0e19 \u0e18\u0e31\u0e19\u0e27\u0e32\u0e04\u0e21".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        tj: {
            dayNames: "\u044f\u043a\u0448\u0430\u043d\u0431\u0435 \u0434\u0443\u0448\u0430\u043d\u0431\u0435 \u0441\u0435\u0448\u0430\u043d\u0431\u0435 \u0447\u043e\u0440\u0448\u0430\u043d\u0431\u0435 \u043f\u0430\u043d\u04b7\u0448\u0430\u043d\u0431\u0435 \u04b7\u0443\u043c\u044a\u0430 \u0448\u0430\u043d\u0431\u0435".split(" "),
            dayNamesMin: "\u044f\u043a\u0448 \u0434\u0443\u0448 \u0441\u0435\u0448 \u0447\u043e\u0440 \u043f\u0430\u043d \u04b7\u0443\u043c \u0448\u0430\u043d".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u042f\u043d\u0432\u0430\u0440 \u0424\u0435\u0432\u0440\u0430\u043b \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440 \u041e\u043a\u0442\u044f\u0431\u0440 \u041d\u043e\u044f\u0431\u0440 \u0414\u0435\u043a\u0430\u0431\u0440".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        tr: {
            dayNames: "Pazar Pazartesi Sal\u0131 \u00c7ar\u015famba Per\u015fembe Cuma Cumartesi".split(" "),
            dayNamesMin: "Pz Pt Sa \u00c7a Pe Cu Ct".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "Ocak \u015eubat Mart Nisan May\u0131s Haziran Temmuz A\u011fustos Eyl\u00fcl Ekim Kas\u0131m Aral\u0131k".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        uk: {
            dayNames: "\u043d\u0435\u0434\u0456\u043b\u044f \u043f\u043e\u043d\u0435\u0434\u0456\u043b\u043e\u043a \u0432\u0456\u0432\u0442\u043e\u0440\u043e\u043a \u0441\u0435\u0440\u0435\u0434\u0430 \u0447\u0435\u0442\u0432\u0435\u0440 \u043f\u2019\u044f\u0442\u043d\u0438\u0446\u044f \u0441\u0443\u0431\u043e\u0442\u0430".split(" "),
            dayNamesMin: "\u043d\u0435\u0434 \u043f\u043d\u0434 \u0432\u0456\u0432 \u0441\u0440\u0434 \u0447\u0442\u0432 \u043f\u0442\u043d \u0441\u0431\u0442".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u0421\u0456\u0447\u0435\u043d\u044c \u041b\u044e\u0442\u0438\u0439 \u0411\u0435\u0440\u0435\u0437\u0435\u043d\u044c \u041a\u0432\u0456\u0442\u0435\u043d\u044c \u0422\u0440\u0430\u0432\u0435\u043d\u044c \u0427\u0435\u0440\u0432\u0435\u043d\u044c \u041b\u0438\u043f\u0435\u043d\u044c \u0421\u0435\u0440\u043f\u0435\u043d\u044c \u0412\u0435\u0440\u0435\u0441\u0435\u043d\u044c \u0416\u043e\u0432\u0442\u0435\u043d\u044c \u041b\u0438\u0441\u0442\u043e\u043f\u0430\u0434 \u0413\u0440\u0443\u0434\u0435\u043d\u044c".split(" "),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        vi: {
            dayNames: "Ch\u1ee7 Nh\u1eadt;Th\u1ee9 Hai;Th\u1ee9 Ba;Th\u1ee9 T\u01b0;Th\u1ee9 N\u0103m;Th\u1ee9 S\u00e1u;Th\u1ee9 B\u1ea3y".split(";"),
            dayNamesMin: "CN T2 T3 T4 T5 T6 T7".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "Th\u00e1ng M\u1ed9t;Th\u00e1ng Hai;Th\u00e1ng Ba;Th\u00e1ng T\u01b0;Th\u00e1ng N\u0103m;Th\u00e1ng S\u00e1u;Th\u00e1ng B\u1ea3y;Th\u00e1ng T\u00e1m;Th\u00e1ng Ch\u00edn;Th\u00e1ng M\u01b0\u1eddi;Th\u00e1ng M\u01b0\u1eddi M\u1ed9t;Th\u00e1ng M\u01b0\u1eddi Hai".split(";"),
            showMonthAfterYear: !1,
            yearSuffix: ""
        },
        "zh-CN": {
            dayNames: "\u661f\u671f\u65e5 \u661f\u671f\u4e00 \u661f\u671f\u4e8c \u661f\u671f\u4e09 \u661f\u671f\u56db \u661f\u671f\u4e94 \u661f\u671f\u516d".split(" "),
            dayNamesMin: "\u5468\u65e5 \u5468\u4e00 \u5468\u4e8c \u5468\u4e09 \u5468\u56db \u5468\u4e94 \u5468\u516d".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u4e00\u6708 \u4e8c\u6708 \u4e09\u6708 \u56db\u6708 \u4e94\u6708 \u516d\u6708 \u4e03\u6708 \u516b\u6708 \u4e5d\u6708 \u5341\u6708 \u5341\u4e00\u6708 \u5341\u4e8c\u6708".split(" "),
            showMonthAfterYear: !0,
            yearSuffix: "\u5e74"
        },
        "zh-HK": {
            dayNames: "\u661f\u671f\u65e5 \u661f\u671f\u4e00 \u661f\u671f\u4e8c \u661f\u671f\u4e09 \u661f\u671f\u56db \u661f\u671f\u4e94 \u661f\u671f\u516d".split(" "),
            dayNamesMin: "\u5468\u65e5 \u5468\u4e00 \u5468\u4e8c \u5468\u4e09 \u5468\u56db \u5468\u4e94 \u5468\u516d".split(" "),
            firstDay: 0,
            isRTL: !1,
            monthNames: "\u4e00\u6708 \u4e8c\u6708 \u4e09\u6708 \u56db\u6708 \u4e94\u6708 \u516d\u6708 \u4e03\u6708 \u516b\u6708 \u4e5d\u6708 \u5341\u6708 \u5341\u4e00\u6708 \u5341\u4e8c\u6708".split(" "),
            showMonthAfterYear: !0,
            yearSuffix: "\u5e74"
        },
        "zh-TW": {
            dayNames: "\u661f\u671f\u65e5 \u661f\u671f\u4e00 \u661f\u671f\u4e8c \u661f\u671f\u4e09 \u661f\u671f\u56db \u661f\u671f\u4e94 \u661f\u671f\u516d".split(" "),
            dayNamesMin: "\u5468\u65e5 \u5468\u4e00 \u5468\u4e8c \u5468\u4e09 \u5468\u56db \u5468\u4e94 \u5468\u516d".split(" "),
            firstDay: 1,
            isRTL: !1,
            monthNames: "\u4e00\u6708 \u4e8c\u6708 \u4e09\u6708 \u56db\u6708 \u4e94\u6708 \u516d\u6708 \u4e03\u6708 \u516b\u6708 \u4e5d\u6708 \u5341\u6708 \u5341\u4e00\u6708 \u5341\u4e8c\u6708".split(" "),
            showMonthAfterYear: !0,
            yearSuffix: "\u5e74"
        }
    };
    d.fn.datePicker = function(d) {
        return new AJS.DatePicker(this,d)
    }
})(jQuery);
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:fields', location = '/fields/fields.soy' */
// This file was automatically generated from fields.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace jiraIntegration.templates.fields.
 */

if (typeof jiraIntegration == 'undefined') {
    var jiraIntegration = {};
}
if (typeof jiraIntegration.templates == 'undefined') {
    jiraIntegration.templates = {};
}
if (typeof jiraIntegration.templates.fields == 'undefined') {
    jiraIntegration.templates.fields = {};
}

jiraIntegration.templates.fields.stringField = function(opt_data, opt_ignored) {
    return '' + aui.form.textField({
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        id: opt_data.name,
        name: opt_data.name,
        value: opt_data.value,
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.stringField.soyTemplateName = 'jiraIntegration.templates.fields.stringField';
}

jiraIntegration.templates.fields.textareaField = function(opt_data, opt_ignored) {
    var output = '<div class="field-group jira-field' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '" data-jira-type="' + soy.$$escapeHtml(opt_data.jiraType) + '"><label for="' + soy.$$escapeHtml(opt_data.name) + '">' + soy.$$escapeHtml(opt_data.labelText) + ((opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><textarea rows="10" id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '" class="textarea long-field">' + soy.$$escapeHtml(opt_data.value) + '</textarea>';
    if (opt_data.errorTexts) {
        var errorList37 = opt_data.errorTexts;
        var errorListLen37 = errorList37.length;
        for (var errorIndex37 = 0; errorIndex37 < errorListLen37; errorIndex37++) {
            var errorData37 = errorList37[errorIndex37];
            output += '<div class="error">' + soy.$$escapeHtml(errorData37) + '</div>';
        }
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.textareaField.soyTemplateName = 'jiraIntegration.templates.fields.textareaField';
}

jiraIntegration.templates.fields.arrayField = function(opt_data, opt_ignored) {
    return '' + aui.form.textField({
        id: opt_data.name,
        name: opt_data.name,
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        value: opt_data.value,
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.arrayField.soyTemplateName = 'jiraIntegration.templates.fields.arrayField';
}

jiraIntegration.templates.fields.numberField = function(opt_data, opt_ignored) {
    return '' + aui.form.textField({
        id: opt_data.name,
        name: opt_data.name,
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        value: opt_data.value,
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.numberField.soyTemplateName = 'jiraIntegration.templates.fields.numberField';
}

jiraIntegration.templates.fields.allowedValuesField = function(opt_data, opt_ignored) {
    return '' + ((opt_data.options.length) ? aui.form.selectField({
        id: opt_data.name,
        name: opt_data.name,
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        options: opt_data.options,
        isRequired: opt_data.isRequired,
        isMultiple: opt_data.isMultiple,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    }) : aui.form.valueField({
        id: opt_data.name,
        name: opt_data.name,
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        value: "None",
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    }));
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.allowedValuesField.soyTemplateName = 'jiraIntegration.templates.fields.allowedValuesField';
}

jiraIntegration.templates.fields.timeTrackingField = function(opt_data, opt_ignored) {
    return '' + aui.form.textField({
        id: opt_data.name,
        name: opt_data.name,
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        value: opt_data.value,
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.timeTrackingField.soyTemplateName = 'jiraIntegration.templates.fields.timeTrackingField';
}

jiraIntegration.templates.fields.unrenderableTypeField = function(opt_data, opt_ignored) {
    var output = '<div class="field-group jira-field jira-field-unrenderable' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '"><label>' + soy.$$escapeHtml(opt_data.labelText) + ((opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '') + '</label>' + aui.form.value({
        content: opt_data.reasonContent
    });
    if (opt_data.errorTexts) {
        var errorList117 = opt_data.errorTexts;
        var errorListLen117 = errorList117.length;
        for (var errorIndex117 = 0; errorIndex117 < errorListLen117; errorIndex117++) {
            var errorData117 = errorList117[errorIndex117];
            output += '<div class="error">' + soy.$$escapeHtml(errorData117) + '</div>';
        }
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.unrenderableTypeField.soyTemplateName = 'jiraIntegration.templates.fields.unrenderableTypeField';
}

jiraIntegration.templates.fields.dateField = function(opt_data, opt_ignored) {
    return '' + aui.form.textField({
        labelContent: '' + soy.$$escapeHtml(opt_data.labelText),
        id: opt_data.name,
        name: opt_data.name,
        value: opt_data.value,
        isRequired: opt_data.isRequired,
        extraClasses: 'jira-field' + (opt_data.extraClasses ? ' ' + opt_data.extraClasses : ''),
        extraAttributes: {
            'data-jira-type': opt_data.jiraType
        },
        errorTexts: opt_data.errorTexts
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.dateField.soyTemplateName = 'jiraIntegration.templates.fields.dateField';
}

jiraIntegration.templates.fields.select2WithIconField = function(opt_data, opt_ignored) {
    var output = '<div class="field-group jira-field' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '" data-jira-type="' + soy.$$escapeHtml(opt_data.jiraType) + '"><label for="' + soy.$$escapeHtml(opt_data.name) + '">' + soy.$$escapeHtml(opt_data.labelText) + ((opt_data.isRequired) ? '<span class="aui-icon icon-required"></span>' : '') + '</label><select id="' + soy.$$escapeHtml(opt_data.name) + '" name="' + soy.$$escapeHtml(opt_data.name) + '">';
    var optionList154 = opt_data.options;
    var optionListLen154 = optionList154.length;
    for (var optionIndex154 = 0; optionIndex154 < optionListLen154; optionIndex154++) {
        var optionData154 = optionList154[optionIndex154];
        output += '<option value="' + soy.$$escapeHtml(optionData154.value) + '" ' + ((optionData154.selected) ? 'selected' : '') + ' data-icon-url="' + soy.$$escapeHtml(optionData154.iconUrl) + '">' + soy.$$escapeHtml(optionData154.text) + '</option>';
    }
    output += '</select>';
    if (opt_data.errorTexts) {
        var errorList170 = opt_data.errorTexts;
        var errorListLen170 = errorList170.length;
        for (var errorIndex170 = 0; errorIndex170 < errorListLen170; errorIndex170++) {
            var errorData170 = errorList170[errorIndex170];
            output += '<div class="error">' + soy.$$escapeHtml(errorData170) + '</div>';
        }
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.select2WithIconField.soyTemplateName = 'jiraIntegration.templates.fields.select2WithIconField';
}

jiraIntegration.templates.fields.select2WithIconOption = function(opt_data, opt_ignored) {
    return ((opt_data.iconUrl) ? aui.avatar.avatar({
        avatarImageUrl: opt_data.iconUrl,
        size: 'xsmall',
        isProject: opt_data.isProject,
        extraClasses: 'select-option-image',
        tagName: 'span'
    }) : '') + '<span class="select-option" title="' + soy.$$escapeHtml(opt_data.optionValue) + '">' + soy.$$escapeHtml(opt_data.optionValue) + '</span>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.select2WithIconOption.soyTemplateName = 'jiraIntegration.templates.fields.select2WithIconOption';
}

jiraIntegration.templates.fields.labelFieldResult = function(opt_data, opt_ignored) {
    return '' + ((opt_data.label.isNew) ? soy.$$escapeHtml(AJS.format("\x22{0}\x22 - (New label)", opt_data.label.labelName)) : soy.$$escapeHtml(opt_data.label.labelName));
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.labelFieldResult.soyTemplateName = 'jiraIntegration.templates.fields.labelFieldResult';
}

jiraIntegration.templates.fields.userOptionSelect = function(opt_data, opt_ignored) {
    var output = '';
    var userOption__soy197 = soy.$$escapeHtml(opt_data.displayName) + ' - (' + soy.$$escapeHtml(opt_data.name) + ')';
    output += '<span title="' + soy.$$filterNoAutoescape(userOption__soy197) + '">' + soy.$$filterNoAutoescape(userOption__soy197) + '</span>';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.fields.userOptionSelect.soyTemplateName = 'jiraIntegration.templates.fields.userOptionSelect';
}
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:fields', location = '/fields/fields.js' */
var jiraIntegration = window.jiraIntegration || {};
jiraIntegration.fields = (function(I, P) {
    var k = "YYYY-MM-DD";
    var g = {
        template: jiraIntegration.templates.fields.stringField,
        getContext: u,
        getValue: A
    };
    var y = {
        template: jiraIntegration.templates.fields.stringField,
        getContext: q,
        getValue: D,
        behavior: o
    };
    var t = {
        template: jiraIntegration.templates.fields.arrayField,
        getContext: h,
        getValue: B,
        behavior: j
    };
    var r = {
        template: jiraIntegration.templates.fields.textareaField,
        getContext: u,
        getValue: A
    };
    var F = {
        template: jiraIntegration.templates.fields.numberField,
        getContext: u,
        getValue: C
    };
    var c = {
        template: jiraIntegration.templates.fields.arrayField,
        getContext: h,
        getValue: B
    };
    var O = {
        template: jiraIntegration.templates.fields.allowedValuesField,
        getContext: f,
        getValue: P.bind(b, null, "name"),
        behavior: R
    };
    var L = {
        template: jiraIntegration.templates.fields.allowedValuesField,
        getContext: f,
        getValue: P.bind(b, null, "id")
    };
    var K = {
        template: jiraIntegration.templates.fields.timeTrackingField,
        getContext: Q,
        getValue: e
    };
    var J = {
        template: jiraIntegration.templates.fields.dateField,
        getContext: u,
        getValue: A,
        behavior: x
    };
    var i = {
        template: jiraIntegration.templates.fields.select2WithIconField,
        getContext: H,
        getValue: P.bind(b, null, "name"),
        behavior: a
    };
    var l = {
        "com.pyxis.greenhopper.jira:gh-epic-label": g,
        string: g,
        summary: g,
        "com.atlassian.jira.plugin.system.customfieldtypes:textfield": g,
        "com.atlassian.jira.plugin.system.customfieldtypes:url": g,
        environment: r,
        "com.atlassian.jira.plugin.system.customfieldtypes:textarea": r,
        description: r,
        "com.atlassian.jira.plugin.system.customfieldtypes:float": F,
        array: c,
        labels: t,
        "com.atlassian.jira.plugin.system.customfieldtypes:labels": c,
        resolution: O,
        fixVersions: O,
        priority: i,
        versions: O,
        components: O,
        security: O,
        "com.atlassian.jira.plugin.system.customfieldtypes:version": O,
        "com.atlassian.jira.plugin.system.customfieldtypes:multiversion": O,
        "com.atlassian.jira.plugin.system.customfieldtypes:project": O,
        assignee: y,
        reporter: y,
        timetracking: K,
        duedate: J,
        "com.atlassian.jira.plugin.system.customfieldtypes:datepicker": J,
        "com.atlassian.jira.plugin.system.customfieldtypes:multiselect": L,
        "com.atlassian.jira.plugin.system.customfieldtypes:select": L
    };
    var v = {
        ignoreFieldsWithDefaultValue: false
    };
    function m(U, S, V) {
        var T = S.schema.system || "customfield_" + S.schema.customId;
        return {
            labelText: S.name,
            name: T,
            isRequired: S.required,
            errorTexts: V[T],
            jiraType: U
        }
    }
    function u(W, S, T, U) {
        var V = W.name;
        W.value = (I.isPlainObject(U[V]) ? U[V].name : U[V]) || (T && T.fields[V]) || "";
        return W
    }
    function A(S) {
        return S.val()
    }
    function C(S) {
        var T = S.val();
        if (s(T)) {
            return Number(T)
        }
        return T || null
    }
    function x(S) {
        var U = S.find("input");
        if (!!navigator.userAgent.match(/Trident/) && AJS.version < "5.3.5") {
            var T = "placeholder"in document.createElement("input");
            U.attr("placeholder", k);
            if (!T) {
                U.on("focus", function() {
                    if (U.val() === U.attr("placeholder")) {
                        U.val("")
                    }
                }).on("blur", function() {
                    if (U.val() === "") {
                        U.val(U.attr("placeholder"))
                    }
                }).blur()
            }
        } else {
            U.datePicker({
                overrideBrowserDefault: true
            })
        }
    }
    function h(W, S, T, U) {
        var V = W.name;
        W.value = (U[V] && U[V].join(",")) || (T && T.fields[V] && T.fields[V].join(","));
        return W
    }
    function B(S) {
        return P.map(S.val().split(","), I.trim)
    }
    function f(Y, S, T, V) {
        var W = Y.name;
        var U = V[W];
        var Z = T && T.fields[W];
        var X;
        if (U) {
            X = I.isArray(U) ? P.pluck(U, "name") : [U.name]
        } else {
            if (Z) {
                X = I.isArray(Z) ? P.pluck(Z, "name") : [Z.name]
            } else {
                X = []
            }
        }
        Y.options = P.map(S.allowedValues, function(aa) {
            return {
                value: aa.name || aa.id,
                text: aa.name || aa.value,
                selected: P.contains(X, aa.name || aa.id)
            }
        });
        Y.isMultiple = P.contains(S.operations, "add");
        return Y
    }
    function b(V, T) {
        var W = T.val();
        var S = T.attr("multiple");
        var U = function(Y) {
            var X = {};
            X[V] = Y;
            return X
        };
        if (S) {
            return I.isArray(W) ? P.map(W, U) : [U(W)]
        }
        return U(W)
    }
    function R(S) {
        S.find("select[multiple]").auiSelect2()
    }
    function q(W, S, T, U) {
        var V = W.name;
        W.value = (U[V] && U[V].name) || (T && T.fields[V] && T.fields[V].name) || "";
        return W
    }
    function D(S) {
        return {
            name: S.val()
        }
    }
    function N(T, W, V, U, X) {
        var Z = T.find("input");
        var Y = T.attr("name");
        Z.removeClass("text");
        var S = {
            minimumInputLength: 1,
            id: Y,
            name: Y,
            query: function(ab) {
                function aa(ac) {
                    ab.callback({
                        results: ac
                    })
                }
                n(W, V, ab.term, U).done(aa)
            }
        };
        Z.auiSelect2(I.extend(S, X));
        T.find("div.aui-select2-container").addClass("jira-select2-drop-box")
    }
    function o(S, V, U, T) {
        var W = {
            formatInputTooShort: function() {
                return "Find users..."
            },
            formatResult: function(X) {
                return jiraIntegration.templates.fields.userOptionSelect({
                    name: X.id,
                    displayName: X.text
                })
            }
        };
        N(S, V, U, T, W)
    }
    function j(S, V, U, T) {
        var W = S.find("input");
        jiraIntegration.fields._labelPicker.build(W, function(X) {
            return n(V, U, X, T)
        })
    }
    function n(W, U, V, T) {
        var S = I.extend({
            restType: U,
            issueKey: (T && T.key) || "",
            term: V
        }, W);
        return I.ajax({
            type: "POST",
            timeout: 0,
            contentType: "application/json",
            dataType: "json",
            url: AJS.contextPath() + "/rest/jira-integration/latest/fields/autocomplete",
            data: JSON.stringify(S)
        })
    }
    function Q(W, S, T, U) {
        var V = W.name;
        W.value = (U[V] && U[V].remainingEstimate) || (T && T.fields[V] && T.fields[V].remainingEstimate) || "";
        return W
    }
    function e(S) {
        return {
            remainingEstimate: S.val()
        }
    }
    function H(X, S, T, U) {
        var V = X.name;
        var W = (U[V] && U[V].name) || (T && T.fields && T.fields[V] && T.fields[V].name) || "";
        X.options = P.map(S.allowedValues, function(Y) {
            return {
                value: Y.name,
                text: Y.name,
                selected: W === Y.name,
                iconUrl: Y.iconUrl
            }
        });
        return X
    }
    function z(T) {
        var S;
        if (T.id) {
            S = I(T.element).attr("data-icon-url")
        }
        return jiraIntegration.templates.fields.select2WithIconOption({
            optionValue: T.text,
            iconUrl: S
        })
    }
    function a(W, V, T, S) {
        if (!I.fn.auiSelect2) {
            AJS.log("AUI version 5.2 or greater is required as this plugin needs the .auiSelect2() jQuery plugin.");
            return
        }
        var U = W.find("select");
        U.addClass("jira-select2-drop-box");
        U.auiSelect2({
            hasAvatar: true,
            minimumResultsForSearch: -1,
            formatSelection: z,
            formatResult: z
        })
    }
    function p(T, S) {
        if (P.has(l, T) && console && console.warn) {
            console.warn("Redefining handler for type " + T + ".")
        }
        l[T] = S
    }
    function E(S) {
        return S.schema ? (S.schema.system || S.schema.custom || S.schema.customId) : S
    }
    function M(S) {
        return l[E(S)]
    }
    function w(S) {
        var T = d(S);
        return T && M(T)
    }
    function d(S) {
        return S.closest(".jira-field").attr("data-jira-type")
    }
    function G(T, S) {
        return I.ajax({
            type: "GET",
            timeout: 0,
            url: AJS.contextPath() + "/rest/jira-integration/1.0/servers/" + T.serverId + "/projects/" + T.projectKey + "/issue-types/" + T.issueType + "/fields-meta"
        }).pipe(function(V) {
            var U = [];
            P.each(V.fields, function(X) {
                var W = E(X);
                if (X.required && !P.contains(S.excludedFields, W)) {
                    U.push(X)
                }
            });
            return U
        })
    }
    function s(S) {
        return /\d/.test(S) && /^-?\d*\.?\d*$/.test(S)
    }
    return {
        addFieldHandler: p,
        getFieldHandler: M,
        canRender: function(S) {
            var U = E(S);
            var T = l[U];
            if (!T) {
                return false
            }
            return S.operations && S.operations.length && (!T.canRender || T.canRender(S))
        },
        renderField: function(W, Y, Z, X) {
            var S = Y.schema.system || Y.schema.custom || Y.schema.customId;
            var U = l[S];
            var V = m(S, Y, X || {});
            var aa = !U || (U.canRender && !U.canRender(Y));
            var T = !Y.operations || !Y.operations.length;
            if (aa || T) {
                V.reasonContent = aa ? AJS.format("{0}Edit{1} this field in JIRA", '<a href="' + (W ? W.url : "#") + '">', "</a>") : T ? AJS.format("{0}Edit{1} this field in JIRA", '<a href="' + (W ? W.url : "#") + '">', "</a>") : null;
                if (!V.reasonContent) {
                    throw new Error("Invalid unrenderable reason.")
                }
                return jiraIntegration.templates.fields.unrenderableTypeField(V)
            }
            return U.template(U.getContext(V, Y, W, Z || {}))
        },
        getJSON: function(S) {
            var T = w(S);
            return T && T.getValue && T.getValue(S)
        },
        attachFieldBehaviors: function(U, T, S) {
            U.find(".jira-field").each(function(X, W) {
                var V = I(W);
                var Z = d(V);
                var Y = Z && M(Z);
                var aa = Y && Y.behavior;
                if (aa) {
                    aa(V, T, Z, S)
                }
            })
        },
        renderCreateRequiredFields: function(W, V, U, T, S) {
            T = P.extend({}, v, T);
            function X(Y) {
                if (T.ignoreFieldsWithDefaultValue) {
                    Y = P.filter(Y, function(aa) {
                        return !aa.hasDefaultValue
                    })
                }
                var Z = P.filter(Y, function(aa) {
                    return !jiraIntegration.fields.canRender(aa)
                });
                if (Z.length) {
                    if (S) {
                        S(Z)
                    }
                    return
                }
                W.html(P.map(Y, function(aa) {
                    return jiraIntegration.fields.renderField(null, aa, null, null)
                }).join(""));
                jiraIntegration.fields.attachFieldBehaviors(W, {
                    serverId: U.serverId,
                    projectKey: U.projectKey
                }, null)
            }
            if (T.requiredFields) {
                X(T.requiredFields)
            } else {
                G(U, T).done(X)
            }
        }
    }
}(AJS.$, window._));
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:fields', location = '/fields/label-picker.js' */
var jiraIntegration = window.jiraIntegration || {};
jiraIntegration.fields = jiraIntegration.fields || {};
jiraIntegration.fields._labelPicker = function(a) {
    var b = function(d, c) {
        d.auiSelect2({
            tags: true,
            multiple: true,
            tokenSeparators: [",", " "],
            createSearchChoice: function(e) {
                if (!e) {
                    return null
                }
                return {
                    id: e,
                    text: e,
                    isNew: true
                }
            },
            query: function(f) {
                var e = function(g) {
                    f.callback({
                        results: g
                    })
                };
                c(f.term).done(e)
            },
            formatResult: function(e) {
                return jiraIntegration.templates.fields.labelFieldResult({
                    label: {
                        labelName: e.text,
                        isNew: e.isNew
                    }
                })
            }
        })
    };
    return {
        build: b
    }
}(AJS.$);
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:transition-form', location = '/transition-form/transition-form.soy' */
// This file was automatically generated from transition-form.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace jiraIntegration.templates._transitionForm.
 */

if (typeof jiraIntegration == 'undefined') {
    var jiraIntegration = {};
}
if (typeof jiraIntegration.templates == 'undefined') {
    jiraIntegration.templates = {};
}
if (typeof jiraIntegration.templates._transitionForm == 'undefined') {
    jiraIntegration.templates._transitionForm = {};
}

jiraIntegration.templates._transitionForm.globalError = function(opt_data, opt_ignored) {
    var param3 = '';
    var errorTextList4 = opt_data.errorTexts;
    var errorTextListLen4 = errorTextList4.length;
    for (var errorTextIndex4 = 0; errorTextIndex4 < errorTextListLen4; errorTextIndex4++) {
        var errorTextData4 = errorTextList4[errorTextIndex4];
        param3 += '<p>' + soy.$$escapeHtml(errorTextData4) + '</p>';
    }
    var output = '' + aui.message.error({
        content: param3
    });
    output += aui.buttons.button({
        tagName: 'a',
        type: 'primary',
        extraClasses: 'jira-error-action',
        extraAttributes: {
            href: opt_data.actionUrl
        },
        text: opt_data.actionText
    });
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates._transitionForm.globalError.soyTemplateName = 'jiraIntegration.templates._transitionForm.globalError';
}

jiraIntegration.templates._transitionForm.form = function(opt_data, opt_ignored) {
    var param19 = '<div class="jira-section-heading"><h3>' + soy.$$escapeHtml(opt_data.transition.name) + '</h3></div>';
    if (opt_data.errorText) {
        var param25 = '';
        var errorTextList26 = opt_data.errorText;
        var errorTextListLen26 = errorTextList26.length;
        for (var errorTextIndex26 = 0; errorTextIndex26 < errorTextListLen26; errorTextIndex26++) {
            var errorTextData26 = errorTextList26[errorTextIndex26];
            param25 += soy.$$escapeHtml(errorTextData26);
        }
        param19 += aui.message.error({
            content: param25
        });
    }
    param19 += soy.$$filterNoAutoescape(opt_data.fieldContent) + aui.form.buttons({
        content: '' + aui.buttons.button({
            type: 'primary',
            extraClasses: 'jira-transition',
            extraAttributes: {
                'data-transition-id': opt_data.transition.id
            },
            text: opt_data.transition.name
        }) + aui.buttons.button({
            extraClasses: 'jira-transition-cancel',
            type: 'link',
            text: "Cancel"
        })
    });
    var output = '' + aui.form.form({
        action: '',
        extraClasses: 'jira-transition-form',
        content: param19
    });
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates._transitionForm.form.soyTemplateName = 'jiraIntegration.templates._transitionForm.form';
}
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:transition-form', location = '/transition-form/transition-form.js' */
var jiraIntegration = window.jiraIntegration || {};
jiraIntegration.transitionForm = (function(b, a) {
    return {
        isRequired: function(c, d) {
            return d.fields && a.some(d.fields, jiraIntegration.fields.canRender)
        },
        $render: function(g, f, c, h) {
            if (!b.fn.auiSelect2) {
                throw new Error("AUI version 5.2 or greater is required as this plugin needs the .auiSelect2() jQuery plugin.")
            }
            var d = {};
            var k = false;
            a.each(h && h.errors || [], function(l) {
                k = k || l.context;
                var m = l.context || "__global__";
                d[m] = d[m] || [];
                d[m].push(l.message)
            });
            var i = !!d.__global__;
            if (!i || k) {
                var e = f.fields ? a.values(f.fields) : [];
                a.each(e, function(m, l) {
                    m.fieldIndex = l
                });
                e.sort(function(o, n) {
                    var m = jiraIntegration.fields.canRender(o) ? 0 : 1;
                    var l = jiraIntegration.fields.canRender(n) ? 0 : 1;
                    return (m - l) || (o.fieldIndex - n.fieldIndex)
                });
                var j = b(jiraIntegration.templates._transitionForm.form({
                    errorTexts: d.__global__,
                    transition: f,
                    fieldContent: a.map(e, function(l) {
                        return jiraIntegration.fields.renderField(g, l, c, d)
                    }).join("")
                }));
                jiraIntegration.fields.attachFieldBehaviors(j, {
                    serverId: g.applicationLinkId,
                    projectKey: g.fields.project.key
                }, g);
                return j
            } else {
                return b(jiraIntegration.templates._transitionForm.globalError({
                    errorTexts: d.__global__,
                    actionText: AJS.format("{0} in JIRA", f.name),
                    actionUrl: g.url
                }))
            }
        },
        getJSON: function(c) {
            return a.reduce(c.find("input,select,textarea").not(".select2-input,.select2-focusser"), function(d, f) {
                var e = b(f);
                d[e.attr("name")] = jiraIntegration.fields.getJSON(e);
                return d
            }, {})
        }
    }
}(AJS.$, window._));
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-issues-dialog', location = '/jira-issue-dialog/jira-issues-dialog.js' */
var jiraIntegration = window.jiraIntegration || {};
jiraIntegration.JiraIssuesDialog = (function(f, n) {
    f(document).on("jira-img-error", "img", function() {
        var r = f('<div class="jira-default-project-avatar"></div>').text(this.getAttribute("alt"));
        f(this).replaceWith(r)
    });
    function c(r) {
        this.options = f.extend({}, c.prototype.defaults, r);
        this.issueKeys = this.options.issueKeys || [];
        this.entityKey = this.options.entityKey || null;
        n.bindAll(this, "show", "hide", "onAuthorizationSucceeded", "setIssueKeys", "setEntityKey", "setTitle", "reset", "destroy", "_renderJiraData");
        this._initDialog();
        this._truncated = false;
        this._jiraIssuesData = null;
        this._jiraIssuesDataPromise = null;
        this._events = {};
        this._currentXhr = null
    }
    c.prototype.defaults = {
        id: "jira-issues-dialog",
        issueKeys: null,
        entityKey: null,
        maxIssues: 10,
        headerTitle: "JIRA Issues",
        get$AuthMessage: function(s, t, u, r) {
            return f(jiraIntegration.templates.dialog.authenticate({
                extraClasses: "jira-oauth-dialog",
                applicationName: t,
                text: u,
                title: AJS.format("Authenticate with {0}", t),
                content: aui.buttons.button({
                    text: "Authenticate",
                    tagName: "a",
                    type: "primary",
                    extraClasses: "jira-dialog-auth-trigger " + r,
                    extraAttributes: {
                        href: s,
                        target: "_blank"
                    }
                })
            }))
        },
        get$ConnectionLostMessage: function(t) {
            if (t.length === 1) {
                var s = t[0];
                return f(jiraIntegration.templates.dialog.error({
                    titleContent: jiraIntegration.templates.dialog.linkTitle({
                        text: "Connection lost with",
                        link: s.applicationUrl,
                        linkText: s.applicationName
                    }),
                    text: "Unfortunately, we\u0027ve encountered problems connecting to JIRA" + ":\n" + s.message,
                    extraClasses: "communication-error"
                }))
            } else {
                var r = n.map(t, function(u) {
                    return jiraIntegration.templates.dialog.linkText({
                        link: u.applicationUrl,
                        linkText: u.applicationName,
                        text: u.message,
                        extraClasses: "multi"
                    })
                });
                return f(jiraIntegration.templates.dialog.error({
                    title: "There were errors communicating with JIRA",
                    content: r.join(""),
                    extraClasses: "communication-error"
                }))
            }
        },
        get$UnknownErrorMessage: function() {
            return f(jiraIntegration.templates.dialog.error({
                title: "Unknown error",
                text: "An unexpected error occurred.\nPlease contact your system administrator if the problem persists."
            }))
        },
        get$NoIssuesExistMessage: function() {
            return f(jiraIntegration.templates.dialog.message({
                title: "Can\u0027t display issues",
                text: "Either you don\u0027t have access to view them or they don\u0027t exist.\nPlease contact your system administrator if you believe this is incorrect.",
                iconClass: "icon-jira",
                extraClasses: "no-issues-exist"
            }))
        },
        ajax: function(r) {
            alert("JiraIssuesDialog requires the option 'ajax(options)' to be specified.\nThis method should handle response status codes other than 200 and 500.")
        }
    };
    function o(r) {
        return Math.max(0, Math.min(r - 250, 640))
    }
    c.prototype.on = function(r, s) {
        this._events[r] = this._events[r] || [];
        this._events[r].push(s)
    }
    ;
    c.prototype.off = function(r, s) {
        if (this._events[r]) {
            this._events[r] = n.without(this._events[r], s)
        }
    }
    ;
    c.prototype._trigger = function(s) {
        var r = this;
        var t = Array.prototype.slice.call(arguments, 1);
        if (this._events[s]) {
            n.map(this._events[s], function(u) {
                u.apply(r, t)
            })
        }
    }
    ;
    c.prototype._initDialog = function() {
        var r = this;
        var t = f(window).height();
        this.dialog = new AJS.Dialog({
            width: 980,
            height: o(t),
            id: this.options.id,
            closeOnOutsideClick: true,
            focusSelector: ".button-panel-cancel-link"
        });
        f("#" + this.options.id).addClass("jira-issues-dialog");
        this.setTitle();
        this.dialog.addCancel("Close", this.hide).addPanel("jira-issues-list");
        this._transitionClickHandler = function(u) {
            u.preventDefault();
            r._onTransitionClicked(this)
        }
        ;
        this.dialog.getCurrentPanel().body.on("click", ".jira-transition-cancel", function(u) {
            u.preventDefault();
            r._onTransitionCancelled(this)
        });
        f(document).on("hideLayer", function() {
            if (r.multiIssueView) {
                r.multiIssueView.destroy()
            }
        });
        var s = f(window);
        this.onWindowResize = n.debounce(function() {
            r._setMinHeight(s.height())
        }, 200);
        s.on("resize", this.onWindowResize)
    }
    ;
    c.prototype._setMinHeight = function(s) {
        var r = this.dialog.getCurrentPanel().body;
        r.css("min-height", o(s));
        if (r.is(":visible")) {
            this.dialog.updateHeight()
        }
    }
    ;
    function b(r) {
        return (!r.which || r.which === 1) && !(r.metaKey || r.ctrlKey || r.shiftKey || (r.altKey && !f.browser.msie))
    }
    c.prototype.reset = function() {
        this._cancelPendingRender();
        this._truncated = false;
        this._jiraIssuesData = null
    }
    ;
    c.prototype.setIssueKeys = function(s, r) {
        s = n.uniq(s);
        this.initialIssueKey = r;
        if (!this.issueKeys || s.length !== this.issueKeys.length || n.difference(s, this.issueKeys).length) {
            this.issueKeys = s;
            this.reset()
        }
    }
    ;
    c.prototype.setEntityKey = function(r) {
        if (this.entityKey !== r) {
            this.entityKey = r;
            this.reset()
        }
    }
    ;
    c.prototype.destroy = function() {
        this.reset();
        this.dialog.remove();
        this._events = null;
        this.dialog = null;
        this.issueKeys = null;
        this.entityKey = null;
        this.options = null;
        if (this.onWindowResize) {
            f(window).off("resize", this.onWindowResize);
            this.onWindowResize = null
        }
    }
    ;
    c.prototype.setTitle = function(r) {
        this.dialog.addHeader(r || this.options.headerTitle || c.prototype.defaults.headerTitle)
    }
    ;
    c.prototype.show = function() {
        f(document).on("click", ".jira-transition", this._transitionClickHandler);
        this.dialog.getCurrentPanel().body.removeClass("multi-issues");
        this.dialog.show();
        this._setMinHeight(f(window).height());
        this._loadJiraData().done(this._renderJiraData);
        this._trigger("show")
    }
    ;
    c.prototype.hide = function() {
        this.dialog.hide();
        f(document).off("click", ".jira-transition", this._transitionClickHandler);
        this._trigger("hide")
    }
    ;
    c.prototype._getRestIssuesUrl = function() {
        return AJS.contextPath() + "/rest/jira-integration/latest/issues?issueKey=" + n.map(this.issueKeys, encodeURIComponent).join("&issueKey=") + (this.entityKey ? "&entityKey=" + encodeURIComponent(this.entityKey) : "") + "&fields=*all,-comment&minimum=" + this.options.maxIssues
    }
    ;
    c.prototype._getRestTransitionUrl = function(r, s) {
        return AJS.contextPath() + "/rest/jira-integration/latest/issues/" + encodeURIComponent(r) + "/transitions?applicationId=" + encodeURIComponent(s) + "&fields=*all,-comment"
    }
    ;
    c.prototype._loadJiraData = function() {
        if (!this._jiraIssuesData && !this._jiraIssuesDataPromise) {
            var r = this;
            var s = this.dialog.getCurrentPanel().body;
            if (!f.fn.spin) {
                alert("This plugin requires spin.js and the jquery plugin to be available.")
            }
            s.empty().spin("large");
            this._jiraIssuesDataPromise = this.options.ajax({
                type: "GET",
                url: this._getRestIssuesUrl(),
                dataType: "json",
                contentType: "application/json",
                jsonp: false
            }).pipe(function(v, y, w) {
                if (v.errors && v.errors.length) {
                    r._handleAuthenticationRequired(v.errors[0]);
                    return f.Deferred().reject()
                }
                if (v && v.length) {
                    var x = n.filter(v, function(z) {
                        return z.canTransition && z.transitions.length === 0
                    });
                    if (x.length) {
                        n.forEach(x, function(z) {
                            z.transitions = r._getTransitions(z.key, z.applicationLinkId, v);
                            z.transitions.done(function() {
                                q(z)
                            })
                        });
                        n.forEach(n.difference(v, x), q);
                        var t = x[0].transitions;
                        var u = f.Deferred();
                        t.done(function() {
                            u.resolve(v)
                        });
                        t.fail(u.reject);
                        return u
                    }
                    n.forEach(v, q)
                }
                return v
            }, function(u, v, t) {
                r._handle500Error(u)
            }).always(function() {
                s.spinStop()
            }).done(function(t) {
                if (t.length) {
                    r._truncated = t.length > r.options.maxIssues;
                    t = n.first(t, r.options.maxIssues)
                }
                r._jiraIssuesData = t;
                r._setAuthUrl(null)
            });
            return r._jiraIssuesDataPromise.always(function() {
                r._jiraIssuesDataPromise = null
            })
        } else {
            if (this._jiraIssuesDataPromise) {
                return this._jiraIssuesDataPromise
            } else {
                return f.Deferred().resolve(this._jiraIssuesData).promise()
            }
        }
    }
    ;
    c.prototype._getTransitions = function(r, v, u) {
        var t = this;
        var s;
        u = u || this._jiraIssuesData;
        if (u) {
            s = n.find(u, function(w) {
                return w.key === r
            });
            if (s && s.transitions && s.transitions[0] && s.transitions[0].fields) {
                return f.when(s.transitions)
            }
        }
        return this.options.ajax({
            type: "GET",
            url: this._getRestTransitionUrl(r, v),
            dataType: "json",
            contentType: "application/json",
            jsonp: false
        }).pipe(function(w) {
            if (w.errors && w.errors.length) {
                t._handleAuthenticationRequired(w.errors[0]);
                return f.Deferred().reject()
            } else {
                if (s) {
                    s.transitions = w
                }
                return w
            }
        }, function(x, y, w) {
            t._handle500Error(x)
        })
    }
    ;
    c.prototype._transitionIssue = function(s, u, v, r) {
        var t = this;
        return this.options.ajax({
            type: "POST",
            url: this._getRestTransitionUrl(s.key, v),
            dataType: "json",
            contentType: "application/json",
            jsonp: false,
            data: JSON.stringify({
                fields: r,
                transition: {
                    id: u.id
                }
            })
        }).pipe(function(x) {
            if (x.errors && x.errors.length) {
                t._handleAuthenticationRequired(x.errors[0]);
                return f.Deferred().reject()
            }
            if (s.fields.status.id === x.fields.status.id && u.to && u.to.id !== x.fields.status.id) {
                return f.Deferred().reject(d("The transition could not be completed due to an unexpected error. Use JIRA to execute this transition."))
            }
            t._trigger("transitioned", s.key);
            if (x.canTransition && !x.transitions.length) {
                var w = f.Deferred();
                t._getTransitions(x.key, x.applicationLinkId, [x]).done(function() {
                    q(x);
                    t._updateCachedData(x);
                    w.resolve(x)
                }).fail(w.reject);
                return w
            }
            q(x);
            t._updateCachedData(x);
            return x
        })
    }
    ;
    c.prototype._setAuthUrl = function(r) {
        this._authUrl = r
    }
    ;
    c.prototype.isVisible = function() {
        return this.dialog.getCurrentPanel().body.is(":visible")
    }
    ;
    c.prototype.onAuthorizationSucceeded = function(r) {
        if (this._authUrl === r && this.isVisible()) {
            this._authUrl = null;
            this._loadJiraData().done(this._renderJiraData)
        }
    }
    ;
    c.prototype._onTransitionClicked = function(y) {
        var E = this;
        var t = f(y);
        var F = t.closest(".jira-transition-form");
        var C = this.dialog.getCurrentPanel().body.find(".jira-issue-detailed");
        var z = C.find(".jira-transition");
        var r = C.attr("data-application-id");
        var u = C.attr("data-issue-key");
        var w = t.attr("data-transition-id");
        var D = n.find(this._jiraIssuesData, function(G) {
            return G.key === u
        });
        z.attr("aria-disabled", "true").prop("disabled", true);
        var B;
        var A;
        var s = this._getTransitions(u, r).pipe(function(G) {
            B = n.find(G, function(H) {
                return H.id === w
            });
            if (B) {
                if (F.length) {
                    A = jiraIntegration.transitionForm.getJSON(F)
                } else {
                    if (jiraIntegration.transitionForm.isRequired(D, B)) {
                        return f.Deferred().reject("formRequired")
                    }
                }
            } else {
                B = {
                    id: w,
                    name: t.text()
                }
            }
            return E._transitionIssue(D, B, r, A)
        });
        var x;
        if (F.length) {
            x = f('<div class="jira-transition-spinner"></div>').prependTo(F.find(".buttons"))
        } else {
            x = f('<div class="jira-transition-spinner"></div>').appendTo(C.find(".jira-transitions"))
        }
        x.spin();
        var v = C.closest(".list-and-detail-view").find('> .list-view .issue-item[data-issuekey="' + D.key + '"]');
        s.done(function(H) {
            var G = H.fields.status;
            v.find(".issue-item-status").html(jiraIntegration.templates.dialog.itemIssueStatus({
                issueStatus: G
            }))
        });
        this._registerPendingRender(s).always(function() {
            z.attr("aria-disabled", "false").prop("disabled", false);
            x.spinStop().remove()
        }).done(function(G) {
            C.replaceWith(E._renderDetailedIssue(G))
        }).fail(function(H) {
            if (!H) {
                return
            }
            if (H === "formRequired") {
                C.children(".jira-header").nextAll().remove();
                C.append(jiraIntegration.transitionForm.$render(D, B));
                C.addClass("jira-transitioning");
                return
            }
            var I;
            if (H.responseText) {
                try {
                    I = JSON.parse(H.responseText)
                } catch (J) {
                    I = d("An unexpected error occurred.\nPlease contact your system administrator if the problem persists.")
                }
            } else {
                I = H
            }
            if (I && I.errors) {
                C.children(".jira-header").nextAll().remove();
                if (B) {
                    C.append(jiraIntegration.transitionForm.$render(D, B, A, I));
                    C.addClass("jira-transitioning")
                } else {
                    if (I.errors && I.errors.length) {
                        var G = n.map(I.errors, function(K) {
                            return "<li>" + AJS.escapeHtml(K.message) + "</li>"
                        });
                        C.append(aui.message.error({
                            content: '<ul class="jira-errors">' + G.join("") + "</ul>"
                        }))
                    } else {
                        C.replaceWith(E.options.get$UnknownErrorMessage());
                        E._setMinHeight(0)
                    }
                }
            }
        })
    }
    ;
    c.prototype._renderDetailedIssue = function(r) {
        var s = f(jiraIntegration.templates.dialog.detailedIssue({
            issue: r
        }));
        return s.attr("data-last-updated", new Date().getTime())
    }
    ;
    c.prototype._onTransitionCancelled = function(t) {
        var v = f(t);
        var u = v.closest(".jira-issue-detailed");
        var r = u.attr("data-issue-key");
        var s = n.find(this._jiraIssuesData, function(w) {
            return w.key === r
        });
        u.replaceWith(this._renderDetailedIssue(s))
    }
    ;
    c.prototype._updateCachedData = function(r) {
        this._jiraIssuesData = n.map(this._jiraIssuesData, function(s) {
            return (s.key === r.key) ? r : s
        })
    }
    ;
    c.prototype._handleAuthenticationRequired = function(r) {
        this._setAuthUrl(r.authenticationUri);
        this._removeViewWarning();
        this.dialog.getCurrentPanel().body.empty().append(this.options.get$AuthMessage(r.authenticationUri, r.applicationName, r.message, this.options.oauthTriggerClass));
        this._trigger("authorizationRequired", r.authenticationUri, r.applicationName);
        this._setMinHeight(0)
    }
    ;
    c.prototype._removeViewWarning = function() {
        this.dialog.popup.element.find(".view-warning").remove()
    }
    ;
    c.prototype._handle500Error = function(v) {
        if (v.status === 500) {
            var s;
            try {
                s = JSON.parse(v.responseText)
            } catch (u) {}
            var r;
            var t = s && s.errors;
            if (!t || !t.length) {
                r = this.options.get$UnknownErrorMessage()
            } else {
                r = this.options.get$ConnectionLostMessage(t)
            }
            this._removeViewWarning();
            this.dialog.getCurrentPanel().body.empty().append(r);
            this._setMinHeight(0)
        }
    }
    ;
    c.prototype._registerPendingRender = function(r) {
        this._cancelPendingRender();
        var s = this._pendingRender = f.Deferred();
        r.done(function() {
            s.resolveWith(this, arguments)
        }).fail(function() {
            s.rejectWith(this, arguments)
        });
        return this._pendingRender
    }
    ;
    c.prototype._cancelPendingRender = function() {
        if (this._pendingRender) {
            this._pendingRender.reject();
            this._pendingRender = null
        }
    }
    ;
    c.prototype._renderJiraData = function() {
        var s = this;
        var u;
        var t = "You don\u0027t have access to view all issues or they may not exist";
        var x = this.dialog.getCurrentPanel().body;
        this._cancelPendingRender();
        var r;
        var w;
        switch (this._jiraIssuesData.length) {
        case 0:
            u = this.options.get$NoIssuesExistMessage();
            break;
        case 1:
            r = this.issueKeys.length > 1 ? t : null;
            u = this._renderDetailedIssue(this._jiraIssuesData[0]);
            w = f(window).height();
            break;
        default:
            if (this._truncated) {
                r = AJS.format("Showing the first {0} issues", this.options.maxIssues)
            } else {
                if (this.issueKeys.length !== this._jiraIssuesData.length) {
                    r = t
                }
            }
            var v = n.findWhere(this._jiraIssuesData, {
                key: this.initialIssueKey
            });
            u = f(jiraIntegration.templates.dialog.multiIssueView({
                issues: this._jiraIssuesData,
                selectedIssue: v
            }));
            this.multiIssueView = new e(u,function(B, A, C, D) {
                if (!b(D)) {
                    return
                }
                D.preventDefault();
                s._cancelPendingRender();
                var y = B.attr("data-issuekey");
                var z = n.find(s._jiraIssuesData, function(E) {
                    return E.key === y
                });
                if (z.transitions && z.transitions.promise) {
                    C.empty().spin("large");
                    s._registerPendingRender(z.transitions).always(function() {
                        C.spinStop()
                    }).done(function() {
                        C.html(s._renderDetailedIssue(z))
                    })
                } else {
                    C.html(s._renderDetailedIssue(z))
                }
            }
            );
            x.addClass("multi-issues");
            w = f(window).height();
            break
        }
        this._removeViewWarning();
        if (r) {
            this.dialog.popup.element.find(".dialog-button-panel").prepend(jiraIntegration.templates.dialog.warningMessage({
                warningText: r
            }))
        }
        x.html(u);
        u.find(".issue-status").attr("data-last-updated", new Date().getTime());
        this._setMinHeight(w || 0)
    }
    ;
    function d(r) {
        return {
            errors: [{
                message: r
            }]
        }
    }
    var l = {
        j: 74,
        k: 75
    };
    function e(r, t, s) {
        this.options = f.extend({}, e.prototype.defaults, s);
        this.$listView = r.find(".list-view");
        this.$detailView = r.find(".detail-view");
        this.selectHandler = t;
        n.bindAll(this, "itemClickHandler", "shortcutHandler");
        this.init()
    }
    e.prototype.defaults = {
        selectedClass: "selectedItem"
    };
    e.prototype.init = function() {
        var r = this;
        this.bindShortcuts();
        this.$listView.on("click", "li", this.itemClickHandler)
    }
    ;
    e.prototype.itemClickHandler = function(t) {
        var s = this.options.selectedClass;
        this.$listView.find("li." + s).removeClass(s);
        var r = f(t.currentTarget).addClass(s);
        this.selectHandler(r, this.$listView, this.$detailView, t)
    }
    ;
    e.prototype.destroy = function() {
        this.unbindShortcuts()
    }
    ;
    e.prototype.shortcutHandler = function(u) {
        if (f(u.target).is("input,textarea,select")) {
            return
        }
        var s;
        if (u.which === l.j) {
            s = "next"
        } else {
            if (u.which === l.k) {
                s = "prev"
            } else {
                return
            }
        }
        var t = this.$listView.find("li." + this.options.selectedClass);
        var r = t[s]("li");
        r.click();
        this._scrollItemIntoView(r)
    }
    ;
    e.prototype.bindShortcuts = function() {
        f(document).on("keydown", this.shortcutHandler)
    }
    ;
    e.prototype.unbindShortcuts = function() {
        f(document).off("keydown", this.shortcutHandler)
    }
    ;
    e.prototype._scrollItemIntoView = function(r) {
        r.find("a").focus().blur()
    }
    ;
    var j = /.*(?=\/browse\/[^\/]*-\d+)/;
    var a = /.*(?=\/rest\/api\/\d+\/)/;
    function q(u) {
        var t = j.exec(u.url)[0];
        var v = a.exec(u.self)[0];
        function s(y, w, x) {
            if (typeof y === "string") {
                x[w] = k(y, t, v);
                return
            }
            n.each(y, s)
        }
        function r(x, w) {
            if (x[w]) {
                x[w] = i(x[w], t, v)
            }
        }
        p(u.fields, m, s);
        p(u.renderedFields, m, s);
        p(u.transitions, m, s);
        if (u.renderedFields) {
            r(u.renderedFields, "description");
            n.each(u.renderedFields.comment && u.renderedFields.comment.comments || [], function(w) {
                r(w, "body")
            })
        }
    }
    function m(t, r, s) {
        return /[uU]rls?$/.test(r)
    }
    function i(s, r, u) {
        try {
            var t = f("<div />").html(s);
            n.each(["href", "src"], function(w) {
                n.each(t.find("[" + w + "]"), function(x) {
                    x.setAttribute(w, k(x.getAttribute(w), r, u))
                })
            });
            s = t.html()
        } catch (v) {}
        return s
    }
    var h = /^(https?:)?\/\//;
    function k(s, r, t) {
        if (s.substring(0, t.length) === t) {
            return g(r, s.substring(t.length))
        }
        if (!h.test(s)) {
            return g(r, s)
        }
        return s
    }
    function p(t, s, r) {
        if (t && typeof t === "object") {
            n.each(t, function(v, u) {
                if (s(v, u, t)) {
                    r(v, u, t)
                }
                p(v, s, r)
            })
        }
    }
    function g(s, r) {
        var u = s.charAt(s.length - 1) === "/";
        var t = r.charAt(0) === "/";
        return u && t ? s + r.substring(1) : u || t ? s + r : s + "/" + r
    }
    return c
}(AJS.$, _));
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-issues-dialog', location = '/jira-issue-dialog/jira-issues-dialog.soy' */
// This file was automatically generated from jira-issues-dialog.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace jiraIntegration.templates.dialog.
 */

if (typeof jiraIntegration == 'undefined') {
    var jiraIntegration = {};
}
if (typeof jiraIntegration.templates == 'undefined') {
    jiraIntegration.templates = {};
}
if (typeof jiraIntegration.templates.dialog == 'undefined') {
    jiraIntegration.templates.dialog = {};
}

jiraIntegration.templates.dialog.detailedIssue = function(opt_data, opt_ignored) {
    return '<div class="jira-issue-detailed" data-issue-key="' + soy.$$escapeHtml(opt_data.issue.key) + '" data-application-id="' + soy.$$escapeHtml(opt_data.issue.applicationLinkId) + '"><div class="jira-header">' + aui.group.group({
        content: '' + aui.group.item({
            extraClasses: 'jira-project-avatar',
            content: '<span class="aui-avatar aui-avatar-project jira-project-avatar aui-avatar-large"><span class="aui-avatar-inner"><img src="' + soy.$$escapeHtml(opt_data.issue.fields.project.avatarUrls['48x48']) + '" alt="' + soy.$$escapeHtml(opt_data.issue.fields.project.name ? opt_data.issue.fields.project.name : '') + '" onerror="AJS.$(this).trigger(\'jira-img-error\')" /></span></span>'
        }) + aui.group.item({
            content: '<span class="project-name">' + soy.$$escapeHtml(opt_data.issue.fields.project.name) + '</span><a class="issue-key" href="' + soy.$$escapeHtml(opt_data.issue.url) + '">' + soy.$$escapeHtml(opt_data.issue.key) + '</a><h2 class="issue-summary" title="' + soy.$$escapeHtml(opt_data.issue.fields.summary) + '">' + soy.$$escapeHtml(opt_data.issue.fields.summary) + '</h2>'
        })
    }) + '</div>' + ((opt_data.issue.canTransition && opt_data.issue.transitions && opt_data.issue.transitions.length) ? jiraIntegration.templates.dialog.jiraActionsToolbar({
        transitions: opt_data.issue.transitions,
        maxTransitionsToDisplay: opt_data.maxTransitionsToDisplay
    }) : '') + '<div class="jira-section-heading"><h3>' + soy.$$escapeHtml("Details") + '</h3></div>' + aui.group.group({
        extraClasses: 'issue-details jira-section',
        content: '' + aui.group.item({
            content: '<ul class="fields"><li class="field issue-type"><span class="field-label">' + soy.$$escapeHtml("Type:") + '</span><img class="aui-icon" src="' + soy.$$escapeHtml(opt_data.issue.fields.issuetype.iconUrl) + '"/><span class="field-text">' + soy.$$escapeHtml(opt_data.issue.fields.issuetype.name) + '</span></li><li class="field issue-priority"><span class="field-label">' + soy.$$escapeHtml("Priority:") + '</span>' + ((opt_data.issue.fields.priority) ? '<img class="aui-icon" src="' + soy.$$escapeHtml(opt_data.issue.fields.priority.iconUrl) + '"/><span class="field-text">' + soy.$$escapeHtml(opt_data.issue.fields.priority.name) + '</span>' : '<span class="field-text empty">' + soy.$$escapeHtml("No priority") + '</span>') + '</li></ul>'
        }) + aui.group.item({
            content: '<ul class="fields"><li class="field issue-status"><span class="field-label">' + soy.$$escapeHtml("Status:") + '</span>' + JIRA.Template.Util.Issue.Status.issueStatusResolver({
                issueStatus: opt_data.issue.fields.status
            }) + '</li><li class="field issue-assignee"><span class="field-label">' + soy.$$escapeHtml("Assignee:") + '</span>' + ((opt_data.issue.fields.assignee) ? '<img class="aui-icon" title="' + soy.$$escapeHtml(opt_data.issue.fields.assignee.displayName) + '" src="' + soy.$$escapeHtml(opt_data.issue.fields.assignee.avatarUrls['16x16']) + '"><span class="field-text">' + soy.$$escapeHtml(opt_data.issue.fields.assignee.displayName) + '</span>' : '<span class="field-text empty">' + soy.$$escapeHtml("Unassigned") + '</span>') + '</li></ul>'
        })
    }) + '<div class="jira-section-heading"><h3>' + soy.$$escapeHtml("Description") + '</h3></div><div class="jira-section">' + ((opt_data.issue.renderedFields && opt_data.issue.renderedFields.description) ? '<div class="issue-description rendered">' + soy.$$filterNoAutoescape(opt_data.issue.renderedFields.description) + '</div>' : (opt_data.issue.fields.description) ? '<p class="issue-description">' + soy.$$escapeHtml(opt_data.issue.fields.description) + '</p>' : '<p class="issue-description empty">' + soy.$$escapeHtml("No description") + '</p>') + '</div></div>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.detailedIssue.soyTemplateName = 'jiraIntegration.templates.dialog.detailedIssue';
}

jiraIntegration.templates.dialog.jiraActionsToolbar = function(opt_data, opt_ignored) {
    return '' + aui.toolbar2.toolbar2({
        extraClasses: 'jira-actions',
        content: '' + aui.toolbar2.group({
            content: '' + aui.toolbar2.item({
                item: 'primary',
                extraClasses: 'jira-transitions',
                content: '' + jiraIntegration.templates.dialog.transitionsButtons(opt_data)
            })
        })
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.jiraActionsToolbar.soyTemplateName = 'jiraIntegration.templates.dialog.jiraActionsToolbar';
}

jiraIntegration.templates.dialog.transitionsButtons = function(opt_data, opt_ignored) {
    var output = '';
    var maxTransitionsToDisplay__soy122 = opt_data.maxTransitionsToDisplay ? opt_data.maxTransitionsToDisplay : 3;
    var param123 = '';
    var transitionList124 = opt_data.transitions;
    var transitionListLen124 = transitionList124.length;
    for (var transitionIndex124 = 0; transitionIndex124 < transitionListLen124; transitionIndex124++) {
        var transitionData124 = transitionList124[transitionIndex124];
        param123 += (transitionIndex124 < maxTransitionsToDisplay__soy122 - 1 || opt_data.transitions.length <= maxTransitionsToDisplay__soy122) ? aui.buttons.button({
            text: transitionData124.name,
            extraClasses: 'jira-transition',
            extraAttributes: {
                'data-transition-id': transitionData124.id,
                autocomplete: 'off'
            }
        }) : '';
    }
    param123 += (opt_data.transitions.length > maxTransitionsToDisplay__soy122) ? aui.buttons.button({
        text: "More",
        dropdown2Target: 'jira-more-transitions',
        extraAttributes: {
            autocomplete: 'off'
        }
    }) : '';
    output += aui.buttons.buttons({
        content: param123
    });
    if (opt_data.transitions.length > maxTransitionsToDisplay__soy122) {
        var param143 = '<ul>';
        var transitionList145 = opt_data.transitions;
        var transitionListLen145 = transitionList145.length;
        for (var transitionIndex145 = 0; transitionIndex145 < transitionListLen145; transitionIndex145++) {
            var transitionData145 = transitionList145[transitionIndex145];
            param143 += (transitionIndex145 > maxTransitionsToDisplay__soy122 - 2) ? '<li><a class="jira-transition" data-transition-id="' + soy.$$escapeHtml(transitionData145.id) + '">' + soy.$$escapeHtml(transitionData145.name) + '</a></li>' : '';
        }
        param143 += '</ul>';
        output += aui.dropdown2.contents({
            id: 'jira-more-transitions',
            extraClasses: 'aui-style-default',
            content: param143
        });
    }
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.transitionsButtons.soyTemplateName = 'jiraIntegration.templates.dialog.transitionsButtons';
}

jiraIntegration.templates.dialog.warningMessage = function(opt_data, opt_ignored) {
    return '<div class="view-warning"><span class="aui-icon aui-icon-small aui-iconfont-info" /><span class="warning-message">' + soy.$$escapeHtml(opt_data.warningText) + '</span></div>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.warningMessage.soyTemplateName = 'jiraIntegration.templates.dialog.warningMessage';
}

jiraIntegration.templates.dialog.multiIssueView = function(opt_data, opt_ignored) {
    var output = '<div class="list-and-detail-view"><div class="list-view"><ul>';
    var issueList162 = opt_data.issues;
    var issueListLen162 = issueList162.length;
    for (var issueIndex162 = 0; issueIndex162 < issueListLen162; issueIndex162++) {
        var issueData162 = issueList162[issueIndex162];
        output += jiraIntegration.templates.dialog.issueItem({
            issue: issueData162,
            isSelected: opt_data.selectedIssue ? issueData162.key == opt_data.selectedIssue.key : issueIndex162 == 0
        });
    }
    output += '</ul></div><div class="detail-view">' + jiraIntegration.templates.dialog.detailedIssue({
        issue: opt_data.selectedIssue ? opt_data.selectedIssue : opt_data.issues[0]
    }) + '</div></div>';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.multiIssueView.soyTemplateName = 'jiraIntegration.templates.dialog.multiIssueView';
}

jiraIntegration.templates.dialog.issueItem = function(opt_data, opt_ignored) {
    return '<li class="issue-item' + soy.$$escapeHtml(opt_data.isSelected ? ' selectedItem' : '') + '" data-issuekey="' + soy.$$escapeHtml(opt_data.issue.key) + '"><img class="aui-icon issue-item-type" title="' + soy.$$escapeHtml(opt_data.issue.fields.issuetype.name) + '" src="' + soy.$$escapeHtml(opt_data.issue.fields.issuetype.iconUrl) + '"/><a class="issue-item-key" href="' + soy.$$escapeHtml(opt_data.issue.url) + '">' + soy.$$escapeHtml(opt_data.issue.key) + '</a><div class="issue-item-status">' + jiraIntegration.templates.dialog.itemIssueStatus({
        issueStatus: opt_data.issue.fields.status
    }) + '</div><a href="' + soy.$$escapeHtml(opt_data.issue.url) + '" class="issue-item-summary" title="' + soy.$$escapeHtml(opt_data.issue.fields.summary) + '">' + soy.$$escapeHtml(opt_data.issue.fields.summary) + '</a></li>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.issueItem.soyTemplateName = 'jiraIntegration.templates.dialog.issueItem';
}

jiraIntegration.templates.dialog.itemIssueStatus = function(opt_data, opt_ignored) {
    return '' + JIRA.Template.Util.Issue.Status.issueStatusResolver({
        issueStatus: opt_data.issueStatus,
        isSubtle: true,
        isCompact: !opt_data.issueStatus.statusCategory
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.itemIssueStatus.soyTemplateName = 'jiraIntegration.templates.dialog.itemIssueStatus';
}

jiraIntegration.templates.dialog.message = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="jira-dialog-message' + aui.renderExtraClasses(opt_data) + '"' + aui.renderExtraAttributes(opt_data) + '>' + ((opt_data.iconClass) ? '<div class="jira-dialog-message-icon aui-icon' + ((opt_data.iconClass) ? ' ' + soy.$$escapeHtml(opt_data.iconClass) : '') + '">' + soy.$$escapeHtml(opt_data.accessibilityText ? opt_data.accessibilityText : '') + '</div>' : '') + ((opt_data.title) ? '<h2>' + soy.$$escapeHtml(opt_data.title) + '</h2>' : '') + ((opt_data.titleContent) ? soy.$$filterNoAutoescape(opt_data.titleContent) : '') + ((opt_data.text) ? '<p>' + soy.$$escapeHtml(opt_data.text) + '</p>' : '') + ((opt_data.content) ? soy.$$filterNoAutoescape(opt_data.content) : '') + '</div>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.message.soyTemplateName = 'jiraIntegration.templates.dialog.message';
}

jiraIntegration.templates.dialog.linkText = function(opt_data, opt_ignored) {
    return '<p class="' + soy.$$escapeHtml(opt_data.extraClasses) + '"><a href="' + soy.$$escapeHtml(opt_data.link) + '">' + soy.$$escapeHtml(opt_data.linkText) + '</a>: ' + soy.$$escapeHtml(opt_data.text) + '</p>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.linkText.soyTemplateName = 'jiraIntegration.templates.dialog.linkText';
}

jiraIntegration.templates.dialog.linkTitle = function(opt_data, opt_ignored) {
    return '<h2>' + soy.$$escapeHtml(opt_data.text) + ' <a href="' + soy.$$escapeHtml(opt_data.link) + '">' + soy.$$escapeHtml(opt_data.linkText) + '</a></h2>';
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.linkTitle.soyTemplateName = 'jiraIntegration.templates.dialog.linkTitle';
}

jiraIntegration.templates.dialog.authenticate = function(opt_data, opt_ignored) {
    return '' + jiraIntegration.templates.dialog.message({
        title: AJS.format("Authenticate with {0}", opt_data.applicationName),
        text: opt_data.text,
        content: opt_data.content,
        extraClasses: opt_data.extraClasses,
        iconClass: 'icon-lock'
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.authenticate.soyTemplateName = 'jiraIntegration.templates.dialog.authenticate';
}

jiraIntegration.templates.dialog.error = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '' + jiraIntegration.templates.dialog.message({
        title: opt_data.title,
        titleContent: opt_data.titleContent,
        text: opt_data.text,
        content: opt_data.content,
        extraClasses: opt_data.extraClasses,
        iconClass: 'icon-skull'
    });
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.dialog.error.soyTemplateName = 'jiraIntegration.templates.dialog.error';
}
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-issues-dialog-trigger', location = '/jira-issues-dialog-trigger/jira-issues-dialog-trigger.js' */
jiraIntegration.triggers = (function(d, b) {
    function c(g) {
        return g.which === 3
    }
    function f(g) {
        return (!g.which || g.which === 1) && !(g.metaKey || g.ctrlKey || g.shiftKey || (g.altKey && !d.browser.msie))
    }
    var a = {
        defaults: {
            selector: ".jira-issues-trigger",
            headerTitleFn: null
        }
    };
    function e(j, h) {
        j = d.extend({}, a.defaults, j);
        var l;
        function i() {
            if (!l) {
                if (h instanceof jiraIntegration.JiraIssuesDialog) {
                    l = h
                } else {
                    l = new jiraIntegration.JiraIssuesDialog(h)
                }
            }
            return l
        }
        function n(v, r) {
            var t = i();
            if (c(v) || (!f(v) && !!r.data("single-issue"))) {
                return
            }
            v.preventDefault();
            var u = r.attr("data-issue-keys");
            var s = u && u.split(",");
            var q = r.attr("data-initial-issue-key");
            if (s) {
                t.setIssueKeys(s, q)
            }
            if (typeof j.headerTitleFn === "function") {
                t.setTitle(j.headerTitleFn(r))
            }
            t.show()
        }
        var o = {
            gravity: "n",
            className: function() {
                var s = d(".tipsy");
                var w = s[0];
                var q = w.offsetWidth;
                var v = "multi-issues-tooltip";
                s.addClass(v);
                var t = w.offsetWidth;
                var r = q - t;
                var u = parseFloat(s.css("left"), 10);
                s.css("left", (u + r / 2) + "px");
                return v
            }
        };
        var g;
        var p;
        if (typeof j.selector === "string") {
            g = function(r) {
                var q = d(r.target).closest(j.selector);
                if (q.length) {
                    n(r, q)
                }
            }
            ;
            d(document).on("click", g);
            o.live = true;
            d(j.selector + ".multi-issues").tipsy(o);
            p = function() {
                d(document).off("click", g)
            }
        } else {
            g = function(q) {
                n(q, d(this))
            }
            ;
            var k = d(j.selector);
            k.on("click", g);
            var m = k.filter(".multi-issues");
            m.tipsy(o);
            p = function() {
                k.off("click", g)
            }
        }
        return {
            getDialog: i,
            unbind: p
        }
    }
    a.init = e;
    return a
}(AJS.$, _));
;;/* module-key = 'com.atlassian.integration.jira.jira-integration-plugin:jira-issues-dialog-trigger', location = '/jira-issues-dialog-trigger/jira-issues-dialog-trigger.soy' */
// This file was automatically generated from jira-issues-dialog-trigger.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace jiraIntegration.templates.trigger.
 */

if (typeof jiraIntegration == 'undefined') {
    var jiraIntegration = {};
}
if (typeof jiraIntegration.templates == 'undefined') {
    jiraIntegration.templates = {};
}
if (typeof jiraIntegration.templates.trigger == 'undefined') {
    jiraIntegration.templates.trigger = {};
}

jiraIntegration.templates.trigger.issuesTrigger = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.displayedIssue || opt_data.issues.length == 1) {
        output += '<a class="' + soy.$$escapeHtml(opt_data.className ? opt_data.className : 'jira-issues-trigger') + '" data-issue-keys="';
        var issueList8 = opt_data.issues;
        var issueListLen8 = issueList8.length;
        for (var issueIndex8 = 0; issueIndex8 < issueListLen8; issueIndex8++) {
            var issueData8 = issueList8[issueIndex8];
            output += ((!(issueIndex8 == 0)) ? ',' : '') + soy.$$escapeHtml(issueData8.key);
        }
        output += '"' + ((opt_data.displayedIssue) ? ' data-initial-issue-key="' + soy.$$escapeHtml(opt_data.displayedIssue.key) + '"' : '') + ' data-single-issue="true" href="' + soy.$$escapeHtml(opt_data.displayedIssue ? opt_data.displayedIssue.url : opt_data.issues[0].url) + '">' + soy.$$escapeHtml(opt_data.displayedIssue ? opt_data.displayedIssue.key : opt_data.issues[0].key) + '</a>';
    } else if (opt_data.issues.length > 1) {
        output += '<a class="' + soy.$$escapeHtml(opt_data.className ? opt_data.className : 'jira-issues-trigger') + ' multi-issues" data-issue-keys="';
        var issueList29 = opt_data.issues;
        var issueListLen29 = issueList29.length;
        for (var issueIndex29 = 0; issueIndex29 < issueListLen29; issueIndex29++) {
            var issueData29 = issueList29[issueIndex29];
            output += ((!(issueIndex29 == 0)) ? ',' : '') + soy.$$escapeHtml(issueData29.key);
        }
        output += '" href="#" title="' + jiraIntegration.templates.trigger.tooltip(opt_data) + '"><strong>' + soy.$$escapeHtml(opt_data.issues.length <= (opt_data.maxIssues ? opt_data.maxIssues : 10) ? opt_data.issues.length : AJS.format("{0}+", opt_data.maxIssues ? opt_data.maxIssues : 10)) + '</strong> ' + soy.$$escapeHtml("JIRA Issues") + '</a>';
    }
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.trigger.issuesTrigger.soyTemplateName = 'jiraIntegration.templates.trigger.issuesTrigger';
}

jiraIntegration.templates.trigger.tooltip = function(opt_data, opt_ignored) {
    var output = '';
    var issueList44 = opt_data.issues;
    var issueListLen44 = issueList44.length;
    for (var issueIndex44 = 0; issueIndex44 < issueListLen44; issueIndex44++) {
        var issueData44 = issueList44[issueIndex44];
        output += (issueIndex44 < 5) ? ((!(issueIndex44 == 0)) ? '\n' : '') + soy.$$escapeHtml(issueData44.key) : '';
    }
    output += (opt_data.issues.length > 5) ? '\n' + soy.$$escapeHtml(AJS.format("and {0} more...", opt_data.issues.length - 5)) : '';
    return output;
}
;
if (goog.DEBUG) {
    jiraIntegration.templates.trigger.tooltip.soyTemplateName = 'jiraIntegration.templates.trigger.tooltip';
}
;;/* module-key = 'com.atlassian.stash.stash-jira-integration:jira-integration-lib', location = '/lib/jira-integration/jira-issues-dialog_AMD.js' */
define("jira-integration/jira-issues-dialog", [], function() {
    return jiraIntegration.JiraIssuesDialog
});
;;/* module-key = 'com.atlassian.stash.stash-jira-integration:jira-integration-lib', location = '/lib/jira-integration/jira-triggers_AMD.js' */
define("jira-integration/jira-triggers", [], function() {
    return jiraIntegration.triggers
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:oauth-util', location = '/static/util/oauth.js' */
define("util/oauth", ["jquery", "util/events"], function(E, B) {
    var A = (function() {
        function I() {
            if (window.aouthWindow && window.aouthWindow.close) {
                window.aouthWindow.close()
            }
            window.oauthCallback = null;
            window.aouthWindow = null
        }
        function H(L, M, K) {
            window.oauthCallback = {
                uri: L,
                success: function() {
                    I();
                    if (M) {
                        M()
                    }
                },
                failure: function() {
                    I();
                    if (K) {
                        K()
                    }
                }
            };
            window.aouthWindow = window.open(L)
        }
        function J(K) {
            if (window.oauthCallback && window.oauthCallback.uri === K) {
                window.oauthCallback.failure()
            }
        }
        return {
            fireRequest: H,
            cancelRequest: J
        }
    }());
    function D(J) {
        var H = new E.Deferred();
        var K = {
            url: J,
            deferred: H,
            api: H.promise({
                abort: function() {
                    A.cancelRequest(J)
                }
            })
        };
        B.trigger("stash.util.oauth.authorizationRequested", null, J);
        H.then(function L() {
            B.trigger("stash.util.oauth.authorizationSucceeded", null, J)
        }, function I() {
            B.trigger("stash.util.oauth.authorizationFailed", null, J)
        });
        A.fireRequest(J, H.resolve, H.reject);
        return K
    }
    var C;
    function G(H) {
        if (C) {
            if (C.url === H) {
                return C.api
            }
            C.api.abort()
        }
        C = D(H);
        var I = C;
        C.deferred.always(function() {
            C = null
        });
        return I.api
    }
    function F(H) {
        E(document).on("click", H, function(J) {
            var I = this.getAttribute("href");
            if (I) {
                G(I);
                J.preventDefault()
            }
        })
    }
    return {
        authorizeUrl: G,
        interceptLinks: F
    }
});
;;/* module-key = 'com.atlassian.stash.stash-jira-integration:jira-issues-dialog', location = '/jira-issues-dialog/stash-jira-issues-dialog.js' */
define("feature/jira/jira-issues-dialog", ["jira-integration/jira-issues-dialog", "jira-integration/jira-triggers", "jquery", "lodash", "util/ajax", "util/events", "util/oauth"], function(a, d, c, f, e, i, h) {
    var g = "jira-ual-authenticate";
    h.interceptLinks("." + g);
    function b(j) {
        f.bindAll(this, "show", "hide", "showDialog", "closeDialog", "destroy");
        j = c.extend({}, this.defaults, j);
        if (j.triggerSelector) {
            this._triggerInfo = d.init({
                selector: j.triggerSelector,
                headerTitleFn: typeof j.headerTitle === "function" ? j.headerTitle : undefined
            }, j);
            this._dialog = this._triggerInfo.getDialog()
        } else {
            this._dialog = new a(j)
        }
        i.on("stash.util.oauth.authorizationSucceeded", this._dialog.onAuthorizationSucceeded)
    }
    b.prototype.defaults = c.extend({}, a.prototype.defaults, {
        oauthTriggerClass: g,
        ajax: function(j) {
            return e.rest(c.extend({
                statusCode: {
                    200: false,
                    500: false
                }
            }, j))
        }
    });
    b.prototype.destroy = function() {
        i.off("stash.util.oauth.authorizationSucceeded", this._dialog.onAuthorizationSucceeded);
        this._dialog.destroy();
        this._dialog = null;
        if (this._triggerInfo) {
            this._triggerInfo.unbind();
            this._triggerInfo = null
        }
    }
    ;
    b.prototype.showDialog = b.prototype.show = function() {
        this._dialog.show()
    }
    ;
    b.prototype.closeDialog = b.prototype.hide = function() {
        this._dialog.hide()
    }
    ;
    b.prototype.setIssueKeys = function(j) {
        this._dialog.setIssueKeys(j)
    }
    ;
    return b
});
;;/* module-key = 'com.atlassian.stash.stash-jira-integration:commit-list-jira-issues', location = '/commits/commits-jira-issues.js' */
define("feature/commits/commits-jira-issues", ["feature/jira/jira-issues-dialog", "exports"], function(c, b) {
    function a(e) {
        var d = new c({
            id: "commits-jira-issues-dialog",
            triggerSelector: e
        })
    }
    b.onReady = function() {
        a(".commits-issues-trigger")
    }
});
jQuery(document).ready(function() {
    require("feature/commits/commits-jira-issues").onReady()
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:create-pull-request', location = '/static/page/pull-request/create/pull-request-create.js' */
define("page/pull-request-create", ["jquery", "feature/compare", "exports"], function(C, B, A) {
    A.onReady = function(I, H, E, D, F) {
        var G = {
            targetRepositoryJson: I,
            sourceRepositoryJson: H,
            tabs: E,
            prCreateMode: true
        };
        if (D) {
            G.submittedReviewers = D
        }
        if (F) {
            G.additionalPreloadRepositories = F
        }
        return B.onReady(C("#branch-compare"), G)
    }
});
;;/* module-key = 'com.atlassian.stash.stash-sourcetree-plugin:sourcetree-button-panel', location = '/static/button-panel/sourcetree-button-panel.soy' */
// This file was automatically generated from sourcetree-button-panel.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.sourceTree.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.sourceTree == 'undefined') {
    stash.sourceTree = {};
}

stash.sourceTree.buttonPanel = function(opt_data, opt_ignored) {
    return '<div class="sourcetree-panel">' + stash.buttons.button({
        buttonText: opt_data.buttonText,
        id: opt_data.buttonId,
        extraClasses: 'sourcetree-button',
        href: opt_data.sourceTreeActionUrl,
        isPrimary: true
    }) + ((opt_data.minVersion) ? '<div class="min-version">' + soy.$$escapeHtml(AJS.format("Requires version {0}+", opt_data.minVersion)) + '</div>' : '') + '<p>' + soy.$$filterNoAutoescape(AJS.format("{0} is the free Git and Mercurial client for Windows or Mac.", '<a href="http://www.sourcetreeapp.com" target="_blank">Atlassian SourceTree</a>')) + '</p></div>';
}
;
if (goog.DEBUG) {
    stash.sourceTree.buttonPanel.soyTemplateName = 'stash.sourceTree.buttonPanel';
}
;;/* module-key = 'com.atlassian.stash.stash-sourcetree-plugin:sourcetree-clone', location = '/static/sourcetree-clone/sourcetree-clone.js' */
define("plugin/sourcetree/sourcetree-clone", ["jquery", "aui", "util/events", "util/navbuilder", "model/page-state", "exports"], function(c, a, i, d, g, b) {
    var e = navigator.platform.indexOf("Mac") !== -1;
    var h = function(l, m) {
        var k = g.getCurrentUser();
        var j = "sourcetree://cloneRepo?type=stash&baseWebUrl=" + encodeURIComponent(window.location.origin + a.contextPath()) + "&cloneUrl=" + encodeURIComponent(m);
        if (k) {
            j = j + "&user=" + encodeURIComponent(k.getName())
        }
        c("#sourcetree-clone-button").attr("href", j)
    };
    var f = function() {
        var k = e ? 1.7 : 1.2;
        var j = "<div class='min-version'>" + AJS.format("Requires SourceTree v{0}+", k) + "</div>";
        c("#sourcetree-clone-button").after(j)
    };
    b.onReady = function() {
        a.$(document).ready(f);
        i.on("stash.feature.repository.clone.protocol.changed", h);
        i.on("stash.feature.repository.clone.protocol.initial", h)
    }
});
require("plugin/sourcetree/sourcetree-clone").onReady();
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:keyboard-shortcuts', location = '/static/widget/keyboard-shortcuts/keyboard-shortcuts.js' */
define("widget/keyboard-shortcuts", ["aui", "jquery", "lodash", "util/events", "util/navigator", "exports"], function(H, D, J, K, F, B) {
    var L = /^[cC]trl$/i
      , I = "\u2318";
    var A = {};
    function G() {
        if (!(this instanceof G)) {
            return new G()
        }
        this._dialog = new H.Dialog({
            width: 830,
            height: 580,
            id: "keyboard-shortcut-dialog",
            closeOnOutsideClick: true
        });
        this._enabledContexts = []
    }
    G.prototype._setRegistry = function(M) {
        this._registry = M
    }
    ;
    G.prototype._initContent = function() {
        this._dialog.addHeader("Keyboard shortcuts");
        this._dialog.addPanel("", stash.widget.keyboardShortcutsContent({
            contextNames: J.keys(A),
            contexts: J.values(A)
        }));
        this._dialog.addCancel("Close", function(M) {
            M.hide()
        })
    }
    ;
    G.prototype._bind = function(M) {
        this._$trigger = M;
        var N = this;
        this._$trigger.on("click", function(O) {
            N._show();
            O.preventDefault()
        })
    }
    ;
    G.prototype.enableContext = function(M) {
        if (D.inArray(M, this._enabledContexts) !== -1) {
            return
        }
        this._registry.enableContext(M);
        this._enabledContexts.push(M)
    }
    ;
    G.prototype.resetContexts = function() {
        H.trigger("remove-bindings.keyboardshortcuts");
        this._enabledContexts = [];
        H.trigger("add-bindings.keyboardshortcuts")
    }
    ;
    G.prototype._show = function() {
        if (!this._hasShown) {
            this._initContent();
            this._hasShown = true
        }
        this._dialog.show();
        this._dialog.updateHeight();
        this._dialog.getCurrentPanel().body.find(".keyboard-shortcut-help").focus()
    }
    ;
    G.prototype.addCustomShortcut = function(N, P, O, Q) {
        var M = C({
            keys: P,
            context: N,
            displayContext: Q,
            description: O
        }, {
            convertOSModifier: false
        })
    }
    ;
    G.convertOSModifier = function(M) {
        return F.isMac() ? M.replace(L, I) : M
    }
    ;
    function C(M, N) {
        M = D.extend({}, M);
        M.keys = J.map(M.keys, function(O) {
            return J.map(O, function(P) {
                if (J.all(["key", "modifiers"], J.partial(J.has, P))) {
                    return P
                }
                var Q = (P.length > 1) ? P.split("+") : P;
                if (!J.isArray(Q) || Q.length === 1) {
                    return P
                }
                return {
                    key: Q.pop(),
                    modifiers: N && N.convertOSModifier === false ? Q : J.map(Q, G.convertOSModifier)
                }
            })
        });
        if (!M.displayContext) {
            M.displayContext = G._contextDisplayInfo[M.context] ? G._contextDisplayInfo[M.context].displayName : M.context.replace(/\b[a-z]/g, function(O) {
                return O.toUpperCase()
            })
        }
        if (!A[M.displayContext]) {
            A[M.displayContext] = []
        }
        A[M.displayContext].push(M)
    }
    G.internalizeShortcuts = function(M) {
        J.each(M, C)
    }
    ;
    G._contextDisplayInfo = {
        repository: {
            displayName: "Within A Repository"
        },
        "branch-compare": {
            displayName: "Branch compare"
        },
        "branch-list": {
            displayName: "Branch list"
        },
        changeset: {
            displayName: "Changeset"
        },
        commits: {
            displayName: "Commit List"
        },
        "diff-tree": {
            displayName: "Changeset"
        },
        "diff-view": {
            displayName: "Diff View"
        },
        filebrowser: {
            displayName: "Directory Browsing"
        },
        global: {
            displayName: "Global"
        },
        "pull-request": {
            displayName: "Within A Pull Request"
        },
        "pull-request-list": {
            displayName: "Pull Request List"
        },
        "pull-request-overview": {
            displayName: "Within A Pull Request"
        },
        sourceview: {
            displayName: "Source View"
        }
    };
    var E = new G();
    B.onReady = function() {
        E._bind(D(".keyboard-shortcut-link"));
        var M = D.Deferred();
        D(document).ready(function() {
            setTimeout(function() {
                M.resolve()
            }, 0)
        });
        H.bind("register-contexts.keyboardshortcuts", function(O, N) {
            E._setRegistry(N.shortcutRegistry);
            E.enableContext("global");
            M.done(function() {
                K.trigger("stash.widget.keyboard-shortcuts.register-contexts", E, E)
            })
        });
        H.bind("shortcuts-loaded.keyboardshortcuts", function(O, N) {
            G.internalizeShortcuts(N.shortcuts)
        });
        H.params["keyboardshortcut-hash"] = "bundled";
        H.trigger("initialize.keyboardshortcuts")
    }
    ;
    B.addTooltip = function(N, P) {
        var M = J(P.split("+")).chain().map(G.convertOSModifier).map(function(Q) {
            if (Q === "shift") {
                return "Shift"
            } else {
                if (Q === "ctrl") {
                    return G.convertOSModifier("Ctrl")
                } else {
                    return Q
                }
            }
        }).value().join(" + ");
        var O = N.attr("title");
        N.attr("title", O + H.format(" (Type \u0027\u0027{0}\u0027\u0027)", M));
        return {
            remove: function() {
                N.attr("title", O)
            }
        }
    }
    ;
    B.showDialog = function() {
        if (E) {
            E._show()
        }
    }
    ;
    B.resetContexts = function() {
        E.resetContexts()
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:keyboard-shortcuts', location = '/static/widget/keyboard-shortcuts/keyboard-shortcuts.soy' */
// This file was automatically generated from keyboard-shortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}

stash.widget.keyboardShortcutsContent = function(opt_data, opt_ignored) {
    var param6 = '';
    var contextNameList7 = opt_data.contextNames;
    var contextNameListLen7 = contextNameList7.length;
    for (var contextNameIndex7 = 0; contextNameIndex7 < contextNameListLen7; contextNameIndex7++) {
        var contextNameData7 = contextNameList7[contextNameIndex7];
        param6 += (contextNameIndex7 % 2 == 0) ? stash.widget.keyboardShortContext({
            contextName: contextNameData7,
            contextShortcuts: opt_data.contexts[contextNameIndex7]
        }) : '';
    }
    var param5 = '' + aui.group.item({
        content: param6
    });
    var param15 = '';
    var contextNameList16 = opt_data.contextNames;
    var contextNameListLen16 = contextNameList16.length;
    for (var contextNameIndex16 = 0; contextNameIndex16 < contextNameListLen16; contextNameIndex16++) {
        var contextNameData16 = contextNameList16[contextNameIndex16];
        param15 += (contextNameIndex16 % 2 == 1) ? stash.widget.keyboardShortContext({
            contextName: contextNameData16,
            contextShortcuts: opt_data.contexts[contextNameIndex16]
        }) : '';
    }
    param5 += aui.group.item({
        content: param15
    });
    var output = '' + aui.group.group({
        extraClasses: 'keyboard-shortcut-help',
        extraAttributes: {
            tabindex: '-1'
        },
        content: param5
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortcutsContent.soyTemplateName = 'stash.widget.keyboardShortcutsContent';
}

stash.widget.keyboardShortContext = function(opt_data, opt_ignored) {
    var output = '<div class="keyboard-shortcut-context"><h3>' + soy.$$escapeHtml(opt_data.contextName) + '</h3><dl>';
    var shortcutList29 = opt_data.contextShortcuts;
    var shortcutListLen29 = shortcutList29.length;
    for (var shortcutIndex29 = 0; shortcutIndex29 < shortcutListLen29; shortcutIndex29++) {
        var shortcutData29 = shortcutList29[shortcutIndex29];
        output += (!shortcutData29.hidden) ? stash.widget.keyboardShortcutItem({
            shortcut: shortcutData29
        }) : '';
    }
    output += '</dl></div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortContext.soyTemplateName = 'stash.widget.keyboardShortContext';
}

stash.widget.keyboardShortcutItem = function(opt_data, opt_ignored) {
    var output = '<dt>' + soy.$$escapeHtml(opt_data.shortcut.description) + '</dt>';
    var optionList40 = opt_data.shortcut.keys;
    var optionListLen40 = optionList40.length;
    for (var optionIndex40 = 0; optionIndex40 < optionListLen40; optionIndex40++) {
        var optionData40 = optionList40[optionIndex40];
        output += ((!(optionIndex40 == 0) && !(optionIndex40 == optionListLen40 - 1)) ? '<dd class=\'separator\'>' + soy.$$escapeHtml(",") + '</dd>' : '') + ((!(optionIndex40 == 0) && optionIndex40 == optionListLen40 - 1) ? '<dd class=\'separator\'>' + soy.$$escapeHtml(" or") + '</dd>' : '') + '<dd>' + stash.widget.keyboardShortcutOption({
            sequence: optionData40
        }) + '</dd>';
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortcutItem.soyTemplateName = 'stash.widget.keyboardShortcutItem';
}

stash.widget.keyboardShortcutOption = function(opt_data, opt_ignored) {
    var output = '';
    var keypressList57 = opt_data.sequence;
    var keypressListLen57 = keypressList57.length;
    for (var keypressIndex57 = 0; keypressIndex57 < keypressListLen57; keypressIndex57++) {
        var keypressData57 = keypressList57[keypressIndex57];
        output += ((!(keypressIndex57 == 0)) ? ' ' + soy.$$escapeHtml("then") + ' ' : '') + ((keypressData57.modifiers) ? stash.widget.keyboardShortcutModifier({
            keypress: keypressData57
        }) : stash.widget.keyboardShortcutKey({
            key: keypressData57
        }));
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortcutOption.soyTemplateName = 'stash.widget.keyboardShortcutOption';
}

stash.widget.keyboardShortcutModifier = function(opt_data, opt_ignored) {
    var output = '';
    var modifierList72 = opt_data.keypress.modifiers;
    var modifierListLen72 = modifierList72.length;
    for (var modifierIndex72 = 0; modifierIndex72 < modifierListLen72; modifierIndex72++) {
        var modifierData72 = modifierList72[modifierIndex72];
        output += stash.widget.keyboardShortcutKey({
            key: modifierData72
        });
    }
    output += stash.widget.keyboardShortcutKey({
        key: opt_data.keypress.key
    });
    return output;
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortcutModifier.soyTemplateName = 'stash.widget.keyboardShortcutModifier';
}

stash.widget.keyboardShortcutKey = function(opt_data, opt_ignored) {
    return '<kbd>' + soy.$$escapeHtml(opt_data.key) + '</kbd>';
}
;
if (goog.DEBUG) {
    stash.widget.keyboardShortcutKey.soyTemplateName = 'stash.widget.keyboardShortcutKey';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-item', location = '/static/feature/repository/repository-item/repository-item.soy' */
// This file was automatically generated from repository-item.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.repositoryItem = function(opt_data, opt_ignored) {
    return '<span class="repository-item" title="' + soy.$$escapeHtml(opt_data.repository.project.name) + ' / ' + soy.$$escapeHtml(opt_data.repository.name) + '" data-id="' + soy.$$escapeHtml(opt_data.repository.id) + '" data-repository="' + soy.$$escapeHtml(JSON.stringify(opt_data.repository).replace(/\//g, '\\/')) + '">' + stash.feature.repository.repositoryItemContent({
        avatarTagName: 'span',
        repository: opt_data.repository
    }) + '</span>';
}
;
if (goog.DEBUG) {
    stash.feature.repository.repositoryItem.soyTemplateName = 'stash.feature.repository.repositoryItem';
}

stash.feature.repository.repositoryItemContent = function(opt_data, opt_ignored) {
    return stash.feature.project.avatar({
        size: 'xsmall',
        project: opt_data.repository.project,
        tagName: opt_data.avatarTagName
    }) + '<span class="project-and-repository"><span class="project-name">' + ((opt_data.projectNameContent) ? soy.$$filterNoAutoescape(opt_data.projectNameContent) : soy.$$escapeHtml(opt_data.repository.project.name)) + '</span><span class="separator">/</span><span class="name">' + ((opt_data.repositoryNameContent) ? soy.$$filterNoAutoescape(opt_data.repositoryNameContent) : soy.$$escapeHtml(opt_data.repository.name)) + '</span></span>';
}
;
if (goog.DEBUG) {
    stash.feature.repository.repositoryItemContent.soyTemplateName = 'stash.feature.repository.repositoryItemContent';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:internal-regexp-util', location = '/static/bower/atlassian-regexp/lib/internal/util/regexp.js' */
define("internal/util/regexp", ["exports"], function(A) {
    function B(C) {
        return C.replace(/[\-\[\]{}()+?.,\\\^$|#\s]/g, "\\$&")
    }
    A.escape = B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:internal-highlight-text-util', location = '/static/bower/atlassian-highlight-text/lib/internal/util/highlight-text.js' */
define("internal/util/highlight-text", ["internal/util/regexp"], function(D) {
    var C = /[&"'<>`]/g;
    var E = function(G) {
        var F = {
            "<": "&lt;",
            ">": "&gt;",
            "&": "&amp;",
            "'": "&#39;",
            "`": "&#96;"
        };
        if (F.hasOwnProperty(G)) {
            return F[G]
        }
        return "&quot;"
    };
    var A = function(F) {
        return F.replace(C, E)
    };
    var B = function(F) {
        return D.escape(A(F))
    };
    return {
        highlight: function(K, H, G) {
            if (!H || H.length === 0) {
                return A(K)
            }
            var J = (typeof H === "string") ? B(H) : H.map(B).join("|");
            var F = (G == null) ? "gi" : G;
            var I = new RegExp(J,F);
            return A(K).replace(I, "<mark>$&</mark>")
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:highlight-text-util', location = '/static/util/highlight-text.js' */
define("util/highlight-text", ["internal/util/highlight-text"], function(A) {
    return A
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-menu-items', location = '/static/feature/repository/menu-items/repository-menu-items.soy' */
// This file was automatically generated from repository-menu-items.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.menuItems = function(opt_data, opt_ignored) {
    var output = '';
    var repoList3 = opt_data.repos;
    var repoListLen3 = repoList3.length;
    for (var repoIndex3 = 0; repoIndex3 < repoListLen3; repoIndex3++) {
        var repoData3 = repoList3[repoIndex3];
        output += '<li class="repository-item repository-menu-item' + ((opt_data.extraClasses) ? ' ' + soy.$$escapeHtml(opt_data.extraClasses) : '') + '"><a data-proj-key="' + soy.$$escapeHtml(repoData3.project.key) + '" data-repo-slug="' + soy.$$escapeHtml(repoData3.slug) + '" data-repo-id="' + soy.$$escapeHtml(repoData3.id) + '" href="' + soy.$$escapeHtml(require('stash/api/util/navbuilder').project(repoData3.project.key).repo(repoData3.slug).browse().build()) + '" title="' + soy.$$escapeHtml(AJS.format("Go to repository \x22{0}\x22 in project \x22{1}\x22", repoData3.name, repoData3.project.name)) + '">' + stash.feature.repository.repositoryItemContent({
            repository: repoData3,
            projectNameContent: require('util/highlight-text').highlight(repoData3.project.name, opt_data.projectHighlightText, 'i'),
            repositoryNameContent: require('util/highlight-text').highlight(repoData3.name, opt_data.repositoryHighlightText, 'i')
        }) + '</a></li>';
    }
    return output;
}
;
if (goog.DEBUG) {
    stash.feature.repository.menuItems.soyTemplateName = 'stash.feature.repository.menuItems';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-search', location = '/static/feature/repository/repository-search/repository-search.soy' */
// This file was automatically generated from repository-search.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.repositorySearch = function(opt_data, opt_ignored) {
    return '<form class="aui-quicksearch"><div class="repository-search-trigger"><label class="assistive" for="repository-search">' + soy.$$escapeHtml("Find a repository...") + '</label><input id="repository-search" type="text" autocomplete="off" placeholder="' + soy.$$escapeHtml("Find a repository...") + '"/><div class="spinner"></div></div></form>';
}
;
if (goog.DEBUG) {
    stash.feature.repository.repositorySearch.soyTemplateName = 'stash.feature.repository.repositorySearch';
}

stash.feature.repository.repositorySearchResults = function(opt_data, opt_ignored) {
    return '' + ((!(opt_data.isPreload && opt_data.size == 0)) ? '<div class="results-section' + ((opt_data.isPreload) ? ' recently-viewed' : '') + '">' + stash.feature.repository.menuItems({
        repos: opt_data.values,
        extraClasses: 'result',
        projectHighlightText: opt_data.projectSearchTerm,
        repositoryHighlightText: opt_data.repositorySearchTerm
    }) + ((opt_data.isLastPage) ? (opt_data.size > 0) ? '<li class="no-results">' + soy.$$escapeHtml(opt_data.noMoreResultsText) + '</li>' : '<li class="no-results">' + soy.$$escapeHtml(opt_data.noResultsText) + '</li>' : '') + '</div>' : '');
}
;
if (goog.DEBUG) {
    stash.feature.repository.repositorySearchResults.soyTemplateName = 'stash.feature.repository.repositorySearchResults';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-search', location = '/static/feature/repository/repository-search/repository-search.js' */
define("feature/repository/repository-search", ["aui", "jquery", "lodash", "xregexp", "stash/api/util/navbuilder", "util/events", "widget/searchable-selector"], function(F, B, G, E, A, I, D) {
    var C = null;
    I.on("stash.feature.repositories.recent.loaded", function(J) {
        C = J
    });
    var H = function(M, K, J) {
        J = J || {};
        J.externalSearchField = M;
        var L = this.init(K, J);
        L._bindSearchFieldEvents();
        L.dialog.on("click", "a", function() {
            I.trigger("internal.stash.ui.nav.search.result.clicked", null, {
                repositoryId: B(this).attr("data-repo-id")
            })
        });
        return L
    };
    B.extend(H.prototype, D.prototype);
    H.prototype._generatePreloadData = function() {
        if (C == null) {
            return null
        }
        var J;
        var L = this._parseSearchTerm(this._getSearchTerm());
        if (L) {
            var M = L.projectName && new RegExp("^" + E.escape(L.projectName),"i");
            var K = L.repositoryName && new RegExp("^" + E.escape(L.repositoryName),"i");
            J = G.filter(C.values, function(N) {
                return (L.projectName == null || N.project.name.match(M) != null) && (L.repositoryName == null || N.name.match(K) != null)
            })
        } else {
            J = C.values
        }
        J.sort(function(O, N) {
            return (L && L.projectName ? O.project.name.localeCompare(N.project.name) : 0) || O.name.localeCompare(N.name) || O.id - N.id
        });
        return G.extend({}, C, {
            values: J,
            size: J.length,
            isLastPage: false
        })
    }
    ;
    H.prototype.defaults = B.extend({}, D.prototype.defaults, {
        extraClasses: "repository-search-dialog",
        url: A.rest().allRepos().withParams({
            avatarSize: stash.widget.avatarSizeInPx({
                size: "xsmall"
            })
        }).build(),
        queryParamsBuilder: function(K, M, J) {
            var L = this._parseSearchTerm(K);
            if (L == null) {
                return null
            }
            return {
                start: M,
                limit: J,
                name: L.repositoryName,
                projectname: L.projectName
            }
        },
        dataTransform: function(L, J) {
            var K = this._parseSearchTerm(J);
            if (K == null) {
                return L
            }
            return B.extend({
                repositorySearchTerm: K.repositoryName,
                projectSearchTerm: K.projectName
            }, L)
        },
        preloadData: H.prototype._generatePreloadData,
        alwaysShowPreload: true,
        followLinks: true,
        resultsTemplate: stash.feature.repository.repositorySearchResults,
        noResultsText: "No repositories matching your search",
        noMoreResultsText: "No more repositories",
        adjacentItems: false,
        clearResultsOnSearch: false,
        popUpOffsetY: 1,
        paginationContext: "repository-search"
    });
    H.prototype._bindSearchFieldEvents = function() {
        var J = this;
        this.$searchField.on("keydown.repository-search", function(K) {
            if (K.which === F.keyCode.ENTER) {
                K.preventDefault()
            }
        });
        this.$searchField.on("keyup.repository-search", function(K) {
            var L = J.dialog.is(":visible");
            if (!L && K.which === F.keyCode.ESCAPE) {
                B(this).blur()
            }
        });
        this.$searchField.on("focus", function() {
            I.trigger("internal.stash.ui.nav.search.focused")
        })
    }
    ;
    H.prototype._parseSearchTerm = function(J) {
        J = B.trim(J);
        if (J === "" || J === "/") {
            return null
        }
        var L = {};
        var K = J.lastIndexOf("/");
        if (K === -1) {
            L.projectName = null;
            L.repositoryName = J
        } else {
            L.projectName = B.trim(J.substr(0, K));
            L.repositoryName = B.trim(J.substr(K + 1))
        }
        return L
    }
    ;
    H.prototype._showSpinner = function(J) {
        J.$scrollElement.find(".spinner").hide();
        this.$searchField.closest(".aui-quicksearch").addClass("loading");
        this.$searchField.next(".spinner").spin()
    }
    ;
    H.prototype._hideSpinner = function() {
        this.$searchField.closest(".aui-quicksearch").removeClass("loading");
        this.$searchField.next(".spinner").spinStop()
    }
    ;
    return H
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:base-layout', location = '/static/layout/base/base.js' */
define("layout/base", ["aui", "jquery", "lodash", "memoir", "stash/api/util/navbuilder", "util/analytics", "util/client-storage", "util/events", "model/page-state", "model/stash-user", "widget/aui/dropdown", "widget/aui/form", "feature/repository/repository-search", "exports"], function(J, F, Q, M, I, H, K, C, L, N, P, D, A, R) {
    if (location.search) {
        var G = I.parse(location.href)
          , B = G.getQueryParamValue("eve");
        B && C.on(B, function() {
            console.log([C.name()], this, arguments)
        })
    }
    function O(S) {
        if (S) {
            S.isAdmin = !!F("#header").find("a.admin-link").length;
            L.setCurrentUser(new N(S))
        }
    }
    function E(S) {
        if (!K.getSessionItem(S)) {
            K.setSessionItem(S, true);
            H.add("demographics", {
                d_lang: document.documentElement.lang
            }, true)
        }
    }
    R.onReady = function(V, T) {
        O(V);
        P.onReady();
        D.onReady();
        J.params["build-number"] = encodeURIComponent(F("#product-version").attr("data-system-build-number"));
        var W = F(window);
        var U = Q.debounce(function() {
            C.trigger("window.resize.debounced", W, W.width(), W.height())
        }, 200);
        W.on("resize", U);
        var X = Q.throttle(function() {
            C.trigger("window.scroll.throttled", W, W.scrollTop())
        }, 25);
        W.on("scroll", X);
        var S = F("#repository-search");
        new A(S,S.closest(".repository-search-trigger"));
        M.setTitleSuffix(" - " + T);
        E(K.buildKey("demographic-analytics", "user"))
    }
    ;
    C.on("memoir.changestate", function(T) {
        var S = F("#login-link");
        if (S.length && T.state) {
            S.attr("href", I.login().next().build())
        }
        F("body").children(".tipsy").remove()
    })
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:quick-copy-text', location = '/static/widget/quick-copy-text.js' */
define("widget/quick-copy-text", ["jquery", "exports"], function(B, A) {
    var C = true;
    A.onReady = function() {
        if (C) {
            C = false;
            B(document).on("click", ".quick-copy-text", function(D) {
                this.focus();
                this.select()
            })
        }
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:browser-location', location = '/static/util/browser-location.js' */
define("util/browser-location", ["exports"], function(A) {
    A.location = window.location
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:sticky-branches', location = '/static/feature/repository/sticky-branches.js' */
define("feature/repository/sticky-branches", ["jquery", "stash/api/util/navbuilder", "util/browser-location", "util/client-storage", "util/events", "util/text", "exports"], function(E, A, B, C, L, F, D) {
    var I;
    var J;
    var K;
    D.onReady = function() {
        var P = A.parse(B.location.href)
          , S = A.currentRepo().browse().build()
          , T = A.currentRepo().commits().build()
          , O = P.path().indexOf(S) === 0
          , U = P.path() === T
          , X = O ? P.getQueryParamValue("at") : U ? P.getQueryParamValue("until") : undefined
          , M = O || U
          , W = C.buildKey("current-branch", "repo")
          , V = C.getSessionItem(W);
        I = E("#repository-nav-files");
        J = E("#repository-nav-commits");
        K = E("#repository-nav-branches");
        var Q;
        if (X && O) {
            var R = E("[data-revision-ref]", "#repository-layout-revision-selector").data("revision-ref");
            Q = R && ((R.id === X && R.type.id === "commit") || (R.id !== X && (R.type.id === "branch" || R.type.id === "tag") && /^[0-9a-f]{7,40}$/.test(X)))
        }
        var N = !(O && Q);
        if (X && N) {
            X = decodeURIComponent(X);
            if (X !== V) {
                C.setSessionItem(W, X)
            }
            H(X)
        } else {
            if (M && N) {
                C.removeSessionItem(W)
            } else {
                if (V) {
                    H(V)
                }
            }
        }
        L.on("stash.layout.branch.revisionRefChanged", function(Y) {
            if (Y) {
                if (!Y.getIsDefault()) {
                    var Z = Y.getId();
                    H(Z);
                    C.setSessionItem(W, Z)
                } else {
                    G();
                    C.removeSessionItem(W)
                }
            }
        });
        L.on("stash.*.*.revisionRefRemoved", function(Z) {
            var Y = C.getSessionItem(W);
            if (Y && F.endsWith(Z.id, Y)) {
                G();
                C.removeSessionItem(W)
            }
        })
    }
    ;
    function H(M) {
        if (M) {
            M = encodeURIComponent(M);
            I.attr("href", A.parse(I.attr("href")).replaceQueryParam("at", M));
            J.attr("href", A.parse(J.attr("href")).replaceQueryParam("until", M));
            K.attr("href", A.parse(K.attr("href")).replaceQueryParam("base", M))
        } else {
            G()
        }
    }
    function G() {
        I.attr("href", A.parse(I.attr("href")).deleteQueryParam("at"));
        J.attr("href", A.parse(J.attr("href")).deleteQueryParam("until"));
        K.attr("href", A.parse(K.attr("href")).deleteQueryParam("base"))
    }
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-public-lozenge', location = '/static/feature/repository/public-lozenge/public-lozenge.soy' */
// This file was automatically generated from public-lozenge.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.feature.repository.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.feature == 'undefined') {
    stash.feature = {};
}
if (typeof stash.feature.repository == 'undefined') {
    stash.feature.repository = {};
}

stash.feature.repository.publicLozenge = function(opt_data, opt_ignored) {
    return '' + ((false && (opt_data.repository['public'] || opt_data.repository.project['public'])) ? '<div class="public-lozenge aui-lozenge aui-lozenge-subtle">' + soy.$$escapeHtml("Public") + '</div>' : '');
}
;
if (goog.DEBUG) {
    stash.feature.repository.publicLozenge.soyTemplateName = 'stash.feature.repository.publicLozenge';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:sidebar', location = '/static/widget/sidebar/sidebar.js' */
define("widget/sidebar", ["aui", "chaperone", "jquery", "util/client-storage", "util/events", "exports"], function(N, E, J, G, O, H) {
    var M = "sidebar_expanded";
    var D = ".aui-sidebar";
    var A;
    function B() {
        A = N.sidebar(D);
        A.on("collapse-end", function() {
            G.setItem(M, false);
            O.trigger("stash.feature.sidebar.collapseEnd")
        });
        A.on("expand-end", function() {
            G.setItem(M, true);
            O.trigger("stash.feature.sidebar.expandEnd")
        });
        L();
        C()
    }
    function L() {
        var P = !I();
        A.on("expand", function() {
            P = true
        });
        A.on("collapse", function() {
            P = false
        });
        E.registerFeature("sidebar", [{
            id: "sidebar-discovery",
            selector: ".aui-sidebar[aria-expanded=false] .aui-page-header, .aui-sidebar[aria-expanded=true] .aui-sidebar-group:first-child",
            title: "Improvements to navigation in Stash",
            content: stash.widget.sidebar.discoveryContent(),
            moreInfo: {
                href: "http://go.atlassian.com/stashsidebar"
            },
            gravity: "w",
            width: 350,
            offsetX: function() {
                return P ? -10 : 10
            },
            once: true
        }]);
        A.on("expand", E.checkFeatureAlignment);
        A.on("collapse", E.checkFeatureAlignment);
        A.on("expand-end", E.checkFeatureAlignment);
        A.on("collapse-end", E.checkFeatureAlignment)
    }
    function K() {
        var P = I();
        J(document.body).toggleClass("aui-sidebar-collapsed", P);
        J(D).attr("aria-expanded", !P)
    }
    function I() {
        return !G.getItem(M)
    }
    function C() {
        A.$el.on("mouseenter", ".aui-sidebar-group-actions", function(P) {
            if (I()) {
                O.trigger("internal.stash.ui.sidebar.actions-menu.open")
            }
        });
        A.$el.find(".aui-sidebar-group-actions ul").on("click", "> li > a[data-web-item-key]", function() {
            O.trigger("internal.stash.ui.sidebar.actions-menu.item.clicked", null, {
                isCollapsed: I(),
                webItemId: J(this).attr("data-web-item-key")
            })
        });
        A.$el.find(".sidebar-navigation ul").on("click", "> li > a[data-web-item-key]", function() {
            var R = J(this);
            var P = !G.getItem(M);
            var Q = R.parentsUntil(".aui-sidebar-group").filter("ul").length;
            O.trigger("internal.stash.ui.sidebar.item.clicked", null, {
                webItemId: R.attr("data-web-item-key"),
                isCollapsed: P,
                level: Q
            })
        });
        A.$el.find(".sidebar-settings-group").on("click", "a", function() {
            O.trigger("internal.stash.ui.sidebar.settings.clicked", null, {
                webItemId: J(this).attr("data-web-item-key")
            })
        });
        A.$el.on("click", ".aui-sidebar-toggle", function(P) {
            F("button")
        });
        A.$el.on("click", ".aui-sidebar-body", function(P) {
            if (J(P.target).is(".aui-sidebar-body")) {
                F("sidebar")
            }
        });
        N.whenIType("[").execute(function() {
            F("keyboard-shortcut")
        })
    }
    function F(P) {
        O.trigger("internal.stash.ui.sidebar.collapse.change", null, {
            source: P,
            isCollapsed: I(),
            windowWidth: window.innerWidth
        })
    }
    H.preload = K;
    H.onReady = B
});
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:sidebar', location = '/static/widget/sidebar/sidebar.soy' */
// This file was automatically generated from sidebar.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.widget.sidebar.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.widget == 'undefined') {
    stash.widget = {};
}
if (typeof stash.widget.sidebar == 'undefined') {
    stash.widget.sidebar = {};
}

stash.widget.sidebar.discoveryContent = function(opt_data, opt_ignored) {
    return '<ul><li>' + soy.$$escapeHtml("Actions and navigation in one place") + '</li><li>' + soy.$$escapeHtml("Always visible for faster access") + '</li><li>' + soy.$$filterNoAutoescape(AJS.format("Collapse the sidebar with {0}[{1} when you need more space", '<kbd>', '</kbd>')) + '</li></ul>';
}
;
if (goog.DEBUG) {
    stash.widget.sidebar.discoveryContent.soyTemplateName = 'stash.widget.sidebar.discoveryContent';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:repository-layout', location = '/static/layout/repository/repository.js' */
define("layout/repository", ["aui", "jquery", "lodash", "stash/api/util/navbuilder", "util/events", "model/page-state", "model/repository", "widget/quick-copy-text", "widget/sidebar", "feature/repository/sticky-branches", "exports"], function(J, H, S, I, C, L, G, F, M, R, T) {
    function O(V) {
        var U = new G(V);
        L.setRepository(U);
        L.setProject(U.getProject());
        H(".aui-page-header-image > a").on("click", function() {
            C.trigger("stash.sidebar.clickAvatar.expanded." + H(".aui-sidebar").attr("aria-expanded"), null)
        })
    }
    function B() {
        return H(".clone-url")
    }
    function E() {
        return H(".repository-protocol")
    }
    function D() {
        var b = B(), W = b.find("input"), Z = E(), V = H("#" + Z.attr("aria-controls")), Y = V.find("li"), a, U, X = "";
        if (Z.is("button")) {
            N(Z, Z.text());
            a = Z.attr("data-clone-url");
            U = Z.attr("data-module-key")
        } else {
            N(Z, Y.first().children("a").text());
            a = Y.first().attr("data-clone-url");
            U = Y.first().attr("data-module-key")
        }
        W.val(a);
        b.addClass(U);
        X = U;
        Y.on("click", function(c) {
            var d = H(this);
            N(Z, d.text());
            W.val(d.attr("data-clone-url")).select();
            U = d.attr("data-module-key");
            b.removeClass(X).addClass(U);
            X = U;
            C.trigger("stash.feature.repository.clone.protocol.changed", null, U, d.attr("data-clone-url"));
            c.stopPropagation();
            if (V.is(":visible")) {
                Z.trigger("aui-button-invoke")
            }
            c.preventDefault()
        });
        C.trigger("stash.feature.repository.clone.protocol.initial", null, U, a)
    }
    function N(V, W) {
        var U = V.children("span").remove();
        V.text(W).append(U)
    }
    function K(V, Z) {
        var U = H(Z);
        var Y = null;
        var X = null;
        var W = J.InlineDialog(null, "clone-repo-dialog", function(b, a, c) {
            b.append(U);
            c();
            S.defer(function() {
                U.find(".clone-url input").select()
            })
        }, {
            noBind: true,
            width: 360,
            gravity: "w",
            hideCallback: function() {
                var b = E()
                  , a = H("#" + b.attr("aria-controls"));
                if (a.is(":visible")) {
                    b.trigger("aui-button-invoke")
                }
            },
            calculatePositions: function() {
                if (Y === null && X === null) {
                    return J.InlineDialog.opts.calculatePositions.apply(this, arguments)
                } else {
                    return {
                        gravity: "w",
                        popupCss: Y,
                        arrowCss: X
                    }
                }
            }
        });
        H(document).on("click", V, function(c) {
            c.preventDefault();
            var a = H(".aui-sidebar-submenu-dialog");
            if (H(c.target).closest(".aui-sidebar").length === 0) {
                var b = a.find(".aui-inline-dialog-contents");
                Y = b.offset();
                X = {
                    top: 6,
                    left: 0
                }
            } else {
                Y = null;
                X = null
            }
            W.show(c, this);
            a[0].hide()
        });
        H(document).keyup(function(a) {
            if (a.keyCode === J.keyCode.ESCAPE) {
                W.hide()
            }
        });
        U.find("a.sourcetree-clone-button").on("click", function() {
            W.hide()
        })
    }
    function Q() {
        var U = H(".aui-page-header-actions .create-pull-request");
        C.on("stash.layout.branch.revisionRefChanged", function(W) {
            var V = I.currentRepo().createPullRequest();
            if (!W.isDefault() && W.isBranch()) {
                V = V.sourceBranch(W.getId())
            }
            U.attr("href", V.build())
        })
    }
    function A() {
        H(".repository-badge .badge").tooltip({
            gravity: "n"
        })
    }
    function P() {
        var U = H(".aui-sidebar[aria-expanded=false] .aui-page-header-image");
        U.tooltip({
            gravity: "w",
            delayIn: 0,
            live: true,
            html: true,
            aria: true,
            className: "aui-sidebar-section-tooltip",
            title: function() {
                return H(this).find(".aui-avatar").attr("data-tooltip")
            }
        })
    }
    T.onReady = function(W, U, V) {
        O(W);
        D();
        F.onReady();
        H(document).ready(M.onReady);
        R.onReady();
        K(U, V);
        Q();
        A();
        P();
        C.on("stash.widget.keyboard-shortcuts.register-contexts", function(X) {
            X.enableContext("repository")
        })
    }
});
;;/* module-key = 'com.atlassian.stash.plugin.stash-archive:archive-resources', location = '/static/archive.js' */
define("plugin/download-archive", ["jquery", "aui", "model/page-state", "util/navbuilder", "exports"], function(d, b, c, e, a) {
    a.onReady = function(g) {
        var i = d(g);
        var h = function(j) {
            i.attr("href", b.contextPath() + "/plugins/servlet/archive/projects/" + encodeURIComponent(c.getProject().getKey()) + "/repos/" + encodeURIComponent(c.getRepository().getSlug()) + (j ? "?at=" + encodeURIComponent(j) : ""))
        };
        var f = c.getRevisionRef() ? c.getRevisionRef().id : null;
        h(f);
        eve.on("stash.feature.repository.revisionReferenceSelector.revisionRefChanged", function(j, k) {
            h(j.id)
        })
    }
});
AJS.$(function() {
    require("plugin/download-archive").onReady("#download-archive-button")
});
;;/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/store-1.3.1.js' */
(function() {
    var l = {}, h = window, k = h.document, c = "localStorage", n = "globalStorage", d = "__storejs__", g;
    l.disabled = false;
    l.set = function(e, o) {}
    ;
    l.get = function(e) {}
    ;
    l.remove = function(e) {}
    ;
    l.clear = function() {}
    ;
    l.transact = function(e, o) {
        var p = l.get(e);
        if (typeof p == "undefined") {
            p = {}
        }
        o(p);
        l.set(e, p)
    }
    ;
    l.serialize = function(e) {
        return JSON.stringify(e)
    }
    ;
    l.deserialize = function(e) {
        if (typeof e != "string") {
            return undefined
        }
        return JSON.parse(e)
    }
    ;
    function b() {
        try {
            return ( c in h && h[c])
        } catch (e) {
            return false
        }
    }
    function m() {
        try {
            return ( n in h && h[n] && h[n][h.location.hostname])
        } catch (e) {
            return false
        }
    }
    if (b()) {
        g = h[c];
        l.set = function(e, o) {
            if (o === undefined) {
                return l.remove(e)
            }
            g.setItem(e, l.serialize(o))
        }
        ;
        l.get = function(e) {
            return l.deserialize(g.getItem(e))
        }
        ;
        l.remove = function(e) {
            g.removeItem(e)
        }
        ;
        l.clear = function() {
            g.clear()
        }
    } else {
        if (m()) {
            g = h[n][h.location.hostname];
            l.set = function(e, o) {
                if (o === undefined) {
                    return l.remove(e)
                }
                g[e] = l.serialize(o)
            }
            ;
            l.get = function(e) {
                return l.deserialize(g[e] && g[e].value)
            }
            ;
            l.remove = function(e) {
                delete g[e]
            }
            ;
            l.clear = function() {
                for (var e in g) {
                    delete g[e]
                }
            }
        } else {
            if (k.documentElement.addBehavior) {
                var j, f;
                try {
                    f = new ActiveXObject("htmlfile");
                    f.open();
                    f.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></frame>');
                    f.close();
                    j = f.w.frames[0].document;
                    g = j.createElement("div")
                } catch (i) {
                    g = k.createElement("div");
                    j = k.body
                }
                function a(e) {
                    return function() {
                        var p = Array.prototype.slice.call(arguments, 0);
                        p.unshift(g);
                        j.appendChild(g);
                        g.addBehavior("#default#userData");
                        g.load(c);
                        var o = e.apply(l, p);
                        j.removeChild(g);
                        return o
                    }
                }
                l.set = a(function(p, e, o) {
                    if (o === undefined) {
                        return l.remove(e)
                    }
                    p.setAttribute(e, l.serialize(o));
                    p.save(c)
                });
                l.get = a(function(o, e) {
                    return l.deserialize(o.getAttribute(e))
                });
                l.remove = a(function(o, e) {
                    o.removeAttribute(e);
                    o.save(c)
                });
                l.clear = a(function(q) {
                    var o = q.XMLDocument.documentElement.attributes;
                    q.load(c);
                    for (var p = 0, e; e = o[p]; p++) {
                        q.removeAttribute(e.name)
                    }
                    q.save(c)
                })
            }
        }
    }
    try {
        l.set(d, d);
        if (l.get(d) != d) {
            l.disabled = true
        }
        l.remove(d)
    } catch (i) {
        l.disabled = true
    }
    if (typeof module != "undefined") {
        module.exports = l
    } else {
        if (typeof define === "function" && define.amd) {
            define(l)
        } else {
            this.store = l
        }
    }
})();
;;/* module-key = 'com.atlassian.analytics.analytics-client:js-events', location = 'js/atlassian-analytics.js' */
(function(b) {
    var m = AJS.$.ajax;
    var h = "atlassian-analytics";
    var g = typeof AJS.contextPath == "function" ? AJS.contextPath() : typeof AJS.Confluence != "undefined" ? AJS.Confluence.getContextPath() : window.contextPath != null ? window.contextPath : "";
    var l = null;
    var i = null;
    var d = null;
    var n = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(u) {
        var t = Math.random() * 16 | 0
          , s = u == "x" ? t : (t & 3 | 8);
        return s.toString(16)
    });
    var p = function() {
        var s = "unknown";
        if (document.body.id == "jira") {
            s = "jira"
        } else {
            if (document.body.id == "com-atlassian-confluence") {
                s = "confluence"
            }
        }
        i = h + "." + s;
        d = i + ".lock"
    };
    var c = function() {
        if (store.get(d)) {
            return false
        }
        store.set(d, n);
        return ( store.get(d) === n)
    };
    var q = function() {
        store.set(d, null)
    };
    var f = function() {
        var t = [], v, w, s, u;
        if (AJS.EventQueue.length == 0) {
            return
        }
        t = store.get(i) || t;
        for (s = 0,
        u = AJS.EventQueue.length; s < u; ++s) {
            w = AJS.EventQueue[s];
            if (w.name) {
                v = {
                    name: w.name,
                    properties: w.properties,
                    time: w.time || 0
                };
                t.push(v)
            }
        }
        AJS.EventQueue.length = 0;
        store.set(i, t)
    };
    var e = function() {
        var t;
        if (!c()) {
            return
        }
        f();
        t = store.get(i);
        if (t && t.length) {
            store.remove(i);
            q();
            if (k(t)) {
                var u = new Date().getTime();
                for (var s = 0; s < t.length; s++) {
                    if (t[s].time > 0) {
                        t[s].timeDelta = t[s].time - u
                    } else {
                        t[s].timeDelta = s - t.length
                    }
                    delete t[s].time
                }
                l = m({
                    type: "POST",
                    url: g + "/rest/analytics/1.0/publish/bulk",
                    data: JSON.stringify(t),
                    contentType: "application/json",
                    dataType: "json"
                });
                l.fail(function() {
                    AJS.EventQueue.concat(t);
                    f()
                })
            }
        } else {
            q()
        }
    };
    var k = function(u) {
        for (var t = u.length - 1; t >= 0; t--) {
            var w = "";
            var v = u[t];
            var s = v.properties;
            if (typeof v.name === "undefined") {
                w = "you must provide a name for the event."
            } else {
                if (typeof s !== "undefined" && s !== null) {
                    if (s.constructor !== Object) {
                        w = "properties must be an object with key value pairs."
                    } else {
                        a(s)
                    }
                }
            }
            if (w !== "") {
                AJS.log("WARN: Invalid analytics event detected and ignored, " + w + "\nEvent: " + JSON.stringify(v));
                u.splice(t, 1)
            }
        }
        return u.length
    };
    var a = function(u) {
        for (var t in u) {
            if (u.hasOwnProperty(t)) {
                var s = u[t];
                if (typeof s !== "undefined" && s !== null && s.toString) {
                    u[t] = s.toString()
                } else {
                    u[t] = ""
                }
            }
        }
    };
    var j = function() {
        if (l && !(l.state() === "resolved" || l.state() === "rejected")) {
            l.abort()
        }
    };
    AJS.EventQueue = AJS.EventQueue || [];
    var o = Array.prototype.push;
    AJS.EventQueue.push = function(s) {
        s.time = new Date().getTime();
        o.call(AJS.EventQueue, s)
    }
    ;
    AJS.toInit(function() {
        p();
        setTimeout(e, 500);
        setInterval(e, 5000);
        r()
    });
    b(window).unload(function() {
        j();
        f()
    });
    AJS.Analytics = {
        triggerPrivacyPolicySafeEvent: function(s, t) {
            AJS.log("WARN: 'triggerPrivacyPolicySafeEvent' has been deprecated");
            AJS.EventQueue.push({
                name: s,
                properties: t
            })
        }
    };
    AJS.bind("analytics", function(s, t) {
        AJS.EventQueue.push({
            name: t.name,
            properties: t.data
        })
    });
    AJS.bind("analyticsEvent", function(s, t) {
        AJS.EventQueue.push({
            name: t.name,
            properties: t.data
        })
    });
    var r = function() {
        if (window.location.pathname.indexOf("/secure/admin/ViewApplicationProperties") > -1) {
            AJS.$("[data-property-id='analytics-enabled']").remove()
        } else {
            if (window.location.pathname.indexOf("/secure/admin/EditApplicationProperties") > -1) {
                var t = AJS.$(":contains(Enable Atlassian analytics)");
                if (t.size() > 0) {
                    var s = t[t.size() - 2];
                    if (s) {
                        s.remove()
                    }
                }
            }
        }
    }
}(AJS.$));
;;/* module-key = 'com.atlassian.analytics.analytics-client:policy-update', location = 'js/policy-update.js' */
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks = (function(a) {
    a.ApplicationHeader = function(b) {
        b.Cog = (function() {
            var c = function() {
                var d = AJS.$("#system-admin-menu-content");
                if (d.length > 0) {
                    return d
                }
                var e = AJS.$("#admin-menu-link-content");
                if (e.length > 0) {
                    return e
                }
                return AJS.$("#bamboo\\.global\\.header-admin\\.menu")
            };
            return {
                getDropdown: c
            }
        }());
        return b
    }(a.ApplicationHeader || {});
    return a
}(NavLinks || {}));
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminshortcuts.soy' */
// This file was automatically generated from adminshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.adminshortcuts.
 */

if (typeof navlinks == 'undefined') {
    var navlinks = {};
}
if (typeof navlinks.templates == 'undefined') {
    navlinks.templates = {};
}
if (typeof navlinks.templates.adminshortcuts == 'undefined') {
    navlinks.templates.adminshortcuts = {};
}

navlinks.templates.adminshortcuts.section = function(opt_data, opt_ignored) {
    var param5 = '<ul class="aui-list-truncate">';
    var linkList7 = opt_data.links;
    var linkListLen7 = linkList7.length;
    for (var linkIndex7 = 0; linkIndex7 < linkListLen7; linkIndex7++) {
        var linkData7 = linkList7[linkIndex7];
        param5 += '<li><a href="' + soy.$$escapeHtml(linkData7.link) + '">' + soy.$$escapeHtml(linkData7.label) + '</a></li>';
    }
    param5 += '</ul>';
    var output = '' + aui.dropdown2.section({
        id: 'nl-remote-admin-section',
        label: "Other applications",
        content: param5
    });
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.adminshortcuts.section.soyTemplateName = 'navlinks.templates.adminshortcuts.section';
}
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:administration-shortcuts-resources', location = 'adminshortcuts/adminnavlinks.js' */
var NavLinks = (function(a) {
    a.AdminShortcuts = (function() {
        var c = function() {
            return AJS.$.ajax({
                url: AJS.contextPath() + "/rest/menu/latest/admin",
                cache: false,
                dataType: "json"
            })
        };
        var b = function() {
            AJS.$("#nl-remote-admin-section").on("click", "a", function() {
                NL.trackEvent("remoteAdminItemSelected", NL.getCurrentApplication(), $(this).attr("href"))
            })
        };
        return {
            render: function() {
                c().done(function(e) {
                    e = _.reject(e, function(f) {
                        return f.local === true
                    });
                    if (e.length) {
                        var d = navlinks.templates.adminshortcuts.section({
                            links: e
                        });
                        a.ApplicationHeader.Cog.getDropdown().append(d);
                        b()
                    }
                })
            }
        }
    }());
    return a
}(NavLinks || {}));
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.projectshortcuts.
 */

if (typeof navlinks == 'undefined') {
    var navlinks = {};
}
if (typeof navlinks.templates == 'undefined') {
    navlinks.templates = {};
}
if (typeof navlinks.templates.projectshortcuts == 'undefined') {
    navlinks.templates.projectshortcuts = {};
}

navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_ignored) {
    return '' + ((opt_data.localShortcuts && opt_data.localShortcuts.length > 0) ? navlinks.templates.projectshortcuts.dialogContentShortcuts({
        shortcuts: opt_data.localShortcuts,
        listClass: 'projectshortcut-links'
    }) : '') + ((opt_data.remoteShortcuts != null) ? (opt_data.remoteShortcuts.length > 0) ? '<h2 class="projectshortcuts-heading">Related Links</h2>' + navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentMap(opt_data.remoteShortcuts, {
        shortcuts: opt_data.remoteShortcuts,
        listClass: 'projectshortcut-links'
    })) : '' : navlinks.templates.projectshortcuts.dialogLoading(null));
}
;
if (goog.DEBUG) {
    navlinks.templates.projectshortcuts.dialogContent.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContent';
}

navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_ignored) {
    return '<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="' + soy.$$escapeHtml(opt_data.logoUrl) + '"><h2 class="dialog-title">' + soy.$$escapeHtml(opt_data.title) + '</h2></div><div class="project-content-wrapper">' + soy.$$filterNoAutoescape(opt_data.contentHtml) + '</div></div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.projectshortcuts.headingWrapper.soyTemplateName = 'navlinks.templates.projectshortcuts.headingWrapper';
}

navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    var output = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
    var shortcutList35 = opt_data.shortcuts;
    var shortcutListLen35 = shortcutList35.length;
    for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
        var shortcutData35 = shortcutList35[shortcutIndex35];
        output += '<li' + ((shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '') + '>' + navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35) + '</li>';
    }
    output += '</ul>';
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.projectshortcuts.dialogContentShortcuts.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcuts';
}

navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_ignored) {
    return '<a href="' + soy.$$escapeHtml(opt_data.link) + '"' + ((opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '') + '>' + soy.$$escapeHtml(opt_data.label) + '</a>';
}
;
if (goog.DEBUG) {
    navlinks.templates.projectshortcuts.dialogContentShortcut.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogContentShortcut';
}

navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_ignored) {
    opt_data = opt_data || {};
    return '<div class="projectshortcuts-loading">' + ((opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '') + '</div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.projectshortcuts.dialogLoading.soyTemplateName = 'navlinks.templates.projectshortcuts.dialogLoading';
}
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e, g) {
    var i, k = {}, m = "key", b = "name", j = "entity-type";
    function f(s) {
        var n = e(this)
          , o = n.data(m)
          , q = n.data(b)
          , p = n.data(j);
        if (typeof o === "undefined") {
            return
        }
        s.preventDefault();
        i = new AJS.Dialog({
            width: 600,
            keypressListener: function(u) {
                if (u.which == jQuery.ui.keyCode.ESCAPE) {
                    i.remove()
                }
            },
            id: "project-shortcuts-dialog"
        }).addCancel("Close", function() {
            i.remove()
        }).addPanel("", navlinks.templates.projectshortcuts.headingWrapper({
            title: q,
            logoUrl: h(),
            contentHtml: navlinks.templates.projectshortcuts.dialogLoading({
                text: "Retrieving linksâ¦"
            })
        })).show();
        c(i);
        if (!k[o]) {
            k[o] = {
                entity: {
                    title: q
                },
                localShortcuts: null,
                remoteShortcuts: null
            };
            d(AJS.contextPath() + "/rest/project-shortcuts/1.0/local/" + o, {
                entityType: p
            }).done(t);
            d(AJS.contextPath() + "/rest/project-shortcuts/1.0/remote/" + o, {
                entityType: p
            }).done(r).fail(function() {
                var u = i.getCurrentPanel().body.find(".project-content-wrapper");
                u.find(".projectshortcuts-loading").remove();
                AJS.messages.error(u, {
                    body: "Could not retrieve remote project shortcuts",
                    closeable: false
                });
                c(i)
            })
        } else {
            l(k[o])
        }
        function t(u) {
            k[o].localShortcuts = u.shortcuts;
            l(k[o])
        }
        function r(u) {
            k[o].remoteShortcuts = u.shortcuts;
            l(k[o])
        }
    }
    function h() {
        return e(".project-shortcut-dialog-trigger img").attr("src")
    }
    function l(n) {
        if (n.localShortcuts) {
            i.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({
                title: n.entity.title,
                logoUrl: h(),
                contentHtml: navlinks.templates.projectshortcuts.dialogContent(n)
            }));
            c(i)
        }
    }
    function a(p) {
        var o = 210;
        if (!p || p.length <= o) {
            return p
        }
        var n = o;
        while (n > 0 && p.charAt(n) != " ") {
            n--
        }
        if (n == 0) {
            n = o
        }
        p = p.substring(0, n);
        if (p.length >= n) {
            p = p + "..."
        }
        return p
    }
    function c(n) {
        var q = n.popup.element
          , p = q.find(".dialog-panel-body")
          , o = q.find(".dialog-components");
        p.height("auto");
        q.height(o.outerHeight() - 1);
        e(".aui-shadow").remove()
    }
    function d(n, o) {
        return e.ajax({
            url: n,
            cache: false,
            data: o,
            dataType: "json"
        })
    }
    e(document).on("click", ".project-shortcut-dialog-trigger", f)
}(jQuery, window.NL = (window.NL || {})));
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups = AJS.Popups || {};
AJS.Popups.DisplayController = function() {
    var c = [];
    var a = false;
    var b = false;
    AJS.toInit(function() {
        setTimeout(function() {
            AJS.Popups.DisplayController.render()
        }, 0)
    });
    return {
        request: function(d) {
            c.push(d);
            if (a && b === false) {
                this.render()
            }
        },
        render: function() {
            c.sort(function(e, d) {
                return e.weight - d.weight
            });
            a = true;
            if (c.length !== 0) {
                b = true;
                c[0].show()
            }
        }
    }
}();
;;/* module-key = 'com.atlassian.support.stp:stp-license-status-resources', location = 'js/stp-licenseStatus.js' */
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher.
 */

if (typeof navlinks == 'undefined') {
    var navlinks = {};
}
if (typeof navlinks.templates == 'undefined') {
    navlinks.templates = {};
}
if (typeof navlinks.templates.appswitcher == 'undefined') {
    navlinks.templates.appswitcher = {};
}

navlinks.templates.appswitcher.linkSection = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.list.length > 0) {
        output += '<div class="aui-nav-heading sidebar-section-header">' + soy.$$escapeHtml(opt_data.title) + '</div><ul class="aui-nav nav-links">';
        var linkList8 = opt_data.list;
        var linkListLen8 = linkList8.length;
        for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
            var linkData8 = linkList8[linkIndex8];
            output += navlinks.templates.appswitcher.applicationsItem(linkData8);
        }
        output += '</ul>';
    }
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.linkSection.soyTemplateName = 'navlinks.templates.appswitcher.linkSection';
}

navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_ignored) {
    return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span></a></li>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher.applicationsItem';
}

navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_ignored) {
    return '<li class="nav-link"><a href="' + soy.$$escapeHtml(opt_data.link) + '" ' + ((opt_data.self) ? 'class="checked"' : '') + ' title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.shortcutsItem.soyTemplateName = 'navlinks.templates.appswitcher.shortcutsItem';
}

navlinks.templates.appswitcher.error = function(opt_data, opt_ignored) {
    return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.") + '</div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.error.soyTemplateName = 'navlinks.templates.appswitcher.error';
}

navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_ignored) {
    return '<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">' + soy.$$escapeHtml("Application Links") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">' + soy.$$escapeHtml("Shortcuts") + '</div><div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div></div></nav></div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.sidebarContents.soyTemplateName = 'navlinks.templates.appswitcher.sidebarContents';
}

navlinks.templates.appswitcher.trigger = function(opt_data, opt_ignored) {
    return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Linked Applications") + '</span>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.trigger.soyTemplateName = 'navlinks.templates.appswitcher.trigger';
}

navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_ignored) {
    return '<div class="app-switcher-title">' + aui.avatar.avatar({
        size: 'large',
        avatarImageUrl: opt_data.avatarUrl,
        isProject: true,
        title: opt_data.name
    }) + '<div class="sidebar-project-name">' + soy.$$escapeHtml(opt_data.name) + '</div></div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.projectHeaderSection.soyTemplateName = 'navlinks.templates.appswitcher.projectHeaderSection';
}

navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_ignored) {
    var output = '';
    var dropdownList__soy74 = '' + navlinks.templates.appswitcher.dropdownList({
        list: opt_data.links
    });
    output += aui.dropdown2.dropdown2({
        menu: {
            id: opt_data.id,
            content: dropdownList__soy74,
            extraClasses: 'aui-style-default sidebar-customize-section'
        },
        trigger: {
            showIcon: false,
            content: '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>',
            container: '#app-switcher'
        }
    });
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.cogDropdown.soyTemplateName = 'navlinks.templates.appswitcher.cogDropdown';
}

navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_ignored) {
    var output = '<ul class="sidebar-admin-links">';
    var linkList82 = opt_data.list;
    var linkListLen82 = linkList82.length;
    for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
        var linkData82 = linkList82[linkIndex82];
        output += '<li class="nav-link"><a href="' + soy.$$escapeHtml(linkData82.href) + '" title="' + soy.$$escapeHtml(linkData82.title) + '"><span class="nav-link-label">' + soy.$$escapeHtml(linkData82.label) + '</span></a></li>';
    }
    output += '</ul>';
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.dropdownList.soyTemplateName = 'navlinks.templates.appswitcher.dropdownList';
}

navlinks.templates.appswitcher.switcher = function(opt_data, opt_ignored) {
    var output = '';
    if (true) {
        if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
            var sidebarContents__soy97 = '' + navlinks.templates.appswitcher.sidebarContents(null);
            var triggerContent__soy99 = '' + navlinks.templates.appswitcher.trigger(null);
            output += navlinks.templates.appswitcher.sidebar({
                sidebar: {
                    id: 'app-switcher',
                    content: sidebarContents__soy97
                },
                trigger: {
                    showIcon: false,
                    content: triggerContent__soy99
                }
            }) + '<script>\n                (function (NL) {\n                    var initialise = function () {\n                        new NL.SideBar({\n                            sidebarContents: \'#app-switcher\'\n                        });\n                    };\n                    if (NL.SideBar) {\n                        initialise();\n                    } else {\n                        NL.onInit = initialise;\n                    }\n                }(window.NL = (window.NL || {})));\n                window.NL.isUserAdmin = ' + soy.$$escapeHtml(false) + '<\/script>';
        } else {
            output += navlinks.templates.appswitcher_old.switcher(null);
        }
    }
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.switcher.soyTemplateName = 'navlinks.templates.appswitcher.switcher';
}

navlinks.templates.appswitcher.sidebar = function(opt_data, opt_ignored) {
    return '<a href="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" class="sidebar-trigger app-switcher-trigger" aria-owns="' + soy.$$escapeHtml(opt_data.sidebar.id) + '" aria-haspopup="true">' + soy.$$filterNoAutoescape(opt_data.trigger.content) + '</a><div id=' + soy.$$escapeHtml(opt_data.sidebar.id) + ' class="app-switcher-sidebar aui-style-default sidebar-offscreen">' + soy.$$filterNoAutoescape(opt_data.sidebar.content) + '</div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher.sidebar.soyTemplateName = 'navlinks.templates.appswitcher.sidebar';
}
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(c, a) {
    a.SideBar = function(d) {
        var e = this;
        this.$sidebar = null;
        d = c.extend({
            sidebarContents: null
        }, d);
        this.getLinks = function() {
            return c.ajax({
                url: AJS.contextPath() + "/rest/menu/latest/appswitcher",
                cache: false,
                dataType: "json"
            }).done(this.updateAppLinks).fail(this.showAppSwitcherError)
        }
        ;
        this.populateProjectHeader = function(g, f) {
            e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({
                avatarUrl: f,
                name: g
            }))
        }
        ;
        this.getProjectData = function() {
            var f = c(".project-shortcut-dialog-trigger")
              , g = f.data("key")
              , h = f.data("entity-type");
            if (f.size() == 0 || !g || !h) {
                c(".app-switcher-shortcuts").remove();
                return
            }
            var j, i;
            i = c.ajax({
                url: AJS.contextPath() + "/rest/project-shortcuts/1.0/local/" + g,
                cache: false,
                data: {
                    entityType: h
                },
                dataType: "json"
            });
            j = c.ajax({
                url: AJS.contextPath() + "/rest/project-shortcuts/1.0/remote/" + g,
                cache: false,
                data: {
                    entityType: h
                },
                dataType: "json"
            });
            c.when(i, j).then(function(l, k) {
                e.updateProjectShortcuts(l, k, {
                    key: g,
                    entityType: h,
                    name: f.data("name"),
                    avatarUrl: f.find("img").prop("src")
                })
            }, e.showProjectShortcutsError)
        }
        ;
        this.getSidebar = function() {
            if (!this.$sidebar) {
                this.$sidebar = c(d.sidebarContents)
            }
            return this.$sidebar
        }
        ;
        this.addApplicationsCog = function() {
            c(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({
                id: "sidebar-applications-admin-dropdown",
                links: [{
                    href: AJS.contextPath() + "/plugins/servlet/customize-application-navigator",
                    label: "Customize navigator",
                    title: "Add new entries, hide existing or restrict who sees what"
                }, {
                    href: AJS.contextPath() + "/plugins/servlet/applinks/listApplicationLinks",
                    label: "Manage application links",
                    title: "Link to more Atlassian applications"
                }]
            }))
        }
        ;
        this.addProjectShortcutsCog = function(f, h) {
            var g = [{
                href: AJS.contextPath() + "/plugins/servlet/custom-content-links-admin?entityKey=" + f,
                label: "Customize shortcuts",
                title: ""
            }];
            if (e.entityMappings[h]) {
                g.push({
                    href: e.generateEntityLinksUrl(f, e.entityMappings[h]),
                    label: "Manage product links",
                    title: ""
                })
            }
            e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({
                id: "sidebar-project-shortcuts-admin-dropdown",
                links: g
            }))
        }
        ;
        this.updateAppLinks = function(f) {
            c(function() {
                e.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({
                    title: "Application Links",
                    list: f
                }));
                if (a.isUserAdmin) {
                    e.addApplicationsCog()
                }
                e.bindAnalyticsHandlers(e.getSidebar(), f)
            })
        }
        ;
        this.updateProjectShortcuts = function(i, g, h) {
            var j = i[0].shortcuts
              , f = g[0].shortcuts;
            e.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({
                title: "Shortcuts",
                list: j.concat(f)
            }));
            if (a.isUserAdmin) {
                e.addProjectShortcutsCog(h.key, h.entityType)
            }
            e.populateProjectHeader(h.name, h.avatarUrl);
            e.bindAnalyticsHandlers(e.getSidebar(), data)
        }
        ;
        this.entityMappings = {
            "confluence.space": "com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType",
            "jira.project": "com.atlassian.applinks.api.application.jira.JiraProjectEntityType",
            "bamboo.project": "com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType",
            "stash.project": "com.atlassian.applinks.api.application.stash.StashProjectEntityType"
        };
        this.generateEntityLinksUrl = function(f, g) {
            if (g === e.entityMappings["confluence.space"]) {
                return AJS.contextPath() + "/spaces/listentitylinks.action?typeId=" + g + "&key=" + f
            } else {
                return AJS.contextPath() + "/plugins/servlet/applinks/listEntityLinks/" + g + "/" + f
            }
        }
        ;
        this.showAppSwitcherError = function() {
            c(function() {
                var f = e.getSidebar();
                f.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());
                f.off(".appswitcher").on("click.appswitcher", ".app-switcher-retry", c.proxy(e.retryLoading, e))
            })
        }
        ;
        this.showProjectShortcutsError = function() {
            c(function() {
                var f = e.getSidebar();
                f.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());
                f.off(".appswitcher").on("click.appswitcher", ".app-switcher-retry", c.proxy(e.retryLoading, e))
            })
        }
        ;
        this.retryLoading = function(f) {
            this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());
            this.getLinks();
            this.getProjectData();
            f && f.stopPropagation()
        }
        ;
        this.bindAnalyticsHandlers = function(f, g) {}
        ;
        this.getLinks();
        c(this.getProjectData);
        this.toggleSidebar = function(h) {
            var i = e.getSidebar()
              , g = c("body")
              , f = c(window.document);
            if (!g.hasClass("app-switcher-open")) {
                var k = c("#header");
                i.css("left", -i.width());
                i.parent("body").length || i.appendTo("body");
                b({
                    data: i
                });
                i.animate({
                    left: 0
                }, 300);
                function j(l) {
                    var n = l.target && c(l.target)
                      , m = l.keyCode;
                    if (l.originalEvent === h.originalEvent) {
                        return
                    }
                    if (n && !m && !(n.closest(i).length || n.closest(k).length) && h.which == 1 && !(l.shiftKey || l.ctrlKey || l.metaKey)) {
                        e.toggleSidebar()
                    } else {
                        if (m === 27) {
                            e.toggleSidebar()
                        }
                    }
                }
                f.on("click.appSwitcher", j);
                f.on("keydown.appSwitcher", j);
                f.on("scroll.appSwitcher", i, b)
            } else {
                f.off(".appSwitcher")
            }
            g.toggleClass("app-switcher-open")
        }
        ;
        c("#header").on("click", ".app-switcher-trigger", this.toggleSidebar)
    }
    ;
    function b(f) {
        var d = c(document).scrollTop()
          , g = c("#header")
          , e = (g.height() + g.offset().top) - d;
        if (e >= 0) {
            f.data.css({
                top: e,
                position: "fixed"
            })
        } else {
            f.data.css({
                top: 0,
                left: 0,
                position: "fixed"
            })
        }
    }
    if (a.onInit) {
        a.onInit()
    }
}(jQuery, window.NL = (window.NL || {})));
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
(function(e, c) {
    c.AppSwitcher = function(f) {
        var g = AJS.contextPath() + "/plugins/servlet/customize-application-navigator";
        var h = this;
        this.$dropdown = null;
        f = e.extend({
            dropdownContents: null
        }, f);
        this.getLinks = function() {
            return e.ajax({
                url: AJS.contextPath() + "/rest/menu/latest/appswitcher",
                cache: false,
                dataType: "json"
            }).done(this.updateDropdown).fail(this.showError)
        }
        ;
        this.getDropdown = function() {
            if (!this.$dropdown) {
                this.$dropdown = e(f.dropdownContents)
            }
            return this.$dropdown
        }
        ;
        this.updateDropdown = function(i) {
            e(function() {
                h.getDropdown().html(navlinks.templates.appswitcher_old.applications({
                    apps: i,
                    showAdminLink: c.isUserAdmin,
                    adminLink: g
                }));
                h.bindAnalyticsHandlers(h.getDropdown(), i);
                h.processSuggestionApps(i)
            })
        }
        ;
        this.bindAnalyticsHandlers = function(i, j) {}
        ;
        this.processSuggestionApps = function(i) {
            e.ajax({
                type: "GET",
                dataType: "json",
                contentType: "application/json; charset=UTF-8",
                url: AJS.contextPath() + "/rest/menu/latest/isAppSuggestionAvailable"
            }).done(function(j) {
                if (j === true) {
                    h.handleSuggestionApps(i)
                }
            })
        }
        ;
        this.handleSuggestionApps = function(k) {
            var l = _.map(k, function(m) {
                return m.applicationType.toLowerCase()
            });
            $suggestionApps = e("<div id='app-switcher-suggestion-apps' class='aui-dropdown2-section'/>");
            $suggestionApps.html(navlinks.templates.appswitcher_old.suggestionApps);
            var j = $suggestionApps.find(".suggestion-apps");
            var i = false;
            _.each(a, function(m) {
                if (!_.contains(l, m.appName)) {
                    i = true;
                    j.append(navlinks.templates.appswitcher_old.suggestionApp({
                        appName: m.appName,
                        appDesc: m.appDesc
                    }))
                }
            });
            if (!i) {
                return
            }
            e("#app-switcher").append($suggestionApps);
            e(".app-discovery-suggestion-app").click(function() {
                AJS.trigger("analytics", {
                    name: "appswitcher.discovery.user.select." + e(this).find("a").attr("id").toLowerCase()
                });
                window.open(e(this).find("a").attr("title"), "_blank")
            });
            e(".app-discovery-suggestion-app").hover(function() {
                e(this).find("a").removeClass("active").removeClass("aui-dropdown2-active")
            });
            e(".app-discovery-cancel-button").click(function() {
                AJS.trigger("analytics", {
                    name: "appswitcher.discovery.nothanks.button.click"
                });
                d(b, "true");
                $suggestionApps.remove()
            })
        }
        ;
        this.showError = function() {
            e(function() {
                h.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher", ".app-switcher-retry", e.proxy(h.retryLoading, h))
            })
        }
        ;
        this.retryLoading = function(i) {
            this.getDropdown().html(navlinks.templates.appswitcher_old.loading());
            this.getLinks();
            i && i.stopPropagation()
        }
        ;
        this.getLinks()
    }
    ;
    var b = "key-no-thanks";
    var a = [{
        appName: "jira",
        appDesc: "Issue & Project Tracking Software"
    }, {
        appName: "confluence",
        appDesc: "Collaboration and content sharing"
    }, {
        appName: "bamboo",
        appDesc: "Continuous integration"
    }];
    var d = function(f, g) {
        e.ajax({
            url: AJS.contextPath() + "/rest/menu/latest/userdata/",
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify({
                key: f,
                value: g
            })
        })
    };
    if (c.onInit) {
        c.onInit()
    }
}(jQuery, window.NL = (window.NL || {})));
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace navlinks.templates.appswitcher_old.
 */

if (typeof navlinks == 'undefined') {
    var navlinks = {};
}
if (typeof navlinks.templates == 'undefined') {
    navlinks.templates = {};
}
if (typeof navlinks.templates.appswitcher_old == 'undefined') {
    navlinks.templates.appswitcher_old = {};
}

navlinks.templates.appswitcher_old.applications = function(opt_data, opt_ignored) {
    return '' + navlinks.templates.appswitcher_old.applicationsSection({
        list: opt_data.apps,
        listClass: 'nav-links',
        showDescription: opt_data.showDescription
    }) + ((opt_data.custom) ? navlinks.templates.appswitcher_old.applicationsSection({
        list: opt_data.custom,
        showDescription: opt_data.showDescription
    }) : '') + ((opt_data.showAdminLink) ? navlinks.templates.appswitcher_old.adminSection(opt_data) : '');
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.applications.soyTemplateName = 'navlinks.templates.appswitcher_old.applications';
}

navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_ignored) {
    var output = '';
    if (opt_data.list.length > 0) {
        var param19 = '<ul' + ((opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '') + '>';
        var linkList27 = opt_data.list;
        var linkListLen27 = linkList27.length;
        for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
            var linkData27 = linkList27[linkIndex27];
            param19 += navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentMap(linkData27, {
                showDescription: opt_data.showDescription
            }));
        }
        param19 += '</ul>';
        output += aui.dropdown2.section({
            content: param19
        });
    }
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.applicationsSection.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsSection';
}

navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_ignored) {
    return '<li class="nav-link' + ((opt_data.self) ? ' nav-link-local' : '') + '"><a href="' + soy.$$escapeHtml(opt_data.link) + '" class="aui-dropdown2-radio ' + ((opt_data.self) ? 'aui-dropdown2-checked' : '') + '" title="' + soy.$$escapeHtml(opt_data.link) + '"><span class="nav-link-label">' + soy.$$escapeHtml(opt_data.label) + '</span>' + ((opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '') + '</a></li>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.applicationsItem.soyTemplateName = 'navlinks.templates.appswitcher_old.applicationsItem';
}

navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_ignored) {
    return '' + aui.dropdown2.section({
        content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + soy.$$filterNoAutoescape("Configure\x26hellip;") + '</span></a></li></ul>'
    });
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.adminSection.soyTemplateName = 'navlinks.templates.appswitcher_old.adminSection';
}

navlinks.templates.appswitcher_old.error = function(opt_data, opt_ignored) {
    return '<div class="app-switcher-error">' + soy.$$filterNoAutoescape("Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.") + '</div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.error.soyTemplateName = 'navlinks.templates.appswitcher_old.error';
}

navlinks.templates.appswitcher_old.loading = function(opt_data, opt_ignored) {
    return '<div class="app-switcher-loading">' + soy.$$filterNoAutoescape("Loading\x26hellip;") + '</div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.loading.soyTemplateName = 'navlinks.templates.appswitcher_old.loading';
}

navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_ignored) {
    return '<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">' + soy.$$escapeHtml("Linked Applications") + '</span>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.trigger.soyTemplateName = 'navlinks.templates.appswitcher_old.trigger';
}

navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_ignored) {
    var output = '';
    if (true) {
        var loadingContent__soy81 = '' + navlinks.templates.appswitcher_old.loading(null);
        var triggerContent__soy83 = '' + navlinks.templates.appswitcher_old.trigger(null);
        output += aui.dropdown2.dropdown2({
            menu: {
                id: 'app-switcher',
                content: loadingContent__soy81,
                extraClasses: 'aui-style-default'
            },
            trigger: {
                showIcon: false,
                content: triggerContent__soy83,
                extraClasses: 'app-switcher-trigger',
                extraAttributes: {
                    href: '#app-switcher'
                }
            }
        }) + '<script>\n            (function (NL) {\n                var initialise = function () {\n                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.\n                    window.atlassian = window.atlassian || window.aui;\n                    new NL.AppSwitcher({\n                        dropdownContents: \'#app-switcher\'\n                    });\n                };\n                if (NL.AppSwitcher) {\n                    initialise();\n                } else {\n                    NL.onInit = initialise;\n                }\n            }(window.NL = (window.NL || {})));\n            window.NL.isUserAdmin = ' + soy.$$escapeHtml(false) + '<\/script>';
    }
    return output;
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.switcher.soyTemplateName = 'navlinks.templates.appswitcher_old.switcher';
}

navlinks.templates.appswitcher_old.suggestionApp = function(opt_data, opt_ignored) {
    return '<li class="app-discovery-suggestion-app"><a id="' + soy.$$escapeHtml(opt_data.appName) + '" href="#" class="app-discovery-link aui-icon-container app-discovery-' + soy.$$escapeHtml(opt_data.appName) + '-product-icon" title="https://www.atlassian.com/software/' + soy.$$escapeHtml(opt_data.appName) + '"/><div class="app-discovery-small">' + soy.$$escapeHtml(opt_data.appDesc) + '</div></li>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.suggestionApp.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApp';
}

navlinks.templates.appswitcher_old.suggestionApps = function(opt_data, opt_ignored) {
    return '<ul class=\'nav-links suggestion-apps\'><li><span class=\'app-discovery-suggest-title nav-link-label\'><h6>' + soy.$$escapeHtml("Try other Atlassian apps") + '</h6></span></li></ul><div class=\'buttons-container app-discovery-suggest-apps-buttons\'><div class=\'buttons\'><button class=\'aui-button aui-button-link app-discovery-cancel-button\' name=\'cancel\' accesskey=\'c\' href=\'#\'>' + soy.$$escapeHtml("Don\x27t show this again") + '</button></div></div>';
}
;
if (goog.DEBUG) {
    navlinks.templates.appswitcher_old.suggestionApps.soyTemplateName = 'navlinks.templates.appswitcher_old.suggestionApps';
}
;;/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/inline-dialog.js' */
(function(d) {
    AJS.CustomInlineDialog = AJS.CustomInlineDialog || function(B, n, r, p) {
        p = p || [];
        if (p.hasOwnProperty("getArrowAttributes")) {
            getArrowAttributesDeprecationLogger()
        }
        if (p.hasOwnProperty("getArrowPath")) {
            getArrowPathDeprecationLogger();
            if (p.hasOwnProperty("gravity")) {
                getArrowPathWithGravityDeprecationLogger()
            }
        }
        if (p.hasOwnProperty("onTop")) {
            onTopDeprecationLogger();
            if (p.onTop && p.gravity === undefined) {
                p.gravity = "s"
            }
        }
        if (typeof n === "undefined") {
            n = String(Math.random()).replace(".", "");
            if (d("#inline-dialog-" + n + ", #arrow-" + n + ", #inline-dialog-shim-" + n).length) {
                throw "GENERATED_IDENTIFIER_NOT_UNIQUE"
            }
        }
        var z = d.extend(false, AJS.CustomInlineDialog.opts, p);
        if (z.gravity === "w") {
            z.offsetX = p.offsetX === undefined ? 10 : p.offsetX;
            z.offsetY = p.offsetY === undefined ? 0 : p.offsetY
        }
        var v = function() {
            return window.Raphael && p && (p.getArrowPath || p.getArrowAttributes)
        };
        var j;
        var q;
        var K;
        var u = false;
        var A = false;
        var I = false;
        var J;
        var x;
        var g = d('<div id="inline-dialog-' + n + '" class="aui-inline-dialog"><div class="aui-inline-dialog-contents contents"></div><div id="arrow-' + n + '" class="aui-inline-dialog-arrow arrow"></div></div>');
        var m = d("#arrow-" + n, g);
        var G = g.find(".contents");
        if (!v()) {
            g.find(".aui-inline-dialog-arrow").addClass("aui-css-arrow")
        }
        if (!z.displayShadow) {
            G.addClass("aui-inline-dialog-no-shadow")
        }
        if (z.autoWidth) {
            G.addClass("aui-inline-dialog-auto-width")
        } else {
            G.css("width", z.width + "px")
        }
        G.mouseover(function(O) {
            clearTimeout(q);
            g.unbind("mouseover")
        }).mouseout(function() {
            E()
        });
        var D = function() {
            if (!j) {
                j = {
                    popup: g,
                    hide: function() {
                        E(0)
                    },
                    id: n,
                    show: function() {
                        y()
                    },
                    persistent: z.persistent ? true : false,
                    reset: function() {
                        function S(U, T) {
                            U.css(T.popupCss);
                            if (v()) {
                                if (T.gravity === "s") {
                                    T.arrowCss.top -= d.browser.msie ? 10 : 9
                                }
                                if (!U.arrowCanvas) {
                                    U.arrowCanvas = Raphael("arrow-" + n, 16, 16)
                                }
                                var V = z.getArrowPath
                                  , W = d.isFunction(V) ? V(T) : V;
                                U.arrowCanvas.path(W).attr(z.getArrowAttributes())
                            } else {
                                m.removeClass("aui-bottom-arrow aui-left-arrow aui-right-arrow");
                                if (T.gravity === "s" && !m.hasClass("aui-bottom-arrow")) {
                                    m.addClass("aui-bottom-arrow")
                                } else {
                                    if (T.gravity === "n") {} else {
                                        if (T.gravity === "w") {
                                            m.addClass("aui-left-arrow")
                                        } else {
                                            if (T.gravity === "e") {
                                                m.addClass("aui-right-arrow")
                                            }
                                        }
                                    }
                                }
                            }
                            m.css(T.arrowCss)
                        }
                        var P = AJS.$(window).height();
                        var Q = Math.round(P * 0.75);
                        g.children(".aui-inline-dialog-contents").css("max-height", Q);
                        var O = z.calculatePositions(g, x, J, z);
                        if (O.hasOwnProperty("displayAbove")) {
                            displayAboveDeprecationLogger();
                            O.gravity = O.displayAbove ? "s" : "n"
                        }
                        S(g, O);
                        g.fadeIn(z.fadeTime, function() {});
                        if (d.browser.msie && ~~(d.browser.version) < 10) {
                            var R = d("#inline-dialog-shim-" + n);
                            if (!R.length) {
                                d(g).prepend(d('<iframe class = "inline-dialog-shim" id="inline-dialog-shim-' + n + '" frameBorder="0" src="javascript:false;"></iframe>'))
                            }
                            R.css({
                                width: G.outerWidth(),
                                height: G.outerHeight()
                            })
                        }
                    }
                }
            }
            return j
        };
        var y = function() {
            if (g.is(":visible")) {
                return
            }
            K = setTimeout(function() {
                if (!I || !A) {
                    return
                }
                z.addActiveClass && d(B).addClass("active");
                u = true;
                if (!z.persistent) {
                    H()
                }
                AJS.CustomInlineDialog.current = D();
                d(document).trigger("showLayer", ["inlineDialog", D()]);
                D().reset()
            }, z.showDelay)
        };
        var E = function(O) {
            if (typeof O == "undefined" && z.persistent) {
                return
            }
            A = false;
            if (u && z.preHideCallback.call(g[0].popup)) {
                O = (O == null) ? z.hideDelay : O;
                clearTimeout(q);
                clearTimeout(K);
                if (O != null) {
                    q = setTimeout(function() {
                        l();
                        z.addActiveClass && d(B).removeClass("active");
                        g.fadeOut(z.fadeTime, function() {
                            z.hideCallback.call(g[0].popup)
                        });
                        if (g.arrowCanvas) {
                            g.arrowCanvas.remove();
                            g.arrowCanvas = null
                        }
                        u = false;
                        A = false;
                        d(document).trigger("hideLayer", ["inlineDialog", D()]);
                        AJS.CustomInlineDialog.current = null;
                        if (!z.cacheContent) {
                            I = false;
                            w = false
                        }
                    }, O)
                }
            }
        };
        var F = function(R, P) {
            var O = d(P);
            z.upfrontCallback.call({
                popup: g,
                hide: function() {
                    E(0)
                },
                id: n,
                show: function() {
                    y()
                }
            });
            g.each(function() {
                if (typeof this.popup != "undefined") {
                    this.popup.hide()
                }
            });
            if (z.closeOthers) {
                d(".aui-inline-dialog").each(function() {
                    !this.popup.persistent && this.popup.hide()
                })
            }
            x = {
                target: O
            };
            if (!R) {
                J = {
                    x: O.offset().left,
                    y: O.offset().top
                }
            } else {
                J = {
                    x: R.pageX,
                    y: R.pageY
                }
            }
            if (!u) {
                clearTimeout(K)
            }
            A = true;
            var Q = function() {
                w = false;
                I = true;
                z.initCallback.call({
                    popup: g,
                    hide: function() {
                        E(0)
                    },
                    id: n,
                    show: function() {
                        y()
                    }
                });
                y()
            };
            if (!w) {
                w = true;
                if (d.isFunction(r)) {
                    r(G, P, Q)
                } else {
                    d.get(r, function(T, S, U) {
                        G.html(z.responseHandler(T, S, U));
                        I = true;
                        z.initCallback.call({
                            popup: g,
                            hide: function() {
                                E(0)
                            },
                            id: n,
                            show: function() {
                                y()
                            }
                        });
                        y()
                    })
                }
            }
            clearTimeout(q);
            if (!u) {
                y()
            }
            return false
        };
        g[0].popup = D();
        var w = false;
        var t = false;
        var s = function() {
            if (!t) {
                d(z.container).append(g);
                t = true
            }
        };
        var o = d(B);
        if (z.onHover) {
            if (z.useLiveEvents) {
                if (o.selector) {
                    d(document).on("mousemove", o.selector, function(O) {
                        s();
                        F(O, this)
                    }).on("mouseout", o.selector, function() {
                        E()
                    })
                } else {
                    AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.")
                }
            } else {
                o.mousemove(function(O) {
                    s();
                    F(O, this)
                }).mouseout(function() {
                    E()
                })
            }
        } else {
            if (!z.noBind) {
                if (z.useLiveEvents) {
                    if (o.selector) {
                        d(document).on("click", o.selector, function(O) {
                            s();
                            if (M()) {
                                g.hide()
                            } else {
                                F(O, this)
                            }
                            return false
                        }).on("mouseout", o.selector, function() {
                            E()
                        })
                    } else {
                        AJS.log("Warning: inline dialog trigger elements must have a jQuery selector when the useLiveEvents option is enabled.")
                    }
                } else {
                    o.click(function(O) {
                        s();
                        if (M()) {
                            g.hide()
                        } else {
                            F(O, this)
                        }
                        return false
                    }).mouseout(function() {
                        E()
                    })
                }
            }
        }
        var M = function() {
            return u && z.closeOnTriggerClick
        };
        var H = function() {
            k();
            f()
        };
        var l = function() {
            C();
            N()
        };
        var i = false;
        var h = n + ".inline-dialog-check";
        var k = function() {
            if (!i) {
                d("body").bind("click." + h, function(P) {
                    var O = d(P.target);
                    if (O.closest("#inline-dialog-" + n + " .contents").length === 0) {
                        E(0)
                    }
                });
                i = true
            }
        };
        var C = function() {
            if (i) {
                d("body").unbind("click." + h)
            }
            i = false
        };
        var L = function(O) {
            if (O.keyCode === 27) {
                E(0)
            }
        };
        var f = function() {
            d(document).on("keydown", L)
        };
        var N = function() {
            d(document).off("keydown", L)
        };
        g.show = function(P, O) {
            if (P) {
                P.stopPropagation()
            }
            s();
            if (z.noBind && !(B && B.length)) {
                F(P, O === undefined ? P.target : O)
            } else {
                F(P, B)
            }
        }
        ;
        g.hide = function() {
            E(0)
        }
        ;
        g.refresh = function() {
            if (u) {
                D().reset()
            }
        }
        ;
        g.getOptions = function() {
            return z
        }
        ;
        return g
    }
    ;
    function c(g) {
        var f = d(g);
        var h = d.extend({
            left: 0,
            top: 0
        }, f.offset());
        return {
            left: h.left,
            top: h.top,
            width: f.outerWidth(),
            height: f.outerHeight()
        }
    }
    function b(h, j, t, f) {
        var m = AJS.$.isFunction(f.offsetX) ? f.offsetX(h, j, t, f) : f.offsetX;
        var l = AJS.$.isFunction(f.offsetY) ? f.offsetY(h, j, t, f) : f.offsetY;
        var q = AJS.$.isFunction(f.arrowOffsetX) ? f.arrowOffsetX(h, j, t, f) : f.arrowOffsetX;
        var p = AJS.$.isFunction(f.arrowOffsetY) ? f.arrowOffsetY(h, j, t, f) : f.arrowOffsetY;
        var s = f.container.toLowerCase() !== "body";
        var g = AJS.$(f.container);
        var o = s ? AJS.$(f.container).parent() : AJS.$(window);
        var r = s ? g.offset() : {
            left: 0,
            top: 0
        };
        var k = s ? o.offset() : {
            left: 0,
            top: 0
        };
        var i = j.target;
        var u = i.offset();
        var n = i[0].getBBox && i[0].getBBox();
        return {
            screenPadding: 10,
            arrowMargin: 5,
            window: {
                top: k.top,
                left: k.left,
                scrollTop: o.scrollTop(),
                scrollLeft: o.scrollLeft(),
                width: o.width(),
                height: o.height()
            },
            scrollContainer: {
                width: g.width(),
                height: g.height()
            },
            trigger: {
                top: u.top - r.top,
                left: u.left - r.left,
                width: n ? n.width : i.outerWidth(),
                height: n ? n.height : i.outerHeight()
            },
            dialog: {
                width: h.width(),
                height: h.height(),
                offset: {
                    top: l,
                    left: m
                }
            },
            arrow: {
                height: h.find(".arrow").outerHeight(),
                offset: {
                    top: p,
                    left: q
                }
            }
        }
    }
    function e(f, p, G, r) {
        var n = b(f, p, G, r);
        var j = n.screenPadding;
        var k = n.window;
        var t = n.trigger;
        var D = n.dialog;
        var i = n.arrow;
        var z = n.scrollContainer;
        var E = {
            top: t.top - k.scrollTop,
            left: t.left - k.scrollLeft
        };
        var A = Math.floor(t.height / 2);
        var v = Math.floor(D.height / 2);
        var u = Math.floor(i.height / 2);
        var C = E.left - D.offset.left - j;
        var H = z.width - E.left - t.width - D.offset.left - j;
        var B = C >= D.width;
        var h = H >= D.width;
        var l = !h && B ? "e" : "w";
        var o = E.top + A - u;
        var q = k.height - o - i.height;
        j = Math.min(j, o - n.arrowMargin);
        j = Math.min(j, q - n.arrowMargin);
        var g = E.top + A;
        var x = Math.max(g - j, 0);
        var F = Math.max(k.height - g - j, 0);
        var y = v - D.offset.top > x;
        var m = v + D.offset.top > F;
        var w;
        var s;
        if (y) {
            w = {
                top: k.scrollTop + j,
                left: l === "w" ? t.left + t.width + D.offset.left : t.left - D.width - D.offset.left
            };
            s = {
                top: (t.top + A) - (w.top + u)
            }
        } else {
            if (m) {
                w = {
                    top: k.scrollTop + k.height - D.height - j,
                    left: l === "w" ? t.left + t.width + D.offset.left : t.left - D.width - D.offset.left
                };
                s = {
                    top: (t.top + A) - (w.top + u)
                }
            } else {
                w = {
                    top: t.top + A - v + D.offset.top,
                    left: l === "w" ? t.left + t.width + D.offset.left : t.left - D.width - D.offset.left
                };
                s = {
                    top: v - u + i.offset.top
                }
            }
        }
        return {
            gravity: l,
            popupCss: w,
            arrowCss: s
        }
    }
    function a(g, o, z, s) {
        var x = AJS.$.isFunction(s.offsetX) ? s.offsetX(g, o, z, s) : s.offsetX;
        var v = AJS.$.isFunction(s.offsetY) ? s.offsetY(g, o, z, s) : s.offsetY;
        var m = AJS.$.isFunction(s.arrowOffsetX) ? s.arrowOffsetX(g, o, z, s) : s.arrowOffsetX;
        var l = AJS.$.isFunction(s.arrowOffsetY) ? s.arrowOffsetY(g, o, z, s) : s.arrowOffsetY;
        var f = c(window);
        var p = c(o.target);
        var y = c(g);
        var j = c(g.find(".aui-inline-dialog-arrow"));
        var i = p.left + p.width / 2;
        var u = (window.pageYOffset || document.documentElement.scrollTop) + f.height;
        var k = 10;
        y.top = p.top + p.height + ~~v;
        y.left = p.left + ~~x;
        var r = f.width - (y.left + y.width + k);
        j.left = i - y.left + ~~m;
        j.top = -(j.height / 2);
        var n = p.top > y.height;
        var h = (y.top + y.height) < u;
        var q = (!h && n) || (n && s.gravity === "s");
        if (q) {
            y.top = p.top - y.height - (j.height / 2);
            j.top = y.height
        }
        if (s.isRelativeToMouse) {
            if (r < 0) {
                y.right = k;
                y.left = "auto";
                j.left = z.x - (f.width - y.width)
            } else {
                y.left = z.x - 20;
                j.left = z.x - y.left
            }
        } else {
            if (r < 0) {
                y.right = k;
                y.left = "auto";
                var w = f.width - y.right;
                var t = w - y.width;
                j.right = "auto";
                j.left = i - t - j.width / 2
            } else {
                if (y.width <= p.width / 2) {
                    j.left = y.width / 2;
                    y.left = i - y.width / 2
                }
            }
        }
        return {
            gravity: q ? "s" : "n",
            displayAbove: q,
            popupCss: {
                left: y.left,
                top: y.top,
                right: y.right
            },
            arrowCss: {
                left: j.left,
                top: j.top,
                right: j.right
            }
        }
    }
    AJS.CustomInlineDialog.opts = {
        onTop: false,
        responseHandler: function(g, f, h) {
            return g
        },
        closeOthers: true,
        isRelativeToMouse: false,
        addActiveClass: true,
        onHover: false,
        useLiveEvents: false,
        noBind: false,
        fadeTime: 100,
        persistent: false,
        hideDelay: 10000,
        showDelay: 0,
        width: 300,
        offsetX: 0,
        offsetY: 10,
        arrowOffsetX: 0,
        arrowOffsetY: 0,
        container: "body",
        cacheContent: true,
        displayShadow: true,
        autoWidth: false,
        gravity: "n",
        closeOnTriggerClick: false,
        preHideCallback: function() {
            return true
        },
        hideCallback: function() {},
        initCallback: function() {},
        upfrontCallback: function() {},
        calculatePositions: function(f, i, j, h) {
            h = h || {};
            var g = h.gravity === "w" ? e : a;
            return g(f, i, j, h)
        },
        getArrowPath: function(f) {
            if (f.gravity === "s") {
                return "M0,8L8,16,16,8"
            } else {
                return "M0,8L8,0,16,8"
            }
        },
        getArrowAttributes: function() {
            return {
                fill: "#fff",
                stroke: "#ccc"
            }
        }
    }
})(AJS.$);
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:recent-repositories-menu-resources', location = '/static/layout/base/menu/repositories/recent.soy' */
// This file was automatically generated from recent.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.layout.menu.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.layout == 'undefined') {
    stash.layout = {};
}
if (typeof stash.layout.menu == 'undefined') {
    stash.layout.menu = {};
}

stash.layout.menu.loadingRecentReposMenuItem = function(opt_data, opt_ignored) {
    return '<li><span class="loading-recent-repos">' + soy.$$escapeHtml("Loading...") + '</span></li>';
}
;
if (goog.DEBUG) {
    stash.layout.menu.loadingRecentReposMenuItem.soyTemplateName = 'stash.layout.menu.loadingRecentReposMenuItem';
}

stash.layout.menu.noRecentReposMenuItem = function(opt_data, opt_ignored) {
    return '<li><span class="no-recent-repos">' + soy.$$escapeHtml("No recently viewed repositories") + '</span></li>';
}
;
if (goog.DEBUG) {
    stash.layout.menu.noRecentReposMenuItem.soyTemplateName = 'stash.layout.menu.noRecentReposMenuItem';
}

stash.layout.menu.errorLoadingRecentReposMenuItem = function(opt_data, opt_ignored) {
    return '<li><span>' + soy.$$escapeHtml("An error occurred") + '</span></li>';
}
;
if (goog.DEBUG) {
    stash.layout.menu.errorLoadingRecentReposMenuItem.soyTemplateName = 'stash.layout.menu.errorLoadingRecentReposMenuItem';
}
;;/* module-key = 'com.atlassian.stash.stash-web-plugin:recent-repositories-menu-resources', location = '/static/layout/base/menu/repositories/recent.js' */
define("layout/base/menu/recent-repos", ["jquery", "stash/api/util/navbuilder", "util/ajax", "util/events", "util/html", "exports"], function(E, F, D, C, B, A) {
    A.initMenu = function(I) {
        var H = E("#" + B.sanitizeId(E("#" + I).attr("aria-controls"))).addClass("recent-repositories-menu");
        var K = H.find(".recent-repositories-section ul");
        var J = E(stash.layout.menu.loadingRecentReposMenuItem());
        H.on("aui-dropdown2-show", function() {
            C.trigger("internal.stash.ui.nav.repositories.opened")
        });
        H.on("click", "a", function() {
            var L = E(this).closest(".aui-dropdown2-section");
            if (L.is(".recent-repositories-section")) {
                C.trigger("internal.stash.ui.nav.repositories.item.clicked", null, {
                    repositoryId: E(this).attr("data-repo-id")
                })
            }
            if (L.is(".public-repo-list-link-section")) {
                C.trigger("internal.stash.ui.nav.repositories.public.clicked")
            }
        });
        K.append(J);
        var G = function() {
            D.rest({
                url: F.rest().profile().recent().repos().withParams({
                    avatarSize: stash.widget.avatarSizeInPx({
                        size: "xsmall"
                    })
                }).build(),
                statusCode: {
                    "*": function() {
                        return false
                    }
                }
            }).done(function(M) {
                if (M && M.size) {
                    var L = M.values;
                    L.sort(function(O, N) {
                        return O.project.name.localeCompare(N.project.name) || O.name.localeCompare(N.name)
                    });
                    K.append(E(stash.feature.repository.menuItems({
                        repos: L
                    })))
                } else {
                    K.append(E(stash.layout.menu.noRecentReposMenuItem()))
                }
                C.trigger("stash.feature.repositories.recent.loaded", this, M)
            }).fail(function() {
                K.append(E(stash.layout.menu.errorLoadingRecentReposMenuItem()))
            }).always(function() {
                J.remove()
            })
        };
        E(window).on("load", G)
    }
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:curl', location = 'js/wrm/curl-config.js' */
(function() {
    if (!window.WRM) {
        window.WRM = {}
    }
    window.curl = {
        apiContext: WRM,
        defineContext: WRM
    }
}());
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:curl', location = 'js/wrm/lib/curl-0.7.3.js' */
(function(a) {
    var P = "0.7.3", u = "curl", p = "define", G, v, g, d = a.document, l = d && (d.head || d.getElementsByTagName("head")[0]), V = l && l.getElementsByTagName("base")[0] || null, i = {}, N = {}, c = {}, A = "addEventListener"in a ? {} : {
        loaded: 1,
        complete: 1
    }, m = {}, b = m.toString, y, k = {}, f = {}, h = false, O, t = /\?|\.js\b/, e = /^\/|^[^:]+:\/\//, L = /(\.)(\.?)(?:$|\/([^\.\/]+.*)?)/g, E = /\/\*[\s\S]*?\*\/|(?:[^\\])\/\/.*?[\n\r]/g, C = /require\s*\(\s*["']([^"']+)["']\s*\)|(?:[^\\]?)(["'])/g, M, x;
    function Q() {}
    function D(X, W) {
        return b.call(X).indexOf("[object " + W) == 0
    }
    function B(X) {
        var W;
        X.path = J(X.path || X.location || "");
        W = X.main || "./main";
        if (!n(W)) {
            W = "./" + W
        }
        X.main = s(W, X.name + "/");
        X.config = X.config;
        return X
    }
    function n(W) {
        return W.charAt(0) == "."
    }
    function j(W) {
        return e.test(W)
    }
    function o(X, W) {
        return J(X) + "/" + W
    }
    function J(W) {
        return W && W.charAt(W.length - 1) == "/" ? W.substr(0, W.length - 1) : W
    }
    function s(ab, X) {
        var ac, W, Z, Y, aa;
        ac = 1;
        W = ab;
        if (n(W)) {
            Y = true;
            W = W.replace(L, function(ad, ae, af, ag) {
                if (af) {
                    ac++
                }
                return ag || ""
            })
        }
        if (Y) {
            Z = X.split("/");
            aa = Z.length - ac;
            if (aa < 0) {
                return ab
            }
            Z.splice(aa, ac);
            return Z.concat(W || []).join("/")
        } else {
            return W
        }
    }
    function S(X) {
        var W = X.indexOf("!");
        return {
            resourceId: X.substr(W + 1),
            pluginId: W >= 0 && X.substr(0, W)
        }
    }
    function U() {}
    function z(X, W) {
        U.prototype = X || m;
        var Z = new U();
        U.prototype = m;
        for (var Y in W) {
            Z[Y] = W[Y]
        }
        return Z
    }
    function F() {
        var X, aa, W;
        X = this;
        aa = [];
        function ab(ac, ad, ae) {
            aa.push([ac, ad, ae])
        }
        function Y(ag, ad) {
            var af, ac, ae = 0;
            while ((af = aa[ae++]) ) {
                ac = af[ag];
                if (ac) {
                    ac(ad)
                }
            }
        }
        W = function Z(ad, ac) {
            ab = ad ? function(ae, af) {
                ae && ae(ac)
            }
            : function(ae, af) {
                af && af(ac)
            }
            ;
            W = Q;
            Y(ad ? 0 : 1, ac);
            Y = Q;
            aa = y
        }
        ;
        this.then = function(ac, ad, ae) {
            ab(ac, ad, ae);
            return X
        }
        ;
        this.resolve = function(ac) {
            X.resolved = ac;
            W(true, ac)
        }
        ;
        this.reject = function(ac) {
            X.rejected = ac;
            W(false, ac)
        }
        ;
        this.progress = function(ac) {
            Y(2, ac)
        }
    }
    function r(W) {
        return W instanceof F
    }
    function H(W, Z, X, Y) {
        if (r(W)) {
            return W.then(Z, X, Y)
        } else {
            return Z(W)
        }
    }
    function q(Y, X, Z) {
        var W;
        return function() {
            if (--Y >= 0 && X) {
                W = X.apply(y, arguments)
            }
            if (Y == 0 && Z) {
                Z(W)
            }
            return W
        }
    }
    x = {
        toAbsId: function(ab, aa, W) {
            var Y, X, Z;
            Y = s(ab, aa);
            if (n(Y)) {
                return Y
            }
            Z = S(Y);
            X = Z.pluginId;
            Y = X || Z.resourceId;
            if (Y in W.pathMap) {
                Y = W.pathMap[Y].main || Y
            }
            if (X) {
                if (X.indexOf("/") < 0 && !(X in W.pathMap)) {
                    Y = o(W.pluginPath, X)
                }
                Y = Y + "!" + Z.resourceId
            }
            return Y
        },
        createContext: function(W, X, ab, aa) {
            var Z;
            Z = new F();
            Z.id = X || "";
            Z.isPreload = aa;
            Z.depNames = ab;
            Z.config = W;
            function ad(ae) {
                return x.toAbsId(ae, Z.id, W)
            }
            function ac(ae) {
                return x.resolvePathInfo(ad(ae), W).url
            }
            function Y(ag, ak, af) {
                var ae, aj, ai, ah;
                ae = ak && function() {
                    ak.apply(y, arguments[0])
                }
                ;
                if (D(ag, "String")) {
                    if (ae) {
                        throw new Error("require(id, callback) not allowed")
                    }
                    aj = ad(ag);
                    ai = k[aj];
                    if (!(aj in k)) {
                        throw new Error("Module not resolved: " + aj)
                    }
                    ah = r(ai) && ai.exports;
                    return ah || ai
                } else {
                    H(x.getDeps(x.createContext(W, Z.id, ag, aa)), ae, af)
                }
            }
            Z.require = Y;
            Y.toUrl = ac;
            Z.toAbsId = ad;
            return Z
        },
        createResourceDef: function(W, ad, ab) {
            var aa, X, Z;
            aa = x.createContext(W, ad, y, ab);
            X = aa.resolve;
            Z = q(1, function(af) {
                aa.deps = af;
                try {
                    return x.executeDefFunc(aa)
                } catch (ae) {
                    aa.reject(ae)
                }
            });
            aa.resolve = function Y(ae) {
                H(ab || h, function() {
                    X((k[aa.id] = f[aa.url] = Z(ae)))
                })
            }
            ;
            aa.exportsReady = function ac(ae) {
                H(ab || h, function() {
                    if (aa.exports) {
                        Z(ae);
                        aa.progress(N)
                    }
                })
            }
            ;
            return aa
        },
        createPluginDef: function(W, aa, Z, Y) {
            var X;
            X = x.createContext(W, Z, y, Y);
            return X
        },
        getCjsRequire: function(W) {
            return W.require
        },
        getCjsExports: function(W) {
            return W.exports || (W.exports = {})
        },
        getCjsModule: function(X) {
            var W = X.module;
            if (!W) {
                W = X.module = {
                    id: X.id,
                    uri: x.getDefUrl(X),
                    exports: x.getCjsExports(X),
                    config: function() {
                        return X.config
                    }
                };
                W.exports = W.exports
            }
            return W
        },
        getDefUrl: function(W) {
            return W.url || (W.url = x.checkToAddJsExt(W.require.toUrl(W.id), W.config))
        },
        setApi: function(W) {
            var Y, Z, X, aa, ab, ac;
            Y = u;
            Z = p;
            X = aa = a;
            ab = " already exists";
            if (W) {
                ac = W.overwriteApi || W.overwriteApi;
                Y = W.apiName || W.apiName || Y;
                X = W.apiContext || W.apiContext || X;
                Z = W.defineName || W.defineName || Z;
                aa = W.defineContext || W.defineContext || aa;
                if (v && D(v, "Function")) {
                    a[u] = v
                }
                v = null;
                if (g && D(g, "Function")) {
                    a[p] = g
                }
                g = null;
                if (!ac) {
                    if (X[Y] && X[Y] != K) {
                        throw new Error(Y + ab)
                    }
                    if (aa[Z] && aa[Z] != I) {
                        throw new Error(Z + ab)
                    }
                }
            }
            X[Y] = K;
            aa[Z] = I
        },
        config: function(aa) {
            var ab, Z, W, X;
            if ("baseUrl"in aa) {
                aa.baseUrl = aa.baseUrl
            }
            if ("main"in aa) {
                aa.main = aa.main
            }
            if ("preloads"in aa) {
                aa.preloads = aa.preloads
            }
            if ("pluginPath"in aa) {
                aa.pluginPath = aa.pluginPath
            }
            if ("dontAddFileExt"in aa || aa.dontAddFileExt) {
                aa.dontAddFileExt = new RegExp(aa.dontAddFileExt || aa.dontAddFileExt)
            }
            ab = G;
            Z = z(ab, aa);
            Z.pathMap = z(ab.pathMap);
            W = aa.plugins || {};
            Z.plugins = z(ab.plugins);
            Z.paths = z(ab.paths, aa.paths);
            Z.packages = z(ab.packages, aa.packages);
            Z.pathList = [];
            function ac(af, am) {
                var ah, aj, al, ak, an, ai;
                for (var ag in af) {
                    al = af[ag];
                    if (D(al, "String")) {
                        al = {
                            path: af[ag]
                        }
                    }
                    al.name = al.name || ag;
                    an = Z;
                    ak = S(J(al.name));
                    ah = ak.resourceId;
                    aj = ak.pluginId;
                    if (aj) {
                        an = W[aj];
                        if (!an) {
                            an = W[aj] = z(Z);
                            an.pathMap = z(Z.pathMap);
                            an.pathList = []
                        }
                        delete af[ag]
                    }
                    if (am) {
                        ai = B(al);
                        if (ai.config) {
                            ai.config = z(Z, ai.config)
                        }
                    } else {
                        ai = {
                            path: J(al.path)
                        }
                    }
                    ai.specificity = ah.split("/").length;
                    if (ah) {
                        an.pathMap[ah] = ai;
                        an.pathList.push(ah)
                    } else {
                        an.baseUrl = x.resolveUrl(al.path, Z)
                    }
                }
            }
            function ad(af) {
                var ag = af.pathMap;
                af.pathRx = new RegExp("^(" + af.pathList.sort(function(ai, ah) {
                    return ag[ah].specificity - ag[ai].specificity
                }).join("|").replace(/\/|\./g, "\\$&") + ")(?=\\/|$)");
                delete af.pathList
            }
            ac(aa.packages, true);
            ac(aa.paths, false);
            for (X in W) {
                var Y = x.toAbsId(X + "!", "", Z);
                Z.plugins[Y.substr(0, Y.length - 1)] = W[X]
            }
            W = Z.plugins;
            for (X in W) {
                W[X] = z(Z, W[X]);
                var ae = W[X].pathList;
                if (ae) {
                    W[X].pathList = ae.concat(Z.pathList);
                    ad(W[X])
                }
            }
            for (X in ab.pathMap) {
                if (!Z.pathMap.hasOwnProperty(X)) {
                    Z.pathList.push(X)
                }
            }
            ad(Z);
            return Z
        },
        checkPreloads: function(W) {
            var X;
            X = W && W.preloads;
            if (X && X.length > 0) {
                H(h, function() {
                    h = x.getDeps(x.createContext(G, y, X, true))
                })
            }
        },
        resolvePathInfo: function(Z, X) {
            var Y, ab, aa, W;
            Y = X.pathMap;
            if (!j(Z)) {
                aa = Z.replace(X.pathRx, function(ac) {
                    ab = Y[ac] || {};
                    W = ab.config;
                    return ab.path || ""
                })
            } else {
                aa = Z
            }
            return {
                config: W || G,
                url: x.resolveUrl(aa, X)
            }
        },
        resolveUrl: function(Y, W) {
            var X = W.baseUrl;
            return X && !j(Y) ? o(X, Y) : Y
        },
        checkToAddJsExt: function(X, W) {
            return X + ((W || G).dontAddFileExt.test(X) ? "" : ".js")
        },
        loadScript: function(Z, ab, X) {
            var Y = d.createElement("script");
            function aa(ac) {
                ac = ac || a.event;
                if (ac.type == "load" || A[Y.readyState]) {
                    delete c[Z.id];
                    Y.onload = Y.onreadystatechange = Y.onerror = "";
                    ab()
                }
            }
            function W(ac) {
                X(new Error("Syntax or http error: " + Z.url))
            }
            Y.onload = Y.onreadystatechange = aa;
            Y.onerror = W;
            Y.type = Z.mimetype || "text/javascript";
            Y.charset = "utf-8";
            Y.async = !Z.order;
            Y.src = Z.url;
            c[Z.id] = Y;
            l.insertBefore(Y, V);
            return Y
        },
        extractCjsDeps: function(X) {
            var Y, W = [], Z;
            Y = typeof X == "string" ? X : X.toSource ? X.toSource() : X.toString();
            Y.replace(E, "").replace(C, function(aa, ac, ab) {
                if (ab) {
                    Z = Z == ab ? y : Z
                } else {
                    if (!Z) {
                        W.push(ac)
                    }
                }
                return ""
            });
            return W
        },
        fixArgs: function(X) {
            var ac, aa, Y, ab, W, Z;
            W = X.length;
            Y = X[W - 1];
            ab = D(Y, "Function") ? Y.length : -1;
            if (W == 2) {
                if (D(X[0], "Array")) {
                    aa = X[0]
                } else {
                    ac = X[0]
                }
            } else {
                if (W == 3) {
                    ac = X[0];
                    aa = X[1]
                }
            }
            if (!aa && ab > 0) {
                Z = true;
                aa = ["require", "exports", "module"].slice(0, ab).concat(x.extractCjsDeps(Y))
            }
            return {
                id: ac,
                deps: aa || [],
                res: ab >= 0 ? Y : function() {
                    return Y
                }
                ,
                cjs: Z
            }
        },
        executeDefFunc: function(Y) {
            var X, W;
            W = Y.cjs ? Y.exports : y;
            X = Y.res.apply(W, Y.deps);
            if (X === y && Y.exports) {
                X = Y.module ? (Y.exports = Y.module.exports) : Y.exports
            }
            return X
        },
        defineResource: function(X, W) {
            X.res = W.res;
            X.cjs = W.cjs;
            X.depNames = W.deps;
            x.getDeps(X)
        },
        getDeps: function(X) {
            var ab, af, ai, ad, ag, aa, W, aj, ah;
            ai = [];
            af = X.depNames;
            ad = af.length;
            if (af.length == 0) {
                Y()
            }
            function ae(am, ak, al) {
                ai[ak] = am;
                if (al) {
                    aj(am, ak)
                }
            }
            aj = q(ad, ae, ac);
            ah = q(ad, ae, Y);
            for (ab = 0; ab < ad; ab++) {
                W = af[ab];
                if (W in M) {
                    ah(M[W](X), ab, true);
                    if (X.exports) {
                        X.progress(i)
                    }
                } else {
                    if (!W) {
                        ah(y, ab, true)
                    } else {
                        Z(W, ab)
                    }
                }
            }
            return X;
            function Z(am, al) {
                var an, ak, ap, ao;
                an = q(1, function(aq) {
                    ak(aq);
                    ah(aq, al)
                });
                ak = q(1, function(aq) {
                    aj(aq, al)
                });
                ap = x.fetchDep(am, X);
                ao = r(ap) && ap.exports;
                if (ao) {
                    ak(ao)
                }
                H(ap, an, X.reject, X.exports && function(aq) {
                    if (ap.exports) {
                        if (aq == i) {
                            ak(ap.exports)
                        } else {
                            if (aq == N) {
                                an(ap.exports)
                            }
                        }
                    }
                }
                )
            }
            function Y() {
                X.resolve(ai)
            }
            function ac() {
                X.exportsReady && X.exportsReady(ai)
            }
        },
        fetchResDef: function(W) {
            x.getDefUrl(W);
            x.loadScript(W, function() {
                var X = O;
                O = y;
                if (W.useNet !== false) {
                    if (!X || X.ex) {
                        W.reject(new Error(((X && X.ex) || "define() missing or duplicated: " + W.url)))
                    } else {
                        x.defineResource(W, X)
                    }
                }
            }, W.reject);
            return W
        },
        fetchDep: function(ai, X) {
            var W, Z, ae, ab, ah, ad, aa, aj, af, Y, ac, ag;
            W = X.toAbsId;
            Z = X.isPreload;
            ae = X.config || G;
            ab = S(W(ai));
            aj = ab.resourceId;
            ah = ab.pluginId || aj;
            af = x.resolvePathInfo(ah, ae);
            if (ab.pluginId) {
                ad = ah
            } else {
                ad = af.config.moduleLoader || af.config.moduleLoader;
                if (ad) {
                    aj = ah;
                    ah = ad;
                    af = x.resolvePathInfo(ad, ae)
                }
            }
            if (ah in k) {
                Y = k[ah]
            } else {
                if (af.url in f) {
                    Y = k[ah] = f[af.url]
                } else {
                    Y = x.createResourceDef(af.config, ah, Z);
                    Y.url = x.checkToAddJsExt(af.url, af.config);
                    k[ah] = f[af.url] = Y;
                    x.fetchResDef(Y)
                }
            }
            if (ah == ad) {
                ac = new F();
                ag = ae.plugins[ad] || ae;
                H(Y, function(am) {
                    var ao, ak, an;
                    an = am.dynamic;
                    if ("normalize"in am) {
                        aj = am.normalize(aj, W, Y.config) || ""
                    } else {
                        aj = W(aj)
                    }
                    ak = ad + "!" + aj;
                    ao = k[ak];
                    if (!(ak in k)) {
                        ao = x.createPluginDef(ag, ak, aj, Z);
                        if (!an) {
                            k[ak] = ao
                        }
                        var al = function(ap) {
                            ao.resolve(ap);
                            if (!an) {
                                k[ak] = ap
                            }
                        };
                        al.resolve = al;
                        al.reject = al.error = ao.reject;
                        am.load(aj, ao.require, al, ag)
                    }
                    if (ac != ao) {
                        H(ao, ac.resolve, ac.reject, ac.progress)
                    }
                }, ac.reject)
            }
            return ac || Y
        },
        getCurrentDefName: function() {
            var W;
            if (!D(a.opera, "Opera")) {
                for (var X in c) {
                    if (c[X].readyState == "interactive") {
                        W = X;
                        break
                    }
                }
            }
            return W
        }
    };
    M = {
        require: x.getCjsRequire,
        exports: x.getCjsExports,
        module: x.getCjsModule
    };
    function K() {
        var X = [].slice.call(arguments), W;
        if (D(X[0], "Object")) {
            W = X.shift();
            R(W)
        }
        return new w(X[0],X[1],X[2])
    }
    function R(W) {
        if (W) {
            x.setApi(W);
            G = x.config(W);
            x.checkPreloads(W);
            if ("main"in W) {
                setTimeout(function() {
                    var X;
                    X = x.createContext(G, y, [].concat(W.main));
                    x.getDeps(X)
                }, 0)
            }
        }
    }
    function w(Y, ab, X, aa) {
        var Z, W;
        W = x.createContext(G, y, [].concat(Y));
        this["then"] = Z = function(ac, ad) {
            H(W, function(ae) {
                if (ac) {
                    ac.apply(y, ae)
                }
            }, function(ae) {
                if (ad) {
                    ad(ae)
                } else {
                    throw ae
                }
            });
            return this
        }
        ;
        this["next"] = function(ae, ac, ad) {
            return new w(ae,ac,ad,W)
        }
        ;
        this["config"] = R;
        if (ab || X) {
            Z(ab, X)
        }
        H(aa, function() {
            x.getDeps(W)
        })
    }
    K.version = P;
    K.config = R;
    function T(W) {
        var Z, X, Y;
        Z = W.id;
        if (Z == y) {
            if (O !== y) {
                O = {
                    ex: "Multiple anonymous defines in url"
                }
            } else {
                if (!(Z = x.getCurrentDefName())) {
                    O = W
                }
            }
        }
        if (Z != y) {
            X = k[Z];
            if (!(Z in k)) {
                Y = x.resolvePathInfo(Z, G);
                X = x.createResourceDef(Y.config, Z);
                k[Z] = X
            }
            if (!r(X)) {
                throw new Error("duplicate define: " + Z)
            }
            X.useNet = false;
            x.defineResource(X, W)
        }
    }
    function I() {
        var W = x.fixArgs(arguments);
        T(W)
    }
    I.amd = {
        plugins: true,
        jQuery: true,
        curl: P
    };
    G = {
        baseUrl: "",
        pluginPath: "curl/plugin",
        dontAddFileExt: t,
        paths: {},
        packages: {},
        plugins: {},
        pathMap: {},
        pathRx: /$^/
    };
    v = a[u];
    g = a[p];
    if (!v || D(v, "Function")) {
        x.setApi()
    } else {
        a[u] = y;
        R(v)
    }
    k[u] = K;
    k["curl/_privileged"] = {
        core: x,
        cache: k,
        config: function() {
            return G
        },
        _define: T,
        _curl: K,
        Promise: F
    }
}(this.window || (typeof global != "undefined" && global) || this));
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:curl', location = 'js/wrm/lib/curl-css-0.7.3.js' */
(function(B) {
    var z = "createElement", s = "parentNode", f = B.setTimeout, H = B.document, k, x = H && H.createStyleSheet && !(H.documentMode >= 10), v = [], u = [], C = [], i = 12, F, g = "HTTP or network error.", l = {};
    if (H) {
        k = H.head || H.getElementsByTagName("head")[0];
        if (x) {
            F = c
        } else {
            F = t
        }
    }
    function q(J, I) {
        l[J] = l[J] || I
    }
    function y() {
        var I;
        I = H[z]("link");
        I.rel = "stylesheet";
        I.type = "text/css";
        return I
    }
    function r(J, I) {
        J.onload = function() {
            q("load", true);
            I()
        }
    }
    function n(J, I) {
        J.onerror = function() {
            q("error", true);
            I()
        }
    }
    function c(K, I, M) {
        var L;
        C.push({
            url: K,
            cb: I,
            eb: function J() {
                M(new Error(g))
            }
        });
        L = h();
        if (L) {
            m(L)
        }
    }
    function m(K) {
        var J, I;
        J = C.shift();
        I = K.styleSheet;
        if (J) {
            K.onload = function() {
                J.cb(J.ss);
                m(K)
            }
            ;
            K.onerror = function() {
                J.eb();
                m(K)
            }
            ;
            J.ss = I.imports[I.addImport(J.url)]
        } else {
            e(K);
            G(K)
        }
    }
    function G(I) {
        u.push(I)
    }
    function h() {
        var I;
        I = u.shift();
        if (!I && v.length < i) {
            I = H.createElement("style");
            v.push(I);
            k.appendChild(I)
        }
        return I
    }
    function b(L) {
        var K, J, M;
        if (!L.href || !o()) {
            return false
        }
        K = false;
        try {
            J = L.sheet;
            if (J) {
                M = J.cssRules;
                K = M === null;
                if (!K && M) {
                    J.insertRule("-curl-css-test {}", 0);
                    J.deleteRule(0);
                    K = true
                }
            }
        } catch (I) {
            K = Object.prototype.toString.call(window.opera) != "[object Opera]" && /security|denied/i.test(I.message)
        }
        return K
    }
    function e(I) {
        I.onload = I.onerror = j
    }
    function w(I) {
        return I.onload == j || !I.onload
    }
    function E(J, K, I) {
        if (l.load) {
            return
        }
        if (b(J)) {
            I(J.sheet)
        } else {
            if (!w(J)) {
                f(function() {
                    E(J, K, I)
                }, K)
            }
        }
    }
    function A(J, K, I) {
        if (l.error) {
            return
        }
    }
    function p(J, L, I) {
        function K() {
            if (w(J)) {
                return
            }
            e(J);
            d(function() {
                I(J.sheet)
            })
        }
        r(J, K);
        E(J, L, K)
    }
    function D(K, L, I) {
        function J() {
            if (w(K)) {
                return
            }
            e(K);
            I(new Error(g))
        }
        n(K, J);
        A(K, L, J)
    }
    function t(J, I, K, M) {
        var L;
        L = y();
        p(L, M, I);
        D(L, M, K);
        L.href = J;
        k.appendChild(L)
    }
    function d(I) {
        function J() {
            if (o()) {
                I()
            } else {
                f(J, 10)
            }
        }
        J()
    }
    function o() {
        return !H.readyState || H.readyState == "complete"
    }
    function a(I, J) {
        return I.lastIndexOf(".") <= I.lastIndexOf("/") ? I + "." + J : I
    }
    function j() {}
    WRM.define("curl/plugin/css", {
        normalize: function(N, J) {
            var L, M;
            if (!N) {
                return N
            }
            L = [N];
            M = [];
            for (var K = 0, I = L.length; K < I; K++) {
                M.push(J(L[K]))
            }
            return M.join(",")
        },
        load: function(R, L, U, K) {
            var Q, J, V, S, M, O;
            Q = [];
            J = [R || ""];
            V = K.cssWatchPeriod || 50;
            S = K.cssNoWait;
            M = J.length;
            function N(W) {
                if (J.length > 1) {
                    Q.push(W)
                }
                if (--M == 0) {
                    U(J.length == 1 ? W : Q)
                }
            }
            function P(X) {
                var W;
                W = U.reject || function(Y) {
                    throw Y
                }
                ;
                W(X)
            }
            for (O = 0; O < J.length; O++) {
                R = J[O];
                var I, T;
                I = a(L.toUrl(R), "css");
                if (S) {
                    T = y();
                    T.href = I;
                    k.appendChild(T);
                    N(T.sheet || T.styleSheet)
                } else {
                    F(I, N, P, V)
                }
            }
        },
        "plugin-builder": "./builder/css",
        pluginBuilder: "./builder/css"
    })
})(this);
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:curl', location = 'js/wrm/lib/curl-js-0.7.3.js' */
(function(b, c, a) {
    WRM.define("curl/plugin/js", ["curl/_privileged"], function(m) {
        var f = {}, j = [], h = c && c.createElement("script").async == true, l, k, g;
        l = m.Promise;
        function i(n, o) {
            return n.lastIndexOf(".") <= n.lastIndexOf("/") ? n + "." + o : n
        }
        function e(o, u, q) {
            var v, s, p;
            v = new Date().valueOf() + (o.timeoutMsec || 300000);
            function n() {
                s = true;
                if (o.exports) {
                    o.resolved = a(o.exports)
                }
                if (!o.exports || o.resolved) {
                    u(p)
                } else {
                    q()
                }
            }
            function r(w) {
                s = true;
                q(w)
            }
            function t() {
                if (!s) {
                    if (v < new Date()) {
                        q()
                    } else {
                        setTimeout(t, 10)
                    }
                }
            }
            if (q && o.exports) {
                setTimeout(t, 10)
            }
            p = m.core.loadScript(o, n, r)
        }
        function d(n, o) {
            e(n, function() {
                var p = j.shift();
                k = j.length > 0;
                if (p) {
                    d.apply(null, p)
                }
                o.resolve(n.resolved || true)
            }, function(p) {
                o.reject(p)
            })
        }
        return {
            dynamic: true,
            normalize: function(q, p, o) {
                var n = q.indexOf("!");
                return n >= 0 ? p(q.substr(0, n)) + q.substr(n) : p(q)
            },
            load: function(o, r, w, q) {
                var s, t, u, v, n, p, y;
                s = o.indexOf("!order") > 0;
                t = o.indexOf("!exports=");
                u = t > 0 && o.substr(t + 9);
                v = "prefetch"in q ? q.prefetch : true;
                o = s || t > 0 ? o.substr(0, o.indexOf("!")) : o;
                n = i(r.toUrl(o), "js");
                function x(z) {
                    (w.error || function(A) {
                        throw A
                    }
                    )(z)
                }
                if (n in f) {
                    if (f[n]instanceof l) {
                        f[n].then(w, x)
                    } else {
                        w(f[n])
                    }
                } else {
                    p = {
                        name: o,
                        url: n,
                        order: s,
                        exports: u,
                        timeoutMsec: q.timeout
                    };
                    f[n] = y = new l();
                    y.then(function(z) {
                        f[n] = z;
                        w(z)
                    }, x);
                    if (s && !h && k) {
                        j.push([p, y]);
                        if (v) {
                            p.mimetype = "text/cache";
                            e(p, function(z) {
                                z && z.parentNode.removeChild(z)
                            }, function() {});
                            p.mimetype = ""
                        }
                    } else {
                        k = k || s;
                        d(p, y)
                    }
                }
            }
        }
    })
}(this, this.document, function() {
    try {
        return eval(arguments[0])
    } catch (ex) {
        return
    }
}));
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/jquery.js' */
WRM.define("wrm/jquery", function() {
    return AJS.$
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/underscore.js' */
WRM.define("wrm/_", function() {
    var a = {
        filter: function(f, d) {
            var b = [];
            for (var c = 0; c < f.length; ++c) {
                var e = f[c];
                if (d(e)) {
                    b.push(e)
                }
            }
            return b
        },
        map: function(d, c) {
            var e = [];
            for (var b = 0; b < d.length; ++b) {
                e.push(c(d[b]))
            }
            return e
        },
        each: function(d, c) {
            if (d.length === +d.length) {
                for (var b = 0; b < d.length; ++b) {
                    c(d[b])
                }
            } else {
                for (var e in d) {
                    if (d.hasOwnProperty(e)) {
                        c(d[e], e)
                    }
                }
            }
        },
        bind: function(c, b) {
            return function() {
                c.apply(b, Array.prototype.slice.call(arguments))
            }
        },
        isArray: function(b) {
            return Object.prototype.toString.call(b) == "[object Array]"
        },
        isUndefined: function(b) {
            return b === void 0
        },
        isNull: function(b) {
            return b === null
        }
    };
    return a
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/builder.js' */
WRM.define("wrm/builder", function() {
    var a = function(d) {
        var b = "(?:$|\\?.*)";
        var c = "^" + d;
        this.patterns = {
            js: {
                superBatch: new RegExp(c + "/superbatch/js/batch.js" + b),
                contextBatch: new RegExp(c + "/contextbatch/js/(.*?)/batch.js" + b),
                resourceBatch: new RegExp(c + "/batch/(.*?)/(.*).js" + b),
                noBatch: new RegExp(c + "/resources/(.*?)/(.*).js" + b)
            },
            css: {
                superBatch: new RegExp(c + "/superbatch/css/batch.css" + b),
                contextBatch: new RegExp(c + "/contextbatch/css/(.*?)/batch.css" + b),
                resourceBatch: new RegExp(c + "/batch/(.*?)/(.*).css" + b),
                noBatch: new RegExp(c + "/resources/(.*?)/(.*).css" + b)
            }
        }
    };
    a.prototype = {
        initialize: function(c) {
            var g, b = c.getElementsByTagName("script"), e = c.getElementsByTagName("link"), f = {
                superBatch: false,
                modules: [],
                contexts: []
            };
            for (g = 0; g < b.length; ++g) {
                var d = b[g];
                if (d.getAttribute("src")) {
                    this._inspectMatches(d.getAttribute("src"), this.patterns.js, f)
                }
            }
            for (g = 0; g < e.length; ++g) {
                var h = e[g];
                if (h.getAttribute("href")) {
                    this._inspectMatches(h.getAttribute("href"), this.patterns.css, f)
                }
            }
            return f
        },
        getModulesAndContextsFromScriptUrl: function(c) {
            var b = {
                superBatch: false,
                modules: [],
                contexts: []
            };
            this._inspectMatches(c, this.patterns.js, b);
            return b
        },
        _inspectMatches: function(d, f, c) {
            var b;
            b = d.match(f.superBatch);
            if (b) {
                c.superBatch = true;
                return
            }
            b = d.match(f.contextBatch);
            if (b) {
                var g = b[1].split(",");
                for (var e = 0; e < g.length; ++e) {
                    this._addToLoadedList(c.contexts, g[e])
                }
                return
            }
            b = d.match(f.resourceBatch);
            if (b) {
                this._addToLoadedList(c.modules, b[1]);
                return
            }
            b = d.match(f.noBatch);
            if (b) {
                this._addToLoadedList(c.modules, b[1]);
                return
            }
        },
        _addToLoadedList: function(d, c) {
            for (var b = 0; b < d.length; ++b) {
                if (d[b] === c) {
                    return
                }
            }
            d.push(c)
        }
    };
    return a
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/ie-only-filter.js' */
WRM.define("wrm/ie-only-filter", ["wrm/jquery", "wrm/_"], function(c, a) {
    function b(d) {
        var e = c.browser.msie;
        return a.filter(d, function(f) {
            return f.ieOnly ? e : true
        })
    }
    return b
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/conditional-comment-filter.js' */
WRM.define("wrm/conditional-comment-filter", ["wrm/jquery", "wrm/_"], function(c, a) {
    function b(e) {
        var f = c.browser.msie;
        var d = c.browser.version;
        return a.filter(e, function(h) {
            var g = h.conditionalComment;
            if (!g) {
                return true
            }
            if (!f || d > 9) {
                return false
            }
            g = g.toLowerCase();
            switch (g) {
            case "ie":
                return true;
            case "lt ie 9":
                return d < 9;
            case "lte ie 9":
                return d <= 9;
            case "ie 9":
                return d == 9;
            case "gt ie 9":
                return d > 9;
            case "gte ie 9":
                return d >= 9;
            case "lt ie 8":
                return d < 8;
            case "lte ie 8":
                return d <= 8;
            case "ie 8":
                return d == 8;
            case "gt ie 8":
                return d > 8;
            case "gte ie 8":
                return d >= 8;
            default:
                AJS.log("Cannot parse conditional comment " + g);
                return false
            }
        })
    }
    return b
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/resource-base-url-pattern.js' */
WRM.define("wrm/resource-base-url-pattern", function() {
    return WRM.data.claim("com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern")
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/require-handler.js' */
WRM.define("wrm/require-handler", ["wrm/jquery", "wrm/_", "wrm/builder", "wrm/conditional-comment-filter", "wrm/ie-only-filter", "wrm/resource-base-url-pattern"], function(e, h, i, g, a, c) {
    var f = /^wr!(.*)$/
      , d = /^wrc!(.*)$/;
    var b = function() {
        this._requireCache = {}
    };
    b.prototype = {
        require: function(k, j) {
            if (!h.isArray(k)) {
                k = [k]
            }
            if (!this._requireCache.hasOwnProperty(k)) {
                this._requireCache[k] = this._resolveAsync(k)
            }
            var l = this._requireCache[k];
            if (j) {
                l.done(function() {
                    j.apply(this, arguments)
                })
            }
            return l
        },
        _resolveAsync: function(l) {
            var j = e.Deferred();
            var k = this;
            this._getScriptsForResources(l).done(function(p) {
                if (p.unparsedData) {
                    window.WRM._unparsedData || (window.WRM._unparsedData = {});
                    h.each(p.unparsedData, function(u, t) {
                        window.WRM._unparsedData[t] = u
                    })
                }
                var q = [];
                var s = [];
                var m = k._filter(p.resources);
                for (var o = 0; o < m.length; ++o) {
                    var r = m[o];
                    var n = r.url;
                    if (r.resourceType === "JAVASCRIPT") {
                        if (!k._isJSInInitLoad(n)) {
                            q.push("js!" + n + "!order")
                        }
                    } else {
                        if (r.resourceType === "CSS") {
                            if (!k._isCSSInInitLoad(n)) {
                                if (r.media && "all" !== r.media) {
                                    s.push(r)
                                } else {
                                    q.push("css!" + n)
                                }
                            }
                        } else {
                            AJS.log("Unknown resource type required: " + n)
                        }
                    }
                }
                AJS.log("Downloading resources:\n" + q.join("\n"));
                WRM.curl(q, function() {
                    h.each(s, function(u) {
                        k._loadCssImmediate(u)
                    });
                    var t = h.map(l, function() {
                        return window
                    });
                    j.resolveWith(k, t)
                }, function() {
                    j.rejectWith(k, arguments)
                })
            });
            return j.promise()
        },
        _loadCssImmediate: function(k) {
            AJS.log("WARN: asynchronously loading a CSS resource containing a media query: " + k.url);
            var j = '<link rel="stylesheet" type="text/css" href="' + k.url + '" media="' + k.media + '" />';
            e(j).appendTo("head")
        },
        _getScriptsForResources: function(k) {
            if (!this._builder) {
                this._builder = new i(c);
                this._initLoadResources = this._builder.initialize(document)
            }
            var j = [];
            var l = [];
            h.each(k, function(n) {
                var m;
                if (m = n.match(f)) {
                    j.push(m[1])
                } else {
                    if (m = n.match(d)) {
                        l.push(m[1])
                    }
                }
            });
            return e.ajax({
                url: AJS.contextPath() + "/rest/webResources/1.0/resources",
                type: "POST",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({
                    r: j,
                    c: l,
                    xc: this._initLoadResources.contexts,
                    xr: this._initLoadResources.modules
                })
            })
        },
        _isJSInInitLoad: function(j) {
            return e("script[src='" + j + "']").length > 0
        },
        _isCSSInInitLoad: function(j) {
            return e("link[href='" + j + "']").length > 0
        },
        _filter: function(k) {
            if (!this._filters) {
                this._filters = [g, a]
            }
            var j = k;
            h.each(this._filters, function(l) {
                j = l(j)
            });
            return j
        }
    };
    return b
});
;;/* module-key = 'com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager', location = 'js/wrm/index.js' */
WRM.curl(["wrm/require-handler"], function(b) {
    var a;
    WRM.require = function(d, c) {
        if (!a) {
            a = new b()
        }
        return a.require(d, c)
    }
});
;;/* module-key = 'com.atlassian.stash.plugin.stash-inbox-plugin:inbox-dialog', location = '/static/inbox/inbox.soy' */
// This file was automatically generated from inbox.soy.
// Please don't edit this file by hand.

/**
 * @fileoverview Templates in namespace stash.plugin.inbox.
 */

if (typeof stash == 'undefined') {
    var stash = {};
}
if (typeof stash.plugin == 'undefined') {
    stash.plugin = {};
}
if (typeof stash.plugin.inbox == 'undefined') {
    stash.plugin.inbox = {};
}

stash.plugin.inbox.dialogContents = function(opt_data, opt_ignored) {
    var output = '<h2>' + soy.$$escapeHtml("My pull requests") + '</h2><div class=\'inbox-table-wrapper aui-tabs horizontal-tabs\'><ul class="tabs-menu">';
    var roleList6 = opt_data.roles;
    var roleListLen6 = roleList6.length;
    for (var roleIndex6 = 0; roleIndex6 < roleListLen6; roleIndex6++) {
        var roleData6 = roleList6[roleIndex6];
        output += '<li class="menu-item"><a href="#inbox-pull-request-' + soy.$$escapeHtml(roleData6.id) + '">' + soy.$$escapeHtml(roleData6.title) + '</a></li>';
    }
    output += '</ul>';
    var roleList14 = opt_data.roles;
    var roleListLen14 = roleList14.length;
    for (var roleIndex14 = 0; roleIndex14 < roleListLen14; roleIndex14++) {
        var roleData14 = roleList14[roleIndex14];
        output += '<div id="inbox-pull-request-' + soy.$$escapeHtml(roleData14.id) + '" class="tabs-pane">' + stash.feature.pullRequest.pullRequestTable({
            pullRequestsPage: null,
            scope: 'global',
            id: 'inbox-pull-request-table-' + roleData14.id
        }) + '</div>';
    }
    output += '</div>';
    return output;
}
;
if (goog.DEBUG) {
    stash.plugin.inbox.dialogContents.soyTemplateName = 'stash.plugin.inbox.dialogContents';
}

stash.plugin.inbox.triggerIcon = function(opt_data, opt_ignored) {
    return '<span class=\'aui-icon aui-icon-small ' + ((opt_data.isEmpty) ? 'aui-iconfont-workbox-empty' : 'aui-iconfont-workbox') + '\'></span>';
}
;
if (goog.DEBUG) {
    stash.plugin.inbox.triggerIcon.soyTemplateName = 'stash.plugin.inbox.triggerIcon';
}

stash.plugin.inbox.emptyInboxMessage = function(opt_data, opt_ignored) {
    return '<span class="aui-icon aui-icon-large aui-iconfont-workbox-empty">' + soy.$$escapeHtml("No pull requests to approve") + '</span><h3>' + soy.$$escapeHtml("Inbox Zero") + '</h3>';
}
;
if (goog.DEBUG) {
    stash.plugin.inbox.emptyInboxMessage.soyTemplateName = 'stash.plugin.inbox.emptyInboxMessage';
}
;;/* module-key = 'com.atlassian.stash.plugin.stash-inbox-plugin:inbox-dialog', location = '/static/inbox/inbox.js' */
define("plugin/inbox/inbox", ["aui", "jquery", "underscore", "stash/api/util/events", "stash/api/util/navbuilder", "stash/api/util/state", "stash/api/util/server", "exports"], function(h, f, s, a, q, i, m, t) {
    var u, b;
    function k(v) {
        return q.newBuilder().addPathComponents("rest", "inbox", "latest", "pull-requests").withParams({
            role: v
        })
    }
    function c() {
        return q.newBuilder().addPathComponents("rest", "inbox", "latest", "pull-requests", "count").build()
    }
    var o = function(v) {
        if (v.keyCode === f.ui.keyCode.ESCAPE) {
            u.hide();
            v.preventDefault()
        }
    };
    var p = function() {
        u.hide()
    };
    var n = function(y, v) {
        var z = {
            title: "Could not retrieve inbox",
            message: "An unknown error occurred"
        };
        var x = {};
        if (v) {
            x = v.errors ? v.errors[0] : v
        }
        var w = f.extend({}, z, x);
        y.html(f(stash.widget.focusMessage.error({
            title: w.title,
            text: w.message,
            extraClasses: "communication-error"
        })));
        return false
    };
    function r(v) {
        l(v, [{
            id: "reviewer",
            title: "Reviewing"
        }, {
            id: "author",
            title: "Created"
        }])
    }
    function l(A, w) {
        var z = require("widget/avatar-list");
        var v = require("feature/pull-request/pull-request-table");
        var x = f(stash.plugin.inbox.dialogContents({
            roles: w
        }));
        A.append(x);
        var B = function(E, F, C, D) {
            return n.call(this, A, D)
        };
        function y(E, C) {
            var D = new v("open",null,s.partial(k, E),{
                scope: "global",
                target: "#inbox-pull-request-table-" + E,
                scrollPaneSelector: ".inbox-table-wrapper",
                bufferPixels: 50,
                pageSize: 10,
                spinnerSize: "medium",
                noneFoundMessageHtml: stash.plugin.inbox.emptyInboxMessage(),
                dataLoadedEvent: "stash.plugin.inbox.dataLoaded." + E,
                statusCode: {
                    0: B,
                    401: B,
                    500: B,
                    502: B
                }
            });
            D.handleErrors = f.noop;
            D.init();
            if (C) {
                h.tabs.change(A.find("[href=#inbox-pull-request-" + E + "]"))
            }
        }
        s.each(w, function(D, C) {
            y(D.id, C === 0)
        });
        A.find(".tabs-menu").delegate("a", "click", function(C) {
            h.tabs.change(f(this), C);
            C && C.preventDefault()
        });
        z.init()
    }
    var j = function(w, v, x) {
        x();
        f(document).on("keyup", o);
        h.dialog2.on("show", p);
        e(w, s.partial(r, w))
    };
    var e = s.once(function(v, x) {
        var w = f('<div class="loading-resource-spinner"></div>');
        v.empty().append(w);
        w.show().spin("medium");
        WRM.require("wrc!stash.pullRequest.inbox").always(function() {
            w.spinStop().remove()
        }).done(function() {
            x()
        })
    });
    var g = function() {
        f(document).off("keyup", o);
        h.dialog2.off("show", p);
        if (f(document.activeElement).closest("#inbox-pull-requests-content").length) {
            document.activeElement.blur()
        }
    };
    var d = function() {
        m.rest({
            url: c(),
            type: "GET",
            statusCode: {
                "*": false
            }
        }).done(function(w) {
            if (w.count > 0) {
                var x = f(aui.badges.badge({
                    text: w.count
                }));
                b.html(stash.plugin.inbox.triggerIcon({
                    isEmpty: false
                })).append(x);
                setTimeout(function() {
                    x.addClass("visible")
                }, 0)
            } else {
                var v = 500;
                b.find(".aui-badge").removeClass("visible");
                setTimeout(function() {
                    b.html(stash.plugin.inbox.triggerIcon({
                        isEmpty: true
                    }))
                }, v)
            }
            b.attr("data-countLoaded", true)
        })
    };
    t.onReady = function() {
        b = f("#inbox-pull-requests");
        if (b.length && i.getCurrentUser()) {
            b.html(stash.plugin.inbox.triggerIcon({
                isEmpty: true
            }));
            u = h.InlineDialog(b, "inbox-pull-requests-content", j, {
                width: 870,
                hideCallback: g
            });
            d();
            var v = function(w) {
                if (w.user.name === i.getCurrentUser().name) {
                    d()
                }
            };
            a.on("stash.widget.approve-button.added", v);
            a.on("stash.widget.approve-button.removed", v)
        }
    }
});
AJS.$(document).ready(function() {
    require("plugin/inbox/inbox").onReady()
});
;